var BV=t=>{throw TypeError(t)};var DI=(t,e,n)=>e.has(t)||BV("Cannot "+n);var Ut=(t,e,n)=>(DI(t,e,"read from private field"),n?n.call(t):e.get(t)),hr=(t,e,n)=>e.has(t)?BV("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Ii=(t,e,n,i)=>(DI(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),zr=(t,e,n)=>(DI(t,e,"access private method"),n);var oE=(t,e,n,i)=>({set _(r){Ii(t,e,r,n)},get _(){return Ut(t,e,i)}});function mj(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const o=Object.getOwnPropertyDescriptor(i,r);o&&Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var nN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gj={exports:{}},oA={},vj={exports:{}},Jr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DS=Symbol.for("react.element"),Hte=Symbol.for("react.portal"),Wte=Symbol.for("react.fragment"),jte=Symbol.for("react.strict_mode"),$te=Symbol.for("react.profiler"),qte=Symbol.for("react.provider"),Zte=Symbol.for("react.context"),Xte=Symbol.for("react.forward_ref"),Kte=Symbol.for("react.suspense"),Yte=Symbol.for("react.memo"),Jte=Symbol.for("react.lazy"),zV=Symbol.iterator;function Qte(t){return t===null||typeof t!="object"?null:(t=zV&&t[zV]||t["@@iterator"],typeof t=="function"?t:null)}var yj={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_j=Object.assign,xj={};function hw(t,e,n){this.props=t,this.context=e,this.refs=xj,this.updater=n||yj}hw.prototype.isReactComponent={};hw.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};hw.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function wj(){}wj.prototype=hw.prototype;function iN(t,e,n){this.props=t,this.context=e,this.refs=xj,this.updater=n||yj}var rN=iN.prototype=new wj;rN.constructor=iN;_j(rN,hw.prototype);rN.isPureReactComponent=!0;var UV=Array.isArray,Cj=Object.prototype.hasOwnProperty,sN={current:null},Sj={key:!0,ref:!0,__self:!0,__source:!0};function bj(t,e,n){var i,r={},o=null,c=null;if(e!=null)for(i in e.ref!==void 0&&(c=e.ref),e.key!==void 0&&(o=""+e.key),e)Cj.call(e,i)&&!Sj.hasOwnProperty(i)&&(r[i]=e[i]);var s=arguments.length-2;if(s===1)r.children=n;else if(1<s){for(var f=Array(s),v=0;v<s;v++)f[v]=arguments[v+2];r.children=f}if(t&&t.defaultProps)for(i in s=t.defaultProps,s)r[i]===void 0&&(r[i]=s[i]);return{$$typeof:DS,type:t,key:o,ref:c,props:r,_owner:sN.current}}function ene(t,e){return{$$typeof:DS,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function oN(t){return typeof t=="object"&&t!==null&&t.$$typeof===DS}function tne(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var VV=/\/+/g;function FI(t,e){return typeof t=="object"&&t!==null&&t.key!=null?tne(""+t.key):e.toString(36)}function HM(t,e,n,i,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var c=!1;if(t===null)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case DS:case Hte:c=!0}}if(c)return c=t,r=r(c),t=i===""?"."+FI(c,0):i,UV(r)?(n="",t!=null&&(n=t.replace(VV,"$&/")+"/"),HM(r,e,n,"",function(v){return v})):r!=null&&(oN(r)&&(r=ene(r,n+(!r.key||c&&c.key===r.key?"":(""+r.key).replace(VV,"$&/")+"/")+t)),e.push(r)),1;if(c=0,i=i===""?".":i+":",UV(t))for(var s=0;s<t.length;s++){o=t[s];var f=i+FI(o,s);c+=HM(o,e,n,f,r)}else if(f=Qte(t),typeof f=="function")for(t=f.call(t),s=0;!(o=t.next()).done;)o=o.value,f=i+FI(o,s++),c+=HM(o,e,n,f,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return c}function aE(t,e,n){if(t==null)return t;var i=[],r=0;return HM(t,i,"","",function(o){return e.call(n,o,r++)}),i}function nne(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ic={current:null},WM={transition:null},ine={ReactCurrentDispatcher:ic,ReactCurrentBatchConfig:WM,ReactCurrentOwner:sN};function Ej(){throw Error("act(...) is not supported in production builds of React.")}Jr.Children={map:aE,forEach:function(t,e,n){aE(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return aE(t,function(){e++}),e},toArray:function(t){return aE(t,function(e){return e})||[]},only:function(t){if(!oN(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Jr.Component=hw;Jr.Fragment=Wte;Jr.Profiler=$te;Jr.PureComponent=iN;Jr.StrictMode=jte;Jr.Suspense=Kte;Jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ine;Jr.act=Ej;Jr.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=_j({},t.props),r=t.key,o=t.ref,c=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,c=sN.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(f in e)Cj.call(e,f)&&!Sj.hasOwnProperty(f)&&(i[f]=e[f]===void 0&&s!==void 0?s[f]:e[f])}var f=arguments.length-2;if(f===1)i.children=n;else if(1<f){s=Array(f);for(var v=0;v<f;v++)s[v]=arguments[v+2];i.children=s}return{$$typeof:DS,type:t.type,key:r,ref:o,props:i,_owner:c}};Jr.createContext=function(t){return t={$$typeof:Zte,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:qte,_context:t},t.Consumer=t};Jr.createElement=bj;Jr.createFactory=function(t){var e=bj.bind(null,t);return e.type=t,e};Jr.createRef=function(){return{current:null}};Jr.forwardRef=function(t){return{$$typeof:Xte,render:t}};Jr.isValidElement=oN;Jr.lazy=function(t){return{$$typeof:Jte,_payload:{_status:-1,_result:t},_init:nne}};Jr.memo=function(t,e){return{$$typeof:Yte,type:t,compare:e===void 0?null:e}};Jr.startTransition=function(t){var e=WM.transition;WM.transition={};try{t()}finally{WM.transition=e}};Jr.unstable_act=Ej;Jr.useCallback=function(t,e){return ic.current.useCallback(t,e)};Jr.useContext=function(t){return ic.current.useContext(t)};Jr.useDebugValue=function(){};Jr.useDeferredValue=function(t){return ic.current.useDeferredValue(t)};Jr.useEffect=function(t,e){return ic.current.useEffect(t,e)};Jr.useId=function(){return ic.current.useId()};Jr.useImperativeHandle=function(t,e,n){return ic.current.useImperativeHandle(t,e,n)};Jr.useInsertionEffect=function(t,e){return ic.current.useInsertionEffect(t,e)};Jr.useLayoutEffect=function(t,e){return ic.current.useLayoutEffect(t,e)};Jr.useMemo=function(t,e){return ic.current.useMemo(t,e)};Jr.useReducer=function(t,e,n){return ic.current.useReducer(t,e,n)};Jr.useRef=function(t){return ic.current.useRef(t)};Jr.useState=function(t){return ic.current.useState(t)};Jr.useSyncExternalStore=function(t,e,n){return ic.current.useSyncExternalStore(t,e,n)};Jr.useTransition=function(){return ic.current.useTransition()};Jr.version="18.3.1";vj.exports=Jr;var Q=vj.exports;const kn=pv(Q),Mj=mj({__proto__:null,default:kn},[Q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rne=Q,sne=Symbol.for("react.element"),one=Symbol.for("react.fragment"),ane=Object.prototype.hasOwnProperty,lne=rne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cne={key:!0,ref:!0,__self:!0,__source:!0};function Rj(t,e,n){var i,r={},o=null,c=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(c=e.ref);for(i in e)ane.call(e,i)&&!cne.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:sne,type:t,key:o,ref:c,props:r,_owner:lne.current}}oA.Fragment=one;oA.jsx=Rj;oA.jsxs=Rj;gj.exports=oA;var re=gj.exports,Q2={},Tj={exports:{}},Su={},Aj={exports:{}},Pj={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Me,$e){var ut=Me.length;Me.push($e);e:for(;0<ut;){var Mt=ut-1>>>1,Gt=Me[Mt];if(0<r(Gt,$e))Me[Mt]=$e,Me[ut]=Gt,ut=Mt;else break e}}function n(Me){return Me.length===0?null:Me[0]}function i(Me){if(Me.length===0)return null;var $e=Me[0],ut=Me.pop();if(ut!==$e){Me[0]=ut;e:for(var Mt=0,Gt=Me.length,Xt=Gt>>>1;Mt<Xt;){var Qe=2*(Mt+1)-1,Ge=Me[Qe],He=Qe+1,De=Me[He];if(0>r(Ge,ut))He<Gt&&0>r(De,Ge)?(Me[Mt]=De,Me[He]=ut,Mt=He):(Me[Mt]=Ge,Me[Qe]=ut,Mt=Qe);else if(He<Gt&&0>r(De,ut))Me[Mt]=De,Me[He]=ut,Mt=He;else break e}}return $e}function r(Me,$e){var ut=Me.sortIndex-$e.sortIndex;return ut!==0?ut:Me.id-$e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,s=c.now();t.unstable_now=function(){return c.now()-s}}var f=[],v=[],w=1,C=null,M=3,F=!1,N=!1,z=!1,L=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(Me){for(var $e=n(v);$e!==null;){if($e.callback===null)i(v);else if($e.startTime<=Me)i(v),$e.sortIndex=$e.expirationTime,e(f,$e);else break;$e=n(v)}}function q(Me){if(z=!1,j(Me),!N)if(n(f)!==null)N=!0,qe(le);else{var $e=n(v);$e!==null&&ft(q,$e.startTime-Me)}}function le(Me,$e){N=!1,z&&(z=!1,P(pe),pe=-1),F=!0;var ut=M;try{for(j($e),C=n(f);C!==null&&(!(C.expirationTime>$e)||Me&&!Ee());){var Mt=C.callback;if(typeof Mt=="function"){C.callback=null,M=C.priorityLevel;var Gt=Mt(C.expirationTime<=$e);$e=t.unstable_now(),typeof Gt=="function"?C.callback=Gt:C===n(f)&&i(f),j($e)}else i(f);C=n(f)}if(C!==null)var Xt=!0;else{var Qe=n(v);Qe!==null&&ft(q,Qe.startTime-$e),Xt=!1}return Xt}finally{C=null,M=ut,F=!1}}var ce=!1,ae=null,pe=-1,fe=5,ue=-1;function Ee(){return!(t.unstable_now()-ue<fe)}function We(){if(ae!==null){var Me=t.unstable_now();ue=Me;var $e=!0;try{$e=ae(!0,Me)}finally{$e?rt():(ce=!1,ae=null)}}else ce=!1}var rt;if(typeof H=="function")rt=function(){H(We)};else if(typeof MessageChannel<"u"){var tt=new MessageChannel,Ye=tt.port2;tt.port1.onmessage=We,rt=function(){Ye.postMessage(null)}}else rt=function(){L(We,0)};function qe(Me){ae=Me,ce||(ce=!0,rt())}function ft(Me,$e){pe=L(function(){Me(t.unstable_now())},$e)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Me){Me.callback=null},t.unstable_continueExecution=function(){N||F||(N=!0,qe(le))},t.unstable_forceFrameRate=function(Me){0>Me||125<Me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fe=0<Me?Math.floor(1e3/Me):5},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_getFirstCallbackNode=function(){return n(f)},t.unstable_next=function(Me){switch(M){case 1:case 2:case 3:var $e=3;break;default:$e=M}var ut=M;M=$e;try{return Me()}finally{M=ut}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Me,$e){switch(Me){case 1:case 2:case 3:case 4:case 5:break;default:Me=3}var ut=M;M=Me;try{return $e()}finally{M=ut}},t.unstable_scheduleCallback=function(Me,$e,ut){var Mt=t.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Mt+ut:Mt):ut=Mt,Me){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=ut+Gt,Me={id:w++,callback:$e,priorityLevel:Me,startTime:ut,expirationTime:Gt,sortIndex:-1},ut>Mt?(Me.sortIndex=ut,e(v,Me),n(f)===null&&Me===n(v)&&(z?(P(pe),pe=-1):z=!0,ft(q,ut-Mt))):(Me.sortIndex=Gt,e(f,Me),N||F||(N=!0,qe(le))),Me},t.unstable_shouldYield=Ee,t.unstable_wrapCallback=function(Me){var $e=M;return function(){var ut=M;M=$e;try{return Me.apply(this,arguments)}finally{M=ut}}}})(Pj);Aj.exports=Pj;var une=Aj.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hne=Q,wu=une;function ei(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ij=new Set,k1={};function I_(t,e){qx(t,e),qx(t+"Capture",e)}function qx(t,e){for(k1[t]=e,t=0;t<e.length;t++)Ij.add(e[t])}var qp=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eF=Object.prototype.hasOwnProperty,dne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,GV={},HV={};function fne(t){return eF.call(HV,t)?!0:eF.call(GV,t)?!1:dne.test(t)?HV[t]=!0:(GV[t]=!0,!1)}function pne(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function mne(t,e,n,i){if(e===null||typeof e>"u"||pne(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function rc(t,e,n,i,r,o,c){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=c}var tl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){tl[t]=new rc(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];tl[e]=new rc(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){tl[t]=new rc(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){tl[t]=new rc(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){tl[t]=new rc(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){tl[t]=new rc(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){tl[t]=new rc(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){tl[t]=new rc(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){tl[t]=new rc(t,5,!1,t.toLowerCase(),null,!1,!1)});var aN=/[\-:]([a-z])/g;function lN(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(aN,lN);tl[e]=new rc(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(aN,lN);tl[e]=new rc(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(aN,lN);tl[e]=new rc(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){tl[t]=new rc(t,1,!1,t.toLowerCase(),null,!1,!1)});tl.xlinkHref=new rc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){tl[t]=new rc(t,1,!1,t.toLowerCase(),null,!0,!0)});function cN(t,e,n,i){var r=tl.hasOwnProperty(e)?tl[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(mne(e,n,r,i)&&(n=null),i||r===null?fne(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var am=hne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lE=Symbol.for("react.element"),ex=Symbol.for("react.portal"),tx=Symbol.for("react.fragment"),uN=Symbol.for("react.strict_mode"),tF=Symbol.for("react.profiler"),Dj=Symbol.for("react.provider"),Fj=Symbol.for("react.context"),hN=Symbol.for("react.forward_ref"),nF=Symbol.for("react.suspense"),iF=Symbol.for("react.suspense_list"),dN=Symbol.for("react.memo"),Mg=Symbol.for("react.lazy"),Lj=Symbol.for("react.offscreen"),WV=Symbol.iterator;function bC(t){return t===null||typeof t!="object"?null:(t=WV&&t[WV]||t["@@iterator"],typeof t=="function"?t:null)}var ko=Object.assign,LI;function e1(t){if(LI===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);LI=e&&e[1]||""}return`
`+LI+t}var OI=!1;function kI(t,e){if(!t||OI)return"";OI=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(v){var i=v}Reflect.construct(t,[],e)}else{try{e.call()}catch(v){i=v}t.call(e.prototype)}else{try{throw Error()}catch(v){i=v}t()}}catch(v){if(v&&i&&typeof v.stack=="string"){for(var r=v.stack.split(`
`),o=i.stack.split(`
`),c=r.length-1,s=o.length-1;1<=c&&0<=s&&r[c]!==o[s];)s--;for(;1<=c&&0<=s;c--,s--)if(r[c]!==o[s]){if(c!==1||s!==1)do if(c--,s--,0>s||r[c]!==o[s]){var f=`
`+r[c].replace(" at new "," at ");return t.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",t.displayName)),f}while(1<=c&&0<=s);break}}}finally{OI=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?e1(t):""}function gne(t){switch(t.tag){case 5:return e1(t.type);case 16:return e1("Lazy");case 13:return e1("Suspense");case 19:return e1("SuspenseList");case 0:case 2:case 15:return t=kI(t.type,!1),t;case 11:return t=kI(t.type.render,!1),t;case 1:return t=kI(t.type,!0),t;default:return""}}function rF(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case tx:return"Fragment";case ex:return"Portal";case tF:return"Profiler";case uN:return"StrictMode";case nF:return"Suspense";case iF:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Fj:return(t.displayName||"Context")+".Consumer";case Dj:return(t._context.displayName||"Context")+".Provider";case hN:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dN:return e=t.displayName||null,e!==null?e:rF(t.type)||"Memo";case Mg:e=t._payload,t=t._init;try{return rF(t(e))}catch{}}return null}function vne(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rF(e);case 8:return e===uN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function iv(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Oj(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yne(t){var e=Oj(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(c){i=""+c,o.call(this,c)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(c){i=""+c},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function cE(t){t._valueTracker||(t._valueTracker=yne(t))}function kj(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Oj(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function vR(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function sF(t,e){var n=e.checked;return ko({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jV(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=iv(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Nj(t,e){e=e.checked,e!=null&&cN(t,"checked",e,!1)}function oF(t,e){Nj(t,e);var n=iv(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?aF(t,e.type,n):e.hasOwnProperty("defaultValue")&&aF(t,e.type,iv(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function $V(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function aF(t,e,n){(e!=="number"||vR(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var t1=Array.isArray;function wx(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+iv(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function lF(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ei(91));return ko({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function qV(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ei(92));if(t1(n)){if(1<n.length)throw Error(ei(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:iv(n)}}function Bj(t,e){var n=iv(e.value),i=iv(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function ZV(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zj(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cF(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zj(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var uE,Uj=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(uE=uE||document.createElement("div"),uE.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=uE.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function N1(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var h1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_ne=["Webkit","ms","Moz","O"];Object.keys(h1).forEach(function(t){_ne.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),h1[e]=h1[t]})});function Vj(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||h1.hasOwnProperty(t)&&h1[t]?(""+e).trim():e+"px"}function Gj(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Vj(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var xne=ko({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uF(t,e){if(e){if(xne[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ei(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ei(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ei(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ei(62))}}function hF(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dF=null;function fN(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var fF=null,Cx=null,Sx=null;function XV(t){if(t=OS(t)){if(typeof fF!="function")throw Error(ei(280));var e=t.stateNode;e&&(e=hA(e),fF(t.stateNode,t.type,e))}}function Hj(t){Cx?Sx?Sx.push(t):Sx=[t]:Cx=t}function Wj(){if(Cx){var t=Cx,e=Sx;if(Sx=Cx=null,XV(t),e)for(t=0;t<e.length;t++)XV(e[t])}}function jj(t,e){return t(e)}function $j(){}var NI=!1;function qj(t,e,n){if(NI)return t(e,n);NI=!0;try{return jj(t,e,n)}finally{NI=!1,(Cx!==null||Sx!==null)&&($j(),Wj())}}function B1(t,e){var n=t.stateNode;if(n===null)return null;var i=hA(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ei(231,e,typeof n));return n}var pF=!1;if(qp)try{var EC={};Object.defineProperty(EC,"passive",{get:function(){pF=!0}}),window.addEventListener("test",EC,EC),window.removeEventListener("test",EC,EC)}catch{pF=!1}function wne(t,e,n,i,r,o,c,s,f){var v=Array.prototype.slice.call(arguments,3);try{e.apply(n,v)}catch(w){this.onError(w)}}var d1=!1,yR=null,_R=!1,mF=null,Cne={onError:function(t){d1=!0,yR=t}};function Sne(t,e,n,i,r,o,c,s,f){d1=!1,yR=null,wne.apply(Cne,arguments)}function bne(t,e,n,i,r,o,c,s,f){if(Sne.apply(this,arguments),d1){if(d1){var v=yR;d1=!1,yR=null}else throw Error(ei(198));_R||(_R=!0,mF=v)}}function D_(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Zj(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function KV(t){if(D_(t)!==t)throw Error(ei(188))}function Ene(t){var e=t.alternate;if(!e){if(e=D_(t),e===null)throw Error(ei(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return KV(r),t;if(o===i)return KV(r),e;o=o.sibling}throw Error(ei(188))}if(n.return!==i.return)n=r,i=o;else{for(var c=!1,s=r.child;s;){if(s===n){c=!0,n=r,i=o;break}if(s===i){c=!0,i=r,n=o;break}s=s.sibling}if(!c){for(s=o.child;s;){if(s===n){c=!0,n=o,i=r;break}if(s===i){c=!0,i=o,n=r;break}s=s.sibling}if(!c)throw Error(ei(189))}}if(n.alternate!==i)throw Error(ei(190))}if(n.tag!==3)throw Error(ei(188));return n.stateNode.current===n?t:e}function Xj(t){return t=Ene(t),t!==null?Kj(t):null}function Kj(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Kj(t);if(e!==null)return e;t=t.sibling}return null}var Yj=wu.unstable_scheduleCallback,YV=wu.unstable_cancelCallback,Mne=wu.unstable_shouldYield,Rne=wu.unstable_requestPaint,aa=wu.unstable_now,Tne=wu.unstable_getCurrentPriorityLevel,pN=wu.unstable_ImmediatePriority,Jj=wu.unstable_UserBlockingPriority,xR=wu.unstable_NormalPriority,Ane=wu.unstable_LowPriority,Qj=wu.unstable_IdlePriority,aA=null,_f=null;function Pne(t){if(_f&&typeof _f.onCommitFiberRoot=="function")try{_f.onCommitFiberRoot(aA,t,void 0,(t.current.flags&128)===128)}catch{}}var id=Math.clz32?Math.clz32:Fne,Ine=Math.log,Dne=Math.LN2;function Fne(t){return t>>>=0,t===0?32:31-(Ine(t)/Dne|0)|0}var hE=64,dE=4194304;function n1(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wR(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,o=t.pingedLanes,c=n&268435455;if(c!==0){var s=c&~r;s!==0?i=n1(s):(o&=c,o!==0&&(i=n1(o)))}else c=n&~r,c!==0?i=n1(c):o!==0&&(i=n1(o));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-id(e),r=1<<n,i|=t[n],e&=~r;return i}function Lne(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function One(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var c=31-id(o),s=1<<c,f=r[c];f===-1?(!(s&n)||s&i)&&(r[c]=Lne(s,e)):f<=e&&(t.expiredLanes|=s),o&=~s}}function gF(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function e8(){var t=hE;return hE<<=1,!(hE&4194240)&&(hE=64),t}function BI(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function FS(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-id(e),t[e]=n}function kne(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-id(n),o=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~o}}function mN(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-id(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var Bs=0;function t8(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var n8,gN,i8,r8,s8,vF=!1,fE=[],Hg=null,Wg=null,jg=null,z1=new Map,U1=new Map,Ag=[],Nne="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function JV(t,e){switch(t){case"focusin":case"focusout":Hg=null;break;case"dragenter":case"dragleave":Wg=null;break;case"mouseover":case"mouseout":jg=null;break;case"pointerover":case"pointerout":z1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":U1.delete(e.pointerId)}}function MC(t,e,n,i,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},e!==null&&(e=OS(e),e!==null&&gN(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Bne(t,e,n,i,r){switch(e){case"focusin":return Hg=MC(Hg,t,e,n,i,r),!0;case"dragenter":return Wg=MC(Wg,t,e,n,i,r),!0;case"mouseover":return jg=MC(jg,t,e,n,i,r),!0;case"pointerover":var o=r.pointerId;return z1.set(o,MC(z1.get(o)||null,t,e,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,U1.set(o,MC(U1.get(o)||null,t,e,n,i,r)),!0}return!1}function o8(t){var e=Ly(t.target);if(e!==null){var n=D_(e);if(n!==null){if(e=n.tag,e===13){if(e=Zj(n),e!==null){t.blockedOn=e,s8(t.priority,function(){i8(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jM(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=yF(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);dF=i,n.target.dispatchEvent(i),dF=null}else return e=OS(n),e!==null&&gN(e),t.blockedOn=n,!1;e.shift()}return!0}function QV(t,e,n){jM(t)&&n.delete(e)}function zne(){vF=!1,Hg!==null&&jM(Hg)&&(Hg=null),Wg!==null&&jM(Wg)&&(Wg=null),jg!==null&&jM(jg)&&(jg=null),z1.forEach(QV),U1.forEach(QV)}function RC(t,e){t.blockedOn===e&&(t.blockedOn=null,vF||(vF=!0,wu.unstable_scheduleCallback(wu.unstable_NormalPriority,zne)))}function V1(t){function e(r){return RC(r,t)}if(0<fE.length){RC(fE[0],t);for(var n=1;n<fE.length;n++){var i=fE[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Hg!==null&&RC(Hg,t),Wg!==null&&RC(Wg,t),jg!==null&&RC(jg,t),z1.forEach(e),U1.forEach(e),n=0;n<Ag.length;n++)i=Ag[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ag.length&&(n=Ag[0],n.blockedOn===null);)o8(n),n.blockedOn===null&&Ag.shift()}var bx=am.ReactCurrentBatchConfig,CR=!0;function Une(t,e,n,i){var r=Bs,o=bx.transition;bx.transition=null;try{Bs=1,vN(t,e,n,i)}finally{Bs=r,bx.transition=o}}function Vne(t,e,n,i){var r=Bs,o=bx.transition;bx.transition=null;try{Bs=4,vN(t,e,n,i)}finally{Bs=r,bx.transition=o}}function vN(t,e,n,i){if(CR){var r=yF(t,e,n,i);if(r===null)ZI(t,e,i,SR,n),JV(t,i);else if(Bne(r,t,e,n,i))i.stopPropagation();else if(JV(t,i),e&4&&-1<Nne.indexOf(t)){for(;r!==null;){var o=OS(r);if(o!==null&&n8(o),o=yF(t,e,n,i),o===null&&ZI(t,e,i,SR,n),o===r)break;r=o}r!==null&&i.stopPropagation()}else ZI(t,e,i,null,n)}}var SR=null;function yF(t,e,n,i){if(SR=null,t=fN(i),t=Ly(t),t!==null)if(e=D_(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Zj(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return SR=t,null}function a8(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Tne()){case pN:return 1;case Jj:return 4;case xR:case Ane:return 16;case Qj:return 536870912;default:return 16}default:return 16}}var Ug=null,yN=null,$M=null;function l8(){if($M)return $M;var t,e=yN,n=e.length,i,r="value"in Ug?Ug.value:Ug.textContent,o=r.length;for(t=0;t<n&&e[t]===r[t];t++);var c=n-t;for(i=1;i<=c&&e[n-i]===r[o-i];i++);return $M=r.slice(t,1<i?1-i:void 0)}function qM(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function pE(){return!0}function eG(){return!1}function bu(t){function e(n,i,r,o,c){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=o,this.target=c,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?pE:eG,this.isPropagationStopped=eG,this}return ko(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=pE)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=pE)},persist:function(){},isPersistent:pE}),e}var dw={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_N=bu(dw),LS=ko({},dw,{view:0,detail:0}),Gne=bu(LS),zI,UI,TC,lA=ko({},LS,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xN,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==TC&&(TC&&t.type==="mousemove"?(zI=t.screenX-TC.screenX,UI=t.screenY-TC.screenY):UI=zI=0,TC=t),zI)},movementY:function(t){return"movementY"in t?t.movementY:UI}}),tG=bu(lA),Hne=ko({},lA,{dataTransfer:0}),Wne=bu(Hne),jne=ko({},LS,{relatedTarget:0}),VI=bu(jne),$ne=ko({},dw,{animationName:0,elapsedTime:0,pseudoElement:0}),qne=bu($ne),Zne=ko({},dw,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Xne=bu(Zne),Kne=ko({},dw,{data:0}),nG=bu(Kne),Yne={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jne={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qne={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eie(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Qne[t])?!!e[t]:!1}function xN(){return eie}var tie=ko({},LS,{key:function(t){if(t.key){var e=Yne[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=qM(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Jne[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xN,charCode:function(t){return t.type==="keypress"?qM(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qM(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),nie=bu(tie),iie=ko({},lA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iG=bu(iie),rie=ko({},LS,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xN}),sie=bu(rie),oie=ko({},dw,{propertyName:0,elapsedTime:0,pseudoElement:0}),aie=bu(oie),lie=ko({},lA,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),cie=bu(lie),uie=[9,13,27,32],wN=qp&&"CompositionEvent"in window,f1=null;qp&&"documentMode"in document&&(f1=document.documentMode);var hie=qp&&"TextEvent"in window&&!f1,c8=qp&&(!wN||f1&&8<f1&&11>=f1),rG=" ",sG=!1;function u8(t,e){switch(t){case"keyup":return uie.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function h8(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nx=!1;function die(t,e){switch(t){case"compositionend":return h8(e);case"keypress":return e.which!==32?null:(sG=!0,rG);case"textInput":return t=e.data,t===rG&&sG?null:t;default:return null}}function fie(t,e){if(nx)return t==="compositionend"||!wN&&u8(t,e)?(t=l8(),$M=yN=Ug=null,nx=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return c8&&e.locale!=="ko"?null:e.data;default:return null}}var pie={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oG(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!pie[t.type]:e==="textarea"}function d8(t,e,n,i){Hj(i),e=bR(e,"onChange"),0<e.length&&(n=new _N("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var p1=null,G1=null;function mie(t){S8(t,0)}function cA(t){var e=sx(t);if(kj(e))return t}function gie(t,e){if(t==="change")return e}var f8=!1;if(qp){var GI;if(qp){var HI="oninput"in document;if(!HI){var aG=document.createElement("div");aG.setAttribute("oninput","return;"),HI=typeof aG.oninput=="function"}GI=HI}else GI=!1;f8=GI&&(!document.documentMode||9<document.documentMode)}function lG(){p1&&(p1.detachEvent("onpropertychange",p8),G1=p1=null)}function p8(t){if(t.propertyName==="value"&&cA(G1)){var e=[];d8(e,G1,t,fN(t)),qj(mie,e)}}function vie(t,e,n){t==="focusin"?(lG(),p1=e,G1=n,p1.attachEvent("onpropertychange",p8)):t==="focusout"&&lG()}function yie(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cA(G1)}function _ie(t,e){if(t==="click")return cA(e)}function xie(t,e){if(t==="input"||t==="change")return cA(e)}function wie(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ad=typeof Object.is=="function"?Object.is:wie;function H1(t,e){if(ad(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!eF.call(e,r)||!ad(t[r],e[r]))return!1}return!0}function cG(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function uG(t,e){var n=cG(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cG(n)}}function m8(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?m8(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function g8(){for(var t=window,e=vR();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=vR(t.document)}return e}function CN(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Cie(t){var e=g8(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&m8(n.ownerDocument.documentElement,n)){if(i!==null&&CN(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=i.end===void 0?o:Math.min(i.end,r),!t.extend&&o>i&&(r=i,i=o,o=r),r=uG(n,o);var c=uG(n,i);r&&c&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==c.node||t.focusOffset!==c.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>i?(t.addRange(e),t.extend(c.node,c.offset)):(e.setEnd(c.node,c.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Sie=qp&&"documentMode"in document&&11>=document.documentMode,ix=null,_F=null,m1=null,xF=!1;function hG(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;xF||ix==null||ix!==vR(i)||(i=ix,"selectionStart"in i&&CN(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),m1&&H1(m1,i)||(m1=i,i=bR(_F,"onSelect"),0<i.length&&(e=new _N("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=ix)))}function mE(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var rx={animationend:mE("Animation","AnimationEnd"),animationiteration:mE("Animation","AnimationIteration"),animationstart:mE("Animation","AnimationStart"),transitionend:mE("Transition","TransitionEnd")},WI={},v8={};qp&&(v8=document.createElement("div").style,"AnimationEvent"in window||(delete rx.animationend.animation,delete rx.animationiteration.animation,delete rx.animationstart.animation),"TransitionEvent"in window||delete rx.transitionend.transition);function uA(t){if(WI[t])return WI[t];if(!rx[t])return t;var e=rx[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in v8)return WI[t]=e[n];return t}var y8=uA("animationend"),_8=uA("animationiteration"),x8=uA("animationstart"),w8=uA("transitionend"),C8=new Map,dG="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mv(t,e){C8.set(t,e),I_(e,[t])}for(var jI=0;jI<dG.length;jI++){var $I=dG[jI],bie=$I.toLowerCase(),Eie=$I[0].toUpperCase()+$I.slice(1);mv(bie,"on"+Eie)}mv(y8,"onAnimationEnd");mv(_8,"onAnimationIteration");mv(x8,"onAnimationStart");mv("dblclick","onDoubleClick");mv("focusin","onFocus");mv("focusout","onBlur");mv(w8,"onTransitionEnd");qx("onMouseEnter",["mouseout","mouseover"]);qx("onMouseLeave",["mouseout","mouseover"]);qx("onPointerEnter",["pointerout","pointerover"]);qx("onPointerLeave",["pointerout","pointerover"]);I_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));I_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));I_("onBeforeInput",["compositionend","keypress","textInput","paste"]);I_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));I_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));I_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var i1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mie=new Set("cancel close invalid load scroll toggle".split(" ").concat(i1));function fG(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,bne(i,e,void 0,t),t.currentTarget=null}function S8(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var o=void 0;if(e)for(var c=i.length-1;0<=c;c--){var s=i[c],f=s.instance,v=s.currentTarget;if(s=s.listener,f!==o&&r.isPropagationStopped())break e;fG(r,s,v),o=f}else for(c=0;c<i.length;c++){if(s=i[c],f=s.instance,v=s.currentTarget,s=s.listener,f!==o&&r.isPropagationStopped())break e;fG(r,s,v),o=f}}}if(_R)throw t=mF,_R=!1,mF=null,t}function ao(t,e){var n=e[EF];n===void 0&&(n=e[EF]=new Set);var i=t+"__bubble";n.has(i)||(b8(e,t,2,!1),n.add(i))}function qI(t,e,n){var i=0;e&&(i|=4),b8(n,t,i,e)}var gE="_reactListening"+Math.random().toString(36).slice(2);function W1(t){if(!t[gE]){t[gE]=!0,Ij.forEach(function(n){n!=="selectionchange"&&(Mie.has(n)||qI(n,!1,t),qI(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[gE]||(e[gE]=!0,qI("selectionchange",!1,e))}}function b8(t,e,n,i){switch(a8(e)){case 1:var r=Une;break;case 4:r=Vne;break;default:r=vN}n=r.bind(null,e,n,t),r=void 0,!pF||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function ZI(t,e,n,i,r){var o=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var c=i.tag;if(c===3||c===4){var s=i.stateNode.containerInfo;if(s===r||s.nodeType===8&&s.parentNode===r)break;if(c===4)for(c=i.return;c!==null;){var f=c.tag;if((f===3||f===4)&&(f=c.stateNode.containerInfo,f===r||f.nodeType===8&&f.parentNode===r))return;c=c.return}for(;s!==null;){if(c=Ly(s),c===null)return;if(f=c.tag,f===5||f===6){i=o=c;continue e}s=s.parentNode}}i=i.return}qj(function(){var v=o,w=fN(n),C=[];e:{var M=C8.get(t);if(M!==void 0){var F=_N,N=t;switch(t){case"keypress":if(qM(n)===0)break e;case"keydown":case"keyup":F=nie;break;case"focusin":N="focus",F=VI;break;case"focusout":N="blur",F=VI;break;case"beforeblur":case"afterblur":F=VI;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":F=tG;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":F=Wne;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":F=sie;break;case y8:case _8:case x8:F=qne;break;case w8:F=aie;break;case"scroll":F=Gne;break;case"wheel":F=cie;break;case"copy":case"cut":case"paste":F=Xne;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":F=iG}var z=(e&4)!==0,L=!z&&t==="scroll",P=z?M!==null?M+"Capture":null:M;z=[];for(var H=v,j;H!==null;){j=H;var q=j.stateNode;if(j.tag===5&&q!==null&&(j=q,P!==null&&(q=B1(H,P),q!=null&&z.push(j1(H,q,j)))),L)break;H=H.return}0<z.length&&(M=new F(M,N,null,n,w),C.push({event:M,listeners:z}))}}if(!(e&7)){e:{if(M=t==="mouseover"||t==="pointerover",F=t==="mouseout"||t==="pointerout",M&&n!==dF&&(N=n.relatedTarget||n.fromElement)&&(Ly(N)||N[Zp]))break e;if((F||M)&&(M=w.window===w?w:(M=w.ownerDocument)?M.defaultView||M.parentWindow:window,F?(N=n.relatedTarget||n.toElement,F=v,N=N?Ly(N):null,N!==null&&(L=D_(N),N!==L||N.tag!==5&&N.tag!==6)&&(N=null)):(F=null,N=v),F!==N)){if(z=tG,q="onMouseLeave",P="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(z=iG,q="onPointerLeave",P="onPointerEnter",H="pointer"),L=F==null?M:sx(F),j=N==null?M:sx(N),M=new z(q,H+"leave",F,n,w),M.target=L,M.relatedTarget=j,q=null,Ly(w)===v&&(z=new z(P,H+"enter",N,n,w),z.target=j,z.relatedTarget=L,q=z),L=q,F&&N)t:{for(z=F,P=N,H=0,j=z;j;j=S0(j))H++;for(j=0,q=P;q;q=S0(q))j++;for(;0<H-j;)z=S0(z),H--;for(;0<j-H;)P=S0(P),j--;for(;H--;){if(z===P||P!==null&&z===P.alternate)break t;z=S0(z),P=S0(P)}z=null}else z=null;F!==null&&pG(C,M,F,z,!1),N!==null&&L!==null&&pG(C,L,N,z,!0)}}e:{if(M=v?sx(v):window,F=M.nodeName&&M.nodeName.toLowerCase(),F==="select"||F==="input"&&M.type==="file")var le=gie;else if(oG(M))if(f8)le=xie;else{le=yie;var ce=vie}else(F=M.nodeName)&&F.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(le=_ie);if(le&&(le=le(t,v))){d8(C,le,n,w);break e}ce&&ce(t,M,v),t==="focusout"&&(ce=M._wrapperState)&&ce.controlled&&M.type==="number"&&aF(M,"number",M.value)}switch(ce=v?sx(v):window,t){case"focusin":(oG(ce)||ce.contentEditable==="true")&&(ix=ce,_F=v,m1=null);break;case"focusout":m1=_F=ix=null;break;case"mousedown":xF=!0;break;case"contextmenu":case"mouseup":case"dragend":xF=!1,hG(C,n,w);break;case"selectionchange":if(Sie)break;case"keydown":case"keyup":hG(C,n,w)}var ae;if(wN)e:{switch(t){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else nx?u8(t,n)&&(pe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(pe="onCompositionStart");pe&&(c8&&n.locale!=="ko"&&(nx||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&nx&&(ae=l8()):(Ug=w,yN="value"in Ug?Ug.value:Ug.textContent,nx=!0)),ce=bR(v,pe),0<ce.length&&(pe=new nG(pe,t,null,n,w),C.push({event:pe,listeners:ce}),ae?pe.data=ae:(ae=h8(n),ae!==null&&(pe.data=ae)))),(ae=hie?die(t,n):fie(t,n))&&(v=bR(v,"onBeforeInput"),0<v.length&&(w=new nG("onBeforeInput","beforeinput",null,n,w),C.push({event:w,listeners:v}),w.data=ae))}S8(C,e)})}function j1(t,e,n){return{instance:t,listener:e,currentTarget:n}}function bR(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=B1(t,n),o!=null&&i.unshift(j1(t,o,r)),o=B1(t,e),o!=null&&i.push(j1(t,o,r))),t=t.return}return i}function S0(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function pG(t,e,n,i,r){for(var o=e._reactName,c=[];n!==null&&n!==i;){var s=n,f=s.alternate,v=s.stateNode;if(f!==null&&f===i)break;s.tag===5&&v!==null&&(s=v,r?(f=B1(n,o),f!=null&&c.unshift(j1(n,f,s))):r||(f=B1(n,o),f!=null&&c.push(j1(n,f,s)))),n=n.return}c.length!==0&&t.push({event:e,listeners:c})}var Rie=/\r\n?/g,Tie=/\u0000|\uFFFD/g;function mG(t){return(typeof t=="string"?t:""+t).replace(Rie,`
`).replace(Tie,"")}function vE(t,e,n){if(e=mG(e),mG(t)!==e&&n)throw Error(ei(425))}function ER(){}var wF=null,CF=null;function SF(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bF=typeof setTimeout=="function"?setTimeout:void 0,Aie=typeof clearTimeout=="function"?clearTimeout:void 0,gG=typeof Promise=="function"?Promise:void 0,Pie=typeof queueMicrotask=="function"?queueMicrotask:typeof gG<"u"?function(t){return gG.resolve(null).then(t).catch(Iie)}:bF;function Iie(t){setTimeout(function(){throw t})}function XI(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),V1(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);V1(e)}function $g(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function vG(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var fw=Math.random().toString(36).slice(2),pf="__reactFiber$"+fw,$1="__reactProps$"+fw,Zp="__reactContainer$"+fw,EF="__reactEvents$"+fw,Die="__reactListeners$"+fw,Fie="__reactHandles$"+fw;function Ly(t){var e=t[pf];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Zp]||n[pf]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=vG(t);t!==null;){if(n=t[pf])return n;t=vG(t)}return e}t=n,n=t.parentNode}return null}function OS(t){return t=t[pf]||t[Zp],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function sx(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ei(33))}function hA(t){return t[$1]||null}var MF=[],ox=-1;function gv(t){return{current:t}}function ho(t){0>ox||(t.current=MF[ox],MF[ox]=null,ox--)}function Ys(t,e){ox++,MF[ox]=t.current,t.current=e}var rv={},bl=gv(rv),Nc=gv(!1),h_=rv;function Zx(t,e){var n=t.type.contextTypes;if(!n)return rv;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=e[o];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Bc(t){return t=t.childContextTypes,t!=null}function MR(){ho(Nc),ho(bl)}function yG(t,e,n){if(bl.current!==rv)throw Error(ei(168));Ys(bl,e),Ys(Nc,n)}function E8(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ei(108,vne(t)||"Unknown",r));return ko({},n,i)}function RR(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||rv,h_=bl.current,Ys(bl,t),Ys(Nc,Nc.current),!0}function _G(t,e,n){var i=t.stateNode;if(!i)throw Error(ei(169));n?(t=E8(t,e,h_),i.__reactInternalMemoizedMergedChildContext=t,ho(Nc),ho(bl),Ys(bl,t)):ho(Nc),Ys(Nc,n)}var Ip=null,dA=!1,KI=!1;function M8(t){Ip===null?Ip=[t]:Ip.push(t)}function Lie(t){dA=!0,M8(t)}function vv(){if(!KI&&Ip!==null){KI=!0;var t=0,e=Bs;try{var n=Ip;for(Bs=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Ip=null,dA=!1}catch(r){throw Ip!==null&&(Ip=Ip.slice(t+1)),Yj(pN,vv),r}finally{Bs=e,KI=!1}}return null}var ax=[],lx=0,TR=null,AR=0,ju=[],$u=0,d_=null,kp=1,Np="";function Ey(t,e){ax[lx++]=AR,ax[lx++]=TR,TR=t,AR=e}function R8(t,e,n){ju[$u++]=kp,ju[$u++]=Np,ju[$u++]=d_,d_=t;var i=kp;t=Np;var r=32-id(i)-1;i&=~(1<<r),n+=1;var o=32-id(e)+r;if(30<o){var c=r-r%5;o=(i&(1<<c)-1).toString(32),i>>=c,r-=c,kp=1<<32-id(e)+r|n<<r|i,Np=o+t}else kp=1<<o|n<<r|i,Np=t}function SN(t){t.return!==null&&(Ey(t,1),R8(t,1,0))}function bN(t){for(;t===TR;)TR=ax[--lx],ax[lx]=null,AR=ax[--lx],ax[lx]=null;for(;t===d_;)d_=ju[--$u],ju[$u]=null,Np=ju[--$u],ju[$u]=null,kp=ju[--$u],ju[$u]=null}var vu=null,mu=null,_o=!1,Yh=null;function T8(t,e){var n=Zu(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function xG(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vu=t,mu=$g(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vu=t,mu=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=d_!==null?{id:kp,overflow:Np}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zu(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,vu=t,mu=null,!0):!1;default:return!1}}function RF(t){return(t.mode&1)!==0&&(t.flags&128)===0}function TF(t){if(_o){var e=mu;if(e){var n=e;if(!xG(t,e)){if(RF(t))throw Error(ei(418));e=$g(n.nextSibling);var i=vu;e&&xG(t,e)?T8(i,n):(t.flags=t.flags&-4097|2,_o=!1,vu=t)}}else{if(RF(t))throw Error(ei(418));t.flags=t.flags&-4097|2,_o=!1,vu=t}}}function wG(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vu=t}function yE(t){if(t!==vu)return!1;if(!_o)return wG(t),_o=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!SF(t.type,t.memoizedProps)),e&&(e=mu)){if(RF(t))throw A8(),Error(ei(418));for(;e;)T8(t,e),e=$g(e.nextSibling)}if(wG(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ei(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){mu=$g(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}mu=null}}else mu=vu?$g(t.stateNode.nextSibling):null;return!0}function A8(){for(var t=mu;t;)t=$g(t.nextSibling)}function Xx(){mu=vu=null,_o=!1}function EN(t){Yh===null?Yh=[t]:Yh.push(t)}var Oie=am.ReactCurrentBatchConfig;function AC(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ei(309));var i=n.stateNode}if(!i)throw Error(ei(147,t));var r=i,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(c){var s=r.refs;c===null?delete s[o]:s[o]=c},e._stringRef=o,e)}if(typeof t!="string")throw Error(ei(284));if(!n._owner)throw Error(ei(290,t))}return t}function _E(t,e){throw t=Object.prototype.toString.call(e),Error(ei(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function CG(t){var e=t._init;return e(t._payload)}function P8(t){function e(P,H){if(t){var j=P.deletions;j===null?(P.deletions=[H],P.flags|=16):j.push(H)}}function n(P,H){if(!t)return null;for(;H!==null;)e(P,H),H=H.sibling;return null}function i(P,H){for(P=new Map;H!==null;)H.key!==null?P.set(H.key,H):P.set(H.index,H),H=H.sibling;return P}function r(P,H){return P=Kg(P,H),P.index=0,P.sibling=null,P}function o(P,H,j){return P.index=j,t?(j=P.alternate,j!==null?(j=j.index,j<H?(P.flags|=2,H):j):(P.flags|=2,H)):(P.flags|=1048576,H)}function c(P){return t&&P.alternate===null&&(P.flags|=2),P}function s(P,H,j,q){return H===null||H.tag!==6?(H=iD(j,P.mode,q),H.return=P,H):(H=r(H,j),H.return=P,H)}function f(P,H,j,q){var le=j.type;return le===tx?w(P,H,j.props.children,q,j.key):H!==null&&(H.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Mg&&CG(le)===H.type)?(q=r(H,j.props),q.ref=AC(P,H,j),q.return=P,q):(q=eR(j.type,j.key,j.props,null,P.mode,q),q.ref=AC(P,H,j),q.return=P,q)}function v(P,H,j,q){return H===null||H.tag!==4||H.stateNode.containerInfo!==j.containerInfo||H.stateNode.implementation!==j.implementation?(H=rD(j,P.mode,q),H.return=P,H):(H=r(H,j.children||[]),H.return=P,H)}function w(P,H,j,q,le){return H===null||H.tag!==7?(H=Jy(j,P.mode,q,le),H.return=P,H):(H=r(H,j),H.return=P,H)}function C(P,H,j){if(typeof H=="string"&&H!==""||typeof H=="number")return H=iD(""+H,P.mode,j),H.return=P,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case lE:return j=eR(H.type,H.key,H.props,null,P.mode,j),j.ref=AC(P,null,H),j.return=P,j;case ex:return H=rD(H,P.mode,j),H.return=P,H;case Mg:var q=H._init;return C(P,q(H._payload),j)}if(t1(H)||bC(H))return H=Jy(H,P.mode,j,null),H.return=P,H;_E(P,H)}return null}function M(P,H,j,q){var le=H!==null?H.key:null;if(typeof j=="string"&&j!==""||typeof j=="number")return le!==null?null:s(P,H,""+j,q);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case lE:return j.key===le?f(P,H,j,q):null;case ex:return j.key===le?v(P,H,j,q):null;case Mg:return le=j._init,M(P,H,le(j._payload),q)}if(t1(j)||bC(j))return le!==null?null:w(P,H,j,q,null);_E(P,j)}return null}function F(P,H,j,q,le){if(typeof q=="string"&&q!==""||typeof q=="number")return P=P.get(j)||null,s(H,P,""+q,le);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case lE:return P=P.get(q.key===null?j:q.key)||null,f(H,P,q,le);case ex:return P=P.get(q.key===null?j:q.key)||null,v(H,P,q,le);case Mg:var ce=q._init;return F(P,H,j,ce(q._payload),le)}if(t1(q)||bC(q))return P=P.get(j)||null,w(H,P,q,le,null);_E(H,q)}return null}function N(P,H,j,q){for(var le=null,ce=null,ae=H,pe=H=0,fe=null;ae!==null&&pe<j.length;pe++){ae.index>pe?(fe=ae,ae=null):fe=ae.sibling;var ue=M(P,ae,j[pe],q);if(ue===null){ae===null&&(ae=fe);break}t&&ae&&ue.alternate===null&&e(P,ae),H=o(ue,H,pe),ce===null?le=ue:ce.sibling=ue,ce=ue,ae=fe}if(pe===j.length)return n(P,ae),_o&&Ey(P,pe),le;if(ae===null){for(;pe<j.length;pe++)ae=C(P,j[pe],q),ae!==null&&(H=o(ae,H,pe),ce===null?le=ae:ce.sibling=ae,ce=ae);return _o&&Ey(P,pe),le}for(ae=i(P,ae);pe<j.length;pe++)fe=F(ae,P,pe,j[pe],q),fe!==null&&(t&&fe.alternate!==null&&ae.delete(fe.key===null?pe:fe.key),H=o(fe,H,pe),ce===null?le=fe:ce.sibling=fe,ce=fe);return t&&ae.forEach(function(Ee){return e(P,Ee)}),_o&&Ey(P,pe),le}function z(P,H,j,q){var le=bC(j);if(typeof le!="function")throw Error(ei(150));if(j=le.call(j),j==null)throw Error(ei(151));for(var ce=le=null,ae=H,pe=H=0,fe=null,ue=j.next();ae!==null&&!ue.done;pe++,ue=j.next()){ae.index>pe?(fe=ae,ae=null):fe=ae.sibling;var Ee=M(P,ae,ue.value,q);if(Ee===null){ae===null&&(ae=fe);break}t&&ae&&Ee.alternate===null&&e(P,ae),H=o(Ee,H,pe),ce===null?le=Ee:ce.sibling=Ee,ce=Ee,ae=fe}if(ue.done)return n(P,ae),_o&&Ey(P,pe),le;if(ae===null){for(;!ue.done;pe++,ue=j.next())ue=C(P,ue.value,q),ue!==null&&(H=o(ue,H,pe),ce===null?le=ue:ce.sibling=ue,ce=ue);return _o&&Ey(P,pe),le}for(ae=i(P,ae);!ue.done;pe++,ue=j.next())ue=F(ae,P,pe,ue.value,q),ue!==null&&(t&&ue.alternate!==null&&ae.delete(ue.key===null?pe:ue.key),H=o(ue,H,pe),ce===null?le=ue:ce.sibling=ue,ce=ue);return t&&ae.forEach(function(We){return e(P,We)}),_o&&Ey(P,pe),le}function L(P,H,j,q){if(typeof j=="object"&&j!==null&&j.type===tx&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case lE:e:{for(var le=j.key,ce=H;ce!==null;){if(ce.key===le){if(le=j.type,le===tx){if(ce.tag===7){n(P,ce.sibling),H=r(ce,j.props.children),H.return=P,P=H;break e}}else if(ce.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Mg&&CG(le)===ce.type){n(P,ce.sibling),H=r(ce,j.props),H.ref=AC(P,ce,j),H.return=P,P=H;break e}n(P,ce);break}else e(P,ce);ce=ce.sibling}j.type===tx?(H=Jy(j.props.children,P.mode,q,j.key),H.return=P,P=H):(q=eR(j.type,j.key,j.props,null,P.mode,q),q.ref=AC(P,H,j),q.return=P,P=q)}return c(P);case ex:e:{for(ce=j.key;H!==null;){if(H.key===ce)if(H.tag===4&&H.stateNode.containerInfo===j.containerInfo&&H.stateNode.implementation===j.implementation){n(P,H.sibling),H=r(H,j.children||[]),H.return=P,P=H;break e}else{n(P,H);break}else e(P,H);H=H.sibling}H=rD(j,P.mode,q),H.return=P,P=H}return c(P);case Mg:return ce=j._init,L(P,H,ce(j._payload),q)}if(t1(j))return N(P,H,j,q);if(bC(j))return z(P,H,j,q);_E(P,j)}return typeof j=="string"&&j!==""||typeof j=="number"?(j=""+j,H!==null&&H.tag===6?(n(P,H.sibling),H=r(H,j),H.return=P,P=H):(n(P,H),H=iD(j,P.mode,q),H.return=P,P=H),c(P)):n(P,H)}return L}var Kx=P8(!0),I8=P8(!1),PR=gv(null),IR=null,cx=null,MN=null;function RN(){MN=cx=IR=null}function TN(t){var e=PR.current;ho(PR),t._currentValue=e}function AF(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Ex(t,e){IR=t,MN=cx=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Lc=!0),t.firstContext=null)}function th(t){var e=t._currentValue;if(MN!==t)if(t={context:t,memoizedValue:e,next:null},cx===null){if(IR===null)throw Error(ei(308));cx=t,IR.dependencies={lanes:0,firstContext:t}}else cx=cx.next=t;return e}var Oy=null;function AN(t){Oy===null?Oy=[t]:Oy.push(t)}function D8(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,AN(e)):(n.next=r.next,r.next=n),e.interleaved=n,Xp(t,i)}function Xp(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Rg=!1;function PN(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F8(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function zp(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function qg(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ws&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Xp(t,n)}return r=i.interleaved,r===null?(e.next=e,AN(i)):(e.next=r.next,r.next=e),i.interleaved=e,Xp(t,n)}function ZM(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,mN(t,n)}}function SG(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var c={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=c:o=o.next=c,n=n.next}while(n!==null);o===null?r=o=e:o=o.next=e}else r=o=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function DR(t,e,n,i){var r=t.updateQueue;Rg=!1;var o=r.firstBaseUpdate,c=r.lastBaseUpdate,s=r.shared.pending;if(s!==null){r.shared.pending=null;var f=s,v=f.next;f.next=null,c===null?o=v:c.next=v,c=f;var w=t.alternate;w!==null&&(w=w.updateQueue,s=w.lastBaseUpdate,s!==c&&(s===null?w.firstBaseUpdate=v:s.next=v,w.lastBaseUpdate=f))}if(o!==null){var C=r.baseState;c=0,w=v=f=null,s=o;do{var M=s.lane,F=s.eventTime;if((i&M)===M){w!==null&&(w=w.next={eventTime:F,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var N=t,z=s;switch(M=e,F=n,z.tag){case 1:if(N=z.payload,typeof N=="function"){C=N.call(F,C,M);break e}C=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=z.payload,M=typeof N=="function"?N.call(F,C,M):N,M==null)break e;C=ko({},C,M);break e;case 2:Rg=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,M=r.effects,M===null?r.effects=[s]:M.push(s))}else F={eventTime:F,lane:M,tag:s.tag,payload:s.payload,callback:s.callback,next:null},w===null?(v=w=F,f=C):w=w.next=F,c|=M;if(s=s.next,s===null){if(s=r.shared.pending,s===null)break;M=s,s=M.next,M.next=null,r.lastBaseUpdate=M,r.shared.pending=null}}while(!0);if(w===null&&(f=C),r.baseState=f,r.firstBaseUpdate=v,r.lastBaseUpdate=w,e=r.shared.interleaved,e!==null){r=e;do c|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);p_|=c,t.lanes=c,t.memoizedState=C}}function bG(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(ei(191,r));r.call(i)}}}var kS={},xf=gv(kS),q1=gv(kS),Z1=gv(kS);function ky(t){if(t===kS)throw Error(ei(174));return t}function IN(t,e){switch(Ys(Z1,e),Ys(q1,t),Ys(xf,kS),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cF(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=cF(e,t)}ho(xf),Ys(xf,e)}function Yx(){ho(xf),ho(q1),ho(Z1)}function L8(t){ky(Z1.current);var e=ky(xf.current),n=cF(e,t.type);e!==n&&(Ys(q1,t),Ys(xf,n))}function DN(t){q1.current===t&&(ho(xf),ho(q1))}var Po=gv(0);function FR(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var YI=[];function FN(){for(var t=0;t<YI.length;t++)YI[t]._workInProgressVersionPrimary=null;YI.length=0}var XM=am.ReactCurrentDispatcher,JI=am.ReactCurrentBatchConfig,f_=0,Lo=null,Sa=null,za=null,LR=!1,g1=!1,X1=0,kie=0;function dl(){throw Error(ei(321))}function LN(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ad(t[n],e[n]))return!1;return!0}function ON(t,e,n,i,r,o){if(f_=o,Lo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,XM.current=t===null||t.memoizedState===null?Uie:Vie,t=n(i,r),g1){o=0;do{if(g1=!1,X1=0,25<=o)throw Error(ei(301));o+=1,za=Sa=null,e.updateQueue=null,XM.current=Gie,t=n(i,r)}while(g1)}if(XM.current=OR,e=Sa!==null&&Sa.next!==null,f_=0,za=Sa=Lo=null,LR=!1,e)throw Error(ei(300));return t}function kN(){var t=X1!==0;return X1=0,t}function cf(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return za===null?Lo.memoizedState=za=t:za=za.next=t,za}function nh(){if(Sa===null){var t=Lo.alternate;t=t!==null?t.memoizedState:null}else t=Sa.next;var e=za===null?Lo.memoizedState:za.next;if(e!==null)za=e,Sa=t;else{if(t===null)throw Error(ei(310));Sa=t,t={memoizedState:Sa.memoizedState,baseState:Sa.baseState,baseQueue:Sa.baseQueue,queue:Sa.queue,next:null},za===null?Lo.memoizedState=za=t:za=za.next=t}return za}function K1(t,e){return typeof e=="function"?e(t):e}function QI(t){var e=nh(),n=e.queue;if(n===null)throw Error(ei(311));n.lastRenderedReducer=t;var i=Sa,r=i.baseQueue,o=n.pending;if(o!==null){if(r!==null){var c=r.next;r.next=o.next,o.next=c}i.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,i=i.baseState;var s=c=null,f=null,v=o;do{var w=v.lane;if((f_&w)===w)f!==null&&(f=f.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),i=v.hasEagerState?v.eagerState:t(i,v.action);else{var C={lane:w,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};f===null?(s=f=C,c=i):f=f.next=C,Lo.lanes|=w,p_|=w}v=v.next}while(v!==null&&v!==o);f===null?c=i:f.next=s,ad(i,e.memoizedState)||(Lc=!0),e.memoizedState=i,e.baseState=c,e.baseQueue=f,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do o=r.lane,Lo.lanes|=o,p_|=o,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function eD(t){var e=nh(),n=e.queue;if(n===null)throw Error(ei(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(r!==null){n.pending=null;var c=r=r.next;do o=t(o,c.action),c=c.next;while(c!==r);ad(o,e.memoizedState)||(Lc=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function O8(){}function k8(t,e){var n=Lo,i=nh(),r=e(),o=!ad(i.memoizedState,r);if(o&&(i.memoizedState=r,Lc=!0),i=i.queue,NN(z8.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||za!==null&&za.memoizedState.tag&1){if(n.flags|=2048,Y1(9,B8.bind(null,n,i,r,e),void 0,null),Ga===null)throw Error(ei(349));f_&30||N8(n,e,r)}return r}function N8(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Lo.updateQueue,e===null?(e={lastEffect:null,stores:null},Lo.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function B8(t,e,n,i){e.value=n,e.getSnapshot=i,U8(e)&&V8(t)}function z8(t,e,n){return n(function(){U8(e)&&V8(t)})}function U8(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ad(t,n)}catch{return!0}}function V8(t){var e=Xp(t,1);e!==null&&rd(e,t,1,-1)}function EG(t){var e=cf();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:K1,lastRenderedState:t},e.queue=t,t=t.dispatch=zie.bind(null,Lo,t),[e.memoizedState,t]}function Y1(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Lo.updateQueue,e===null?(e={lastEffect:null,stores:null},Lo.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function G8(){return nh().memoizedState}function KM(t,e,n,i){var r=cf();Lo.flags|=t,r.memoizedState=Y1(1|e,n,void 0,i===void 0?null:i)}function fA(t,e,n,i){var r=nh();i=i===void 0?null:i;var o=void 0;if(Sa!==null){var c=Sa.memoizedState;if(o=c.destroy,i!==null&&LN(i,c.deps)){r.memoizedState=Y1(e,n,o,i);return}}Lo.flags|=t,r.memoizedState=Y1(1|e,n,o,i)}function MG(t,e){return KM(8390656,8,t,e)}function NN(t,e){return fA(2048,8,t,e)}function H8(t,e){return fA(4,2,t,e)}function W8(t,e){return fA(4,4,t,e)}function j8(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function $8(t,e,n){return n=n!=null?n.concat([t]):null,fA(4,4,j8.bind(null,e,t),n)}function BN(){}function q8(t,e){var n=nh();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&LN(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Z8(t,e){var n=nh();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&LN(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function X8(t,e,n){return f_&21?(ad(n,e)||(n=e8(),Lo.lanes|=n,p_|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Lc=!0),t.memoizedState=n)}function Nie(t,e){var n=Bs;Bs=n!==0&&4>n?n:4,t(!0);var i=JI.transition;JI.transition={};try{t(!1),e()}finally{Bs=n,JI.transition=i}}function K8(){return nh().memoizedState}function Bie(t,e,n){var i=Xg(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Y8(t))J8(e,n);else if(n=D8(t,e,n,i),n!==null){var r=Yl();rd(n,t,i,r),Q8(n,e,i)}}function zie(t,e,n){var i=Xg(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Y8(t))J8(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var c=e.lastRenderedState,s=o(c,n);if(r.hasEagerState=!0,r.eagerState=s,ad(s,c)){var f=e.interleaved;f===null?(r.next=r,AN(e)):(r.next=f.next,f.next=r),e.interleaved=r;return}}catch{}finally{}n=D8(t,e,r,i),n!==null&&(r=Yl(),rd(n,t,i,r),Q8(n,e,i))}}function Y8(t){var e=t.alternate;return t===Lo||e!==null&&e===Lo}function J8(t,e){g1=LR=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Q8(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,mN(t,n)}}var OR={readContext:th,useCallback:dl,useContext:dl,useEffect:dl,useImperativeHandle:dl,useInsertionEffect:dl,useLayoutEffect:dl,useMemo:dl,useReducer:dl,useRef:dl,useState:dl,useDebugValue:dl,useDeferredValue:dl,useTransition:dl,useMutableSource:dl,useSyncExternalStore:dl,useId:dl,unstable_isNewReconciler:!1},Uie={readContext:th,useCallback:function(t,e){return cf().memoizedState=[t,e===void 0?null:e],t},useContext:th,useEffect:MG,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,KM(4194308,4,j8.bind(null,e,t),n)},useLayoutEffect:function(t,e){return KM(4194308,4,t,e)},useInsertionEffect:function(t,e){return KM(4,2,t,e)},useMemo:function(t,e){var n=cf();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=cf();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Bie.bind(null,Lo,t),[i.memoizedState,t]},useRef:function(t){var e=cf();return t={current:t},e.memoizedState=t},useState:EG,useDebugValue:BN,useDeferredValue:function(t){return cf().memoizedState=t},useTransition:function(){var t=EG(!1),e=t[0];return t=Nie.bind(null,t[1]),cf().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Lo,r=cf();if(_o){if(n===void 0)throw Error(ei(407));n=n()}else{if(n=e(),Ga===null)throw Error(ei(349));f_&30||N8(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,MG(z8.bind(null,i,o,t),[t]),i.flags|=2048,Y1(9,B8.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=cf(),e=Ga.identifierPrefix;if(_o){var n=Np,i=kp;n=(i&~(1<<32-id(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=X1++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kie++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Vie={readContext:th,useCallback:q8,useContext:th,useEffect:NN,useImperativeHandle:$8,useInsertionEffect:H8,useLayoutEffect:W8,useMemo:Z8,useReducer:QI,useRef:G8,useState:function(){return QI(K1)},useDebugValue:BN,useDeferredValue:function(t){var e=nh();return X8(e,Sa.memoizedState,t)},useTransition:function(){var t=QI(K1)[0],e=nh().memoizedState;return[t,e]},useMutableSource:O8,useSyncExternalStore:k8,useId:K8,unstable_isNewReconciler:!1},Gie={readContext:th,useCallback:q8,useContext:th,useEffect:NN,useImperativeHandle:$8,useInsertionEffect:H8,useLayoutEffect:W8,useMemo:Z8,useReducer:eD,useRef:G8,useState:function(){return eD(K1)},useDebugValue:BN,useDeferredValue:function(t){var e=nh();return Sa===null?e.memoizedState=t:X8(e,Sa.memoizedState,t)},useTransition:function(){var t=eD(K1)[0],e=nh().memoizedState;return[t,e]},useMutableSource:O8,useSyncExternalStore:k8,useId:K8,unstable_isNewReconciler:!1};function $h(t,e){if(t&&t.defaultProps){e=ko({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function PF(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ko({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var pA={isMounted:function(t){return(t=t._reactInternals)?D_(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Yl(),r=Xg(t),o=zp(i,r);o.payload=e,n!=null&&(o.callback=n),e=qg(t,o,r),e!==null&&(rd(e,t,r,i),ZM(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Yl(),r=Xg(t),o=zp(i,r);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=qg(t,o,r),e!==null&&(rd(e,t,r,i),ZM(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Yl(),i=Xg(t),r=zp(n,i);r.tag=2,e!=null&&(r.callback=e),e=qg(t,r,i),e!==null&&(rd(e,t,i,n),ZM(e,t,i))}};function RG(t,e,n,i,r,o,c){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,o,c):e.prototype&&e.prototype.isPureReactComponent?!H1(n,i)||!H1(r,o):!0}function e9(t,e,n){var i=!1,r=rv,o=e.contextType;return typeof o=="object"&&o!==null?o=th(o):(r=Bc(e)?h_:bl.current,i=e.contextTypes,o=(i=i!=null)?Zx(t,r):rv),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=pA,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function TG(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&pA.enqueueReplaceState(e,e.state,null)}function IF(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},PN(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=th(o):(o=Bc(e)?h_:bl.current,r.context=Zx(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(PF(t,e,o,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&pA.enqueueReplaceState(r,r.state,null),DR(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Jx(t,e){try{var n="",i=e;do n+=gne(i),i=i.return;while(i);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function tD(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function DF(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Hie=typeof WeakMap=="function"?WeakMap:Map;function t9(t,e,n){n=zp(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){NR||(NR=!0,GF=i),DF(t,e)},n}function n9(t,e,n){n=zp(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){DF(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){DF(t,e),typeof i!="function"&&(Zg===null?Zg=new Set([this]):Zg.add(this));var c=e.stack;this.componentDidCatch(e.value,{componentStack:c!==null?c:""})}),n}function AG(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Hie;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=ire.bind(null,t,e,n),e.then(t,t))}function PG(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function IG(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=zp(-1,1),e.tag=2,qg(n,e,1))),n.lanes|=1),t)}var Wie=am.ReactCurrentOwner,Lc=!1;function jl(t,e,n,i){e.child=t===null?I8(e,null,n,i):Kx(e,t.child,n,i)}function DG(t,e,n,i,r){n=n.render;var o=e.ref;return Ex(e,r),i=ON(t,e,n,i,o,r),n=kN(),t!==null&&!Lc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Kp(t,e,r)):(_o&&n&&SN(e),e.flags|=1,jl(t,e,i,r),e.child)}function FG(t,e,n,i,r){if(t===null){var o=n.type;return typeof o=="function"&&!$N(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,i9(t,e,o,i,r)):(t=eR(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var c=o.memoizedProps;if(n=n.compare,n=n!==null?n:H1,n(c,i)&&t.ref===e.ref)return Kp(t,e,r)}return e.flags|=1,t=Kg(o,i),t.ref=e.ref,t.return=e,e.child=t}function i9(t,e,n,i,r){if(t!==null){var o=t.memoizedProps;if(H1(o,i)&&t.ref===e.ref)if(Lc=!1,e.pendingProps=i=o,(t.lanes&r)!==0)t.flags&131072&&(Lc=!0);else return e.lanes=t.lanes,Kp(t,e,r)}return FF(t,e,n,i,r)}function r9(t,e,n){var i=e.pendingProps,r=i.children,o=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ys(hx,fu),fu|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ys(hx,fu),fu|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:n,Ys(hx,fu),fu|=i}else o!==null?(i=o.baseLanes|n,e.memoizedState=null):i=n,Ys(hx,fu),fu|=i;return jl(t,e,r,n),e.child}function s9(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function FF(t,e,n,i,r){var o=Bc(n)?h_:bl.current;return o=Zx(e,o),Ex(e,r),n=ON(t,e,n,i,o,r),i=kN(),t!==null&&!Lc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Kp(t,e,r)):(_o&&i&&SN(e),e.flags|=1,jl(t,e,n,r),e.child)}function LG(t,e,n,i,r){if(Bc(n)){var o=!0;RR(e)}else o=!1;if(Ex(e,r),e.stateNode===null)YM(t,e),e9(e,n,i),IF(e,n,i,r),i=!0;else if(t===null){var c=e.stateNode,s=e.memoizedProps;c.props=s;var f=c.context,v=n.contextType;typeof v=="object"&&v!==null?v=th(v):(v=Bc(n)?h_:bl.current,v=Zx(e,v));var w=n.getDerivedStateFromProps,C=typeof w=="function"||typeof c.getSnapshotBeforeUpdate=="function";C||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(s!==i||f!==v)&&TG(e,c,i,v),Rg=!1;var M=e.memoizedState;c.state=M,DR(e,i,c,r),f=e.memoizedState,s!==i||M!==f||Nc.current||Rg?(typeof w=="function"&&(PF(e,n,w,i),f=e.memoizedState),(s=Rg||RG(e,n,s,i,M,f,v))?(C||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(e.flags|=4194308)):(typeof c.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=f),c.props=i,c.state=f,c.context=v,i=s):(typeof c.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{c=e.stateNode,F8(t,e),s=e.memoizedProps,v=e.type===e.elementType?s:$h(e.type,s),c.props=v,C=e.pendingProps,M=c.context,f=n.contextType,typeof f=="object"&&f!==null?f=th(f):(f=Bc(n)?h_:bl.current,f=Zx(e,f));var F=n.getDerivedStateFromProps;(w=typeof F=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(s!==C||M!==f)&&TG(e,c,i,f),Rg=!1,M=e.memoizedState,c.state=M,DR(e,i,c,r);var N=e.memoizedState;s!==C||M!==N||Nc.current||Rg?(typeof F=="function"&&(PF(e,n,F,i),N=e.memoizedState),(v=Rg||RG(e,n,v,i,M,N,f)||!1)?(w||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(i,N,f),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(i,N,f)),typeof c.componentDidUpdate=="function"&&(e.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof c.componentDidUpdate!="function"||s===t.memoizedProps&&M===t.memoizedState||(e.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&M===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=N),c.props=i,c.state=N,c.context=f,i=v):(typeof c.componentDidUpdate!="function"||s===t.memoizedProps&&M===t.memoizedState||(e.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&M===t.memoizedState||(e.flags|=1024),i=!1)}return LF(t,e,n,i,o,r)}function LF(t,e,n,i,r,o){s9(t,e);var c=(e.flags&128)!==0;if(!i&&!c)return r&&_G(e,n,!1),Kp(t,e,o);i=e.stateNode,Wie.current=e;var s=c&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&c?(e.child=Kx(e,t.child,null,o),e.child=Kx(e,null,s,o)):jl(t,e,s,o),e.memoizedState=i.state,r&&_G(e,n,!0),e.child}function o9(t){var e=t.stateNode;e.pendingContext?yG(t,e.pendingContext,e.pendingContext!==e.context):e.context&&yG(t,e.context,!1),IN(t,e.containerInfo)}function OG(t,e,n,i,r){return Xx(),EN(r),e.flags|=256,jl(t,e,n,i),e.child}var OF={dehydrated:null,treeContext:null,retryLane:0};function kF(t){return{baseLanes:t,cachePool:null,transitions:null}}function a9(t,e,n){var i=e.pendingProps,r=Po.current,o=!1,c=(e.flags&128)!==0,s;if((s=c)||(s=t!==null&&t.memoizedState===null?!1:(r&2)!==0),s?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Ys(Po,r&1),t===null)return TF(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(c=i.children,t=i.fallback,o?(i=e.mode,o=e.child,c={mode:"hidden",children:c},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=c):o=vA(c,i,0,null),t=Jy(t,i,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=kF(n),e.memoizedState=OF,t):zN(e,c));if(r=t.memoizedState,r!==null&&(s=r.dehydrated,s!==null))return jie(t,e,c,i,s,r,n);if(o){o=i.fallback,c=e.mode,r=t.child,s=r.sibling;var f={mode:"hidden",children:i.children};return!(c&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=f,e.deletions=null):(i=Kg(r,f),i.subtreeFlags=r.subtreeFlags&14680064),s!==null?o=Kg(s,o):(o=Jy(o,c,n,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,i=o,o=e.child,c=t.child.memoizedState,c=c===null?kF(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},o.memoizedState=c,o.childLanes=t.childLanes&~n,e.memoizedState=OF,i}return o=t.child,t=o.sibling,i=Kg(o,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function zN(t,e){return e=vA({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xE(t,e,n,i){return i!==null&&EN(i),Kx(e,t.child,null,n),t=zN(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function jie(t,e,n,i,r,o,c){if(n)return e.flags&256?(e.flags&=-257,i=tD(Error(ei(422))),xE(t,e,c,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=i.fallback,r=e.mode,i=vA({mode:"visible",children:i.children},r,0,null),o=Jy(o,r,c,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,e.mode&1&&Kx(e,t.child,null,c),e.child.memoizedState=kF(c),e.memoizedState=OF,o);if(!(e.mode&1))return xE(t,e,c,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var s=i.dgst;return i=s,o=Error(ei(419)),i=tD(o,i,void 0),xE(t,e,c,i)}if(s=(c&t.childLanes)!==0,Lc||s){if(i=Ga,i!==null){switch(c&-c){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|c)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Xp(t,r),rd(i,t,r,-1))}return jN(),i=tD(Error(ei(421))),xE(t,e,c,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=rre.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,mu=$g(r.nextSibling),vu=e,_o=!0,Yh=null,t!==null&&(ju[$u++]=kp,ju[$u++]=Np,ju[$u++]=d_,kp=t.id,Np=t.overflow,d_=e),e=zN(e,i.children),e.flags|=4096,e)}function kG(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),AF(t.return,e,n)}function nD(t,e,n,i,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function l9(t,e,n){var i=e.pendingProps,r=i.revealOrder,o=i.tail;if(jl(t,e,i.children,n),i=Po.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&kG(t,n,e);else if(t.tag===19)kG(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Ys(Po,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&FR(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),nD(e,!1,r,n,o);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&FR(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}nD(e,!0,n,null,o);break;case"together":nD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function YM(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Kp(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),p_|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ei(153));if(e.child!==null){for(t=e.child,n=Kg(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Kg(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $ie(t,e,n){switch(e.tag){case 3:o9(e),Xx();break;case 5:L8(e);break;case 1:Bc(e.type)&&RR(e);break;case 4:IN(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ys(PR,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Ys(Po,Po.current&1),e.flags|=128,null):n&e.child.childLanes?a9(t,e,n):(Ys(Po,Po.current&1),t=Kp(t,e,n),t!==null?t.sibling:null);Ys(Po,Po.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return l9(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ys(Po,Po.current),i)break;return null;case 22:case 23:return e.lanes=0,r9(t,e,n)}return Kp(t,e,n)}var c9,NF,u9,h9;c9=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};NF=function(){};u9=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,ky(xf.current);var o=null;switch(n){case"input":r=sF(t,r),i=sF(t,i),o=[];break;case"select":r=ko({},r,{value:void 0}),i=ko({},i,{value:void 0}),o=[];break;case"textarea":r=lF(t,r),i=lF(t,i),o=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=ER)}uF(n,i);var c;n=null;for(v in r)if(!i.hasOwnProperty(v)&&r.hasOwnProperty(v)&&r[v]!=null)if(v==="style"){var s=r[v];for(c in s)s.hasOwnProperty(c)&&(n||(n={}),n[c]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(k1.hasOwnProperty(v)?o||(o=[]):(o=o||[]).push(v,null));for(v in i){var f=i[v];if(s=r!=null?r[v]:void 0,i.hasOwnProperty(v)&&f!==s&&(f!=null||s!=null))if(v==="style")if(s){for(c in s)!s.hasOwnProperty(c)||f&&f.hasOwnProperty(c)||(n||(n={}),n[c]="");for(c in f)f.hasOwnProperty(c)&&s[c]!==f[c]&&(n||(n={}),n[c]=f[c])}else n||(o||(o=[]),o.push(v,n)),n=f;else v==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,s=s?s.__html:void 0,f!=null&&s!==f&&(o=o||[]).push(v,f)):v==="children"?typeof f!="string"&&typeof f!="number"||(o=o||[]).push(v,""+f):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(k1.hasOwnProperty(v)?(f!=null&&v==="onScroll"&&ao("scroll",t),o||s===f||(o=[])):(o=o||[]).push(v,f))}n&&(o=o||[]).push("style",n);var v=o;(e.updateQueue=v)&&(e.flags|=4)}};h9=function(t,e,n,i){n!==i&&(e.flags|=4)};function PC(t,e){if(!_o)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function fl(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function qie(t,e,n){var i=e.pendingProps;switch(bN(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fl(e),null;case 1:return Bc(e.type)&&MR(),fl(e),null;case 3:return i=e.stateNode,Yx(),ho(Nc),ho(bl),FN(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(yE(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Yh!==null&&(jF(Yh),Yh=null))),NF(t,e),fl(e),null;case 5:DN(e);var r=ky(Z1.current);if(n=e.type,t!==null&&e.stateNode!=null)u9(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ei(166));return fl(e),null}if(t=ky(xf.current),yE(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[pf]=e,i[$1]=o,t=(e.mode&1)!==0,n){case"dialog":ao("cancel",i),ao("close",i);break;case"iframe":case"object":case"embed":ao("load",i);break;case"video":case"audio":for(r=0;r<i1.length;r++)ao(i1[r],i);break;case"source":ao("error",i);break;case"img":case"image":case"link":ao("error",i),ao("load",i);break;case"details":ao("toggle",i);break;case"input":jV(i,o),ao("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},ao("invalid",i);break;case"textarea":qV(i,o),ao("invalid",i)}uF(n,o),r=null;for(var c in o)if(o.hasOwnProperty(c)){var s=o[c];c==="children"?typeof s=="string"?i.textContent!==s&&(o.suppressHydrationWarning!==!0&&vE(i.textContent,s,t),r=["children",s]):typeof s=="number"&&i.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&vE(i.textContent,s,t),r=["children",""+s]):k1.hasOwnProperty(c)&&s!=null&&c==="onScroll"&&ao("scroll",i)}switch(n){case"input":cE(i),$V(i,o,!0);break;case"textarea":cE(i),ZV(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=ER)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{c=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zj(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=c.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=c.createElement(n,{is:i.is}):(t=c.createElement(n),n==="select"&&(c=t,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):t=c.createElementNS(t,n),t[pf]=e,t[$1]=i,c9(t,e,!1,!1),e.stateNode=t;e:{switch(c=hF(n,i),n){case"dialog":ao("cancel",t),ao("close",t),r=i;break;case"iframe":case"object":case"embed":ao("load",t),r=i;break;case"video":case"audio":for(r=0;r<i1.length;r++)ao(i1[r],t);r=i;break;case"source":ao("error",t),r=i;break;case"img":case"image":case"link":ao("error",t),ao("load",t),r=i;break;case"details":ao("toggle",t),r=i;break;case"input":jV(t,i),r=sF(t,i),ao("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ko({},i,{value:void 0}),ao("invalid",t);break;case"textarea":qV(t,i),r=lF(t,i),ao("invalid",t);break;default:r=i}uF(n,r),s=r;for(o in s)if(s.hasOwnProperty(o)){var f=s[o];o==="style"?Gj(t,f):o==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,f!=null&&Uj(t,f)):o==="children"?typeof f=="string"?(n!=="textarea"||f!=="")&&N1(t,f):typeof f=="number"&&N1(t,""+f):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(k1.hasOwnProperty(o)?f!=null&&o==="onScroll"&&ao("scroll",t):f!=null&&cN(t,o,f,c))}switch(n){case"input":cE(t),$V(t,i,!1);break;case"textarea":cE(t),ZV(t);break;case"option":i.value!=null&&t.setAttribute("value",""+iv(i.value));break;case"select":t.multiple=!!i.multiple,o=i.value,o!=null?wx(t,!!i.multiple,o,!1):i.defaultValue!=null&&wx(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=ER)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return fl(e),null;case 6:if(t&&e.stateNode!=null)h9(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ei(166));if(n=ky(Z1.current),ky(xf.current),yE(e)){if(i=e.stateNode,n=e.memoizedProps,i[pf]=e,(o=i.nodeValue!==n)&&(t=vu,t!==null))switch(t.tag){case 3:vE(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&vE(i.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[pf]=e,e.stateNode=i}return fl(e),null;case 13:if(ho(Po),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_o&&mu!==null&&e.mode&1&&!(e.flags&128))A8(),Xx(),e.flags|=98560,o=!1;else if(o=yE(e),i!==null&&i.dehydrated!==null){if(t===null){if(!o)throw Error(ei(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(ei(317));o[pf]=e}else Xx(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;fl(e),o=!1}else Yh!==null&&(jF(Yh),Yh=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Po.current&1?Ea===0&&(Ea=3):jN())),e.updateQueue!==null&&(e.flags|=4),fl(e),null);case 4:return Yx(),NF(t,e),t===null&&W1(e.stateNode.containerInfo),fl(e),null;case 10:return TN(e.type._context),fl(e),null;case 17:return Bc(e.type)&&MR(),fl(e),null;case 19:if(ho(Po),o=e.memoizedState,o===null)return fl(e),null;if(i=(e.flags&128)!==0,c=o.rendering,c===null)if(i)PC(o,!1);else{if(Ea!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(c=FR(t),c!==null){for(e.flags|=128,PC(o,!1),i=c.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)o=n,t=i,o.flags&=14680066,c=o.alternate,c===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,t=c.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ys(Po,Po.current&1|2),e.child}t=t.sibling}o.tail!==null&&aa()>Qx&&(e.flags|=128,i=!0,PC(o,!1),e.lanes=4194304)}else{if(!i)if(t=FR(c),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),PC(o,!0),o.tail===null&&o.tailMode==="hidden"&&!c.alternate&&!_o)return fl(e),null}else 2*aa()-o.renderingStartTime>Qx&&n!==1073741824&&(e.flags|=128,i=!0,PC(o,!1),e.lanes=4194304);o.isBackwards?(c.sibling=e.child,e.child=c):(n=o.last,n!==null?n.sibling=c:e.child=c,o.last=c)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=aa(),e.sibling=null,n=Po.current,Ys(Po,i?n&1|2:n&1),e):(fl(e),null);case 22:case 23:return WN(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?fu&1073741824&&(fl(e),e.subtreeFlags&6&&(e.flags|=8192)):fl(e),null;case 24:return null;case 25:return null}throw Error(ei(156,e.tag))}function Zie(t,e){switch(bN(e),e.tag){case 1:return Bc(e.type)&&MR(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Yx(),ho(Nc),ho(bl),FN(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return DN(e),null;case 13:if(ho(Po),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ei(340));Xx()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ho(Po),null;case 4:return Yx(),null;case 10:return TN(e.type._context),null;case 22:case 23:return WN(),null;case 24:return null;default:return null}}var wE=!1,_l=!1,Xie=typeof WeakSet=="function"?WeakSet:Set,Di=null;function ux(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){qo(t,e,i)}else n.current=null}function BF(t,e,n){try{n()}catch(i){qo(t,e,i)}}var NG=!1;function Kie(t,e){if(wF=CR,t=g8(),CN(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var c=0,s=-1,f=-1,v=0,w=0,C=t,M=null;t:for(;;){for(var F;C!==n||r!==0&&C.nodeType!==3||(s=c+r),C!==o||i!==0&&C.nodeType!==3||(f=c+i),C.nodeType===3&&(c+=C.nodeValue.length),(F=C.firstChild)!==null;)M=C,C=F;for(;;){if(C===t)break t;if(M===n&&++v===r&&(s=c),M===o&&++w===i&&(f=c),(F=C.nextSibling)!==null)break;C=M,M=C.parentNode}C=F}n=s===-1||f===-1?null:{start:s,end:f}}else n=null}n=n||{start:0,end:0}}else n=null;for(CF={focusedElem:t,selectionRange:n},CR=!1,Di=e;Di!==null;)if(e=Di,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Di=t;else for(;Di!==null;){e=Di;try{var N=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var z=N.memoizedProps,L=N.memoizedState,P=e.stateNode,H=P.getSnapshotBeforeUpdate(e.elementType===e.type?z:$h(e.type,z),L);P.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var j=e.stateNode.containerInfo;j.nodeType===1?j.textContent="":j.nodeType===9&&j.documentElement&&j.removeChild(j.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ei(163))}}catch(q){qo(e,e.return,q)}if(t=e.sibling,t!==null){t.return=e.return,Di=t;break}Di=e.return}return N=NG,NG=!1,N}function v1(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&BF(e,n,o)}r=r.next}while(r!==i)}}function mA(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function zF(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function d9(t){var e=t.alternate;e!==null&&(t.alternate=null,d9(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[pf],delete e[$1],delete e[EF],delete e[Die],delete e[Fie])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function f9(t){return t.tag===5||t.tag===3||t.tag===4}function BG(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||f9(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function UF(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ER));else if(i!==4&&(t=t.child,t!==null))for(UF(t,e,n),t=t.sibling;t!==null;)UF(t,e,n),t=t.sibling}function VF(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(VF(t,e,n),t=t.sibling;t!==null;)VF(t,e,n),t=t.sibling}var Ja=null,Xh=!1;function hg(t,e,n){for(n=n.child;n!==null;)p9(t,e,n),n=n.sibling}function p9(t,e,n){if(_f&&typeof _f.onCommitFiberUnmount=="function")try{_f.onCommitFiberUnmount(aA,n)}catch{}switch(n.tag){case 5:_l||ux(n,e);case 6:var i=Ja,r=Xh;Ja=null,hg(t,e,n),Ja=i,Xh=r,Ja!==null&&(Xh?(t=Ja,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ja.removeChild(n.stateNode));break;case 18:Ja!==null&&(Xh?(t=Ja,n=n.stateNode,t.nodeType===8?XI(t.parentNode,n):t.nodeType===1&&XI(t,n),V1(t)):XI(Ja,n.stateNode));break;case 4:i=Ja,r=Xh,Ja=n.stateNode.containerInfo,Xh=!0,hg(t,e,n),Ja=i,Xh=r;break;case 0:case 11:case 14:case 15:if(!_l&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var o=r,c=o.destroy;o=o.tag,c!==void 0&&(o&2||o&4)&&BF(n,e,c),r=r.next}while(r!==i)}hg(t,e,n);break;case 1:if(!_l&&(ux(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){qo(n,e,s)}hg(t,e,n);break;case 21:hg(t,e,n);break;case 22:n.mode&1?(_l=(i=_l)||n.memoizedState!==null,hg(t,e,n),_l=i):hg(t,e,n);break;default:hg(t,e,n)}}function zG(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Xie),e.forEach(function(i){var r=sre.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Vh(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,c=e,s=c;e:for(;s!==null;){switch(s.tag){case 5:Ja=s.stateNode,Xh=!1;break e;case 3:Ja=s.stateNode.containerInfo,Xh=!0;break e;case 4:Ja=s.stateNode.containerInfo,Xh=!0;break e}s=s.return}if(Ja===null)throw Error(ei(160));p9(o,c,r),Ja=null,Xh=!1;var f=r.alternate;f!==null&&(f.return=null),r.return=null}catch(v){qo(r,e,v)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)m9(e,t),e=e.sibling}function m9(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Vh(e,t),sf(t),i&4){try{v1(3,t,t.return),mA(3,t)}catch(z){qo(t,t.return,z)}try{v1(5,t,t.return)}catch(z){qo(t,t.return,z)}}break;case 1:Vh(e,t),sf(t),i&512&&n!==null&&ux(n,n.return);break;case 5:if(Vh(e,t),sf(t),i&512&&n!==null&&ux(n,n.return),t.flags&32){var r=t.stateNode;try{N1(r,"")}catch(z){qo(t,t.return,z)}}if(i&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,c=n!==null?n.memoizedProps:o,s=t.type,f=t.updateQueue;if(t.updateQueue=null,f!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&Nj(r,o),hF(s,c);var v=hF(s,o);for(c=0;c<f.length;c+=2){var w=f[c],C=f[c+1];w==="style"?Gj(r,C):w==="dangerouslySetInnerHTML"?Uj(r,C):w==="children"?N1(r,C):cN(r,w,C,v)}switch(s){case"input":oF(r,o);break;case"textarea":Bj(r,o);break;case"select":var M=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var F=o.value;F!=null?wx(r,!!o.multiple,F,!1):M!==!!o.multiple&&(o.defaultValue!=null?wx(r,!!o.multiple,o.defaultValue,!0):wx(r,!!o.multiple,o.multiple?[]:"",!1))}r[$1]=o}catch(z){qo(t,t.return,z)}}break;case 6:if(Vh(e,t),sf(t),i&4){if(t.stateNode===null)throw Error(ei(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(z){qo(t,t.return,z)}}break;case 3:if(Vh(e,t),sf(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{V1(e.containerInfo)}catch(z){qo(t,t.return,z)}break;case 4:Vh(e,t),sf(t);break;case 13:Vh(e,t),sf(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(GN=aa())),i&4&&zG(t);break;case 22:if(w=n!==null&&n.memoizedState!==null,t.mode&1?(_l=(v=_l)||w,Vh(e,t),_l=v):Vh(e,t),sf(t),i&8192){if(v=t.memoizedState!==null,(t.stateNode.isHidden=v)&&!w&&t.mode&1)for(Di=t,w=t.child;w!==null;){for(C=Di=w;Di!==null;){switch(M=Di,F=M.child,M.tag){case 0:case 11:case 14:case 15:v1(4,M,M.return);break;case 1:ux(M,M.return);var N=M.stateNode;if(typeof N.componentWillUnmount=="function"){i=M,n=M.return;try{e=i,N.props=e.memoizedProps,N.state=e.memoizedState,N.componentWillUnmount()}catch(z){qo(i,n,z)}}break;case 5:ux(M,M.return);break;case 22:if(M.memoizedState!==null){VG(C);continue}}F!==null?(F.return=M,Di=F):VG(C)}w=w.sibling}e:for(w=null,C=t;;){if(C.tag===5){if(w===null){w=C;try{r=C.stateNode,v?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=C.stateNode,f=C.memoizedProps.style,c=f!=null&&f.hasOwnProperty("display")?f.display:null,s.style.display=Vj("display",c))}catch(z){qo(t,t.return,z)}}}else if(C.tag===6){if(w===null)try{C.stateNode.nodeValue=v?"":C.memoizedProps}catch(z){qo(t,t.return,z)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===t)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===t)break e;for(;C.sibling===null;){if(C.return===null||C.return===t)break e;w===C&&(w=null),C=C.return}w===C&&(w=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Vh(e,t),sf(t),i&4&&zG(t);break;case 21:break;default:Vh(e,t),sf(t)}}function sf(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(f9(n)){var i=n;break e}n=n.return}throw Error(ei(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(N1(r,""),i.flags&=-33);var o=BG(t);VF(t,o,r);break;case 3:case 4:var c=i.stateNode.containerInfo,s=BG(t);UF(t,s,c);break;default:throw Error(ei(161))}}catch(f){qo(t,t.return,f)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Yie(t,e,n){Di=t,g9(t)}function g9(t,e,n){for(var i=(t.mode&1)!==0;Di!==null;){var r=Di,o=r.child;if(r.tag===22&&i){var c=r.memoizedState!==null||wE;if(!c){var s=r.alternate,f=s!==null&&s.memoizedState!==null||_l;s=wE;var v=_l;if(wE=c,(_l=f)&&!v)for(Di=r;Di!==null;)c=Di,f=c.child,c.tag===22&&c.memoizedState!==null?GG(r):f!==null?(f.return=c,Di=f):GG(r);for(;o!==null;)Di=o,g9(o),o=o.sibling;Di=r,wE=s,_l=v}UG(t)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Di=o):UG(t)}}function UG(t){for(;Di!==null;){var e=Di;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:_l||mA(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!_l)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:$h(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&bG(e,o,i);break;case 3:var c=e.updateQueue;if(c!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}bG(e,c,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var f=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":f.autoFocus&&n.focus();break;case"img":f.src&&(n.src=f.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var v=e.alternate;if(v!==null){var w=v.memoizedState;if(w!==null){var C=w.dehydrated;C!==null&&V1(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ei(163))}_l||e.flags&512&&zF(e)}catch(M){qo(e,e.return,M)}}if(e===t){Di=null;break}if(n=e.sibling,n!==null){n.return=e.return,Di=n;break}Di=e.return}}function VG(t){for(;Di!==null;){var e=Di;if(e===t){Di=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Di=n;break}Di=e.return}}function GG(t){for(;Di!==null;){var e=Di;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{mA(4,e)}catch(f){qo(e,n,f)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(f){qo(e,r,f)}}var o=e.return;try{zF(e)}catch(f){qo(e,o,f)}break;case 5:var c=e.return;try{zF(e)}catch(f){qo(e,c,f)}}}catch(f){qo(e,e.return,f)}if(e===t){Di=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Di=s;break}Di=e.return}}var Jie=Math.ceil,kR=am.ReactCurrentDispatcher,UN=am.ReactCurrentOwner,Ju=am.ReactCurrentBatchConfig,ws=0,Ga=null,ga=null,Qa=0,fu=0,hx=gv(0),Ea=0,J1=null,p_=0,gA=0,VN=0,y1=null,Dc=null,GN=0,Qx=1/0,Ap=null,NR=!1,GF=null,Zg=null,CE=!1,Vg=null,BR=0,_1=0,HF=null,JM=-1,QM=0;function Yl(){return ws&6?aa():JM!==-1?JM:JM=aa()}function Xg(t){return t.mode&1?ws&2&&Qa!==0?Qa&-Qa:Oie.transition!==null?(QM===0&&(QM=e8()),QM):(t=Bs,t!==0||(t=window.event,t=t===void 0?16:a8(t.type)),t):1}function rd(t,e,n,i){if(50<_1)throw _1=0,HF=null,Error(ei(185));FS(t,n,i),(!(ws&2)||t!==Ga)&&(t===Ga&&(!(ws&2)&&(gA|=n),Ea===4&&Pg(t,Qa)),zc(t,i),n===1&&ws===0&&!(e.mode&1)&&(Qx=aa()+500,dA&&vv()))}function zc(t,e){var n=t.callbackNode;One(t,e);var i=wR(t,t===Ga?Qa:0);if(i===0)n!==null&&YV(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&YV(n),e===1)t.tag===0?Lie(HG.bind(null,t)):M8(HG.bind(null,t)),Pie(function(){!(ws&6)&&vv()}),n=null;else{switch(t8(i)){case 1:n=pN;break;case 4:n=Jj;break;case 16:n=xR;break;case 536870912:n=Qj;break;default:n=xR}n=b9(n,v9.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function v9(t,e){if(JM=-1,QM=0,ws&6)throw Error(ei(327));var n=t.callbackNode;if(Mx()&&t.callbackNode!==n)return null;var i=wR(t,t===Ga?Qa:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=zR(t,i);else{e=i;var r=ws;ws|=2;var o=_9();(Ga!==t||Qa!==e)&&(Ap=null,Qx=aa()+500,Yy(t,e));do try{tre();break}catch(s){y9(t,s)}while(!0);RN(),kR.current=o,ws=r,ga!==null?e=0:(Ga=null,Qa=0,e=Ea)}if(e!==0){if(e===2&&(r=gF(t),r!==0&&(i=r,e=WF(t,r))),e===1)throw n=J1,Yy(t,0),Pg(t,i),zc(t,aa()),n;if(e===6)Pg(t,i);else{if(r=t.current.alternate,!(i&30)&&!Qie(r)&&(e=zR(t,i),e===2&&(o=gF(t),o!==0&&(i=o,e=WF(t,o))),e===1))throw n=J1,Yy(t,0),Pg(t,i),zc(t,aa()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(ei(345));case 2:My(t,Dc,Ap);break;case 3:if(Pg(t,i),(i&130023424)===i&&(e=GN+500-aa(),10<e)){if(wR(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Yl(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=bF(My.bind(null,t,Dc,Ap),e);break}My(t,Dc,Ap);break;case 4:if(Pg(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var c=31-id(i);o=1<<c,c=e[c],c>r&&(r=c),i&=~o}if(i=r,i=aa()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Jie(i/1960))-i,10<i){t.timeoutHandle=bF(My.bind(null,t,Dc,Ap),i);break}My(t,Dc,Ap);break;case 5:My(t,Dc,Ap);break;default:throw Error(ei(329))}}}return zc(t,aa()),t.callbackNode===n?v9.bind(null,t):null}function WF(t,e){var n=y1;return t.current.memoizedState.isDehydrated&&(Yy(t,e).flags|=256),t=zR(t,e),t!==2&&(e=Dc,Dc=n,e!==null&&jF(e)),t}function jF(t){Dc===null?Dc=t:Dc.push.apply(Dc,t)}function Qie(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ad(o(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Pg(t,e){for(e&=~VN,e&=~gA,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-id(e),i=1<<n;t[n]=-1,e&=~i}}function HG(t){if(ws&6)throw Error(ei(327));Mx();var e=wR(t,0);if(!(e&1))return zc(t,aa()),null;var n=zR(t,e);if(t.tag!==0&&n===2){var i=gF(t);i!==0&&(e=i,n=WF(t,i))}if(n===1)throw n=J1,Yy(t,0),Pg(t,e),zc(t,aa()),n;if(n===6)throw Error(ei(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,My(t,Dc,Ap),zc(t,aa()),null}function HN(t,e){var n=ws;ws|=1;try{return t(e)}finally{ws=n,ws===0&&(Qx=aa()+500,dA&&vv())}}function m_(t){Vg!==null&&Vg.tag===0&&!(ws&6)&&Mx();var e=ws;ws|=1;var n=Ju.transition,i=Bs;try{if(Ju.transition=null,Bs=1,t)return t()}finally{Bs=i,Ju.transition=n,ws=e,!(ws&6)&&vv()}}function WN(){fu=hx.current,ho(hx)}function Yy(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Aie(n)),ga!==null)for(n=ga.return;n!==null;){var i=n;switch(bN(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&MR();break;case 3:Yx(),ho(Nc),ho(bl),FN();break;case 5:DN(i);break;case 4:Yx();break;case 13:ho(Po);break;case 19:ho(Po);break;case 10:TN(i.type._context);break;case 22:case 23:WN()}n=n.return}if(Ga=t,ga=t=Kg(t.current,null),Qa=fu=e,Ea=0,J1=null,VN=gA=p_=0,Dc=y1=null,Oy!==null){for(e=0;e<Oy.length;e++)if(n=Oy[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,o=n.pending;if(o!==null){var c=o.next;o.next=r,i.next=c}n.pending=i}Oy=null}return t}function y9(t,e){do{var n=ga;try{if(RN(),XM.current=OR,LR){for(var i=Lo.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}LR=!1}if(f_=0,za=Sa=Lo=null,g1=!1,X1=0,UN.current=null,n===null||n.return===null){Ea=1,J1=e,ga=null;break}e:{var o=t,c=n.return,s=n,f=e;if(e=Qa,s.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){var v=f,w=s,C=w.tag;if(!(w.mode&1)&&(C===0||C===11||C===15)){var M=w.alternate;M?(w.updateQueue=M.updateQueue,w.memoizedState=M.memoizedState,w.lanes=M.lanes):(w.updateQueue=null,w.memoizedState=null)}var F=PG(c);if(F!==null){F.flags&=-257,IG(F,c,s,o,e),F.mode&1&&AG(o,v,e),e=F,f=v;var N=e.updateQueue;if(N===null){var z=new Set;z.add(f),e.updateQueue=z}else N.add(f);break e}else{if(!(e&1)){AG(o,v,e),jN();break e}f=Error(ei(426))}}else if(_o&&s.mode&1){var L=PG(c);if(L!==null){!(L.flags&65536)&&(L.flags|=256),IG(L,c,s,o,e),EN(Jx(f,s));break e}}o=f=Jx(f,s),Ea!==4&&(Ea=2),y1===null?y1=[o]:y1.push(o),o=c;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var P=t9(o,f,e);SG(o,P);break e;case 1:s=f;var H=o.type,j=o.stateNode;if(!(o.flags&128)&&(typeof H.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(Zg===null||!Zg.has(j)))){o.flags|=65536,e&=-e,o.lanes|=e;var q=n9(o,s,e);SG(o,q);break e}}o=o.return}while(o!==null)}w9(n)}catch(le){e=le,ga===n&&n!==null&&(ga=n=n.return);continue}break}while(!0)}function _9(){var t=kR.current;return kR.current=OR,t===null?OR:t}function jN(){(Ea===0||Ea===3||Ea===2)&&(Ea=4),Ga===null||!(p_&268435455)&&!(gA&268435455)||Pg(Ga,Qa)}function zR(t,e){var n=ws;ws|=2;var i=_9();(Ga!==t||Qa!==e)&&(Ap=null,Yy(t,e));do try{ere();break}catch(r){y9(t,r)}while(!0);if(RN(),ws=n,kR.current=i,ga!==null)throw Error(ei(261));return Ga=null,Qa=0,Ea}function ere(){for(;ga!==null;)x9(ga)}function tre(){for(;ga!==null&&!Mne();)x9(ga)}function x9(t){var e=S9(t.alternate,t,fu);t.memoizedProps=t.pendingProps,e===null?w9(t):ga=e,UN.current=null}function w9(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Zie(n,e),n!==null){n.flags&=32767,ga=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ea=6,ga=null;return}}else if(n=qie(n,e,fu),n!==null){ga=n;return}if(e=e.sibling,e!==null){ga=e;return}ga=e=t}while(e!==null);Ea===0&&(Ea=5)}function My(t,e,n){var i=Bs,r=Ju.transition;try{Ju.transition=null,Bs=1,nre(t,e,n,i)}finally{Ju.transition=r,Bs=i}return null}function nre(t,e,n,i){do Mx();while(Vg!==null);if(ws&6)throw Error(ei(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ei(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(kne(t,o),t===Ga&&(ga=Ga=null,Qa=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||CE||(CE=!0,b9(xR,function(){return Mx(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Ju.transition,Ju.transition=null;var c=Bs;Bs=1;var s=ws;ws|=4,UN.current=null,Kie(t,n),m9(n,t),Cie(CF),CR=!!wF,CF=wF=null,t.current=n,Yie(n),Rne(),ws=s,Bs=c,Ju.transition=o}else t.current=n;if(CE&&(CE=!1,Vg=t,BR=r),o=t.pendingLanes,o===0&&(Zg=null),Pne(n.stateNode),zc(t,aa()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(NR)throw NR=!1,t=GF,GF=null,t;return BR&1&&t.tag!==0&&Mx(),o=t.pendingLanes,o&1?t===HF?_1++:(_1=0,HF=t):_1=0,vv(),null}function Mx(){if(Vg!==null){var t=t8(BR),e=Ju.transition,n=Bs;try{if(Ju.transition=null,Bs=16>t?16:t,Vg===null)var i=!1;else{if(t=Vg,Vg=null,BR=0,ws&6)throw Error(ei(331));var r=ws;for(ws|=4,Di=t.current;Di!==null;){var o=Di,c=o.child;if(Di.flags&16){var s=o.deletions;if(s!==null){for(var f=0;f<s.length;f++){var v=s[f];for(Di=v;Di!==null;){var w=Di;switch(w.tag){case 0:case 11:case 15:v1(8,w,o)}var C=w.child;if(C!==null)C.return=w,Di=C;else for(;Di!==null;){w=Di;var M=w.sibling,F=w.return;if(d9(w),w===v){Di=null;break}if(M!==null){M.return=F,Di=M;break}Di=F}}}var N=o.alternate;if(N!==null){var z=N.child;if(z!==null){N.child=null;do{var L=z.sibling;z.sibling=null,z=L}while(z!==null)}}Di=o}}if(o.subtreeFlags&2064&&c!==null)c.return=o,Di=c;else e:for(;Di!==null;){if(o=Di,o.flags&2048)switch(o.tag){case 0:case 11:case 15:v1(9,o,o.return)}var P=o.sibling;if(P!==null){P.return=o.return,Di=P;break e}Di=o.return}}var H=t.current;for(Di=H;Di!==null;){c=Di;var j=c.child;if(c.subtreeFlags&2064&&j!==null)j.return=c,Di=j;else e:for(c=H;Di!==null;){if(s=Di,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:mA(9,s)}}catch(le){qo(s,s.return,le)}if(s===c){Di=null;break e}var q=s.sibling;if(q!==null){q.return=s.return,Di=q;break e}Di=s.return}}if(ws=r,vv(),_f&&typeof _f.onPostCommitFiberRoot=="function")try{_f.onPostCommitFiberRoot(aA,t)}catch{}i=!0}return i}finally{Bs=n,Ju.transition=e}}return!1}function WG(t,e,n){e=Jx(n,e),e=t9(t,e,1),t=qg(t,e,1),e=Yl(),t!==null&&(FS(t,1,e),zc(t,e))}function qo(t,e,n){if(t.tag===3)WG(t,t,n);else for(;e!==null;){if(e.tag===3){WG(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Zg===null||!Zg.has(i))){t=Jx(n,t),t=n9(e,t,1),e=qg(e,t,1),t=Yl(),e!==null&&(FS(e,1,t),zc(e,t));break}}e=e.return}}function ire(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Yl(),t.pingedLanes|=t.suspendedLanes&n,Ga===t&&(Qa&n)===n&&(Ea===4||Ea===3&&(Qa&130023424)===Qa&&500>aa()-GN?Yy(t,0):VN|=n),zc(t,e)}function C9(t,e){e===0&&(t.mode&1?(e=dE,dE<<=1,!(dE&130023424)&&(dE=4194304)):e=1);var n=Yl();t=Xp(t,e),t!==null&&(FS(t,e,n),zc(t,n))}function rre(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),C9(t,n)}function sre(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(ei(314))}i!==null&&i.delete(e),C9(t,n)}var S9;S9=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Nc.current)Lc=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Lc=!1,$ie(t,e,n);Lc=!!(t.flags&131072)}else Lc=!1,_o&&e.flags&1048576&&R8(e,AR,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;YM(t,e),t=e.pendingProps;var r=Zx(e,bl.current);Ex(e,n),r=ON(null,e,i,t,r,n);var o=kN();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bc(i)?(o=!0,RR(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,PN(e),r.updater=pA,e.stateNode=r,r._reactInternals=e,IF(e,i,t,n),e=LF(null,e,i,!0,o,n)):(e.tag=0,_o&&o&&SN(e),jl(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(YM(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=are(i),t=$h(i,t),r){case 0:e=FF(null,e,i,t,n);break e;case 1:e=LG(null,e,i,t,n);break e;case 11:e=DG(null,e,i,t,n);break e;case 14:e=FG(null,e,i,$h(i.type,t),n);break e}throw Error(ei(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$h(i,r),FF(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$h(i,r),LG(t,e,i,r,n);case 3:e:{if(o9(e),t===null)throw Error(ei(387));i=e.pendingProps,o=e.memoizedState,r=o.element,F8(t,e),DR(e,i,null,n);var c=e.memoizedState;if(i=c.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:c.cache,pendingSuspenseBoundaries:c.pendingSuspenseBoundaries,transitions:c.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=Jx(Error(ei(423)),e),e=OG(t,e,i,n,r);break e}else if(i!==r){r=Jx(Error(ei(424)),e),e=OG(t,e,i,n,r);break e}else for(mu=$g(e.stateNode.containerInfo.firstChild),vu=e,_o=!0,Yh=null,n=I8(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Xx(),i===r){e=Kp(t,e,n);break e}jl(t,e,i,n)}e=e.child}return e;case 5:return L8(e),t===null&&TF(e),i=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,c=r.children,SF(i,r)?c=null:o!==null&&SF(i,o)&&(e.flags|=32),s9(t,e),jl(t,e,c,n),e.child;case 6:return t===null&&TF(e),null;case 13:return a9(t,e,n);case 4:return IN(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Kx(e,null,i,n):jl(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$h(i,r),DG(t,e,i,r,n);case 7:return jl(t,e,e.pendingProps,n),e.child;case 8:return jl(t,e,e.pendingProps.children,n),e.child;case 12:return jl(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,c=r.value,Ys(PR,i._currentValue),i._currentValue=c,o!==null)if(ad(o.value,c)){if(o.children===r.children&&!Nc.current){e=Kp(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){c=o.child;for(var f=s.firstContext;f!==null;){if(f.context===i){if(o.tag===1){f=zp(-1,n&-n),f.tag=2;var v=o.updateQueue;if(v!==null){v=v.shared;var w=v.pending;w===null?f.next=f:(f.next=w.next,w.next=f),v.pending=f}}o.lanes|=n,f=o.alternate,f!==null&&(f.lanes|=n),AF(o.return,n,e),s.lanes|=n;break}f=f.next}}else if(o.tag===10)c=o.type===e.type?null:o.child;else if(o.tag===18){if(c=o.return,c===null)throw Error(ei(341));c.lanes|=n,s=c.alternate,s!==null&&(s.lanes|=n),AF(c,n,e),c=o.sibling}else c=o.child;if(c!==null)c.return=o;else for(c=o;c!==null;){if(c===e){c=null;break}if(o=c.sibling,o!==null){o.return=c.return,c=o;break}c=c.return}o=c}jl(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Ex(e,n),r=th(r),i=i(r),e.flags|=1,jl(t,e,i,n),e.child;case 14:return i=e.type,r=$h(i,e.pendingProps),r=$h(i.type,r),FG(t,e,i,r,n);case 15:return i9(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$h(i,r),YM(t,e),e.tag=1,Bc(i)?(t=!0,RR(e)):t=!1,Ex(e,n),e9(e,i,r),IF(e,i,r,n),LF(null,e,i,!0,t,n);case 19:return l9(t,e,n);case 22:return r9(t,e,n)}throw Error(ei(156,e.tag))};function b9(t,e){return Yj(t,e)}function ore(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zu(t,e,n,i){return new ore(t,e,n,i)}function $N(t){return t=t.prototype,!(!t||!t.isReactComponent)}function are(t){if(typeof t=="function")return $N(t)?1:0;if(t!=null){if(t=t.$$typeof,t===hN)return 11;if(t===dN)return 14}return 2}function Kg(t,e){var n=t.alternate;return n===null?(n=Zu(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function eR(t,e,n,i,r,o){var c=2;if(i=t,typeof t=="function")$N(t)&&(c=1);else if(typeof t=="string")c=5;else e:switch(t){case tx:return Jy(n.children,r,o,e);case uN:c=8,r|=8;break;case tF:return t=Zu(12,n,e,r|2),t.elementType=tF,t.lanes=o,t;case nF:return t=Zu(13,n,e,r),t.elementType=nF,t.lanes=o,t;case iF:return t=Zu(19,n,e,r),t.elementType=iF,t.lanes=o,t;case Lj:return vA(n,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Dj:c=10;break e;case Fj:c=9;break e;case hN:c=11;break e;case dN:c=14;break e;case Mg:c=16,i=null;break e}throw Error(ei(130,t==null?t:typeof t,""))}return e=Zu(c,n,e,r),e.elementType=t,e.type=i,e.lanes=o,e}function Jy(t,e,n,i){return t=Zu(7,t,i,e),t.lanes=n,t}function vA(t,e,n,i){return t=Zu(22,t,i,e),t.elementType=Lj,t.lanes=n,t.stateNode={isHidden:!1},t}function iD(t,e,n){return t=Zu(6,t,null,e),t.lanes=n,t}function rD(t,e,n){return e=Zu(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function lre(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=BI(0),this.expirationTimes=BI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=BI(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function qN(t,e,n,i,r,o,c,s,f){return t=new lre(t,e,n,s,f),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Zu(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},PN(o),t}function cre(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ex,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function E9(t){if(!t)return rv;t=t._reactInternals;e:{if(D_(t)!==t||t.tag!==1)throw Error(ei(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ei(171))}if(t.tag===1){var n=t.type;if(Bc(n))return E8(t,n,e)}return e}function M9(t,e,n,i,r,o,c,s,f){return t=qN(n,i,!0,t,r,o,c,s,f),t.context=E9(null),n=t.current,i=Yl(),r=Xg(n),o=zp(i,r),o.callback=e??null,qg(n,o,r),t.current.lanes=r,FS(t,r,i),zc(t,i),t}function yA(t,e,n,i){var r=e.current,o=Yl(),c=Xg(r);return n=E9(n),e.context===null?e.context=n:e.pendingContext=n,e=zp(o,c),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=qg(r,e,c),t!==null&&(rd(t,r,c,o),ZM(t,r,c)),c}function UR(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jG(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ZN(t,e){jG(t,e),(t=t.alternate)&&jG(t,e)}function ure(){return null}var R9=typeof reportError=="function"?reportError:function(t){console.error(t)};function XN(t){this._internalRoot=t}_A.prototype.render=XN.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ei(409));yA(t,e,null,null)};_A.prototype.unmount=XN.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;m_(function(){yA(null,t,null,null)}),e[Zp]=null}};function _A(t){this._internalRoot=t}_A.prototype.unstable_scheduleHydration=function(t){if(t){var e=r8();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ag.length&&e!==0&&e<Ag[n].priority;n++);Ag.splice(n,0,t),n===0&&o8(t)}};function KN(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xA(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $G(){}function hre(t,e,n,i,r){if(r){if(typeof i=="function"){var o=i;i=function(){var v=UR(c);o.call(v)}}var c=M9(e,i,t,0,null,!1,!1,"",$G);return t._reactRootContainer=c,t[Zp]=c.current,W1(t.nodeType===8?t.parentNode:t),m_(),c}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var s=i;i=function(){var v=UR(f);s.call(v)}}var f=qN(t,0,!1,null,null,!1,!1,"",$G);return t._reactRootContainer=f,t[Zp]=f.current,W1(t.nodeType===8?t.parentNode:t),m_(function(){yA(e,f,n,i)}),f}function wA(t,e,n,i,r){var o=n._reactRootContainer;if(o){var c=o;if(typeof r=="function"){var s=r;r=function(){var f=UR(c);s.call(f)}}yA(e,c,t,r)}else c=hre(n,e,t,r,i);return UR(c)}n8=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=n1(e.pendingLanes);n!==0&&(mN(e,n|1),zc(e,aa()),!(ws&6)&&(Qx=aa()+500,vv()))}break;case 13:m_(function(){var i=Xp(t,1);if(i!==null){var r=Yl();rd(i,t,1,r)}}),ZN(t,1)}};gN=function(t){if(t.tag===13){var e=Xp(t,134217728);if(e!==null){var n=Yl();rd(e,t,134217728,n)}ZN(t,134217728)}};i8=function(t){if(t.tag===13){var e=Xg(t),n=Xp(t,e);if(n!==null){var i=Yl();rd(n,t,e,i)}ZN(t,e)}};r8=function(){return Bs};s8=function(t,e){var n=Bs;try{return Bs=t,e()}finally{Bs=n}};fF=function(t,e,n){switch(e){case"input":if(oF(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=hA(i);if(!r)throw Error(ei(90));kj(i),oF(i,r)}}}break;case"textarea":Bj(t,n);break;case"select":e=n.value,e!=null&&wx(t,!!n.multiple,e,!1)}};jj=HN;$j=m_;var dre={usingClientEntryPoint:!1,Events:[OS,sx,hA,Hj,Wj,HN]},IC={findFiberByHostInstance:Ly,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fre={bundleType:IC.bundleType,version:IC.version,rendererPackageName:IC.rendererPackageName,rendererConfig:IC.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:am.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Xj(t),t===null?null:t.stateNode},findFiberByHostInstance:IC.findFiberByHostInstance||ure,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var SE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!SE.isDisabled&&SE.supportsFiber)try{aA=SE.inject(fre),_f=SE}catch{}}Su.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dre;Su.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!KN(e))throw Error(ei(200));return cre(t,e,null,n)};Su.createRoot=function(t,e){if(!KN(t))throw Error(ei(299));var n=!1,i="",r=R9;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=qN(t,1,!1,null,null,n,!1,i,r),t[Zp]=e.current,W1(t.nodeType===8?t.parentNode:t),new XN(e)};Su.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ei(188)):(t=Object.keys(t).join(","),Error(ei(268,t)));return t=Xj(e),t=t===null?null:t.stateNode,t};Su.flushSync=function(t){return m_(t)};Su.hydrate=function(t,e,n){if(!xA(e))throw Error(ei(200));return wA(null,t,e,!0,n)};Su.hydrateRoot=function(t,e,n){if(!KN(t))throw Error(ei(405));var i=n!=null&&n.hydratedSources||null,r=!1,o="",c=R9;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(c=n.onRecoverableError)),e=M9(e,null,t,1,n??null,r,!1,o,c),t[Zp]=e.current,W1(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new _A(e)};Su.render=function(t,e,n){if(!xA(e))throw Error(ei(200));return wA(null,t,e,!1,n)};Su.unmountComponentAtNode=function(t){if(!xA(t))throw Error(ei(40));return t._reactRootContainer?(m_(function(){wA(null,null,t,!1,function(){t._reactRootContainer=null,t[Zp]=null})}),!0):!1};Su.unstable_batchedUpdates=HN;Su.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!xA(n))throw Error(ei(200));if(t==null||t._reactInternals===void 0)throw Error(ei(38));return wA(t,e,n,!1,i)};Su.version="18.3.1-next-f1338f8080-20240426";function T9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(T9)}catch(t){console.error(t)}}T9(),Tj.exports=Su;var rh=Tj.exports;const VR=pv(rh);var qG=rh;Q2.createRoot=qG.createRoot,Q2.hydrateRoot=qG.hydrateRoot;const CA="/myway_logo.svg";var A9={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ZG=kn.createContext&&kn.createContext(A9),pre=["attr","size","title"];function mre(t,e){if(t==null)return{};var n=gre(t,e),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function gre(t,e){if(t==null)return{};var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;n[i]=t[i]}return n}function GR(){return GR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},GR.apply(this,arguments)}function XG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function HR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XG(Object(n),!0).forEach(function(i){vre(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XG(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function vre(t,e,n){return e=yre(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yre(t){var e=_re(t,"string");return typeof e=="symbol"?e:e+""}function _re(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function P9(t){return t&&t.map((e,n)=>kn.createElement(e.tag,HR({key:n},e.attr),P9(e.child)))}function pd(t){return e=>kn.createElement(xre,GR({attr:HR({},t.attr)},e),P9(t.child))}function xre(t){var e=n=>{var{attr:i,size:r,title:o}=t,c=mre(t,pre),s=r||n.size||"1em",f;return n.className&&(f=n.className),t.className&&(f=(f?f+" ":"")+t.className),kn.createElement("svg",GR({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,c,{className:f,style:HR(HR({color:t.color||n.color},n.style),t.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&kn.createElement("title",null,o),t.children)};return ZG!==void 0?kn.createElement(ZG.Consumer,null,n=>e(n)):e(A9)}function wre(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"},child:[]},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"},child:[]}]})(t)}function Cre(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"8",y1:"6",x2:"21",y2:"6"},child:[]},{tag:"line",attr:{x1:"8",y1:"12",x2:"21",y2:"12"},child:[]},{tag:"line",attr:{x1:"8",y1:"18",x2:"21",y2:"18"},child:[]},{tag:"line",attr:{x1:"3",y1:"6",x2:"3.01",y2:"6"},child:[]},{tag:"line",attr:{x1:"3",y1:"12",x2:"3.01",y2:"12"},child:[]},{tag:"line",attr:{x1:"3",y1:"18",x2:"3.01",y2:"18"},child:[]}]})(t)}function Sre(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"10",r:"3"},child:[]}]})(t)}function bre(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"},child:[]}]})(t)}function Ere(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"9",cy:"21",r:"1"},child:[]},{tag:"circle",attr:{cx:"20",cy:"21",r:"1"},child:[]},{tag:"path",attr:{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"},child:[]}]})(t)}/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Q1(){return Q1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Q1.apply(this,arguments)}var Gg;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Gg||(Gg={}));const KG="popstate";function Mre(t){t===void 0&&(t={});function e(i,r){let{pathname:o,search:c,hash:s}=i.location;return $F("",{pathname:o,search:c,hash:s},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:D9(r)}return Tre(e,n,null,t)}function Ra(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function I9(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Rre(){return Math.random().toString(36).substr(2,8)}function YG(t,e){return{usr:t.state,key:t.key,idx:e}}function $F(t,e,n,i){return n===void 0&&(n=null),Q1({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?pw(e):e,{state:n,key:e&&e.key||i||Rre()})}function D9(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function pw(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function Tre(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:o=!1}=i,c=r.history,s=Gg.Pop,f=null,v=w();v==null&&(v=0,c.replaceState(Q1({},c.state,{idx:v}),""));function w(){return(c.state||{idx:null}).idx}function C(){s=Gg.Pop;let L=w(),P=L==null?null:L-v;v=L,f&&f({action:s,location:z.location,delta:P})}function M(L,P){s=Gg.Push;let H=$F(z.location,L,P);v=w()+1;let j=YG(H,v),q=z.createHref(H);try{c.pushState(j,"",q)}catch(le){if(le instanceof DOMException&&le.name==="DataCloneError")throw le;r.location.assign(q)}o&&f&&f({action:s,location:z.location,delta:1})}function F(L,P){s=Gg.Replace;let H=$F(z.location,L,P);v=w();let j=YG(H,v),q=z.createHref(H);c.replaceState(j,"",q),o&&f&&f({action:s,location:z.location,delta:0})}function N(L){let P=r.location.origin!=="null"?r.location.origin:r.location.href,H=typeof L=="string"?L:D9(L);return H=H.replace(/ $/,"%20"),Ra(P,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,P)}let z={get action(){return s},get location(){return t(r,c)},listen(L){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(KG,C),f=L,()=>{r.removeEventListener(KG,C),f=null}},createHref(L){return e(r,L)},createURL:N,encodeLocation(L){let P=N(L);return{pathname:P.pathname,search:P.search,hash:P.hash}},push:M,replace:F,go(L){return c.go(L)}};return z}var JG;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(JG||(JG={}));function Are(t,e,n){return n===void 0&&(n="/"),Pre(t,e,n,!1)}function Pre(t,e,n,i){let r=typeof e=="string"?pw(e):e,o=O9(r.pathname||"/",n);if(o==null)return null;let c=F9(t);Ire(c);let s=null;for(let f=0;s==null&&f<c.length;++f){let v=Gre(o);s=Ure(c[f],v,i)}return s}function F9(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(o,c,s)=>{let f={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:c,route:o};f.relativePath.startsWith("/")&&(Ra(f.relativePath.startsWith(i),'Absolute route path "'+f.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),f.relativePath=f.relativePath.slice(i.length));let v=Qy([i,f.relativePath]),w=n.concat(f);o.children&&o.children.length>0&&(Ra(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+v+'".')),F9(o.children,e,w,v)),!(o.path==null&&!o.index)&&e.push({path:v,score:Bre(v,o.index),routesMeta:w})};return t.forEach((o,c)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))r(o,c);else for(let f of L9(o.path))r(o,c,f)}),e}function L9(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(i.length===0)return r?[o,""]:[o];let c=L9(i.join("/")),s=[];return s.push(...c.map(f=>f===""?o:[o,f].join("/"))),r&&s.push(...c),s.map(f=>t.startsWith("/")&&f===""?"/":f)}function Ire(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:zre(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const Dre=/^:[\w-]+$/,Fre=3,Lre=2,Ore=1,kre=10,Nre=-2,QG=t=>t==="*";function Bre(t,e){let n=t.split("/"),i=n.length;return n.some(QG)&&(i+=Nre),e&&(i+=Lre),n.filter(r=>!QG(r)).reduce((r,o)=>r+(Dre.test(o)?Fre:o===""?Ore:kre),i)}function zre(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function Ure(t,e,n){let{routesMeta:i}=t,r={},o="/",c=[];for(let s=0;s<i.length;++s){let f=i[s],v=s===i.length-1,w=o==="/"?e:e.slice(o.length)||"/",C=e5({path:f.relativePath,caseSensitive:f.caseSensitive,end:v},w),M=f.route;if(!C&&v&&n&&!i[i.length-1].route.index&&(C=e5({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},w)),!C)return null;Object.assign(r,C.params),c.push({params:r,pathname:Qy([o,C.pathname]),pathnameBase:Zre(Qy([o,C.pathnameBase])),route:M}),C.pathnameBase!=="/"&&(o=Qy([o,C.pathnameBase]))}return c}function e5(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=Vre(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let o=r[0],c=o.replace(/(.)\/+$/,"$1"),s=r.slice(1);return{params:i.reduce((v,w,C)=>{let{paramName:M,isOptional:F}=w;if(M==="*"){let z=s[C]||"";c=o.slice(0,o.length-z.length).replace(/(.)\/+$/,"$1")}const N=s[C];return F&&!N?v[M]=void 0:v[M]=(N||"").replace(/%2F/g,"/"),v},{}),pathname:o,pathnameBase:c,pattern:t}}function Vre(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),I9(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,s,f)=>(i.push({paramName:s,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function Gre(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return I9(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function O9(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function Hre(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?pw(t):t;return{pathname:n?n.startsWith("/")?n:Wre(n,e):e,search:Xre(i),hash:Kre(r)}}function Wre(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function sD(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jre(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function $re(t,e){let n=jre(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function qre(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=pw(t):(r=Q1({},t),Ra(!r.pathname||!r.pathname.includes("?"),sD("?","pathname","search",r)),Ra(!r.pathname||!r.pathname.includes("#"),sD("#","pathname","hash",r)),Ra(!r.search||!r.search.includes("#"),sD("#","search","hash",r)));let o=t===""||r.pathname==="",c=o?"/":r.pathname,s;if(c==null)s=n;else{let C=e.length-1;if(!i&&c.startsWith("..")){let M=c.split("/");for(;M[0]==="..";)M.shift(),C-=1;r.pathname=M.join("/")}s=C>=0?e[C]:"/"}let f=Hre(r,s),v=c&&c!=="/"&&c.endsWith("/"),w=(o||c===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(v||w)&&(f.pathname+="/"),f}const Qy=t=>t.join("/").replace(/\/\/+/g,"/"),Zre=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Xre=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Kre=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Yre(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const k9=["post","put","patch","delete"];new Set(k9);const Jre=["get",...k9];new Set(Jre);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eS(){return eS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},eS.apply(this,arguments)}const YN=Q.createContext(null),Qre=Q.createContext(null),SA=Q.createContext(null),bA=Q.createContext(null),yv=Q.createContext({outlet:null,matches:[],isDataRoute:!1}),N9=Q.createContext(null);function EA(){return Q.useContext(bA)!=null}function mw(){return EA()||Ra(!1),Q.useContext(bA).location}function B9(t){Q.useContext(SA).static||Q.useLayoutEffect(t)}function lm(){let{isDataRoute:t}=Q.useContext(yv);return t?pse():ese()}function ese(){EA()||Ra(!1);let t=Q.useContext(YN),{basename:e,future:n,navigator:i}=Q.useContext(SA),{matches:r}=Q.useContext(yv),{pathname:o}=mw(),c=JSON.stringify($re(r,n.v7_relativeSplatPath)),s=Q.useRef(!1);return B9(()=>{s.current=!0}),Q.useCallback(function(v,w){if(w===void 0&&(w={}),!s.current)return;if(typeof v=="number"){i.go(v);return}let C=qre(v,JSON.parse(c),o,w.relative==="path");t==null&&e!=="/"&&(C.pathname=C.pathname==="/"?e:Qy([e,C.pathname])),(w.replace?i.replace:i.push)(C,w.state,w)},[e,i,c,o,t])}const tse=Q.createContext(null);function nse(t){let e=Q.useContext(yv).outlet;return e&&Q.createElement(tse.Provider,{value:t},e)}function F_(){let{matches:t}=Q.useContext(yv),e=t[t.length-1];return e?e.params:{}}function ise(t,e){return rse(t,e)}function rse(t,e,n,i){EA()||Ra(!1);let{navigator:r}=Q.useContext(SA),{matches:o}=Q.useContext(yv),c=o[o.length-1],s=c?c.params:{};c&&c.pathname;let f=c?c.pathnameBase:"/";c&&c.route;let v=mw(),w;if(e){var C;let L=typeof e=="string"?pw(e):e;f==="/"||(C=L.pathname)!=null&&C.startsWith(f)||Ra(!1),w=L}else w=v;let M=w.pathname||"/",F=M;if(f!=="/"){let L=f.replace(/^\//,"").split("/");F="/"+M.replace(/^\//,"").split("/").slice(L.length).join("/")}let N=Are(t,{pathname:F}),z=cse(N&&N.map(L=>Object.assign({},L,{params:Object.assign({},s,L.params),pathname:Qy([f,r.encodeLocation?r.encodeLocation(L.pathname).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?f:Qy([f,r.encodeLocation?r.encodeLocation(L.pathnameBase).pathname:L.pathnameBase])})),o,n,i);return e&&z?Q.createElement(bA.Provider,{value:{location:eS({pathname:"/",search:"",hash:"",state:null,key:"default"},w),navigationType:Gg.Pop}},z):z}function sse(){let t=fse(),e=Yre(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},e),n?Q.createElement("pre",{style:r},n):null,null)}const ose=Q.createElement(sse,null);class ase extends Q.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?Q.createElement(yv.Provider,{value:this.props.routeContext},Q.createElement(N9.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function lse(t){let{routeContext:e,match:n,children:i}=t,r=Q.useContext(YN);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),Q.createElement(yv.Provider,{value:e},i)}function cse(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=i)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let c=t,s=(r=n)==null?void 0:r.errors;if(s!=null){let w=c.findIndex(C=>C.route.id&&(s==null?void 0:s[C.route.id])!==void 0);w>=0||Ra(!1),c=c.slice(0,Math.min(c.length,w+1))}let f=!1,v=-1;if(n&&i&&i.v7_partialHydration)for(let w=0;w<c.length;w++){let C=c[w];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(v=w),C.route.id){let{loaderData:M,errors:F}=n,N=C.route.loader&&M[C.route.id]===void 0&&(!F||F[C.route.id]===void 0);if(C.route.lazy||N){f=!0,v>=0?c=c.slice(0,v+1):c=[c[0]];break}}}return c.reduceRight((w,C,M)=>{let F,N=!1,z=null,L=null;n&&(F=s&&C.route.id?s[C.route.id]:void 0,z=C.route.errorElement||ose,f&&(v<0&&M===0?(N=!0,L=null):v===M&&(N=!0,L=C.route.hydrateFallbackElement||null)));let P=e.concat(c.slice(0,M+1)),H=()=>{let j;return F?j=z:N?j=L:C.route.Component?j=Q.createElement(C.route.Component,null):C.route.element?j=C.route.element:j=w,Q.createElement(lse,{match:C,routeContext:{outlet:w,matches:P,isDataRoute:n!=null},children:j})};return n&&(C.route.ErrorBoundary||C.route.errorElement||M===0)?Q.createElement(ase,{location:n.location,revalidation:n.revalidation,component:z,error:F,children:H(),routeContext:{outlet:null,matches:P,isDataRoute:!0}}):H()},null)}var z9=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(z9||{}),WR=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(WR||{});function use(t){let e=Q.useContext(YN);return e||Ra(!1),e}function hse(t){let e=Q.useContext(Qre);return e||Ra(!1),e}function dse(t){let e=Q.useContext(yv);return e||Ra(!1),e}function U9(t){let e=dse(),n=e.matches[e.matches.length-1];return n.route.id||Ra(!1),n.route.id}function fse(){var t;let e=Q.useContext(N9),n=hse(WR.UseRouteError),i=U9(WR.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function pse(){let{router:t}=use(z9.UseNavigateStable),e=U9(WR.UseNavigateStable),n=Q.useRef(!1);return B9(()=>{n.current=!0}),Q.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,eS({fromRouteId:e},o)))},[t,e])}function mse(t){return nse(t.context)}function Rp(t){Ra(!1)}function gse(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Gg.Pop,navigator:o,static:c=!1,future:s}=t;EA()&&Ra(!1);let f=e.replace(/^\/*/,"/"),v=Q.useMemo(()=>({basename:f,navigator:o,static:c,future:eS({v7_relativeSplatPath:!1},s)}),[f,s,o,c]);typeof i=="string"&&(i=pw(i));let{pathname:w="/",search:C="",hash:M="",state:F=null,key:N="default"}=i,z=Q.useMemo(()=>{let L=O9(w,f);return L==null?null:{location:{pathname:L,search:C,hash:M,state:F,key:N},navigationType:r}},[f,w,C,M,F,N,r]);return z==null?null:Q.createElement(SA.Provider,{value:v},Q.createElement(bA.Provider,{children:n,value:z}))}function vse(t){let{children:e,location:n}=t;return ise(qF(e),n)}new Promise(()=>{});function qF(t,e){e===void 0&&(e=[]);let n=[];return Q.Children.forEach(t,(i,r)=>{if(!Q.isValidElement(i))return;let o=[...e,r];if(i.type===Q.Fragment){n.push.apply(n,qF(i.props.children,o));return}i.type!==Rp&&Ra(!1),!i.props.index||!i.props.children||Ra(!1);let c={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=qF(i.props.children,o)),n.push(c)}),n}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ZF(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let i=t[n];return e.concat(Array.isArray(i)?i.map(r=>[n,r]):[[n,i]])},[]))}function yse(t,e){let n=ZF(t);return e&&e.forEach((i,r)=>{n.has(r)||e.getAll(r).forEach(o=>{n.append(r,o)})}),n}const _se="6";try{window.__reactRouterVersion=_se}catch{}const xse="startTransition",t5=Mj[xse];function wse(t){let{basename:e,children:n,future:i,window:r}=t,o=Q.useRef();o.current==null&&(o.current=Mre({window:r,v5Compat:!0}));let c=o.current,[s,f]=Q.useState({action:c.action,location:c.location}),{v7_startTransition:v}=i||{},w=Q.useCallback(C=>{v&&t5?t5(()=>f(C)):f(C)},[f,v]);return Q.useLayoutEffect(()=>c.listen(w),[c,w]),Q.createElement(gse,{basename:e,children:n,location:s.location,navigationType:s.action,navigator:c,future:i})}var n5;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(n5||(n5={}));var i5;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(i5||(i5={}));function Cse(t){let e=Q.useRef(ZF(t)),n=Q.useRef(!1),i=mw(),r=Q.useMemo(()=>yse(i.search,n.current?null:e.current),[i.search]),o=lm(),c=Q.useCallback((s,f)=>{const v=ZF(typeof s=="function"?s(r):s);n.current=!0,o("?"+v,f)},[o,r]);return[r,c]}function V9(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=V9(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function Sse(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=V9(t))&&(i&&(i+=" "),i+=e);return i}const JN="-";function bse(t){const e=Mse(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;function r(c){const s=c.split(JN);return s[0]===""&&s.length!==1&&s.shift(),G9(s,e)||Ese(c)}function o(c,s){const f=n[c]||[];return s&&i[c]?[...f,...i[c]]:f}return{getClassGroupId:r,getConflictingClassGroupIds:o}}function G9(t,e){var c;if(t.length===0)return e.classGroupId;const n=t[0],i=e.nextPart.get(n),r=i?G9(t.slice(1),i):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join(JN);return(c=e.validators.find(({validator:s})=>s(o)))==null?void 0:c.classGroupId}const r5=/^\[(.+)\]$/;function Ese(t){if(r5.test(t)){const e=r5.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}}function Mse(t){const{theme:e,prefix:n}=t,i={nextPart:new Map,validators:[]};return Tse(Object.entries(t.classGroups),n).forEach(([o,c])=>{XF(c,i,o,e)}),i}function XF(t,e,n,i){t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:s5(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(Rse(r)){XF(r(i),e,n,i);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,c])=>{XF(c,s5(e,o),n,i)})})}function s5(t,e){let n=t;return e.split(JN).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n}function Rse(t){return t.isThemeGetter}function Tse(t,e){return e?t.map(([n,i])=>{const r=i.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([c,s])=>[e+c,s])):o);return[n,r]}):t}function Ase(t){if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,i=new Map;function r(o,c){n.set(o,c),e++,e>t&&(e=0,i=n,n=new Map)}return{get(o){let c=n.get(o);if(c!==void 0)return c;if((c=i.get(o))!==void 0)return r(o,c),c},set(o,c){n.has(o)?n.set(o,c):r(o,c)}}}const H9="!";function Pse(t){const{separator:e,experimentalParseClassName:n}=t,i=e.length===1,r=e[0],o=e.length;function c(s){const f=[];let v=0,w=0,C;for(let L=0;L<s.length;L++){let P=s[L];if(v===0){if(P===r&&(i||s.slice(L,L+o)===e)){f.push(s.slice(w,L)),w=L+o;continue}if(P==="/"){C=L;continue}}P==="["?v++:P==="]"&&v--}const M=f.length===0?s:s.substring(w),F=M.startsWith(H9),N=F?M.substring(1):M,z=C&&C>w?C-w:void 0;return{modifiers:f,hasImportantModifier:F,baseClassName:N,maybePostfixModifierPosition:z}}return n?function(f){return n({className:f,parseClassName:c})}:c}function Ise(t){if(t.length<=1)return t;const e=[];let n=[];return t.forEach(i=>{i[0]==="["?(e.push(...n.sort(),i),n=[]):n.push(i)}),e.push(...n.sort()),e}function Dse(t){return{cache:Ase(t.cacheSize),parseClassName:Pse(t),...bse(t)}}const Fse=/\s+/;function Lse(t,e){const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r}=e,o=new Set;return t.trim().split(Fse).map(c=>{const{modifiers:s,hasImportantModifier:f,baseClassName:v,maybePostfixModifierPosition:w}=n(c);let C=!!w,M=i(C?v.substring(0,w):v);if(!M){if(!C)return{isTailwindClass:!1,originalClassName:c};if(M=i(v),!M)return{isTailwindClass:!1,originalClassName:c};C=!1}const F=Ise(s).join(":");return{isTailwindClass:!0,modifierId:f?F+H9:F,classGroupId:M,originalClassName:c,hasPostfixModifier:C}}).reverse().filter(c=>{if(!c.isTailwindClass)return!0;const{modifierId:s,classGroupId:f,hasPostfixModifier:v}=c,w=s+f;return o.has(w)?!1:(o.add(w),r(f,v).forEach(C=>o.add(s+C)),!0)}).reverse().map(c=>c.originalClassName).join(" ")}function Ose(){let t=0,e,n,i="";for(;t<arguments.length;)(e=arguments[t++])&&(n=W9(e))&&(i&&(i+=" "),i+=n);return i}function W9(t){if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=W9(t[i]))&&(n&&(n+=" "),n+=e);return n}function kse(t,...e){let n,i,r,o=c;function c(f){const v=e.reduce((w,C)=>C(w),t());return n=Dse(v),i=n.cache.get,r=n.cache.set,o=s,s(f)}function s(f){const v=i(f);if(v)return v;const w=Lse(f,n);return r(f,w),w}return function(){return o(Ose.apply(null,arguments))}}function oo(t){const e=n=>n[t]||[];return e.isThemeGetter=!0,e}const j9=/^\[(?:([a-z-]+):)?(.+)\]$/i,Nse=/^\d+\/\d+$/,Bse=new Set(["px","full","screen"]),zse=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Use=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Vse=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Gse=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Hse=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function yp(t){return Ny(t)||Bse.has(t)||Nse.test(t)}function dg(t){return gw(t,"length",Yse)}function Ny(t){return!!t&&!Number.isNaN(Number(t))}function bE(t){return gw(t,"number",Ny)}function DC(t){return!!t&&Number.isInteger(Number(t))}function Wse(t){return t.endsWith("%")&&Ny(t.slice(0,-1))}function Or(t){return j9.test(t)}function fg(t){return zse.test(t)}const jse=new Set(["length","size","percentage"]);function $se(t){return gw(t,jse,$9)}function qse(t){return gw(t,"position",$9)}const Zse=new Set(["image","url"]);function Xse(t){return gw(t,Zse,Qse)}function Kse(t){return gw(t,"",Jse)}function FC(){return!0}function gw(t,e,n){const i=j9.exec(t);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):n(i[2]):!1}function Yse(t){return Use.test(t)&&!Vse.test(t)}function $9(){return!1}function Jse(t){return Gse.test(t)}function Qse(t){return Hse.test(t)}function eoe(){const t=oo("colors"),e=oo("spacing"),n=oo("blur"),i=oo("brightness"),r=oo("borderColor"),o=oo("borderRadius"),c=oo("borderSpacing"),s=oo("borderWidth"),f=oo("contrast"),v=oo("grayscale"),w=oo("hueRotate"),C=oo("invert"),M=oo("gap"),F=oo("gradientColorStops"),N=oo("gradientColorStopPositions"),z=oo("inset"),L=oo("margin"),P=oo("opacity"),H=oo("padding"),j=oo("saturate"),q=oo("scale"),le=oo("sepia"),ce=oo("skew"),ae=oo("space"),pe=oo("translate"),fe=()=>["auto","contain","none"],ue=()=>["auto","hidden","clip","visible","scroll"],Ee=()=>["auto",Or,e],We=()=>[Or,e],rt=()=>["",yp,dg],tt=()=>["auto",Ny,Or],Ye=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],qe=()=>["solid","dashed","dotted","double","none"],ft=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Me=()=>["start","end","center","between","around","evenly","stretch"],$e=()=>["","0",Or],ut=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[Ny,bE],Gt=()=>[Ny,Or];return{cacheSize:500,separator:":",theme:{colors:[FC],spacing:[yp,dg],blur:["none","",fg,Or],brightness:Mt(),borderColor:[t],borderRadius:["none","","full",fg,Or],borderSpacing:We(),borderWidth:rt(),contrast:Mt(),grayscale:$e(),hueRotate:Gt(),invert:$e(),gap:We(),gradientColorStops:[t],gradientColorStopPositions:[Wse,dg],inset:Ee(),margin:Ee(),opacity:Mt(),padding:We(),saturate:Mt(),scale:Mt(),sepia:$e(),skew:Gt(),space:We(),translate:We()},classGroups:{aspect:[{aspect:["auto","square","video",Or]}],container:["container"],columns:[{columns:[fg]}],"break-after":[{"break-after":ut()}],"break-before":[{"break-before":ut()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ye(),Or]}],overflow:[{overflow:ue()}],"overflow-x":[{"overflow-x":ue()}],"overflow-y":[{"overflow-y":ue()}],overscroll:[{overscroll:fe()}],"overscroll-x":[{"overscroll-x":fe()}],"overscroll-y":[{"overscroll-y":fe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[z]}],"inset-x":[{"inset-x":[z]}],"inset-y":[{"inset-y":[z]}],start:[{start:[z]}],end:[{end:[z]}],top:[{top:[z]}],right:[{right:[z]}],bottom:[{bottom:[z]}],left:[{left:[z]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",DC,Or]}],basis:[{basis:Ee()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Or]}],grow:[{grow:$e()}],shrink:[{shrink:$e()}],order:[{order:["first","last","none",DC,Or]}],"grid-cols":[{"grid-cols":[FC]}],"col-start-end":[{col:["auto",{span:["full",DC,Or]},Or]}],"col-start":[{"col-start":tt()}],"col-end":[{"col-end":tt()}],"grid-rows":[{"grid-rows":[FC]}],"row-start-end":[{row:["auto",{span:[DC,Or]},Or]}],"row-start":[{"row-start":tt()}],"row-end":[{"row-end":tt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Or]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Or]}],gap:[{gap:[M]}],"gap-x":[{"gap-x":[M]}],"gap-y":[{"gap-y":[M]}],"justify-content":[{justify:["normal",...Me()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Me(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Me(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[H]}],px:[{px:[H]}],py:[{py:[H]}],ps:[{ps:[H]}],pe:[{pe:[H]}],pt:[{pt:[H]}],pr:[{pr:[H]}],pb:[{pb:[H]}],pl:[{pl:[H]}],m:[{m:[L]}],mx:[{mx:[L]}],my:[{my:[L]}],ms:[{ms:[L]}],me:[{me:[L]}],mt:[{mt:[L]}],mr:[{mr:[L]}],mb:[{mb:[L]}],ml:[{ml:[L]}],"space-x":[{"space-x":[ae]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ae]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Or,e]}],"min-w":[{"min-w":[Or,e,"min","max","fit"]}],"max-w":[{"max-w":[Or,e,"none","full","min","max","fit","prose",{screen:[fg]},fg]}],h:[{h:[Or,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Or,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Or,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Or,e,"auto","min","max","fit"]}],"font-size":[{text:["base",fg,dg]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",bE]}],"font-family":[{font:[FC]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Or]}],"line-clamp":[{"line-clamp":["none",Ny,bE]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",yp,Or]}],"list-image":[{"list-image":["none",Or]}],"list-style-type":[{list:["none","disc","decimal",Or]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[P]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[P]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...qe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",yp,dg]}],"underline-offset":[{"underline-offset":["auto",yp,Or]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:We()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Or]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Or]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[P]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ye(),qse]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",$se]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Xse]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[N]}],"gradient-via-pos":[{via:[N]}],"gradient-to-pos":[{to:[N]}],"gradient-from":[{from:[F]}],"gradient-via":[{via:[F]}],"gradient-to":[{to:[F]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[P]}],"border-style":[{border:[...qe(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[P]}],"divide-style":[{divide:qe()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...qe()]}],"outline-offset":[{"outline-offset":[yp,Or]}],"outline-w":[{outline:[yp,dg]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:rt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[P]}],"ring-offset-w":[{"ring-offset":[yp,dg]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",fg,Kse]}],"shadow-color":[{shadow:[FC]}],opacity:[{opacity:[P]}],"mix-blend":[{"mix-blend":[...ft(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ft()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[f]}],"drop-shadow":[{"drop-shadow":["","none",fg,Or]}],grayscale:[{grayscale:[v]}],"hue-rotate":[{"hue-rotate":[w]}],invert:[{invert:[C]}],saturate:[{saturate:[j]}],sepia:[{sepia:[le]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[f]}],"backdrop-grayscale":[{"backdrop-grayscale":[v]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[w]}],"backdrop-invert":[{"backdrop-invert":[C]}],"backdrop-opacity":[{"backdrop-opacity":[P]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[le]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Or]}],duration:[{duration:Gt()}],ease:[{ease:["linear","in","out","in-out",Or]}],delay:[{delay:Gt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Or]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[q]}],"scale-x":[{"scale-x":[q]}],"scale-y":[{"scale-y":[q]}],rotate:[{rotate:[DC,Or]}],"translate-x":[{"translate-x":[pe]}],"translate-y":[{"translate-y":[pe]}],"skew-x":[{"skew-x":[ce]}],"skew-y":[{"skew-y":[ce]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Or]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Or]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":We()}],"scroll-mx":[{"scroll-mx":We()}],"scroll-my":[{"scroll-my":We()}],"scroll-ms":[{"scroll-ms":We()}],"scroll-me":[{"scroll-me":We()}],"scroll-mt":[{"scroll-mt":We()}],"scroll-mr":[{"scroll-mr":We()}],"scroll-mb":[{"scroll-mb":We()}],"scroll-ml":[{"scroll-ml":We()}],"scroll-p":[{"scroll-p":We()}],"scroll-px":[{"scroll-px":We()}],"scroll-py":[{"scroll-py":We()}],"scroll-ps":[{"scroll-ps":We()}],"scroll-pe":[{"scroll-pe":We()}],"scroll-pt":[{"scroll-pt":We()}],"scroll-pr":[{"scroll-pr":We()}],"scroll-pb":[{"scroll-pb":We()}],"scroll-pl":[{"scroll-pl":We()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Or]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[yp,dg,bE]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const toe=kse(eoe);function Ar(...t){return toe(Sse(t))}async function q9(t){const n=new TextEncoder().encode(t),i=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,new Uint8Array(i)))}function noe(){const t=lm(),e=mw();return console.log("location",e.pathname),re.jsxs("div",{className:"flex flex-col items-center *:py-4 *:px-3 border-r border-black",children:[re.jsx("div",{children:re.jsx("img",{src:CA,className:"logo",alt:"Vite logo"})}),re.jsxs("div",{className:Ar("w-full flex flex-col text-black text-xs items-center cursor-pointer hover:bg-stone-100",e.pathname.startsWith("/map")&&"border-l-8 border-stone-600"),onClick:()=>{t("/map")},children:[re.jsx(Sre,{style:{color:"black",fontSize:"20px"}}),re.jsx("div",{className:"mt-1",children:"Map"})]}),re.jsxs("div",{className:Ar("w-full flex flex-col text-black text-xs items-center cursor-pointer hover:bg-stone-100",e.pathname.startsWith("/customers")&&"border-l-8 border-stone-600"),onClick:()=>{t("/customers")},children:[re.jsx(Cre,{style:{color:"black",fontSize:"20px"}}),re.jsx("div",{className:"mt-1",children:"Customers"})]}),re.jsxs("div",{className:"w-full flex flex-col text-black text-xs items-center cursor-pointer hover:bg-stone-100",onClick:()=>{window.open("https://www.isssupport.com/mywayrtk-shop","_blank")},children:[re.jsx(Ere,{style:{color:"black",fontSize:"20px"}}),re.jsx("div",{className:"mt-1",children:"Shop"})]}),re.jsxs("div",{className:"w-full flex flex-col text-black text-xs items-center cursor-pointer hover:bg-stone-100",children:[re.jsx(wre,{style:{color:"black",fontSize:"20px"}}),re.jsx("div",{className:"mt-1",children:"Help"})]}),re.jsxs("div",{className:"w-full flex flex-col text-black text-xs items-center cursor-pointer hover:bg-stone-100",children:[re.jsx(bre,{style:{color:"black",fontSize:"20px"}}),re.jsx("div",{className:"mt-1",children:"Settings"})]})]})}function ioe(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function Z9(...t){return e=>t.forEach(n=>ioe(n,e))}function Ko(...t){return Q.useCallback(Z9(...t),t)}var sv=Q.forwardRef((t,e)=>{const{children:n,...i}=t,r=Q.Children.toArray(n),o=r.find(soe);if(o){const c=o.props.children,s=r.map(f=>f===o?Q.Children.count(c)>1?Q.Children.only(null):Q.isValidElement(c)?c.props.children:null:f);return re.jsx(KF,{...i,ref:e,children:Q.isValidElement(c)?Q.cloneElement(c,void 0,s):null})}return re.jsx(KF,{...i,ref:e,children:n})});sv.displayName="Slot";var KF=Q.forwardRef((t,e)=>{const{children:n,...i}=t;if(Q.isValidElement(n)){const r=aoe(n);return Q.cloneElement(n,{...ooe(i,n.props),ref:e?Z9(e,r):r})}return Q.Children.count(n)>1?Q.Children.only(null):null});KF.displayName="SlotClone";var roe=({children:t})=>re.jsx(re.Fragment,{children:t});function soe(t){return Q.isValidElement(t)&&t.type===roe}function ooe(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...s)=>{o(...s),r(...s)}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function aoe(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function X9(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=X9(t[e]))&&(i&&(i+=" "),i+=n);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function loe(){for(var t,e,n=0,i="";n<arguments.length;)(t=arguments[n++])&&(e=X9(t))&&(i&&(i+=" "),i+=e);return i}const o5=t=>typeof t=="boolean"?"".concat(t):t===0?"0":t,a5=loe,K9=(t,e)=>n=>{var i;if((e==null?void 0:e.variants)==null)return a5(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:r,defaultVariants:o}=e,c=Object.keys(r).map(v=>{const w=n==null?void 0:n[v],C=o==null?void 0:o[v];if(w===null)return null;const M=o5(w)||o5(C);return r[v][M]}),s=n&&Object.entries(n).reduce((v,w)=>{let[C,M]=w;return M===void 0||(v[C]=M),v},{}),f=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((v,w)=>{let{class:C,className:M,...F}=w;return Object.entries(F).every(N=>{let[z,L]=N;return Array.isArray(L)?L.includes({...o,...s}[z]):{...o,...s}[z]===L})?[...v,C,M]:v},[]);return a5(t,c,f,n==null?void 0:n.class,n==null?void 0:n.className)},coe=K9("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-stone-950 dark:focus-visible:ring-stone-300",{variants:{variant:{default:"bg-stone-900 text-stone-50 hover:bg-stone-900/90 dark:bg-stone-50 dark:text-stone-900 dark:hover:bg-stone-50/90",destructive:"bg-red-500 text-stone-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-stone-50 dark:hover:bg-red-900/90",outline:"border border-stone-200 bg-white hover:bg-stone-100 hover:text-stone-900 dark:border-stone-800 dark:bg-stone-950 dark:hover:bg-stone-800 dark:hover:text-stone-50",secondary:"bg-stone-100 text-stone-900 hover:bg-stone-100/80 dark:bg-stone-800 dark:text-stone-50 dark:hover:bg-stone-800/80",ghost:"hover:bg-stone-100 hover:text-stone-900 dark:hover:bg-stone-800 dark:hover:text-stone-50",link:"text-stone-900 underline-offset-4 hover:underline dark:text-stone-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),No=Q.forwardRef(({className:t,variant:e,size:n,asChild:i=!1,...r},o)=>{const c=i?sv:"button";return re.jsx(c,{className:Ar(coe({variant:e,size:n,className:t})),ref:o,...r})});No.displayName="Button";const qr=Q.forwardRef(({className:t,type:e,...n},i)=>re.jsx("input",{type:e,className:Ar("flex h-10 w-full rounded-md border border-stone-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-stone-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-stone-800 dark:bg-stone-950 dark:ring-offset-stone-950 dark:placeholder:text-stone-400 dark:focus-visible:ring-stone-300",t),ref:i,...n}));qr.displayName="Input";var uoe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Vs=uoe.reduce((t,e)=>{const n=Q.forwardRef((i,r)=>{const{asChild:o,...c}=i,s=o?sv:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),re.jsx(s,{...c,ref:r})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function hoe(t,e){t&&rh.flushSync(()=>t.dispatchEvent(e))}var doe="Label",Y9=Q.forwardRef((t,e)=>re.jsx(Vs.label,{...t,ref:e,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=t.onMouseDown)==null||r.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Y9.displayName=doe;var J9=Y9;const foe=K9("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),gr=Q.forwardRef(({className:t,...e},n)=>re.jsx(J9,{ref:n,className:Ar(foe(),t),...e}));gr.displayName=J9.displayName;/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const poe=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Q9=(...t)=>t.filter((e,n,i)=>!!e&&i.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var moe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const goe=Q.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:o,iconNode:c,...s},f)=>Q.createElement("svg",{ref:f,...moe,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:Q9("lucide",r),...s},[...c.map(([v,w])=>Q.createElement(v,w)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_=(t,e)=>{const n=Q.forwardRef(({className:i,...r},o)=>Q.createElement(goe,{ref:o,iconNode:e,className:Q9(`lucide-${poe(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=L_("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=L_("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const voe=L_("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yoe=L_("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _oe=L_("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ov=L_("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xoe=L_("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),QN=Q.forwardRef(({...t},e)=>re.jsx("nav",{ref:e,"aria-label":"breadcrumb",...t}));QN.displayName="Breadcrumb";const e3=Q.forwardRef(({className:t,...e},n)=>re.jsx("ol",{ref:n,className:Ar("flex flex-wrap items-center gap-1.5 break-words text-sm text-stone-500 sm:gap-2.5 dark:text-stone-400",t),...e}));e3.displayName="BreadcrumbList";const Rx=Q.forwardRef(({className:t,...e},n)=>re.jsx("li",{ref:n,className:Ar("inline-flex items-center gap-1.5",t),...e}));Rx.displayName="BreadcrumbItem";const jR=Q.forwardRef(({asChild:t,className:e,...n},i)=>{const r=t?sv:"a";return re.jsx(r,{ref:i,className:Ar("transition-colors hover:text-stone-950 dark:hover:text-stone-50",e),...n})});jR.displayName="BreadcrumbLink";const t3=Q.forwardRef(({className:t,...e},n)=>re.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:Ar("font-normal text-stone-950 dark:text-stone-50",t),...e}));t3.displayName="BreadcrumbPage";const $R=({children:t,className:e,...n})=>re.jsx("li",{role:"presentation","aria-hidden":"true",className:Ar("[&>svg]:size-3.5",e),...n,children:t??re.jsx(voe,{})});$R.displayName="BreadcrumbSeparator";const g_=Q.forwardRef(({className:t,...e},n)=>re.jsx("div",{ref:n,className:Ar("rounded-lg border border-stone-200 bg-white text-stone-950 shadow-sm dark:border-stone-800 dark:bg-stone-950 dark:text-stone-50",t),...e}));g_.displayName="Card";const v_=Q.forwardRef(({className:t,...e},n)=>re.jsx("div",{ref:n,className:Ar("flex flex-col space-y-1.5 p-6 pb-4",t),...e}));v_.displayName="CardHeader";const y_=Q.forwardRef(({className:t,...e},n)=>re.jsx("h3",{ref:n,className:Ar("text-md font-semibold leading-none tracking-tight",t),...e}));y_.displayName="CardTitle";const woe=Q.forwardRef(({className:t,...e},n)=>re.jsx("p",{ref:n,className:Ar("text-sm text-stone-500 dark:text-stone-400",t),...e}));woe.displayName="CardDescription";const vw=Q.forwardRef(({className:t,...e},n)=>re.jsx("div",{ref:n,className:Ar("p-6 pt-0 text-sm",t),...e}));vw.displayName="CardContent";const Coe=Q.forwardRef(({className:t,...e},n)=>re.jsx("div",{ref:n,className:Ar("flex items-center p-6 pt-0 text-sm",t),...e}));Coe.displayName="CardFooter";const Io=Q.forwardRef(({className:t,...e},n)=>re.jsxs("div",{ref:n,className:Ar("flex justify-between mb-1",t),...e,children:[re.jsx("div",{className:"text-stone-500",children:e.title}),re.jsx("div",{children:e.children})]}));Io.displayName="CardContentItem";var yw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ew=typeof window>"u"||"Deno"in globalThis;function Wu(){}function Soe(t,e){return typeof t=="function"?t(e):t}function YF(t){return typeof t=="number"&&t>=0&&t!==1/0}function n$(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Tx(t,e){return typeof t=="function"?t(e):t}function Jh(t,e){return typeof t=="function"?t(e):t}function l5(t,e){const{type:n="all",exact:i,fetchStatus:r,predicate:o,queryKey:c,stale:s}=t;if(c){if(i){if(e.queryHash!==n3(c,e.options))return!1}else if(!tS(e.queryKey,c))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof s=="boolean"&&e.isStale()!==s||r&&r!==e.state.fetchStatus||o&&!o(e))}function c5(t,e){const{exact:n,status:i,predicate:r,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(__(e.options.mutationKey)!==__(o))return!1}else if(!tS(e.options.mutationKey,o))return!1}return!(i&&e.state.status!==i||r&&!r(e))}function n3(t,e){return((e==null?void 0:e.queryKeyHashFn)||__)(t)}function __(t){return JSON.stringify(t,(e,n)=>JF(n)?Object.keys(n).sort().reduce((i,r)=>(i[r]=n[r],i),{}):n)}function tS(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(n=>!tS(t[n],e[n])):!1}function i$(t,e){if(t===e)return t;const n=u5(t)&&u5(e);if(n||JF(t)&&JF(e)){const i=n?t:Object.keys(t),r=i.length,o=n?e:Object.keys(e),c=o.length,s=n?[]:{};let f=0;for(let v=0;v<c;v++){const w=n?v:o[v];(!n&&i.includes(w)||n)&&t[w]===void 0&&e[w]===void 0?(s[w]=void 0,f++):(s[w]=i$(t[w],e[w]),s[w]===t[w]&&t[w]!==void 0&&f++)}return r===c&&f===r?t:s}return e}function qR(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function u5(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function JF(t){if(!h5(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!h5(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function h5(t){return Object.prototype.toString.call(t)==="[object Object]"}function boe(t){return new Promise(e=>{setTimeout(e,t)})}function QF(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?i$(t,e):e}function Eoe(t,e,n=0){const i=[...t,e];return n&&i.length>n?i.slice(1):i}function Moe(t,e,n=0){const i=[e,...t];return n&&i.length>n?i.slice(0,-1):i}var r$=Symbol();function s$(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===r$?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Wy,Dg,Lx,sj,Roe=(sj=class extends yw{constructor(){super();hr(this,Wy);hr(this,Dg);hr(this,Lx);Ii(this,Lx,e=>{if(!ew&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){Ut(this,Dg)||this.setEventListener(Ut(this,Lx))}onUnsubscribe(){var e;this.hasListeners()||((e=Ut(this,Dg))==null||e.call(this),Ii(this,Dg,void 0))}setEventListener(e){var n;Ii(this,Lx,e),(n=Ut(this,Dg))==null||n.call(this),Ii(this,Dg,e(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(e){Ut(this,Wy)!==e&&(Ii(this,Wy,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof Ut(this,Wy)=="boolean"?Ut(this,Wy):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Wy=new WeakMap,Dg=new WeakMap,Lx=new WeakMap,sj),i3=new Roe,Ox,Fg,kx,oj,Toe=(oj=class extends yw{constructor(){super();hr(this,Ox,!0);hr(this,Fg);hr(this,kx);Ii(this,kx,e=>{if(!ew&&window.addEventListener){const n=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){Ut(this,Fg)||this.setEventListener(Ut(this,kx))}onUnsubscribe(){var e;this.hasListeners()||((e=Ut(this,Fg))==null||e.call(this),Ii(this,Fg,void 0))}setEventListener(e){var n;Ii(this,kx,e),(n=Ut(this,Fg))==null||n.call(this),Ii(this,Fg,e(this.setOnline.bind(this)))}setOnline(e){Ut(this,Ox)!==e&&(Ii(this,Ox,e),this.listeners.forEach(i=>{i(e)}))}isOnline(){return Ut(this,Ox)}},Ox=new WeakMap,Fg=new WeakMap,kx=new WeakMap,oj),ZR=new Toe;function Aoe(t){return Math.min(1e3*2**t,3e4)}function o$(t){return(t??"online")==="online"?ZR.isOnline():!0}var a$=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function oD(t){return t instanceof a$}function l$(t){let e=!1,n=0,i=!1,r,o,c;const s=new Promise((P,H)=>{o=P,c=H}),f=P=>{var H;i||(N(new a$(P)),(H=t.abort)==null||H.call(t))},v=()=>{e=!0},w=()=>{e=!1},C=()=>i3.isFocused()&&(t.networkMode==="always"||ZR.isOnline())&&t.canRun(),M=()=>o$(t.networkMode)&&t.canRun(),F=P=>{var H;i||(i=!0,(H=t.onSuccess)==null||H.call(t,P),r==null||r(),o(P))},N=P=>{var H;i||(i=!0,(H=t.onError)==null||H.call(t,P),r==null||r(),c(P))},z=()=>new Promise(P=>{var H;r=j=>{(i||C())&&P(j)},(H=t.onPause)==null||H.call(t)}).then(()=>{var P;r=void 0,i||(P=t.onContinue)==null||P.call(t)}),L=()=>{if(i)return;let P;const H=n===0?t.initialPromise:void 0;try{P=H??t.fn()}catch(j){P=Promise.reject(j)}Promise.resolve(P).then(F).catch(j=>{var pe;if(i)return;const q=t.retry??(ew?0:3),le=t.retryDelay??Aoe,ce=typeof le=="function"?le(n,j):le,ae=q===!0||typeof q=="number"&&n<q||typeof q=="function"&&q(n,j);if(e||!ae){N(j);return}n++,(pe=t.onFail)==null||pe.call(t,n,j),boe(ce).then(()=>C()?void 0:z()).then(()=>{e?N(j):L()})})};return{promise:s,cancel:f,continue:()=>(r==null||r(),s),cancelRetry:v,continueRetry:w,canStart:M,start:()=>(M()?L():z().then(L),s)}}function Poe(){let t=[],e=0,n=s=>{s()},i=s=>{s()},r=s=>setTimeout(s,0);const o=s=>{e?t.push(s):r(()=>{n(s)})},c=()=>{const s=t;t=[],s.length&&r(()=>{i(()=>{s.forEach(f=>{n(f)})})})};return{batch:s=>{let f;e++;try{f=s()}finally{e--,e||c()}return f},batchCalls:s=>(...f)=>{o(()=>{s(...f)})},schedule:o,setNotifyFunction:s=>{n=s},setBatchNotifyFunction:s=>{i=s},setScheduler:s=>{r=s}}}var ba=Poe(),jy,aj,c$=(aj=class{constructor(){hr(this,jy)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),YF(this.gcTime)&&Ii(this,jy,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(ew?1/0:5*60*1e3))}clearGcTimeout(){Ut(this,jy)&&(clearTimeout(Ut(this,jy)),Ii(this,jy,void 0))}},jy=new WeakMap,aj),Nx,Bx,Hu,vl,TS,$y,Zh,Tp,lj,Ioe=(lj=class extends c${constructor(e){super();hr(this,Zh);hr(this,Nx);hr(this,Bx);hr(this,Hu);hr(this,vl);hr(this,TS);hr(this,$y);Ii(this,$y,!1),Ii(this,TS,e.defaultOptions),this.setOptions(e.options),this.observers=[],Ii(this,Hu,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Ii(this,Nx,Doe(this.options)),this.state=e.state??Ut(this,Nx),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=Ut(this,vl))==null?void 0:e.promise}setOptions(e){this.options={...Ut(this,TS),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ut(this,Hu).remove(this)}setData(e,n){const i=QF(this.state.data,e,this.options);return zr(this,Zh,Tp).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(e,n){zr(this,Zh,Tp).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var i,r;const n=(i=Ut(this,vl))==null?void 0:i.promise;return(r=Ut(this,vl))==null||r.cancel(e),n?n.then(Wu).catch(Wu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ut(this,Nx))}isActive(){return this.observers.some(e=>Jh(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!n$(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(i=>i.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=Ut(this,vl))==null||n.continue()}onOnline(){var n;const e=this.observers.find(i=>i.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=Ut(this,vl))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Ut(this,Hu).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(Ut(this,vl)&&(Ut(this,$y)?Ut(this,vl).cancel({revert:!0}):Ut(this,vl).cancelRetry()),this.scheduleGc()),Ut(this,Hu).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||zr(this,Zh,Tp).call(this,{type:"invalidate"})}fetch(e,n){var f,v,w;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(Ut(this,vl))return Ut(this,vl).continueRetry(),Ut(this,vl).promise}if(e&&this.setOptions(e),!this.options.queryFn){const C=this.observers.find(M=>M.options.queryFn);C&&this.setOptions(C.options)}const i=new AbortController,r=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(Ii(this,$y,!0),i.signal)})},o=()=>{const C=s$(this.options,n),M={queryKey:this.queryKey,meta:this.meta};return r(M),Ii(this,$y,!1),this.options.persister?this.options.persister(C,M,this):C(M)},c={fetchOptions:n,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:o};r(c),(f=this.options.behavior)==null||f.onFetch(c,this),Ii(this,Bx,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((v=c.fetchOptions)==null?void 0:v.meta))&&zr(this,Zh,Tp).call(this,{type:"fetch",meta:(w=c.fetchOptions)==null?void 0:w.meta});const s=C=>{var M,F,N,z;oD(C)&&C.silent||zr(this,Zh,Tp).call(this,{type:"error",error:C}),oD(C)||((F=(M=Ut(this,Hu).config).onError)==null||F.call(M,C,this),(z=(N=Ut(this,Hu).config).onSettled)==null||z.call(N,this.state.data,C,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return Ii(this,vl,l$({initialPromise:n==null?void 0:n.initialPromise,fn:c.fetchFn,abort:i.abort.bind(i),onSuccess:C=>{var M,F,N,z;if(C===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(C)}catch(L){s(L);return}(F=(M=Ut(this,Hu).config).onSuccess)==null||F.call(M,C,this),(z=(N=Ut(this,Hu).config).onSettled)==null||z.call(N,C,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:s,onFail:(C,M)=>{zr(this,Zh,Tp).call(this,{type:"failed",failureCount:C,error:M})},onPause:()=>{zr(this,Zh,Tp).call(this,{type:"pause"})},onContinue:()=>{zr(this,Zh,Tp).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),Ut(this,vl).start()}},Nx=new WeakMap,Bx=new WeakMap,Hu=new WeakMap,vl=new WeakMap,TS=new WeakMap,$y=new WeakMap,Zh=new WeakSet,Tp=function(e){const n=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...u$(i.data,this.options),fetchMeta:e.meta??null};case"success":return{...i,data:e.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const r=e.error;return oD(r)&&r.revert&&Ut(this,Bx)?{...Ut(this,Bx),fetchStatus:"idle"}:{...i,error:r,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=n(this.state),ba.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),Ut(this,Hu).notify({query:this,type:"updated",action:e})})},lj);function u$(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:o$(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Doe(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var uf,cj,Foe=(cj=class extends yw{constructor(e={}){super();hr(this,uf);this.config=e,Ii(this,uf,new Map)}build(e,n,i){const r=n.queryKey,o=n.queryHash??n3(r,n);let c=this.get(o);return c||(c=new Ioe({cache:this,queryKey:r,queryHash:o,options:e.defaultQueryOptions(n),state:i,defaultOptions:e.getQueryDefaults(r)}),this.add(c)),c}add(e){Ut(this,uf).has(e.queryHash)||(Ut(this,uf).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=Ut(this,uf).get(e.queryHash);n&&(e.destroy(),n===e&&Ut(this,uf).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ba.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Ut(this,uf).get(e)}getAll(){return[...Ut(this,uf).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(i=>l5(n,i))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(i=>l5(e,i)):n}notify(e){ba.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){ba.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ba.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},uf=new WeakMap,cj),hf,Hl,qy,df,Sg,uj,Loe=(uj=class extends c${constructor(e){super();hr(this,df);hr(this,hf);hr(this,Hl);hr(this,qy);this.mutationId=e.mutationId,Ii(this,Hl,e.mutationCache),Ii(this,hf,[]),this.state=e.state||h$(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Ut(this,hf).includes(e)||(Ut(this,hf).push(e),this.clearGcTimeout(),Ut(this,Hl).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Ii(this,hf,Ut(this,hf).filter(n=>n!==e)),this.scheduleGc(),Ut(this,Hl).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Ut(this,hf).length||(this.state.status==="pending"?this.scheduleGc():Ut(this,Hl).remove(this))}continue(){var e;return((e=Ut(this,qy))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var r,o,c,s,f,v,w,C,M,F,N,z,L,P,H,j,q,le,ce,ae;Ii(this,qy,l$({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(pe,fe)=>{zr(this,df,Sg).call(this,{type:"failed",failureCount:pe,error:fe})},onPause:()=>{zr(this,df,Sg).call(this,{type:"pause"})},onContinue:()=>{zr(this,df,Sg).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ut(this,Hl).canRun(this)}));const n=this.state.status==="pending",i=!Ut(this,qy).canStart();try{if(!n){zr(this,df,Sg).call(this,{type:"pending",variables:e,isPaused:i}),await((o=(r=Ut(this,Hl).config).onMutate)==null?void 0:o.call(r,e,this));const fe=await((s=(c=this.options).onMutate)==null?void 0:s.call(c,e));fe!==this.state.context&&zr(this,df,Sg).call(this,{type:"pending",context:fe,variables:e,isPaused:i})}const pe=await Ut(this,qy).start();return await((v=(f=Ut(this,Hl).config).onSuccess)==null?void 0:v.call(f,pe,e,this.state.context,this)),await((C=(w=this.options).onSuccess)==null?void 0:C.call(w,pe,e,this.state.context)),await((F=(M=Ut(this,Hl).config).onSettled)==null?void 0:F.call(M,pe,null,this.state.variables,this.state.context,this)),await((z=(N=this.options).onSettled)==null?void 0:z.call(N,pe,null,e,this.state.context)),zr(this,df,Sg).call(this,{type:"success",data:pe}),pe}catch(pe){try{throw await((P=(L=Ut(this,Hl).config).onError)==null?void 0:P.call(L,pe,e,this.state.context,this)),await((j=(H=this.options).onError)==null?void 0:j.call(H,pe,e,this.state.context)),await((le=(q=Ut(this,Hl).config).onSettled)==null?void 0:le.call(q,void 0,pe,this.state.variables,this.state.context,this)),await((ae=(ce=this.options).onSettled)==null?void 0:ae.call(ce,void 0,pe,e,this.state.context)),pe}finally{zr(this,df,Sg).call(this,{type:"error",error:pe})}}finally{Ut(this,Hl).runNext(this)}}},hf=new WeakMap,Hl=new WeakMap,qy=new WeakMap,df=new WeakSet,Sg=function(e){const n=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),ba.batch(()=>{Ut(this,hf).forEach(i=>{i.onMutationUpdate(e)}),Ut(this,Hl).notify({mutation:this,type:"updated",action:e})})},uj);function h$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var du,AS,hj,Ooe=(hj=class extends yw{constructor(e={}){super();hr(this,du);hr(this,AS);this.config=e,Ii(this,du,new Map),Ii(this,AS,Date.now())}build(e,n,i){const r=new Loe({mutationCache:this,mutationId:++oE(this,AS)._,options:e.defaultMutationOptions(n),state:i});return this.add(r),r}add(e){const n=EE(e),i=Ut(this,du).get(n)??[];i.push(e),Ut(this,du).set(n,i),this.notify({type:"added",mutation:e})}remove(e){var i;const n=EE(e);if(Ut(this,du).has(n)){const r=(i=Ut(this,du).get(n))==null?void 0:i.filter(o=>o!==e);r&&(r.length===0?Ut(this,du).delete(n):Ut(this,du).set(n,r))}this.notify({type:"removed",mutation:e})}canRun(e){var i;const n=(i=Ut(this,du).get(EE(e)))==null?void 0:i.find(r=>r.state.status==="pending");return!n||n===e}runNext(e){var i;const n=(i=Ut(this,du).get(EE(e)))==null?void 0:i.find(r=>r!==e&&r.state.isPaused);return(n==null?void 0:n.continue())??Promise.resolve()}clear(){ba.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...Ut(this,du).values()].flat()}find(e){const n={exact:!0,...e};return this.getAll().find(i=>c5(n,i))}findAll(e={}){return this.getAll().filter(n=>c5(e,n))}notify(e){ba.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return ba.batch(()=>Promise.all(e.map(n=>n.continue().catch(Wu))))}},du=new WeakMap,AS=new WeakMap,hj);function EE(t){var e;return((e=t.options.scope)==null?void 0:e.id)??String(t.mutationId)}function d5(t){return{onFetch:(e,n)=>{var w,C,M,F,N;const i=e.options,r=(M=(C=(w=e.fetchOptions)==null?void 0:w.meta)==null?void 0:C.fetchMore)==null?void 0:M.direction,o=((F=e.state.data)==null?void 0:F.pages)||[],c=((N=e.state.data)==null?void 0:N.pageParams)||[];let s={pages:[],pageParams:[]},f=0;const v=async()=>{let z=!1;const L=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(e.signal.aborted?z=!0:e.signal.addEventListener("abort",()=>{z=!0}),e.signal)})},P=s$(e.options,e.fetchOptions),H=async(j,q,le)=>{if(z)return Promise.reject();if(q==null&&j.pages.length)return Promise.resolve(j);const ce={queryKey:e.queryKey,pageParam:q,direction:le?"backward":"forward",meta:e.options.meta};L(ce);const ae=await P(ce),{maxPages:pe}=e.options,fe=le?Moe:Eoe;return{pages:fe(j.pages,ae,pe),pageParams:fe(j.pageParams,q,pe)}};if(r&&o.length){const j=r==="backward",q=j?koe:f5,le={pages:o,pageParams:c},ce=q(i,le);s=await H(le,ce,j)}else{const j=t??o.length;do{const q=f===0?c[0]??i.initialPageParam:f5(i,s);if(f>0&&q==null)break;s=await H(s,q),f++}while(f<j)}return s};e.options.persister?e.fetchFn=()=>{var z,L;return(L=(z=e.options).persister)==null?void 0:L.call(z,v,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=v}}}function f5(t,{pages:e,pageParams:n}){const i=e.length-1;return e.length>0?t.getNextPageParam(e[i],e,n[i],n):void 0}function koe(t,{pages:e,pageParams:n}){var i;return e.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,e[0],e,n[0],n):void 0}var $o,Lg,Og,zx,Ux,kg,Vx,Gx,dj,Noe=(dj=class{constructor(t={}){hr(this,$o);hr(this,Lg);hr(this,Og);hr(this,zx);hr(this,Ux);hr(this,kg);hr(this,Vx);hr(this,Gx);Ii(this,$o,t.queryCache||new Foe),Ii(this,Lg,t.mutationCache||new Ooe),Ii(this,Og,t.defaultOptions||{}),Ii(this,zx,new Map),Ii(this,Ux,new Map),Ii(this,kg,0)}mount(){oE(this,kg)._++,Ut(this,kg)===1&&(Ii(this,Vx,i3.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ut(this,$o).onFocus())})),Ii(this,Gx,ZR.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ut(this,$o).onOnline())})))}unmount(){var t,e;oE(this,kg)._--,Ut(this,kg)===0&&((t=Ut(this,Vx))==null||t.call(this),Ii(this,Vx,void 0),(e=Ut(this,Gx))==null||e.call(this),Ii(this,Gx,void 0))}isFetching(t){return Ut(this,$o).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return Ut(this,Lg).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=Ut(this,$o).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.getQueryData(t.queryKey);if(e===void 0)return this.fetchQuery(t);{const n=this.defaultQueryOptions(t),i=Ut(this,$o).build(this,n);return t.revalidateIfStale&&i.isStaleByTime(Tx(n.staleTime,i))&&this.prefetchQuery(n),Promise.resolve(e)}}getQueriesData(t){return Ut(this,$o).findAll(t).map(({queryKey:e,state:n})=>{const i=n.data;return[e,i]})}setQueryData(t,e,n){const i=this.defaultQueryOptions({queryKey:t}),r=Ut(this,$o).get(i.queryHash),o=r==null?void 0:r.state.data,c=Soe(e,o);if(c!==void 0)return Ut(this,$o).build(this,i).setData(c,{...n,manual:!0})}setQueriesData(t,e,n){return ba.batch(()=>Ut(this,$o).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=Ut(this,$o).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=Ut(this,$o);ba.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=Ut(this,$o),i={type:"active",...t};return ba.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries(i,e)))}cancelQueries(t={},e={}){const n={revert:!0,...e},i=ba.batch(()=>Ut(this,$o).findAll(t).map(r=>r.cancel(n)));return Promise.all(i).then(Wu).catch(Wu)}invalidateQueries(t={},e={}){return ba.batch(()=>{if(Ut(this,$o).findAll(t).forEach(i=>{i.invalidate()}),t.refetchType==="none")return Promise.resolve();const n={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(n,e)})}refetchQueries(t={},e){const n={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},i=ba.batch(()=>Ut(this,$o).findAll(t).filter(r=>!r.isDisabled()).map(r=>{let o=r.fetch(void 0,n);return n.throwOnError||(o=o.catch(Wu)),r.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(i).then(Wu)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=Ut(this,$o).build(this,e);return n.isStaleByTime(Tx(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Wu).catch(Wu)}fetchInfiniteQuery(t){return t.behavior=d5(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Wu).catch(Wu)}ensureInfiniteQueryData(t){return t.behavior=d5(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return ZR.isOnline()?Ut(this,Lg).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ut(this,$o)}getMutationCache(){return Ut(this,Lg)}getDefaultOptions(){return Ut(this,Og)}setDefaultOptions(t){Ii(this,Og,t)}setQueryDefaults(t,e){Ut(this,zx).set(__(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...Ut(this,zx).values()];let n={};return e.forEach(i=>{tS(t,i.queryKey)&&(n={...n,...i.defaultOptions})}),n}setMutationDefaults(t,e){Ut(this,Ux).set(__(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...Ut(this,Ux).values()];let n={};return e.forEach(i=>{tS(t,i.mutationKey)&&(n={...n,...i.defaultOptions})}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...Ut(this,Og).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=n3(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===r$&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...Ut(this,Og).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){Ut(this,$o).clear(),Ut(this,Lg).clear()}},$o=new WeakMap,Lg=new WeakMap,Og=new WeakMap,zx=new WeakMap,Ux=new WeakMap,kg=new WeakMap,Vx=new WeakMap,Gx=new WeakMap,dj),Ac,as,PS,Wl,Zy,Hx,ff,IS,Wx,jx,Xy,Ky,Ng,$x,Ls,r1,eL,tL,nL,iL,rL,sL,oL,d$,fj,Boe=(fj=class extends yw{constructor(e,n){super();hr(this,Ls);hr(this,Ac);hr(this,as);hr(this,PS);hr(this,Wl);hr(this,Zy);hr(this,Hx);hr(this,ff);hr(this,IS);hr(this,Wx);hr(this,jx);hr(this,Xy);hr(this,Ky);hr(this,Ng);hr(this,$x,new Set);this.options=n,Ii(this,Ac,e),Ii(this,ff,null),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Ut(this,as).addObserver(this),p5(Ut(this,as),this.options)?zr(this,Ls,r1).call(this):this.updateResult(),zr(this,Ls,iL).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return aL(Ut(this,as),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return aL(Ut(this,as),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,zr(this,Ls,rL).call(this),zr(this,Ls,sL).call(this),Ut(this,as).removeObserver(this)}setOptions(e,n){const i=this.options,r=Ut(this,as);if(this.options=Ut(this,Ac).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Jh(this.options.enabled,Ut(this,as))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");zr(this,Ls,oL).call(this),Ut(this,as).setOptions(this.options),i._defaulted&&!qR(this.options,i)&&Ut(this,Ac).getQueryCache().notify({type:"observerOptionsUpdated",query:Ut(this,as),observer:this});const o=this.hasListeners();o&&m5(Ut(this,as),r,this.options,i)&&zr(this,Ls,r1).call(this),this.updateResult(n),o&&(Ut(this,as)!==r||Jh(this.options.enabled,Ut(this,as))!==Jh(i.enabled,Ut(this,as))||Tx(this.options.staleTime,Ut(this,as))!==Tx(i.staleTime,Ut(this,as)))&&zr(this,Ls,eL).call(this);const c=zr(this,Ls,tL).call(this);o&&(Ut(this,as)!==r||Jh(this.options.enabled,Ut(this,as))!==Jh(i.enabled,Ut(this,as))||c!==Ut(this,Ng))&&zr(this,Ls,nL).call(this,c)}getOptimisticResult(e){const n=Ut(this,Ac).getQueryCache().build(Ut(this,Ac),e),i=this.createResult(n,e);return Uoe(this,i)&&(Ii(this,Wl,i),Ii(this,Hx,this.options),Ii(this,Zy,Ut(this,as).state)),i}getCurrentResult(){return Ut(this,Wl)}trackResult(e,n){const i={};return Object.keys(e).forEach(r=>{Object.defineProperty(i,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),n==null||n(r),e[r])})}),i}trackProp(e){Ut(this,$x).add(e)}getCurrentQuery(){return Ut(this,as)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const n=Ut(this,Ac).defaultQueryOptions(e),i=Ut(this,Ac).getQueryCache().build(Ut(this,Ac),n);return i.isFetchingOptimistic=!0,i.fetch().then(()=>this.createResult(i,n))}fetch(e){return zr(this,Ls,r1).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),Ut(this,Wl)))}createResult(e,n){var ae;const i=Ut(this,as),r=this.options,o=Ut(this,Wl),c=Ut(this,Zy),s=Ut(this,Hx),v=e!==i?e.state:Ut(this,PS),{state:w}=e;let C={...w},M=!1,F;if(n._optimisticResults){const pe=this.hasListeners(),fe=!pe&&p5(e,n),ue=pe&&m5(e,i,n,r);(fe||ue)&&(C={...C,...u$(w.data,e.options)}),n._optimisticResults==="isRestoring"&&(C.fetchStatus="idle")}let{error:N,errorUpdatedAt:z,status:L}=C;if(n.select&&C.data!==void 0)if(o&&C.data===(c==null?void 0:c.data)&&n.select===Ut(this,IS))F=Ut(this,Wx);else try{Ii(this,IS,n.select),F=n.select(C.data),F=QF(o==null?void 0:o.data,F,n),Ii(this,Wx,F),Ii(this,ff,null)}catch(pe){Ii(this,ff,pe)}else F=C.data;if(n.placeholderData!==void 0&&F===void 0&&L==="pending"){let pe;if(o!=null&&o.isPlaceholderData&&n.placeholderData===(s==null?void 0:s.placeholderData))pe=o.data;else if(pe=typeof n.placeholderData=="function"?n.placeholderData((ae=Ut(this,jx))==null?void 0:ae.state.data,Ut(this,jx)):n.placeholderData,n.select&&pe!==void 0)try{pe=n.select(pe),Ii(this,ff,null)}catch(fe){Ii(this,ff,fe)}pe!==void 0&&(L="success",F=QF(o==null?void 0:o.data,pe,n),M=!0)}Ut(this,ff)&&(N=Ut(this,ff),F=Ut(this,Wx),z=Date.now(),L="error");const P=C.fetchStatus==="fetching",H=L==="pending",j=L==="error",q=H&&P,le=F!==void 0;return{status:L,fetchStatus:C.fetchStatus,isPending:H,isSuccess:L==="success",isError:j,isInitialLoading:q,isLoading:q,data:F,dataUpdatedAt:C.dataUpdatedAt,error:N,errorUpdatedAt:z,failureCount:C.fetchFailureCount,failureReason:C.fetchFailureReason,errorUpdateCount:C.errorUpdateCount,isFetched:C.dataUpdateCount>0||C.errorUpdateCount>0,isFetchedAfterMount:C.dataUpdateCount>v.dataUpdateCount||C.errorUpdateCount>v.errorUpdateCount,isFetching:P,isRefetching:P&&!H,isLoadingError:j&&!le,isPaused:C.fetchStatus==="paused",isPlaceholderData:M,isRefetchError:j&&le,isStale:r3(e,n),refetch:this.refetch}}updateResult(e){const n=Ut(this,Wl),i=this.createResult(Ut(this,as),this.options);if(Ii(this,Zy,Ut(this,as).state),Ii(this,Hx,this.options),Ut(this,Zy).data!==void 0&&Ii(this,jx,Ut(this,as)),qR(i,n))return;Ii(this,Wl,i);const r={},o=()=>{if(!n)return!0;const{notifyOnChangeProps:c}=this.options,s=typeof c=="function"?c():c;if(s==="all"||!s&&!Ut(this,$x).size)return!0;const f=new Set(s??Ut(this,$x));return this.options.throwOnError&&f.add("error"),Object.keys(Ut(this,Wl)).some(v=>{const w=v;return Ut(this,Wl)[w]!==n[w]&&f.has(w)})};(e==null?void 0:e.listeners)!==!1&&o()&&(r.listeners=!0),zr(this,Ls,d$).call(this,{...r,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&zr(this,Ls,iL).call(this)}},Ac=new WeakMap,as=new WeakMap,PS=new WeakMap,Wl=new WeakMap,Zy=new WeakMap,Hx=new WeakMap,ff=new WeakMap,IS=new WeakMap,Wx=new WeakMap,jx=new WeakMap,Xy=new WeakMap,Ky=new WeakMap,Ng=new WeakMap,$x=new WeakMap,Ls=new WeakSet,r1=function(e){zr(this,Ls,oL).call(this);let n=Ut(this,as).fetch(this.options,e);return e!=null&&e.throwOnError||(n=n.catch(Wu)),n},eL=function(){zr(this,Ls,rL).call(this);const e=Tx(this.options.staleTime,Ut(this,as));if(ew||Ut(this,Wl).isStale||!YF(e))return;const i=n$(Ut(this,Wl).dataUpdatedAt,e)+1;Ii(this,Xy,setTimeout(()=>{Ut(this,Wl).isStale||this.updateResult()},i))},tL=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Ut(this,as)):this.options.refetchInterval)??!1},nL=function(e){zr(this,Ls,sL).call(this),Ii(this,Ng,e),!(ew||Jh(this.options.enabled,Ut(this,as))===!1||!YF(Ut(this,Ng))||Ut(this,Ng)===0)&&Ii(this,Ky,setInterval(()=>{(this.options.refetchIntervalInBackground||i3.isFocused())&&zr(this,Ls,r1).call(this)},Ut(this,Ng)))},iL=function(){zr(this,Ls,eL).call(this),zr(this,Ls,nL).call(this,zr(this,Ls,tL).call(this))},rL=function(){Ut(this,Xy)&&(clearTimeout(Ut(this,Xy)),Ii(this,Xy,void 0))},sL=function(){Ut(this,Ky)&&(clearInterval(Ut(this,Ky)),Ii(this,Ky,void 0))},oL=function(){const e=Ut(this,Ac).getQueryCache().build(Ut(this,Ac),this.options);if(e===Ut(this,as))return;const n=Ut(this,as);Ii(this,as,e),Ii(this,PS,e.state),this.hasListeners()&&(n==null||n.removeObserver(this),e.addObserver(this))},d$=function(e){ba.batch(()=>{e.listeners&&this.listeners.forEach(n=>{n(Ut(this,Wl))}),Ut(this,Ac).getQueryCache().notify({query:Ut(this,as),type:"observerResultsUpdated"})})},fj);function zoe(t,e){return Jh(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function p5(t,e){return zoe(t,e)||t.state.data!==void 0&&aL(t,e,e.refetchOnMount)}function aL(t,e,n){if(Jh(e.enabled,t)!==!1){const i=typeof n=="function"?n(t):n;return i==="always"||i!==!1&&r3(t,e)}return!1}function m5(t,e,n,i){return(t!==e||Jh(i.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&r3(t,n)}function r3(t,e){return Jh(e.enabled,t)!==!1&&t.isStaleByTime(Tx(e.staleTime,t))}function Uoe(t,e){return!qR(t.getCurrentResult(),e)}var Bg,zg,Pc,Fp,$p,tR,lL,pj,Voe=(pj=class extends yw{constructor(n,i){super();hr(this,$p);hr(this,Bg);hr(this,zg);hr(this,Pc);hr(this,Fp);Ii(this,Bg,n),this.setOptions(i),this.bindMethods(),zr(this,$p,tR).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var r;const i=this.options;this.options=Ut(this,Bg).defaultMutationOptions(n),qR(this.options,i)||Ut(this,Bg).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Ut(this,Pc),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&__(i.mutationKey)!==__(this.options.mutationKey)?this.reset():((r=Ut(this,Pc))==null?void 0:r.state.status)==="pending"&&Ut(this,Pc).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=Ut(this,Pc))==null||n.removeObserver(this)}onMutationUpdate(n){zr(this,$p,tR).call(this),zr(this,$p,lL).call(this,n)}getCurrentResult(){return Ut(this,zg)}reset(){var n;(n=Ut(this,Pc))==null||n.removeObserver(this),Ii(this,Pc,void 0),zr(this,$p,tR).call(this),zr(this,$p,lL).call(this)}mutate(n,i){var r;return Ii(this,Fp,i),(r=Ut(this,Pc))==null||r.removeObserver(this),Ii(this,Pc,Ut(this,Bg).getMutationCache().build(Ut(this,Bg),this.options)),Ut(this,Pc).addObserver(this),Ut(this,Pc).execute(n)}},Bg=new WeakMap,zg=new WeakMap,Pc=new WeakMap,Fp=new WeakMap,$p=new WeakSet,tR=function(){var i;const n=((i=Ut(this,Pc))==null?void 0:i.state)??h$();Ii(this,zg,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},lL=function(n){ba.batch(()=>{var i,r,o,c,s,f,v,w;if(Ut(this,Fp)&&this.hasListeners()){const C=Ut(this,zg).variables,M=Ut(this,zg).context;(n==null?void 0:n.type)==="success"?((r=(i=Ut(this,Fp)).onSuccess)==null||r.call(i,n.data,C,M),(c=(o=Ut(this,Fp)).onSettled)==null||c.call(o,n.data,null,C,M)):(n==null?void 0:n.type)==="error"&&((f=(s=Ut(this,Fp)).onError)==null||f.call(s,n.error,C,M),(w=(v=Ut(this,Fp)).onSettled)==null||w.call(v,void 0,n.error,C,M))}this.listeners.forEach(C=>{C(Ut(this,zg))})})},pj),f$=Q.createContext(void 0),O_=t=>{const e=Q.useContext(f$);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Goe=({client:t,children:e})=>(Q.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),re.jsx(f$.Provider,{value:t,children:e})),p$=Q.createContext(!1),Hoe=()=>Q.useContext(p$);p$.Provider;function Woe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var joe=Q.createContext(Woe()),$oe=()=>Q.useContext(joe);function m$(t,e){return typeof t=="function"?t(...e):!!t}function qoe(){}var Zoe=(t,e)=>{(t.suspense||t.throwOnError)&&(e.isReset()||(t.retryOnMount=!1))},Xoe=t=>{Q.useEffect(()=>{t.clearReset()},[t])},Koe=({result:t,errorResetBoundary:e,throwOnError:n,query:i})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&m$(n,[t.error,i]),Yoe=t=>{t.suspense&&(typeof t.staleTime!="number"&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Joe=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Qoe=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function eae(t,e,n){var v,w,C,M;const i=O_(),r=Hoe(),o=$oe(),c=i.defaultQueryOptions(t);(w=(v=i.getDefaultOptions().queries)==null?void 0:v._experimental_beforeQuery)==null||w.call(v,c),c._optimisticResults=r?"isRestoring":"optimistic",Yoe(c),Zoe(c,o),Xoe(o);const[s]=Q.useState(()=>new e(i,c)),f=s.getOptimisticResult(c);if(Q.useSyncExternalStore(Q.useCallback(F=>{const N=r?()=>{}:s.subscribe(ba.batchCalls(F));return s.updateResult(),N},[s,r]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),Q.useEffect(()=>{s.setOptions(c,{listeners:!1})},[c,s]),Joe(c,f))throw Qoe(c,s,o);if(Koe({result:f,errorResetBoundary:o,throwOnError:c.throwOnError,query:i.getQueryCache().get(c.queryHash)}))throw f.error;return(M=(C=i.getDefaultOptions().queries)==null?void 0:C._experimental_afterQuery)==null||M.call(C,c,f),c.notifyOnChangeProps?f:s.trackResult(f)}function bf(t,e){return eae(t,Boe)}function Yp(t,e){const n=O_(),[i]=Q.useState(()=>new Voe(n,t));Q.useEffect(()=>{i.setOptions(t)},[i,t]);const r=Q.useSyncExternalStore(Q.useCallback(c=>i.subscribe(ba.batchCalls(c)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=Q.useCallback((c,s)=>{i.mutate(c,s).catch(qoe)},[i]);if(r.error&&m$(i.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:o,mutateAsync:r.mutate}}function g$(t,e){return function(){return t.apply(e,arguments)}}const{toString:tae}=Object.prototype,{getPrototypeOf:s3}=Object,MA=(t=>e=>{const n=tae.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),md=t=>(t=t.toLowerCase(),e=>MA(e)===t),RA=t=>e=>typeof e===t,{isArray:_w}=Array,nS=RA("undefined");function nae(t){return t!==null&&!nS(t)&&t.constructor!==null&&!nS(t.constructor)&&yu(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const v$=md("ArrayBuffer");function iae(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&v$(t.buffer),e}const rae=RA("string"),yu=RA("function"),y$=RA("number"),TA=t=>t!==null&&typeof t=="object",sae=t=>t===!0||t===!1,nR=t=>{if(MA(t)!=="object")return!1;const e=s3(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},oae=md("Date"),aae=md("File"),lae=md("Blob"),cae=md("FileList"),uae=t=>TA(t)&&yu(t.pipe),hae=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||yu(t.append)&&((e=MA(t))==="formdata"||e==="object"&&yu(t.toString)&&t.toString()==="[object FormData]"))},dae=md("URLSearchParams"),[fae,pae,mae,gae]=["ReadableStream","Request","Response","Headers"].map(md),vae=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function NS(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,r;if(typeof t!="object"&&(t=[t]),_w(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{const o=n?Object.getOwnPropertyNames(t):Object.keys(t),c=o.length;let s;for(i=0;i<c;i++)s=o[i],e.call(null,t[s],s,t)}}function _$(t,e){e=e.toLowerCase();const n=Object.keys(t);let i=n.length,r;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const By=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,x$=t=>!nS(t)&&t!==By;function cL(){const{caseless:t}=x$(this)&&this||{},e={},n=(i,r)=>{const o=t&&_$(e,r)||r;nR(e[o])&&nR(i)?e[o]=cL(e[o],i):nR(i)?e[o]=cL({},i):_w(i)?e[o]=i.slice():e[o]=i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&NS(arguments[i],n);return e}const yae=(t,e,n,{allOwnKeys:i}={})=>(NS(e,(r,o)=>{n&&yu(r)?t[o]=g$(r,n):t[o]=r},{allOwnKeys:i}),t),_ae=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),xae=(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},wae=(t,e,n,i)=>{let r,o,c;const s={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)c=r[o],(!i||i(c,t,e))&&!s[c]&&(e[c]=t[c],s[c]=!0);t=n!==!1&&s3(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},Cae=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},Sae=t=>{if(!t)return null;if(_w(t))return t;let e=t.length;if(!y$(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},bae=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&s3(Uint8Array)),Eae=(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=i.next())&&!r.done;){const o=r.value;e.call(t,o[0],o[1])}},Mae=(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},Rae=md("HTMLFormElement"),Tae=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,r){return i.toUpperCase()+r}),g5=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Aae=md("RegExp"),w$=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};NS(n,(r,o)=>{let c;(c=e(r,o,t))!==!1&&(i[o]=c||r)}),Object.defineProperties(t,i)},Pae=t=>{w$(t,(e,n)=>{if(yu(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(yu(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Iae=(t,e)=>{const n={},i=r=>{r.forEach(o=>{n[o]=!0})};return _w(t)?i(t):i(String(t).split(e)),n},Dae=()=>{},Fae=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,aD="abcdefghijklmnopqrstuvwxyz",v5="0123456789",C$={DIGIT:v5,ALPHA:aD,ALPHA_DIGIT:aD+aD.toUpperCase()+v5},Lae=(t=16,e=C$.ALPHA_DIGIT)=>{let n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n};function Oae(t){return!!(t&&yu(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const kae=t=>{const e=new Array(10),n=(i,r)=>{if(TA(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const o=_w(i)?[]:{};return NS(i,(c,s)=>{const f=n(c,r+1);!nS(f)&&(o[s]=f)}),e[r]=void 0,o}}return i};return n(t,0)},Nae=md("AsyncFunction"),Bae=t=>t&&(TA(t)||yu(t))&&yu(t.then)&&yu(t.catch),S$=((t,e)=>t?setImmediate:e?((n,i)=>(By.addEventListener("message",({source:r,data:o})=>{r===By&&o===n&&i.length&&i.shift()()},!1),r=>{i.push(r),By.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",yu(By.postMessage)),zae=typeof queueMicrotask<"u"?queueMicrotask.bind(By):typeof process<"u"&&process.nextTick||S$,bn={isArray:_w,isArrayBuffer:v$,isBuffer:nae,isFormData:hae,isArrayBufferView:iae,isString:rae,isNumber:y$,isBoolean:sae,isObject:TA,isPlainObject:nR,isReadableStream:fae,isRequest:pae,isResponse:mae,isHeaders:gae,isUndefined:nS,isDate:oae,isFile:aae,isBlob:lae,isRegExp:Aae,isFunction:yu,isStream:uae,isURLSearchParams:dae,isTypedArray:bae,isFileList:cae,forEach:NS,merge:cL,extend:yae,trim:vae,stripBOM:_ae,inherits:xae,toFlatObject:wae,kindOf:MA,kindOfTest:md,endsWith:Cae,toArray:Sae,forEachEntry:Eae,matchAll:Mae,isHTMLForm:Rae,hasOwnProperty:g5,hasOwnProp:g5,reduceDescriptors:w$,freezeMethods:Pae,toObjectSet:Iae,toCamelCase:Tae,noop:Dae,toFiniteNumber:Fae,findKey:_$,global:By,isContextDefined:x$,ALPHABET:C$,generateString:Lae,isSpecCompliantForm:Oae,toJSONObject:kae,isAsyncFn:Nae,isThenable:Bae,setImmediate:S$,asap:zae};function Lr(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}bn.inherits(Lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:bn.toJSONObject(this.config),code:this.code,status:this.status}}});const b$=Lr.prototype,E$={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{E$[t]={value:t}});Object.defineProperties(Lr,E$);Object.defineProperty(b$,"isAxiosError",{value:!0});Lr.from=(t,e,n,i,r,o)=>{const c=Object.create(b$);return bn.toFlatObject(t,c,function(f){return f!==Error.prototype},s=>s!=="isAxiosError"),Lr.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,o&&Object.assign(c,o),c};const Uae=null;function uL(t){return bn.isPlainObject(t)||bn.isArray(t)}function M$(t){return bn.endsWith(t,"[]")?t.slice(0,-2):t}function y5(t,e,n){return t?t.concat(e).map(function(r,o){return r=M$(r),!n&&o?"["+r+"]":r}).join(n?".":""):e}function Vae(t){return bn.isArray(t)&&!t.some(uL)}const Gae=bn.toFlatObject(bn,{},null,function(e){return/^is[A-Z]/.test(e)});function AA(t,e,n){if(!bn.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=bn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(z,L){return!bn.isUndefined(L[z])});const i=n.metaTokens,r=n.visitor||w,o=n.dots,c=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&bn.isSpecCompliantForm(e);if(!bn.isFunction(r))throw new TypeError("visitor must be a function");function v(N){if(N===null)return"";if(bn.isDate(N))return N.toISOString();if(!f&&bn.isBlob(N))throw new Lr("Blob is not supported. Use a Buffer instead.");return bn.isArrayBuffer(N)||bn.isTypedArray(N)?f&&typeof Blob=="function"?new Blob([N]):Buffer.from(N):N}function w(N,z,L){let P=N;if(N&&!L&&typeof N=="object"){if(bn.endsWith(z,"{}"))z=i?z:z.slice(0,-2),N=JSON.stringify(N);else if(bn.isArray(N)&&Vae(N)||(bn.isFileList(N)||bn.endsWith(z,"[]"))&&(P=bn.toArray(N)))return z=M$(z),P.forEach(function(j,q){!(bn.isUndefined(j)||j===null)&&e.append(c===!0?y5([z],q,o):c===null?z:z+"[]",v(j))}),!1}return uL(N)?!0:(e.append(y5(L,z,o),v(N)),!1)}const C=[],M=Object.assign(Gae,{defaultVisitor:w,convertValue:v,isVisitable:uL});function F(N,z){if(!bn.isUndefined(N)){if(C.indexOf(N)!==-1)throw Error("Circular reference detected in "+z.join("."));C.push(N),bn.forEach(N,function(P,H){(!(bn.isUndefined(P)||P===null)&&r.call(e,P,bn.isString(H)?H.trim():H,z,M))===!0&&F(P,z?z.concat(H):[H])}),C.pop()}}if(!bn.isObject(t))throw new TypeError("data must be an object");return F(t),e}function _5(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function o3(t,e){this._pairs=[],t&&AA(t,this,e)}const R$=o3.prototype;R$.append=function(e,n){this._pairs.push([e,n])};R$.toString=function(e){const n=e?function(i){return e.call(this,i,_5)}:_5;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function Hae(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function T$(t,e,n){if(!e)return t;const i=n&&n.encode||Hae,r=n&&n.serialize;let o;if(r?o=r(e,n):o=bn.isURLSearchParams(e)?e.toString():new o3(e,n).toString(i),o){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class x5{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){bn.forEach(this.handlers,function(i){i!==null&&e(i)})}}const A$={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Wae=typeof URLSearchParams<"u"?URLSearchParams:o3,jae=typeof FormData<"u"?FormData:null,$ae=typeof Blob<"u"?Blob:null,qae={isBrowser:!0,classes:{URLSearchParams:Wae,FormData:jae,Blob:$ae},protocols:["http","https","file","blob","url","data"]},a3=typeof window<"u"&&typeof document<"u",hL=typeof navigator=="object"&&navigator||void 0,Zae=a3&&(!hL||["ReactNative","NativeScript","NS"].indexOf(hL.product)<0),Xae=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kae=a3&&window.location.href||"http://localhost",Yae=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:a3,hasStandardBrowserEnv:Zae,hasStandardBrowserWebWorkerEnv:Xae,navigator:hL,origin:Kae},Symbol.toStringTag,{value:"Module"})),Uc={...Yae,...qae};function Jae(t,e){return AA(t,new Uc.classes.URLSearchParams,Object.assign({visitor:function(n,i,r,o){return Uc.isNode&&bn.isBuffer(n)?(this.append(i,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Qae(t){return bn.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ele(t){const e={},n=Object.keys(t);let i;const r=n.length;let o;for(i=0;i<r;i++)o=n[i],e[o]=t[o];return e}function P$(t){function e(n,i,r,o){let c=n[o++];if(c==="__proto__")return!0;const s=Number.isFinite(+c),f=o>=n.length;return c=!c&&bn.isArray(r)?r.length:c,f?(bn.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!s):((!r[c]||!bn.isObject(r[c]))&&(r[c]=[]),e(n,i,r[c],o)&&bn.isArray(r[c])&&(r[c]=ele(r[c])),!s)}if(bn.isFormData(t)&&bn.isFunction(t.entries)){const n={};return bn.forEachEntry(t,(i,r)=>{e(Qae(i),r,n,0)}),n}return null}function tle(t,e,n){if(bn.isString(t))try{return(e||JSON.parse)(t),bn.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const BS={transitional:A$,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",r=i.indexOf("application/json")>-1,o=bn.isObject(e);if(o&&bn.isHTMLForm(e)&&(e=new FormData(e)),bn.isFormData(e))return r?JSON.stringify(P$(e)):e;if(bn.isArrayBuffer(e)||bn.isBuffer(e)||bn.isStream(e)||bn.isFile(e)||bn.isBlob(e)||bn.isReadableStream(e))return e;if(bn.isArrayBufferView(e))return e.buffer;if(bn.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Jae(e,this.formSerializer).toString();if((s=bn.isFileList(e))||i.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return AA(s?{"files[]":e}:e,f&&new f,this.formSerializer)}}return o||r?(n.setContentType("application/json",!1),tle(e)):e}],transformResponse:[function(e){const n=this.transitional||BS.transitional,i=n&&n.forcedJSONParsing,r=this.responseType==="json";if(bn.isResponse(e)||bn.isReadableStream(e))return e;if(e&&bn.isString(e)&&(i&&!this.responseType||r)){const c=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(c)throw s.name==="SyntaxError"?Lr.from(s,Lr.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Uc.classes.FormData,Blob:Uc.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};bn.forEach(["delete","get","head","post","put","patch"],t=>{BS.headers[t]={}});const nle=bn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ile=t=>{const e={};let n,i,r;return t&&t.split(`
`).forEach(function(c){r=c.indexOf(":"),n=c.substring(0,r).trim().toLowerCase(),i=c.substring(r+1).trim(),!(!n||e[n]&&nle[n])&&(n==="set-cookie"?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)}),e},w5=Symbol("internals");function LC(t){return t&&String(t).trim().toLowerCase()}function iR(t){return t===!1||t==null?t:bn.isArray(t)?t.map(iR):String(t)}function rle(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}const sle=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function lD(t,e,n,i,r){if(bn.isFunction(i))return i.call(this,e,n);if(r&&(e=n),!!bn.isString(e)){if(bn.isString(i))return e.indexOf(i)!==-1;if(bn.isRegExp(i))return i.test(e)}}function ole(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,i)=>n.toUpperCase()+i)}function ale(t,e){const n=bn.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(r,o,c){return this[i].call(this,e,r,o,c)},configurable:!0})})}class Vc{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function o(s,f,v){const w=LC(f);if(!w)throw new Error("header name must be a non-empty string");const C=bn.findKey(r,w);(!C||r[C]===void 0||v===!0||v===void 0&&r[C]!==!1)&&(r[C||f]=iR(s))}const c=(s,f)=>bn.forEach(s,(v,w)=>o(v,w,f));if(bn.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(bn.isString(e)&&(e=e.trim())&&!sle(e))c(ile(e),n);else if(bn.isHeaders(e))for(const[s,f]of e.entries())o(f,s,i);else e!=null&&o(n,e,i);return this}get(e,n){if(e=LC(e),e){const i=bn.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return rle(r);if(bn.isFunction(n))return n.call(this,r,i);if(bn.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=LC(e),e){const i=bn.findKey(this,e);return!!(i&&this[i]!==void 0&&(!n||lD(this,this[i],i,n)))}return!1}delete(e,n){const i=this;let r=!1;function o(c){if(c=LC(c),c){const s=bn.findKey(i,c);s&&(!n||lD(i,i[s],s,n))&&(delete i[s],r=!0)}}return bn.isArray(e)?e.forEach(o):o(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const o=n[i];(!e||lD(this,this[o],o,e,!0))&&(delete this[o],r=!0)}return r}normalize(e){const n=this,i={};return bn.forEach(this,(r,o)=>{const c=bn.findKey(i,o);if(c){n[c]=iR(r),delete n[o];return}const s=e?ole(o):String(o).trim();s!==o&&delete n[o],n[s]=iR(r),i[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return bn.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&bn.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const i=new this(e);return n.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[w5]=this[w5]={accessors:{}}).accessors,r=this.prototype;function o(c){const s=LC(c);i[s]||(ale(r,c),i[s]=!0)}return bn.isArray(e)?e.forEach(o):o(e),this}}Vc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);bn.reduceDescriptors(Vc.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}});bn.freezeMethods(Vc);function cD(t,e){const n=this||BS,i=e||n,r=Vc.from(i.headers);let o=i.data;return bn.forEach(t,function(s){o=s.call(n,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function I$(t){return!!(t&&t.__CANCEL__)}function xw(t,e,n){Lr.call(this,t??"canceled",Lr.ERR_CANCELED,e,n),this.name="CanceledError"}bn.inherits(xw,Lr,{__CANCEL__:!0});function D$(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new Lr("Request failed with status code "+n.status,[Lr.ERR_BAD_REQUEST,Lr.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function lle(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function cle(t,e){t=t||10;const n=new Array(t),i=new Array(t);let r=0,o=0,c;return e=e!==void 0?e:1e3,function(f){const v=Date.now(),w=i[o];c||(c=v),n[r]=f,i[r]=v;let C=o,M=0;for(;C!==r;)M+=n[C++],C=C%t;if(r=(r+1)%t,r===o&&(o=(o+1)%t),v-c<e)return;const F=w&&v-w;return F?Math.round(M*1e3/F):void 0}}function ule(t,e){let n=0,i=1e3/e,r,o;const c=(v,w=Date.now())=>{n=w,r=null,o&&(clearTimeout(o),o=null),t.apply(null,v)};return[(...v)=>{const w=Date.now(),C=w-n;C>=i?c(v,w):(r=v,o||(o=setTimeout(()=>{o=null,c(r)},i-C)))},()=>r&&c(r)]}const XR=(t,e,n=3)=>{let i=0;const r=cle(50,250);return ule(o=>{const c=o.loaded,s=o.lengthComputable?o.total:void 0,f=c-i,v=r(f),w=c<=s;i=c;const C={loaded:c,total:s,progress:s?c/s:void 0,bytes:f,rate:v||void 0,estimated:v&&s&&w?(s-c)/v:void 0,event:o,lengthComputable:s!=null,[e?"download":"upload"]:!0};t(C)},n)},C5=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},S5=t=>(...e)=>bn.asap(()=>t(...e)),hle=Uc.hasStandardBrowserEnv?function(){const e=Uc.navigator&&/(msie|trident)/i.test(Uc.navigator.userAgent),n=document.createElement("a");let i;function r(o){let c=o;return e&&(n.setAttribute("href",c),c=n.href),n.setAttribute("href",c),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return i=r(window.location.href),function(c){const s=bn.isString(c)?r(c):c;return s.protocol===i.protocol&&s.host===i.host}}():function(){return function(){return!0}}(),dle=Uc.hasStandardBrowserEnv?{write(t,e,n,i,r,o){const c=[t+"="+encodeURIComponent(e)];bn.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),bn.isString(i)&&c.push("path="+i),bn.isString(r)&&c.push("domain="+r),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function fle(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function ple(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function F$(t,e){return t&&!fle(e)?ple(t,e):e}const b5=t=>t instanceof Vc?{...t}:t;function x_(t,e){e=e||{};const n={};function i(v,w,C){return bn.isPlainObject(v)&&bn.isPlainObject(w)?bn.merge.call({caseless:C},v,w):bn.isPlainObject(w)?bn.merge({},w):bn.isArray(w)?w.slice():w}function r(v,w,C){if(bn.isUndefined(w)){if(!bn.isUndefined(v))return i(void 0,v,C)}else return i(v,w,C)}function o(v,w){if(!bn.isUndefined(w))return i(void 0,w)}function c(v,w){if(bn.isUndefined(w)){if(!bn.isUndefined(v))return i(void 0,v)}else return i(void 0,w)}function s(v,w,C){if(C in e)return i(v,w);if(C in t)return i(void 0,v)}const f={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:s,headers:(v,w)=>r(b5(v),b5(w),!0)};return bn.forEach(Object.keys(Object.assign({},t,e)),function(w){const C=f[w]||r,M=C(t[w],e[w],w);bn.isUndefined(M)&&C!==s||(n[w]=M)}),n}const L$=t=>{const e=x_({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:o,headers:c,auth:s}=e;e.headers=c=Vc.from(c),e.url=T$(F$(e.baseURL,e.url),t.params,t.paramsSerializer),s&&c.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let f;if(bn.isFormData(n)){if(Uc.hasStandardBrowserEnv||Uc.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((f=c.getContentType())!==!1){const[v,...w]=f?f.split(";").map(C=>C.trim()).filter(Boolean):[];c.setContentType([v||"multipart/form-data",...w].join("; "))}}if(Uc.hasStandardBrowserEnv&&(i&&bn.isFunction(i)&&(i=i(e)),i||i!==!1&&hle(e.url))){const v=r&&o&&dle.read(o);v&&c.set(r,v)}return e},mle=typeof XMLHttpRequest<"u",gle=mle&&function(t){return new Promise(function(n,i){const r=L$(t);let o=r.data;const c=Vc.from(r.headers).normalize();let{responseType:s,onUploadProgress:f,onDownloadProgress:v}=r,w,C,M,F,N;function z(){F&&F(),N&&N(),r.cancelToken&&r.cancelToken.unsubscribe(w),r.signal&&r.signal.removeEventListener("abort",w)}let L=new XMLHttpRequest;L.open(r.method.toUpperCase(),r.url,!0),L.timeout=r.timeout;function P(){if(!L)return;const j=Vc.from("getAllResponseHeaders"in L&&L.getAllResponseHeaders()),le={data:!s||s==="text"||s==="json"?L.responseText:L.response,status:L.status,statusText:L.statusText,headers:j,config:t,request:L};D$(function(ae){n(ae),z()},function(ae){i(ae),z()},le),L=null}"onloadend"in L?L.onloadend=P:L.onreadystatechange=function(){!L||L.readyState!==4||L.status===0&&!(L.responseURL&&L.responseURL.indexOf("file:")===0)||setTimeout(P)},L.onabort=function(){L&&(i(new Lr("Request aborted",Lr.ECONNABORTED,t,L)),L=null)},L.onerror=function(){i(new Lr("Network Error",Lr.ERR_NETWORK,t,L)),L=null},L.ontimeout=function(){let q=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const le=r.transitional||A$;r.timeoutErrorMessage&&(q=r.timeoutErrorMessage),i(new Lr(q,le.clarifyTimeoutError?Lr.ETIMEDOUT:Lr.ECONNABORTED,t,L)),L=null},o===void 0&&c.setContentType(null),"setRequestHeader"in L&&bn.forEach(c.toJSON(),function(q,le){L.setRequestHeader(le,q)}),bn.isUndefined(r.withCredentials)||(L.withCredentials=!!r.withCredentials),s&&s!=="json"&&(L.responseType=r.responseType),v&&([M,N]=XR(v,!0),L.addEventListener("progress",M)),f&&L.upload&&([C,F]=XR(f),L.upload.addEventListener("progress",C),L.upload.addEventListener("loadend",F)),(r.cancelToken||r.signal)&&(w=j=>{L&&(i(!j||j.type?new xw(null,t,L):j),L.abort(),L=null)},r.cancelToken&&r.cancelToken.subscribe(w),r.signal&&(r.signal.aborted?w():r.signal.addEventListener("abort",w)));const H=lle(r.url);if(H&&Uc.protocols.indexOf(H)===-1){i(new Lr("Unsupported protocol "+H+":",Lr.ERR_BAD_REQUEST,t));return}L.send(o||null)})},vle=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i=new AbortController,r;const o=function(v){if(!r){r=!0,s();const w=v instanceof Error?v:this.reason;i.abort(w instanceof Lr?w:new xw(w instanceof Error?w.message:w))}};let c=e&&setTimeout(()=>{c=null,o(new Lr(`timeout ${e} of ms exceeded`,Lr.ETIMEDOUT))},e);const s=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(o):v.removeEventListener("abort",o)}),t=null)};t.forEach(v=>v.addEventListener("abort",o));const{signal:f}=i;return f.unsubscribe=()=>bn.asap(s),f}},yle=function*(t,e){let n=t.byteLength;if(!e||n<e){yield t;return}let i=0,r;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},_le=async function*(t,e){for await(const n of xle(t))yield*yle(n,e)},xle=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:i}=await e.read();if(n)break;yield i}}finally{await e.cancel()}},E5=(t,e,n,i)=>{const r=_le(t,e);let o=0,c,s=f=>{c||(c=!0,i&&i(f))};return new ReadableStream({async pull(f){try{const{done:v,value:w}=await r.next();if(v){s(),f.close();return}let C=w.byteLength;if(n){let M=o+=C;n(M)}f.enqueue(new Uint8Array(w))}catch(v){throw s(v),v}},cancel(f){return s(f),r.return()}},{highWaterMark:2})},PA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",O$=PA&&typeof ReadableStream=="function",wle=PA&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),k$=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Cle=O$&&k$(()=>{let t=!1;const e=new Request(Uc.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),M5=64*1024,dL=O$&&k$(()=>bn.isReadableStream(new Response("").body)),KR={stream:dL&&(t=>t.body)};PA&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!KR[e]&&(KR[e]=bn.isFunction(t[e])?n=>n[e]():(n,i)=>{throw new Lr(`Response type '${e}' is not supported`,Lr.ERR_NOT_SUPPORT,i)})})})(new Response);const Sle=async t=>{if(t==null)return 0;if(bn.isBlob(t))return t.size;if(bn.isSpecCompliantForm(t))return(await new Request(Uc.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(bn.isArrayBufferView(t)||bn.isArrayBuffer(t))return t.byteLength;if(bn.isURLSearchParams(t)&&(t=t+""),bn.isString(t))return(await wle(t)).byteLength},ble=async(t,e)=>{const n=bn.toFiniteNumber(t.getContentLength());return n??Sle(e)},Ele=PA&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:o,timeout:c,onDownloadProgress:s,onUploadProgress:f,responseType:v,headers:w,withCredentials:C="same-origin",fetchOptions:M}=L$(t);v=v?(v+"").toLowerCase():"text";let F=vle([r,o&&o.toAbortSignal()],c),N;const z=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let L;try{if(f&&Cle&&n!=="get"&&n!=="head"&&(L=await ble(w,i))!==0){let le=new Request(e,{method:"POST",body:i,duplex:"half"}),ce;if(bn.isFormData(i)&&(ce=le.headers.get("content-type"))&&w.setContentType(ce),le.body){const[ae,pe]=C5(L,XR(S5(f)));i=E5(le.body,M5,ae,pe)}}bn.isString(C)||(C=C?"include":"omit");const P="credentials"in Request.prototype;N=new Request(e,{...M,signal:F,method:n.toUpperCase(),headers:w.normalize().toJSON(),body:i,duplex:"half",credentials:P?C:void 0});let H=await fetch(N);const j=dL&&(v==="stream"||v==="response");if(dL&&(s||j&&z)){const le={};["status","statusText","headers"].forEach(fe=>{le[fe]=H[fe]});const ce=bn.toFiniteNumber(H.headers.get("content-length")),[ae,pe]=s&&C5(ce,XR(S5(s),!0))||[];H=new Response(E5(H.body,M5,ae,()=>{pe&&pe(),z&&z()}),le)}v=v||"text";let q=await KR[bn.findKey(KR,v)||"text"](H,t);return!j&&z&&z(),await new Promise((le,ce)=>{D$(le,ce,{data:q,headers:Vc.from(H.headers),status:H.status,statusText:H.statusText,config:t,request:N})})}catch(P){throw z&&z(),P&&P.name==="TypeError"&&/fetch/i.test(P.message)?Object.assign(new Lr("Network Error",Lr.ERR_NETWORK,t,N),{cause:P.cause||P}):Lr.from(P,P&&P.code,t,N)}}),fL={http:Uae,xhr:gle,fetch:Ele};bn.forEach(fL,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const R5=t=>`- ${t}`,Mle=t=>bn.isFunction(t)||t===null||t===!1,N$={getAdapter:t=>{t=bn.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let o=0;o<e;o++){n=t[o];let c;if(i=n,!Mle(n)&&(i=fL[(c=String(n)).toLowerCase()],i===void 0))throw new Lr(`Unknown adapter '${c}'`);if(i)break;r[c||"#"+o]=i}if(!i){const o=Object.entries(r).map(([s,f])=>`adapter ${s} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=e?o.length>1?`since :
`+o.map(R5).join(`
`):" "+R5(o[0]):"as no adapter specified";throw new Lr("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return i},adapters:fL};function uD(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xw(null,t)}function T5(t){return uD(t),t.headers=Vc.from(t.headers),t.data=cD.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),N$.getAdapter(t.adapter||BS.adapter)(t).then(function(i){return uD(t),i.data=cD.call(t,t.transformResponse,i),i.headers=Vc.from(i.headers),i},function(i){return I$(i)||(uD(t),i&&i.response&&(i.response.data=cD.call(t,t.transformResponse,i.response),i.response.headers=Vc.from(i.response.headers))),Promise.reject(i)})}const B$="1.7.7",l3={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{l3[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const A5={};l3.transitional=function(e,n,i){function r(o,c){return"[Axios v"+B$+"] Transitional option '"+o+"'"+c+(i?". "+i:"")}return(o,c,s)=>{if(e===!1)throw new Lr(r(c," has been removed"+(n?" in "+n:"")),Lr.ERR_DEPRECATED);return n&&!A5[c]&&(A5[c]=!0,console.warn(r(c," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(o,c,s):!0}};function Rle(t,e,n){if(typeof t!="object")throw new Lr("options must be an object",Lr.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const o=i[r],c=e[o];if(c){const s=t[o],f=s===void 0||c(s,o,t);if(f!==!0)throw new Lr("option "+o+" must be "+f,Lr.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Lr("Unknown option "+o,Lr.ERR_BAD_OPTION)}}const pL={assertOptions:Rle,validators:l3},pg=pL.validators;class e_{constructor(e){this.defaults=e,this.interceptors={request:new x5,response:new x5}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?o&&!String(i.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+o):i.stack=o}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=x_(this.defaults,n);const{transitional:i,paramsSerializer:r,headers:o}=n;i!==void 0&&pL.assertOptions(i,{silentJSONParsing:pg.transitional(pg.boolean),forcedJSONParsing:pg.transitional(pg.boolean),clarifyTimeoutError:pg.transitional(pg.boolean)},!1),r!=null&&(bn.isFunction(r)?n.paramsSerializer={serialize:r}:pL.assertOptions(r,{encode:pg.function,serialize:pg.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let c=o&&bn.merge(o.common,o[n.method]);o&&bn.forEach(["delete","get","head","post","put","patch","common"],N=>{delete o[N]}),n.headers=Vc.concat(c,o);const s=[];let f=!0;this.interceptors.request.forEach(function(z){typeof z.runWhen=="function"&&z.runWhen(n)===!1||(f=f&&z.synchronous,s.unshift(z.fulfilled,z.rejected))});const v=[];this.interceptors.response.forEach(function(z){v.push(z.fulfilled,z.rejected)});let w,C=0,M;if(!f){const N=[T5.bind(this),void 0];for(N.unshift.apply(N,s),N.push.apply(N,v),M=N.length,w=Promise.resolve(n);C<M;)w=w.then(N[C++],N[C++]);return w}M=s.length;let F=n;for(C=0;C<M;){const N=s[C++],z=s[C++];try{F=N(F)}catch(L){z.call(this,L);break}}try{w=T5.call(this,F)}catch(N){return Promise.reject(N)}for(C=0,M=v.length;C<M;)w=w.then(v[C++],v[C++]);return w}getUri(e){e=x_(this.defaults,e);const n=F$(e.baseURL,e.url);return T$(n,e.params,e.paramsSerializer)}}bn.forEach(["delete","get","head","options"],function(e){e_.prototype[e]=function(n,i){return this.request(x_(i||{},{method:e,url:n,data:(i||{}).data}))}});bn.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,s){return this.request(x_(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}e_.prototype[e]=n(),e_.prototype[e+"Form"]=n(!0)});class c3{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const i=this;this.promise.then(r=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](r);i._listeners=null}),this.promise.then=r=>{let o;const c=new Promise(s=>{i.subscribe(s),o=s}).then(r);return c.cancel=function(){i.unsubscribe(o)},c},e(function(o,c,s){i.reason||(i.reason=new xw(o,c,s),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new c3(function(r){e=r}),cancel:e}}}function Tle(t){return function(n){return t.apply(null,n)}}function Ale(t){return bn.isObject(t)&&t.isAxiosError===!0}const mL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mL).forEach(([t,e])=>{mL[e]=t});function z$(t){const e=new e_(t),n=g$(e_.prototype.request,e);return bn.extend(n,e_.prototype,e,{allOwnKeys:!0}),bn.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return z$(x_(t,r))},n}const Wr=z$(BS);Wr.Axios=e_;Wr.CanceledError=xw;Wr.CancelToken=c3;Wr.isCancel=I$;Wr.VERSION=B$;Wr.toFormData=AA;Wr.AxiosError=Lr;Wr.Cancel=Wr.CanceledError;Wr.all=function(e){return Promise.all(e)};Wr.spread=Tle;Wr.isAxiosError=Ale;Wr.mergeConfig=x_;Wr.AxiosHeaders=Vc;Wr.formToJSON=t=>P$(bn.isHTMLForm(t)?new FormData(t):t);Wr.getAdapter=N$.getAdapter;Wr.HttpStatusCode=mL;Wr.default=Wr;var Qh={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://mywayrtkapi.cyrusbowman.com"};let Ple=0;function Pa(t,e){const n=`atom${++Ple}`,i={toString(){return(Qh?"production":void 0)!=="production"&&this.debugLabel?n+":"+this.debugLabel:n}};return typeof t=="function"?i.read=t:(i.init=t,i.read=Ile,i.write=Dle),i}function Ile(t){return t(this)}function Dle(t,e,n){return e(this,typeof n=="function"?n(t(this)):n)}const P5=(t,e)=>t.unstable_is?t.unstable_is(e):e===t,hD=t=>"init"in t,dD=t=>!!t.write,x1=Symbol((Qh?"production":void 0)!=="production"?"CONTINUE_PROMISE":""),u3="pending",Fle="fulfilled",Lle="rejected",Ole=t=>typeof t=="object"&&t!==null&&x1 in t,ME=new WeakMap,kle=(t,e,n)=>{if(!ME.has(t)){let i;const r=new Promise((o,c)=>{let s=t;const f=w=>C=>{s===w&&(r.status=Fle,r.value=C,o(C),n())},v=w=>C=>{s===w&&(r.status=Lle,r.reason=C,c(C),n())};t.then(f(t),v(t)),i=(w,C)=>{w&&(ME.set(w,r),s=w,w.then(f(w),v(w)),e(),e=C)}});r.status=u3,r[x1]=i,ME.set(t,r)}return ME.get(t)},Nle=t=>typeof(t==null?void 0:t.then)=="function",I5=t=>"v"in t||"e"in t,RE=t=>{if("e"in t)throw t.e;if((Qh?"production":void 0)!=="production"&&!("v"in t))throw new Error("[Bug] atom state is not initialized");return t.v},rR=t=>{const e=t.v;return Ole(e)&&e.status===u3?e:null},U$=(t,e,n)=>{n.p.has(t)||(n.p.add(t),e.then(()=>{n.p.delete(t)},()=>{n.p.delete(t)}))},D5=(t,e,n,i,r)=>{var o;if((Qh?"production":void 0)!=="production"&&i===e)throw new Error("[Bug] atom cannot depend on itself");n.d.set(i,r.n);const c=rR(n);c&&U$(e,c,r),(o=r.m)==null||o.t.add(e),t&&Ble(t,i,e)},b0=()=>[new Map,new Map,new Set],fD=(t,e,n)=>{t[0].has(e)||t[0].set(e,new Set),t[1].set(e,n)},Ble=(t,e,n)=>{const i=t[0].get(e);i&&i.add(n)},zle=(t,e)=>t[0].get(e),F5=(t,e)=>{t[2].add(e)},hy=t=>{for(;t[1].size||t[2].size;){t[0].clear();const e=new Set(t[1].values());t[1].clear();const n=new Set(t[2]);t[2].clear(),e.forEach(i=>{var r;return(r=i.m)==null?void 0:r.l.forEach(o=>o())}),n.forEach(i=>i())}},V$=t=>{let e;(Qh?"production":void 0)!=="production"&&(e=new Set);const n=(z,L,P,H=()=>{},j=()=>{})=>{const q="v"in L,le=L.v,ce=rR(L);if(Nle(P))if(ce)ce!==P&&(ce[x1](P,H),++L.n);else{const ae=kle(P,H,j);if(ae.status===u3)for(const pe of L.d.keys())U$(z,ae,t(pe,L));L.v=ae,delete L.e}else ce&&ce[x1](Promise.resolve(P),H),L.v=P,delete L.e;(!q||!Object.is(le,L.v))&&++L.n},i=(z,L,P,H)=>{if(!(H!=null&&H(L))&&I5(P)&&(P.m||Array.from(P.d).every(([pe,fe])=>i(z,pe,t(pe,P),H).n===fe)))return P;P.d.clear();let j=!0;const q=pe=>{if(P5(L,pe)){const ue=t(pe,P);if(!I5(ue))if(hD(pe))n(pe,ue,pe.init);else throw new Error("no atom init");return RE(ue)}const fe=i(z,pe,t(pe,P),H);if(j)D5(z,L,P,pe,fe);else{const ue=b0();D5(ue,L,P,pe,fe),v(ue,L,P),hy(ue)}return RE(fe)};let le,ce;const ae={get signal(){return le||(le=new AbortController),le.signal},get setSelf(){return(Qh?"production":void 0)!=="production"&&!dD(L)&&console.warn("setSelf function cannot be used with read-only atom"),!ce&&dD(L)&&(ce=(...pe)=>{if((Qh?"production":void 0)!=="production"&&j&&console.warn("setSelf function cannot be called in sync"),!j)return f(L,...pe)}),ce}};try{const pe=L.read(q,ae);return n(L,P,pe,()=>le==null?void 0:le.abort(),()=>{if(P.m){const fe=b0();v(fe,L,P),hy(fe)}}),P}catch(pe){return delete P.v,P.e=pe,++P.n,P}finally{j=!1}},r=z=>RE(i(void 0,z,t(z))),o=(z,L,P)=>{var H,j;const q=new Map;for(const le of((H=P.m)==null?void 0:H.t)||[])q.set(le,t(le,P));for(const le of P.p)q.set(le,t(le,P));return(j=zle(z,L))==null||j.forEach(le=>{q.set(le,t(le,P))}),q},c=(z,L,P)=>{const H=[],j=new Set,q=(ae,pe)=>{if(!j.has(ae)){j.add(ae);for(const[fe,ue]of o(z,ae,pe))ae!==fe&&q(fe,ue);H.push([ae,pe,pe.n])}};q(L,P);const le=new Set([L]),ce=ae=>j.has(ae);for(let ae=H.length-1;ae>=0;--ae){const[pe,fe,ue]=H[ae];let Ee=!1;for(const We of fe.d.keys())if(We!==pe&&le.has(We)){Ee=!0;break}Ee&&(i(z,pe,fe,ce),v(z,pe,fe),ue!==fe.n&&(fD(z,pe,fe),le.add(pe))),j.delete(pe)}},s=(z,L,P,...H)=>{const j=ce=>RE(i(z,ce,t(ce,P))),q=(ce,...ae)=>{const pe=t(ce,P);let fe;if(P5(L,ce)){if(!hD(ce))throw new Error("atom not writable");const ue="v"in pe,Ee=pe.v,We=ae[0];n(ce,pe,We),v(z,ce,pe),(!ue||!Object.is(Ee,pe.v))&&(fD(z,ce,pe),c(z,ce,pe))}else fe=s(z,ce,pe,...ae);return hy(z),fe};return L.write(j,q,...H)},f=(z,...L)=>{const P=b0(),H=s(P,z,t(z),...L);return hy(P),H},v=(z,L,P)=>{if(P.m&&!rR(P)){for(const H of P.d.keys())P.m.d.has(H)||(w(z,H,t(H,P)).t.add(L),P.m.d.add(H));for(const H of P.m.d||[])if(!P.d.has(H)){P.m.d.delete(H);const j=C(z,H,t(H,P));j==null||j.t.delete(L)}}},w=(z,L,P)=>{if(!P.m){i(z,L,P);for(const H of P.d.keys())w(z,H,t(H,P)).t.add(L);if(P.m={l:new Set,d:new Set(P.d.keys()),t:new Set},(Qh?"production":void 0)!=="production"&&e.add(L),dD(L)&&L.onMount){const H=P.m,{onMount:j}=L;F5(z,()=>{const q=j((...le)=>s(z,L,P,...le));q&&(H.u=q)})}}return P.m},C=(z,L,P)=>{if(P.m&&!P.m.l.size&&!Array.from(P.m.t).some(H=>{var j;return(j=t(H,P).m)==null?void 0:j.d.has(L)})){const H=P.m.u;H&&F5(z,H),delete P.m,(Qh?"production":void 0)!=="production"&&e.delete(L);for(const q of P.d.keys()){const le=C(z,q,t(q,P));le==null||le.t.delete(L)}const j=rR(P);j&&j[x1](void 0,()=>{});return}return P.m},N={get:r,set:f,sub:(z,L)=>{const P=b0(),H=t(z),j=w(P,z,H);hy(P);const q=j.l;return q.add(L),()=>{q.delete(L);const le=b0();C(le,z,H),hy(le)}},unstable_derive:z=>V$(...z(t))};return(Qh?"production":void 0)!=="production"&&Object.assign(N,{dev4_get_internal_weak_map:()=>({get:L=>{const P=t(L);if(P.n!==0)return P}}),dev4_get_mounted_atoms:()=>e,dev4_restore_atoms:L=>{const P=b0();for(const[H,j]of L)if(hD(H)){const q=t(H),le="v"in q,ce=q.v;n(H,q,j),v(P,H,q),(!le||!Object.is(ce,q.v))&&(fD(P,H,q),c(P,H,q))}hy(P)}}),N},Ule=()=>{const t=new WeakMap;return V$(n=>{let i=t.get(n);return i||(i={d:new Map,p:new Set,n:0},t.set(n,i)),i})};let OC;const _v=()=>(OC||(OC=Ule(),(Qh?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=OC),globalThis.__JOTAI_DEFAULT_STORE__!==OC&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),OC);var Vle={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://mywayrtkapi.cyrusbowman.com"};const Gle=Q.createContext(void 0),G$=t=>Q.useContext(Gle)||_v(),Hle=t=>typeof(t==null?void 0:t.then)=="function",Wle=kn.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function YR(t,e){const n=G$(),[[i,r,o],c]=Q.useReducer(v=>{const w=n.get(t);return Object.is(v[0],w)&&v[1]===n&&v[2]===t?v:[w,n,t]},void 0,()=>[n.get(t),n,t]);let s=i;return(r!==n||o!==t)&&(c(),s=n.get(t)),Q.useEffect(()=>{const v=n.sub(t,()=>{c()});return c(),v},[n,t,void 0]),Q.useDebugValue(s),Hle(s)?Wle(s):s}function xv(t,e){const n=G$();return Q.useCallback((...r)=>{if((Vle?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return n.set(t,...r)},[n,t])}function Ha(t,e){return[YR(t),xv(t)]}const jle=Symbol(),L5=Object.getPrototypeOf,O5=new WeakMap,$le=t=>t&&(O5.has(t)?O5.get(t):L5(t)===Object.prototype||L5(t)===Array.prototype),qle=t=>$le(t)&&t[jle]||null;var k5={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://mywayrtkapi.cyrusbowman.com"};const h3=t=>typeof t=="object"&&t!==null,Zle=t=>h3(t)&&!H$.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),Xle=(t,e,n,i)=>({deleteProperty(r,o){const c=Reflect.get(r,o);n(o);const s=Reflect.deleteProperty(r,o);return s&&i(["delete",[o],c]),s},set(r,o,c,s){const f=!t()&&Reflect.has(r,o),v=Reflect.get(r,o,s);if(f&&(N5(v,c)||JR.has(c)&&N5(v,JR.get(c))))return!0;n(o),h3(c)&&(c=qle(c)||c);const w=!gL.has(c)&&Yle(c)?W$(c):c;return e(o,w),Reflect.set(r,o,w,s),i(["set",[o],c,v]),!0}}),gL=new WeakMap,H$=new WeakSet,TE=[1,1],JR=new WeakMap;let N5=Object.is,Kle=(t,e)=>new Proxy(t,e),Yle=Zle,Jle=Xle;function W$(t={}){if(!h3(t))throw new Error("object required");const e=JR.get(t);if(e)return e;let n=TE[0];const i=new Set,r=(L,P=++TE[0])=>{n!==P&&(n=P,i.forEach(H=>H(L,P)))};let o=TE[1];const c=(L=++TE[1])=>(o!==L&&!i.size&&(o=L,f.forEach(([P])=>{const H=P[1](L);H>n&&(n=H)})),n),s=L=>(P,H)=>{const j=[...P];j[1]=[L,...j[1]],r(j,H)},f=new Map,v=(L,P)=>{const H=!H$.has(P)&&gL.get(P);if(H){if((k5?"production":void 0)!=="production"&&f.has(L))throw new Error("prop listener already exists");if(i.size){const j=H[2](s(L));f.set(L,[H,j])}else f.set(L,[H])}},w=L=>{var P;const H=f.get(L);H&&(f.delete(L),(P=H[1])==null||P.call(H))},C=L=>(i.add(L),i.size===1&&f.forEach(([H,j],q)=>{if((k5?"production":void 0)!=="production"&&j)throw new Error("remove already exists");const le=H[2](s(q));f.set(q,[H,le])}),()=>{i.delete(L),i.size===0&&f.forEach(([H,j],q)=>{j&&(j(),f.set(q,[H]))})});let M=!0;const F=Jle(()=>M,v,w,r),N=Kle(t,F);JR.set(t,N);const z=[t,c,C];return gL.set(N,z),Reflect.ownKeys(t).forEach(L=>{const P=Object.getOwnPropertyDescriptor(t,L);"value"in P&&P.writable&&(N[L]=t[L])}),M=!1,N}const uo=W$({token:null,refreshToken:localStorage.getItem("refreshToken")}),Qle="https://mywayrtkapi.cyrusbowman.com";async function ece(t,e){console.log(`Logging in with username: ${t} and password: ${e}`);const n=await q9(e+"myway");await Wr.post(Qle+"/token",{username:t,password:n}).then(function(i){uo.token=i.data.token,uo.refreshToken=i.data.refreshToken,localStorage.setItem("refreshToken",uo.refreshToken),console.log("Set Refresh Token to:",uo.refreshToken)})}const ww="https://mywayrtkapi.cyrusbowman.com";let pD=!1,mD=null;Wr.interceptors.response.use(void 0,async t=>{var e,n,i;if(t.config&&t.response&&t.response.status===401&&((i=(n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)!=null&&i.includes("token"))&&!(t.config.url||"").includes("/token")){pD||(pD=!0,console.log("Trying to refresh token..."),mD=Wr.post(`${ww}/token/refresh`,{refreshToken:uo.refreshToken}).then(({data:r})=>(console.log("Token refreshed successfully!"),localStorage.setItem("refreshToken",r.refreshToken),uo.token=r.token,uo.refreshToken=r.refreshToken,r.token)).catch(r=>{throw console.log("Unable to refresh token, logging out..."),localStorage.setItem("refreshToken",null),window.location.href="/",r}).finally(()=>{pD=!1,mD=null}));try{const r=await mD;return t.config.headers.Authorization="Bearer "+r,console.log("Retrying request..."),Wr(t.config)}catch(r){return Promise.reject(r)}}return Promise.reject(t)});async function tce(){return console.log("fetchCustomers"),Wr.get(ww+"/customers",{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(t){return t.data})}function d3(t){return console.log("fetchCustomer",t),Wr.get(ww+"/customers/"+t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}async function nce(t){return console.log("fetchCustomerSubscriptions",t),Wr.get(`${ww}/customers/${t}/subscriptions`,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}function ice(t){return console.log("createCustomer",t),Wr.post(ww+"/customers",t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}function rce(t){if(console.log("editCustomer",t),!t.id)throw new Error("No id provided");return Wr.post(ww+"/customers",t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}var Cw=class{constructor(){this.allSyncListeners=new Map,this.allAsyncListeners=new Map,this.globalSyncListeners=new Set,this.globalAsyncListeners=new Set,this.asyncFunctionsQueue=[],this.scheduled=!1,this.firedEvents={}}setFrameworkOverrides(t){this.frameworkOverrides=t}getListeners(t,e,n){const i=e?this.allAsyncListeners:this.allSyncListeners;let r=i.get(t);return!r&&n&&(r=new Set,i.set(t,r)),r}noRegisteredListenersExist(){return this.allSyncListeners.size===0&&this.allAsyncListeners.size===0&&this.globalSyncListeners.size===0&&this.globalAsyncListeners.size===0}addEventListener(t,e,n=!1){this.getListeners(t,n,!0).add(e)}removeEventListener(t,e,n=!1){const i=this.getListeners(t,n,!1);i&&(i.delete(e),i.size===0&&(n?this.allAsyncListeners:this.allSyncListeners).delete(t))}addGlobalListener(t,e=!1){(e?this.globalAsyncListeners:this.globalSyncListeners).add(t)}removeGlobalListener(t,e=!1){(e?this.globalAsyncListeners:this.globalSyncListeners).delete(t)}dispatchEvent(t){const e=t;this.dispatchToListeners(e,!0),this.dispatchToListeners(e,!1),this.firedEvents[e.type]=!0}dispatchEventOnce(t){this.firedEvents[t.type]||this.dispatchEvent(t)}dispatchToListeners(t,e){const n=t.type;if(e&&"event"in t){const s=t.event;s instanceof Event&&(t.eventPath=s.composedPath())}const i=(s,f)=>s.forEach(v=>{if(!f.has(v))return;const w=this.frameworkOverrides?()=>this.frameworkOverrides.wrapIncoming(()=>v(t)):()=>v(t);e?this.dispatchAsync(w):w()}),r=this.getListeners(n,e,!1)??new Set,o=new Set(r);o.size>0&&i(o,r),new Set(e?this.globalAsyncListeners:this.globalSyncListeners).forEach(s=>{const f=this.frameworkOverrides?()=>this.frameworkOverrides.wrapIncoming(()=>s(n,t)):()=>s(n,t);e?this.dispatchAsync(f):f()})}dispatchAsync(t){if(this.asyncFunctionsQueue.push(t),!this.scheduled){const e=()=>{window.setTimeout(this.flushAsyncQueue.bind(this),0)};this.frameworkOverrides?this.frameworkOverrides.wrapIncoming(e):e(),this.scheduled=!0}}flushAsyncQueue(){this.scheduled=!1;const t=this.asyncFunctionsQueue.slice();this.asyncFunctionsQueue=[],t.forEach(e=>e())}};function Yr(t){if(!(!t||!t.length))return t[t.length-1]}function k_(t,e,n){return t==null&&e==null?!0:t!=null&&e!=null&&t.length===e.length&&t.every((i,r)=>n?n(i,e[r]):e[r]===i)}function sce(t){return t.sort((e,n)=>e-n)}function j$(t,e){const n=t.indexOf(e);n>=0&&(t[n]=t[t.length-1],t.pop())}function Xl(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}function oce(t,e){for(let n=0;n<e.length;n++)j$(t,e[n])}function ace(t,e){for(let n=0;n<e.length;n++)Xl(t,e[n])}function QR(t,e,n){t.splice(n,0,e)}function $$(t,e,n){ace(t,e),e.slice().reverse().forEach(i=>QR(t,i,n))}function t_(t,e){return t.indexOf(e)>-1}function lce(t){return[].concat.apply([],t)}function B5(t,e){e==null||t==null||e.forEach(n=>t.push(n))}var q$="__ag_Grid_Stop_Propagation",cce=["touchstart","touchend","touchmove","touchcancel","scroll"],gD={};function tw(t){t[q$]=!0}function Yg(t){return t[q$]===!0}var Z$=(()=>{const t={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return n=>{if(typeof gD[n]=="boolean")return gD[n];const i=document.createElement(t[n]||"div");return n="on"+n,gD[n]=n in i}})();function vL(t,e,n){let i=e;for(;i;){const r=t.getDomData(i,n);if(r)return r;i=i.parentElement}return null}function uce(t,e){return!e||!t?!1:dce(e).indexOf(t)>=0}function hce(t){const e=[];let n=t.target;for(;n;)e.push(n),n=n.parentElement;return e}function dce(t){const e=t;return e.path?e.path:e.composedPath?e.composedPath():hce(e)}function fce(t,e,n,i){const o=t_(cce,n)?{passive:!0}:void 0;t&&t.addEventListener&&t.addEventListener(e,n,i,o)}var wn=class{constructor(){this.destroyFunctions=[],this.destroyed=!1,this.__v_skip=!0,this.propertyListenerId=0,this.lastChangeSetIdLookup={},this.isAlive=()=>!this.destroyed}preWireBeans(t){this.gridId=t.context.getGridId(),this.frameworkOverrides=t.frameworkOverrides,this.stubContext=t.context,this.eventService=t.eventService,this.gos=t.gos,this.localeService=t.localeService}getFrameworkOverrides(){return this.frameworkOverrides}destroy(){for(let t=0;t<this.destroyFunctions.length;t++)this.destroyFunctions[t]();this.destroyFunctions.length=0,this.destroyed=!0,this.dispatchLocalEvent({type:"destroyed"})}addEventListener(t,e){this.localEventService||(this.localEventService=new Cw),this.localEventService.addEventListener(t,e)}removeEventListener(t,e){this.localEventService&&this.localEventService.removeEventListener(t,e)}dispatchLocalEvent(t){this.localEventService&&this.localEventService.dispatchEvent(t)}addManagedElementListeners(t,e){return this._setupListeners(t,e)}addManagedEventListeners(t){return this._setupListeners(this.eventService,t)}addManagedListeners(t,e){return this._setupListeners(t,e)}_setupListeners(t,e){const n=[];for(const i in e){const r=e[i];r&&n.push(this._setupListener(t,i,r))}return n}_setupListener(t,e,n){if(this.destroyed)return()=>null;t instanceof HTMLElement?fce(this.getFrameworkOverrides(),t,e,n):t.addEventListener(e,n);const i=()=>(t.removeEventListener(e,n),null);return this.destroyFunctions.push(i),()=>(i(),this.destroyFunctions=this.destroyFunctions.filter(r=>r!==i),null)}setupGridOptionListener(t,e){this.gos.addPropertyEventListener(t,e);const n=()=>(this.gos.removePropertyEventListener(t,e),null);return this.destroyFunctions.push(n),()=>(n(),this.destroyFunctions=this.destroyFunctions.filter(i=>i!==n),null)}addManagedPropertyListener(t,e){return this.destroyed?()=>null:this.setupGridOptionListener(t,e)}addManagedPropertyListeners(t,e){if(this.destroyed)return;const n=t.join("-")+this.propertyListenerId++,i=r=>{if(r.changeSet){if(r.changeSet&&r.changeSet.id===this.lastChangeSetIdLookup[n])return;this.lastChangeSetIdLookup[n]=r.changeSet.id}const o={type:"gridPropertyChanged",changeSet:r.changeSet,source:r.source};e(o)};t.forEach(r=>this.setupGridOptionListener(r,i))}addDestroyFunc(t){this.isAlive()?this.destroyFunctions.push(t):t()}createManagedBean(t,e){const n=this.createBean(t,e);return this.addDestroyFunc(this.destroyBean.bind(this,t,e)),n}createBean(t,e,n){return(e||this.stubContext).createBean(t,n)}destroyBean(t,e){return(e||this.stubContext).destroyBean(t)}destroyBeans(t,e){return(e||this.stubContext).destroyBeans(t)}},f3=class{constructor(t){this.frameworkOverrides=t,this.wrappedListeners=new Map,this.wrappedGlobalListeners=new Map}wrap(t){let e=t;return this.frameworkOverrides.shouldWrapOutgoing&&(e=n=>{this.frameworkOverrides.wrapOutgoing(()=>t(n))},this.wrappedListeners.set(t,e)),e}wrapGlobal(t){let e=t;return this.frameworkOverrides.shouldWrapOutgoing&&(e=(n,i)=>{this.frameworkOverrides.wrapOutgoing(()=>t(n,i))},this.wrappedGlobalListeners.set(t,e)),e}unwrap(t){return this.wrappedListeners.get(t)??t}unwrapGlobal(t){return this.wrappedGlobalListeners.get(t)??t}};function n_(t){return t==null||t===""?null:t}function $n(t,e=!1){return t!=null&&(t!==""||e)}function Hr(t){return!$n(t)}function Va(t){return t==null||t.length===0}function yL(t){return t!=null&&typeof t.toString=="function"?t.toString():null}function i_(t){if(t===void 0)return;if(t===null||t==="")return null;if(typeof t=="number")return isNaN(t)?void 0:t;const e=parseInt(t,10);return isNaN(e)?void 0:e}function _L(t){if(t!==void 0)return t===null||t===""?!1:xL(t)}function xL(t){return typeof t=="boolean"?t:typeof t=="string"?t.toUpperCase()==="TRUE"||t=="":!1}function eT(t,e){const n=t?JSON.stringify(t):null,i=e?JSON.stringify(e):null;return n===i}function pce(t,e,n=!1){const i=t==null,r=e==null;if(t&&t.toNumber&&(t=t.toNumber()),e&&e.toNumber&&(e=e.toNumber()),i&&r)return 0;if(i)return-1;if(r)return 1;function o(c,s){return c>s?1:c<s?-1:0}if(typeof t!="string"||!n)return o(t,e);try{return t.localeCompare(e)}catch{return o(t,e)}}function sR(t){if(t instanceof Set||t instanceof Map){const e=[];return t.forEach(n=>e.push(n)),e}return Object.values(t)}var p3=new Set(["__proto__","constructor","prototype"]);function td(t,e){if(t!=null){if(Array.isArray(t)){for(let n=0;n<t.length;n++)e(n.toString(),t[n]);return}for(const[n,i]of Object.entries(t))e(n,i)}}function X$(t){const e={},n=Object.keys(t);for(let i=0;i<n.length;i++){if(p3.has(n[i]))continue;const r=n[i],o=t[r];e[r]=o}return e}function wL(t,e){if(!t)return;const n=t,i={};return Object.keys(n).forEach(r=>{if(e&&e.indexOf(r)>=0||p3.has(r))return;const o=n[r];SL(o)&&o.constructor===Object?i[r]=wL(o):i[r]=o}),i}function CL(t){if(!t)return[];const e=Object;if(typeof e.values=="function")return e.values(t);const n=[];for(const i in t)t.hasOwnProperty(i)&&t.propertyIsEnumerable(i)&&n.push(t[i]);return n}function Xu(t,e,n=!0,i=!1){$n(e)&&td(e,(r,o)=>{if(p3.has(r))return;let c=t[r];c!==o&&(i&&c==null&&o!=null&&typeof o=="object"&&o.constructor===Object&&(c={},t[r]=c),SL(o)&&SL(c)&&!Array.isArray(c)?Xu(c,o,n,i):(n||o!==void 0)&&(t[r]=o))})}function w1(t,e,n){if(!e||!t)return;if(!n)return t[e];const i=e.split(".");let r=t;for(let o=0;o<i.length;o++){if(r==null)return;r=r[i[o]]}return r}function SL(t){return typeof t=="object"&&t!==null}var mce={resizable:!0,sortable:!0},gce=0;function K$(){return gce++}function av(t){return t instanceof J$}var Y$=20,J$=class extends wn{constructor(t,e,n,i){super(),this.isColumn=!0,this.instanceId=K$(),this.autoHeaderHeight=null,this.moving=!1,this.menuVisible=!1,this.lastLeftPinned=!1,this.firstRightPinned=!1,this.filterActive=!1,this.columnEventService=new Cw,this.tooltipEnabled=!1,this.rowGroupActive=!1,this.pivotActive=!1,this.aggregationActive=!1,this.colDef=t,this.userProvidedColDef=e,this.colId=n,this.primary=i,this.setState(t)}wireBeans(t){this.columnHoverService=t.columnHoverService}getInstanceId(){return this.instanceId}setState(t){t.sort!==void 0?(t.sort==="asc"||t.sort==="desc")&&(this.sort=t.sort):(t.initialSort==="asc"||t.initialSort==="desc")&&(this.sort=t.initialSort);const e=t.sortIndex,n=t.initialSortIndex;e!==void 0?e!==null&&(this.sortIndex=e):n!==null&&(this.sortIndex=n);const i=t.hide,r=t.initialHide;i!==void 0?this.visible=!i:this.visible=!r,t.pinned!==void 0?this.setPinned(t.pinned):this.setPinned(t.initialPinned);const o=t.flex,c=t.initialFlex;o!==void 0?this.flex=o:c!==void 0&&(this.flex=c)}setColDef(t,e,n){this.colDef=t,this.userProvidedColDef=e,this.initMinAndMaxWidths(),this.initDotNotation(),this.initTooltip(),this.columnEventService.dispatchEvent(this.createColumnEvent("colDefChanged",n))}getUserProvidedColDef(){return this.userProvidedColDef}setParent(t){this.parent=t}getParent(){return this.parent}setOriginalParent(t){this.originalParent=t}getOriginalParent(){return this.originalParent}postConstruct(){this.initMinAndMaxWidths(),this.resetActualWidth("gridInitializing"),this.initDotNotation(),this.initTooltip()}initDotNotation(){const t=this.gos.get("suppressFieldDotNotation");this.fieldContainsDots=$n(this.colDef.field)&&this.colDef.field.indexOf(".")>=0&&!t,this.tooltipFieldContainsDots=$n(this.colDef.tooltipField)&&this.colDef.tooltipField.indexOf(".")>=0&&!t}initMinAndMaxWidths(){const t=this.colDef;this.minWidth=t.minWidth??Y$,this.maxWidth=t.maxWidth??Number.MAX_SAFE_INTEGER}initTooltip(){this.tooltipEnabled=$n(this.colDef.tooltipField)||$n(this.colDef.tooltipValueGetter)||$n(this.colDef.tooltipComponent)}resetActualWidth(t){const e=this.calculateColInitialWidth(this.colDef);this.setActualWidth(e,t,!0)}calculateColInitialWidth(t){let e;const n=i_(t.width),i=i_(t.initialWidth);return n!=null?e=n:i!=null?e=i:e=200,Math.max(Math.min(e,this.maxWidth),this.minWidth)}isEmptyGroup(){return!1}isRowGroupDisplayed(t){if(Hr(this.colDef)||Hr(this.colDef.showRowGroup))return!1;const e=this.colDef.showRowGroup===!0,n=this.colDef.showRowGroup===t;return e||n}isPrimary(){return this.primary}isFilterAllowed(){return!!this.colDef.filter}isFieldContainsDots(){return this.fieldContainsDots}isTooltipEnabled(){return this.tooltipEnabled}isTooltipFieldContainsDots(){return this.tooltipFieldContainsDots}addEventListener(t,e){var i;this.frameworkOverrides.shouldWrapOutgoing&&!this.frameworkEventListenerService&&(this.columnEventService.setFrameworkOverrides(this.frameworkOverrides),this.frameworkEventListenerService=new f3(this.frameworkOverrides));const n=((i=this.frameworkEventListenerService)==null?void 0:i.wrap(e))??e;this.columnEventService.addEventListener(t,n)}removeEventListener(t,e){var i;const n=((i=this.frameworkEventListenerService)==null?void 0:i.unwrap(e))??e;this.columnEventService.removeEventListener(t,n)}createColumnFunctionCallbackParams(t){return this.gos.addGridCommonParams({node:t,data:t.data,column:this,colDef:this.colDef})}isSuppressNavigable(t){if(typeof this.colDef.suppressNavigable=="boolean")return this.colDef.suppressNavigable;if(typeof this.colDef.suppressNavigable=="function"){const e=this.createColumnFunctionCallbackParams(t),n=this.colDef.suppressNavigable;return n(e)}return!1}isCellEditable(t){return t.group&&!this.gos.get("enableGroupEdit")?!1:this.isColumnFunc(t,this.colDef.editable)}isSuppressFillHandle(){return!!this.colDef.suppressFillHandle}isAutoHeight(){return!!this.colDef.autoHeight}isAutoHeaderHeight(){return!!this.colDef.autoHeaderHeight}isRowDrag(t){return this.isColumnFunc(t,this.colDef.rowDrag)}isDndSource(t){return this.isColumnFunc(t,this.colDef.dndSource)}isCellCheckboxSelection(t){return this.isColumnFunc(t,this.colDef.checkboxSelection)}isSuppressPaste(t){return this.isColumnFunc(t,this.colDef?this.colDef.suppressPaste:null)}isResizable(){return!!this.getColDefValue("resizable")}getColDefValue(t){return this.colDef[t]??mce[t]}isColumnFunc(t,e){if(typeof e=="boolean")return e;if(typeof e=="function"){const n=this.createColumnFunctionCallbackParams(t);return e(n)}return!1}setMoving(t,e){this.moving=t,this.columnEventService.dispatchEvent(this.createColumnEvent("movingChanged",e))}createColumnEvent(t,e){return this.gos.addGridCommonParams({type:t,column:this,columns:[this],source:e})}isMoving(){return this.moving}getSort(){return this.sort}setSort(t,e){this.sort!==t&&(this.sort=t,this.columnEventService.dispatchEvent(this.createColumnEvent("sortChanged",e))),this.dispatchStateUpdatedEvent("sort")}isSortable(){return!!this.getColDefValue("sortable")}isSortAscending(){return this.sort==="asc"}isSortDescending(){return this.sort==="desc"}isSortNone(){return Hr(this.sort)}isSorting(){return $n(this.sort)}getSortIndex(){return this.sortIndex}setSortIndex(t){this.sortIndex=t,this.dispatchStateUpdatedEvent("sortIndex")}setMenuVisible(t,e){this.menuVisible!==t&&(this.menuVisible=t,this.columnEventService.dispatchEvent(this.createColumnEvent("menuVisibleChanged",e)))}isMenuVisible(){return this.menuVisible}setAggFunc(t){this.aggFunc=t,this.dispatchStateUpdatedEvent("aggFunc")}getAggFunc(){return this.aggFunc}getLeft(){return this.left}getOldLeft(){return this.oldLeft}getRight(){return this.left+this.actualWidth}setLeft(t,e){this.oldLeft=this.left,this.left!==t&&(this.left=t,this.columnEventService.dispatchEvent(this.createColumnEvent("leftChanged",e)))}isFilterActive(){return this.filterActive}setFilterActive(t,e,n){this.filterActive!==t&&(this.filterActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("filterActiveChanged",e)));const i=this.createColumnEvent("filterChanged",e);n&&Xu(i,n),this.columnEventService.dispatchEvent(i)}isHovered(){return this.columnHoverService.isHovered(this)}setPinned(t){t===!0||t==="left"?this.pinned="left":t==="right"?this.pinned="right":this.pinned=null,this.dispatchStateUpdatedEvent("pinned")}setFirstRightPinned(t,e){this.firstRightPinned!==t&&(this.firstRightPinned=t,this.columnEventService.dispatchEvent(this.createColumnEvent("firstRightPinnedChanged",e)))}setLastLeftPinned(t,e){this.lastLeftPinned!==t&&(this.lastLeftPinned=t,this.columnEventService.dispatchEvent(this.createColumnEvent("lastLeftPinnedChanged",e)))}isFirstRightPinned(){return this.firstRightPinned}isLastLeftPinned(){return this.lastLeftPinned}isPinned(){return this.pinned==="left"||this.pinned==="right"}isPinnedLeft(){return this.pinned==="left"}isPinnedRight(){return this.pinned==="right"}getPinned(){return this.pinned}setVisible(t,e){const n=t===!0;this.visible!==n&&(this.visible=n,this.columnEventService.dispatchEvent(this.createColumnEvent("visibleChanged",e))),this.dispatchStateUpdatedEvent("hide")}isVisible(){return this.visible}isSpanHeaderHeight(){const t=this.getColDef();return!t.suppressSpanHeaderHeight&&!t.autoHeaderHeight}getColumnGroupPaddingInfo(){let t=this.getParent();if(!t||!t.isPadding())return{numberOfParents:0,isSpanningTotal:!1};const e=t.getPaddingLevel()+1;let n=!0;for(;t;){if(!t.isPadding()){n=!1;break}t=t.getParent()}return{numberOfParents:e,isSpanningTotal:n}}getColDef(){return this.colDef}getDefinition(){return this.colDef}getColumnGroupShow(){return this.colDef.columnGroupShow}getColId(){return this.colId}getId(){return this.colId}getUniqueId(){return this.colId}getActualWidth(){return this.actualWidth}getAutoHeaderHeight(){return this.autoHeaderHeight}setAutoHeaderHeight(t){const e=t!==this.autoHeaderHeight;return this.autoHeaderHeight=t,e}createBaseColDefParams(t){return this.gos.addGridCommonParams({node:t,data:t.data,colDef:this.colDef,column:this})}getColSpan(t){if(Hr(this.colDef.colSpan))return 1;const e=this.createBaseColDefParams(t),n=this.colDef.colSpan(e);return Math.max(n,1)}getRowSpan(t){if(Hr(this.colDef.rowSpan))return 1;const e=this.createBaseColDefParams(t),n=this.colDef.rowSpan(e);return Math.max(n,1)}setActualWidth(t,e,n=!1){t=Math.max(t,this.minWidth),t=Math.min(t,this.maxWidth),this.actualWidth!==t&&(this.actualWidth=t,this.flex&&e!=="flex"&&e!=="gridInitializing"&&(this.flex=null),n||this.fireColumnWidthChangedEvent(e)),this.dispatchStateUpdatedEvent("width")}fireColumnWidthChangedEvent(t){this.columnEventService.dispatchEvent(this.createColumnEvent("widthChanged",t))}isGreaterThanMax(t){return t>this.maxWidth}getMinWidth(){return this.minWidth}getMaxWidth(){return this.maxWidth}getFlex(){return this.flex||0}setFlex(t){this.flex!==t&&(this.flex=t),this.dispatchStateUpdatedEvent("flex")}setMinimum(t){this.setActualWidth(this.minWidth,t)}setRowGroupActive(t,e){this.rowGroupActive!==t&&(this.rowGroupActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnRowGroupChanged",e))),this.dispatchStateUpdatedEvent("rowGroup")}isRowGroupActive(){return this.rowGroupActive}setPivotActive(t,e){this.pivotActive!==t&&(this.pivotActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnPivotChanged",e))),this.dispatchStateUpdatedEvent("pivot")}isPivotActive(){return this.pivotActive}isAnyFunctionActive(){return this.isPivotActive()||this.isRowGroupActive()||this.isValueActive()}isAnyFunctionAllowed(){return this.isAllowPivot()||this.isAllowRowGroup()||this.isAllowValue()}setValueActive(t,e){this.aggregationActive!==t&&(this.aggregationActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnValueChanged",e)))}isValueActive(){return this.aggregationActive}isAllowPivot(){return this.colDef.enablePivot===!0}isAllowValue(){return this.colDef.enableValue===!0}isAllowRowGroup(){return this.colDef.enableRowGroup===!0}dispatchStateUpdatedEvent(t){this.columnEventService.dispatchEvent({type:"columnStateUpdated",key:t})}};function ql(t){return t instanceof oR}var oR=class extends wn{constructor(t,e,n,i){super(),this.isColumn=!1,this.expandable=!1,this.instanceId=K$(),this.expandableListenerRemoveCallback=null,this.colGroupDef=t,this.groupId=e,this.expanded=!!t&&!!t.openByDefault,this.padding=n,this.level=i}destroy(){this.expandableListenerRemoveCallback&&this.reset(null,void 0),super.destroy()}reset(t,e){this.colGroupDef=t,this.level=e,this.originalParent=null,this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback(),this.children=void 0,this.expandable=void 0}getInstanceId(){return this.instanceId}setOriginalParent(t){this.originalParent=t}getOriginalParent(){return this.originalParent}getLevel(){return this.level}isVisible(){return this.children?this.children.some(t=>t.isVisible()):!1}isPadding(){return this.padding}setExpanded(t){this.expanded=t===void 0?!1:t,this.dispatchLocalEvent({type:"expandedChanged"})}isExpandable(){return this.expandable}isExpanded(){return this.expanded}getGroupId(){return this.groupId}getId(){return this.getGroupId()}setChildren(t){this.children=t}getChildren(){return this.children}getColGroupDef(){return this.colGroupDef}getLeafColumns(){const t=[];return this.addLeafColumns(t),t}addLeafColumns(t){this.children&&this.children.forEach(e=>{av(e)?t.push(e):ql(e)&&e.addLeafColumns(t)})}getColumnGroupShow(){const t=this.colGroupDef;if(t)return t.columnGroupShow}setupExpandable(){this.setExpandable(),this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback();const t=this.onColumnVisibilityChanged.bind(this);this.getLeafColumns().forEach(e=>e.addEventListener("visibleChanged",t)),this.expandableListenerRemoveCallback=()=>{this.getLeafColumns().forEach(e=>e.removeEventListener("visibleChanged",t)),this.expandableListenerRemoveCallback=null}}setExpandable(){if(this.isPadding())return;let t=!1,e=!1,n=!1;const i=this.findChildrenRemovingPadding();for(let o=0,c=i.length;o<c;o++){const s=i[o];if(!s.isVisible())continue;const f=s.getColumnGroupShow();f==="open"?(t=!0,n=!0):f==="closed"?(e=!0,n=!0):(t=!0,e=!0)}const r=t&&e&&n;this.expandable!==r&&(this.expandable=r,this.dispatchLocalEvent({type:"expandableChanged"}))}findChildrenRemovingPadding(){const t=[],e=n=>{n.forEach(i=>{ql(i)&&i.isPadding()?e(i.children):t.push(i)})};return e(this.children),t}onColumnVisibilityChanged(){this.setExpandable()}},vce={numericColumn:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"},rightAligned:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"}},z5={};function m3(t,e){z5[e]||(t(),z5[e]=!0)}function nd(t,...e){console.log("AG Grid: "+t,...e)}function Tn(t,...e){m3(()=>console.warn("AG Grid: "+t,...e),t+(e==null?void 0:e.join("")))}function _s(t,...e){m3(()=>console.error("AG Grid: "+t,...e),t+(e==null?void 0:e.join("")))}function g3(t){return!!(t&&t.constructor&&t.call&&t.apply)}function yce(t){_ce(t,400)}var vD=[],yD=!1;function U5(t){vD.push(t),!yD&&(yD=!0,window.setTimeout(()=>{const e=vD.slice();vD.length=0,yD=!1,e.forEach(n=>n())},0))}function _ce(t,e=0){t.length>0&&window.setTimeout(()=>t.forEach(n=>n()),e)}function Kl(t,e){let n;return function(...i){const r=this;window.clearTimeout(n),n=window.setTimeout(function(){t.apply(r,i)},e)}}function V5(t,e){let n=0;return function(...i){const r=this,o=new Date().getTime();o-n<e||(n=o,t.apply(r,i))}}function xce(t,e,n=100,i){const r=new Date().getTime();let o=null,c=!1;const s=()=>{const f=new Date().getTime()-r>n;(t()||f)&&(e(),c=!0,o!=null&&(window.clearInterval(o),o=null),f&&i&&Tn(i))};s(),c||(o=window.setInterval(s,10))}function wce(...t){return e=>t.reduce((n,i)=>i(n),e)}var Cce=class{constructor(){this.existingKeys={}}addExistingKeys(t){for(let e=0;e<t.length;e++)this.existingKeys[t[e]]=!0}getUniqueKey(t,e){t=yL(t);let n=0;for(;;){let i;if(t?(i=t,n!==0&&(i+="_"+n)):e?(i=e,n!==0&&(i+="_"+n)):i=n,!this.existingKeys[i])return this.existingKeys[i]=!0,String(i);n++}}},zS="ag-Grid-AutoColumn";function v3(t){const e=[],n=i=>{for(let r=0;r<i.length;r++){const o=i[r];av(o)?e.push(o):ql(o)&&n(o.getChildren())}};return n(t),e}function Dp(t){return t.reduce((e,n)=>e+n.getActualWidth(),0)}function dx(t,e,n){const i={};if(!e)return;Jp(null,e,o=>{i[o.getInstanceId()]=o}),n&&Jp(null,n,o=>{i[o.getInstanceId()]=null});const r=Object.values(i).filter(o=>o!=null);t.destroyBeans(r)}function G5(t){return t.getId().startsWith(zS)}function aR(t){let e=[];return t instanceof Array?t.some(i=>typeof i!="string")?Tn("if colDef.type is supplied an array it should be of type 'string[]'"):e=t:typeof t=="string"?e=t.split(","):Tn("colDef.type should be of type 'string' | 'string[]'"),e}var Sce=class extends wn{constructor(){super(...arguments),this.beanName="columnFactory"}wireBeans(t){this.dataTypeService=t.dataTypeService}createColumnTree(t,e,n,i){const r=new Cce,{existingCols:o,existingGroups:c,existingColKeys:s}=this.extractExistingTreeData(n);r.addExistingKeys(s);const f=this.recursivelyCreateColumns(t,0,e,o,r,c,i),v=this.findMaxDept(f,0),w=this.balanceColumnTree(f,0,v,r);return Jp(null,w,(M,F)=>{ql(M)&&M.setupExpandable(),M.setOriginalParent(F)}),{columnTree:w,treeDept:v}}extractExistingTreeData(t){const e=[],n=[],i=[];return t&&Jp(null,t,r=>{if(ql(r)){const o=r;n.push(o)}else{const o=r;i.push(o.getId()),e.push(o)}}),{existingCols:e,existingGroups:n,existingColKeys:i}}createForAutoGroups(t,e){const n=[],i=this.findDepth(e);return t.forEach(r=>{let o=r;for(let c=i-1;c>=0;c--){const s=new oR(null,`FAKE_PATH_${r.getId()}}_${c}`,!0,c);this.createBean(s),s.setChildren([o]),o.setOriginalParent(s),o=s}i===0&&r.setOriginalParent(null),n.push(o)}),[n,i]}findDepth(t){let e=0,n=t;for(;n&&n[0]&&ql(n[0]);)e++,n=n[0].getChildren();return e}balanceColumnTree(t,e,n,i){const r=[];for(let o=0;o<t.length;o++){const c=t[o];if(ql(c)){const s=c,f=this.balanceColumnTree(s.getChildren(),e+1,n,i);s.setChildren(f),r.push(s)}else{let s,f;for(let v=n-1;v>=e;v--){const w=i.getUniqueKey(null,null),C=this.createMergedColGroupDef(null),M=new oR(C,w,!0,e);this.createBean(M),f&&f.setChildren([M]),f=M,s||(s=f)}if(s&&f)if(r.push(s),t.some(w=>ql(w))){f.setChildren([c]);continue}else{f.setChildren(t);break}r.push(c)}}return r}findMaxDept(t,e){let n=e;for(let i=0;i<t.length;i++){const r=t[i];if(ql(r)){const o=r,c=this.findMaxDept(o.getChildren(),e+1);n<c&&(n=c)}}return n}recursivelyCreateColumns(t,e,n,i,r,o,c){if(!t)return[];const s=new Array(t.length);for(let f=0;f<s.length;f++){const v=t[f];this.isColumnGroup(v)?s[f]=this.createColumnGroup(n,v,e,i,r,o,c):s[f]=this.createColumn(n,v,i,r,c)}return s}createColumnGroup(t,e,n,i,r,o,c){const s=this.createMergedColGroupDef(e),f=r.getUniqueKey(s.groupId||null,null),v=new oR(s,f,!1,n);this.createBean(v);const w=this.findExistingGroup(e,o);w&&o.splice(w.idx,1);const C=w==null?void 0:w.group;C&&v.setExpanded(C.isExpanded());const M=this.recursivelyCreateColumns(s.children,n+1,t,i,r,o,c);return v.setChildren(M),v}createMergedColGroupDef(t){const e={};return Object.assign(e,this.gos.get("defaultColGroupDef")),Object.assign(e,t),e}createColumn(t,e,n,i,r){var s;const o=this.findExistingColumn(e,n);o&&(n==null||n.splice(o.idx,1));let c=o==null?void 0:o.column;if(c){const f=this.addColumnDefaultAndTypes(e,c.getColId());c.setColDef(f,e,r),this.applyColumnState(c,f,r)}else{const f=i.getUniqueKey(e.colId,e.field),v=this.addColumnDefaultAndTypes(e,f);c=new J$(v,e,f,t),this.createBean(c)}return(s=this.dataTypeService)==null||s.addColumnListeners(c),c}applyColumnState(t,e,n){const i=i_(e.flex);if(i!==void 0&&t.setFlex(i),t.getFlex()<=0){const s=i_(e.width);if(s!=null)t.setActualWidth(s,n);else{const f=t.getActualWidth();t.setActualWidth(f,n)}}e.sort!==void 0&&(e.sort=="asc"||e.sort=="desc"?t.setSort(e.sort,n):t.setSort(void 0,n));const o=i_(e.sortIndex);o!==void 0&&t.setSortIndex(o);const c=_L(e.hide);c!==void 0&&t.setVisible(!c,n),e.pinned!==void 0&&t.setPinned(e.pinned)}findExistingColumn(t,e){if(e)for(let n=0;n<e.length;n++){const i=e[n].getUserProvidedColDef();if(!i)continue;if(t.colId!=null){if(e[n].getId()===t.colId)return{idx:n,column:e[n]};continue}if(t.field!=null){if(i.field===t.field)return{idx:n,column:e[n]};continue}if(i===t)return{idx:n,column:e[n]}}}findExistingGroup(t,e){if(t.groupId!=null)for(let i=0;i<e.length;i++){const r=e[i];if(r.getColGroupDef()&&r.getId()===t.groupId)return{idx:i,group:r}}}addColumnDefaultAndTypes(t,e){var s;const n={},i=this.gos.get("defaultColDef");Xu(n,i,!1,!0);const r=this.updateColDefAndGetColumnType(n,t,e);r&&this.assignColumnTypes(r,n),Xu(n,t,!1,!0);const o=this.gos.get("autoGroupColumnDef"),c=this.gos.isColumnsSortingCoupledToGroup();return t.rowGroup&&o&&c&&Xu(n,{sort:o.sort,initialSort:o.initialSort},!1,!0),(s=this.dataTypeService)==null||s.validateColDef(n),n}updateColDefAndGetColumnType(t,e,n){var o;const i=(o=this.dataTypeService)==null?void 0:o.updateColDefAndGetColumnType(t,e,n),r=e.type??i??t.type;return t.type=r,r?aR(r):void 0}assignColumnTypes(t,e){if(!t.length)return;const n=Object.assign({},vce),i=this.gos.get("columnTypes")||{};td(i,(r,o)=>{r in n?Tn(`the column type '${r}' is a default column type and cannot be overridden.`):(o.type&&Tn("Column type definitions 'columnTypes' with a 'type' attribute are not supported because a column type cannot refer to another column type. Only column definitions 'columnDefs' can use the 'type' attribute to refer to a column type."),n[r]=o)}),t.forEach(r=>{const o=n[r.trim()];o?Xu(e,o,!1,!0):Tn("colDef.type '"+r+"' does not correspond to defined gridOptions.columnTypes")})}isColumnGroup(t){return t.children!==void 0}};function Jp(t,e,n){if(e)for(let i=0;i<e.length;i++){const r=e[i];ql(r)&&Jp(r,r.getChildren(),n),n(r,t)}}var bce=class extends wn{constructor(){super(...arguments),this.beanName="columnModel",this.pivotMode=!1,this.autoHeightActiveAtLeastOnce=!1,this.ready=!1,this.changeEventsDispatching=!1,this.shouldQueueResizeOperations=!1,this.resizeOperationQueue=[]}wireBeans(t){this.context=t.context,this.columnFactory=t.columnFactory,this.columnSizeService=t.columnSizeService,this.visibleColsService=t.visibleColsService,this.columnViewportService=t.columnViewportService,this.pivotResultColsService=t.pivotResultColsService,this.columnAnimationService=t.columnAnimationService,this.autoColService=t.autoColService,this.valueCache=t.valueCache,this.columnDefFactory=t.columnDefFactory,this.columnApplyStateService=t.columnApplyStateService,this.columnGroupStateService=t.columnGroupStateService,this.eventDispatcher=t.columnEventDispatcher,this.columnMoveService=t.columnMoveService,this.columnAutosizeService=t.columnAutosizeService,this.funcColsService=t.funcColsService,this.quickFilterService=t.quickFilterService,this.showRowGroupColsService=t.showRowGroupColsService,this.environment=t.environment}postConstruct(){const t=this.gos.get("pivotMode");this.isPivotSettingAllowed(t)&&(this.pivotMode=t),this.addManagedPropertyListeners(["groupDisplayType","treeData","treeDataDisplayType","groupHideOpenParents"],e=>this.refreshAll(fx(e.source))),this.addManagedPropertyListener("autoGroupColumnDef",e=>this.onAutoGroupColumnDefChanged(fx(e.source))),this.addManagedPropertyListeners(["defaultColDef","columnTypes","suppressFieldDotNotation"],e=>this.recreateColumnDefs(fx(e.source))),this.addManagedPropertyListener("pivotMode",e=>this.setPivotMode(this.gos.get("pivotMode"),fx(e.source))),this.addManagedEventListeners({firstDataRendered:()=>this.onFirstDataRendered()})}createColsFromColDefs(t,e){var C;const n=t?this.columnApplyStateService.compareColumnStatesAndDispatchEvents(e):void 0;this.valueCache.expire();const i=this.colDefCols&&this.colDefCols.list,r=this.colDefCols&&this.colDefCols.tree,o=this.columnFactory.createColumnTree(this.colDefs,!0,r,e);dx(this.context,(C=this.colDefCols)==null?void 0:C.tree,o.columnTree);const c=o.columnTree,s=o.treeDept,f=v3(c),v={};f.forEach(M=>v[M.getId()]=M),this.colDefCols={tree:c,treeDepth:s,list:f,map:v},this.funcColsService.extractCols(e,i),this.ready=!0,this.refreshCols(),t&&!this.showingPivotResult&&!this.gos.get("maintainColumnOrder")&&this.orderColsLikeColDefCols(),this.visibleColsService.refresh(e),this.columnViewportService.checkViewportColumns(),this.eventDispatcher.everythingChanged(e),n&&(this.changeEventsDispatching=!0,n(),this.changeEventsDispatching=!1),this.eventDispatcher.newColumnsLoaded(e),e==="gridInitializing"&&this.columnSizeService.applyAutosizeStrategy()}refreshCols(){var n,i,r;if(!this.colDefCols)return;const t=(n=this.cols)==null?void 0:n.tree;this.saveColOrder(),this.selectCols(),this.createAutoCols(),this.addAutoCols(),this.restoreColOrder(),this.positionLockedCols(),(i=this.showRowGroupColsService)==null||i.refresh(),(r=this.quickFilterService)==null||r.refreshQuickFilterCols(),this.setColSpanActive(),this.setAutoHeightActive(),this.visibleColsService.clear(),this.columnViewportService.clear(),!k_(t,this.cols.tree)&&this.eventDispatcher.gridColumns()}selectCols(){const t=this.pivotResultColsService.getPivotResultCols();if(this.showingPivotResult=t!=null,t){const{map:e,list:n,tree:i,treeDepth:r}=t;this.cols={list:n.slice(),map:{...e},tree:i.slice(),treeDepth:r},t.list.some(c=>{var s;return((s=this.cols)==null?void 0:s.map[c.getColId()])!==void 0})||(this.lastPivotOrder=null)}else{const{map:e,list:n,tree:i,treeDepth:r}=this.colDefCols;this.cols={list:n.slice(),map:{...e},tree:i.slice(),treeDepth:r}}}getColsToShow(){const t=this.isPivotMode()&&!this.isShowingPivotResult(),e=this.funcColsService.getValueColumns();return this.cols.list.filter(i=>{const r=G5(i);if(t){const o=e&&t_(e,i);return r||o}else return r||i.isVisible()})}addAutoCols(){this.autoCols!=null&&(this.cols.list=this.autoCols.list.concat(this.cols.list),this.cols.tree=this.autoCols.tree.concat(this.cols.tree),Ece(this.cols))}createAutoCols(){var N,z;const t=this.gos.isGroupUseEntireRow(this.pivotMode),e=this.pivotMode?this.gos.get("pivotSuppressAutoColumn"):this.isSuppressAutoCol(),n=this.funcColsService.getRowGroupColumns(),r=!(n.length>0||this.gos.get("treeData"))||e||t,o=()=>{this.autoCols&&(dx(this.context,this.autoCols.tree),this.autoCols=null)};if(r||!this.autoColService){o();return}const c=this.autoColService.createAutoCols(n)??[],s=Mce(c,((N=this.autoCols)==null?void 0:N.list)||null),f=this.cols.treeDepth,w=(this.autoCols?this.autoCols.treeDepth:-1)==f;if(s&&w)return;o();const[C,M]=this.columnFactory.createForAutoGroups(c,(z=this.cols)==null?void 0:z.tree);this.autoCols={list:c,tree:C,treeDepth:M,map:{}};const F=L=>{if(!L)return null;const P=L.filter(H=>!G5(H));return[...c,...P]};this.lastOrder=F(this.lastOrder),this.lastPivotOrder=F(this.lastPivotOrder)}refreshAll(t){this.isReady()&&(this.refreshCols(),this.visibleColsService.refresh(t))}setColsVisible(t,e=!1,n){this.columnApplyStateService.applyColumnState({state:t.map(i=>({colId:typeof i=="string"?i:i.getColId(),hide:!e}))},n)}setColsPinned(t,e,n){if(!this.cols||Va(t))return;if(this.gos.isDomLayout("print")){Tn("Changing the column pinning status is not allowed with domLayout='print'");return}this.columnAnimationService.start();let i;e===!0||e==="left"?i="left":e==="right"?i="right":i=null;const r=[];t.forEach(o=>{if(!o)return;const c=this.getCol(o);c&&c.getPinned()!==i&&(c.setPinned(i),r.push(c))}),r.length&&(this.visibleColsService.refresh(n),this.eventDispatcher.columnPinned(r,n)),this.columnAnimationService.finish()}setColumnGroupOpened(t,e,n){let i;ql(t)?i=t.getId():i=t||"",this.columnGroupStateService.setColumnGroupState([{groupId:i,open:e}],n)}getProvidedColGroup(t){var n;let e=null;return Jp(null,(n=this.cols)==null?void 0:n.tree,i=>{ql(i)&&i.getId()===t&&(e=i)}),e}isColGroupLocked(t){const e=this.gos.get("groupLockGroupColumns");if(!t.isRowGroupActive()||e===0)return!1;if(e===-1)return!0;const i=this.funcColsService.getRowGroupColumns().findIndex(r=>r.getColId()===t.getColId());return e>i}isSuppressAutoCol(){return this.gos.get("groupDisplayType")==="custom"?!0:this.gos.get("treeDataDisplayType")==="custom"}setAutoHeightActive(){this.autoHeightActive=this.cols.list.some(t=>t.isAutoHeight()),this.autoHeightActive&&(this.autoHeightActiveAtLeastOnce=!0,this.gos.isRowModelType("clientSide")||this.gos.isRowModelType("serverSide")||Tn("autoHeight columns only work with Client Side Row Model and Server Side Row Model."))}restoreColOrder(){const t=this.showingPivotResult?this.lastPivotOrder:this.lastOrder;if(!t)return;const e=new Map(t.map((f,v)=>[f,v]));if(!this.cols.list.some(f=>e.has(f)))return;const i=new Map(this.cols.list.map(f=>[f,!0])),r=t.filter(f=>i.has(f)),o=new Map(r.map(f=>[f,!0])),c=this.cols.list.filter(f=>!o.has(f)),s=r.slice();c.forEach(f=>{let v=f.getOriginalParent();if(!v){s.push(f);return}const w=[];for(;!w.length&&v;)v.getLeafColumns().forEach(N=>{const z=s.indexOf(N)>=0,L=w.indexOf(N)<0;z&&L&&w.push(N)}),v=v.getOriginalParent();if(!w.length){s.push(f);return}const C=w.map(F=>s.indexOf(F)),M=Math.max(...C);QR(s,f,M+1)}),this.cols.list=s}orderColsLikeColDefCols(){if(!this.colDefCols||!this.cols)return;const t=this.colDefCols.list.filter(n=>this.cols.list.indexOf(n)>=0),e=this.cols.list.filter(n=>t.indexOf(n)<0);this.cols.list=[...e,...t],this.cols.list=this.columnMoveService.placeLockedColumns(this.cols.list)}sortColsLikeKeys(t){if(this.cols==null)return;let e=[];const n={};t.forEach(r=>{if(n[r])return;const o=this.cols.map[r];o&&(e.push(o),n[r]=!0)});let i=0;if(this.cols.list.forEach(r=>{const o=r.getColId();if(n[o]!=null)return;o.startsWith(zS)?QR(e,r,i++):e.push(r)}),e=this.columnMoveService.placeLockedColumns(e),!this.columnMoveService.doesMovePassMarryChildren(e)){Tn("Applying column order broke a group where columns should be married together. Applying new order has been discarded.");return}this.cols.list=e}sortColsLikeCols(t){!t||t.length<=1||t.filter(n=>this.cols.list.indexOf(n)<0).length>0||t.sort((n,i)=>{const r=this.cols.list.indexOf(n),o=this.cols.list.indexOf(i);return r-o})}resetColDefIntoCol(t,e){const n=t.getUserProvidedColDef();if(!n)return!1;const i=this.columnFactory.addColumnDefaultAndTypes(n,t.getColId());return t.setColDef(i,n,e),!0}queueResizeOperations(){this.shouldQueueResizeOperations=!0}isShouldQueueResizeOperations(){return this.shouldQueueResizeOperations}processResizeOperations(){this.shouldQueueResizeOperations=!1,this.resizeOperationQueue.forEach(t=>t()),this.resizeOperationQueue=[]}pushResizeOperation(t){this.resizeOperationQueue.push(t)}moveInCols(t,e,n){var i;$$((i=this.cols)==null?void 0:i.list,t,e),this.visibleColsService.refresh(n)}positionLockedCols(){this.cols.list=this.columnMoveService.placeLockedColumns(this.cols.list)}saveColOrder(){var t,e;this.showingPivotResult?this.lastPivotOrder=(t=this.cols)==null?void 0:t.list:this.lastOrder=(e=this.cols)==null?void 0:e.list}getColumnDefs(){if(!this.colDefCols)return;const t=this.colDefCols.list.slice();this.showingPivotResult?t.sort((i,r)=>this.lastOrder.indexOf(i)-this.lastOrder.indexOf(r)):this.lastOrder&&t.sort((i,r)=>this.cols.list.indexOf(i)-this.cols.list.indexOf(r));const e=this.funcColsService.getRowGroupColumns(),n=this.funcColsService.getPivotColumns();return this.columnDefFactory.buildColumnDefs(t,e,n)}isShowingPivotResult(){return this.showingPivotResult}isChangeEventsDispatching(){return this.changeEventsDispatching}isColSpanActive(){return this.colSpanActive}isProvidedColGroupsPresent(){var t;return((t=this.colDefCols)==null?void 0:t.treeDepth)>0}setColSpanActive(){this.colSpanActive=this.cols.list.some(t=>t.getColDef().colSpan!=null)}isAutoRowHeightActive(){return this.autoHeightActive}wasAutoRowHeightEverActive(){return this.autoHeightActiveAtLeastOnce}getHeaderRowCount(){return this.cols?this.cols.treeDepth+1:-1}isReady(){return this.ready}isPivotMode(){return this.pivotMode}setPivotMode(t,e){t===this.pivotMode||!this.isPivotSettingAllowed(this.pivotMode)||(this.pivotMode=t,this.ready&&(this.refreshCols(),this.visibleColsService.refresh(e),this.eventDispatcher.pivotModeChanged()))}isPivotSettingAllowed(t){return t&&this.gos.get("treeData")?(Tn("Pivot mode not available with treeData."),!1):!0}isPivotActive(){const t=this.funcColsService.getPivotColumns();return this.pivotMode&&!Va(t)}recreateColumnDefs(t){this.cols&&(this.autoCols&&this.autoColService.updateAutoCols(this.autoCols.list,t),this.createColsFromColDefs(!0,t))}setColumnDefs(t,e){const n=!!this.colDefs;this.colDefs=t,this.createColsFromColDefs(n,e)}destroy(){var t,e;dx(this.context,(t=this.colDefCols)==null?void 0:t.tree),dx(this.context,(e=this.autoCols)==null?void 0:e.tree),super.destroy()}getColTree(){return this.cols.tree}getColDefColTree(){return this.colDefCols.tree}getColDefCols(){var t;return(t=this.colDefCols)!=null&&t.list?this.colDefCols.list:null}getCols(){var t;return((t=this.cols)==null?void 0:t.list)??[]}getAllCols(){var n,i;const t=this.pivotResultColsService.getPivotResultCols(),e=t==null?void 0:t.list;return[].concat(((n=this.colDefCols)==null?void 0:n.list)||[],((i=this.autoCols)==null?void 0:i.list)||[],e||[])}getColsForKeys(t){return t?t.map(n=>this.getCol(n)).filter(n=>n!=null):[]}getColDefCol(t){var e;return(e=this.colDefCols)!=null&&e.list?this.getColFromCollection(t,this.colDefCols):null}getCol(t){return t==null?null:this.getColFromCollection(t,this.cols)}getColFromCollection(t,e){if(e==null)return null;const{map:n,list:i}=e;if(typeof t=="string"&&n[t])return n[t];for(let r=0;r<i.length;r++)if(H5(i[r],t))return i[r];return this.getAutoCol(t)}getAutoCol(t){return this.autoCols==null?null:this.autoCols.list.find(e=>H5(e,t))||null}getAutoCols(){var t;return((t=this.autoCols)==null?void 0:t.list)||null}setColHeaderHeight(t,e){t.setAutoHeaderHeight(e)&&this.eventDispatcher.headerHeight(t)}getColumnGroupHeaderRowHeight(){return this.isPivotMode()?this.getPivotGroupHeaderHeight():this.getGroupHeaderHeight()}getColumnHeaderRowHeight(){const t=this.isPivotMode()?this.getPivotHeaderHeight():this.getHeaderHeight(),n=this.visibleColsService.getAllCols().filter(i=>i.isAutoHeaderHeight()).map(i=>i.getAutoHeaderHeight()||0);return Math.max(t,...n)}getHeaderHeight(){return this.gos.get("headerHeight")??this.environment.getDefaultHeaderHeight()}getFloatingFiltersHeight(){return this.gos.get("floatingFiltersHeight")??this.getHeaderHeight()}getGroupHeaderHeight(){return this.gos.get("groupHeaderHeight")??this.getHeaderHeight()}getPivotHeaderHeight(){return this.gos.get("pivotHeaderHeight")??this.getHeaderHeight()}getPivotGroupHeaderHeight(){return this.gos.get("pivotGroupHeaderHeight")??this.getGroupHeaderHeight()}onFirstDataRendered(){const t=this.gos.get("autoSizeStrategy");if((t==null?void 0:t.type)!=="fitCellContents")return;const{colIds:e,skipHeader:n}=t;setTimeout(()=>{e?this.columnAutosizeService.autoSizeCols({colKeys:e,skipHeader:n,source:"autosizeColumns"}):this.columnAutosizeService.autoSizeAllColumns("autosizeColumns",n)})}onAutoGroupColumnDefChanged(t){this.autoCols&&this.autoColService.updateAutoCols(this.autoCols.list,t)}};function fx(t){return t==="gridOptionsUpdated"?"gridOptionsChanged":t}function Ece(t){t.map={},t.list.forEach(e=>t.map[e.getId()]=e)}function H5(t,e){const n=t===e,i=t.getColDef()===e,r=t.getColId()==e;return n||i||r}function Mce(t,e){return k_(t,e,(n,i)=>n.getColId()===i.getColId())}var Rce=class extends wn{constructor(){super(...arguments),this.beanName="columnAutosizeService",this.timesDelayed=0}wireBeans(t){this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.animationFrameService=t.animationFrameService,this.autoWidthCalculator=t.autoWidthCalculator,this.eventDispatcher=t.columnEventDispatcher,this.ctrlsService=t.ctrlsService,this.renderStatusService=t.renderStatusService}autoSizeCols(t){if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.autoSizeCols(t));return}const{colKeys:e,skipHeader:n,skipHeaderGroups:i,stopAtGroup:r,source:o="api"}=t;if(this.animationFrameService.flushAllFrames(),this.timesDelayed<5&&this.renderStatusService&&!this.renderStatusService.areHeaderCellsRendered()){this.timesDelayed++,setTimeout(()=>this.autoSizeCols(t));return}this.timesDelayed=0;const c=[];let s=-1;const f=n??this.gos.get("skipHeaderOnAutoSize"),v=i??f;for(;s!==0;){s=0;const w=[];e.forEach(C=>{if(!C)return;const M=this.columnModel.getCol(C);if(!M||c.indexOf(M)>=0)return;const F=this.autoWidthCalculator.getPreferredWidthForColumn(M,f);if(F>0){const N=this.normaliseColumnWidth(M,F);M.setActualWidth(N,o),c.push(M),s++}w.push(M)}),w.length&&this.visibleColsService.refresh(o)}v||this.autoSizeColumnGroupsByColumns(e,o,r),this.eventDispatcher.columnResized(c,!0,"autosizeColumns")}autoSizeColumn(t,e,n){t&&this.autoSizeCols({colKeys:[t],skipHeader:n,skipHeaderGroups:!0,source:e})}autoSizeColumnGroupsByColumns(t,e,n){const i=new Set;this.columnModel.getColsForKeys(t).forEach(s=>{let f=s.getParent();for(;f&&f!=n;)f.isPadding()||i.add(f),f=f.getParent()});let o;const c=[];for(const s of i){for(const f of this.ctrlsService.getHeaderRowContainerCtrls())if(o=f.getHeaderCtrlForColumn(s),o)break;o&&o.resizeLeafColumnsToFit(e)}return c}autoSizeAllColumns(t,e){if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.autoSizeAllColumns(t,e));return}const n=this.visibleColsService.getAllCols();this.autoSizeCols({colKeys:n,skipHeader:e,source:t})}normaliseColumnWidth(t,e){const n=t.getMinWidth();e<n&&(e=n);const i=t.getMaxWidth();return t.isGreaterThanMax(e)&&(e=i),e}},Tce=class extends wn{constructor(){super(...arguments),this.beanName="funcColsService",this.rowGroupCols=[],this.valueCols=[],this.pivotCols=[]}wireBeans(t){this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher,this.aggFuncService=t.aggFuncService,this.visibleColsService=t.visibleColsService}getModifyColumnsNoEventsCallbacks(){return{addGroupCol:t=>this.rowGroupCols.push(t),removeGroupCol:t=>Xl(this.rowGroupCols,t),addPivotCol:t=>this.pivotCols.push(t),removePivotCol:t=>Xl(this.pivotCols,t),addValueCol:t=>this.valueCols.push(t),removeValueCol:t=>Xl(this.valueCols,t)}}getSourceColumnsForGroupColumn(t){const e=t.getColDef().showRowGroup;if(!e)return null;if(e===!0)return this.rowGroupCols.slice(0);const n=this.columnModel.getColDefCol(e);return n?[n]:null}sortRowGroupColumns(t){this.rowGroupCols.sort(t)}sortPivotColumns(t){this.pivotCols.sort(t)}getValueColumns(){return this.valueCols?this.valueCols:[]}getPivotColumns(){return this.pivotCols?this.pivotCols:[]}getRowGroupColumns(){return this.rowGroupCols?this.rowGroupCols:[]}isRowGroupEmpty(){return Va(this.rowGroupCols)}setColumnAggFunc(t,e,n){if(!t)return;const i=this.columnModel.getColDefCol(t);i&&(i.setAggFunc(e),this.eventDispatcher.columnChanged("columnValueChanged",[i],n))}setRowGroupColumns(t,e){this.setColList(t,this.rowGroupCols,"columnRowGroupChanged",!0,!0,(n,i)=>this.setRowGroupActive(n,i,e),e)}setRowGroupActive(t,e,n){t!==e.isRowGroupActive()&&(e.setRowGroupActive(t,n),t&&!this.gos.get("suppressRowGroupHidesColumns")&&this.columnModel.setColsVisible([e],!1,n),!t&&!this.gos.get("suppressMakeColumnVisibleAfterUnGroup")&&this.columnModel.setColsVisible([e],!0,n))}addRowGroupColumns(t,e){this.updateColList(t,this.rowGroupCols,!0,!0,n=>this.setRowGroupActive(!0,n,e),"columnRowGroupChanged",e)}removeRowGroupColumns(t,e){this.updateColList(t,this.rowGroupCols,!1,!0,n=>this.setRowGroupActive(!1,n,e),"columnRowGroupChanged",e)}addPivotColumns(t,e){this.updateColList(t,this.pivotCols,!0,!1,n=>n.setPivotActive(!0,e),"columnPivotChanged",e)}setPivotColumns(t,e){this.setColList(t,this.pivotCols,"columnPivotChanged",!0,!1,(n,i)=>{i.setPivotActive(n,e)},e)}removePivotColumns(t,e){this.updateColList(t,this.pivotCols,!1,!1,n=>n.setPivotActive(!1,e),"columnPivotChanged",e)}setValueColumns(t,e){this.setColList(t,this.valueCols,"columnValueChanged",!1,!1,(n,i)=>this.setValueActive(n,i,e),e)}setValueActive(t,e,n){if(t!==e.isValueActive()&&(e.setValueActive(t,n),t&&!e.getAggFunc()&&this.aggFuncService)){const i=this.aggFuncService.getDefaultAggFunc(e);e.setAggFunc(i)}}addValueColumns(t,e){this.updateColList(t,this.valueCols,!0,!1,n=>this.setValueActive(!0,n,e),"columnValueChanged",e)}removeValueColumns(t,e){this.updateColList(t,this.valueCols,!1,!1,n=>this.setValueActive(!1,n,e),"columnValueChanged",e)}moveRowGroupColumn(t,e,n){if(this.isRowGroupEmpty())return;const i=this.rowGroupCols[t],r=this.rowGroupCols.slice(t,e);this.rowGroupCols.splice(t,1),this.rowGroupCols.splice(e,0,i),this.eventDispatcher.rowGroupChanged(r,n)}setColList(t,e,n,i,r,o,c){const s=this.columnModel.getCols();if(Va(s))return;const f=new Map;e.forEach((w,C)=>f.set(w,C)),e.length=0,$n(t)&&t.forEach(w=>{const C=this.columnModel.getColDefCol(w);C&&e.push(C)}),e.forEach((w,C)=>{const M=f.get(w);if(M===void 0){f.set(w,0);return}i&&M!==C||f.delete(w)}),(this.columnModel.getColDefCols()||[]).forEach(w=>{const C=e.indexOf(w)>=0;o(C,w)}),r&&this.columnModel.refreshCols(),this.visibleColsService.refresh(c),this.eventDispatcher.columnChanged(n,[...f.keys()],c)}updateColList(t,e,n,i,r,o,c){if(!t||Va(t))return;let s=!1;t.forEach(f=>{if(!f)return;const v=this.columnModel.getColDefCol(f);if(v){if(n){if(e.indexOf(v)>=0)return;e.push(v)}else{if(e.indexOf(v)<0)return;Xl(e,v)}r(v),s=!0}}),s&&(i&&this.columnModel.refreshCols(),this.visibleColsService.refresh(c),this.eventDispatcher.genericColumnEvent(o,e,c))}extractCols(t,e){this.extractRowGroupCols(t,e),this.extractPivotCols(t,e),this.extractValueCols(t,e)}extractValueCols(t,e){this.valueCols=this.extractColsCommon(e,this.valueCols,(n,i)=>n.setValueActive(i,t),()=>{},()=>{},n=>{const i=n.aggFunc;if(i===null||i==="")return null;if(i!==void 0)return!!i},n=>n.initialAggFunc!=null&&n.initialAggFunc!=""),this.valueCols.forEach(n=>{const i=n.getColDef();i.aggFunc!=null&&i.aggFunc!=""?n.setAggFunc(i.aggFunc):n.getAggFunc()||n.setAggFunc(i.initialAggFunc)})}extractRowGroupCols(t,e){this.rowGroupCols=this.extractColsCommon(e,this.rowGroupCols,(n,i)=>n.setRowGroupActive(i,t),n=>n.rowGroupIndex,n=>n.initialRowGroupIndex,n=>n.rowGroup,n=>n.initialRowGroup)}extractPivotCols(t,e){this.pivotCols=this.extractColsCommon(e,this.pivotCols,(n,i)=>n.setPivotActive(i,t),n=>n.pivotIndex,n=>n.initialPivotIndex,n=>n.pivot,n=>n.initialPivot)}extractColsCommon(t=[],e=[],n,i,r,o,c){const s=[],f=[];(this.columnModel.getColDefCols()||[]).forEach(M=>{const F=t.indexOf(M)<0,N=M.getColDef(),z=_L(o(N)),L=_L(c(N)),P=i_(i(N)),H=i_(r(N));let j;z!==void 0?j=z:P!==void 0?P===null?j=!1:j=P>=0:F?L!==void 0?j=L:H!==void 0?j=H!=null&&H>=0:j=!1:j=e.indexOf(M)>=0,j&&((F?P!=null||H!=null:P!=null)?s.push(M):f.push(M))});const w=M=>{const F=i(M.getColDef()),N=r(M.getColDef());return F??N};s.sort((M,F)=>{const N=w(M),z=w(F);return N===z?0:N<z?-1:1});const C=[].concat(s);return e.forEach(M=>{f.indexOf(M)>=0&&C.push(M)}),f.forEach(M=>{C.indexOf(M)<0&&C.push(M)}),e.forEach(M=>{C.indexOf(M)<0&&n(M,!1)}),C.forEach(M=>{e.indexOf(M)<0&&n(M,!0)}),C}generateColumnStateForRowGroupAndPivotIndexes(t,e){const n={},i=(r,o,c,s,f,v)=>{const w=this.columnModel.getColDefCols();if(!o.length||!w)return[];const C=Object.keys(r),M=new Set(C),F=new Set(C),N=new Set(o.map(ce=>{const ae=ce.getColId();return F.delete(ae),ae}).concat(C)),z=[],L={};let P=0;for(let ce=0;ce<w.length;ce++){const ae=w[ce].getColId();N.has(ae)&&(z.push(ae),L[ae]=P++)}let H=1e3,j=!1,q=0;const le=ce=>{const ae=L[ce];for(let pe=q;pe<ae;pe++){const fe=z[pe];F.has(fe)&&(r[fe][f]=H++,F.delete(fe))}q=ae};o.forEach(ce=>{const ae=ce.getColId();if(M.has(ae))le(ae),r[ae][f]=H++;else{const pe=ce.getColDef();(pe[f]===null||pe[f]===void 0&&pe[v]==null)&&(j||(pe[c]||pe[c]===void 0&&pe[s]?le(ae):(F.forEach(Ee=>{r[Ee][f]=H+L[Ee]}),H+=z.length,j=!0)),n[ae]||(n[ae]={colId:ae}),n[ae][f]=H++)}})};return i(t,this.rowGroupCols,"rowGroup","initialRowGroup","rowGroupIndex","initialRowGroupIndex"),i(e,this.pivotCols,"pivot","initialPivot","pivotIndex","initialPivotIndex"),Object.values(n)}},Ace=class extends wn{constructor(){super(...arguments),this.beanName="columnApplyStateService"}wireBeans(t){this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher,this.sortController=t.sortController,this.columnGetStateService=t.columnGetStateService,this.funcColsService=t.funcColsService,this.visibleColsService=t.visibleColsService,this.columnAnimationService=t.columnAnimationService,this.pivotResultColsService=t.pivotResultColsService}applyColumnState(t,e){const n=this.columnModel.getColDefCols()||[];if(Va(n))return!1;if(t&&t.state&&!t.state.forEach)return Tn("applyColumnState() - the state attribute should be an array, however an array was not found. Please provide an array of items (one for each col you want to change) for state."),!1;const i=this.funcColsService.getModifyColumnsNoEventsCallbacks(),r=(s,f,v)=>{const w=this.compareColumnStatesAndDispatchEvents(e),C=f.slice(),M={},F={},N=[],z=[];let L=0;const P=this.funcColsService.getRowGroupColumns().slice(),H=this.funcColsService.getPivotColumns().slice();s.forEach(ce=>{const ae=ce.colId||"";if(ae.startsWith(zS)){N.push(ce),z.push(ce);return}const fe=v(ae);fe?(this.syncColumnWithStateItem(fe,ce,t.defaultState,M,F,!1,e,i),Xl(C,fe)):(z.push(ce),L+=1)});const j=ce=>this.syncColumnWithStateItem(ce,null,t.defaultState,M,F,!1,e,i);C.forEach(j),this.funcColsService.sortRowGroupColumns(W5.bind(this,M,P)),this.funcColsService.sortPivotColumns(W5.bind(this,F,H)),this.columnModel.refreshCols();const le=(this.columnModel.getAutoCols()||[]).slice();return N.forEach(ce=>{const ae=this.columnModel.getAutoCol(ce.colId);Xl(le,ae),this.syncColumnWithStateItem(ae,ce,t.defaultState,null,null,!0,e,i)}),le.forEach(j),this.orderLiveColsLikeState(t),this.visibleColsService.refresh(e),this.eventDispatcher.everythingChanged(e),w(),{unmatchedAndAutoStates:z,unmatchedCount:L}};this.columnAnimationService.start();let{unmatchedAndAutoStates:o,unmatchedCount:c}=r(t.state||[],n,s=>this.columnModel.getColDefCol(s));if(o.length>0||$n(t.defaultState)){const s=this.pivotResultColsService.getPivotResultCols(),f=s==null?void 0:s.list;c=r(o,f||[],v=>this.pivotResultColsService.getPivotResultCol(v)).unmatchedCount}return this.columnAnimationService.finish(),c===0}resetColumnState(t){const e=this.columnModel.getColDefCols();if(Va(e))return;const n=this.columnModel.getColDefColTree(),i=v3(n),r=[];let o=1e3,c=1e3,s=[];const f=this.columnModel.getAutoCols();f&&(s=s.concat(f)),i&&(s=s.concat(i)),s.forEach(v=>{const w=this.getColumnStateFromColDef(v);Hr(w.rowGroupIndex)&&w.rowGroup&&(w.rowGroupIndex=o++),Hr(w.pivotIndex)&&w.pivot&&(w.pivotIndex=c++),r.push(w)}),this.applyColumnState({state:r,applyOrder:!0},t)}getColumnStateFromColDef(t){const e=(N,z)=>N??z??null,n=t.getColDef(),i=e(n.sort,n.initialSort),r=e(n.sortIndex,n.initialSortIndex),o=e(n.hide,n.initialHide),c=e(n.pinned,n.initialPinned),s=e(n.width,n.initialWidth),f=e(n.flex,n.initialFlex);let v=e(n.rowGroupIndex,n.initialRowGroupIndex),w=e(n.rowGroup,n.initialRowGroup);v==null&&(w==null||w==!1)&&(v=null,w=null);let C=e(n.pivotIndex,n.initialPivotIndex),M=e(n.pivot,n.initialPivot);C==null&&(M==null||M==!1)&&(C=null,M=null);const F=e(n.aggFunc,n.initialAggFunc);return{colId:t.getColId(),sort:i,sortIndex:r,hide:o,pinned:c,width:s,flex:f,rowGroup:w,rowGroupIndex:v,pivot:M,pivotIndex:C,aggFunc:F}}syncColumnWithStateItem(t,e,n,i,r,o,c,s){if(!t)return;const f=(q,le)=>{const ce={value1:void 0,value2:void 0};let ae=!1;return e&&(e[q]!==void 0&&(ce.value1=e[q],ae=!0),$n(le)&&e[le]!==void 0&&(ce.value2=e[le],ae=!0)),!ae&&n&&(n[q]!==void 0&&(ce.value1=n[q]),$n(le)&&n[le]!==void 0&&(ce.value2=n[le])),ce},v=f("hide").value1;v!==void 0&&t.setVisible(!v,c);const w=f("pinned").value1;w!==void 0&&t.setPinned(w);const C=t.getColDef().minWidth??Y$,M=f("flex").value1;if(M!==void 0&&t.setFlex(M),M==null){const q=f("width").value1;q!=null&&C!=null&&q>=C&&t.setActualWidth(q,c)}const F=f("sort").value1;F!==void 0&&(F==="desc"||F==="asc"?t.setSort(F,c):t.setSort(void 0,c));const N=f("sortIndex").value1;if(N!==void 0&&t.setSortIndex(N),o||!t.isPrimary())return;const z=f("aggFunc").value1;z!==void 0&&(typeof z=="string"?(t.setAggFunc(z),t.isValueActive()||(t.setValueActive(!0,c),s.addValueCol(t))):($n(z)&&Tn("stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it is intended for the column state to be stored and retrieved as simple JSON."),t.isValueActive()&&(t.setValueActive(!1,c),s.removeValueCol(t))));const{value1:L,value2:P}=f("rowGroup","rowGroupIndex");(L!==void 0||P!==void 0)&&(typeof P=="number"||L?(t.isRowGroupActive()||(t.setRowGroupActive(!0,c),s.addGroupCol(t)),i&&typeof P=="number"&&(i[t.getId()]=P)):t.isRowGroupActive()&&(t.setRowGroupActive(!1,c),s.removeGroupCol(t)));const{value1:H,value2:j}=f("pivot","pivotIndex");(H!==void 0||j!==void 0)&&(typeof j=="number"||H?(t.isPivotActive()||(t.setPivotActive(!0,c),s.addPivotCol(t)),r&&typeof j=="number"&&(r[t.getId()]=j)):t.isPivotActive()&&(t.setPivotActive(!1,c),s.removePivotCol(t)))}orderLiveColsLikeState(t){if(!t.applyOrder||!t.state)return;const e=[];t.state.forEach(n=>{n.colId!=null&&e.push(n.colId)}),this.columnModel.sortColsLikeKeys(e)}compareColumnStatesAndDispatchEvents(t){const e={rowGroupColumns:this.funcColsService.getRowGroupColumns().slice(),pivotColumns:this.funcColsService.getPivotColumns().slice(),valueColumns:this.funcColsService.getValueColumns().slice()},n=this.columnGetStateService.getColumnState(),i={};return n.forEach(r=>{i[r.colId]=r}),()=>{const r=this.columnModel.getAllCols(),o=(z,L,P,H)=>{const j=L.map(H),q=P.map(H);if(k_(j,q))return;const ce=new Set(L);P.forEach(fe=>{ce.delete(fe)||ce.add(fe)});const ae=[...ce],pe={type:z,columns:ae,column:ae.length===1?ae[0]:null,source:t};this.eventService.dispatchEvent(pe)},c=z=>{const L=[];return r.forEach(P=>{const H=i[P.getColId()];H&&z(H,P)&&L.push(P)}),L},s=z=>z.getColId();o("columnRowGroupChanged",e.rowGroupColumns,this.funcColsService.getRowGroupColumns(),s),o("columnPivotChanged",e.pivotColumns,this.funcColsService.getPivotColumns(),s);const v=c((z,L)=>{const P=z.aggFunc!=null,H=P!=L.isValueActive(),j=P&&z.aggFunc!=L.getAggFunc();return H||j});v.length>0&&this.eventDispatcher.columnChanged("columnValueChanged",v,t);const w=(z,L)=>z.width!=L.getActualWidth();this.eventDispatcher.columnResized(c(w),!0,t);const C=(z,L)=>z.pinned!=L.getPinned();this.eventDispatcher.columnPinned(c(C),t);const M=(z,L)=>z.hide==L.isVisible();this.eventDispatcher.columnVisible(c(M),t);const N=c((z,L)=>z.sort!=L.getSort()||z.sortIndex!=L.getSortIndex());N.length>0&&this.sortController.dispatchSortChangedEvents(t,N),this.normaliseColumnMovedEventForColumnState(n,t)}}normaliseColumnMovedEventForColumnState(t,e){const n=this.columnGetStateService.getColumnState(),i={};n.forEach(f=>i[f.colId]=f);const r={};t.forEach(f=>{i[f.colId]&&(r[f.colId]=!0)});const o=t.filter(f=>r[f.colId]),c=n.filter(f=>r[f.colId]),s=[];c.forEach((f,v)=>{const w=o&&o[v];if(w&&w.colId!==f.colId){const C=this.columnModel.getCol(w.colId);C&&s.push(C)}}),s.length&&this.eventDispatcher.columnMoved({movedColumns:s,source:e,finished:!0})}},W5=(t,e,n,i)=>{const r=t[n.getId()],o=t[i.getId()],c=r!=null,s=o!=null;if(c&&s)return r-o;if(c)return-1;if(s)return 1;const f=e.indexOf(n),v=e.indexOf(i),w=f>=0,C=v>=0;return w&&C?f-v:w?-1:1},Pce=class extends wn{constructor(){super(...arguments),this.beanName="columnMoveService"}wireBeans(t){this.columnModel=t.columnModel,this.columnAnimationService=t.columnAnimationService,this.eventDispatcher=t.columnEventDispatcher}moveColumnByIndex(t,e,n){const i=this.columnModel.getCols();if(!i)return;const r=i[t];this.moveColumns([r],e,n)}moveColumns(t,e,n,i=!0){const r=this.columnModel.getCols();if(!r)return;if(this.columnAnimationService.start(),e>r.length-t.length){Tn("tried to insert columns in invalid location, toIndex = ",e),Tn("remember that you should not count the moving columns when calculating the new index");return}const o=this.columnModel.getColsForKeys(t);this.doesMovePassRules(o,e)&&(this.columnModel.moveInCols(o,e,n),this.eventDispatcher.columnMoved({movedColumns:o,source:n,toIndex:e,finished:i}),this.columnAnimationService.finish())}doesMovePassRules(t,e){const n=this.getProposedColumnOrder(t,e);return this.doesOrderPassRules(n)}doesOrderPassRules(t){return!(!this.doesMovePassMarryChildren(t)||!this.doesMovePassLockedPositions(t))}getProposedColumnOrder(t,e){const i=this.columnModel.getCols().slice();return $$(i,t,e),i}doesMovePassLockedPositions(t){const e=o=>o?o==="left"||o===!0?-1:1:0,n=this.gos.get("enableRtl");let i=n?1:-1,r=!0;return t.forEach(o=>{const c=e(o.getColDef().lockPosition);n?c>i&&(r=!1):c<i&&(r=!1),i=c}),r}doesMovePassMarryChildren(t){let e=!0;const n=this.columnModel.getColTree();return Jp(null,n,i=>{if(!ql(i))return;const r=i,o=r.getColGroupDef();if(!(o&&o.marryChildren))return;const s=[];r.getLeafColumns().forEach(M=>{const F=t.indexOf(M);s.push(F)});const f=Math.max.apply(Math,s),v=Math.min.apply(Math,s),w=f-v,C=r.getLeafColumns().length-1;w>C&&(e=!1)}),e}placeLockedColumns(t){const e=[],n=[],i=[];return t.forEach(o=>{const c=o.getColDef().lockPosition;c==="right"?i.push(o):c==="left"||c===!0?e.push(o):n.push(o)}),this.gos.get("enableRtl")?[...i,...n,...e]:[...e,...n,...i]}},Ice=/[&<>"']/g,Dce={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function wf(t,e){if(t==null)return null;const n=t.toString().toString();return e?n:n.replace(Ice,i=>Dce[i])}function Fce(t){if(!t||t==null)return null;const e=/([a-z])([A-Z])/g,n=/([A-Z]+)([A-Z])([a-z])/g;return t.replace(e,"$1 $2").replace(n,"$1 $2$3").replace(/\./g," ").split(" ").map(r=>r.substring(0,1).toUpperCase()+(r.length>1?r.substring(1,r.length):"")).join(" ")}var Lce=class extends wn{constructor(){super(...arguments),this.beanName="columnNameService"}wireBeans(t){this.expressionService=t.expressionService,this.funcColsService=t.funcColsService,this.columnModel=t.columnModel}getDisplayNameForColumn(t,e,n=!1){if(!t)return null;const i=this.getHeaderName(t.getColDef(),t,null,null,e);return n?this.wrapHeaderNameWithAggFunc(t,i):i}getDisplayNameForProvidedColumnGroup(t,e,n){const i=e?e.getColGroupDef():null;return i?this.getHeaderName(i,null,t,e,n):null}getDisplayNameForColumnGroup(t,e){return this.getDisplayNameForProvidedColumnGroup(t,t.getProvidedColumnGroup(),e)}getHeaderName(t,e,n,i,r){const o=t.headerValueGetter;if(o){const c=this.gos.addGridCommonParams({colDef:t,column:e,columnGroup:n,providedColumnGroup:i,location:r});return typeof o=="function"?o(c):typeof o=="string"?this.expressionService.evaluate(o,c):(Tn("headerValueGetter must be a function or a string"),"")}else{if(t.headerName!=null)return t.headerName;if(t.field)return Fce(t.field)}return""}wrapHeaderNameWithAggFunc(t,e){if(this.gos.get("suppressAggFuncInHeader"))return e;const n=t.getColDef().pivotValueColumn,i=$n(n);let r=null,o;if(i){const c=this.funcColsService.getValueColumns(),s=this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&c.length===1,f=t.getColDef().pivotTotalColumnIds!==void 0;if(s&&!f)return e;r=n?n.getAggFunc():null,o=!0}else{const c=t.isValueActive(),s=this.columnModel.isPivotMode()||!this.funcColsService.isRowGroupEmpty();c&&s?(r=t.getAggFunc(),o=!0):o=!1}if(o){const c=typeof r=="string"?r:"func";return`${this.localeService.getLocaleTextFunc()(c,c)}(${e})`}return e}},Oce=class extends wn{constructor(){super(...arguments),this.beanName="pivotResultColsService"}wireBeans(t){this.context=t.context,this.columnModel=t.columnModel,this.columnFactory=t.columnFactory,this.visibleColsService=t.visibleColsService}destroy(){var t;dx(this.context,(t=this.pivotResultCols)==null?void 0:t.tree),super.destroy()}isPivotResultColsPresent(){return this.pivotResultCols!=null}lookupPivotResultCol(t,e){if(this.pivotResultCols==null)return null;const n=this.columnModel.getColDefCol(e);let i=null;return this.pivotResultCols.list.forEach(r=>{const o=r.getColDef().pivotKeys,c=r.getColDef().pivotValueColumn;k_(o,t)&&c===n&&(i=r)}),i}getPivotResultCols(){return this.pivotResultCols}getPivotResultCol(t){return this.pivotResultCols?this.columnModel.getColFromCollection(t,this.pivotResultCols):null}setPivotResultCols(t,e){var n,i;if(this.columnModel.isReady()&&!(t==null&&this.pivotResultCols==null)){if(t){this.processPivotResultColDef(t);const r=this.columnFactory.createColumnTree(t,!1,((n=this.pivotResultCols)==null?void 0:n.tree)||this.previousPivotResultCols||void 0,e);dx(this.context,(i=this.pivotResultCols)==null?void 0:i.tree,r.columnTree);const o=r.columnTree,c=r.treeDept,s=v3(o),f={};this.pivotResultCols={tree:o,treeDepth:c,list:s,map:f},this.pivotResultCols.list.forEach(v=>this.pivotResultCols.map[v.getId()]=v),this.previousPivotResultCols=null}else this.previousPivotResultCols=this.pivotResultCols?this.pivotResultCols.tree:null,this.pivotResultCols=null;this.columnModel.refreshCols(),this.visibleColsService.refresh(e)}}processPivotResultColDef(t){const e=this.gos.get("processPivotResultColDef"),n=this.gos.get("processPivotResultColGroupDef");if(!e&&!n)return;const i=r=>{r.forEach(o=>{if($n(o.children)){const s=o;n&&n(s),i(s.children)}else e&&e(o)})};t&&i(t)}},kce=class extends wn{constructor(){super(...arguments),this.beanName="columnSizeService"}wireBeans(t){this.columnModel=t.columnModel,this.columnViewportService=t.columnViewportService,this.eventDispatcher=t.columnEventDispatcher,this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService}setColumnWidths(t,e,n,i){const r=[];t.forEach(o=>{const c=this.columnModel.getColDefCol(o.key)||this.columnModel.getCol(o.key);if(!c)return;if(r.push({width:o.newWidth,ratios:[1],columns:[c]}),this.gos.get("colResizeDefault")==="shift"&&(e=!e),e){const f=this.visibleColsService.getColAfter(c);if(!f)return;const v=c.getActualWidth()-o.newWidth,w=f.getActualWidth()+v;r.push({width:w,ratios:[1],columns:[f]})}}),r.length!==0&&this.resizeColumnSets({resizeSets:r,finished:n,source:i})}resizeColumnSets(t){const{resizeSets:e,finished:n,source:i}=t;if(!(!e||e.every(w=>this.checkMinAndMaxWidthsForSet(w)))){if(n){const w=e&&e.length>0?e[0].columns:null;this.eventDispatcher.columnResized(w,n,i)}return}const o=[],c=[];e.forEach(w=>{const{width:C,columns:M,ratios:F}=w,N={},z={};M.forEach(H=>c.push(H));let L=!0,P=0;for(;L;){if(P++,P>1e3){_s("infinite loop in resizeColumnSets");break}L=!1;const H=[];let j=0,q=C;M.forEach((ce,ae)=>{if(z[ce.getId()])q-=N[ce.getId()];else{H.push(ce);const fe=F[ae];j+=fe}});const le=1/j;H.forEach((ce,ae)=>{const pe=ae===H.length-1;let fe;pe?fe=q:(fe=Math.round(F[ae]*C*le),q-=fe);const ue=ce.getMinWidth(),Ee=ce.getMaxWidth();fe<ue?(fe=ue,z[ce.getId()]=!0,L=!0):Ee>0&&fe>Ee&&(fe=Ee,z[ce.getId()]=!0,L=!0),N[ce.getId()]=fe})}M.forEach(H=>{const j=N[H.getId()];H.getActualWidth()!==j&&(H.setActualWidth(j,i),o.push(H))})});const s=o.length>0;let f=[];s&&(f=this.refreshFlexedColumns({resizingCols:c,skipSetLeft:!0}),this.visibleColsService.setLeftValues(i),this.visibleColsService.updateBodyWidths(),this.columnViewportService.checkViewportColumns());const v=c.concat(f);(s||n)&&this.eventDispatcher.columnResized(v,n,i,f)}checkMinAndMaxWidthsForSet(t){const{columns:e,width:n}=t;let i=0,r=0,o=!0;e.forEach(f=>{const v=f.getMinWidth();i+=v||0;const w=f.getMaxWidth();w>0?r+=w:o=!1});const c=n>=i,s=!o||n<=r;return c&&s}refreshFlexedColumns(t={}){const e=t.source?t.source:"flex";if(t.viewportWidth!=null&&(this.flexViewportWidth=t.viewportWidth),!this.flexViewportWidth)return[];const n=this.visibleColsService.getCenterCols();let i=-1;if(t.resizingCols){const M=new Set(t.resizingCols);for(let F=n.length-1;F>=0;F--)if(M.has(n[F])){i=F;break}}let r=0,o=[],c=0,s=0;for(let M=0;M<n.length;M++)n[M].getFlex()&&M>i?(o.push(n[M]),s+=n[M].getFlex(),c+=n[M].getMinWidth()):r+=n[M].getActualWidth();if(!o.length)return[];let f=[];r+c>this.flexViewportWidth&&(o.forEach(M=>M.setActualWidth(M.getMinWidth(),e)),f=o,o=[]);const v=[];let w;e:for(;;){w=this.flexViewportWidth-r;const M=w/s;for(let F=0;F<o.length;F++){const N=o[F],z=M*N.getFlex();let L=0;const P=N.getMinWidth(),H=N.getMaxWidth();if(z<P?L=P:z>H&&(L=H),L){N.setActualWidth(L,e),j$(o,N),s-=N.getFlex(),f.push(N),r+=N.getActualWidth();continue e}v[F]=Math.round(z)}break}let C=w;return o.forEach((M,F)=>{M.setActualWidth(Math.min(v[F],C),e),f.push(M),C-=v[F]}),t.skipSetLeft||this.visibleColsService.setLeftValues(e),t.updateBodyWidths&&this.visibleColsService.updateBodyWidths(),t.fireResizedEvent&&this.eventDispatcher.columnResized(f,!0,e,o),o}sizeColumnsToFit(t,e="sizeColumnsToFit",n,i){var M;if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.sizeColumnsToFit(t,e,n,i));return}const r={};i&&((M=i==null?void 0:i.columnLimits)==null||M.forEach(({key:F,...N})=>{r[typeof F=="string"?F:F.getColId()]=N}));const o=this.visibleColsService.getAllCols(),c=t===Dp(o);if(t<=0||!o.length||c)return;const s=[],f=[];o.forEach(F=>{F.getColDef().suppressSizeToFit===!0?f.push(F):s.push(F)});const v=s.slice(0);let w=!1;const C=F=>{Xl(s,F),f.push(F)};for(s.forEach(F=>{F.resetActualWidth(e);const N=r==null?void 0:r[F.getId()],z=(N==null?void 0:N.minWidth)??(i==null?void 0:i.defaultMinWidth),L=(N==null?void 0:N.maxWidth)??(i==null?void 0:i.defaultMaxWidth),P=F.getActualWidth();typeof z=="number"&&P<z?F.setActualWidth(z,e,!0):typeof L=="number"&&P>L&&F.setActualWidth(L,e,!0)});!w;){w=!0;const F=t-Dp(f);if(F<=0)s.forEach(N=>{var L;const z=((L=r==null?void 0:r[N.getId()])==null?void 0:L.minWidth)??(i==null?void 0:i.defaultMinWidth);if(typeof z=="number"){N.setActualWidth(z,e,!0);return}N.setMinimum(e)});else{const N=F/Dp(s);let z=F;for(let L=s.length-1;L>=0;L--){const P=s[L],H=r==null?void 0:r[P.getId()],j=(H==null?void 0:H.minWidth)??(i==null?void 0:i.defaultMinWidth),q=(H==null?void 0:H.maxWidth)??(i==null?void 0:i.defaultMaxWidth),le=P.getMinWidth(),ce=P.getMaxWidth(),ae=typeof j=="number"&&j>le?j:le,pe=typeof q=="number"&&q<ce?q:ce;let fe=Math.round(P.getActualWidth()*N);fe<ae?(fe=ae,C(P),w=!1):fe>pe?(fe=pe,C(P),w=!1):L===0&&(fe=z),P.setActualWidth(fe,e,!0),z-=fe}}}v.forEach(F=>{F.fireColumnWidthChangedEvent(e)}),this.visibleColsService.setLeftValues(e),this.visibleColsService.updateBodyWidths(),!n&&this.eventDispatcher.columnResized(v,!0,e)}applyAutosizeStrategy(){const t=this.gos.get("autoSizeStrategy");if(!t)return;const{type:e}=t;setTimeout(()=>{if(e==="fitGridWidth"){const{columnLimits:n,defaultMinWidth:i,defaultMaxWidth:r}=t,o=n==null?void 0:n.map(({colId:c,minWidth:s,maxWidth:f})=>({key:c,minWidth:s,maxWidth:f}));this.ctrlsService.getGridBodyCtrl().sizeColumnsToFit({defaultMinWidth:i,defaultMaxWidth:r,columnLimits:o})}else e==="fitProvidedWidth"&&this.sizeColumnsToFit(t.width,"sizeColumnsToFit")})}};function Q$(t,e){return t+"_"+e}function oa(t){return t instanceof e7}var e7=class extends wn{constructor(t,e,n,i){super(),this.isColumn=!1,this.displayedChildren=[],this.parent=null,this.groupId=e,this.partId=n,this.providedColumnGroup=t,this.pinned=i}reset(){this.parent=null,this.children=null,this.displayedChildren=null}getParent(){return this.parent}setParent(t){this.parent=t}getUniqueId(){return Q$(this.groupId,this.partId)}isEmptyGroup(){return this.displayedChildren.length===0}isMoving(){const t=this.getProvidedColumnGroup().getLeafColumns();return!t||t.length===0?!1:t.every(e=>e.isMoving())}checkLeft(){if(this.displayedChildren.forEach(t=>{oa(t)&&t.checkLeft()}),this.displayedChildren.length>0)if(this.gos.get("enableRtl")){const e=Yr(this.displayedChildren).getLeft();this.setLeft(e)}else{const t=this.displayedChildren[0].getLeft();this.setLeft(t)}else this.setLeft(null)}getLeft(){return this.left}getOldLeft(){return this.oldLeft}setLeft(t){this.oldLeft=this.left,this.left!==t&&(this.left=t,this.dispatchLocalEvent({type:"leftChanged"}))}getPinned(){return this.pinned}getGroupId(){return this.groupId}getPartId(){return this.partId}getActualWidth(){let t=0;return this.displayedChildren&&this.displayedChildren.forEach(e=>{t+=e.getActualWidth()}),t}isResizable(){if(!this.displayedChildren)return!1;let t=!1;return this.displayedChildren.forEach(e=>{e.isResizable()&&(t=!0)}),t}getMinWidth(){let t=0;return this.displayedChildren.forEach(e=>{t+=e.getMinWidth()}),t}addChild(t){this.children||(this.children=[]),this.children.push(t)}getDisplayedChildren(){return this.displayedChildren}getLeafColumns(){const t=[];return this.addLeafColumns(t),t}getDisplayedLeafColumns(){const t=[];return this.addDisplayedLeafColumns(t),t}getDefinition(){return this.providedColumnGroup.getColGroupDef()}getColGroupDef(){return this.providedColumnGroup.getColGroupDef()}isPadding(){return this.providedColumnGroup.isPadding()}isExpandable(){return this.providedColumnGroup.isExpandable()}isExpanded(){return this.providedColumnGroup.isExpanded()}setExpanded(t){this.providedColumnGroup.setExpanded(t)}addDisplayedLeafColumns(t){this.displayedChildren.forEach(e=>{av(e)?t.push(e):oa(e)&&e.addDisplayedLeafColumns(t)})}addLeafColumns(t){this.children.forEach(e=>{av(e)?t.push(e):oa(e)&&e.addLeafColumns(t)})}getChildren(){return this.children}getColumnGroupShow(){return this.providedColumnGroup.getColumnGroupShow()}getProvidedColumnGroup(){return this.providedColumnGroup}getPaddingLevel(){const t=this.getParent();return!this.isPadding()||!t||!t.isPadding()?0:1+t.getPaddingLevel()}calculateDisplayedColumns(){this.displayedChildren=[];let t=this;for(;t!=null&&t.isPadding();)t=t.getParent();if(!(t?t.getProvidedColumnGroup().isExpandable():!1)){this.displayedChildren=this.children,this.dispatchLocalEvent({type:"displayedChildrenChanged"});return}this.children.forEach(n=>{if(oa(n)&&(!n.displayedChildren||!n.displayedChildren.length))return;switch(n.getColumnGroupShow()){case"open":t.getProvidedColumnGroup().isExpanded()&&this.displayedChildren.push(n);break;case"closed":t.getProvidedColumnGroup().isExpanded()||this.displayedChildren.push(n);break;default:this.displayedChildren.push(n);break}}),this.dispatchLocalEvent({type:"displayedChildrenChanged"})}},t7=class{constructor(){this.existingIds={}}getInstanceIdForKey(t){const e=this.existingIds[t];let n;return typeof e!="number"?n=0:n=e+1,this.existingIds[t]=n,n}},Nce=class extends wn{constructor(){super(...arguments),this.beanName="visibleColsService",this.colsAndGroupsMap={},this.columnsLeft=[],this.columnsRight=[],this.columnsCenter=[],this.columns=[],this.bodyWidth=0,this.leftWidth=0,this.rightWidth=0,this.bodyWidthDirty=!0}wireBeans(t){this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.columnViewportService=t.columnViewportService,this.eventDispatcher=t.columnEventDispatcher}refresh(t,e=!1){e||this.buildTrees(),this.updateOpenClosedVisibilityInColumnGroups(),this.columnsLeft=_D(this.treeLeft),this.columnsCenter=_D(this.treeCenter),this.columnsRight=_D(this.treeRight),this.joinColsAriaOrder(),this.joinCols(),this.setLeftValues(t),this.autoHeightCols=this.columns.filter(n=>n.isAutoHeight()),this.columnSizeService.refreshFlexedColumns(),this.updateBodyWidths(),this.columnViewportService.checkViewportColumns(!1),this.setFirstRightAndLastLeftPinned(t),this.eventDispatcher.visibleCols()}updateBodyWidths(){const t=Dp(this.columnsCenter),e=Dp(this.columnsLeft),n=Dp(this.columnsRight);if(this.bodyWidthDirty=this.bodyWidth!==t,this.bodyWidth!==t||this.leftWidth!==e||this.rightWidth!==n){this.bodyWidth=t,this.leftWidth=e,this.rightWidth=n;const r={type:"columnContainerWidthChanged"};this.eventService.dispatchEvent(r);const o={type:"displayedColumnsWidthChanged"};this.eventService.dispatchEvent(o)}}setLeftValues(t){this.setLeftValuesOfCols(t),this.setLeftValuesOfGroups()}setFirstRightAndLastLeftPinned(t){let e,n;this.gos.get("enableRtl")?(e=this.columnsLeft?this.columnsLeft[0]:null,n=this.columnsRight?Yr(this.columnsRight):null):(e=this.columnsLeft?Yr(this.columnsLeft):null,n=this.columnsRight?this.columnsRight[0]:null),this.columnModel.getCols().forEach(i=>{i.setLastLeftPinned(i===e,t),i.setFirstRightPinned(i===n,t)})}buildTrees(){const t=this.columnModel.getColsToShow(),e=t.filter(o=>o.getPinned()=="left"),n=t.filter(o=>o.getPinned()=="right"),i=t.filter(o=>o.getPinned()!="left"&&o.getPinned()!="right"),r=new t7;this.treeLeft=this.createGroups({columns:e,idCreator:r,pinned:"left",oldDisplayedGroups:this.treeLeft}),this.treeRight=this.createGroups({columns:n,idCreator:r,pinned:"right",oldDisplayedGroups:this.treeRight}),this.treeCenter=this.createGroups({columns:i,idCreator:r,pinned:null,oldDisplayedGroups:this.treeCenter}),this.updateColsAndGroupsMap()}clear(){this.columnsLeft=[],this.columnsRight=[],this.columnsCenter=[],this.columns=[],this.ariaOrderColumns=[]}joinColsAriaOrder(){const t=this.columnModel.getCols(),e=[],n=[],i=[];for(const r of t){const o=r.getPinned();o?o===!0||o==="left"?e.push(r):i.push(r):n.push(r)}this.ariaOrderColumns=e.concat(n).concat(i)}getAriaColIndex(t){let e;return oa(t)?e=t.getLeafColumns()[0]:e=t,this.ariaOrderColumns.indexOf(e)+1}getAllAutoHeightCols(){return this.autoHeightCols}setLeftValuesOfGroups(){[this.treeLeft,this.treeRight,this.treeCenter].forEach(t=>{t.forEach(e=>{oa(e)&&e.checkLeft()})})}setLeftValuesOfCols(t){if(!this.columnModel.getColDefCols())return;const n=this.columnModel.getCols().slice(0),i=this.gos.get("enableRtl");[this.columnsLeft,this.columnsRight,this.columnsCenter].forEach(r=>{if(i){let o=Dp(r);r.forEach(c=>{o-=c.getActualWidth(),c.setLeft(o,t)})}else{let o=0;r.forEach(c=>{c.setLeft(o,t),o+=c.getActualWidth()})}oce(n,r)}),n.forEach(r=>{r.setLeft(null,t)})}joinCols(){this.gos.get("enableRtl")?this.columns=this.columnsRight.concat(this.columnsCenter).concat(this.columnsLeft):this.columns=this.columnsLeft.concat(this.columnsCenter).concat(this.columnsRight)}getColsCenter(){return this.columnsCenter}getAllTrees(){return this.treeLeft&&this.treeRight&&this.treeCenter?this.treeLeft.concat(this.treeCenter).concat(this.treeRight):null}getTreeLeft(){return this.treeLeft}getTreeRight(){return this.treeRight}getTreeCenter(){return this.treeCenter}getAllCols(){return this.columns}isColDisplayed(t){return this.getAllCols().indexOf(t)>=0}getLeftColsForRow(t){return this.columnModel.isColSpanActive()?this.getColsForRow(t,this.columnsLeft):this.columnsLeft}getRightColsForRow(t){return this.columnModel.isColSpanActive()?this.getColsForRow(t,this.columnsRight):this.columnsRight}getColsForRow(t,e,n,i){const r=[];let o=null;for(let c=0;c<e.length;c++){const s=e[c],f=e.length-c,v=Math.min(s.getColSpan(t),f),w=[s];if(v>1){const M=v-1;for(let F=1;F<=M;F++)w.push(e[c+F]);c+=M}let C;n?(C=!1,w.forEach(M=>{n(M)&&(C=!0)})):C=!0,C&&(r.length===0&&o&&(i&&i(s))&&r.push(o),r.push(s)),o=s}return r}getBodyContainerWidth(){return this.bodyWidth}getContainerWidth(t){switch(t){case"left":return this.leftWidth;case"right":return this.rightWidth;default:return this.bodyWidth}}getCenterCols(){return this.columnsCenter}getLeftCols(){return this.columnsLeft}getRightCols(){return this.columnsRight}getColBefore(t){const e=this.getAllCols(),n=e.indexOf(t);return n>0?e[n-1]:null}getGroupAtDirection(t,e){const n=t.getProvidedColumnGroup().getLevel()+t.getPaddingLevel(),i=t.getDisplayedLeafColumns(),r=e==="After"?Yr(i):i[0],o=`getCol${e}`;for(;;){const c=this[o](r);if(!c)return null;const s=this.getColGroupAtLevel(c,n);if(s!==t)return s}}getColGroupAtLevel(t,e){let n=t.getParent(),i,r;for(;i=n.getProvidedColumnGroup().getLevel(),r=n.getPaddingLevel(),!(i+r<=e);)n=n.getParent();return n}isPinningLeft(){return this.columnsLeft.length>0}isPinningRight(){return this.columnsRight.length>0}updateColsAndGroupsMap(){this.colsAndGroupsMap={};const t=e=>{this.colsAndGroupsMap[e.getUniqueId()]=e};Iy(this.treeCenter,!1,t),Iy(this.treeLeft,!1,t),Iy(this.treeRight,!1,t)}isVisible(t){return this.colsAndGroupsMap[t.getUniqueId()]===t}updateOpenClosedVisibilityInColumnGroups(){const t=this.getAllTrees();Iy(t,!1,e=>{oa(e)&&e.calculateDisplayedColumns()})}getFirstColumn(){const t=this.gos.get("enableRtl"),e=["getLeftCols","getCenterCols","getRightCols"];t&&e.reverse();for(let n=0;n<e.length;n++){const i=this[e[n]]();if(i.length)return t?Yr(i):i[0]}return null}getColumnGroup(t,e){if(!t)return null;if(oa(t))return t;const n=this.getAllTrees(),i=typeof e=="number";let r=null;return Iy(n,!1,o=>{if(oa(o)){const c=o;let s;i?s=t===c.getGroupId()&&e===c.getPartId():s=t===c.getGroupId(),s&&(r=c)}}),r}getColAfter(t){const e=this.getAllCols(),n=e.indexOf(t);return n<e.length-1?e[n+1]:null}isBodyWidthDirty(){return this.bodyWidthDirty}setBodyWidthDirty(){this.bodyWidthDirty=!0}getColsLeftWidth(){return Dp(this.columnsLeft)}getDisplayedColumnsRightWidth(){return Dp(this.columnsRight)}isColAtEdge(t,e){const n=this.getAllCols();if(!n.length)return!1;const i=e==="first";let r;if(oa(t)){const o=t.getDisplayedLeafColumns();if(!o.length)return!1;r=i?o[0]:Yr(o)}else r=t;return(i?n[0]:Yr(n))===r}createGroups(t){const{columns:e,idCreator:n,pinned:i,oldDisplayedGroups:r,isStandaloneStructure:o}=t,c=this.mapOldGroupsById(r),s=[];let f=e;for(;f.length;){const v=f;f=[];let w=0;const C=M=>{const F=w;w=M;const N=v[F],L=(oa(N)?N.getProvidedColumnGroup():N).getOriginalParent();if(L==null){for(let H=F;H<M;H++)s.push(v[H]);return}const P=this.createColGroup(L,n,c,i,o);for(let H=F;H<M;H++)P.addChild(v[H]);f.push(P)};for(let M=1;M<v.length;M++){const F=v[M],z=(oa(F)?F.getProvidedColumnGroup():F).getOriginalParent(),L=v[w],H=(oa(L)?L.getProvidedColumnGroup():L).getOriginalParent();z!==H&&C(M)}w<v.length&&C(v.length)}return o||this.setupParentsIntoCols(s,null),s}createColGroup(t,e,n,i,r){const o=t.getGroupId(),c=e.getInstanceIdForKey(o),s=Q$(o,c);let f=n[s];return f&&f.getProvidedColumnGroup()!==t&&(f=null),$n(f)?f.reset():(f=new e7(t,o,c,i),r||this.createBean(f)),f}mapOldGroupsById(t){const e={},n=i=>{i.forEach(r=>{if(oa(r)){const o=r;e[r.getUniqueId()]=o,n(o.getChildren())}})};return t&&n(t),e}setupParentsIntoCols(t,e){t.forEach(n=>{if(n.setParent(e),oa(n)){const i=n;this.setupParentsIntoCols(i.getChildren(),i)}})}};function Iy(t,e,n){if(t)for(let i=0;i<t.length;i++){const r=t[i];if(oa(r)){const o=e?r.getDisplayedChildren():r.getChildren();Iy(o,e,n)}n(r)}}function _D(t){const e=[];return Iy(t,!0,n=>{av(n)&&e.push(n)}),e}var n7=["columnEverythingChanged","newColumnsLoaded","columnPivotModeChanged","pivotMaxColumnsExceeded","columnRowGroupChanged","expandOrCollapseAll","columnPivotChanged","gridColumnsChanged","columnValueChanged","columnMoved","columnVisible","columnPinned","columnGroupOpened","columnResized","displayedColumnsChanged","virtualColumnsChanged","columnHeaderMouseOver","columnHeaderMouseLeave","columnHeaderClicked","columnHeaderContextMenu","asyncTransactionsFlushed","rowGroupOpened","rowDataUpdated","pinnedRowDataChanged","rangeSelectionChanged","chartCreated","chartRangeSelectionChanged","chartOptionsChanged","chartDestroyed","toolPanelVisibleChanged","toolPanelSizeChanged","modelUpdated","cutStart","cutEnd","pasteStart","pasteEnd","fillStart","fillEnd","rangeDeleteStart","rangeDeleteEnd","undoStarted","undoEnded","redoStarted","redoEnded","cellClicked","cellDoubleClicked","cellMouseDown","cellContextMenu","cellValueChanged","cellEditRequest","rowValueChanged","headerFocused","cellFocused","rowSelected","selectionChanged","tooltipShow","tooltipHide","cellKeyDown","cellMouseOver","cellMouseOut","filterChanged","filterModified","filterOpened","advancedFilterBuilderVisibleChanged","sortChanged","virtualRowRemoved","rowClicked","rowDoubleClicked","gridReady","gridPreDestroyed","gridSizeChanged","viewportChanged","firstDataRendered","dragStarted","dragStopped","rowEditingStarted","rowEditingStopped","cellEditingStarted","cellEditingStopped","bodyScroll","bodyScrollEnd","paginationChanged","componentStateChanged","storeRefreshed","stateUpdated","columnMenuVisibleChanged","contextMenuVisibleChanged","rowDragEnter","rowDragMove","rowDragLeave","rowDragEnd"],Bce=["scrollbarWidthChanged","keyShortcutChangedCellStart","keyShortcutChangedCellEnd","pinnedHeightChanged","cellFocusCleared","fullWidthRowFocused","checkboxChanged","heightScaleChanged","suppressMovableColumns","suppressMenuHide","suppressFieldDotNotation","columnPanelItemDragStart","columnPanelItemDragEnd","bodyHeightChanged","columnContainerWidthChanged","displayedColumnsWidthChanged","scrollVisibilityChanged","columnHoverChanged","flashCells","paginationPixelOffsetChanged","displayedRowsChanged","leftPinnedWidthChanged","rightPinnedWidthChanged","rowContainerHeightChanged","headerHeightChanged","columnHeaderHeightChanged","gridStylesChanged","storeUpdated","filterDestroyed","rowDataUpdateStarted","rowCountReady","advancedFilterEnabledChanged","dataTypesInferred","fieldValueChanged","fieldPickerValueSelected","richSelectListRowSelected","sideBarUpdated","alignedGridScroll","alignedGridColumn","gridOptionsChanged","chartTitleEdit","recalculateRowBounds","stickyTopOffsetChanged"],zce=[...n7,...Bce],Uce={enableBrowserTooltips:!0,tooltipTrigger:!0,tooltipMouseTrack:!0,tooltipShowMode:!0,tooltipInteraction:!0,defaultColGroupDef:!0,suppressAutoSize:!0,skipHeaderOnAutoSize:!0,autoSizeStrategy:!0,components:!0,stopEditingWhenCellsLoseFocus:!0,undoRedoCellEditing:!0,undoRedoCellEditingLimit:!0,excelStyles:!0,cacheQuickFilter:!0,advancedFilterModel:!0,customChartThemes:!0,chartThemeOverrides:!0,chartToolPanelsDef:!0,loadingCellRendererSelector:!0,localeText:!0,keepDetailRows:!0,keepDetailRowsCount:!0,detailRowHeight:!0,detailRowAutoHeight:!0,tabIndex:!0,valueCache:!0,valueCacheNeverExpires:!0,enableCellExpressions:!0,suppressTouch:!0,suppressAsyncEvents:!0,suppressBrowserResizeObserver:!0,suppressPropertyNamesCheck:!0,debug:!0,loadingOverlayComponent:!0,suppressLoadingOverlay:!0,noRowsOverlayComponent:!0,paginationPageSizeSelector:!0,paginateChildRows:!0,pivotPanelShow:!0,pivotSuppressAutoColumn:!0,suppressExpandablePivotGroups:!0,aggFuncs:!0,suppressAggFuncInHeader:!0,removePivotHeaderRowWhenSingleValueColumn:!0,allowShowChangeAfterFilter:!0,ensureDomOrder:!0,enableRtl:!0,suppressColumnVirtualisation:!0,suppressMaxRenderedRowRestriction:!0,suppressRowVirtualisation:!0,rowDragText:!0,suppressGroupMaintainValueType:!0,groupLockGroupColumns:!0,rowGroupPanelSuppressSort:!0,suppressGroupRowsSticky:!0,rowModelType:!0,cacheOverflowSize:!0,infiniteInitialRowCount:!0,serverSideInitialRowCount:!0,suppressServerSideInfiniteScroll:!0,maxBlocksInCache:!0,maxConcurrentDatasourceRequests:!0,blockLoadDebounceMillis:!0,serverSideOnlyRefreshFilteredGroups:!0,serverSidePivotResultFieldSeparator:!0,viewportRowModelPageSize:!0,viewportRowModelBufferSize:!0,debounceVerticalScrollbar:!0,suppressAnimationFrame:!0,suppressPreventDefaultOnMouseWheel:!0,scrollbarWidth:!0,icons:!0,suppressRowTransform:!0,gridId:!0,enableGroupEdit:!0,initialState:!0,processUnpinnedColumns:!0,createChartContainer:!0,getLocaleText:!0,getRowId:!0,reactiveCustomComponents:!0,columnMenu:!0},yl=class{};yl.STRING_PROPERTIES=["rowSelection","overlayLoadingTemplate","overlayNoRowsTemplate","gridId","quickFilterText","rowModelType","editType","domLayout","clipboardDelimiter","rowGroupPanelShow","multiSortKey","pivotColumnGroupTotals","pivotRowTotals","pivotPanelShow","fillHandleDirection","groupDisplayType","treeDataDisplayType","colResizeDefault","tooltipTrigger","serverSidePivotResultFieldSeparator","columnMenu","tooltipShowMode","grandTotalRow"];yl.OBJECT_PROPERTIES=["components","rowStyle","context","autoGroupColumnDef","localeText","icons","datasource","serverSideDatasource","viewportDatasource","groupRowRendererParams","aggFuncs","fullWidthCellRendererParams","defaultColGroupDef","defaultColDef","defaultCsvExportParams","defaultExcelExportParams","columnTypes","rowClassRules","detailCellRendererParams","loadingCellRendererParams","loadingOverlayComponentParams","noRowsOverlayComponentParams","popupParent","statusBar","sideBar","chartThemeOverrides","customChartThemes","chartToolPanelsDef","dataTypeDefinitions","advancedFilterModel","advancedFilterParent","advancedFilterBuilderParams","initialState","autoSizeStrategy"];yl.ARRAY_PROPERTIES=["sortingOrder","alignedGrids","rowData","columnDefs","excelStyles","pinnedTopRowData","pinnedBottomRowData","chartThemes","rowClass","paginationPageSizeSelector"];yl.NUMBER_PROPERTIES=["rowHeight","detailRowHeight","rowBuffer","headerHeight","groupHeaderHeight","groupLockGroupColumns","floatingFiltersHeight","pivotHeaderHeight","pivotGroupHeaderHeight","groupDefaultExpanded","pivotDefaultExpanded","viewportRowModelPageSize","viewportRowModelBufferSize","autoSizePadding","maxBlocksInCache","maxConcurrentDatasourceRequests","tooltipShowDelay","tooltipHideDelay","cacheOverflowSize","paginationPageSize","cacheBlockSize","infiniteInitialRowCount","serverSideInitialRowCount","scrollbarWidth","asyncTransactionWaitMillis","blockLoadDebounceMillis","keepDetailRowsCount","undoRedoCellEditingLimit","cellFlashDelay","cellFadeDelay","cellFlashDuration","cellFadeDuration","tabIndex","pivotMaxGeneratedColumns"];yl.BOOLEAN_PROPERTIES=["suppressMakeColumnVisibleAfterUnGroup","suppressRowClickSelection","suppressCellFocus","suppressHeaderFocus","suppressHorizontalScroll","groupSelectsChildren","alwaysShowHorizontalScroll","alwaysShowVerticalScroll","debug","enableBrowserTooltips","enableCellExpressions","groupIncludeTotalFooter","groupSuppressBlankHeader","suppressMenuHide","suppressRowDeselection","unSortIcon","suppressMultiSort","alwaysMultiSort","singleClickEdit","suppressLoadingOverlay","suppressNoRowsOverlay","suppressAutoSize","skipHeaderOnAutoSize","suppressColumnMoveAnimation","suppressMovableColumns","suppressFieldDotNotation","enableRangeSelection","enableRangeHandle","enableFillHandle","suppressClearOnFillReduction","deltaSort","suppressTouch","suppressAsyncEvents","allowContextMenuWithControlKey","suppressContextMenu","enableCellChangeFlash","suppressDragLeaveHidesColumns","suppressRowGroupHidesColumns","suppressMiddleClickScrolls","suppressPreventDefaultOnMouseWheel","suppressCopyRowsToClipboard","copyHeadersToClipboard","copyGroupHeadersToClipboard","pivotMode","suppressAggFuncInHeader","suppressColumnVirtualisation","alwaysAggregateAtRootLevel","suppressFocusAfterRefresh","functionsReadOnly","animateRows","groupSelectsFiltered","groupRemoveSingleChildren","groupRemoveLowestSingleChildren","enableRtl","suppressClickEdit","rowDragEntireRow","rowDragManaged","suppressRowDrag","suppressMoveWhenRowDragging","rowDragMultiRow","enableGroupEdit","embedFullWidthRows","suppressPaginationPanel","groupHideOpenParents","groupAllowUnbalanced","pagination","paginationAutoPageSize","suppressScrollOnNewData","suppressScrollWhenPopupsAreOpen","purgeClosedRowNodes","cacheQuickFilter","includeHiddenColumnsInQuickFilter","ensureDomOrder","accentedSort","suppressChangeDetection","valueCache","valueCacheNeverExpires","aggregateOnlyChangedColumns","suppressAnimationFrame","suppressExcelExport","suppressCsvExport","includeHiddenColumnsInAdvancedFilter","suppressMultiRangeSelection","enterNavigatesVerticallyAfterEdit","enterNavigatesVertically","suppressPropertyNamesCheck","rowMultiSelectWithClick","suppressRowHoverHighlight","suppressRowTransform","suppressClipboardPaste","suppressLastEmptyLineOnPaste","enableCharts","suppressMaintainUnsortedOrder","enableCellTextSelection","suppressBrowserResizeObserver","suppressMaxRenderedRowRestriction","excludeChildrenWhenTreeDataFiltering","tooltipMouseTrack","tooltipInteraction","keepDetailRows","paginateChildRows","preventDefaultOnContextMenu","undoRedoCellEditing","allowDragFromColumnsToolPanel","pivotSuppressAutoColumn","suppressExpandablePivotGroups","debounceVerticalScrollbar","detailRowAutoHeight","serverSideSortAllLevels","serverSideEnableClientSideSort","serverSideOnlyRefreshFilteredGroups","serverSideSortOnServer","serverSideFilterOnServer","suppressAggFilteredOnly","showOpenedGroup","suppressClipboardApi","suppressModelUpdateAfterUpdateTransaction","stopEditingWhenCellsLoseFocus","maintainColumnOrder","groupMaintainOrder","columnHoverHighlight","readOnlyEdit","suppressRowVirtualisation","enableCellEditingOnBackspace","resetRowDataOnUpdate","removePivotHeaderRowWhenSingleValueColumn","suppressCopySingleCellRanges","suppressGroupRowsSticky","suppressCutToClipboard","suppressServerSideInfiniteScroll","rowGroupPanelSuppressSort","allowShowChangeAfterFilter","enableAdvancedFilter","masterDetail","treeData","suppressGroupMaintainValueType","reactiveCustomComponents","applyQuickFilterBeforePivotOrAgg","suppressServerSideFullWidthLoadingRow","suppressAdvancedFilterEval","loading"];yl.OTHER_PROPERTIES=["suppressStickyTotalRow"];yl.FUNCTION_PROPERTIES=["doesExternalFilterPass","processPivotResultColDef","processPivotResultColGroupDef","getBusinessKeyForNode","isRowSelectable","rowDragText","groupRowRenderer","fullWidthCellRenderer","loadingCellRenderer","loadingOverlayComponent","noRowsOverlayComponent","detailCellRenderer","quickFilterParser","quickFilterMatcher","getLocaleText","isExternalFilterPresent","getRowHeight","getRowClass","getRowStyle","getContextMenuItems","getMainMenuItems","processRowPostCreate","processCellForClipboard","getGroupRowAgg","isFullWidthRow","sendToClipboard","focusGridInnerElement","navigateToNextHeader","tabToNextHeader","navigateToNextCell","tabToNextCell","processCellFromClipboard","getDocument","postProcessPopup","getChildCount","getDataPath","isRowMaster","postSortRows","processHeaderForClipboard","processUnpinnedColumns","processGroupHeaderForClipboard","paginationNumberFormatter","processDataFromClipboard","getServerSideGroupKey","isServerSideGroup","createChartContainer","getChartToolbarItems","fillOperation","isApplyServerSideTransaction","getServerSideGroupLevelParams","isServerSideGroupOpenByDefault","isGroupOpenByDefault","initialGroupOrderComparator","groupIncludeFooter","loadingCellRendererSelector","getRowId","groupAggFiltering","chartMenuItems","groupTotalRow"];yl.ALL_PROPERTIES=[...yl.ARRAY_PROPERTIES,...yl.OBJECT_PROPERTIES,...yl.STRING_PROPERTIES,...yl.NUMBER_PROPERTIES,...yl.FUNCTION_PROPERTIES,...yl.BOOLEAN_PROPERTIES,...yl.OTHER_PROPERTIES];var iS=yl,Qu=class{static getCallbackForEvent(e){return!e||e.length<2?e:"on"+e[0].toUpperCase()+e.substring(1)}};Qu.VUE_OMITTED_PROPERTY="AG-VUE-OMITTED-PROPERTY";Qu.PUBLIC_EVENTS=n7;Qu.EVENT_CALLBACKS=zce.map(t=>Qu.getCallbackForEvent(t));Qu.BOOLEAN_PROPERTIES=iS.BOOLEAN_PROPERTIES;Qu.ALL_PROPERTIES=iS.ALL_PROPERTIES;Qu.ALL_PROPERTIES_AND_CALLBACKS=[...Qu.ALL_PROPERTIES,...Qu.EVENT_CALLBACKS];Qu.ALL_PROPERTIES_AND_CALLBACKS_SET=new Set(Qu.ALL_PROPERTIES_AND_CALLBACKS);var rS=Qu;function Vce(t,e){typeof t!="object"&&(t={});const n={...t};return rS.ALL_PROPERTIES_AND_CALLBACKS.forEach(r=>{const o=e[r];typeof o<"u"&&o!==rS.VUE_OMITTED_PROPERTY&&(n[r]=o)}),n}function Gce(t,e){if(!t)return;const n={};let i=!1;if(Object.keys(t).filter(c=>rS.ALL_PROPERTIES_AND_CALLBACKS_SET.has(c)).forEach(c=>{n[c]=t[c],i=!0}),!i)return;const r={type:"gridOptionsChanged",options:n};e.dispatchEvent(r);const o={type:"componentStateChanged"};td(n,(c,s)=>{o[c]=s}),e.dispatchEvent(o)}var US=class{constructor(t){this.cssClassStates={},this.getGui=t}addCssClass(t){const e=(t||"").split(" ");if(e.length>1){e.forEach(i=>this.addCssClass(i));return}if(this.cssClassStates[t]!==!0&&t.length){const i=this.getGui();i&&i.classList.add(t),this.cssClassStates[t]=!0}}removeCssClass(t){const e=(t||"").split(" ");if(e.length>1){e.forEach(i=>this.removeCssClass(i));return}if(this.cssClassStates[t]!==!1&&t.length){const i=this.getGui();i&&i.classList.remove(t),this.cssClassStates[t]=!1}}containsCssClass(t){const e=this.getGui();return e?e.classList.contains(t):!1}addOrRemoveCssClass(t,e){if(!t)return;if(t.indexOf(" ")>=0){const i=(t||"").split(" ");if(i.length>1){i.forEach(r=>this.addOrRemoveCssClass(r,e));return}}if(this.cssClassStates[t]!==e&&t.length){const i=this.getGui();i&&i.classList.toggle(t,e),this.cssClassStates[t]=e}}};function cm(t,e,n){n==null||typeof n=="string"&&n==""?i7(t,e):Tf(t,e,n)}function Tf(t,e,n){t.setAttribute(r7(e),n.toString())}function i7(t,e){t.removeAttribute(r7(e))}function r7(t){return`aria-${t}`}function ld(t,e){e?t.setAttribute("role",e):t.removeAttribute("role")}function Hce(t){let e;return t==="asc"?e="ascending":t==="desc"?e="descending":t==="mixed"?e="other":e="none",e}function Wce(t){return t.getAttribute("aria-label")}function nw(t,e){cm(t,"label",e)}function sS(t,e){cm(t,"labelledby",e)}function s7(t,e){cm(t,"live",e)}function jce(t,e){cm(t,"atomic",e)}function $ce(t,e){cm(t,"relevant",e)}function qce(t,e){cm(t,"disabled",e)}function y3(t,e){cm(t,"hidden",e)}function tT(t,e){Tf(t,"expanded",e)}function Zce(t,e){Tf(t,"setsize",e)}function Xce(t,e){Tf(t,"posinset",e)}function Kce(t,e){Tf(t,"rowcount",e)}function Yce(t,e){Tf(t,"rowindex",e)}function Jce(t,e){Tf(t,"colcount",e)}function o7(t,e){Tf(t,"colindex",e)}function Qce(t,e){Tf(t,"colspan",e)}function eue(t,e){Tf(t,"sort",e)}function tue(t){i7(t,"sort")}function nT(t,e){cm(t,"selected",e)}function nue(t,e){cm(t,"controls",e.id),sS(e,t.id)}function _3(t,e){return e===void 0?t("ariaIndeterminate","indeterminate"):e===!0?t("ariaChecked","checked"):t("ariaUnchecked","unchecked")}var xD,AE,wD,CD,SD,bD,bL,EL;function Qp(){return xD===void 0&&(xD=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),xD}function a7(){if(AE===void 0)if(Qp()){const t=navigator.userAgent.match(/version\/(\d+)/i);t&&(AE=t[1]!=null?parseFloat(t[1]):0)}else AE=0;return AE}function x3(){if(wD===void 0){const t=window;wD=!!t.chrome&&(!!t.chrome.webstore||!!t.chrome.runtime)||/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}return wD}function l7(){return CD===void 0&&(CD=/(firefox)/i.test(navigator.userAgent)),CD}function c7(){return SD===void 0&&(SD=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)),SD}function wv(){return bD===void 0&&(bD=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1),bD}function j5(){return!Qp()||a7()>=15}function ML(t){if(!t)return null;const e=t.tabIndex,n=t.getAttribute("tabIndex");return e===-1&&(n===null||n===""&&!l7())?null:e.toString()}function iue(){if(!document.body)return-1;let t=1e6;const e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,n=document.createElement("div");for(document.body.appendChild(n);;){const i=t*2;if(n.style.height=i+"px",i>e||n.clientHeight!==i)break;t=i}return document.body.removeChild(n),t}function rue(){var t,e;return((t=document.body)==null?void 0:t.clientWidth)??(window.innerHeight||((e=document.documentElement)==null?void 0:e.clientWidth)||-1)}function sue(){var t,e;return((t=document.body)==null?void 0:t.clientHeight)??(window.innerHeight||((e=document.documentElement)==null?void 0:e.clientHeight)||-1)}function oue(){return EL==null&&u7(),EL}function u7(){const t=document.body,e=document.createElement("div");e.style.width=e.style.height="100px",e.style.opacity="0",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",e.style.position="absolute",t.appendChild(e);let n=e.offsetWidth-e.clientWidth;n===0&&e.clientWidth===0&&(n=null),e.parentNode&&e.parentNode.removeChild(e),n!=null&&(EL=n,bL=n===0)}function h7(){return bL==null&&u7(),bL}var PE,aue="[tabindex], input, select, button, textarea, [href]",d7="[disabled], .ag-disabled:not(.ag-button), .ag-disabled *";function w3(t){const e=Element.prototype.matches||Element.prototype.msMatchesSelector,i=e.call(t,"input, select, button, textarea"),r=e.call(t,d7),o=Ef(t);return i&&!r&&o}function Do(t,e,n={}){const{skipAriaHidden:i}=n;t.classList.toggle("ag-hidden",!e),i||y3(t,!e)}function lue(t,e,n={}){const{skipAriaHidden:i}=n;t.classList.toggle("ag-invisible",!e),i||y3(t,!e)}function oS(t,e){const n="disabled",i=e?r=>r.setAttribute(n,""):r=>r.removeAttribute(n);i(t),g7(t.querySelectorAll("input"),r=>i(r))}function Ax(t,e,n){let i=0;for(;t;){if(t.classList.contains(e))return!0;if(t=t.parentElement,typeof n=="number"){if(++i>n)break}else if(t===n)break}return!1}function N_(t){const{height:e,width:n,borderTopWidth:i,borderRightWidth:r,borderBottomWidth:o,borderLeftWidth:c,paddingTop:s,paddingRight:f,paddingBottom:v,paddingLeft:w,marginTop:C,marginRight:M,marginBottom:F,marginLeft:N,boxSizing:z}=window.getComputedStyle(t);return{height:parseFloat(e||"0"),width:parseFloat(n||"0"),borderTopWidth:parseFloat(i||"0"),borderRightWidth:parseFloat(r||"0"),borderBottomWidth:parseFloat(o||"0"),borderLeftWidth:parseFloat(c||"0"),paddingTop:parseFloat(s||"0"),paddingRight:parseFloat(f||"0"),paddingBottom:parseFloat(v||"0"),paddingLeft:parseFloat(w||"0"),marginTop:parseFloat(C||"0"),marginRight:parseFloat(M||"0"),marginBottom:parseFloat(F||"0"),marginLeft:parseFloat(N||"0"),boxSizing:z}}function C3(t){const e=N_(t);return e.boxSizing==="border-box"?e.height-e.paddingTop-e.paddingBottom:e.height}function VS(t){const e=N_(t);return e.boxSizing==="border-box"?e.width-e.paddingLeft-e.paddingRight:e.width}function f7(t){const{height:e,marginBottom:n,marginTop:i}=N_(t);return Math.floor(e+n+i)}function iT(t){const{width:e,marginLeft:n,marginRight:i}=N_(t);return Math.floor(e+n+i)}function p7(t){const e=t.getBoundingClientRect(),{borderTopWidth:n,borderLeftWidth:i,borderRightWidth:r,borderBottomWidth:o}=N_(t);return{top:e.top+(n||0),left:e.left+(i||0),right:e.right+(r||0),bottom:e.bottom+(o||0)}}function rT(){if(typeof PE=="boolean")return PE;const t=document.createElement("div");return t.style.direction="rtl",t.style.width="1px",t.style.height="1px",t.style.position="fixed",t.style.top="0px",t.style.overflow="hidden",t.dir="rtl",t.innerHTML=`<div style="width: 2px">
            <span style="display: inline-block; width: 1px"></span>
            <span style="display: inline-block; width: 1px"></span>
        </div>`,document.body.appendChild(t),t.scrollLeft=1,PE=Math.floor(t.scrollLeft)===0,document.body.removeChild(t),PE}function sT(t,e){let n=t.scrollLeft;return e&&(n=Math.abs(n),x3()&&!rT()&&(n=t.scrollWidth-t.clientWidth-n)),n}function oT(t,e,n){n&&(rT()?e*=-1:(Qp()||x3())&&(e=t.scrollWidth-t.clientWidth-e)),t.scrollLeft=e}function Cu(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}function w_(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function m7(t){return!!t.offsetParent}function Ef(t){const e=t;return e.checkVisibility?e.checkVisibility({checkVisibilityCSS:!0}):!(!m7(t)||window.getComputedStyle(t).visibility!=="visible")}function iw(t){const e=document.createElement("div");return e.innerHTML=(t||"").trim(),e.firstChild}function cue(t){return t.clientWidth<t.scrollWidth}function uue(t){return t.clientHeight<t.scrollHeight}function aT(t,e){e==="flex"?(t.style.removeProperty("width"),t.style.removeProperty("minWidth"),t.style.removeProperty("maxWidth"),t.style.flex="1 1 auto"):sd(t,e)}function sd(t,e){e=S3(e),t.style.width=e.toString(),t.style.maxWidth=e.toString(),t.style.minWidth=e.toString()}function C1(t,e){e=S3(e),t.style.height=e.toString(),t.style.maxHeight=e.toString(),t.style.minHeight=e.toString()}function S3(t){return typeof t=="number"?`${t}px`:t}function b3(t){return t instanceof Node||t instanceof HTMLElement}function hue(t){if(t==null)return[];const e=[];return g7(t,n=>e.push(n)),e}function due(t,e){if(t)for(let n=0;n<t.length;n++){const i=t[n];e(i.name,i.value)}}function Up(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n.toString())}function g7(t,e){if(t!=null)for(let n=0;n<t.length;n++)e(t[n])}var rw=class{constructor(t=0,e=1){this.nextValue=t,this.step=e}next(){const t=this.nextValue;return this.nextValue+=this.step,t}peek(){return this.nextValue}skip(t){this.nextValue+=t}},fue=1e3,pue=1e3,$5=100,v7=class Ry extends wn{constructor(e,n,i,r){super(),this.parentComp=e,this.tooltipShowDelayOverride=n,this.tooltipHideDelayOverride=i,this.shouldDisplayTooltip=r,this.interactionEnabled=!1,this.isInteractingWithTooltip=!1,this.state=0,this.tooltipInstanceCount=0,this.tooltipMouseTrack=!1}wireBeans(e){this.popupService=e.popupService,this.userComponentFactory=e.userComponentFactory}postConstruct(){this.gos.get("tooltipInteraction")&&(this.interactionEnabled=!0),this.tooltipTrigger=this.getTooltipTrigger(),this.tooltipMouseTrack=this.gos.get("tooltipMouseTrack");const e=this.parentComp.getGui();this.tooltipTrigger===0&&this.addManagedListeners(e,{mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.tooltipTrigger===1&&this.addManagedListeners(e,{focusin:this.onFocusIn.bind(this),focusout:this.onFocusOut.bind(this)}),this.addManagedListeners(e,{mousemove:this.onMouseMove.bind(this)}),this.interactionEnabled||this.addManagedListeners(e,{mousedown:this.onMouseDown.bind(this),keydown:this.onKeyDown.bind(this)})}getGridOptionsTooltipDelay(e){const n=this.gos.get(e);return n<0&&Tn(`${e} should not be lower than 0`),Math.max(200,n)}getTooltipDelay(e){return e==="show"?this.tooltipShowDelayOverride??this.getGridOptionsTooltipDelay("tooltipShowDelay"):this.tooltipHideDelayOverride??this.getGridOptionsTooltipDelay("tooltipHideDelay")}destroy(){this.setToDoNothing(),super.destroy()}getTooltipTrigger(){const e=this.gos.get("tooltipTrigger");return!e||e==="hover"?0:1}onMouseEnter(e){this.interactionEnabled&&this.interactiveTooltipTimeoutId&&(this.unlockService(),this.startHideTimeout()),!wv()&&(Ry.isLocked?this.showTooltipTimeoutId=window.setTimeout(()=>{this.prepareToShowTooltip(e)},$5):this.prepareToShowTooltip(e))}onMouseMove(e){this.lastMouseEvent&&(this.lastMouseEvent=e),this.tooltipMouseTrack&&this.state===2&&this.tooltipComp&&this.positionTooltip()}onMouseDown(){this.setToDoNothing()}onMouseLeave(){this.interactionEnabled?this.lockService():this.setToDoNothing()}onFocusIn(){this.prepareToShowTooltip()}onFocusOut(e){var o;const n=e.relatedTarget,i=this.parentComp.getGui(),r=(o=this.tooltipComp)==null?void 0:o.getGui();this.isInteractingWithTooltip||i.contains(n)||this.interactionEnabled&&(r!=null&&r.contains(n))||this.setToDoNothing()}onKeyDown(){this.setToDoNothing()}prepareToShowTooltip(e){if(this.state!=0||Ry.isLocked)return;let n=0;e&&(n=this.isLastTooltipHiddenRecently()?200:this.getTooltipDelay("show")),this.lastMouseEvent=e||null,this.showTooltipTimeoutId=window.setTimeout(this.showTooltip.bind(this),n),this.state=1}isLastTooltipHiddenRecently(){const e=new Date().getTime(),n=Ry.lastTooltipHideTime;return e-n<fue}setToDoNothing(){this.state===2&&this.hideTooltip(),this.onBodyScrollEventCallback&&(this.onBodyScrollEventCallback(),this.onBodyScrollEventCallback=void 0),this.onColumnMovedEventCallback&&(this.onColumnMovedEventCallback(),this.onColumnMovedEventCallback=void 0),this.clearTimeouts(),this.state=0,this.lastMouseEvent=null}showTooltip(){const e={...this.parentComp.getTooltipParams()};if(!$n(e.value)||this.shouldDisplayTooltip&&!this.shouldDisplayTooltip()){this.setToDoNothing();return}this.state=2,this.tooltipInstanceCount++;const n=this.newTooltipComponentCallback.bind(this,this.tooltipInstanceCount);this.userComponentFactory.getTooltipCompDetails(e).newAgStackInstance().then(n)}hideTooltip(e){if(!e&&this.isInteractingWithTooltip)return;this.tooltipComp&&(this.destroyTooltipComp(),Ry.lastTooltipHideTime=new Date().getTime());const n={type:"tooltipHide",parentGui:this.parentComp.getGui()};this.eventService.dispatchEvent(n),e&&(this.isInteractingWithTooltip=!1),this.state=0}newTooltipComponentCallback(e,n){if(this.state!==2||this.tooltipInstanceCount!==e){this.destroyBean(n);return}const r=n.getGui();this.tooltipComp=n,r.classList.contains("ag-tooltip")||r.classList.add("ag-tooltip-custom"),this.tooltipTrigger===0&&r.classList.add("ag-tooltip-animate"),this.interactionEnabled&&r.classList.add("ag-tooltip-interactive");const o=this.localeService.getLocaleTextFunc(),c=this.popupService.addPopup({eChild:r,ariaLabel:o("ariaLabelTooltip","Tooltip")});if(c&&(this.tooltipPopupDestroyFunc=c.hideFunc),this.positionTooltip(),this.tooltipTrigger===1){const f=this.setToDoNothing.bind(this);[this.onBodyScrollEventCallback,this.onColumnMovedEventCallback]=this.addManagedEventListeners({bodyScroll:f,columnMoved:f})}this.interactionEnabled&&(this.tooltipTrigger===0?[this.tooltipMouseEnterListener,this.tooltipMouseLeaveListener]=this.addManagedElementListeners(r,{mouseenter:this.onTooltipMouseEnter.bind(this),mouseleave:this.onTooltipMouseLeave.bind(this)}):[this.tooltipFocusInListener,this.tooltipFocusOutListener]=this.addManagedElementListeners(r,{focusin:this.onTooltipFocusIn.bind(this),focusout:this.onTooltipFocusOut.bind(this)}));const s={type:"tooltipShow",tooltipGui:r,parentGui:this.parentComp.getGui()};this.eventService.dispatchEvent(s),this.startHideTimeout()}onTooltipMouseEnter(){this.isInteractingWithTooltip=!0,this.unlockService()}onTooltipMouseLeave(){this.isInteractingWithTooltip=!1,this.lockService()}onTooltipFocusIn(){this.isInteractingWithTooltip=!0}onTooltipFocusOut(e){var o;const n=this.parentComp.getGui(),i=(o=this.tooltipComp)==null?void 0:o.getGui(),r=e.relatedTarget;i!=null&&i.contains(r)||(this.isInteractingWithTooltip=!1,n.contains(r)?this.startHideTimeout():this.hideTooltip())}positionTooltip(){const e={type:"tooltip",ePopup:this.tooltipComp.getGui(),nudgeY:18,skipObserver:this.tooltipMouseTrack};this.lastMouseEvent?this.popupService.positionPopupUnderMouseEvent({...e,mouseEvent:this.lastMouseEvent}):this.popupService.positionPopupByComponent({...e,eventSource:this.parentComp.getGui(),position:"under",keepWithinBounds:!0,nudgeY:5})}destroyTooltipComp(){this.tooltipComp.getGui().classList.add("ag-tooltip-hiding");const e=this.tooltipPopupDestroyFunc,n=this.tooltipComp,i=this.tooltipTrigger===0?pue:0;window.setTimeout(()=>{e(),this.destroyBean(n)},i),this.clearTooltipListeners(),this.tooltipPopupDestroyFunc=void 0,this.tooltipComp=void 0}clearTooltipListeners(){[this.tooltipMouseEnterListener,this.tooltipMouseLeaveListener,this.tooltipFocusInListener,this.tooltipFocusOutListener].forEach(e=>{e&&e()}),this.tooltipMouseEnterListener=this.tooltipMouseLeaveListener=this.tooltipFocusInListener=this.tooltipFocusOutListener=null}lockService(){Ry.isLocked=!0,this.interactiveTooltipTimeoutId=window.setTimeout(()=>{this.unlockService(),this.setToDoNothing()},$5)}unlockService(){Ry.isLocked=!1,this.clearInteractiveTimeout()}startHideTimeout(){this.clearHideTimeout(),this.hideTooltipTimeoutId=window.setTimeout(this.hideTooltip.bind(this),this.getTooltipDelay("hide"))}clearShowTimeout(){this.showTooltipTimeoutId&&(window.clearTimeout(this.showTooltipTimeoutId),this.showTooltipTimeoutId=void 0)}clearHideTimeout(){this.hideTooltipTimeoutId&&(window.clearTimeout(this.hideTooltipTimeoutId),this.hideTooltipTimeoutId=void 0)}clearInteractiveTimeout(){this.interactiveTooltipTimeoutId&&(window.clearTimeout(this.interactiveTooltipTimeoutId),this.interactiveTooltipTimeoutId=void 0)}clearTimeouts(){this.clearShowTimeout(),this.clearHideTimeout(),this.clearInteractiveTimeout()}};v7.isLocked=!1;var mue=v7,Sw=class extends wn{constructor(t,e){super(),this.ctrl=t,e&&(this.beans=e)}wireBeans(t){this.beans=t}postConstruct(){this.refreshToolTip()}setBrowserTooltip(t){const e="title",n=this.ctrl.getGui();n&&(t!=null&&t!=""?n.setAttribute(e,t):n.removeAttribute(e))}updateTooltipText(){this.tooltip=this.ctrl.getTooltipValue()}createTooltipFeatureIfNeeded(){var e,n,i,r;if(this.tooltipManager!=null)return;const t={getTooltipParams:()=>this.getTooltipParams(),getGui:()=>this.ctrl.getGui()};this.tooltipManager=this.createBean(new mue(t,(n=(e=this.ctrl).getTooltipShowDelayOverride)==null?void 0:n.call(e),(r=(i=this.ctrl).getTooltipHideDelayOverride)==null?void 0:r.call(i),this.ctrl.shouldDisplayTooltip),this.beans.context)}refreshToolTip(){this.browserTooltips=this.beans.gos.get("enableBrowserTooltips"),this.updateTooltipText(),this.browserTooltips?(this.setBrowserTooltip(this.tooltip),this.tooltipManager&&(this.tooltipManager=this.destroyBean(this.tooltipManager,this.beans.context))):(this.setBrowserTooltip(null),this.createTooltipFeatureIfNeeded())}getTooltipParams(){const t=this.ctrl,e=t.getColumn?t.getColumn():void 0,n=t.getColDef?t.getColDef():void 0,i=t.getRowNode?t.getRowNode():void 0;return{location:t.getLocation(),colDef:n,column:e,rowIndex:t.getRowIndex?t.getRowIndex():void 0,node:i,data:i?i.data:void 0,value:this.getTooltipText(),valueFormatted:t.getValueFormatted?t.getValueFormatted():void 0,hideTooltipCallback:()=>{var r;return(r=this.tooltipManager)==null?void 0:r.hideTooltip(!0)}}}getTooltipText(){return this.tooltip}destroy(){this.tooltipManager&&(this.tooltipManager=this.destroyBean(this.tooltipManager,this.beans.context)),super.destroy()}},gue=new rw,qi=null,Js=class y7 extends wn{constructor(e,n){super(),this.suppressDataRefValidation=!1,this.displayed=!0,this.visible=!0,this.compId=gue.next(),this.cssClassManager=new US(()=>this.eGui),this.componentSelectors=new Map((n??[]).map(i=>[i.selector,i])),e&&this.setTemplate(e)}preWireBeans(e){super.preWireBeans(e)}preConstruct(){this.usingBrowserTooltips=this.gos.get("enableBrowserTooltips"),this.wireTemplate(this.getGui())}wireTemplate(e,n){e&&this.gos&&(this.applyElementsToComponent(e),this.createChildComponentsFromTags(e,n))}getCompId(){return this.compId}getTooltipParams(){return{value:this.tooltipText,location:"UNKNOWN"}}setTooltip(e){const{newTooltipText:n,showDelayOverride:i,hideDelayOverride:r,location:o,shouldDisplayTooltip:c}=e||{};this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),this.tooltipText!==n&&(this.tooltipText=n);const s=()=>this.tooltipText;n!=null&&(this.tooltipFeature=this.createBean(new Sw({getTooltipValue:s,getGui:()=>this.getGui(),getLocation:()=>o??"UNKNOWN",getColDef:e==null?void 0:e.getColDef,getColumn:e==null?void 0:e.getColumn,getTooltipShowDelayOverride:i!=null?()=>i:void 0,getTooltipHideDelayOverride:r!=null?()=>r:void 0,shouldDisplayTooltip:c})))}getDataRefAttribute(e){return e.getAttribute?e.getAttribute("data-ref"):null}applyElementsToComponent(e,n,i,r=null){if(n===void 0&&(n=this.getDataRefAttribute(e)),n){const o=this[n];if(o===qi)this[n]=r??e;else{const c=i&&i[n];!this.suppressDataRefValidation&&!c&&Tn(`Issue with data-ref: ${n} on ${this.constructor.name} with ${o}`)}}}createChildComponentsFromTags(e,n){hue(e.childNodes).forEach(r=>{if(!(r instanceof HTMLElement))return;const o=this.createComponentFromElement(r,c=>{c.getGui()&&this.copyAttributesFromNode(r,c.getGui())},n);if(o){if(o.addItems&&r.children.length){this.createChildComponentsFromTags(r,n);const c=Array.prototype.slice.call(r.children);o.addItems(c)}this.swapComponentForNode(o,e,r)}else r.childNodes&&this.createChildComponentsFromTags(r,n)})}createComponentFromElement(e,n,i){const r=e.nodeName,o=this.getDataRefAttribute(e),c=r.indexOf("AG-")===0,s=c?this.componentSelectors.get(r):null;let f=null;if(s){y7.elementGettingCreated=e;const v=i&&o?i[o]:void 0;f=new s.component(v),f.setParentComponent(this),this.createBean(f,null,n)}else c&&Tn(`Missing selector: ${r}`);return this.applyElementsToComponent(e,o,i,f),f}copyAttributesFromNode(e,n){due(e.attributes,(i,r)=>n.setAttribute(i,r))}swapComponentForNode(e,n,i){const r=e.getGui();n.replaceChild(r,i),n.insertBefore(document.createComment(i.nodeName),r),this.addDestroyFunc(this.destroyBean.bind(this,e))}activateTabIndex(e){const n=this.gos.get("tabIndex");e||(e=[]),e.length||e.push(this.getGui()),e.forEach(i=>i.setAttribute("tabindex",n.toString()))}setTemplate(e,n,i){const r=iw(e);this.setTemplateFromElement(r,n,i)}setTemplateFromElement(e,n,i,r=!1){if(this.eGui=e,this.suppressDataRefValidation=r,n)for(let o=0;o<n.length;o++){const c=n[o];this.componentSelectors.set(c.selector,c)}this.wireTemplate(e,i)}getGui(){return this.eGui}getFocusableElement(){return this.eGui}getAriaElement(){return this.getFocusableElement()}setParentComponent(e){this.parentComponent=e}getParentComponent(){return this.parentComponent}setGui(e){this.eGui=e}queryForHtmlElement(e){return this.eGui.querySelector(e)}getContainerAndElement(e,n){let i=n;return e==null?null:(i||(i=this.eGui),b3(e)?{element:e,parent:i}:{element:e.getGui(),parent:i})}prependChild(e,n){const{element:i,parent:r}=this.getContainerAndElement(e,n)||{};!i||!r||r.insertAdjacentElement("afterbegin",i)}appendChild(e,n){const{element:i,parent:r}=this.getContainerAndElement(e,n)||{};!i||!r||r.appendChild(i)}isDisplayed(){return this.displayed}setVisible(e,n={}){if(e!==this.visible){this.visible=e;const{skipAriaHidden:i}=n;lue(this.eGui,e,{skipAriaHidden:i})}}setDisplayed(e,n={}){if(e!==this.displayed){this.displayed=e;const{skipAriaHidden:i}=n;Do(this.eGui,e,{skipAriaHidden:i});const r={type:"displayChanged",visible:this.displayed};this.dispatchLocalEvent(r)}}destroy(){this.parentComponent&&(this.parentComponent=void 0),this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),super.destroy()}addGuiEventListener(e,n,i){this.eGui.addEventListener(e,n,i),this.addDestroyFunc(()=>this.eGui.removeEventListener(e,n))}addCssClass(e){this.cssClassManager.addCssClass(e)}removeCssClass(e){this.cssClassManager.removeCssClass(e)}containsCssClass(e){return this.cssClassManager.containsCssClass(e)}addOrRemoveCssClass(e,n){this.cssClassManager.addOrRemoveCssClass(e,n)}},vue={columnGroupOpened:"expanded",columnGroupClosed:"contracted",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate",columnMovePin:"pin",columnMoveHide:"eye-slash",columnMoveMove:"arrows",columnMoveLeft:"left",columnMoveRight:"right",columnMoveGroup:"group",columnMoveValue:"aggregation",columnMovePivot:"pivot",dropNotAllowed:"not-allowed",groupContracted:"tree-closed",groupExpanded:"tree-open",setFilterGroupClosed:"tree-closed",setFilterGroupOpen:"tree-open",setFilterGroupIndeterminate:"tree-indeterminate",chart:"chart",close:"cross",cancel:"cancel",check:"tick",first:"first",previous:"previous",next:"next",last:"last",linked:"linked",unlinked:"unlinked",colorPicker:"color-picker",groupLoading:"loading",menu:"menu",menuAlt:"menu-alt",filter:"filter",columns:"columns",maximize:"maximize",minimize:"minimize",menuPin:"pin",menuValue:"aggregation",menuAddRowGroup:"group",menuRemoveRowGroup:"group",clipboardCopy:"copy",clipboardCut:"cut",clipboardPaste:"paste",pivotPanel:"pivot",rowGroupPanel:"group",valuePanel:"aggregation",columnDrag:"grip",rowDrag:"grip",save:"save",csvExport:"csv",excelExport:"excel",smallDown:"small-down",smallLeft:"small-left",smallRight:"small-right",smallUp:"small-up",sortAscending:"asc",sortDescending:"desc",sortUnSort:"none",advancedFilterBuilder:"group",advancedFilterBuilderDrag:"grip",advancedFilterBuilderInvalid:"not-allowed",advancedFilterBuilderMoveUp:"up",advancedFilterBuilderMoveDown:"down",advancedFilterBuilderAdd:"plus",advancedFilterBuilderRemove:"minus",chartsMenuEdit:"chart",chartsMenuAdvancedSettings:"settings",chartsMenuAdd:"plus",checkboxChecked:"checkbox-checked",checkboxIndeterminate:"checkbox-indeterminate",checkboxUnchecked:"checkbox-unchecked",radioButtonOn:"radio-button-on",radioButtonOff:"radio-button-off"};function _p(t,e,n){const i=gu(t,e,n);if(i){const{className:o}=i;if(typeof o=="string"&&o.indexOf("ag-icon")>-1||typeof o=="object"&&o["ag-icon"])return i}const r=document.createElement("span");return r.appendChild(i),r}function gu(t,e,n,i){let r=null;const o=n&&n.getColDef().icons;if(o&&(r=o[t]),e&&!r){const c=e.get("icons");c&&(r=c[t])}if(r){let c;if(typeof r=="function")c=r();else if(typeof r=="string")c=r;else throw new Error("icon from grid options needs to be a string or a function");if(typeof c=="string")return iw(c);if(b3(c))return c;Tn("iconRenderer should return back a string or a dom object")}else{const c=document.createElement("span");let s=vue[t];return s||(Tn(`Did not find icon ${t}`),s=""),c.setAttribute("class",`ag-icon ag-icon-${s}`),c.setAttribute("unselectable","on"),ld(c,"presentation"),c}}function _7(t,e,n){if(n===0)return!1;const i=Math.abs(t.clientX-e.clientX),r=Math.abs(t.clientY-e.clientY);return Math.max(i,r)<=n}var Jg=class{constructor(t,e=!1){this.DOUBLE_TAP_MILLIS=500,this.destroyFuncs=[],this.touching=!1,this.localEventService=new Cw,this.eElement=t,this.preventMouseClick=e;const n=this.onTouchStart.bind(this),i=this.onTouchMove.bind(this),r=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",n,{passive:!0}),this.eElement.addEventListener("touchmove",i,{passive:!0}),this.eElement.addEventListener("touchend",r,{passive:!1}),this.destroyFuncs.push(()=>{this.eElement.removeEventListener("touchstart",n,{passive:!0}),this.eElement.removeEventListener("touchmove",i,{passive:!0}),this.eElement.removeEventListener("touchend",r,{passive:!1})})}getActiveTouch(t){for(let e=0;e<t.length;e++)if(t[e].identifier===this.touchStart.identifier)return t[e];return null}addEventListener(t,e){this.localEventService.addEventListener(t,e)}removeEventListener(t,e){this.localEventService.removeEventListener(t,e)}onTouchStart(t){if(this.touching)return;this.touchStart=t.touches[0],this.touching=!0,this.moved=!1;const e=this.touchStart;window.setTimeout(()=>{const n=this.touchStart===e;if(this.touching&&n&&!this.moved){this.moved=!0;const i={type:"longTap",touchStart:this.touchStart,touchEvent:t};this.localEventService.dispatchEvent(i)}},500)}onTouchMove(t){if(!this.touching)return;const e=this.getActiveTouch(t.touches);if(!e)return;!_7(e,this.touchStart,4)&&(this.moved=!0)}onTouchEnd(t){if(this.touching){if(!this.moved){const e={type:"tap",touchStart:this.touchStart};this.localEventService.dispatchEvent(e),this.checkForDoubleTap()}this.preventMouseClick&&t.cancelable&&t.preventDefault(),this.touching=!1}}checkForDoubleTap(){const t=new Date().getTime();if(this.lastTapTime&&this.lastTapTime>0)if(t-this.lastTapTime>this.DOUBLE_TAP_MILLIS){const n={type:"doubleTap",touchStart:this.touchStart};this.localEventService.dispatchEvent(n),this.lastTapTime=null}else this.lastTapTime=t;else this.lastTapTime=t}destroy(){this.destroyFuncs.forEach(t=>t())}},yue=`<span class="ag-sort-indicator-container">
        <span data-ref="eSortOrder" class="ag-sort-indicator-icon ag-sort-order ag-hidden" aria-hidden="true"></span>
        <span data-ref="eSortAsc" class="ag-sort-indicator-icon ag-sort-ascending-icon ag-hidden" aria-hidden="true"></span>
        <span data-ref="eSortDesc" class="ag-sort-indicator-icon ag-sort-descending-icon ag-hidden" aria-hidden="true"></span>
        <span data-ref="eSortMixed" class="ag-sort-indicator-icon ag-sort-mixed-icon ag-hidden" aria-hidden="true"></span>
        <span data-ref="eSortNone" class="ag-sort-indicator-icon ag-sort-none-icon ag-hidden" aria-hidden="true"></span>
    </span>`,E3=class extends Js{constructor(t){super(),this.eSortOrder=qi,this.eSortAsc=qi,this.eSortDesc=qi,this.eSortMixed=qi,this.eSortNone=qi,t||this.setTemplate(yue)}wireBeans(t){this.sortController=t.sortController}attachCustomElements(t,e,n,i,r){this.eSortOrder=t,this.eSortAsc=e,this.eSortDesc=n,this.eSortMixed=i,this.eSortNone=r}setupSort(t,e=!1){this.column=t,this.suppressOrder=e,this.setupMultiSortIndicator(),!(!this.column.isSortable()&&!this.column.getColDef().showRowGroup)&&(this.addInIcon("sortAscending",this.eSortAsc,t),this.addInIcon("sortDescending",this.eSortDesc,t),this.addInIcon("sortUnSort",this.eSortNone,t),this.addManagedPropertyListener("unSortIcon",()=>this.updateIcons()),this.addManagedEventListeners({newColumnsLoaded:this.updateIcons.bind(this),sortChanged:this.onSortChanged.bind(this),columnRowGroupChanged:this.onSortChanged.bind(this)}),this.onSortChanged())}addInIcon(t,e,n){if(e==null)return;const i=gu(t,this.gos,n);i&&e.appendChild(i)}onSortChanged(){this.updateIcons(),this.suppressOrder||this.updateSortOrder()}updateIcons(){const t=this.sortController.getDisplaySortForColumn(this.column);if(this.eSortAsc){const e=t==="asc";Do(this.eSortAsc,e,{skipAriaHidden:!0})}if(this.eSortDesc){const e=t==="desc";Do(this.eSortDesc,e,{skipAriaHidden:!0})}if(this.eSortNone){const e=!this.column.getColDef().unSortIcon&&!this.gos.get("unSortIcon"),n=t==null;Do(this.eSortNone,!e&&n,{skipAriaHidden:!0})}}setupMultiSortIndicator(){this.addInIcon("sortUnSort",this.eSortMixed,this.column);const t=this.column.getColDef().showRowGroup;this.gos.isColumnsSortingCoupledToGroup()&&t&&(this.addManagedEventListeners({sortChanged:this.updateMultiSortIndicator.bind(this),columnRowGroupChanged:this.updateMultiSortIndicator.bind(this)}),this.updateMultiSortIndicator())}updateMultiSortIndicator(){if(this.eSortMixed){const t=this.sortController.getDisplaySortForColumn(this.column)==="mixed";Do(this.eSortMixed,t,{skipAriaHidden:!0})}}updateSortOrder(){if(!this.eSortOrder)return;const t=this.sortController.getColumnsWithSortingOrdered(),e=this.sortController.getDisplaySortIndexForColumn(this.column)??-1,n=t.some(r=>this.sortController.getDisplaySortIndexForColumn(r)??!1),i=e>=0&&n;Do(this.eSortOrder,i,{skipAriaHidden:!0}),e>=0?this.eSortOrder.textContent=(e+1).toString():Cu(this.eSortOrder)}},_ue={selector:"AG-SORT-INDICATOR",component:E3},xue=`<div class="ag-cell-label-container" role="presentation">
        <span data-ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>
        <span data-ref="eFilterButton" class="ag-header-icon ag-header-cell-filter-button" aria-hidden="true"></span>
        <div data-ref="eLabel" class="ag-header-cell-label" role="presentation">
            <span data-ref="eText" class="ag-header-cell-text"></span>
            <span data-ref="eFilter" class="ag-header-icon ag-header-label-icon ag-filter-icon" aria-hidden="true"></span>
            <ag-sort-indicator data-ref="eSortIndicator"></ag-sort-indicator>
        </div>
    </div>`,RL=class extends Js{constructor(){super(...arguments),this.eFilter=qi,this.eFilterButton=qi,this.eSortIndicator=qi,this.eMenu=qi,this.eLabel=qi,this.eText=qi,this.eSortOrder=qi,this.eSortAsc=qi,this.eSortDesc=qi,this.eSortMixed=qi,this.eSortNone=qi,this.lastMovingChanged=0}wireBeans(t){this.sortController=t.sortController,this.menuService=t.menuService,this.funcColsService=t.funcColsService}destroy(){super.destroy()}refresh(t){const e=this.params;return this.params=t,this.workOutTemplate()!=this.currentTemplate||this.workOutShowMenu()!=this.currentShowMenu||this.workOutSort()!=this.currentSort||this.shouldSuppressMenuHide()!=this.currentSuppressMenuHide||e.enableFilterButton!=t.enableFilterButton||e.enableFilterIcon!=t.enableFilterIcon?!1:(this.setDisplayName(t),!0)}workOutTemplate(){let t=this.params.template??xue;return t=t&&t.trim?t.trim():t,t}init(t){this.params=t,this.currentTemplate=this.workOutTemplate(),this.setTemplate(this.currentTemplate,[_ue]),this.setupTap(),this.setMenu(),this.setupSort(),this.setupFilterIcon(),this.setupFilterButton(),this.setDisplayName(t)}setDisplayName(t){if(this.currentDisplayName!=t.displayName){this.currentDisplayName=t.displayName;const e=wf(this.currentDisplayName,!0);this.eText&&(this.eText.textContent=e)}}addInIcon(t,e,n){if(e==null)return;const i=gu(t,this.gos,n);i&&e.appendChild(i)}setupTap(){const{gos:t}=this;if(t.get("suppressTouch"))return;const e=new Jg(this.getGui(),!0),n=this.shouldSuppressMenuHide(),i=n&&$n(this.eMenu),r=i?new Jg(this.eMenu,!0):e;if(this.params.enableMenu){const o=i?"tap":"longTap",c=s=>this.params.showColumnMenuAfterMouseClick(s.touchStart);this.addManagedListeners(r,{[o]:c})}if(this.params.enableSorting){const o=c=>{var f,v;const s=c.touchStart.target;n&&((f=this.eMenu)!=null&&f.contains(s)||(v=this.eFilterButton)!=null&&v.contains(s))||this.sortController.progressSort(this.params.column,!1,"uiColumnSorted")};this.addManagedListeners(e,{tap:o})}if(this.params.enableFilterButton){const o=new Jg(this.eFilterButton,!0);this.addManagedListeners(o,{tap:()=>this.params.showFilter(this.eFilterButton)}),this.addDestroyFunc(()=>o.destroy())}this.addDestroyFunc(()=>e.destroy()),i&&this.addDestroyFunc(()=>r.destroy())}workOutShowMenu(){return this.params.enableMenu&&this.menuService.isHeaderMenuButtonEnabled()}shouldSuppressMenuHide(){return this.menuService.isHeaderMenuButtonAlwaysShowEnabled()}setMenu(){if(!this.eMenu)return;if(this.currentShowMenu=this.workOutShowMenu(),!this.currentShowMenu){w_(this.eMenu),this.eMenu=void 0;return}const t=this.menuService.isLegacyMenuEnabled();this.addInIcon(t?"menu":"menuAlt",this.eMenu,this.params.column),this.eMenu.classList.toggle("ag-header-menu-icon",!t),this.currentSuppressMenuHide=this.shouldSuppressMenuHide(),this.addManagedElementListeners(this.eMenu,{click:()=>this.params.showColumnMenu(this.eMenu)}),this.eMenu.classList.toggle("ag-header-menu-always-show",this.currentSuppressMenuHide)}onMenuKeyboardShortcut(t){const e=this.params.column,n=this.menuService.isLegacyMenuEnabled();if(t&&!n){if(this.menuService.isFilterMenuInHeaderEnabled(e))return this.params.showFilter(this.eFilterButton??this.eMenu??this.getGui()),!0}else if(this.params.enableMenu)return this.params.showColumnMenu(this.eMenu??this.eFilterButton??this.getGui()),!0;return!1}workOutSort(){return this.params.enableSorting}setupSort(){if(this.currentSort=this.params.enableSorting,this.eSortIndicator||(this.eSortIndicator=this.createBean(new E3(!0)),this.eSortIndicator.attachCustomElements(this.eSortOrder,this.eSortAsc,this.eSortDesc,this.eSortMixed,this.eSortNone)),this.eSortIndicator.setupSort(this.params.column),!this.currentSort)return;this.addManagedListeners(this.params.column,{movingChanged:()=>{this.lastMovingChanged=new Date().getTime()}}),this.eLabel&&this.addManagedElementListeners(this.eLabel,{click:e=>{const n=this.params.column.isMoving(),r=new Date().getTime()-this.lastMovingChanged<50;if(!(n||r)){const s=this.gos.get("multiSortKey")==="ctrl"?e.ctrlKey||e.metaKey:e.shiftKey;this.params.progressSort(s)}}});const t=()=>{const e=this.params.column.getSort();if(this.addOrRemoveCssClass("ag-header-cell-sorted-asc",e==="asc"),this.addOrRemoveCssClass("ag-header-cell-sorted-desc",e==="desc"),this.addOrRemoveCssClass("ag-header-cell-sorted-none",!e),this.params.column.getColDef().showRowGroup){const n=this.funcColsService.getSourceColumnsForGroupColumn(this.params.column),r=!(n==null?void 0:n.every(o=>this.params.column.getSort()==o.getSort()));this.addOrRemoveCssClass("ag-header-cell-sorted-mixed",r)}};this.addManagedEventListeners({sortChanged:t,columnRowGroupChanged:t})}setupFilterIcon(){this.eFilter&&this.configureFilter(this.params.enableFilterIcon,this.eFilter,this.onFilterChangedIcon.bind(this))}setupFilterButton(){if(!this.eFilterButton)return;this.configureFilter(this.params.enableFilterButton,this.eFilterButton,this.onFilterChangedButton.bind(this))?this.addManagedElementListeners(this.eFilterButton,{click:()=>this.params.showFilter(this.eFilterButton)}):this.eFilterButton=void 0}configureFilter(t,e,n){if(!t)return w_(e),!1;const i=this.params.column;return this.addInIcon("filter",e,i),this.addManagedListeners(i,{filterChanged:n}),n(),!0}onFilterChangedIcon(){const t=this.params.column.isFilterActive();Do(this.eFilter,t,{skipAriaHidden:!0})}onFilterChangedButton(){const t=this.params.column.isFilterActive();this.eFilterButton.classList.toggle("ag-filter-active",t)}getAnchorElementForMenu(t){return t?this.eFilterButton??this.eMenu??this.getGui():this.eMenu??this.eFilterButton??this.getGui()}},wue=class extends Js{constructor(){super(`<div class="ag-header-group-cell-label" role="presentation">
            <span data-ref="agLabel" class="ag-header-group-text" role="presentation"></span>
            <span data-ref="agOpened" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-expanded"></span>
            <span data-ref="agClosed" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-collapsed"></span>
        </div>`),this.agOpened=qi,this.agClosed=qi,this.agLabel=qi}wireBeans(t){this.columnModel=t.columnModel}destroy(){super.destroy()}init(t){this.params=t,this.checkWarnings(),this.setupLabel(),this.addGroupExpandIcon(),this.setupExpandIcons()}checkWarnings(){this.params.template&&Tn("A template was provided for Header Group Comp - templates are only supported for Header Comps (not groups)")}setupExpandIcons(){this.addInIcon("columnGroupOpened",this.agOpened),this.addInIcon("columnGroupClosed",this.agClosed);const t=r=>{if(Yg(r))return;const o=!this.params.columnGroup.isExpanded();this.columnModel.setColumnGroupOpened(this.params.columnGroup.getProvidedColumnGroup(),o,"uiColumnExpanded")};this.addTouchAndClickListeners(this.agClosed,t),this.addTouchAndClickListeners(this.agOpened,t);const e=r=>{tw(r)};this.addManagedElementListeners(this.agClosed,{dblclick:e}),this.addManagedElementListeners(this.agOpened,{dblclick:e}),this.addManagedElementListeners(this.getGui(),{dblclick:t}),this.updateIconVisibility();const n=this.params.columnGroup.getProvidedColumnGroup(),i=this.updateIconVisibility.bind(this);this.addManagedListeners(n,{expandedChanged:i,expandableChanged:i})}addTouchAndClickListeners(t,e){const n=new Jg(t,!0);this.addManagedListeners(n,{tap:e}),this.addDestroyFunc(()=>n.destroy()),this.addManagedElementListeners(t,{click:e})}updateIconVisibility(){if(this.params.columnGroup.isExpandable()){const e=this.params.columnGroup.isExpanded();Do(this.agOpened,e),Do(this.agClosed,!e)}else Do(this.agOpened,!1),Do(this.agClosed,!1)}addInIcon(t,e){const n=gu(t,this.gos,null);n&&e.appendChild(n)}addGroupExpandIcon(){if(!this.params.columnGroup.isExpandable()){Do(this.agOpened,!1),Do(this.agClosed,!1);return}}setupLabel(){var n;const{displayName:t,columnGroup:e}=this.params;if($n(t)){const i=wf(t,!0);this.agLabel.textContent=i}this.addOrRemoveCssClass("ag-sticky-label",!((n=e.getColGroupDef())!=null&&n.suppressStickyLabel))}},x7=(t=>(t.CommunityCoreModule="@ag-grid-community/core",t.InfiniteRowModelModule="@ag-grid-community/infinite-row-model",t.ClientSideRowModelModule="@ag-grid-community/client-side-row-model",t.CsvExportModule="@ag-grid-community/csv-export",t.EnterpriseCoreModule="@ag-grid-enterprise/core",t.RowGroupingModule="@ag-grid-enterprise/row-grouping",t.ColumnsToolPanelModule="@ag-grid-enterprise/column-tool-panel",t.FiltersToolPanelModule="@ag-grid-enterprise/filter-tool-panel",t.MenuModule="@ag-grid-enterprise/menu",t.SetFilterModule="@ag-grid-enterprise/set-filter",t.MultiFilterModule="@ag-grid-enterprise/multi-filter",t.StatusBarModule="@ag-grid-enterprise/status-bar",t.SideBarModule="@ag-grid-enterprise/side-bar",t.RangeSelectionModule="@ag-grid-enterprise/range-selection",t.MasterDetailModule="@ag-grid-enterprise/master-detail",t.RichSelectModule="@ag-grid-enterprise/rich-select",t.GridChartsModule="@ag-grid-enterprise/charts",t.ViewportRowModelModule="@ag-grid-enterprise/viewport-row-model",t.ServerSideRowModelModule="@ag-grid-enterprise/server-side-row-model",t.ExcelExportModule="@ag-grid-enterprise/excel-export",t.ClipboardModule="@ag-grid-enterprise/clipboard",t.SparklinesModule="@ag-grid-enterprise/sparklines",t.AdvancedFilterModule="@ag-grid-enterprise/advanced-filter",t.AngularModule="@ag-grid-community/angular",t.ReactModule="@ag-grid-community/react",t.VueModule="@ag-grid-community/vue",t))(x7||{}),IA=class Ts{static register(e){Ts.__register(e,!0,void 0)}static registerModules(e){Ts.__registerModules(e,!0,void 0)}static __register(e,n,i){Ts.runVersionChecks(e),i!==void 0?(Ts.areGridScopedModules=!0,Ts.gridModulesMap[i]===void 0&&(Ts.gridModulesMap[i]={}),Ts.gridModulesMap[i][e.moduleName]=e):Ts.globalModulesMap[e.moduleName]=e,Ts.setModuleBased(n)}static __unRegisterGridModules(e){delete Ts.gridModulesMap[e]}static __registerModules(e,n,i){Ts.setModuleBased(n),e&&e.forEach(r=>Ts.__register(r,n,i))}static isValidModuleVersion(e){const[n,i]=e.version.split(".")||[],[r,o]=Ts.currentModuleVersion.split(".")||[];return n===r&&i===o}static runVersionChecks(e){Ts.currentModuleVersion||(Ts.currentModuleVersion=e.version);const n=i=>`You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. ${i} Please update all modules to the same version.`;if(e.version?Ts.isValidModuleVersion(e)||_s(n(`'${e.moduleName}' is version ${e.version} but the other modules are version ${Ts.currentModuleVersion}.`)):_s(n(`'${e.moduleName}' is incompatible.`)),e.validate){const i=e.validate();i.isValid||_s(`${i.message}`)}}static setModuleBased(e){Ts.moduleBased===void 0?Ts.moduleBased=e:Ts.moduleBased!==e&&(_s("AG Grid: You are mixing modules (i.e. @ag-grid-community/core) and packages (ag-grid-community) - you can only use one or the other of these mechanisms."),_s("Please see https://www.ag-grid.com/javascript-grid/modules/ for more information."))}static __setIsBundled(){Ts.isBundled=!0}static __assertRegistered(e,n,i){var o;if(this.__isRegistered(e,i))return!0;let r;if(Ts.isBundled)r=`AG Grid: unable to use ${n} as 'ag-grid-enterprise' has not been loaded. Check you are using the Enterprise bundle:
        
        <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@AG_GRID_VERSION/dist/ag-grid-enterprise.min.js"><\/script>
        
For more info see: https://ag-grid.com/javascript-data-grid/getting-started/#getting-started-with-ag-grid-enterprise`;else if(Ts.moduleBased||Ts.moduleBased===void 0){const c=(o=Object.entries(x7).find(([s,f])=>f===e))==null?void 0:o[0];r=`AG Grid: unable to use ${n} as the ${c} is not registered${Ts.areGridScopedModules?` for gridId: ${i}`:""}. Check if you have registered the module:
           
    import { ModuleRegistry } from '@ag-grid-community/core';
    import { ${c} } from '${e}';
    
    ModuleRegistry.registerModules([ ${c} ]);

For more info see: https://www.ag-grid.com/javascript-grid/modules/`}else r=`AG Grid: unable to use ${n} as package 'ag-grid-enterprise' has not been imported. Check that you have imported the package:
            
    import 'ag-grid-enterprise';`;return _s(r),!1}static __isRegistered(e,n){var i;return!!Ts.globalModulesMap[e]||!!((i=Ts.gridModulesMap[n])!=null&&i[e])}static __getRegisteredModules(e){return[...sR(Ts.globalModulesMap),...sR(Ts.gridModulesMap[e]||{})]}static __getGridRegisteredModules(e){return sR(Ts.gridModulesMap[e]??{})||[]}static __isPackageBased(){return!Ts.moduleBased}};IA.globalModulesMap={};IA.gridModulesMap={};IA.areGridScopedModules=!1;var xl=IA,Cue="↑",Sue="↓",bue=class extends Js{constructor(){super(),this.refreshCount=0;const t=document.createElement("span"),e=document.createElement("span");e.setAttribute("class","ag-value-change-delta");const n=document.createElement("span");n.setAttribute("class","ag-value-change-value"),t.appendChild(e),t.appendChild(n),this.setTemplateFromElement(t)}wireBeans(t){this.filterManager=t.filterManager}init(t){this.eValue=this.queryForHtmlElement(".ag-value-change-value"),this.eDelta=this.queryForHtmlElement(".ag-value-change-delta"),this.refresh(t,!0)}showDelta(t,e){const n=Math.abs(e),i=t.formatValue(n),r=$n(i)?i:n,o=e>=0;o?this.eDelta.textContent=Cue+r:this.eDelta.textContent=Sue+r,this.eDelta.classList.toggle("ag-value-change-delta-up",o),this.eDelta.classList.toggle("ag-value-change-delta-down",!o)}setTimerToRemoveDelta(){this.refreshCount++;const t=this.refreshCount;this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>{t===this.refreshCount&&this.hideDeltaValue()},2e3)})}hideDeltaValue(){this.eValue.classList.remove("ag-value-change-value-highlight"),Cu(this.eDelta)}refresh(t,e=!1){var i;const n=t.value;if(n===this.lastValue||($n(t.valueFormatted)?this.eValue.textContent=t.valueFormatted:$n(t.value)?this.eValue.textContent=n:Cu(this.eValue),(i=this.filterManager)!=null&&i.isSuppressFlashingCellsBecauseFiltering()))return!1;if(typeof n=="number"&&typeof this.lastValue=="number"){const r=n-this.lastValue;this.showDelta(t,r)}return this.lastValue&&this.eValue.classList.add("ag-value-change-value-highlight"),e||this.setTimerToRemoveDelta(),this.lastValue=n,!0}},Eue=class extends Js{constructor(){super(),this.refreshCount=0;const t=document.createElement("span"),e=document.createElement("span");e.setAttribute("class","ag-value-slide-current"),t.appendChild(e),this.setTemplateFromElement(t),this.eCurrent=this.queryForHtmlElement(".ag-value-slide-current")}wireBeans(t){this.filterManager=t.filterManager}init(t){this.refresh(t,!0)}addSlideAnimation(){this.refreshCount++;const t=this.refreshCount;this.ePrevious&&this.getGui().removeChild(this.ePrevious);const e=document.createElement("span");e.setAttribute("class","ag-value-slide-previous ag-value-slide-out"),this.ePrevious=e,this.ePrevious.textContent=this.eCurrent.textContent,this.getGui().insertBefore(this.ePrevious,this.eCurrent),this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>{t===this.refreshCount&&this.ePrevious.classList.add("ag-value-slide-out-end")},50),window.setTimeout(()=>{t===this.refreshCount&&(this.getGui().removeChild(this.ePrevious),this.ePrevious=null)},3e3)})}refresh(t,e=!1){var i;let n=t.value;return Hr(n)&&(n=""),n===this.lastValue||(i=this.filterManager)!=null&&i.isSuppressFlashingCellsBecauseFiltering()?!1:(e||this.addSlideAnimation(),this.lastValue=n,$n(t.valueFormatted)?this.eCurrent.textContent=t.valueFormatted:$n(t.value)?this.eCurrent.textContent=n:Cu(this.eCurrent),!0)}},mn=class{};mn.BACKSPACE="Backspace";mn.TAB="Tab";mn.ENTER="Enter";mn.ESCAPE="Escape";mn.SPACE=" ";mn.LEFT="ArrowLeft";mn.UP="ArrowUp";mn.RIGHT="ArrowRight";mn.DOWN="ArrowDown";mn.DELETE="Delete";mn.F2="F2";mn.PAGE_UP="PageUp";mn.PAGE_DOWN="PageDown";mn.PAGE_HOME="Home";mn.PAGE_END="End";mn.A="KeyA";mn.C="KeyC";mn.D="KeyD";mn.V="KeyV";mn.X="KeyX";mn.Y="KeyY";mn.Z="KeyZ";var Mue=class extends Js{constructor(t,e,n){super(e,n),this.labelSeparator="",this.labelAlignment="left",this.disabled=!1,this.label="",this.config=t||{}}postConstruct(){this.addCssClass("ag-labeled"),this.eLabel.classList.add("ag-label");const{labelSeparator:t,label:e,labelWidth:n,labelAlignment:i,disabled:r}=this.config;r!=null&&this.setDisabled(r),t!=null&&this.setLabelSeparator(t),e!=null&&this.setLabel(e),n!=null&&this.setLabelWidth(n),this.setLabelAlignment(i||this.labelAlignment),this.refreshLabel()}refreshLabel(){Cu(this.eLabel),typeof this.label=="string"?this.eLabel.innerText=this.label+this.labelSeparator:this.label&&this.eLabel.appendChild(this.label),this.label===""?(Do(this.eLabel,!1),ld(this.eLabel,"presentation")):(Do(this.eLabel,!0),ld(this.eLabel,null))}setLabelSeparator(t){return this.labelSeparator===t?this:(this.labelSeparator=t,this.label!=null&&this.refreshLabel(),this)}getLabelId(){return this.eLabel.id=this.eLabel.id||`ag-${this.getCompId()}-label`,this.eLabel.id}getLabel(){return this.label}setLabel(t){return this.label===t?this:(this.label=t,this.refreshLabel(),this)}setLabelAlignment(t){const n=this.getGui().classList;return n.toggle("ag-label-align-left",t==="left"),n.toggle("ag-label-align-right",t==="right"),n.toggle("ag-label-align-top",t==="top"),this}setLabelEllipsis(t){return this.eLabel.classList.toggle("ag-label-ellipsis",t),this}setLabelWidth(t){return this.label==null?this:(aT(this.eLabel,t),this)}setDisabled(t){t=!!t;const e=this.getGui();return oS(e,t),e.classList.toggle("ag-disabled",t),this.disabled=t,this}isDisabled(){return!!this.disabled}},w7=class extends Mue{constructor(t,e,n,i){super(t,e,n),this.className=i}postConstruct(){super.postConstruct();const{width:t,value:e,onValueChange:n}=this.config;t!=null&&this.setWidth(t),e!=null&&this.setValue(e),n!=null&&this.onValueChange(n),this.className&&this.addCssClass(this.className),this.refreshAriaLabelledBy()}setLabel(t){return super.setLabel(t),this.refreshAriaLabelledBy(),this}refreshAriaLabelledBy(){const t=this.getAriaElement(),e=this.getLabelId(),n=this.getLabel();n==null||n==""||Wce(t)!==null?sS(t,""):sS(t,e??"")}setAriaLabel(t){return nw(this.getAriaElement(),t),this.refreshAriaLabelledBy(),this}onValueChange(t){return this.addManagedListeners(this,{fieldValueChanged:()=>t(this.getValue())}),this}getWidth(){return this.getGui().clientWidth}setWidth(t){return sd(this.getGui(),t),this}getPreviousValue(){return this.previousValue}getValue(){return this.value}setValue(t,e){return this.value===t?this:(this.previousValue=this.value,this.value=t,e||this.dispatchLocalEvent({type:"fieldValueChanged"}),this)}},zy=class extends w7{constructor(t,e,n="text",i="input"){super(t,(t==null?void 0:t.template)??`
            <div role="presentation">
                <div data-ref="eLabel" class="ag-input-field-label"></div>
                <div data-ref="eWrapper" class="ag-wrapper ag-input-wrapper" role="presentation">
                    <${i} data-ref="eInput" class="ag-input-field-input"></${i}>
                </div>
            </div>`,[],e),this.inputType=n,this.displayFieldTag=i,this.eLabel=qi,this.eWrapper=qi,this.eInput=qi}postConstruct(){super.postConstruct(),this.setInputType(),this.eLabel.classList.add(`${this.className}-label`),this.eWrapper.classList.add(`${this.className}-input-wrapper`),this.eInput.classList.add(`${this.className}-input`),this.addCssClass("ag-input-field"),this.eInput.id=this.eInput.id||`ag-${this.getCompId()}-input`;const{inputName:t,inputWidth:e}=this.config;t!=null&&this.setInputName(t),e!=null&&this.setInputWidth(e),this.addInputListeners(),this.activateTabIndex([this.eInput])}addInputListeners(){this.addManagedElementListeners(this.eInput,{input:t=>this.setValue(t.target.value)})}setInputType(){this.displayFieldTag==="input"&&this.eInput.setAttribute("type",this.inputType)}getInputElement(){return this.eInput}setInputWidth(t){return aT(this.eWrapper,t),this}setInputName(t){return this.getInputElement().setAttribute("name",t),this}getFocusableElement(){return this.eInput}setMaxLength(t){const e=this.eInput;return e.maxLength=t,this}setInputPlaceholder(t){return Up(this.eInput,"placeholder",t),this}setInputAriaLabel(t){return nw(this.eInput,t),this.refreshAriaLabelledBy(),this}setDisabled(t){return oS(this.eInput,t),super.setDisabled(t)}setAutoComplete(t){if(t===!0)Up(this.eInput,"autocomplete",null);else{const e=typeof t=="string"?t:"off";Up(this.eInput,"autocomplete",e)}return this}},M3=class extends zy{constructor(t,e="ag-checkbox",n="checkbox"){super(t,e,n),this.labelAlignment="right",this.selected=!1,this.readOnly=!1,this.passive=!1}postConstruct(){super.postConstruct();const{readOnly:t,passive:e}=this.config;typeof t=="boolean"&&this.setReadOnly(t),typeof e=="boolean"&&this.setPassive(e)}addInputListeners(){this.addManagedElementListeners(this.eInput,{click:this.onCheckboxClick.bind(this)}),this.addManagedElementListeners(this.eLabel,{click:this.toggle.bind(this)})}getNextValue(){return this.selected===void 0?!0:!this.selected}setPassive(t){this.passive=t}isReadOnly(){return this.readOnly}setReadOnly(t){this.eWrapper.classList.toggle("ag-disabled",t),this.eInput.disabled=t,this.readOnly=t}setDisabled(t){return this.eWrapper.classList.toggle("ag-disabled",t),super.setDisabled(t)}toggle(){if(this.eInput.disabled)return;const t=this.isSelected(),e=this.getNextValue();this.passive?this.dispatchChange(e,t):this.setValue(e)}getValue(){return this.isSelected()}setValue(t,e){return this.refreshSelectedClass(t),this.setSelected(t,e),this}setName(t){const e=this.getInputElement();return e.name=t,this}isSelected(){return this.selected}setSelected(t,e){this.isSelected()!==t&&(this.previousValue=this.isSelected(),t=this.selected=typeof t=="boolean"?t:void 0,this.eInput.checked=t,this.eInput.indeterminate=t===void 0,e||this.dispatchChange(this.selected,this.previousValue))}dispatchChange(t,e,n){this.dispatchLocalEvent({type:"fieldValueChanged",selected:t,previousValue:e,event:n});const i=this.getInputElement(),r={type:"checkboxChanged",id:i.id,name:i.name,selected:t,previousValue:e};this.eventService.dispatchEvent(r)}onCheckboxClick(t){if(this.passive||this.eInput.disabled)return;const e=this.isSelected(),n=this.selected=t.target.checked;this.refreshSelectedClass(n),this.dispatchChange(n,e,t)}refreshSelectedClass(t){this.eWrapper.classList.toggle("ag-checked",t===!0),this.eWrapper.classList.toggle("ag-indeterminate",t==null)}},R3={selector:"AG-CHECKBOX",component:M3},Rue=class extends Js{constructor(){super(`
            <div class="ag-cell-wrapper ag-checkbox-cell" role="presentation">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[R3]),this.eCheckbox=qi}init(t){this.params=t,this.updateCheckbox(t);const e=this.eCheckbox.getInputElement();e.setAttribute("tabindex","-1"),s7(e,"polite"),this.addManagedListeners(e,{click:n=>{if(tw(n),this.eCheckbox.isDisabled())return;const i=this.eCheckbox.getValue();this.onCheckboxChanged(i)},dblclick:n=>{tw(n)}}),this.addManagedElementListeners(this.params.eGridCell,{keydown:n=>{if(n.key===mn.SPACE&&!this.eCheckbox.isDisabled()){this.params.eGridCell===this.gos.getActiveDomElement()&&this.eCheckbox.toggle();const i=this.eCheckbox.getValue();this.onCheckboxChanged(i),n.preventDefault()}}})}refresh(t){return this.params=t,this.updateCheckbox(t),!0}updateCheckbox(t){var s;let e,n=!0;if(t.node.group&&t.column){const f=t.column.getColId();f.startsWith(zS)?e=t.value==null||t.value===""?void 0:t.value==="true":t.node.aggData&&t.node.aggData[f]!==void 0?e=t.value??void 0:n=!1}else e=t.value??void 0;if(!n){this.eCheckbox.setDisplayed(!1);return}this.eCheckbox.setValue(e);const i=t.disabled!=null?t.disabled:!((s=t.column)!=null&&s.isCellEditable(t.node));this.eCheckbox.setDisabled(i);const r=this.localeService.getLocaleTextFunc(),o=_3(r,e),c=i?o:`${r("ariaToggleCellValue","Press SPACE to toggle cell value")} (${o})`;this.eCheckbox.setInputAriaLabel(c)}onCheckboxChanged(t){const{column:e,node:n,value:i}=this.params,r={type:"cellEditingStarted",column:e,colDef:e==null?void 0:e.getColDef(),data:n.data,node:n,rowIndex:n.rowIndex,rowPinned:n.rowPinned,value:i};this.eventService.dispatchEvent(r);const o=this.params.node.setDataValue(this.params.column,t,"edit"),c={type:"cellEditingStopped",column:e,colDef:e==null?void 0:e.getColDef(),data:n.data,node:n,rowIndex:n.rowIndex,rowPinned:n.rowPinned,value:i,oldValue:i,newValue:t,valueChanged:o};this.eventService.dispatchEvent(c)}},Tue=class extends Js{constructor(){super(`<div class="ag-loading">
            <span class="ag-loading-icon" data-ref="eLoadingIcon"></span>
            <span class="ag-loading-text" data-ref="eLoadingText"></span>
        </div>`),this.eLoadingIcon=qi,this.eLoadingText=qi}init(t){t.node.failedLoad?this.setupFailed():this.setupLoading()}setupFailed(){const t=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=t("loadingError","ERR")}setupLoading(){const t=gu("groupLoading",this.gos,null);t&&this.eLoadingIcon.appendChild(t);const e=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=e("loadingOoo","Loading")}refresh(t){return!1}destroy(){super.destroy()}},Aue=class extends Js{constructor(){super('<div class="ag-skeleton-container"></div>')}init(t){const e=`ag-cell-skeleton-renderer-${this.getCompId()}`;this.getGui().setAttribute("id",e),this.addDestroyFunc(()=>sS(t.eParentOfValue)),sS(t.eParentOfValue,e),t.node.failedLoad?this.setupFailed():this.setupLoading(t)}setupFailed(){const t=this.localeService.getLocaleTextFunc();this.getGui().innerText=t("loadingError","ERR");const e=t("ariaSkeletonCellLoadingFailed","Row failed to load");nw(this.getGui(),e)}setupLoading(t){const n=this.gos.getDocument().createElement("div");n.classList.add("ag-skeleton-effect");const i=t.node.rowIndex;if(i!=null){const c=75+25*(i%2===0?Math.sin(i):Math.cos(i));n.style.width=`${c}%`}this.getGui().appendChild(n);const o=this.localeService.getLocaleTextFunc()("ariaSkeletonCellLoading","Row data is loading");nw(this.getGui(),o)}refresh(t){return!1}destroy(){super.destroy()}},C7=class extends Js{constructor(){super()}destroy(){super.destroy()}},Pue=class extends C7{init(){const t=this.gos.get("overlayLoadingTemplate");if(this.setTemplate(t??'<span aria-live="polite" aria-atomic="true" class="ag-overlay-loading-center"></span>'),!t){const e=this.localeService.getLocaleTextFunc();setTimeout(()=>{this.getGui().textContent=e("loadingOoo","Loading...")})}}},Iue=class extends C7{init(){const t=this.gos.get("overlayNoRowsTemplate");if(this.setTemplate(t??'<span class="ag-overlay-no-rows-center"></span>'),!t){const e=this.localeService.getLocaleTextFunc();setTimeout(()=>{this.getGui().textContent=e("noRowsToShow","No Rows To Show")})}}},bw=class extends Js{isPopup(){return!0}setParentComponent(t){t.addCssClass("ag-has-popup"),super.setParentComponent(t)}destroy(){const t=this.parentComponent;t&&t.isAlive()&&t.getGui().classList.remove("ag-has-popup"),super.destroy()}},Due=class extends bw{constructor(){super('<div class="ag-tooltip"></div>')}init(t){const{value:e}=t;this.getGui().textContent=wf(e,!0)}};function Fue(t,e,n){const i={},r=t.filter(o=>!e.some(c=>c===o));return r.length>0&&r.forEach(o=>i[o]=S7(o,n).values),i}function S7(t,e,n,i){let r=e.map((s,f)=>({value:s,relevance:Lue(t.toLowerCase(),s.toLocaleLowerCase()),idx:f}));if(r.sort((s,f)=>f.relevance-s.relevance),n&&(r=r.filter(s=>s.relevance!==0)),r.length>0&&i&&i>0){const f=r[0].relevance*i;r=r.filter(v=>f-v.relevance<0)}const o=[],c=[];for(const s of r)o.push(s.value),c.push(s.idx);return{values:o,indices:c}}function Lue(t,e){const n=t.replace(/\s/g,""),i=e.replace(/\s/g,"");let r=0,o=-1;for(let c=0;c<n.length;c++){const s=i.indexOf(n[c],o+1);s!==-1&&(o=s,r+=100-o*100/1e4*100)}return r}var Oue=class extends wn{constructor(){super(...arguments),this.beanName="userComponentRegistry",this.agGridDefaults={agColumnHeader:RL,agColumnGroupHeader:wue,agSortIndicator:E3,agAnimateShowChangeCellRenderer:bue,agAnimateSlideCellRenderer:Eue,agLoadingCellRenderer:Tue,agSkeletonCellRenderer:Aue,agCheckboxCellRenderer:Rue,agLoadingOverlay:Pue,agNoRowsOverlay:Iue,agTooltipComponent:Due},this.enterpriseAgDefaultCompsModule={agSetColumnFilter:"@ag-grid-enterprise/set-filter",agSetColumnFloatingFilter:"@ag-grid-enterprise/set-filter",agMultiColumnFilter:"@ag-grid-enterprise/multi-filter",agMultiColumnFloatingFilter:"@ag-grid-enterprise/multi-filter",agGroupColumnFilter:"@ag-grid-enterprise/row-grouping",agGroupColumnFloatingFilter:"@ag-grid-enterprise/row-grouping",agGroupCellRenderer:"@ag-grid-enterprise/row-grouping",agGroupRowRenderer:"@ag-grid-enterprise/row-grouping",agRichSelect:"@ag-grid-enterprise/rich-select",agRichSelectCellEditor:"@ag-grid-enterprise/rich-select",agDetailCellRenderer:"@ag-grid-enterprise/master-detail",agSparklineCellRenderer:"@ag-grid-enterprise/sparklines"},this.jsComps={}}postConstruct(){const t=this.gos.get("components");t!=null&&td(t,(e,n)=>this.registerJsComponent(e,n))}registerDefaultComponent(t,e){this.agGridDefaults[t]=e}registerJsComponent(t,e){this.jsComps[t]=e}retrieve(t,e){const n=(s,f)=>({componentFromFramework:f,component:s}),i=this.getFrameworkOverrides().frameworkComponent(e,this.gos.get("components"));if(i!=null)return n(i,!0);const r=this.jsComps[e];if(r){const s=this.getFrameworkOverrides().isFrameworkComponent(r);return n(r,s)}const o=this.agGridDefaults[e];if(o)return n(o,!1);const c=this.enterpriseAgDefaultCompsModule[e];return c?xl.__assertRegistered(c,`AG Grid '${t}' component: ${e}`,this.gridId):m3(()=>{this.warnAboutMissingComponent(t,e)},"MissingComp"+e),null}warnAboutMissingComponent(t,e){const n=[...Object.keys(this.agGridDefaults).filter(r=>!["agCellEditor","agGroupRowRenderer","agSortIndicator"].includes(r)),...Object.keys(this.jsComps)],i=S7(e,n,!0,.8).values;Tn(`Could not find '${e}' component. It was configured as "${t}: '${e}'" but it wasn't found in the list of registered components.`),i.length>0&&Tn(`         Did you mean: [${i.slice(0,3)}]?`),Tn(`If using a custom component check it has been registered as described in: ${this.getFrameworkOverrides().getDocLink("components/")}`)}},Zo=class s1{constructor(e){this.status=0,this.resolution=null,this.waiters=[],e(n=>this.onDone(n),n=>this.onReject(n))}static all(e){return e.length?new s1(n=>{let i=e.length;const r=new Array(i);e.forEach((o,c)=>{o.then(s=>{r[c]=s,i--,i===0&&n(r)})})}):s1.resolve()}static resolve(e=null){return new s1(n=>n(e))}then(e){return new s1(n=>{this.status===1?n(e(this.resolution)):this.waiters.push(i=>n(e(i)))})}onDone(e){this.status=1,this.resolution=e,this.waiters.forEach(n=>n(e))}onReject(e){}},kue={propertyName:"dateComponent",cellRenderer:!1},Nue={propertyName:"headerComponent",cellRenderer:!1},Bue={propertyName:"headerGroupComponent",cellRenderer:!1},q5={propertyName:"cellRenderer",cellRenderer:!0},zue={propertyName:"cellRenderer",cellRenderer:!1},Uue={propertyName:"loadingCellRenderer",cellRenderer:!0},Vue={propertyName:"cellEditor",cellRenderer:!1},Z5={propertyName:"innerRenderer",cellRenderer:!0},Gue={propertyName:"loadingOverlayComponent",cellRenderer:!1},Hue={propertyName:"noRowsOverlayComponent",cellRenderer:!1},Wue={propertyName:"tooltipComponent",cellRenderer:!1},T3={propertyName:"filter",cellRenderer:!1},jue={propertyName:"floatingFilterComponent",cellRenderer:!1},$ue={propertyName:"toolPanel",cellRenderer:!1},que={propertyName:"statusPanel",cellRenderer:!1},Zue={propertyName:"fullWidthCellRenderer",cellRenderer:!0},Xue={propertyName:"loadingCellRenderer",cellRenderer:!0},Kue={propertyName:"groupRowRenderer",cellRenderer:!0},Yue={propertyName:"detailCellRenderer",cellRenderer:!0},Jue={propertyName:"menuItem",cellRenderer:!1},b7=class E7 extends wn{constructor(){super(...arguments),this.beanName="userComponentFactory"}wireBeans(e){this.agComponentUtils=e.agComponentUtils,this.componentMetadataProvider=e.componentMetadataProvider,this.userComponentRegistry=e.userComponentRegistry,this.frameworkComponentWrapper=e.frameworkComponentWrapper,this.gridOptions=e.gridOptions}getHeaderCompDetails(e,n){return this.getCompDetails(e,Nue,"agColumnHeader",n)}getHeaderGroupCompDetails(e){const n=e.columnGroup.getColGroupDef();return this.getCompDetails(n,Bue,"agColumnGroupHeader",e)}getFullWidthCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Zue,null,e,!0)}getFullWidthLoadingCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Xue,"agLoadingCellRenderer",e,!0)}getFullWidthGroupCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Kue,"agGroupRowRenderer",e,!0)}getFullWidthDetailCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Yue,"agDetailCellRenderer",e,!0)}getInnerRendererDetails(e,n){return this.getCompDetails(e,Z5,null,n)}getFullWidthGroupRowInnerCellRenderer(e,n){return this.getCompDetails(e,Z5,null,n)}getCellRendererDetails(e,n){return this.getCompDetails(e,q5,null,n)}getEditorRendererDetails(e,n){return this.getCompDetails(e,zue,null,n)}getLoadingCellRendererDetails(e,n){return this.getCompDetails(e,Uue,"agSkeletonCellRenderer",n,!0)}getCellEditorDetails(e,n){return this.getCompDetails(e,Vue,"agCellEditor",n,!0)}getFilterDetails(e,n,i){return this.getCompDetails(e,T3,i,n,!0)}getDateCompDetails(e){return this.getCompDetails(this.gridOptions,kue,"agDateInput",e,!0)}getLoadingOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,Gue,"agLoadingOverlay",e,!0)}getNoRowsOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,Hue,"agNoRowsOverlay",e,!0)}getTooltipCompDetails(e){return this.getCompDetails(e.colDef,Wue,"agTooltipComponent",e,!0)}getSetFilterCellRendererDetails(e,n){return this.getCompDetails(e,q5,null,n)}getFloatingFilterCompDetails(e,n,i){return this.getCompDetails(e,jue,i,n)}getToolPanelCompDetails(e,n){return this.getCompDetails(e,$ue,null,n,!0)}getStatusPanelCompDetails(e,n){return this.getCompDetails(e,que,null,n,!0)}getMenuItemCompDetails(e,n){return this.getCompDetails(e,Jue,"agMenuItem",n,!0)}getCompDetails(e,n,i,r,o=!1){const{propertyName:c,cellRenderer:s}=n;let{compName:f,jsComp:v,fwComp:w,paramsFromSelector:C,popupFromSelector:M,popupPositionFromSelector:F}=E7.getCompKeys(this.frameworkOverrides,e,n,r);const N=H=>{const j=this.userComponentRegistry.retrieve(c,H);j&&(v=j.componentFromFramework?void 0:j.component,w=j.componentFromFramework?j.component:void 0)};if(f!=null&&N(f),v==null&&w==null&&i!=null&&N(i),v&&s&&!this.agComponentUtils.doesImplementIComponent(v)&&(v=this.agComponentUtils.adaptFunction(c,v)),!v&&!w){o&&_s(`Could not find component ${f}, did you forget to configure this component?`);return}const z=this.mergeParamsWithApplicationProvidedParams(e,n,r,C),L=v==null,P=v||w;return{componentFromFramework:L,componentClass:P,params:z,type:n,popupFromSelector:M,popupPositionFromSelector:F,newAgStackInstance:()=>this.newAgStackInstance(P,L,z,n)}}static getCompKeys(e,n,i,r){const{propertyName:o}=i;let c,s,f,v,w,C;if(n){const M=n,F=M[o+"Selector"],N=F?F(r):null,z=L=>{typeof L=="string"?c=L:L!=null&&L!==!0&&(e.isFrameworkComponent(L)?f=L:s=L)};N?(z(N.component),v=N.params,w=N.popup,C=N.popupPosition):z(M[o])}return{compName:c,jsComp:s,fwComp:f,paramsFromSelector:v,popupFromSelector:w,popupPositionFromSelector:C}}newAgStackInstance(e,n,i,r){const o=r.propertyName,c=!n;let s;if(c)s=new e;else{const v=this.componentMetadataProvider.retrieve(o);s=this.frameworkComponentWrapper.wrap(e,v.mandatoryMethodList,v.optionalMethodList,r)}const f=this.initComponent(s,i);return f==null?Zo.resolve(s):f.then(()=>s)}mergeParamsWithApplicationProvidedParams(e,n,i,r=null){const o=this.gos.getGridCommonParams();Xu(o,i);const c=e,s=c&&c[n.propertyName+"Params"];if(typeof s=="function"){const f=s(i);Xu(o,f)}else typeof s=="object"&&Xu(o,s);return Xu(o,r),o}initComponent(e,n){if(this.createBean(e),e.init!=null)return e.init(n)}};function S1(t){const e=t;return e!=null&&e.getFrameworkComponentInstance!=null?e.getFrameworkComponentInstance():t}var Que=class{constructor(t){this.beans={},this.createdBeans=[],this.destroyed=!1,!(!t||!t.beanClasses)&&(this.beanDestroyComparator=t.beanDestroyComparator,this.init(t))}init(t){var e;Object.entries(t.providedBeanInstances).forEach(([n,i])=>{this.beans[n]=i}),t.beanClasses.forEach(n=>{const i=new n;i.beanName?this.beans[i.beanName]=i:console.error(`Bean ${n.name} is missing beanName`),this.createdBeans.push(i)}),(e=t.derivedBeans)==null||e.forEach(n=>{const{beanName:i,bean:r}=n(this);this.beans[i]=r,this.createdBeans.push(r)}),t.beanInitComparator&&this.createdBeans.sort(t.beanInitComparator),this.initBeans(this.createdBeans)}getBeanInstances(){return Object.values(this.beans)}createBean(t,e){if(!t)throw Error("Can't wire to bean since it is null");return this.initBeans([t],e),t}initBeans(t,e){t.forEach(n=>{var i,r;(i=n.preWireBeans)==null||i.call(n,this.beans),(r=n.wireBeans)==null||r.call(n,this.beans)}),t.forEach(n=>{var i;return(i=n.preConstruct)==null?void 0:i.call(n)}),e&&t.forEach(e),t.forEach(n=>{var i;return(i=n.postConstruct)==null?void 0:i.call(n)})}getBeans(){return this.beans}getBean(t){return this.beans[t]}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this.getBeanInstances();this.beanDestroyComparator&&t.sort(this.beanDestroyComparator),this.destroyBeans(t),this.beans={},this.createdBeans=[]}destroyBean(t){var e;(e=t==null?void 0:t.destroy)==null||e.call(t)}destroyBeans(t){if(t)for(let e=0;e<t.length;e++)this.destroyBean(t[e]);return[]}isDestroyed(){return this.destroyed}},ehe=class extends Que{init(t){this.gridId=t.gridId,this.beans.context=this,super.init(t)}destroy(){super.destroy(),xl.__unRegisterGridModules(this.gridId)}getGridId(){return this.gridId}},M7=(t=>(t[t.Left=0]="Left",t[t.Right=1]="Right",t))(M7||{}),the=`<div class="ag-dnd-ghost ag-unselectable">
<span class="ag-dnd-ghost-icon ag-shake-left-to-right"></span>
<div class="ag-dnd-ghost-label"></div>
</div>`,nhe=class extends wn{constructor(){super(...arguments),this.beanName="dragAndDropService",this.dragSourceAndParamsList=[],this.dropTargets=[]}wireBeans(t){this.dragService=t.dragService,this.mouseEventService=t.mouseEventService,this.environment=t.environment}postConstruct(){this.dropIconMap={pinned:_p("columnMovePin",this.gos,null),hide:_p("columnMoveHide",this.gos,null),move:_p("columnMoveMove",this.gos,null),left:_p("columnMoveLeft",this.gos,null),right:_p("columnMoveRight",this.gos,null),group:_p("columnMoveGroup",this.gos,null),aggregate:_p("columnMoveValue",this.gos,null),pivot:_p("columnMovePivot",this.gos,null),notAllowed:_p("dropNotAllowed",this.gos,null)}}addDragSource(t,e=!1){const n={eElement:t.eElement,dragStartPixels:t.dragStartPixels,onDragStart:this.onDragStart.bind(this,t),onDragStop:this.onDragStop.bind(this),onDragging:this.onDragging.bind(this),includeTouch:e};this.dragSourceAndParamsList.push({params:n,dragSource:t}),this.dragService.addDragSource(n)}removeDragSource(t){const e=this.dragSourceAndParamsList.find(n=>n.dragSource===t);e&&(this.dragService.removeDragSource(e.params),Xl(this.dragSourceAndParamsList,e))}destroy(){this.dragSourceAndParamsList.forEach(t=>this.dragService.removeDragSource(t.params)),this.dragSourceAndParamsList.length=0,this.dropTargets.length=0,super.destroy()}nudge(){this.dragging&&this.onDragging(this.eventLastTime,!0)}onDragStart(t,e){this.dragging=!0,this.dragSource=t,this.eventLastTime=e,this.dragItem=this.dragSource.getDragItem(),this.dragSource.onDragStarted&&this.dragSource.onDragStarted(),this.createGhost()}onDragStop(t){if(this.eventLastTime=null,this.dragging=!1,this.dragSource.onDragStopped&&this.dragSource.onDragStopped(),this.lastDropTarget&&this.lastDropTarget.onDragStop){const e=this.createDropTargetEvent(this.lastDropTarget,t,null,null,!1);this.lastDropTarget.onDragStop(e)}this.lastDropTarget=void 0,this.dragItem=null,this.removeGhost()}onDragging(t,e){var c,s,f,v;const n=this.getHorizontalDirection(t),i=this.getVerticalDirection(t);this.eventLastTime=t,this.positionGhost(t);const r=this.dropTargets.filter(w=>this.isMouseOnDropTarget(t,w)),o=this.findCurrentDropTarget(t,r);if(o!==this.lastDropTarget)this.leaveLastTargetIfExists(t,n,i,e),this.lastDropTarget!==null&&o===null&&((s=(c=this.dragSource).onGridExit)==null||s.call(c,this.dragItem)),this.lastDropTarget===null&&o!==null&&((v=(f=this.dragSource).onGridEnter)==null||v.call(f,this.dragItem)),this.enterDragTargetIfExists(o,t,n,i,e),this.lastDropTarget=o;else if(o&&o.onDragging){const w=this.createDropTargetEvent(o,t,n,i,e);o.onDragging(w)}}getAllContainersFromDropTarget(t){const e=t.getSecondaryContainers?t.getSecondaryContainers():null,n=[[t.getContainer()]];return e?n.concat(e):n}allContainersIntersect(t,e){for(const n of e){const i=n.getBoundingClientRect();if(i.width===0||i.height===0)return!1;const r=t.clientX>=i.left&&t.clientX<i.right,o=t.clientY>=i.top&&t.clientY<i.bottom;if(!r||!o)return!1}return!0}isMouseOnDropTarget(t,e){const n=this.getAllContainersFromDropTarget(e);let i=!1;for(const r of n)if(this.allContainersIntersect(t,r)){i=!0;break}return e.targetContainsSource&&!e.getContainer().contains(this.dragSource.eElement)?!1:i&&e.isInterestedIn(this.dragSource.type,this.dragSource.eElement)}findCurrentDropTarget(t,e){const n=e.length;if(n===0)return null;if(n===1)return e[0];const r=this.gos.getRootNode().elementsFromPoint(t.clientX,t.clientY);for(const o of r)for(const c of e)if(lce(this.getAllContainersFromDropTarget(c)).indexOf(o)!==-1)return c;return null}enterDragTargetIfExists(t,e,n,i,r){if(t){if(t.onDragEnter){const o=this.createDropTargetEvent(t,e,n,i,r);t.onDragEnter(o)}this.setGhostIcon(t.getIconName?t.getIconName():null)}}leaveLastTargetIfExists(t,e,n,i){if(this.lastDropTarget){if(this.lastDropTarget.onDragLeave){const r=this.createDropTargetEvent(this.lastDropTarget,t,e,n,i);this.lastDropTarget.onDragLeave(r)}this.setGhostIcon(null)}}addDropTarget(t){this.dropTargets.push(t)}removeDropTarget(t){this.dropTargets=this.dropTargets.filter(e=>e.getContainer()!==t.getContainer())}hasExternalDropZones(){return this.dropTargets.some(t=>t.external)}findExternalZone(t){return this.dropTargets.filter(n=>n.external).find(n=>n.getContainer()===t.getContainer())||null}getHorizontalDirection(t){const e=this.eventLastTime&&this.eventLastTime.clientX,n=t.clientX;return e===n?null:e>n?0:1}getVerticalDirection(t){const e=this.eventLastTime&&this.eventLastTime.clientY,n=t.clientY;return e===n?null:e>n?0:1}createDropTargetEvent(t,e,n,i,r){const o=t.getContainer(),c=o.getBoundingClientRect(),{dragItem:s,dragSource:f}=this,v=e.clientX-c.left,w=e.clientY-c.top;return this.gos.addGridCommonParams({event:e,x:v,y:w,vDirection:i,hDirection:n,dragSource:f,fromNudge:r,dragItem:s,dropZoneTarget:o})}positionGhost(t){const e=this.eGhost;if(!e)return;const i=e.getBoundingClientRect().height,r=rue()-2,o=sue()-2,c=p7(e.offsetParent),{clientY:s,clientX:f}=t;let v=s-c.top-i/2,w=f-c.left-10;const C=this.gos.getDocument(),M=C.defaultView||window,F=M.pageYOffset||C.documentElement.scrollTop,N=M.pageXOffset||C.documentElement.scrollLeft;r>0&&w+e.clientWidth>r+N&&(w=r+N-e.clientWidth),w<0&&(w=0),o>0&&v+e.clientHeight>o+F&&(v=o+F-e.clientHeight),v<0&&(v=0),e.style.left=`${w}px`,e.style.top=`${v}px`}removeGhost(){this.eGhost&&this.eGhostParent&&this.eGhostParent.removeChild(this.eGhost),this.eGhost=null}createGhost(){this.eGhost=iw(the),this.mouseEventService.stampTopLevelGridCompWithGridInstance(this.eGhost),this.environment.applyThemeClasses(this.eGhost),this.eGhostIcon=this.eGhost.querySelector(".ag-dnd-ghost-icon"),this.setGhostIcon(null);const t=this.eGhost.querySelector(".ag-dnd-ghost-label");let e=this.dragSource.dragItemName;g3(e)&&(e=e()),t.innerHTML=wf(e)||"",this.eGhost.style.height="25px",this.eGhost.style.top="20px",this.eGhost.style.left="20px";const n=this.gos.getDocument();let i=null,r=null;try{i=n.fullscreenElement}catch{}finally{i||(i=this.gos.getRootNode());const o=i.querySelector("body");o?r=o:i instanceof ShadowRoot?r=i:i instanceof Document?r=i==null?void 0:i.documentElement:r=i}this.eGhostParent=r,this.eGhostParent?this.eGhostParent.appendChild(this.eGhost):Tn("Could not find document body, it is needed for dragging columns")}setGhostIcon(t,e=!1){Cu(this.eGhostIcon);let n=null;t||(t=this.dragSource.getDefaultIconName?this.dragSource.getDefaultIconName():"notAllowed"),n=this.dropIconMap[t],this.eGhostIcon.classList.toggle("ag-shake-left-to-right",e),!(n===this.dropIconMap.hide&&this.gos.get("suppressDragLeaveHidesColumns"))&&n&&this.eGhostIcon.appendChild(n)}},ihe=class{constructor(t){this.tickingInterval=null,this.onScrollCallback=null,this.scrollContainer=t.scrollContainer,this.scrollHorizontally=t.scrollAxis.indexOf("x")!==-1,this.scrollVertically=t.scrollAxis.indexOf("y")!==-1,this.scrollByTick=t.scrollByTick!=null?t.scrollByTick:20,t.onScrollCallback&&(this.onScrollCallback=t.onScrollCallback),this.scrollVertically&&(this.getVerticalPosition=t.getVerticalPosition,this.setVerticalPosition=t.setVerticalPosition),this.scrollHorizontally&&(this.getHorizontalPosition=t.getHorizontalPosition,this.setHorizontalPosition=t.setHorizontalPosition),this.shouldSkipVerticalScroll=t.shouldSkipVerticalScroll||(()=>!1),this.shouldSkipHorizontalScroll=t.shouldSkipHorizontalScroll||(()=>!1)}check(t,e=!1){const n=e||this.shouldSkipVerticalScroll();if(n&&this.shouldSkipHorizontalScroll())return;const i=this.scrollContainer.getBoundingClientRect(),r=this.scrollByTick;this.tickLeft=t.clientX<i.left+r,this.tickRight=t.clientX>i.right-r,this.tickUp=t.clientY<i.top+r&&!n,this.tickDown=t.clientY>i.bottom-r&&!n,this.tickLeft||this.tickRight||this.tickUp||this.tickDown?this.ensureTickingStarted():this.ensureCleared()}ensureTickingStarted(){this.tickingInterval===null&&(this.tickingInterval=window.setInterval(this.doTick.bind(this),100),this.tickCount=0)}doTick(){this.tickCount++;const t=this.tickCount>20?200:this.tickCount>10?80:40;if(this.scrollVertically){const e=this.getVerticalPosition();this.tickUp&&this.setVerticalPosition(e-t),this.tickDown&&this.setVerticalPosition(e+t)}if(this.scrollHorizontally){const e=this.getHorizontalPosition();this.tickLeft&&this.setHorizontalPosition(e-t),this.tickRight&&this.setHorizontalPosition(e+t)}this.onScrollCallback&&this.onScrollCallback()}ensureCleared(){this.tickingInterval&&(window.clearInterval(this.tickingInterval),this.tickingInterval=null)}},rhe=class extends wn{wireBeans(t){this.dragAndDropService=t.dragAndDropService,this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService,this.focusService=t.focusService,this.sortController=t.sortController,this.filterManager=t.filterManager,this.selectionService=t.selectionService,this.mouseEventService=t.mouseEventService,this.ctrlsService=t.ctrlsService,this.funcColsService=t.funcColsService,this.rangeService=t.rangeService}constructor(t){super(),this.eContainer=t}postConstruct(){this.gos.isRowModelType("clientSide")&&(this.clientSideRowModel=this.rowModel),this.ctrlsService.whenReady(t=>{const e=t.gridBodyCtrl;this.autoScrollService=new ihe({scrollContainer:e.getBodyViewportElement(),scrollAxis:"y",getVerticalPosition:()=>e.getScrollFeature().getVScrollPosition().top,setVerticalPosition:n=>e.getScrollFeature().setVerticalScrollPosition(n),onScrollCallback:()=>{this.onDragging(this.lastDraggingEvent)}})})}getContainer(){return this.eContainer}isInterestedIn(t){return t===2}getIconName(){return this.gos.get("rowDragManaged")&&this.shouldPreventRowMove()?"notAllowed":"move"}shouldPreventRowMove(){var i;return!!(this.funcColsService.getRowGroupColumns().length||((i=this.filterManager)==null?void 0:i.isAnyFilterPresent())||this.sortController.isSortActive())}getRowNodes(t){if(!this.isFromThisGrid(t))return t.dragItem.rowNodes||[];const e=t.dragItem.rowNode;if(this.gos.get("rowDragMultiRow")){const i=[...this.selectionService.getSelectedNodes()].sort((r,o)=>r.rowIndex==null||o.rowIndex==null?0:this.getRowIndexNumber(r)-this.getRowIndexNumber(o));if(i.indexOf(e)!==-1)return i}return[e]}onDragEnter(t){t.dragItem.rowNodes=this.getRowNodes(t),this.dispatchGridEvent("rowDragEnter",t),this.getRowNodes(t).forEach(e=>{e.setDragging(!0)}),this.onEnterOrDragging(t)}onDragging(t){this.onEnterOrDragging(t)}isFromThisGrid(t){const{dragSourceDomDataKey:e}=t.dragSource;return e===this.gos.getDomDataKey()}isDropZoneWithinThisGrid(t){const n=this.ctrlsService.getGridBodyCtrl().getGui(),{dropZoneTarget:i}=t;return!n.contains(i)}onEnterOrDragging(t){this.dispatchGridEvent("rowDragMove",t),this.lastDraggingEvent=t;const e=this.mouseEventService.getNormalisedPosition(t).y;this.gos.get("rowDragManaged")&&this.doManagedDrag(t,e),this.autoScrollService.check(t.event)}doManagedDrag(t,e){const n=this.isFromThisGrid(t),i=this.gos.get("rowDragManaged"),r=t.dragItem.rowNodes;i&&this.shouldPreventRowMove()||(this.gos.get("suppressMoveWhenRowDragging")||!n?this.isDropZoneWithinThisGrid(t)||this.clientSideRowModel.highlightRowAtPixel(r[0],e):this.moveRows(r,e))}getRowIndexNumber(t){const e=t.getRowIndexString();return parseInt(Yr(e.split("-")),10)}moveRowAndClearHighlight(t){const e=this.clientSideRowModel.getLastHighlightedRowNode(),n=e&&e.highlighted===1,i=this.mouseEventService.getNormalisedPosition(t).y,r=t.dragItem.rowNodes;let o=n?1:0;if(this.isFromThisGrid(t))r.forEach(c=>{c.rowTop<i&&(o-=1)}),this.moveRows(r,i,o);else{const c=this.gos.getRowIdCallback();let s=this.clientSideRowModel.getRowIndexAtPixel(i)+1;this.clientSideRowModel.getHighlightPosition(i)===0&&s--,this.clientSideRowModel.updateRowData({add:r.filter(f=>!this.clientSideRowModel.getRowNode((c==null?void 0:c({data:f.data,level:0,rowPinned:f.rowPinned}))??f.data.id)).map(f=>f.data),addIndex:s})}this.clearRowHighlight()}clearRowHighlight(){this.clientSideRowModel.highlightRowAtPixel(null)}moveRows(t,e,n=0){var r;this.clientSideRowModel.ensureRowsAtPixel(t,e,n)&&(this.focusService.clearFocusedCell(),(r=this.rangeService)==null||r.removeAllCellRanges())}addRowDropZone(t){if(!t.getContainer()){Tn("addRowDropZone - A container target needs to be provided");return}if(this.dragAndDropService.findExternalZone(t)){Tn("addRowDropZone - target already exists in the list of DropZones. Use `removeRowDropZone` before adding it again.");return}let e={getContainer:t.getContainer};t.fromGrid?e=t:(t.onDragEnter&&(e.onDragEnter=n=>{t.onDragEnter(this.draggingToRowDragEvent("rowDragEnter",n))}),t.onDragLeave&&(e.onDragLeave=n=>{t.onDragLeave(this.draggingToRowDragEvent("rowDragLeave",n))}),t.onDragging&&(e.onDragging=n=>{t.onDragging(this.draggingToRowDragEvent("rowDragMove",n))}),t.onDragStop&&(e.onDragStop=n=>{t.onDragStop(this.draggingToRowDragEvent("rowDragEnd",n))})),this.dragAndDropService.addDropTarget({isInterestedIn:n=>n===2,getIconName:()=>"move",external:!0,...e})}getRowDropZone(t){const e=this.getContainer.bind(this),n=this.onDragEnter.bind(this),i=this.onDragLeave.bind(this),r=this.onDragging.bind(this),o=this.onDragStop.bind(this);return t?{getContainer:e,onDragEnter:t.onDragEnter?c=>{n(c),t.onDragEnter(this.draggingToRowDragEvent("rowDragEnter",c))}:n,onDragLeave:t.onDragLeave?c=>{i(c),t.onDragLeave(this.draggingToRowDragEvent("rowDragLeave",c))}:i,onDragging:t.onDragging?c=>{r(c),t.onDragging(this.draggingToRowDragEvent("rowDragMove",c))}:r,onDragStop:t.onDragStop?c=>{o(c),t.onDragStop(this.draggingToRowDragEvent("rowDragEnd",c))}:o,fromGrid:!0}:{getContainer:e,onDragEnter:n,onDragLeave:i,onDragging:r,onDragStop:o,fromGrid:!0}}draggingToRowDragEvent(t,e){const n=this.mouseEventService.getNormalisedPosition(e).y,i=n>this.pageBoundsService.getCurrentPageHeight();let r=-1,o;i||(r=this.rowModel.getRowIndexAtPixel(n),o=this.rowModel.getRow(r));let c;switch(e.vDirection){case 1:c="down";break;case 0:c="up";break;default:c=null;break}return this.gos.addGridCommonParams({type:t,event:e.event,node:e.dragItem.rowNode,nodes:e.dragItem.rowNodes,overIndex:r,overNode:o,y:n,vDirection:c})}dispatchGridEvent(t,e){const n=this.draggingToRowDragEvent(t,e);this.eventService.dispatchEvent(n)}onDragLeave(t){this.dispatchGridEvent("rowDragLeave",t),this.stopDragging(t),this.gos.get("rowDragManaged")&&this.clearRowHighlight()}onDragStop(t){this.dispatchGridEvent("rowDragEnd",t),this.stopDragging(t),this.gos.get("rowDragManaged")&&(this.gos.get("suppressMoveWhenRowDragging")||!this.isFromThisGrid(t))&&!this.isDropZoneWithinThisGrid(t)&&this.moveRowAndClearHighlight(t)}stopDragging(t){this.autoScrollService.ensureCleared(),this.getRowNodes(t).forEach(e=>{e.setDragging(!1)})}},she=class extends wn{constructor(){super(...arguments),this.beanName="dragService",this.dragEndFunctions=[],this.dragSources=[]}wireBeans(t){this.mouseEventService=t.mouseEventService}destroy(){this.dragSources.forEach(this.removeListener.bind(this)),this.dragSources.length=0,super.destroy()}removeListener(t){const e=t.dragSource.eElement,n=t.mouseDownListener;if(e.removeEventListener("mousedown",n),t.touchEnabled){const i=t.touchStartListener;e.removeEventListener("touchstart",i,{passive:!0})}}removeDragSource(t){const e=this.dragSources.find(n=>n.dragSource===t);e&&(this.removeListener(e),Xl(this.dragSources,e))}isDragging(){return this.dragging}addDragSource(t){const e=this.onMouseDown.bind(this,t),{eElement:n,includeTouch:i,stopPropagationForTouch:r}=t;n.addEventListener("mousedown",e);let o=null;const c=this.gos.get("suppressTouch");i&&!c&&(o=s=>{w3(s.target)||(s.cancelable&&(s.preventDefault(),r&&s.stopPropagation()),this.onTouchStart(t,s))},n.addEventListener("touchstart",o,{passive:!1})),this.dragSources.push({dragSource:t,mouseDownListener:e,touchStartListener:o,touchEnabled:!!i})}getStartTarget(){return this.startTarget}onTouchStart(t,e){this.currentDragParams=t,this.dragging=!1;const n=e.touches[0];this.touchLastTime=n,this.touchStart=n;const i=f=>this.onTouchMove(f,t.eElement),r=f=>this.onTouchUp(f,t.eElement),o=f=>{f.cancelable&&f.preventDefault()},c=e.target,s=[{target:this.gos.getRootNode(),type:"touchmove",listener:o,options:{passive:!1}},{target:c,type:"touchmove",listener:i,options:{passive:!0}},{target:c,type:"touchend",listener:r,options:{passive:!0}},{target:c,type:"touchcancel",listener:r,options:{passive:!0}}];this.addTemporaryEvents(s),t.dragStartPixels===0&&this.onCommonMove(n,this.touchStart,t.eElement)}onMouseDown(t,e){const n=e;if(t.skipMouseEvent&&t.skipMouseEvent(e)||n._alreadyProcessedByDragService||(n._alreadyProcessedByDragService=!0,e.button!==0))return;this.shouldPreventMouseEvent(e)&&e.preventDefault(),this.currentDragParams=t,this.dragging=!1,this.mouseStartEvent=e,this.startTarget=e.target;const i=f=>this.onMouseMove(f,t.eElement),r=f=>this.onMouseUp(f,t.eElement),o=f=>f.preventDefault(),c=this.gos.getRootNode(),s=[{target:c,type:"mousemove",listener:i},{target:c,type:"mouseup",listener:r},{target:c,type:"contextmenu",listener:o}];this.addTemporaryEvents(s),t.dragStartPixels===0&&this.onMouseMove(e,t.eElement)}addTemporaryEvents(t){t.forEach(e=>{const{target:n,type:i,listener:r,options:o}=e;n.addEventListener(i,r,o)}),this.dragEndFunctions.push(()=>{t.forEach(e=>{const{target:n,type:i,listener:r,options:o}=e;n.removeEventListener(i,r,o)})})}isEventNearStartEvent(t,e){const{dragStartPixels:n}=this.currentDragParams,i=$n(n)?n:4;return _7(t,e,i)}getFirstActiveTouch(t){for(let e=0;e<t.length;e++)if(t[e].identifier===this.touchStart.identifier)return t[e];return null}onCommonMove(t,e,n){if(!this.dragging){if(!this.dragging&&this.isEventNearStartEvent(t,e))return;this.dragging=!0;const i={type:"dragStarted",target:n};this.eventService.dispatchEvent(i),this.currentDragParams.onDragStart(e),this.currentDragParams.onDragging(e)}this.currentDragParams.onDragging(t)}onTouchMove(t,e){const n=this.getFirstActiveTouch(t.touches);n&&this.onCommonMove(n,this.touchStart,e)}onMouseMove(t,e){var n;Qp()&&((n=this.gos.getDocument().getSelection())==null||n.removeAllRanges()),this.shouldPreventMouseEvent(t)&&t.preventDefault(),this.onCommonMove(t,this.mouseStartEvent,e)}shouldPreventMouseEvent(t){const e=this.gos.get("enableCellTextSelection"),n=t.type==="mousemove";return e&&n&&t.cancelable&&this.mouseEventService.isEventFromThisGrid(t)&&!this.isOverFormFieldElement(t)}isOverFormFieldElement(t){const e=t.target,n=e==null?void 0:e.tagName.toLocaleLowerCase();return!!(n!=null&&n.match("^a$|textarea|input|select|button"))}onTouchUp(t,e){let n=this.getFirstActiveTouch(t.changedTouches);n||(n=this.touchLastTime),this.onUpCommon(n,e)}onMouseUp(t,e){this.onUpCommon(t,e)}onUpCommon(t,e){if(this.dragging){this.dragging=!1,this.currentDragParams.onDragStop(t);const n={type:"dragStopped",target:e};this.eventService.dispatchEvent(n)}this.mouseStartEvent=null,this.startTarget=null,this.touchStart=null,this.touchLastTime=null,this.currentDragParams=null,this.dragEndFunctions.forEach(n=>n()),this.dragEndFunctions.length=0}},TL=class extends Js{constructor(t,e,n,i,r,o){super(),this.cellValueFn=t,this.rowNode=e,this.column=n,this.customGui=i,this.dragStartPixels=r,this.suppressVisibilityChange=o,this.dragSource=null}wireBeans(t){this.beans=t}isCustomGui(){return this.customGui!=null}postConstruct(){if(this.customGui?this.setDragElement(this.customGui,this.dragStartPixels):(this.setTemplate('<div class="ag-drag-handle ag-row-drag" aria-hidden="true"></div>'),this.getGui().appendChild(gu("rowDrag",this.gos,null)),this.addDragSource()),this.checkCompatibility(),!this.suppressVisibilityChange){const t=this.gos.get("rowDragManaged")?new ahe(this,this.beans,this.rowNode,this.column):new ohe(this,this.beans,this.rowNode,this.column);this.createManagedBean(t,this.beans.context)}}setDragElement(t,e){this.setTemplateFromElement(t),this.addDragSource(e)}getSelectedNodes(){if(!this.gos.get("rowDragMultiRow"))return[this.rowNode];const e=this.beans.selectionService.getSelectedNodes();return e.indexOf(this.rowNode)!==-1?e:[this.rowNode]}checkCompatibility(){const t=this.gos.get("rowDragManaged");this.gos.get("treeData")&&t&&Tn("If using row drag with tree data, you cannot have rowDragManaged=true")}getDragItem(){return{rowNode:this.rowNode,rowNodes:this.getSelectedNodes(),columns:this.column?[this.column]:void 0,defaultTextValue:this.cellValueFn()}}getRowDragText(t){if(t){const e=t.getColDef();if(e.rowDragText)return e.rowDragText}return this.gos.get("rowDragText")}addDragSource(t=4){this.dragSource&&this.removeDragSource();const e=this.getGui();this.gos.get("enableCellTextSelection")&&(this.removeMouseDownListener(),this.mouseDownListener=this.addManagedElementListeners(e,{mousedown:i=>{i==null||i.preventDefault()}})[0]);const n=this.localeService.getLocaleTextFunc();this.dragSource={type:2,eElement:e,dragItemName:()=>{var c;const i=this.getDragItem(),r=((c=i.rowNodes)==null?void 0:c.length)||1,o=this.getRowDragText(this.column);return o?o(i,r):r===1?this.cellValueFn():`${r} ${n("rowDragRows","rows")}`},getDragItem:()=>this.getDragItem(),dragStartPixels:t,dragSourceDomDataKey:this.gos.getDomDataKey()},this.beans.dragAndDropService.addDragSource(this.dragSource,!0)}destroy(){this.removeDragSource(),this.removeMouseDownListener(),super.destroy()}removeDragSource(){this.dragSource&&(this.beans.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null)}removeMouseDownListener(){this.mouseDownListener&&(this.mouseDownListener(),this.mouseDownListener=void 0)}},R7=class extends wn{constructor(t,e,n){super(),this.parent=t,this.rowNode=e,this.column=n}setDisplayedOrVisible(t){const e={skipAriaHidden:!0};if(t)this.parent.setDisplayed(!1,e);else{let n=!0,i=!1;this.column&&(n=this.column.isRowDrag(this.rowNode)||this.parent.isCustomGui(),i=g3(this.column.getColDef().rowDrag)),i?(this.parent.setDisplayed(!0,e),this.parent.setVisible(n,e)):(this.parent.setDisplayed(n,e),this.parent.setVisible(!0,e))}}},ohe=class extends R7{constructor(t,e,n,i){super(t,n,i),this.beans=e}postConstruct(){this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this));const t=this.workOutVisibility.bind(this);this.addManagedListeners(this.rowNode,{dataChanged:t,cellChanged:t}),this.addManagedListeners(this.beans.eventService,{newColumnsLoaded:t}),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const t=this.gos.get("suppressRowDrag");this.setDisplayedOrVisible(t)}},ahe=class extends R7{constructor(t,e,n,i){super(t,n,i),this.beans=e}postConstruct(){const t=this.workOutVisibility.bind(this);this.addManagedListeners(this.beans.eventService,{sortChanged:t,filterChanged:t,columnRowGroupChanged:t,newColumnsLoaded:t}),this.addManagedListeners(this.rowNode,{dataChanged:t,cellChanged:t}),this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const e=this.beans.ctrlsService.getGridBodyCtrl().getRowDragFeature(),n=e&&e.shouldPreventRowMove(),i=this.gos.get("suppressRowDrag"),r=this.beans.dragAndDropService.hasExternalDropZones(),o=n&&!r||i;this.setDisplayedOrVisible(o)}},GS=class K0{constructor(e){this.rowIndex=null,this.key=null,this.childrenMapped={},this.displayed=!1,this.rowTop=null,this.oldRowTop=null,this.selectable=!0,this.__objectId=K0.OBJECT_ID_SEQUENCE++,this.__autoHeights={},this.alreadyRendered=!1,this.highlighted=null,this.hovered=!1,this.selected=!1,this.beans=e}setData(e){this.setDataCommon(e,!1)}updateData(e){this.setDataCommon(e,!0)}setDataCommon(e,n){var o;const i=this.data;this.data=e,this.beans.valueCache.onDataChanged(),this.updateDataOnDetailNode(),this.checkRowSelectable(),this.resetQuickFilterAggregateText();const r=this.createDataChangedEvent(e,i,n);(o=this.localEventService)==null||o.dispatchEvent(r)}updateDataOnDetailNode(){this.detailNode&&(this.detailNode.data=this.data)}createDataChangedEvent(e,n,i){return{type:"dataChanged",node:this,oldData:n,newData:e,update:i}}getRowIndexString(){return this.rowIndex==null?(_s("Could not find rowIndex, this means tasks are being executed on a rowNode that has been removed from the grid."),null):this.rowPinned==="top"?"t-"+this.rowIndex:this.rowPinned==="bottom"?"b-"+this.rowIndex:this.rowIndex.toString()}createDaemonNode(){const e=new K0(this.beans);return e.id=this.id,e.data=this.data,e.__daemon=!0,e.selected=this.selected,e.level=this.level,e}setDataAndId(e,n){var c;const i=$n(this.id)?this.createDaemonNode():null,r=this.data;this.data=e,this.updateDataOnDetailNode(),this.setId(n),this.checkRowSelectable(),this.beans.selectionService.syncInRowNode(this,i);const o=this.createDataChangedEvent(e,r,!1);(c=this.localEventService)==null||c.dispatchEvent(o)}checkRowSelectable(){const e=this.beans.gos.get("isRowSelectable");this.setRowSelectable(e?e(this):!0)}setRowSelectable(e,n){if(this.selectable!==e){if(this.selectable=e,this.dispatchRowEvent("selectableChanged"),n)return;if(this.beans.gos.get("groupSelectsChildren")){const r=this.calculateSelectedFromChildren();this.setSelectedParams({newValue:r??!1,source:"selectableChanged"});return}this.isSelected()&&!this.selectable&&this.setSelectedParams({newValue:!1,source:"selectableChanged"})}}setId(e){const n=this.beans.gos.getRowIdCallback();if(n)if(this.data){const i=this.getGroupKeys(!0);this.id=n({data:this.data,parentKeys:i.length>0?i:void 0,level:this.level,rowPinned:this.rowPinned}),this.id.startsWith(K0.ID_PREFIX_ROW_GROUP)&&_s(`Row IDs cannot start with ${K0.ID_PREFIX_ROW_GROUP}, this is a reserved prefix for AG Grid's row grouping feature.`)}else this.id=void 0;else this.id=e}getGroupKeys(e=!1){const n=[];let i=this;for(e&&(i=i.parent);i&&i.level>=0;)n.push(i.key),i=i.parent;return n.reverse(),n}isPixelInRange(e){return!$n(this.rowTop)||!$n(this.rowHeight)?!1:e>=this.rowTop&&e<this.rowTop+this.rowHeight}updateIfDifferent(e,n,i){this[e]!==n&&(this[e]=n,this.dispatchRowEvent(i))}setFirstChild(e){this.updateIfDifferent("firstChild",e,"firstChildChanged")}setLastChild(e){this.updateIfDifferent("lastChild",e,"lastChildChanged")}setChildIndex(e){this.updateIfDifferent("childIndex",e,"childIndexChanged")}setRowTop(e){this.oldRowTop=this.rowTop,this.rowTop!==e&&(this.rowTop=e,this.dispatchRowEvent("topChanged"),this.setDisplayed(e!==null))}clearRowTopAndRowIndex(){this.oldRowTop=null,this.setRowTop(null),this.setRowIndex(null)}setDisplayed(e){this.updateIfDifferent("displayed",e,"displayedChanged")}setDragging(e){this.updateIfDifferent("dragging",e,"draggingChanged")}setHighlighted(e){this.updateIfDifferent("highlighted",e,"rowHighlightChanged")}setHovered(e){this.hovered!==e&&(this.hovered=e)}isHovered(){return this.hovered}setAllChildrenCount(e){this.updateIfDifferent("allChildrenCount",e,"allChildrenCountChanged")}setMaster(e){this.master!==e&&(this.master&&!e&&(this.expanded=!1),this.master=e,this.dispatchRowEvent("masterChanged"))}setGroup(e){this.group!==e&&(this.group&&!e&&(this.expanded=!1),this.group=e,this.updateHasChildren(),this.checkRowSelectable(),this.dispatchRowEvent("groupChanged"))}setRowHeight(e,n=!1){this.rowHeight=e,this.rowHeightEstimated=n,this.dispatchRowEvent("heightChanged")}setRowAutoHeight(e,n){this.__autoHeights||(this.__autoHeights={}),this.__autoHeights[n.getId()]=e,e!=null&&(this.checkAutoHeightsDebounced==null&&(this.checkAutoHeightsDebounced=Kl(this.checkAutoHeights.bind(this),1)),this.checkAutoHeightsDebounced())}checkAutoHeights(){let e=!1,n=!0,i=0;const r=this.__autoHeights;if(r==null||(this.beans.visibleColsService.getAllAutoHeightCols().forEach(s=>{let f=r[s.getId()];if(f==null)if(this.beans.columnModel.isColSpanActive()){let v=[];switch(s.getPinned()){case"left":v=this.beans.visibleColsService.getLeftColsForRow(this);break;case"right":v=this.beans.visibleColsService.getRightColsForRow(this);break;case null:v=this.beans.columnViewportService.getColsWithinViewport(this);break}if(v.includes(s)){e=!0;return}f=-1}else{e=!0;return}else n=!1;f>i&&(i=f)}),e)||((n||i<10)&&(i=this.beans.gos.getRowHeightForNode(this).height),i==this.rowHeight))return;this.setRowHeight(i);const c=this.beans.rowModel;c.onRowHeightChangedDebounced&&c.onRowHeightChangedDebounced()}setRowIndex(e){this.updateIfDifferent("rowIndex",e,"rowIndexChanged")}setUiLevel(e){this.updateIfDifferent("uiLevel",e,"uiLevelChanged")}setExpanded(e,n,i){if(this.expanded===e)return;this.expanded=e,this.dispatchRowEvent("expandedChanged");const r={...this.createGlobalRowEvent("rowGroupOpened"),expanded:e,event:n||null};this.beans.rowNodeEventThrottle.dispatchExpanded(r,i),this.beans.rowRenderer.refreshCells({rowNodes:[this]})}createGlobalRowEvent(e){return this.beans.gos.addGridCommonParams({type:e,node:this,data:this.data,rowIndex:this.rowIndex,rowPinned:this.rowPinned})}setDataValue(e,n,i){const o=typeof e!="string"?e:this.beans.columnModel.getCol(e)??this.beans.columnModel.getColDefCol(e),c=this.getValueFromValueService(o);if(this.beans.gos.get("readOnlyEdit"))return this.dispatchEventForSaveValueReadOnly(o,c,n,i),!1;const s=this.beans.valueService.setValue(this,o,n,i);return this.dispatchCellChangedEvent(o,n,c),this.checkRowSelectable(),s}getValueFromValueService(e){const n=this.leafGroup&&this.beans.columnModel.isPivotMode(),i=this.group&&this.expanded&&!this.footer&&!n;let r=!1;const o=this.beans.gos.get("groupTotalRow")??this.beans.gos.get("groupIncludeFooter");typeof o!="function"?r=!!o:r=!!(this.beans.gos.getCallback("groupTotalRow")??this.beans.gos.getCallback("groupIncludeFooter"))({node:this});const c=this.beans.gos.get("groupSuppressBlankHeader"),s=i&&r&&!c;return this.beans.valueService.getValue(e,this,!1,s)}dispatchEventForSaveValueReadOnly(e,n,i,r){const o=this.beans.gos.addGridCommonParams({type:"cellEditRequest",event:null,rowIndex:this.rowIndex,rowPinned:this.rowPinned,column:e,colDef:e.getColDef(),data:this.data,node:this,oldValue:n,newValue:i,value:i,source:r});this.beans.eventService.dispatchEvent(o)}setGroupValue(e,n){const i=this.beans.columnModel.getCol(e);Hr(this.groupData)&&(this.groupData={});const r=i.getColId(),o=this.groupData[r];o!==n&&(this.groupData[r]=n,this.dispatchCellChangedEvent(i,n,o))}setAggData(e){const n=this.aggData;if(this.aggData=e,this.localEventService){const i=r=>{const o=this.aggData?this.aggData[r]:void 0,c=n?n[r]:void 0;if(o===c)return;const s=this.beans.columnModel.getCol(r);s&&this.dispatchCellChangedEvent(s,o,c)};for(const r in this.aggData)i(r);for(const r in e)r in this.aggData||i(r)}}updateHasChildren(){let e=this.group&&!this.footer||this.childrenAfterGroup&&this.childrenAfterGroup.length>0;if(this.beans.gos.isRowModelType("serverSide")){const i=this.beans.gos.get("treeData"),r=this.beans.gos.get("isServerSideGroup");e=!this.stub&&!this.footer&&(i?!!r&&r(this.data):!!this.group)}e!==this.__hasChildren&&(this.__hasChildren=!!e,this.dispatchRowEvent("hasChildrenChanged"))}hasChildren(){return this.__hasChildren==null&&this.updateHasChildren(),this.__hasChildren}isEmptyRowGroupNode(){return(this.group&&Va(this.childrenAfterGroup))??!1}dispatchCellChangedEvent(e,n,i){var o;const r={type:"cellChanged",node:this,column:e,newValue:n,oldValue:i};(o=this.localEventService)==null||o.dispatchEvent(r)}resetQuickFilterAggregateText(){this.quickFilterAggregateText=null}isExpandable(){return this.footer?!1:this.beans.columnModel.isPivotMode()?this.hasChildren()&&!this.leafGroup:this.hasChildren()||!!this.master}isSelected(){return this.footer?this.sibling.isSelected():this.selected}depthFirstSearch(e){this.childrenAfterGroup&&this.childrenAfterGroup.forEach(n=>n.depthFirstSearch(e)),e(this)}calculateSelectedFromChildren(){var r;let e=!1,n=!1,i=!1;if(!((r=this.childrenAfterGroup)!=null&&r.length))return this.selectable?this.selected:null;for(let o=0;o<this.childrenAfterGroup.length;o++){const c=this.childrenAfterGroup[o];let s=c.isSelected();if(!c.selectable){const f=c.calculateSelectedFromChildren();if(f===null)continue;s=f}switch(s){case!0:e=!0;break;case!1:n=!0;break;default:i=!0;break}}if(!(i||e&&n))return e?!0:n?!1:this.selectable?this.selected:null}setSelectedInitialValue(e){this.selected=e}dispatchRowEvent(e){var i;const n={type:e,node:this};(i=this.localEventService)==null||i.dispatchEvent(n)}selectThisNode(e,n,i="api"){const r=!this.selectable&&e,o=this.selected===e;if(r||o)return!1;this.selected=e,this.dispatchRowEvent("rowSelected");const c=this.sibling;c&&c.footer&&c.localEventService&&c.dispatchRowEvent("rowSelected");const s={...this.createGlobalRowEvent("rowSelected"),event:n||null,source:i};return this.beans.eventService.dispatchEvent(s),!0}setSelected(e,n=!1,i="api"){if(typeof i=="boolean"){Tn("since version v30, rowNode.setSelected() property `suppressFinishActions` has been removed, please use `gridApi.setNodesSelected()` for bulk actions, and the event `source` property for ignoring events instead.");return}this.setSelectedParams({newValue:e,clearSelection:n,rangeSelect:!1,source:i})}setSelectedParams(e){return this.rowPinned?(Tn("cannot select pinned rows"),0):this.id===void 0?(Tn("cannot select node until id for node is known"),0):this.beans.selectionService.setNodesSelected({...e,nodes:[this.footer?this.sibling:this]})}isRowPinned(){return this.rowPinned==="top"||this.rowPinned==="bottom"}isParentOfNode(e){let n=this.parent;for(;n;){if(n===e)return!0;n=n.parent}return!1}addEventListener(e,n){var r;this.localEventService||(this.localEventService=new Cw),this.beans.frameworkOverrides.shouldWrapOutgoing&&!this.frameworkEventListenerService&&(this.localEventService.setFrameworkOverrides(this.beans.frameworkOverrides),this.frameworkEventListenerService=new f3(this.beans.frameworkOverrides));const i=((r=this.frameworkEventListenerService)==null?void 0:r.wrap(n))??n;this.localEventService.addEventListener(e,i)}removeEventListener(e,n){var r;if(!this.localEventService)return;const i=((r=this.frameworkEventListenerService)==null?void 0:r.unwrap(n))??n;this.localEventService.removeEventListener(e,i),this.localEventService.noRegisteredListenersExist()&&(this.localEventService=null)}onMouseEnter(){this.dispatchRowEvent("mouseEnter")}onMouseLeave(){this.dispatchRowEvent("mouseLeave")}getFirstChildOfFirstChild(e){let n=this,i=!0,r=!1,o=null;for(;i&&!r;){const c=n.parent;$n(c)&&n.firstChild?c.rowGroupColumn===e&&(r=!0,o=c):i=!1,n=c}return r?o:null}isFullWidthCell(){if(this.detail)return!0;const e=this.beans.gos.getCallback("isFullWidthRow");return e?e({rowNode:this}):!1}getRoute(){if(this.key==null)return;const e=[];let n=this;for(;n&&n.key!=null;)e.push(n.key),n=n.parent;return e.reverse()}createFooter(){if(this.sibling)return;const e=new Set(["eventService","__objectId","sticky"]),n=new K0(this.beans);Object.keys(this).forEach(i=>{e.has(i)||(n[i]=this[i])}),n.footer=!0,n.setRowTop(null),n.setRowIndex(null),n.oldRowTop=null,n.id="rowGroupFooter_"+this.id,n.sibling=this,this.sibling=n}destroyFooter(){this.sibling&&(this.sibling.setRowTop(null),this.sibling.setRowIndex(null),this.sibling=void 0)}};GS.ID_PREFIX_ROW_GROUP="row-group-";GS.ID_PREFIX_TOP_PINNED="t-";GS.ID_PREFIX_BOTTOM_PINNED="b-";GS.OBJECT_ID_SEQUENCE=0;var Vp=GS,lhe=class extends wn{constructor(){super(...arguments),this.beanName="filterManager",this.advancedFilterModelUpdateQueue=[]}wireBeans(t){this.columnModel=t.columnModel,this.dataTypeService=t.dataTypeService,this.quickFilterService=t.quickFilterService,this.advancedFilterService=t.advancedFilterService,this.columnFilterService=t.columnFilterService}postConstruct(){this.addManagedEventListeners({columnValueChanged:this.refreshFiltersForAggregations.bind(this),columnPivotChanged:this.refreshFiltersForAggregations.bind(this),columnPivotModeChanged:this.refreshFiltersForAggregations.bind(this),newColumnsLoaded:this.updateAdvancedFilterColumns.bind(this),columnVisible:this.updateAdvancedFilterColumns.bind(this),advancedFilterEnabledChanged:({enabled:t})=>this.onAdvancedFilterEnabledChanged(t),dataTypesInferred:this.processFilterModelUpdateQueue.bind(this)}),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.addManagedPropertyListeners(["isExternalFilterPresent","doesExternalFilterPass"],()=>{this.onFilterChanged({source:"api"})}),this.updateAggFiltering(),this.addManagedPropertyListener("groupAggFiltering",()=>{this.updateAggFiltering(),this.onFilterChanged()}),this.addManagedPropertyListener("advancedFilterModel",t=>this.setAdvancedFilterModel(t.currentValue)),this.quickFilterService&&this.addManagedListeners(this.quickFilterService,{quickFilterChanged:()=>this.onFilterChanged({source:"quickFilter"})})}isExternalFilterPresentCallback(){const t=this.gos.getCallback("isExternalFilterPresent");return typeof t=="function"?t({}):!1}doesExternalFilterPass(t){const e=this.gos.get("doesExternalFilterPass");return typeof e=="function"?e(t):!1}setFilterModel(t,e="api"){var n;if(this.isAdvancedFilterEnabled()){this.warnAdvancedFilters();return}(n=this.columnFilterService)==null||n.setFilterModel(t,e)}getFilterModel(){var t;return((t=this.columnFilterService)==null?void 0:t.getFilterModel())??{}}isColumnFilterPresent(){var t;return!!((t=this.columnFilterService)!=null&&t.isColumnFilterPresent())}isAggregateFilterPresent(){var t;return!!((t=this.columnFilterService)!=null&&t.isAggregateFilterPresent())}isExternalFilterPresent(){return this.externalFilterPresent}isChildFilterPresent(){return this.isColumnFilterPresent()||this.isQuickFilterPresent()||this.isExternalFilterPresent()||this.isAdvancedFilterPresent()}isAdvancedFilterPresent(){return this.isAdvancedFilterEnabled()&&this.advancedFilterService.isFilterPresent()}onAdvancedFilterEnabledChanged(t){var e,n;t?(e=this.columnFilterService)!=null&&e.disableColumnFilters()&&this.onFilterChanged({source:"advancedFilter"}):(n=this.advancedFilterService)!=null&&n.isFilterPresent()&&(this.advancedFilterService.setModel(null),this.onFilterChanged({source:"advancedFilter"}))}isAdvancedFilterEnabled(){var t;return!!((t=this.advancedFilterService)!=null&&t.isEnabled())}isAdvancedFilterHeaderActive(){return this.isAdvancedFilterEnabled()&&this.advancedFilterService.isHeaderActive()}isAnyFilterPresent(){return this.isQuickFilterPresent()||this.isColumnFilterPresent()||this.isAggregateFilterPresent()||this.isExternalFilterPresent()||this.isAdvancedFilterPresent()}resetQuickFilterCache(){var t;(t=this.quickFilterService)==null||t.resetQuickFilterCache()}refreshFiltersForAggregations(){this.gos.getGroupAggFiltering()&&this.onFilterChanged()}onFilterChanged(t={}){const{source:e,additionalEventAttributes:n,columns:i=[]}=t;this.externalFilterPresent=this.isExternalFilterPresentCallback(),(this.columnFilterService?this.columnFilterService.updateBeforeFilterChanged(t):Zo.resolve()).then(()=>{var o;const r={source:e,type:"filterChanged",columns:i};n&&Xu(r,n),this.eventService.dispatchEvent(r),(o=this.columnFilterService)==null||o.updateAfterFilterChanged()})}isSuppressFlashingCellsBecauseFiltering(){var t;return!!((t=this.columnFilterService)!=null&&t.isSuppressFlashingCellsBecauseFiltering())}isQuickFilterPresent(){var t;return!!((t=this.quickFilterService)!=null&&t.isQuickFilterPresent())}updateAggFiltering(){this.aggFiltering=!!this.gos.getGroupAggFiltering()}isAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&this.shouldApplyQuickFilterAfterAgg()}isNonAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&!this.shouldApplyQuickFilterAfterAgg()}shouldApplyQuickFilterAfterAgg(){return(this.aggFiltering||this.columnModel.isPivotMode())&&!this.gos.get("applyQuickFilterBeforePivotOrAgg")}doesRowPassOtherFilters(t,e){return this.doesRowPassFilter({rowNode:e,filterInstanceToSkip:t})}doesRowPassAggregateFilters(t){return!(this.isAggregateQuickFilterPresent()&&!this.quickFilterService.doesRowPassQuickFilter(t.rowNode)||this.isAggregateFilterPresent()&&!this.columnFilterService.doAggregateFiltersPass(t.rowNode,t.filterInstanceToSkip))}doesRowPassFilter(t){return!(this.isNonAggregateQuickFilterPresent()&&!this.quickFilterService.doesRowPassQuickFilter(t.rowNode)||this.isExternalFilterPresent()&&!this.doesExternalFilterPass(t.rowNode)||this.isColumnFilterPresent()&&!this.columnFilterService.doColumnFiltersPass(t.rowNode,t.filterInstanceToSkip)||this.isAdvancedFilterPresent()&&!this.advancedFilterService.doesFilterPass(t.rowNode))}isFilterActive(t){var e;return!!((e=this.columnFilterService)!=null&&e.isFilterActive(t))}getOrCreateFilterWrapper(t){var e;return((e=this.columnFilterService)==null?void 0:e.getOrCreateFilterWrapper(t))??null}getDefaultFloatingFilter(t){return this.columnFilterService.getDefaultFloatingFilter(t)}createFilterParams(t,e){return this.columnFilterService.createFilterParams(t,e)}isFilterAllowed(t){var e;return this.isAdvancedFilterEnabled()?!1:!!((e=this.columnFilterService)!=null&&e.isFilterAllowed(t))}getFloatingFilterCompDetails(t,e){var n;return(n=this.columnFilterService)==null?void 0:n.getFloatingFilterCompDetails(t,e)}getCurrentFloatingFilterParentModel(t){var e;return(e=this.columnFilterService)==null?void 0:e.getCurrentFloatingFilterParentModel(t)}destroyFilter(t,e="api"){var n;(n=this.columnFilterService)==null||n.destroyFilter(t,e)}areFilterCompsDifferent(t,e){var n;return!!((n=this.columnFilterService)!=null&&n.areFilterCompsDifferent(t,e))}getAdvancedFilterModel(){return this.isAdvancedFilterEnabled()?this.advancedFilterService.getModel():null}setAdvancedFilterModel(t){var e;if(this.isAdvancedFilterEnabled()){if((e=this.dataTypeService)!=null&&e.isPendingInference()){this.advancedFilterModelUpdateQueue.push(t);return}this.advancedFilterService.setModel(t??null),this.onFilterChanged({source:"advancedFilter"})}}toggleAdvancedFilterBuilder(t,e){this.isAdvancedFilterEnabled()&&this.advancedFilterService.getCtrl().toggleFilterBuilder(e,t)}updateAdvancedFilterColumns(){this.isAdvancedFilterEnabled()&&this.advancedFilterService.updateValidity()&&this.onFilterChanged({source:"advancedFilter"})}hasFloatingFilters(){var t;return this.isAdvancedFilterEnabled()?!1:!!((t=this.columnFilterService)!=null&&t.hasFloatingFilters())}getFilterInstance(t,e){var n;if(this.isAdvancedFilterEnabled()){this.warnAdvancedFilters();return}return(n=this.columnFilterService)==null?void 0:n.getFilterInstance(t,e)}getColumnFilterInstance(t){var e;return this.isAdvancedFilterEnabled()?(this.warnAdvancedFilters(),Promise.resolve(void 0)):((e=this.columnFilterService)==null?void 0:e.getColumnFilterInstance(t))??Promise.resolve(void 0)}warnAdvancedFilters(){Tn("Column Filter API methods have been disabled as Advanced Filters are enabled.")}setupAdvancedFilterHeaderComp(t){var e;(e=this.advancedFilterService)==null||e.getCtrl().setupHeaderComp(t)}getHeaderRowCount(){return this.isAdvancedFilterHeaderActive()?1:0}getHeaderHeight(){return this.isAdvancedFilterHeaderActive()?this.advancedFilterService.getCtrl().getHeaderHeight():0}processFilterModelUpdateQueue(){this.advancedFilterModelUpdateQueue.forEach(t=>this.setAdvancedFilterModel(t)),this.advancedFilterModelUpdateQueue=[]}getColumnFilterModel(t){var e;return(e=this.columnFilterService)==null?void 0:e.getColumnFilterModel(t)}setColumnFilterModel(t,e){var n;return this.isAdvancedFilterEnabled()?(this.warnAdvancedFilters(),Promise.resolve()):((n=this.columnFilterService)==null?void 0:n.setColumnFilterModel(t,e))??Promise.resolve()}},che=class extends Js{constructor(t,e){super('<div class="ag-filter"></div>'),this.column=t,this.source=e,this.filterWrapper=null}wireBeans(t){this.filterManager=t.filterManager,this.columnModel=t.columnModel}postConstruct(){this.createFilter(!0),this.addManagedEventListeners({filterDestroyed:this.onFilterDestroyed.bind(this)})}hasFilter(){return!!this.filterWrapper}getFilter(){var t;return((t=this.filterWrapper)==null?void 0:t.filterPromise)??null}afterInit(){var t,e;return((e=(t=this.filterWrapper)==null?void 0:t.filterPromise)==null?void 0:e.then(()=>{}))??Zo.resolve()}afterGuiAttached(t){var e,n;(n=(e=this.filterWrapper)==null?void 0:e.filterPromise)==null||n.then(i=>{var r;(r=i==null?void 0:i.afterGuiAttached)==null||r.call(i,t)})}afterGuiDetached(){var t,e;(e=(t=this.filterWrapper)==null?void 0:t.filterPromise)==null||e.then(n=>{var i;(i=n==null?void 0:n.afterGuiDetached)==null||i.call(n)})}createFilter(t){var i,r;const{column:e,source:n}=this;this.filterWrapper=((i=this.filterManager)==null?void 0:i.getOrCreateFilterWrapper(e))??null,(r=this.filterWrapper)!=null&&r.filterPromise&&this.filterWrapper.filterPromise.then(o=>{const c=o.getGui();if($n(c)||Tn(`getGui method from filter returned ${c}; it should be a DOM element.`),this.appendChild(c),t){const s={type:"filterOpened",column:e,source:n,eGui:this.getGui()};this.eventService.dispatchEvent(s)}})}onFilterDestroyed(t){(t.source==="api"||t.source==="paramsUpdated")&&t.column.getId()===this.column.getId()&&this.columnModel.getColDefCol(this.column)&&(Cu(this.getGui()),this.createFilter())}destroy(){this.filterWrapper=null,super.destroy()}},T7="ag-resizer-wrapper",uhe=`<div class="${T7}">
        <div data-ref="eTopLeftResizer" class="ag-resizer ag-resizer-topLeft"></div>
        <div data-ref="eTopResizer" class="ag-resizer ag-resizer-top"></div>
        <div data-ref="eTopRightResizer" class="ag-resizer ag-resizer-topRight"></div>
        <div data-ref="eRightResizer" class="ag-resizer ag-resizer-right"></div>
        <div data-ref="eBottomRightResizer" class="ag-resizer ag-resizer-bottomRight"></div>
        <div data-ref="eBottomResizer" class="ag-resizer ag-resizer-bottom"></div>
        <div data-ref="eBottomLeftResizer" class="ag-resizer ag-resizer-bottomLeft"></div>
        <div data-ref="eLeftResizer" class="ag-resizer ag-resizer-left"></div>
    </div>`,hhe=class extends wn{constructor(t,e){super(),this.element=t,this.dragStartPosition={x:0,y:0},this.position={x:0,y:0},this.lastSize={width:-1,height:-1},this.positioned=!1,this.resizersAdded=!1,this.resizeListeners=[],this.boundaryEl=null,this.isResizing=!1,this.isMoving=!1,this.resizable={},this.movable=!1,this.currentResizer=null,this.config=Object.assign({},{popup:!1},e)}wireBeans(t){this.popupService=t.popupService,this.resizeObserverService=t.resizeObserverService,this.dragService=t.dragService}center(){const{clientHeight:t,clientWidth:e}=this.offsetParent,n=e/2-this.getWidth()/2,i=t/2-this.getHeight()/2;this.offsetElement(n,i)}initialisePosition(){if(this.positioned)return;const{centered:t,forcePopupParentAsOffsetParent:e,minWidth:n,width:i,minHeight:r,height:o,x:c,y:s}=this.config;this.offsetParent||this.setOffsetParent();let f=0,v=0;const w=Ef(this.element);if(w){const C=this.findBoundaryElement(),M=window.getComputedStyle(C);if(M.minWidth!=null){const F=C.offsetWidth-this.element.offsetWidth;v=parseInt(M.minWidth,10)-F}if(M.minHeight!=null){const F=C.offsetHeight-this.element.offsetHeight;f=parseInt(M.minHeight,10)-F}}if(this.minHeight=r||f,this.minWidth=n||v,i&&this.setWidth(i),o&&this.setHeight(o),(!i||!o)&&this.refreshSize(),t)this.center();else if(c||s)this.offsetElement(c,s);else if(w&&e){let C=this.boundaryEl,M=!0;if(C||(C=this.findBoundaryElement(),M=!1),C){const F=parseFloat(C.style.top),N=parseFloat(C.style.left);M?this.offsetElement(isNaN(N)?0:N,isNaN(F)?0:F):this.setPosition(N,F)}}this.positioned=!!this.offsetParent}isPositioned(){return this.positioned}getPosition(){return this.position}setMovable(t,e){if(!this.config.popup||t===this.movable)return;this.movable=t;const n=this.moveElementDragListener||{eElement:e,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)};t?(this.dragService.addDragSource(n),this.moveElementDragListener=n):(this.dragService.removeDragSource(n),this.moveElementDragListener=void 0)}setResizable(t){if(this.clearResizeListeners(),t?this.addResizers():this.removeResizers(),typeof t=="boolean"){if(t===!1)return;t={topLeft:t,top:t,topRight:t,right:t,bottomRight:t,bottom:t,bottomLeft:t,left:t}}Object.keys(t).forEach(e=>{const i=!!t[e],r=this.getResizerElement(e),o={dragStartPixels:0,eElement:r,onDragStart:c=>this.onResizeStart(c,e),onDragging:this.onResize.bind(this),onDragStop:c=>this.onResizeEnd(c,e)};(i||!this.isAlive()&&!i)&&(i?(this.dragService.addDragSource(o),this.resizeListeners.push(o),r.style.pointerEvents="all"):r.style.pointerEvents="none",this.resizable[e]=i)})}removeSizeFromEl(){this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("flex")}restoreLastSize(){this.element.style.flex="0 0 auto";const{height:t,width:e}=this.lastSize;e!==-1&&(this.element.style.width=`${e}px`),t!==-1&&(this.element.style.height=`${t}px`)}getHeight(){return this.element.offsetHeight}setHeight(t){const{popup:e}=this.config,n=this.element;let i=!1;if(typeof t=="string"&&t.indexOf("%")!==-1)C1(n,t),t=f7(n),i=!0;else if(t=Math.max(this.minHeight,t),this.positioned){const r=this.getAvailableHeight();r&&t>r&&(t=r)}this.getHeight()!==t&&(i?(n.style.maxHeight="unset",n.style.minHeight="unset"):e?C1(n,t):(n.style.height=`${t}px`,n.style.flex="0 0 auto",this.lastSize.height=typeof t=="number"?t:parseFloat(t)))}getAvailableHeight(){const{popup:t,forcePopupParentAsOffsetParent:e}=this.config;this.positioned||this.initialisePosition();const{clientHeight:n}=this.offsetParent;if(!n)return null;const i=this.element.getBoundingClientRect(),r=this.offsetParent.getBoundingClientRect(),o=t?this.position.y:i.top,c=t?0:r.top;let s=0;if(e){const v=this.element.parentElement;if(v){const{bottom:w}=v.getBoundingClientRect();s=w-i.bottom}}return n+c-o-s}getWidth(){return this.element.offsetWidth}setWidth(t){const e=this.element,{popup:n}=this.config;let i=!1;if(typeof t=="string"&&t.indexOf("%")!==-1)sd(e,t),t=iT(e),i=!0;else if(this.positioned){t=Math.max(this.minWidth,t);const{clientWidth:r}=this.offsetParent,o=n?this.position.x:this.element.getBoundingClientRect().left;r&&t+o>r&&(t=r-o)}this.getWidth()!==t&&(i?(e.style.maxWidth="unset",e.style.minWidth="unset"):this.config.popup?sd(e,t):(e.style.width=`${t}px`,e.style.flex=" unset",this.lastSize.width=typeof t=="number"?t:parseFloat(t)))}offsetElement(t=0,e=0){const{forcePopupParentAsOffsetParent:n}=this.config,i=n?this.boundaryEl:this.element;i&&(this.popupService.positionPopup({ePopup:i,keepWithinBounds:!0,skipObserver:this.movable||this.isResizable(),updatePosition:()=>({x:t,y:e})}),this.setPosition(parseFloat(i.style.left),parseFloat(i.style.top)))}constrainSizeToAvailableHeight(t){if(!this.config.forcePopupParentAsOffsetParent)return;const e=()=>{const n=this.getAvailableHeight();this.element.style.setProperty("max-height",`${n}px`)};t?this.resizeObserverSubscriber=this.resizeObserverService.observeResize(this.popupService.getPopupParent(),e):(this.element.style.removeProperty("max-height"),this.resizeObserverSubscriber&&(this.resizeObserverSubscriber(),this.resizeObserverSubscriber=void 0))}setPosition(t,e){this.position.x=t,this.position.y=e}updateDragStartPosition(t,e){this.dragStartPosition={x:t,y:e}}calculateMouseMovement(t){const{e,isLeft:n,isTop:i,anywhereWithin:r,topBuffer:o}=t,c=e.clientX-this.dragStartPosition.x,s=e.clientY-this.dragStartPosition.y,f=this.shouldSkipX(e,!!n,!!r,c)?0:c,v=this.shouldSkipY(e,!!i,o,s)?0:s;return{movementX:f,movementY:v}}shouldSkipX(t,e,n,i){const r=this.element.getBoundingClientRect(),o=this.offsetParent.getBoundingClientRect(),c=this.boundaryEl.getBoundingClientRect(),s=this.config.popup?this.position.x:r.left;let f=s<=0&&o.left>=t.clientX||o.right<=t.clientX&&o.right<=c.right;return f?!0:(e?f=i<0&&t.clientX>s+o.left||i>0&&t.clientX<s+o.left:n?f=i<0&&t.clientX>c.right||i>0&&t.clientX<s+o.left:f=i<0&&t.clientX>c.right||i>0&&t.clientX<c.right,f)}shouldSkipY(t,e,n=0,i){const r=this.element.getBoundingClientRect(),o=this.offsetParent.getBoundingClientRect(),c=this.boundaryEl.getBoundingClientRect(),s=this.config.popup?this.position.y:r.top;let f=s<=0&&o.top>=t.clientY||o.bottom<=t.clientY&&o.bottom<=c.bottom;return f?!0:(e?f=i<0&&t.clientY>s+o.top+n||i>0&&t.clientY<s+o.top:f=i<0&&t.clientY>c.bottom||i>0&&t.clientY<c.bottom,f)}createResizeMap(){const t=this.element;this.resizerMap={topLeft:{element:t.querySelector("[data-ref=eTopLeftResizer]")},top:{element:t.querySelector("[data-ref=eTopResizer]")},topRight:{element:t.querySelector("[data-ref=eTopRightResizer]")},right:{element:t.querySelector("[data-ref=eRightResizer]")},bottomRight:{element:t.querySelector("[data-ref=eBottomRightResizer]")},bottom:{element:t.querySelector("[data-ref=eBottomResizer]")},bottomLeft:{element:t.querySelector("[data-ref=eBottomLeftResizer]")},left:{element:t.querySelector("[data-ref=eLeftResizer]")}}}addResizers(){if(this.resizersAdded)return;const t=this.element;if(!t)return;const n=new DOMParser().parseFromString(uhe,"text/html").body;t.appendChild(n.firstChild),this.createResizeMap(),this.resizersAdded=!0}removeResizers(){this.resizerMap=void 0;const t=this.element.querySelector(`.${T7}`);t&&this.element.removeChild(t),this.resizersAdded=!1}getResizerElement(t){return this.resizerMap[t].element}onResizeStart(t,e){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.currentResizer={isTop:!!e.match(/top/i),isRight:!!e.match(/right/i),isBottom:!!e.match(/bottom/i),isLeft:!!e.match(/left/i)},this.element.classList.add("ag-resizing"),this.resizerMap[e].element.classList.add("ag-active");const{popup:n,forcePopupParentAsOffsetParent:i}=this.config;!n&&!i&&this.applySizeToSiblings(this.currentResizer.isBottom||this.currentResizer.isTop),this.isResizing=!0,this.updateDragStartPosition(t.clientX,t.clientY)}getSiblings(){const e=this.element.parentElement;return e?Array.prototype.slice.call(e.children).filter(n=>!n.classList.contains("ag-hidden")):null}getMinSizeOfSiblings(){const t=this.getSiblings()||[];let e=0,n=0;for(let i=0;i<t.length;i++){const r=t[i],o=!!r.style.flex&&r.style.flex!=="0 0 auto";if(r===this.element)continue;let c=this.minHeight||0,s=this.minWidth||0;if(o){const f=window.getComputedStyle(r);f.minHeight&&(c=parseInt(f.minHeight,10)),f.minWidth&&(s=parseInt(f.minWidth,10))}else c=r.offsetHeight,s=r.offsetWidth;e+=c,n+=s}return{height:e,width:n}}applySizeToSiblings(t){let e=null;const n=this.getSiblings();if(n){for(let i=0;i<n.length;i++){const r=n[i];r!==e&&(t?r.style.height=`${r.offsetHeight}px`:r.style.width=`${r.offsetWidth}px`,r.style.flex="0 0 auto",r===this.element&&(e=n[i+1]))}e&&(e.style.removeProperty("height"),e.style.removeProperty("min-height"),e.style.removeProperty("max-height"),e.style.flex="1 1 auto")}}isResizable(){return Object.values(this.resizable).some(t=>t)}onResize(t){if(!this.isResizing||!this.currentResizer)return;const{popup:e,forcePopupParentAsOffsetParent:n}=this.config,{isTop:i,isRight:r,isBottom:o,isLeft:c}=this.currentResizer,s=r||c,f=o||i,{movementX:v,movementY:w}=this.calculateMouseMovement({e:t,isLeft:c,isTop:i}),C=this.position.x,M=this.position.y;let F=0,N=0;if(s&&v){const z=c?-1:1,L=this.getWidth(),P=L+v*z;let H=!1;c&&(F=L-P,(C+F<=0||P<=this.minWidth)&&(H=!0,F=0)),H||this.setWidth(P)}if(f&&w){const z=i?-1:1,L=this.getHeight(),P=L+w*z;let H=!1;i?(N=L-P,(M+N<=0||P<=this.minHeight)&&(H=!0,N=0)):!this.config.popup&&!this.config.forcePopupParentAsOffsetParent&&L<P&&this.getMinSizeOfSiblings().height+P>this.element.parentElement.offsetHeight&&(H=!0),H||this.setHeight(P)}this.updateDragStartPosition(t.clientX,t.clientY),((e||n)&&F||N)&&this.offsetElement(C+F,M+N)}onResizeEnd(t,e){this.isResizing=!1,this.currentResizer=null,this.boundaryEl=null,this.element.classList.remove("ag-resizing"),this.resizerMap[e].element.classList.remove("ag-active"),this.dispatchLocalEvent({type:"resize"})}refreshSize(){const t=this.element;this.config.popup&&(this.config.width||this.setWidth(t.offsetWidth),this.config.height||this.setHeight(t.offsetHeight))}onMoveStart(t){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.isMoving=!0,this.element.classList.add("ag-moving"),this.updateDragStartPosition(t.clientX,t.clientY)}onMove(t){if(!this.isMoving)return;const{x:e,y:n}=this.position;let i;this.config.calculateTopBuffer&&(i=this.config.calculateTopBuffer());const{movementX:r,movementY:o}=this.calculateMouseMovement({e:t,isTop:!0,anywhereWithin:!0,topBuffer:i});this.offsetElement(e+r,n+o),this.updateDragStartPosition(t.clientX,t.clientY)}onMoveEnd(){this.isMoving=!1,this.boundaryEl=null,this.element.classList.remove("ag-moving")}setOffsetParent(){this.config.forcePopupParentAsOffsetParent?this.offsetParent=this.popupService.getPopupParent():this.offsetParent=this.element.offsetParent}findBoundaryElement(){let t=this.element;for(;t;){if(window.getComputedStyle(t).position!=="static")return t;t=t.parentElement}return this.element}clearResizeListeners(){for(;this.resizeListeners.length;){const t=this.resizeListeners.pop();this.dragService.removeDragSource(t)}}destroy(){super.destroy(),this.moveElementDragListener&&this.dragService.removeDragSource(this.moveElementDragListener),this.constrainSizeToAvailableHeight(!1),this.clearResizeListeners(),this.removeResizers()}},A7=class P7 extends wn{constructor(e,n={}){super(),this.eFocusableElement=e,this.callbacks=n,this.callbacks={shouldStopEventPropagation:()=>!1,onTabKeyDown:i=>{if(i.defaultPrevented)return;const r=this.focusService.findNextFocusableElement(this.eFocusableElement,!1,i.shiftKey);r&&(r.focus(),i.preventDefault())},...n}}wireBeans(e){this.focusService=e.focusService}postConstruct(){this.eFocusableElement.classList.add(P7.FOCUS_MANAGED_CLASS),this.addKeyDownListeners(this.eFocusableElement),this.callbacks.onFocusIn&&this.addManagedElementListeners(this.eFocusableElement,{focusin:this.callbacks.onFocusIn}),this.callbacks.onFocusOut&&this.addManagedElementListeners(this.eFocusableElement,{focusout:this.callbacks.onFocusOut})}addKeyDownListeners(e){this.addManagedElementListeners(e,{keydown:n=>{if(!(n.defaultPrevented||Yg(n))){if(this.callbacks.shouldStopEventPropagation(n)){tw(n);return}n.key===mn.TAB?this.callbacks.onTabKeyDown(n):this.callbacks.handleKeyDown&&this.callbacks.handleKeyDown(n)}}})}};A7.FOCUS_MANAGED_CLASS="ag-focus-managed";var B_=A7,I7={applyFilter:"Apply",clearFilter:"Clear",resetFilter:"Reset",cancelFilter:"Cancel",textFilter:"Text Filter",numberFilter:"Number Filter",dateFilter:"Date Filter",setFilter:"Set Filter",filterOoo:"Filter...",empty:"Choose one",equals:"Equals",notEqual:"Does not equal",lessThan:"Less than",greaterThan:"Greater than",inRange:"Between",inRangeStart:"From",inRangeEnd:"To",lessThanOrEqual:"Less than or equal to",greaterThanOrEqual:"Greater than or equal to",contains:"Contains",notContains:"Does not contain",startsWith:"Begins with",endsWith:"Ends with",blank:"Blank",notBlank:"Not blank",before:"Before",after:"After",andCondition:"AND",orCondition:"OR",dateFormatOoo:"yyyy-mm-dd"};function A3(t,e){return lT(t)?(t.debounceMs!=null&&Tn("debounceMs is ignored when apply button is present"),0):t.debounceMs!=null?t.debounceMs:e}function lT(t){return!!t.buttons&&t.buttons.indexOf("apply")>=0}var dhe=class extends Js{constructor(t){super(),this.filterNameKey=t,this.applyActive=!1,this.hidePopup=null,this.debouncePending=!1,this.appliedModel=null,this.eFilterBody=qi,this.buttonListeners=[]}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.resetTemplate(),this.createManagedBean(new B_(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.positionableFeature=new hhe(this.getPositionableElement(),{forcePopupParentAsOffsetParent:!0}),this.createBean(this.positionableFeature)}handleKeyDown(t){}getFilterTitle(){return this.translate(this.filterNameKey)}isFilterActive(){return!!this.appliedModel}resetTemplate(t){let e=this.getGui();e&&e.removeEventListener("submit",this.onFormSubmit);const n=`
            <form class="ag-filter-wrapper">
                <div class="ag-filter-body-wrapper ag-${this.getCssIdentifier()}-body-wrapper" data-ref="eFilterBody">
                    ${this.createBodyTemplate()}
                </div>
            </form>`;this.setTemplate(n,this.getAgComponents(),t),e=this.getGui(),e&&e.addEventListener("submit",this.onFormSubmit)}isReadOnly(){return!!this.providedFilterParams.readOnly}init(t){this.setParams(t),this.resetUiToDefaults(!0).then(()=>{this.updateUiVisibility(),this.setupOnBtApplyDebounce()})}setParams(t){this.providedFilterParams=t,this.applyActive=lT(t),this.resetButtonsPanel()}updateParams(t){this.providedFilterParams=t,this.applyActive=lT(t),this.resetUiToActiveModel(this.getModel(),()=>{this.updateUiVisibility(),this.setupOnBtApplyDebounce()})}resetButtonsPanel(){const{buttons:t}=this.providedFilterParams,e=t&&t.length>0&&!this.isReadOnly();if(this.eButtonsPanel?(Cu(this.eButtonsPanel),this.buttonListeners.forEach(r=>r()),this.buttonListeners=[]):e&&(this.eButtonsPanel=document.createElement("div"),this.eButtonsPanel.classList.add("ag-filter-apply-panel")),!e){this.eButtonsPanel&&w_(this.eButtonsPanel);return}const n=document.createDocumentFragment(),i=r=>{let o,c;switch(r){case"apply":o=this.translate("applyFilter"),c=v=>this.onBtApply(!1,!1,v);break;case"clear":o=this.translate("clearFilter"),c=()=>this.onBtClear();break;case"reset":o=this.translate("resetFilter"),c=()=>this.onBtReset();break;case"cancel":o=this.translate("cancelFilter"),c=v=>{this.onBtCancel(v)};break;default:Tn("Unknown button type specified");return}const f=iw(`<button
                    type="${r==="apply"?"submit":"button"}"
                    data-ref="${r}FilterButton"
                    class="ag-button ag-standard-button ag-filter-apply-panel-button"
                >${o}
                </button>`);this.buttonListeners.push(...this.addManagedElementListeners(f,{click:c})),n.append(f)};t.forEach(r=>i(r)),this.eButtonsPanel.append(n),this.getGui().appendChild(this.eButtonsPanel)}getDefaultDebounceMs(){return 0}setupOnBtApplyDebounce(){const t=A3(this.providedFilterParams,this.getDefaultDebounceMs()),e=Kl(this.checkApplyDebounce.bind(this),t);this.onBtApplyDebounce=()=>{this.debouncePending=!0,e()}}checkApplyDebounce(){this.debouncePending&&(this.debouncePending=!1,this.onBtApply())}getModel(){return this.appliedModel?this.appliedModel:null}setModel(t){return(t!=null?this.setModelIntoUi(t):this.resetUiToDefaults()).then(()=>{this.updateUiVisibility(),this.applyModel("api")})}onBtCancel(t){this.resetUiToActiveModel(this.getModel(),()=>{this.handleCancelEnd(t)})}handleCancelEnd(t){this.providedFilterParams.closeOnApply&&this.close(t)}resetUiToActiveModel(t,e){const n=()=>{this.onUiChanged(!1,"prevent"),e==null||e()};t!=null?this.setModelIntoUi(t).then(n):this.resetUiToDefaults().then(n)}onBtClear(){this.resetUiToDefaults().then(()=>this.onUiChanged())}onBtReset(){this.onBtClear(),this.onBtApply()}applyModel(t="api"){const e=this.getModelFromUi();if(!this.isModelValid(e))return!1;const n=this.appliedModel;return this.appliedModel=e,!this.areModelsEqual(n,e)}isModelValid(t){return!0}onFormSubmit(t){t.preventDefault()}onBtApply(t=!1,e=!1,n){n&&n.preventDefault(),this.applyModel(e?"rowDataUpdated":"ui")&&this.providedFilterParams.filterChangedCallback({afterFloatingFilter:t,afterDataChange:e,source:"columnFilter"});const{closeOnApply:i}=this.providedFilterParams;i&&this.applyActive&&!t&&!e&&this.close(n)}onNewRowsLoaded(){}close(t){if(!this.hidePopup)return;const e=t,n=e&&e.key;let i;(n==="Enter"||n==="Space")&&(i={keyboardEvent:e}),this.hidePopup(i),this.hidePopup=null}onUiChanged(t=!1,e){if(this.updateUiVisibility(),this.providedFilterParams.filterModifiedCallback(),this.applyActive&&!this.isReadOnly()){const n=this.isModelValid(this.getModelFromUi()),i=this.queryForHtmlElement('[data-ref="applyFilterButton"]');i&&oS(i,!n)}t&&!e||e==="immediately"?this.onBtApply(t):(!this.applyActive&&!e||e==="debounce")&&this.onBtApplyDebounce()}afterGuiAttached(t){t&&(this.hidePopup=t.hidePopup),this.refreshFilterResizer(t==null?void 0:t.container)}refreshFilterResizer(t){if(!this.positionableFeature||t==="toolPanel")return;const e=t==="floatingFilter"||t==="columnFilter",{positionableFeature:n,gos:i}=this;e?(n.restoreLastSize(),n.setResizable(i.get("enableRtl")?{bottom:!0,bottomLeft:!0,left:!0}:{bottom:!0,bottomRight:!0,right:!0})):(this.positionableFeature.removeSizeFromEl(),this.positionableFeature.setResizable(!1)),this.positionableFeature.constrainSizeToAvailableHeight(!0)}afterGuiDetached(){this.checkApplyDebounce(),this.positionableFeature&&this.positionableFeature.constrainSizeToAvailableHeight(!1)}refresh(t){return this.providedFilterParams=t,!0}destroy(){const t=this.getGui();t&&t.removeEventListener("submit",this.onFormSubmit),this.hidePopup=null,this.positionableFeature&&(this.positionableFeature=this.destroyBean(this.positionableFeature)),this.appliedModel=null,super.destroy()}translate(t){return this.localeService.getLocaleTextFunc()(t,I7[t])}getCellValue(t){return this.providedFilterParams.getValue(t)}getPositionableElement(){return this.eFilterBody}},fhe=class extends M3{constructor(t){super(t,"ag-radio-button","radio")}isSelected(){return this.eInput.checked}toggle(){this.eInput.disabled||this.isSelected()||this.setValue(!0)}addInputListeners(){super.addInputListeners(),this.addManagedEventListeners({checkboxChanged:this.onChange.bind(this)})}onChange(t){t.selected&&t.name&&this.eInput.name&&this.eInput.name===t.name&&t.id&&this.eInput.id!==t.id&&this.setValue(!1,!0)}},phe=class extends Js{constructor(t="default",e=!1){super(`<div class="ag-list ag-${t}-list" role="listbox"></div>`),this.cssIdentifier=t,this.unFocusable=e,this.activeClass="ag-active-item",this.options=[],this.itemEls=[]}postConstruct(){const t=this.getGui();this.addManagedElementListeners(t,{mouseleave:()=>this.clearHighlighted()}),!this.unFocusable&&this.addManagedElementListeners(t,{keydown:this.handleKeyDown.bind(this)})}handleKeyDown(t){const e=t.key;switch(e){case mn.ENTER:if(!this.highlightedEl)this.setValue(this.getValue());else{const n=this.itemEls.indexOf(this.highlightedEl);this.setValueByIndex(n)}break;case mn.DOWN:case mn.UP:t.preventDefault(),this.navigate(e);break;case mn.PAGE_DOWN:case mn.PAGE_UP:case mn.PAGE_HOME:case mn.PAGE_END:t.preventDefault(),this.navigateToPage(e);break}}navigate(t){const e=t===mn.DOWN;let n;if(!this.highlightedEl)n=this.itemEls[e?0:this.itemEls.length-1];else{let r=this.itemEls.indexOf(this.highlightedEl)+(e?1:-1);r=Math.min(Math.max(r,0),this.itemEls.length-1),n=this.itemEls[r]}this.highlightItem(n)}navigateToPage(t){if(!this.highlightedEl||this.itemEls.length===0)return;const e=this.itemEls.indexOf(this.highlightedEl),n=this.options.length-1,i=this.itemEls[0].clientHeight,r=Math.floor(this.getGui().clientHeight/i);let o=-1;t===mn.PAGE_HOME?o=0:t===mn.PAGE_END?o=n:t===mn.PAGE_DOWN?o=Math.min(e+r,n):t===mn.PAGE_UP&&(o=Math.max(e-r,0)),o!==-1&&this.highlightItem(this.itemEls[o])}addOptions(t){return t.forEach(e=>this.addOption(e)),this}addOption(t){const{value:e,text:n}=t,i=n||e;return this.options.push({value:e,text:i}),this.renderOption(e,i),this.updateIndices(),this}clearOptions(){this.options=[],this.reset(!0),this.itemEls.forEach(t=>{w_(t)}),this.itemEls=[]}updateIndices(){const t=this.getGui().querySelectorAll(".ag-list-item");t.forEach((e,n)=>{Xce(e,n+1),Zce(e,t.length)})}renderOption(t,e){const n=this.gos.getDocument(),i=n.createElement("div");ld(i,"option"),i.classList.add("ag-list-item",`ag-${this.cssIdentifier}-list-item`);const r=n.createElement("span");i.appendChild(r),r.textContent=e,this.unFocusable||(i.tabIndex=-1),this.itemEls.push(i),this.addManagedListeners(i,{mouseover:()=>this.highlightItem(i),mousedown:o=>{o.preventDefault(),o.stopPropagation(),this.setValue(t)}}),this.createManagedBean(new Sw({getTooltipValue:()=>e,getGui:()=>i,getLocation:()=>"UNKNOWN",shouldDisplayTooltip:()=>r.scrollWidth>r.clientWidth})),this.getGui().appendChild(i)}setValue(t,e){if(this.value===t)return this.fireItemSelected(),this;if(t==null)return this.reset(e),this;const n=this.options.findIndex(i=>i.value===t);if(n!==-1){const i=this.options[n];this.value=i.value,this.displayValue=i.text,this.highlightItem(this.itemEls[n]),e||this.fireChangeEvent()}return this}setValueByIndex(t){return this.setValue(this.options[t].value)}getValue(){return this.value}getDisplayValue(){return this.displayValue}refreshHighlighted(){this.clearHighlighted();const t=this.options.findIndex(e=>e.value===this.value);t!==-1&&this.highlightItem(this.itemEls[t])}reset(t){this.value=null,this.displayValue=null,this.clearHighlighted(),t||this.fireChangeEvent()}highlightItem(t){if(!Ef(t))return;this.clearHighlighted(),this.highlightedEl=t,this.highlightedEl.classList.add(this.activeClass),nT(this.highlightedEl,!0);const e=this.getGui(),{scrollTop:n,clientHeight:i}=e,{offsetTop:r,offsetHeight:o}=t;(r+o>n+i||r<n)&&this.highlightedEl.scrollIntoView({block:"nearest"}),this.unFocusable||this.highlightedEl.focus()}clearHighlighted(){!this.highlightedEl||!Ef(this.highlightedEl)||(this.highlightedEl.classList.remove(this.activeClass),nT(this.highlightedEl,!1),this.highlightedEl=null)}fireChangeEvent(){this.dispatchLocalEvent({type:"fieldValueChanged"}),this.fireItemSelected()}fireItemSelected(){this.dispatchLocalEvent({type:"selectedItem"})}},mhe=class extends w7{constructor(t){if(super(t,(t==null?void 0:t.template)||`
            <div class="ag-picker-field" role="presentation">
                <div data-ref="eLabel"></div>
                    <div data-ref="eWrapper" class="ag-wrapper ag-picker-field-wrapper ag-picker-collapsed">
                    <div data-ref="eDisplayField" class="ag-picker-field-display"></div>
                    <div data-ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                </div>
            </div>`,(t==null?void 0:t.agComponents)||[],t==null?void 0:t.className),this.isPickerDisplayed=!1,this.skipClick=!1,this.pickerGap=4,this.hideCurrentPicker=null,this.eLabel=qi,this.eWrapper=qi,this.eDisplayField=qi,this.eIcon=qi,this.ariaRole=t==null?void 0:t.ariaRole,this.onPickerFocusIn=this.onPickerFocusIn.bind(this),this.onPickerFocusOut=this.onPickerFocusOut.bind(this),!t)return;const{pickerGap:e,maxPickerHeight:n,variableWidth:i,minPickerWidth:r,maxPickerWidth:o}=t;e!=null&&(this.pickerGap=e),this.variableWidth=!!i,n!=null&&this.setPickerMaxHeight(n),r!=null&&this.setPickerMinWidth(r),o!=null&&this.setPickerMaxWidth(o)}wireBeans(t){this.popupService=t.popupService}postConstruct(){super.postConstruct(),this.setupAria();const t=`ag-${this.getCompId()}-display`;this.eDisplayField.setAttribute("id",t);const e=this.getAriaElement();this.addManagedElementListeners(e,{keydown:this.onKeyDown.bind(this)}),this.addManagedElementListeners(this.eLabel,{mousedown:this.onLabelOrWrapperMouseDown.bind(this)}),this.addManagedElementListeners(this.eWrapper,{mousedown:this.onLabelOrWrapperMouseDown.bind(this)});const{pickerIcon:n,inputWidth:i}=this.config;if(n){const r=gu(n,this.gos);r&&this.eIcon.appendChild(r)}i!=null&&this.setInputWidth(i)}setupAria(){const t=this.getAriaElement();t.setAttribute("tabindex",this.gos.get("tabIndex").toString()),tT(t,!1),this.ariaRole&&ld(t,this.ariaRole)}onLabelOrWrapperMouseDown(t){if(t){const e=this.getFocusableElement();if(e!==this.eWrapper&&(t==null?void 0:t.target)===e)return;t.preventDefault(),this.getFocusableElement().focus()}if(this.skipClick){this.skipClick=!1;return}this.isDisabled()||(this.isPickerDisplayed?this.hidePicker():this.showPicker())}onKeyDown(t){switch(t.key){case mn.UP:case mn.DOWN:case mn.ENTER:case mn.SPACE:t.preventDefault(),this.onLabelOrWrapperMouseDown();break;case mn.ESCAPE:this.isPickerDisplayed&&(t.preventDefault(),t.stopPropagation(),this.hideCurrentPicker&&this.hideCurrentPicker());break}}showPicker(){this.isPickerDisplayed=!0,this.pickerComponent||(this.pickerComponent=this.createPickerComponent());const t=this.pickerComponent.getGui();t.addEventListener("focusin",this.onPickerFocusIn),t.addEventListener("focusout",this.onPickerFocusOut),this.hideCurrentPicker=this.renderAndPositionPicker(),this.toggleExpandedStyles(!0)}renderAndPositionPicker(){const t=this.gos.getDocument(),e=this.pickerComponent.getGui();this.gos.get("suppressScrollWhenPopupsAreOpen")||([this.destroyMouseWheelFunc]=this.addManagedEventListeners({bodyScroll:()=>{this.hidePicker()}}));const n=this.localeService.getLocaleTextFunc(),{pickerAriaLabelKey:i,pickerAriaLabelValue:r,modalPicker:o=!0}=this.config,c={modal:o,eChild:e,closeOnEsc:!0,closedCallback:()=>{const F=this.gos.getActiveDomElement(),N=!F||F===t.body;this.beforeHidePicker(),N&&this.isAlive()&&this.getFocusableElement().focus()},ariaLabel:n(i,r)},s=this.popupService.addPopup(c),{maxPickerHeight:f,minPickerWidth:v,maxPickerWidth:w,variableWidth:C}=this;C?(v&&(e.style.minWidth=v),e.style.width=S3(iT(this.eWrapper)),w&&(e.style.maxWidth=w)):aT(e,w??iT(this.eWrapper));const M=f??`${C3(this.popupService.getPopupParent())}px`;return e.style.setProperty("max-height",M),e.style.position="absolute",this.alignPickerToComponent(),s.hideFunc}alignPickerToComponent(){if(!this.pickerComponent)return;const{pickerType:t}=this.config,{pickerGap:e}=this,n=this.gos.get("enableRtl")?"right":"left";this.popupService.positionPopupByComponent({type:t,eventSource:this.eWrapper,ePopup:this.pickerComponent.getGui(),position:"under",alignSide:n,keepWithinBounds:!0,nudgeY:e})}beforeHidePicker(){this.destroyMouseWheelFunc&&(this.destroyMouseWheelFunc(),this.destroyMouseWheelFunc=void 0),this.toggleExpandedStyles(!1);const t=this.pickerComponent.getGui();t.removeEventListener("focusin",this.onPickerFocusIn),t.removeEventListener("focusout",this.onPickerFocusOut),this.isPickerDisplayed=!1,this.pickerComponent=void 0,this.hideCurrentPicker=null}toggleExpandedStyles(t){if(!this.isAlive())return;const e=this.getAriaElement();tT(e,t),this.eWrapper.classList.toggle("ag-picker-expanded",t),this.eWrapper.classList.toggle("ag-picker-collapsed",!t)}onPickerFocusIn(){this.togglePickerHasFocus(!0)}onPickerFocusOut(t){var e;(e=this.pickerComponent)!=null&&e.getGui().contains(t.relatedTarget)||this.togglePickerHasFocus(!1)}togglePickerHasFocus(t){this.pickerComponent&&this.eWrapper.classList.toggle("ag-picker-has-focus",t)}hidePicker(){this.hideCurrentPicker&&this.hideCurrentPicker()}setInputWidth(t){return aT(this.eWrapper,t),this}getFocusableElement(){return this.eWrapper}setPickerGap(t){return this.pickerGap=t,this}setPickerMinWidth(t){return typeof t=="number"&&(t=`${t}px`),this.minPickerWidth=t??void 0,this}setPickerMaxWidth(t){return typeof t=="number"&&(t=`${t}px`),this.maxPickerWidth=t??void 0,this}setPickerMaxHeight(t){return typeof t=="number"&&(t=`${t}px`),this.maxPickerHeight=t??void 0,this}destroy(){this.hidePicker(),super.destroy()}},P3=class extends mhe{constructor(t){super({pickerAriaLabelKey:"ariaLabelSelectField",pickerAriaLabelValue:"Select Field",pickerType:"ag-list",className:"ag-select",pickerIcon:"smallDown",ariaRole:"combobox",...t})}postConstruct(){super.postConstruct(),this.createListComponent(),this.eWrapper.tabIndex=this.gos.get("tabIndex");const{options:t,value:e,placeholder:n}=this.config;t!=null&&this.addOptions(t),e!=null&&this.setValue(e,!0),n&&e==null&&(this.eDisplayField.textContent=n),this.addManagedElementListeners(this.eWrapper,{focusout:this.onWrapperFocusOut.bind(this)})}onWrapperFocusOut(t){this.eWrapper.contains(t.relatedTarget)||this.hidePicker()}createListComponent(){this.listComponent=this.createBean(new phe("select",!0)),this.listComponent.setParentComponent(this);const t=this.listComponent.getAriaElement(),e=`ag-select-list-${this.listComponent.getCompId()}`;t.setAttribute("id",e),nue(this.getAriaElement(),t),this.listComponent.addManagedListeners(this.listComponent,{selectedItem:()=>{this.hidePicker(),this.dispatchLocalEvent({type:"selectedItem"})}}),this.listComponent.addManagedListeners(this.listComponent,{fieldValueChanged:()=>{this.listComponent&&(this.setValue(this.listComponent.getValue(),!1,!0),this.hidePicker())}})}createPickerComponent(){return this.listComponent}onKeyDown(t){var n;const{key:e}=t;switch(e===mn.TAB&&this.hidePicker(),e){case mn.ENTER:case mn.UP:case mn.DOWN:case mn.PAGE_UP:case mn.PAGE_DOWN:case mn.PAGE_HOME:case mn.PAGE_END:t.preventDefault(),this.isPickerDisplayed?(n=this.listComponent)==null||n.handleKeyDown(t):super.onKeyDown(t);break;case mn.ESCAPE:super.onKeyDown(t);break}}showPicker(){this.listComponent&&(super.showPicker(),this.listComponent.refreshHighlighted())}addOptions(t){return t.forEach(e=>this.addOption(e)),this}addOption(t){return this.listComponent.addOption(t),this}clearOptions(){var t;return(t=this.listComponent)==null||t.clearOptions(),this}setValue(t,e,n){if(this.value===t||!this.listComponent)return this;if(n||this.listComponent.setValue(t,!0),this.listComponent.getValue()===this.getValue())return this;let r=this.listComponent.getDisplayValue();return r==null&&this.config.placeholder&&(r=this.config.placeholder),this.eDisplayField.textContent=r,this.setTooltip({newTooltipText:r??null,shouldDisplayTooltip:()=>this.eDisplayField.scrollWidth>this.eDisplayField.clientWidth}),super.setValue(t,e)}destroy(){this.listComponent&&(this.listComponent=this.destroyBean(this.listComponent)),super.destroy()}},ghe={selector:"AG-SELECT",component:P3},D7=class{constructor(){this.customFilterOptions={}}init(t,e){this.filterOptions=t.filterOptions||e,this.mapCustomOptions(),this.selectDefaultItem(t)}getFilterOptions(){return this.filterOptions}mapCustomOptions(){this.filterOptions&&this.filterOptions.forEach(t=>{if(typeof t=="string")return;const e=[["displayKey"],["displayName"],["predicate","test"]],n=i=>i.some(r=>t[r]!=null)?!0:(Tn(`ignoring FilterOptionDef as it doesn't contain one of '${i}'`),!1);if(!e.every(n)){this.filterOptions=this.filterOptions.filter(i=>i===t)||[];return}this.customFilterOptions[t.displayKey]=t})}selectDefaultItem(t){if(t.defaultOption)this.defaultOption=t.defaultOption;else if(this.filterOptions.length>=1){const e=this.filterOptions[0];typeof e=="string"?this.defaultOption=e:e.displayKey?this.defaultOption=e.displayKey:Tn("invalid FilterOptionDef supplied as it doesn't contain a 'displayKey'")}else Tn("no filter options for filter")}getDefaultOption(){return this.defaultOption}getCustomOption(t){return this.customFilterOptions[t]}},F7=class extends dhe{constructor(){super(...arguments),this.eTypes=[],this.eJoinOperatorPanels=[],this.eJoinOperatorsAnd=[],this.eJoinOperatorsOr=[],this.eConditionBodies=[],this.listener=()=>this.onUiChanged(),this.lastUiCompletePosition=null,this.joinOperatorId=0}getNumberOfInputs(t){const e=this.optionsFactory.getCustomOption(t);if(e){const{numberOfInputs:i}=e;return i??1}return t&&["empty","notBlank","blank"].indexOf(t)>=0?0:t==="inRange"?2:1}onFloatingFilterChanged(t,e){this.setTypeFromFloatingFilter(t),this.setValueFromFloatingFilter(e),this.onUiChanged(!0)}setTypeFromFloatingFilter(t){this.eTypes.forEach((e,n)=>{n===0?e.setValue(t,!0):e.setValue(this.optionsFactory.getDefaultOption(),!0)})}getModelFromUi(){const t=this.getUiCompleteConditions();return t.length===0?null:this.maxNumConditions>1&&t.length>1?{filterType:this.getFilterType(),operator:this.getJoinOperator(),conditions:t}:t[0]}getConditionTypes(){return this.eTypes.map(t=>t.getValue())}getConditionType(t){return this.eTypes[t].getValue()}getJoinOperator(){return this.eJoinOperatorsOr.length===0?this.defaultJoinOperator:this.eJoinOperatorsOr[0].getValue()===!0?"OR":"AND"}areModelsEqual(t,e){if(!t&&!e)return!0;if(!t&&e||t&&!e)return!1;const n=!t.operator,i=!e.operator;if(!n&&i||n&&!i)return!1;let o;if(n){const c=t,s=e;o=this.areSimpleModelsEqual(c,s)}else{const c=t,s=e;o=c.operator===s.operator&&k_(c.conditions,s.conditions,(f,v)=>this.areSimpleModelsEqual(f,v))}return o}shouldRefresh(t){var o;const e=this.getModel(),n=e?e.conditions??[e]:null,i=((o=t.filterOptions)==null?void 0:o.map(c=>typeof c=="string"?c:c.displayKey))??this.getDefaultFilterOptions();return!(!(!n||n.every(c=>i.find(s=>s===c.type)!==void 0))||typeof t.maxNumConditions=="number"&&n&&n.length>t.maxNumConditions)}refresh(t){return!this.shouldRefresh(t)||!super.refresh(t)?!1:(this.setParams(t),this.removeConditionsAndOperators(0),this.createOption(),this.setModel(this.getModel()),!0)}setModelIntoUi(t){if(t.operator){const n=t;let i=n.conditions;i==null&&(i=[],Tn("Filter model is missing 'conditions'"));const r=this.validateAndUpdateConditions(i),o=this.getNumConditions();if(r<o)this.removeConditionsAndOperators(r);else if(r>o)for(let s=o;s<r;s++)this.createJoinOperatorPanel(),this.createOption();const c=n.operator==="OR";this.eJoinOperatorsAnd.forEach(s=>s.setValue(!c,!0)),this.eJoinOperatorsOr.forEach(s=>s.setValue(c,!0)),i.forEach((s,f)=>{this.eTypes[f].setValue(s.type,!0),this.setConditionIntoUi(s,f)})}else{const n=t;this.getNumConditions()>1&&this.removeConditionsAndOperators(1),this.eTypes[0].setValue(n.type,!0),this.setConditionIntoUi(n,0)}return this.lastUiCompletePosition=this.getNumConditions()-1,this.createMissingConditionsAndOperators(),this.onUiChanged(),Zo.resolve()}validateAndUpdateConditions(t){let e=t.length;return e>this.maxNumConditions&&(t.splice(this.maxNumConditions),Tn('Filter Model contains more conditions than "filterParams.maxNumConditions". Additional conditions have been ignored.'),e=this.maxNumConditions),e}doesFilterPass(t){const e=this.getModel();if(e==null)return!0;const{operator:n}=e,i=[];if(n){const o=e;i.push(...o.conditions??[])}else i.push(e);return i[n&&n==="OR"?"some":"every"](o=>this.individualConditionPasses(t,o))}setParams(t){super.setParams(t),this.setNumConditions(t),this.defaultJoinOperator=this.getDefaultJoinOperator(t.defaultJoinOperator),this.filterPlaceholder=t.filterPlaceholder,this.optionsFactory=new D7,this.optionsFactory.init(t,this.getDefaultFilterOptions()),this.createFilterListOptions(),this.createOption(),this.createMissingConditionsAndOperators(),this.isReadOnly()&&this.eFilterBody.setAttribute("tabindex","-1")}setNumConditions(t){this.maxNumConditions=t.maxNumConditions??2,this.maxNumConditions<1&&(Tn('"filterParams.maxNumConditions" must be greater than or equal to zero.'),this.maxNumConditions=1),this.numAlwaysVisibleConditions=t.numAlwaysVisibleConditions??1,this.numAlwaysVisibleConditions<1&&(Tn('"filterParams.numAlwaysVisibleConditions" must be greater than or equal to zero.'),this.numAlwaysVisibleConditions=1),this.numAlwaysVisibleConditions>this.maxNumConditions&&(Tn('"filterParams.numAlwaysVisibleConditions" cannot be greater than "filterParams.maxNumConditions".'),this.numAlwaysVisibleConditions=this.maxNumConditions)}createOption(){const t=this.createManagedBean(new P3);this.eTypes.push(t),t.addCssClass("ag-filter-select"),this.eFilterBody.appendChild(t.getGui());const e=this.createValueElement();this.eConditionBodies.push(e),this.eFilterBody.appendChild(e),this.putOptionsIntoDropdown(t),this.resetType(t);const n=this.getNumConditions()-1;this.forEachPositionInput(n,i=>this.resetInput(i)),this.addChangedListeners(t,n)}createJoinOperatorPanel(){const t=document.createElement("div");this.eJoinOperatorPanels.push(t),t.classList.add("ag-filter-condition");const e=this.createJoinOperator(this.eJoinOperatorsAnd,t,"and"),n=this.createJoinOperator(this.eJoinOperatorsOr,t,"or");this.eFilterBody.appendChild(t);const i=this.eJoinOperatorPanels.length-1,r=this.joinOperatorId++;this.resetJoinOperatorAnd(e,i,r),this.resetJoinOperatorOr(n,i,r),this.isReadOnly()||(e.onValueChange(this.listener),n.onValueChange(this.listener))}createJoinOperator(t,e,n){const i=this.createManagedBean(new fhe);return t.push(i),i.addCssClass("ag-filter-condition-operator"),i.addCssClass(`ag-filter-condition-operator-${n}`),e.appendChild(i.getGui()),i}getDefaultJoinOperator(t){return t==="AND"||t==="OR"?t:"AND"}createFilterListOptions(){const t=this.optionsFactory.getFilterOptions();this.filterListOptions=t.map(e=>typeof e=="string"?this.createBoilerplateListOption(e):this.createCustomListOption(e))}putOptionsIntoDropdown(t){this.filterListOptions.forEach(e=>{t.addOption(e)}),t.setDisabled(this.filterListOptions.length<=1)}createBoilerplateListOption(t){return{value:t,text:this.translate(t)}}createCustomListOption(t){const{displayKey:e}=t,n=this.optionsFactory.getCustomOption(t.displayKey);return{value:e,text:n?this.localeService.getLocaleTextFunc()(n.displayKey,n.displayName):this.translate(e)}}createBodyTemplate(){return""}getAgComponents(){return[]}getCssIdentifier(){return"simple-filter"}updateUiVisibility(){const t=this.getJoinOperator();this.updateNumConditions(),this.updateConditionStatusesAndValues(this.lastUiCompletePosition,t)}updateNumConditions(){let t=-1,e=!0;for(let n=0;n<this.getNumConditions();n++)this.isConditionUiComplete(n)?t=n:e=!1;if(this.shouldAddNewConditionAtEnd(e))this.createJoinOperatorPanel(),this.createOption();else{const n=this.lastUiCompletePosition??this.getNumConditions()-2;if(t<n){this.removeConditionsAndOperators(n+1);const i=t+1,r=n-i;r>0&&this.removeConditionsAndOperators(i,r),this.createMissingConditionsAndOperators()}}this.lastUiCompletePosition=t}updateConditionStatusesAndValues(t,e){this.eTypes.forEach((i,r)=>{const o=this.isConditionDisabled(r,t);i.setDisabled(o||this.filterListOptions.length<=1),r===1&&(oS(this.eJoinOperatorPanels[0],o),this.eJoinOperatorsAnd[0].setDisabled(o),this.eJoinOperatorsOr[0].setDisabled(o))}),this.eConditionBodies.forEach((i,r)=>{Do(i,this.isConditionBodyVisible(r))});const n=(e??this.getJoinOperator())==="OR";this.eJoinOperatorsAnd.forEach(i=>{i.setValue(!n,!0)}),this.eJoinOperatorsOr.forEach(i=>{i.setValue(n,!0)}),this.forEachInput((i,r,o,c)=>{this.setElementDisplayed(i,r<c),this.setElementDisabled(i,this.isConditionDisabled(o,t))}),this.resetPlaceholder()}shouldAddNewConditionAtEnd(t){return t&&this.getNumConditions()<this.maxNumConditions&&!this.isReadOnly()}removeConditionsAndOperators(t,e){if(t>=this.getNumConditions())return;this.removeComponents(this.eTypes,t,e),this.removeElements(this.eConditionBodies,t,e),this.removeValueElements(t,e);const n=Math.max(t-1,0);this.removeElements(this.eJoinOperatorPanels,n,e),this.removeComponents(this.eJoinOperatorsAnd,n,e),this.removeComponents(this.eJoinOperatorsOr,n,e)}removeElements(t,e,n){this.removeItems(t,e,n).forEach(r=>w_(r))}removeComponents(t,e,n){this.removeItems(t,e,n).forEach(r=>{w_(r.getGui()),this.destroyBean(r)})}removeItems(t,e,n){return n==null?t.splice(e):t.splice(e,n)}afterGuiAttached(t){if(super.afterGuiAttached(t),this.resetPlaceholder(),!(t!=null&&t.suppressFocus))if(this.isReadOnly())this.eFilterBody.focus();else{const e=this.getInputs(0)[0];if(!e)return;e instanceof zy&&e.getInputElement().focus()}}afterGuiDetached(){super.afterGuiDetached();const t=this.getModel();this.resetUiToActiveModel(t);let e=-1,n=-1,i=!1;const r=this.getJoinOperator();for(let c=this.getNumConditions()-1;c>=0;c--)if(this.isConditionUiComplete(c))e===-1&&(e=c,n=c);else{const s=c>=this.numAlwaysVisibleConditions&&!this.isConditionUiComplete(c-1),f=c<e;(s||f)&&(this.removeConditionsAndOperators(c,1),i=!0,f&&n--)}let o=!1;this.getNumConditions()<this.numAlwaysVisibleConditions&&(this.createMissingConditionsAndOperators(),o=!0),this.shouldAddNewConditionAtEnd(n===this.getNumConditions()-1)&&(this.createJoinOperatorPanel(),this.createOption(),o=!0),o&&this.updateConditionStatusesAndValues(n,r),i&&this.updateJoinOperatorsDisabled(),this.lastUiCompletePosition=n}getPlaceholderText(t,e){let n=this.translate(t);if(g3(this.filterPlaceholder)){const i=this.filterPlaceholder,r=this.eTypes[e].getValue(),o=this.translate(r);n=i({filterOptionKey:r,filterOption:o,placeholder:n})}else typeof this.filterPlaceholder=="string"&&(n=this.filterPlaceholder);return n}resetPlaceholder(){const t=this.localeService.getLocaleTextFunc();this.forEachInput((e,n,i,r)=>{if(!(e instanceof zy))return;const o=n===0&&r>1?"inRangeStart":n===0?"filterOoo":"inRangeEnd",c=n===0&&r>1?t("ariaFilterFromValue","Filter from value"):n===0?t("ariaFilterValue","Filter Value"):t("ariaFilterToValue","Filter to Value");e.setInputPlaceholder(this.getPlaceholderText(o,i)),e.setInputAriaLabel(c)})}setElementValue(t,e,n){t instanceof zy&&t.setValue(e!=null?String(e):null,!0)}setElementDisplayed(t,e){t instanceof Js&&Do(t.getGui(),e)}setElementDisabled(t,e){t instanceof Js&&oS(t.getGui(),e)}attachElementOnChange(t,e){t instanceof zy&&t.onValueChange(e)}forEachInput(t){this.getConditionTypes().forEach((e,n)=>{this.forEachPositionTypeInput(n,e,t)})}forEachPositionInput(t,e){const n=this.getConditionType(t);this.forEachPositionTypeInput(t,n,e)}forEachPositionTypeInput(t,e,n){const i=this.getNumberOfInputs(e),r=this.getInputs(t);for(let o=0;o<r.length;o++){const c=r[o];c!=null&&n(c,o,t,i)}}isConditionDisabled(t,e){return this.isReadOnly()?!0:t===0?!1:t>e+1}isConditionBodyVisible(t){const e=this.getConditionType(t);return this.getNumberOfInputs(e)>0}isConditionUiComplete(t){return!(t>=this.getNumConditions()||this.getConditionType(t)==="empty"||this.getValues(t).some(n=>n==null))}getNumConditions(){return this.eTypes.length}getUiCompleteConditions(){const t=[];for(let e=0;e<this.getNumConditions();e++)this.isConditionUiComplete(e)&&t.push(this.createCondition(e));return t}createMissingConditionsAndOperators(){if(!this.isReadOnly())for(let t=this.getNumConditions();t<this.numAlwaysVisibleConditions;t++)this.createJoinOperatorPanel(),this.createOption()}resetUiToDefaults(t){return this.removeConditionsAndOperators(this.isReadOnly()?1:this.numAlwaysVisibleConditions),this.eTypes.forEach(e=>this.resetType(e)),this.eJoinOperatorsAnd.forEach((e,n)=>this.resetJoinOperatorAnd(e,n,this.joinOperatorId+n)),this.eJoinOperatorsOr.forEach((e,n)=>this.resetJoinOperatorOr(e,n,this.joinOperatorId+n)),this.joinOperatorId++,this.forEachInput(e=>this.resetInput(e)),this.resetPlaceholder(),this.createMissingConditionsAndOperators(),this.lastUiCompletePosition=null,t||this.onUiChanged(),Zo.resolve()}resetType(t){const n=this.localeService.getLocaleTextFunc()("ariaFilteringOperator","Filtering operator");t.setValue(this.optionsFactory.getDefaultOption(),!0).setAriaLabel(n).setDisabled(this.isReadOnly()||this.filterListOptions.length<=1)}resetJoinOperatorAnd(t,e,n){this.resetJoinOperator(t,e,this.isDefaultOperator("AND"),this.translate("andCondition"),n)}resetJoinOperatorOr(t,e,n){this.resetJoinOperator(t,e,this.isDefaultOperator("OR"),this.translate("orCondition"),n)}resetJoinOperator(t,e,n,i,r){this.updateJoinOperatorDisabled(t.setValue(n,!0).setName(`ag-simple-filter-and-or-${this.getCompId()}-${r}`).setLabel(i),e)}updateJoinOperatorsDisabled(){this.eJoinOperatorsAnd.forEach((t,e)=>this.updateJoinOperatorDisabled(t,e)),this.eJoinOperatorsOr.forEach((t,e)=>this.updateJoinOperatorDisabled(t,e))}updateJoinOperatorDisabled(t,e){t.setDisabled(this.isReadOnly()||e>0)}resetInput(t){this.setElementValue(t,null),this.setElementDisabled(t,this.isReadOnly())}setConditionIntoUi(t,e){const n=this.mapValuesFromModel(t);this.forEachInput((i,r,o)=>{o===e&&this.setElementValue(i,n[r]!=null?n[r]:null)})}setValueFromFloatingFilter(t){this.forEachInput((e,n,i)=>{this.setElementValue(e,n===0&&i===0?t:null,!0)})}isDefaultOperator(t){return t===this.defaultJoinOperator}addChangedListeners(t,e){this.isReadOnly()||(t.onValueChange(this.listener),this.forEachPositionInput(e,n=>{this.attachElementOnChange(n,this.listener)}))}individualConditionPasses(t,e){const n=this.getCellValue(t.node),i=this.mapValuesFromModel(e),r=this.optionsFactory.getCustomOption(e.type),o=this.evaluateCustomFilter(r,i,n);return o??(n==null?this.evaluateNullValue(e.type):this.evaluateNonNullValue(i,n,e,t))}evaluateCustomFilter(t,e,n){if(t==null)return;const{predicate:i}=t;if(i!=null&&!e.some(r=>r==null))return i(e,n)}isBlank(t){return t==null||typeof t=="string"&&t.trim().length===0}hasInvalidInputs(){return!1}},L7=class extends F7{setParams(t){super.setParams(t),this.scalarFilterParams=t}evaluateNullValue(t){switch(t){case"equals":case"notEqual":if(this.scalarFilterParams.includeBlanksInEquals)return!0;break;case"greaterThan":case"greaterThanOrEqual":if(this.scalarFilterParams.includeBlanksInGreaterThan)return!0;break;case"lessThan":case"lessThanOrEqual":if(this.scalarFilterParams.includeBlanksInLessThan)return!0;break;case"inRange":if(this.scalarFilterParams.includeBlanksInRange)return!0;break;case"blank":return!0;case"notBlank":return!1}return!1}evaluateNonNullValue(t,e,n){const i=this.comparator(),r=t[0]!=null?i(t[0],e):0;switch(n.type){case"equals":return r===0;case"notEqual":return r!==0;case"greaterThan":return r>0;case"greaterThanOrEqual":return r>=0;case"lessThan":return r<0;case"lessThanOrEqual":return r<=0;case"inRange":{const o=i(t[1],e);return this.scalarFilterParams.inRangeInclusive?r>=0&&o<=0:r>0&&o<0}case"blank":return this.isBlank(e);case"notBlank":return!this.isBlank(e);default:return Tn('Unexpected type of filter "'+n.type+'", it looks like the filter was configured with incorrect Filter Options'),!0}}},vhe=65,yhe=67,_he=86,xhe=68,whe=90,Che=89;function O7(t){return t.altKey||t.ctrlKey||t.metaKey?!1:t.key.length===1}function AL(t,e,n,i,r){const o=i?i.getColDef().suppressKeyboardEvent:void 0;if(!o)return!1;const c=t.addGridCommonParams({event:e,editing:r,column:i,node:n,data:n.data,colDef:i.getColDef()});return!!(o&&o(c))}function She(t,e,n,i){const r=i.getDefinition(),o=r&&r.suppressHeaderKeyboardEvent;if(!$n(o))return!1;const c=t.addGridCommonParams({colDef:r,column:i,headerRowIndex:n,event:e});return!!o(c)}function bhe(t){const{keyCode:e}=t;let n;switch(e){case vhe:n=mn.A;break;case yhe:n=mn.C;break;case _he:n=mn.V;break;case xhe:n=mn.D;break;case whe:n=mn.Z;break;case Che:n=mn.Y;break;default:n=t.code}return n}function Ehe(t,e=!1){return t===mn.DELETE?!0:!e&&t===mn.BACKSPACE?c7():!1}var z_=class extends zy{constructor(t,e="ag-text-field",n="text"){super(t,e,n)}postConstruct(){super.postConstruct(),this.config.allowedCharPattern&&this.preventDisallowedCharacters()}setValue(t,e){return this.eInput.value!==t&&(this.eInput.value=$n(t)?t:""),super.setValue(t,e)}setStartValue(t){this.setValue(t,!0)}preventDisallowedCharacters(){const t=new RegExp(`[${this.config.allowedCharPattern}]`),e=n=>{O7(n)&&n.key&&!t.test(n.key)&&n.preventDefault()};this.addManagedListeners(this.eInput,{keydown:e,paste:n=>{var r;const i=(r=n.clipboardData)==null?void 0:r.getData("text");i&&i.split("").some(o=>!t.test(o))&&n.preventDefault()}})}},DA={selector:"AG-INPUT-TEXT-FIELD",component:z_},I3=class extends z_{constructor(t){super(t,"ag-number-field","number")}postConstruct(){super.postConstruct(),this.addManagedListeners(this.eInput,{blur:()=>{const r=parseFloat(this.eInput.value),o=isNaN(r)?"":this.normalizeValue(r.toString());this.value!==o&&this.setValue(o)},wheel:this.onWheel.bind(this)}),this.eInput.step="any";const{precision:t,min:e,max:n,step:i}=this.config;typeof t=="number"&&this.setPrecision(t),typeof e=="number"&&this.setMin(e),typeof n=="number"&&this.setMax(n),typeof i=="number"&&this.setStep(i)}onWheel(t){this.gos.getActiveDomElement()===this.eInput&&t.preventDefault()}normalizeValue(t){if(t==="")return"";this.precision!=null&&(t=this.adjustPrecision(t));const e=parseFloat(t);return this.min!=null&&e<this.min?t=this.min.toString():this.max!=null&&e>this.max&&(t=this.max.toString()),t}adjustPrecision(t,e){if(this.precision==null)return t;if(e){const i=parseFloat(t).toFixed(this.precision);return parseFloat(i).toString()}const n=String(t).split(".");if(n.length>1){if(n[1].length<=this.precision)return t;if(this.precision>0)return`${n[0]}.${n[1].slice(0,this.precision)}`}return n[0]}setMin(t){return this.min===t?this:(this.min=t,Up(this.eInput,"min",t),this)}setMax(t){return this.max===t?this:(this.max=t,Up(this.eInput,"max",t),this)}setPrecision(t){return this.precision=t,this}setStep(t){return this.step===t?this:(this.step=t,Up(this.eInput,"step",t),this)}setValue(t,e){return this.setValueOrInputValue(n=>super.setValue(n,e),()=>this,t)}setStartValue(t){return this.setValueOrInputValue(e=>super.setValue(e,!0),e=>{this.eInput.value=e},t)}setValueOrInputValue(t,e,n){if($n(n)){let i=this.isScientificNotation(n);if(i&&this.eInput.validity.valid)return t(n);if(!i){n=this.adjustPrecision(n);const r=this.normalizeValue(n);i=n!=r}if(i)return e(n)}return t(n)}getValue(){if(!this.eInput.validity.valid)return;const t=this.eInput.value;return this.isScientificNotation(t)?this.adjustPrecision(t,!0):super.getValue()}isScientificNotation(t){return typeof t=="string"&&t.includes("e")}},Mhe={selector:"AG-INPUT-NUMBER-FIELD",component:I3},k7=["equals","notEqual","greaterThan","greaterThanOrEqual","lessThan","lessThanOrEqual","inRange","blank","notBlank"],D3=class{constructor(t,e,n){this.localeService=t,this.optionsFactory=e,this.valueFormatter=n}getModelAsString(t){if(!t)return null;const e=t.operator!=null,n=this.localeService.getLocaleTextFunc();if(e){const i=t,o=(i.conditions??[]).map(s=>this.getModelAsString(s)),c=i.operator==="AND"?"andCondition":"orCondition";return o.join(` ${n(c,I7[c])} `)}else{if(t.type==="blank"||t.type==="notBlank")return n(t.type,t.type);{const i=t,r=this.optionsFactory.getCustomOption(i.type),{displayKey:o,displayName:c,numberOfInputs:s}=r||{};return o&&c&&s===0?(n(o,c),c):this.conditionToString(i,r)}}}updateParams(t){this.optionsFactory=t.optionsFactory}formatValue(t){return this.valueFormatter?this.valueFormatter(t??null)??"":String(t)}},N7=class extends D3{conditionToString(t,e){const{numberOfInputs:n}=e||{};return t.type=="inRange"||n===2?`${this.formatValue(t.filter)}-${this.formatValue(t.filterTo)}`:t.filter!=null?this.formatValue(t.filter):`${t.type}`}};function PL(t){const{allowedCharPattern:e}=t??{};return e??null}var Rhe=class extends L7{constructor(){super("numberFilter"),this.eValuesFrom=[],this.eValuesTo=[]}refresh(t){return this.numberFilterParams.allowedCharPattern!==t.allowedCharPattern?!1:super.refresh(t)}mapValuesFromModel(t){const{filter:e,filterTo:n,type:i}=t||{};return[this.processValue(e),this.processValue(n)].slice(0,this.getNumberOfInputs(i))}getDefaultDebounceMs(){return 500}comparator(){return(t,e)=>t===e?0:t<e?1:-1}setParams(t){this.numberFilterParams=t,super.setParams(t),this.filterModelFormatter=new N7(this.localeService,this.optionsFactory,this.numberFilterParams.numberFormatter)}getDefaultFilterOptions(){return k7}setElementValue(t,e,n){const i=!n&&this.numberFilterParams.numberFormatter?this.numberFilterParams.numberFormatter(e??null):e;super.setElementValue(t,i)}createValueElement(){const t=PL(this.numberFilterParams),e=document.createElement("div");return e.classList.add("ag-filter-body"),ld(e,"presentation"),this.createFromToElement(e,this.eValuesFrom,"from",t),this.createFromToElement(e,this.eValuesTo,"to",t),e}createFromToElement(t,e,n,i){const r=this.createManagedBean(i?new z_({allowedCharPattern:i}):new I3);r.addCssClass(`ag-filter-${n}`),r.addCssClass("ag-filter-filter"),e.push(r),t.appendChild(r.getGui())}removeValueElements(t,e){this.removeComponents(this.eValuesFrom,t,e),this.removeComponents(this.eValuesTo,t,e)}getValues(t){const e=[];return this.forEachPositionInput(t,(n,i,r,o)=>{i<o&&e.push(this.processValue(this.stringToFloat(n.getValue())))}),e}areSimpleModelsEqual(t,e){return t.filter===e.filter&&t.filterTo===e.filterTo&&t.type===e.type}getFilterType(){return"number"}processValue(t){return t==null||isNaN(t)?null:t}stringToFloat(t){if(typeof t=="number")return t;let e=n_(t);return e!=null&&e.trim()===""&&(e=null),this.numberFilterParams.numberParser?this.numberFilterParams.numberParser(e):e==null||e.trim()==="-"?null:parseFloat(e)}createCondition(t){const e=this.getConditionType(t),n={filterType:this.getFilterType(),type:e},i=this.getValues(t);return i.length>0&&(n.filter=i[0]),i.length>1&&(n.filterTo=i[1]),n}getInputs(t){return t>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[t],this.eValuesTo[t]]}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}hasInvalidInputs(){let t=!1;return this.forEachInput(e=>{if(!e.getInputElement().validity.valid){t=!0;return}}),t}},B7=["contains","notContains","equals","notEqual","startsWith","endsWith","blank","notBlank"],z7=class extends D3{conditionToString(t,e){const{numberOfInputs:n}=e||{};return t.type=="inRange"||n===2?`${t.filter}-${t.filterTo}`:t.filter!=null?`${t.filter}`:`${t.type}`}};function U7(t){const e=t&&t.trim();return e===""?t:e}var The=class extends F7{constructor(){super("textFilter"),this.defaultFormatter=t=>t,this.defaultLowercaseFormatter=t=>t==null?null:t.toString().toLowerCase(),this.defaultMatcher=({filterOption:t,value:e,filterText:n})=>{if(n==null)return!1;switch(t){case"contains":return e.indexOf(n)>=0;case"notContains":return e.indexOf(n)<0;case"equals":return e===n;case"notEqual":return e!=n;case"startsWith":return e.indexOf(n)===0;case"endsWith":{const i=e.lastIndexOf(n);return i>=0&&i===e.length-n.length}default:return!1}},this.eValuesFrom=[],this.eValuesTo=[]}getDefaultDebounceMs(){return 500}setParams(t){this.textFilterParams=t,super.setParams(t),this.matcher=this.getTextMatcher(),this.formatter=this.textFilterParams.textFormatter||(this.textFilterParams.caseSensitive?this.defaultFormatter:this.defaultLowercaseFormatter),this.filterModelFormatter=new z7(this.localeService,this.optionsFactory)}getTextMatcher(){const t=this.textFilterParams.textCustomComparator;return t?(Tn("textCustomComparator is deprecated, use textMatcher instead."),({filterOption:e,value:n,filterText:i})=>t(e,n,i)):this.textFilterParams.textMatcher||this.defaultMatcher}createCondition(t){const e=this.getConditionType(t),n={filterType:this.getFilterType(),type:e},i=this.getValuesWithSideEffects(t,!0);return i.length>0&&(n.filter=i[0]),i.length>1&&(n.filterTo=i[1]),n}getFilterType(){return"text"}areSimpleModelsEqual(t,e){return t.filter===e.filter&&t.filterTo===e.filterTo&&t.type===e.type}getInputs(t){return t>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[t],this.eValuesTo[t]]}getValues(t){return this.getValuesWithSideEffects(t,!1)}getValuesWithSideEffects(t,e){const n=[];return this.forEachPositionInput(t,(i,r,o,c)=>{if(r<c){let s=n_(i.getValue());e&&this.textFilterParams.trimInput&&(s=U7(s)??null,i.setValue(s,!0)),n.push(s)}}),n}getDefaultFilterOptions(){return B7}createValueElement(){const t=document.createElement("div");return t.classList.add("ag-filter-body"),ld(t,"presentation"),this.createFromToElement(t,this.eValuesFrom,"from"),this.createFromToElement(t,this.eValuesTo,"to"),t}createFromToElement(t,e,n){const i=this.createManagedBean(new z_);i.addCssClass(`ag-filter-${n}`),i.addCssClass("ag-filter-filter"),e.push(i),t.appendChild(i.getGui())}removeValueElements(t,e){this.removeComponents(this.eValuesFrom,t,e),this.removeComponents(this.eValuesTo,t,e)}mapValuesFromModel(t){const{filter:e,filterTo:n,type:i}=t||{};return[e||null,n||null].slice(0,this.getNumberOfInputs(i))}evaluateNullValue(t){return t?["notEqual","notContains","blank"].indexOf(t)>=0:!1}evaluateNonNullValue(t,e,n,i){const r=t.map(M=>this.formatter(M))||[],o=this.formatter(e),{api:c,colDef:s,column:f,context:v,textFormatter:w}=this.textFilterParams;if(n.type==="blank")return this.isBlank(e);if(n.type==="notBlank")return!this.isBlank(e);const C={api:c,colDef:s,column:f,context:v,node:i.node,data:i.data,filterOption:n.type,value:o,textFormatter:w};return r.some(M=>this.matcher({...C,filterText:M}))}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}};function V7(t){if(typeof t=="number")return t;if(typeof t=="string"){const e=parseInt(t);return isNaN(e)?void 0:e}}function of(t,e=Number.MAX_VALUE){return n=>{const i=V7(n);if(!(i==null||i<t||i>e))return i}}function b1(t,e){return t.toString().padStart(e,"0")}function Ahe(t,e){const n=[];for(let i=t;i<=e;i++)n.push(i);return n}function Phe(t,e,n){return typeof t!="number"?"":t.toString().replace(".",n).replace(/(\d)(?=(\d{3})+(?!\d))/g,`$1${e}`)}function eh(t,e=!0,n="-"){if(!t)return null;let i=[t.getFullYear(),t.getMonth()+1,t.getDate()].map(r=>b1(r,2)).join(n);return e&&(i+=" "+[t.getHours(),t.getMinutes(),t.getSeconds()].map(r=>b1(r,2)).join(":")),i}var ED=t=>{if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd"}return"th"};function E1(t,e="YYYY-MM-DD"){const n=b1(t.getFullYear(),4),i=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o={YYYY:()=>n.slice(n.length-4,n.length),YY:()=>n.slice(n.length-2,n.length),Y:()=>`${t.getFullYear()}`,MMMM:()=>i[t.getMonth()],MMM:()=>i[t.getMonth()].slice(0,3),MM:()=>b1(t.getMonth()+1,2),Mo:()=>`${t.getMonth()+1}${ED(t.getMonth()+1)}`,M:()=>`${t.getMonth()+1}`,Do:()=>`${t.getDate()}${ED(t.getDate())}`,DD:()=>b1(t.getDate(),2),D:()=>`${t.getDate()}`,dddd:()=>r[t.getDay()],ddd:()=>r[t.getDay()].slice(0,3),dd:()=>r[t.getDay()].slice(0,2),do:()=>`${t.getDay()}${ED(t.getDay())}`,d:()=>`${t.getDay()}`},c=new RegExp(Object.keys(o).join("|"),"g");return e.replace(c,s=>s in o?o[s]():s)}function Oc(t){if(!t)return null;const[e,n]=t.split(" ");if(!e)return null;const i=e.split("-").map(C=>parseInt(C,10));if(i.filter(C=>!isNaN(C)).length!==3)return null;const[r,o,c]=i,s=new Date(r,o-1,c);if(s.getFullYear()!==r||s.getMonth()!==o-1||s.getDate()!==c)return null;if(!n||n==="00:00:00")return s;const[f,v,w]=n.split(":").map(C=>parseInt(C,10));return f>=0&&f<24&&s.setHours(f),v>=0&&v<60&&s.setMinutes(v),w>=0&&w<60&&s.setSeconds(w),s}var G7=class{constructor(t,e,n,i,r){this.alive=!0,this.context=t,this.eParent=i,e.getDateCompDetails(n).newAgStackInstance().then(s=>{if(!this.alive){t.destroyBean(s);return}this.dateComp=s,s&&(i.appendChild(s.getGui()),s.afterGuiAttached&&s.afterGuiAttached(),this.tempValue&&s.setDate(this.tempValue),this.disabled!=null&&this.setDateCompDisabled(this.disabled),r==null||r(this))})}destroy(){this.alive=!1,this.dateComp=this.context.destroyBean(this.dateComp)}getDate(){return this.dateComp?this.dateComp.getDate():this.tempValue}setDate(t){this.dateComp?this.dateComp.setDate(t):this.tempValue=t}setDisabled(t){this.dateComp?this.setDateCompDisabled(t):this.disabled=t}setDisplayed(t){Do(this.eParent,t)}setInputPlaceholder(t){this.dateComp&&this.dateComp.setInputPlaceholder&&this.dateComp.setInputPlaceholder(t)}setInputAriaLabel(t){this.dateComp&&this.dateComp.setInputAriaLabel&&this.dateComp.setInputAriaLabel(t)}afterGuiAttached(t){this.dateComp&&typeof this.dateComp.afterGuiAttached=="function"&&this.dateComp.afterGuiAttached(t)}updateParams(t){var n,i;let e=!1;(n=this.dateComp)!=null&&n.refresh&&typeof this.dateComp.refresh=="function"&&this.dateComp.refresh(t)!==null&&(e=!0),!e&&((i=this.dateComp)!=null&&i.onParamsUpdated)&&typeof this.dateComp.onParamsUpdated=="function"&&this.dateComp.onParamsUpdated(t)!==null&&Tn("Custom date component method 'onParamsUpdated' is deprecated. Use 'refresh' instead.")}setDateCompDisabled(t){this.dateComp!=null&&this.dateComp.setDisabled!=null&&this.dateComp.setDisabled(t)}},H7=["equals","notEqual","lessThan","greaterThan","inRange","blank","notBlank"],W7=class extends D3{constructor(t,e,n){super(e,n),this.dateFilterParams=t}conditionToString(t,e){const{type:n}=t,{numberOfInputs:i}=e||{},r=n=="inRange"||i===2,o=Oc(t.dateFrom),c=Oc(t.dateTo),s=this.dateFilterParams.inRangeFloatingFilterDateFormat;if(r){const f=o!==null?E1(o,s):"null",v=c!==null?E1(c,s):"null";return`${f}-${v}`}return o!=null?E1(o,s):`${n}`}updateParams(t){super.updateParams(t),this.dateFilterParams=t.dateFilterParams}},X5=1e3,K5=1/0,Ihe=class extends L7{constructor(){super("dateFilter"),this.eConditionPanelsFrom=[],this.eConditionPanelsTo=[],this.dateConditionFromComps=[],this.dateConditionToComps=[],this.minValidYear=X5,this.maxValidYear=K5,this.minValidDate=null,this.maxValidDate=null}wireBeans(t){super.wireBeans(t),this.context=t.context,this.userComponentFactory=t.userComponentFactory}afterGuiAttached(t){super.afterGuiAttached(t),this.dateConditionFromComps[0].afterGuiAttached(t)}mapValuesFromModel(t){const{dateFrom:e,dateTo:n,type:i}=t||{};return[e&&Oc(e)||null,n&&Oc(n)||null].slice(0,this.getNumberOfInputs(i))}comparator(){return this.dateFilterParams.comparator?this.dateFilterParams.comparator:this.defaultComparator.bind(this)}defaultComparator(t,e){const n=e;return e==null||n<t?-1:n>t?1:0}setParams(t){this.dateFilterParams=t,super.setParams(t);const e=(n,i)=>{if(t[n]!=null)if(isNaN(t[n]))Tn(`DateFilter ${n} is not a number`);else return t[n]==null?i:Number(t[n]);return i};this.minValidYear=e("minValidYear",X5),this.maxValidYear=e("maxValidYear",K5),this.minValidYear>this.maxValidYear&&Tn("DateFilter minValidYear should be <= maxValidYear"),t.minValidDate?this.minValidDate=t.minValidDate instanceof Date?t.minValidDate:Oc(t.minValidDate):this.minValidDate=null,t.maxValidDate?this.maxValidDate=t.maxValidDate instanceof Date?t.maxValidDate:Oc(t.maxValidDate):this.maxValidDate=null,this.minValidDate&&this.maxValidDate&&this.minValidDate>this.maxValidDate&&Tn("DateFilter minValidDate should be <= maxValidDate"),this.filterModelFormatter=new W7(this.dateFilterParams,this.localeService,this.optionsFactory)}createDateCompWrapper(t){const e=new G7(this.context,this.userComponentFactory,{onDateChanged:()=>this.onUiChanged(),filterParams:this.dateFilterParams},t);return this.addDestroyFunc(()=>e.destroy()),e}setElementValue(t,e){t.setDate(e)}setElementDisplayed(t,e){t.setDisplayed(e)}setElementDisabled(t,e){t.setDisabled(e)}getDefaultFilterOptions(){return H7}createValueElement(){const e=this.gos.getDocument().createElement("div");return e.classList.add("ag-filter-body"),this.createFromToElement(e,this.eConditionPanelsFrom,this.dateConditionFromComps,"from"),this.createFromToElement(e,this.eConditionPanelsTo,this.dateConditionToComps,"to"),e}createFromToElement(t,e,n,i){const o=this.gos.getDocument().createElement("div");o.classList.add(`ag-filter-${i}`),o.classList.add(`ag-filter-date-${i}`),e.push(o),t.appendChild(o),n.push(this.createDateCompWrapper(o))}removeValueElements(t,e){this.removeDateComps(this.dateConditionFromComps,t,e),this.removeDateComps(this.dateConditionToComps,t,e),this.removeItems(this.eConditionPanelsFrom,t,e),this.removeItems(this.eConditionPanelsTo,t,e)}removeDateComps(t,e,n){this.removeItems(t,e,n).forEach(r=>r.destroy())}isValidDateValue(t){if(t===null)return!1;if(this.minValidDate){if(t<this.minValidDate)return!1}else if(t.getUTCFullYear()<this.minValidYear)return!1;if(this.maxValidDate){if(t>this.maxValidDate)return!1}else if(t.getUTCFullYear()>this.maxValidYear)return!1;return!0}isConditionUiComplete(t){if(!super.isConditionUiComplete(t))return!1;let e=!0;return this.forEachInput((n,i,r,o)=>{r!==t||!e||i>=o||(e=e&&this.isValidDateValue(n.getDate()))}),e}areSimpleModelsEqual(t,e){return t.dateFrom===e.dateFrom&&t.dateTo===e.dateTo&&t.type===e.type}getFilterType(){return"date"}createCondition(t){const e=this.getConditionType(t),n={},i=this.getValues(t);return i.length>0&&(n.dateFrom=eh(i[0])),i.length>1&&(n.dateTo=eh(i[1])),{dateFrom:null,dateTo:null,filterType:this.getFilterType(),type:e,...n}}resetPlaceholder(){const t=this.localeService.getLocaleTextFunc(),e=this.translate("dateFormatOoo"),n=t("ariaFilterValue","Filter Value");this.forEachInput(i=>{i.setInputPlaceholder(e),i.setInputAriaLabel(n)})}getInputs(t){return t>=this.dateConditionFromComps.length?[null,null]:[this.dateConditionFromComps[t],this.dateConditionToComps[t]]}getValues(t){const e=[];return this.forEachPositionInput(t,(n,i,r,o)=>{i<o&&e.push(n.getDate())}),e}translate(t){return t==="lessThan"?super.translate("before"):t==="greaterThan"?super.translate("after"):super.translate(t)}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}},F3=class extends wn{constructor(t,e,n,i){super(),this.columnOrGroup=t,this.columnOrGroup=t,this.eCell=e,this.ariaEl=this.eCell.querySelector("[role=columnheader]")||this.eCell,this.colsSpanning=i,this.beans=n}setColsSpanning(t){this.colsSpanning=t,this.onLeftChanged()}getColumnOrGroup(){return this.beans.gos.get("enableRtl")&&this.colsSpanning?Yr(this.colsSpanning):this.columnOrGroup}postConstruct(){const t=this.onLeftChanged.bind(this);this.addManagedListeners(this.columnOrGroup,{leftChanged:t}),this.setLeftFirstTime(),this.addManagedEventListeners({displayedColumnsWidthChanged:t}),this.addManagedPropertyListener("domLayout",t)}setLeftFirstTime(){const t=this.beans.gos.get("suppressColumnMoveAnimation"),e=$n(this.columnOrGroup.getOldLeft());this.beans.columnAnimationService.isActive()&&e&&!t?this.animateInLeft():this.onLeftChanged()}animateInLeft(){const t=this.getColumnOrGroup(),e=t.getLeft(),n=t.getOldLeft(),i=this.modifyLeftForPrintLayout(t,n),r=this.modifyLeftForPrintLayout(t,e);this.setLeft(i),this.actualLeft=r,this.beans.columnAnimationService.executeNextVMTurn(()=>{this.actualLeft===r&&this.setLeft(r)})}onLeftChanged(){const t=this.getColumnOrGroup(),e=t.getLeft();this.actualLeft=this.modifyLeftForPrintLayout(t,e),this.setLeft(this.actualLeft)}modifyLeftForPrintLayout(t,e){if(!this.beans.gos.isDomLayout("print")||t.getPinned()==="left")return e;const i=this.beans.visibleColsService.getColsLeftWidth();if(t.getPinned()==="right"){const r=this.beans.visibleColsService.getBodyContainerWidth();return i+r+e}return i+e}setLeft(t){if($n(t)&&(this.eCell.style.left=`${t}px`),oa(this.columnOrGroup)){const e=this.columnOrGroup.getLeafColumns();if(!e.length)return;e.length>1&&Qce(this.ariaEl,e.length)}}},Dhe="ag-column-first",Fhe="ag-column-last";function j7(t,e,n,i){return Hr(t)?[]:Ohe(t.headerClass,t,e,n,i)}function $7(t,e,n){t.addOrRemoveCssClass(Dhe,n.isColAtEdge(e,"first")),t.addOrRemoveCssClass(Fhe,n.isColAtEdge(e,"last"))}function Lhe(t,e,n,i){return e.addGridCommonParams({colDef:t,column:n,columnGroup:i})}function Ohe(t,e,n,i,r){if(Hr(t))return[];let o;if(typeof t=="function"){const c=Lhe(e,n,i,r);o=t(c)}else o=t;return typeof o=="string"?[o]:Array.isArray(o)?[...o]:[]}var khe=0,q7=class Z7 extends wn{constructor(e,n,i){super(),this.resizeToggleTimeout=0,this.resizeMultiplier=1,this.resizeFeature=null,this.lastFocusEvent=null,this.dragSource=null,this.columnGroupChild=e,this.parentRowCtrl=i,this.beans=n,this.instanceId=e.getUniqueId()+"-"+khe++}wireBeans(e){this.pinnedWidthService=e.pinnedWidthService,this.focusService=e.focusService,this.userComponentFactory=e.userComponentFactory,this.ctrlsService=e.ctrlsService,this.dragAndDropService=e.dragAndDropService,this.menuService=e.menuService}postConstruct(){this.addManagedPropertyListeners(["suppressHeaderFocus"],()=>this.refreshTabIndex())}shouldStopEventPropagation(e){const{headerRowIndex:n,column:i}=this.focusService.getFocusedHeader();return She(this.gos,e,n,i)}getWrapperHasFocus(){return this.gos.getActiveDomElement()===this.eGui}setGui(e){this.eGui=e,this.addDomData(),this.addManagedListeners(this.beans.eventService,{displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this)}),this.addManagedElementListeners(this.eGui,{focus:this.onGuiFocus.bind(this)}),this.onDisplayedColumnsChanged(),this.refreshTabIndex()}onGuiFocus(){const e={type:"headerFocused",column:this.column};this.eventService.dispatchEvent(e)}onDisplayedColumnsChanged(){!this.comp||!this.column||(this.refreshFirstAndLastStyles(),this.refreshAriaColIndex())}refreshFirstAndLastStyles(){const{comp:e,column:n,beans:i}=this;$7(e,n,i.visibleColsService)}refreshAriaColIndex(){const{beans:e,column:n}=this,i=e.visibleColsService.getAriaColIndex(n);o7(this.eGui,i)}addResizeAndMoveKeyboardListeners(){this.resizeFeature&&this.addManagedListeners(this.eGui,{keydown:this.onGuiKeyDown.bind(this),keyup:this.onGuiKeyUp.bind(this)})}refreshTabIndex(){this.gos.get("suppressHeaderFocus")?this.eGui.removeAttribute("tabindex"):this.eGui.setAttribute("tabindex","-1")}onGuiKeyDown(e){var c;const n=this.gos.getActiveDomElement(),i=e.key===mn.LEFT||e.key===mn.RIGHT;if(this.isResizing&&(e.preventDefault(),e.stopImmediatePropagation()),n!==this.eGui||!e.shiftKey&&!e.altKey||((this.isResizing||i)&&(e.preventDefault(),e.stopImmediatePropagation()),!i))return;const r=e.key===mn.LEFT!==this.gos.get("enableRtl"),o=M7[r?"Left":"Right"];if(e.altKey){this.isResizing=!0,this.resizeMultiplier+=1;const s=this.getViewportAdjustedResizeDiff(e);this.resizeHeader(s,e.shiftKey),(c=this.resizeFeature)==null||c.toggleColumnResizing(!0)}else this.moveHeader(o)}getViewportAdjustedResizeDiff(e){let n=this.getResizeDiff(e);if(this.column.getPinned()){const r=this.pinnedWidthService.getPinnedLeftWidth(),o=this.pinnedWidthService.getPinnedRightWidth(),c=VS(this.ctrlsService.getGridBodyCtrl().getBodyViewportElement())-50;if(r+o+n>c)if(c>r+o)n=c-r-o;else return 0}return n}getResizeDiff(e){let n=e.key===mn.LEFT!==this.gos.get("enableRtl");const i=this.column.getPinned(),r=this.gos.get("enableRtl");return i&&r!==(i==="right")&&(n=!n),(n?-1:1)*this.resizeMultiplier}onGuiKeyUp(){this.isResizing&&(this.resizeToggleTimeout&&(window.clearTimeout(this.resizeToggleTimeout),this.resizeToggleTimeout=0),this.isResizing=!1,this.resizeMultiplier=1,this.resizeToggleTimeout=window.setTimeout(()=>{var e;(e=this.resizeFeature)==null||e.toggleColumnResizing(!1)},150))}handleKeyDown(e){const n=this.getWrapperHasFocus();switch(e.key){case mn.PAGE_DOWN:case mn.PAGE_UP:case mn.PAGE_HOME:case mn.PAGE_END:n&&e.preventDefault()}}addDomData(){const e=Z7.DOM_DATA_KEY_HEADER_CTRL;this.gos.setDomData(this.eGui,e,this),this.addDestroyFunc(()=>this.gos.setDomData(this.eGui,e,null))}getGui(){return this.eGui}focus(e){return this.eGui?(this.lastFocusEvent=e||null,this.eGui.focus(),!0):!1}getRowIndex(){return this.parentRowCtrl.getRowIndex()}getParentRowCtrl(){return this.parentRowCtrl}getPinned(){return this.parentRowCtrl.getPinned()}getInstanceId(){return this.instanceId}getColumnGroupChild(){return this.columnGroupChild}removeDragSource(){this.dragSource&&(this.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null)}handleContextMenuMouseEvent(e,n,i){const r=e??n;this.gos.get("preventDefaultOnContextMenu")&&r.preventDefault();const o=av(i)?i:void 0;this.menuService.isHeaderContextMenuEnabled(o)&&this.menuService.showHeaderContextMenu(o,e,n),this.dispatchColumnMouseEvent("columnHeaderContextMenu",i)}dispatchColumnMouseEvent(e,n){const i={type:e,column:n};this.eventService.dispatchEvent(i)}destroy(){super.destroy(),this.removeDragSource(),this.comp=null,this.column=null,this.resizeFeature=null,this.lastFocusEvent=null,this.columnGroupChild=null,this.parentRowCtrl=null,this.eGui=null}};q7.DOM_DATA_KEY_HEADER_CTRL="headerCtrl";var FA=q7,L3=class extends wn{wireBeans(t){this.columnHoverService=t.columnHoverService}constructor(t,e){super(),this.columns=t,this.element=e}postConstruct(){this.gos.get("columnHoverHighlight")&&this.addMouseHoverListeners()}addMouseHoverListeners(){this.addManagedListeners(this.element,{mouseout:this.onMouseOut.bind(this),mouseover:this.onMouseOver.bind(this)})}onMouseOut(){this.columnHoverService.clearMouseOver()}onMouseOver(){this.columnHoverService.setMouseOver(this.columns)}},Nhe=class extends FA{constructor(t,e,n){super(t,e,n),this.iconCreated=!1,this.column=t}setComp(t,e,n,i){this.comp=t,this.eButtonShowMainFilter=n,this.eFloatingFilterBody=i,this.setGui(e),this.setupActive(),this.setupWidth(),this.setupLeft(),this.setupHover(),this.setupFocus(),this.setupAria(),this.setupFilterButton(),this.setupUserComp(),this.setupSyncWithFilter(),this.setupUi(),this.addManagedElementListeners(this.eButtonShowMainFilter,{click:this.showParentFilter.bind(this)}),this.setupFilterChangedListener(),this.addManagedListeners(this.column,{colDefChanged:this.onColDefChanged.bind(this)})}resizeHeader(){}moveHeader(){}setupActive(){const t=this.column.getColDef(),e=!!t.filter,n=!!t.floatingFilter;this.active=e&&n}setupUi(){if(this.comp.setButtonWrapperDisplayed(!this.suppressFilterButton&&this.active),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-full-body",this.suppressFilterButton),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-body",!this.suppressFilterButton),!this.active||this.iconCreated)return;const t=gu("filter",this.gos,this.column);t&&(this.iconCreated=!0,this.eButtonShowMainFilter.appendChild(t))}setupFocus(){this.createManagedBean(new B_(this.eGui,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))}setupAria(){const t=this.localeService.getLocaleTextFunc();nw(this.eButtonShowMainFilter,t("ariaFilterMenuOpen","Open Filter Menu"))}onTabKeyDown(t){if(this.gos.getActiveDomElement()===this.eGui)return;const i=this.focusService.findNextFocusableElement(this.eGui,null,t.shiftKey);if(i){this.beans.headerNavigationService.scrollToColumn(this.column),t.preventDefault(),i.focus();return}const r=this.findNextColumnWithFloatingFilter(t.shiftKey);r&&this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:this.getParentRowCtrl().getRowIndex(),column:r},event:t})&&t.preventDefault()}findNextColumnWithFloatingFilter(t){const e=this.beans.visibleColsService;let n=this.column;do if(n=t?e.getColBefore(n):e.getColAfter(n),!n)break;while(!n.getColDef().filter||!n.getColDef().floatingFilter);return n}handleKeyDown(t){super.handleKeyDown(t);const e=this.getWrapperHasFocus();switch(t.key){case mn.UP:case mn.DOWN:e||t.preventDefault();case mn.LEFT:case mn.RIGHT:if(e)return;t.stopPropagation();case mn.ENTER:e&&this.focusService.focusInto(this.eGui)&&t.preventDefault();break;case mn.ESCAPE:e||this.eGui.focus()}}onFocusIn(t){if(this.eGui.contains(t.relatedTarget))return;const n=!!t.relatedTarget&&!t.relatedTarget.classList.contains("ag-floating-filter"),i=!!t.relatedTarget&&Ax(t.relatedTarget,"ag-floating-filter");if(n&&i&&t.target===this.eGui){const o=this.lastFocusEvent,c=!!(o&&o.key===mn.TAB);if(o&&c){const s=o.shiftKey;this.focusService.focusInto(this.eGui,s)}}const r=this.getRowIndex();this.beans.focusService.setFocusedHeader(r,this.column)}setupHover(){this.createManagedBean(new L3([this.column],this.eGui));const t=()=>{if(!this.gos.get("columnHoverHighlight"))return;const e=this.beans.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",e)};this.addManagedEventListeners({columnHoverChanged:t}),t()}setupLeft(){const t=new F3(this.column,this.eGui,this.beans);this.createManagedBean(t)}setupFilterButton(){this.suppressFilterButton=!this.menuService.isFloatingFilterButtonEnabled(this.column),this.highlightFilterButtonWhenActive=!this.menuService.isLegacyMenuEnabled()}setupUserComp(){var e;if(!this.active)return;const t=(e=this.beans.filterManager)==null?void 0:e.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter());t&&this.setCompDetails(t)}setCompDetails(t){this.userCompDetails=t,this.comp.setCompDetails(t)}showParentFilter(){const t=this.suppressFilterButton?this.eFloatingFilterBody:this.eButtonShowMainFilter;this.menuService.showFilterMenu({column:this.column,buttonElement:t,containerType:"floatingFilter",positionBy:"button"})}setupSyncWithFilter(){if(!this.active)return;const{filterManager:t}=this.beans,e=n=>{if((n==null?void 0:n.source)==="filterDestroyed"&&!this.isAlive())return;const i=this.comp.getFloatingFilterComp();i&&i.then(r=>{if(r){const o=t==null?void 0:t.getCurrentFloatingFilterParentModel(this.column),c=n?{...n,columns:n.columns??[],source:n.source==="api"?"api":"columnFilter"}:null;r.onParentModelChanged(o,c)}})};[this.destroySyncListener]=this.addManagedListeners(this.column,{filterChanged:e}),t!=null&&t.isFilterActive(this.column)&&e(null)}setupWidth(){const t=()=>{const e=`${this.column.getActualWidth()}px`;this.comp.setWidth(e)};this.addManagedListeners(this.column,{widthChanged:t}),t()}setupFilterChangedListener(){this.active&&([this.destroyFilterChangedListener]=this.addManagedListeners(this.column,{filterChanged:this.updateFilterButton.bind(this)}),this.updateFilterButton())}updateFilterButton(){var t;if(!this.suppressFilterButton&&this.comp){const e=!!((t=this.beans.filterManager)!=null&&t.isFilterAllowed(this.column));this.comp.setButtonWrapperDisplayed(e),this.highlightFilterButtonWhenActive&&e&&this.eButtonShowMainFilter.classList.toggle("ag-filter-active",this.column.isFilterActive())}}onColDefChanged(){var r;const t=this.active;this.setupActive();const e=!t&&this.active;t&&!this.active&&(this.destroySyncListener(),this.destroyFilterChangedListener());const n=this.active?(r=this.beans.filterManager)==null?void 0:r.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter()):null,i=this.comp.getFloatingFilterComp();!i||!n?this.updateCompDetails(n,e):i.then(o=>{var c;!o||(c=this.beans.filterManager)!=null&&c.areFilterCompsDifferent(this.userCompDetails??null,n)?this.updateCompDetails(n,e):this.updateFloatingFilterParams(n)})}updateCompDetails(t,e){this.isAlive()&&(this.setCompDetails(t),this.setupFilterButton(),this.setupUi(),e&&(this.setupSyncWithFilter(),this.setupFilterChangedListener()))}updateFloatingFilterParams(t){var n;if(!t)return;const e=t.params;(n=this.comp.getFloatingFilterComp())==null||n.then(i=>{let r=!1;i!=null&&i.refresh&&typeof i.refresh=="function"&&i.refresh(e)!==null&&(r=!0),!r&&(i!=null&&i.onParamsUpdated)&&typeof i.onParamsUpdated=="function"&&i.onParamsUpdated(e)!==null&&Tn("Custom floating filter method 'onParamsUpdated' is deprecated. Use 'refresh' instead.")})}destroy(){super.destroy(),this.eButtonShowMainFilter=null,this.eFloatingFilterBody=null,this.userCompDetails=null,this.destroySyncListener=null,this.destroyFilterChangedListener=null}},lr="32.0.2";function Bhe(t){var e,n;return!!((e=t.filterManager)!=null&&e.isColumnFilterPresent())||!!((n=t.filterManager)!=null&&n.isAggregateFilterPresent())}function zhe(t,e,n){var i;return(i=t.filterManager)==null?void 0:i.getFilterInstance(e,n)}function Uhe(t,e){var n;return((n=t.filterManager)==null?void 0:n.getColumnFilterInstance(e))??Promise.resolve(void 0)}function Vhe(t,e){var i;const n=t.columnModel.getColDefCol(e);if(n)return(i=t.filterManager)==null?void 0:i.destroyFilter(n,"api")}function Ghe(t,e){t.frameworkOverrides.wrapIncoming(()=>{var n;return(n=t.filterManager)==null?void 0:n.setFilterModel(e)})}function Hhe(t){var e;return((e=t.filterManager)==null?void 0:e.getFilterModel())??{}}function Whe(t,e){var n;return((n=t.filterManager)==null?void 0:n.getColumnFilterModel(e))??null}function jhe(t,e,n){var i;return((i=t.filterManager)==null?void 0:i.setColumnFilterModel(e,n))??Promise.resolve()}function $he(t,e){const n=t.columnModel.getCol(e);if(!n){_s(`column '${e}' not found`);return}t.menuService.showFilterMenu({column:n,containerType:"columnFilter",positionBy:"auto"})}function qhe(t,e,n){if(e==null)return null;let i=null;const{compName:r,jsComp:o,fwComp:c}=b7.getCompKeys(t,e,T3);return r?i={set:"agSetColumnFloatingFilter",agSetColumnFilter:"agSetColumnFloatingFilter",multi:"agMultiColumnFloatingFilter",agMultiColumnFilter:"agMultiColumnFloatingFilter",group:"agGroupColumnFloatingFilter",agGroupColumnFilter:"agGroupColumnFloatingFilter",number:"agNumberColumnFloatingFilter",agNumberColumnFilter:"agNumberColumnFloatingFilter",date:"agDateColumnFloatingFilter",agDateColumnFilter:"agDateColumnFloatingFilter",text:"agTextColumnFloatingFilter",agTextColumnFilter:"agTextColumnFloatingFilter"}[r]:o==null&&c==null&&e.filter===!0&&(i=n()),i}var Zhe=class extends wn{constructor(){super(...arguments),this.beanName="columnFilterService",this.allColumnFilters=new Map,this.allColumnListeners=new Map,this.activeAggregateFilters=[],this.activeColumnFilters=[],this.processingFilterChange=!1,this.filterModelUpdateQueue=[],this.columnFilterModelUpdateQueue=[]}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.rowModel=t.rowModel,this.userComponentFactory=t.userComponentFactory,this.rowRenderer=t.rowRenderer,this.dataTypeService=t.dataTypeService,this.filterManager=t.filterManager}postConstruct(){var t,e;this.addManagedEventListeners({gridColumnsChanged:this.onColumnsChanged.bind(this),rowDataUpdated:()=>this.onNewRowsLoaded("rowDataUpdated"),dataTypesInferred:this.processFilterModelUpdateQueue.bind(this)}),this.initialFilterModel={...((e=(t=this.gos.get("initialState"))==null?void 0:t.filter)==null?void 0:e.filterModel)??{}}}setFilterModel(t,e="api"){var r;if((r=this.dataTypeService)!=null&&r.isPendingInference()){this.filterModelUpdateQueue.push({model:t,source:e});return}const n=[],i=this.getFilterModel();if(t){const o=new Set(Object.keys(t));this.allColumnFilters.forEach((c,s)=>{const f=t[s];n.push(this.setModelOnFilterWrapper(c.filterPromise,f)),o.delete(s)}),o.forEach(c=>{const s=this.columnModel.getColDefCol(c)||this.columnModel.getCol(c);if(!s){Tn("setFilterModel() - no column found for colId: "+c);return}if(!s.isFilterAllowed()){Tn("setFilterModel() - unable to fully apply model, filtering disabled for colId: "+c);return}const f=this.getOrCreateFilterWrapper(s);if(!f){Tn("setFilterModel() - unable to fully apply model, unable to create filter for colId: "+c);return}n.push(this.setModelOnFilterWrapper(f.filterPromise,t[c]))})}else this.allColumnFilters.forEach(o=>{n.push(this.setModelOnFilterWrapper(o.filterPromise,null))});Zo.all(n).then(()=>{var s;const o=this.getFilterModel(),c=[];this.allColumnFilters.forEach((f,v)=>{const w=i?i[v]:null,C=o?o[v]:null;eT(w,C)||c.push(f.column)}),c.length>0&&((s=this.filterManager)==null||s.onFilterChanged({columns:c,source:e}))})}setModelOnFilterWrapper(t,e){return new Zo(n=>{t.then(i=>{typeof i.setModel!="function"&&(Tn("filter missing setModel method, which is needed for setFilterModel"),n()),(i.setModel(e)||Zo.resolve()).then(()=>n())})})}getFilterModel(){const t={};return this.allColumnFilters.forEach((e,n)=>{const i=this.getModelFromFilterWrapper(e);$n(i)&&(t[n]=i)}),t}getModelFromFilterWrapper(t){const{filter:e}=t;return e?typeof e.getModel!="function"?(Tn("filter API missing getModel method, which is needed for getFilterModel"),null):e.getModel():this.getModelFromInitialState(t.column)}getModelFromInitialState(t){return this.initialFilterModel[t.getColId()]??null}isColumnFilterPresent(){return this.activeColumnFilters.length>0}isAggregateFilterPresent(){return!!this.activeAggregateFilters.length}disableColumnFilters(){return this.allColumnFilters.size?(this.allColumnFilters.forEach(t=>this.disposeFilterWrapper(t,"advancedFilterEnabled")),!0):!1}doAggregateFiltersPass(t,e){return this.doColumnFiltersPass(t,e,!0)}updateActiveFilters(){const t=o=>o?o.isFilterActive?o.isFilterActive():(Tn("Filter is missing isFilterActive() method"),!1):!1,e=!!this.gos.getGroupAggFiltering(),n=o=>{if(!o.isPrimary())return!0;const s=!this.columnModel.isPivotActive();return!o.isValueActive()||!s?!1:this.columnModel.isPivotMode()?!0:e},i=[],r=[];return this.forEachColumnFilter((o,c)=>{t(o)&&(n(c.column)?i.push(o):r.push(o))}).then(()=>{this.activeAggregateFilters=i,this.activeColumnFilters=r})}updateFilterFlagInColumns(t,e){return this.forEachColumnFilter((n,i)=>i.column.setFilterActive(n.isFilterActive(),t,e))}forEachColumnFilter(t){return Zo.all(Array.from(this.allColumnFilters.values()).map(e=>e.filterPromise.then(n=>t(n,e))))}doColumnFiltersPass(t,e,n){const{data:i,aggData:r}=t,o=n?this.activeAggregateFilters:this.activeColumnFilters,c=n?r:i;for(let s=0;s<o.length;s++){const f=o[s];if(!(f==null||f===e)){if(typeof f.doesFilterPass!="function")throw new Error("Filter is missing method doesFilterPass");if(!f.doesFilterPass({node:t,data:c}))return!1}}return!0}callOnFilterChangedOutsideRenderCycle(t){const e=()=>{var n;return(n=this.filterManager)==null?void 0:n.onFilterChanged(t)};this.rowRenderer.isRefreshInProgress()?setTimeout(e,0):e()}updateBeforeFilterChanged(t={}){const{filterInstance:e,additionalEventAttributes:n}=t;return this.updateDependentFilters(),this.updateActiveFilters().then(()=>this.updateFilterFlagInColumns("filterChanged",n).then(()=>{this.allColumnFilters.forEach(i=>{i.filterPromise&&i.filterPromise.then(r=>{r&&r!==e&&r.onAnyFilterChanged&&r.onAnyFilterChanged()})}),this.processingFilterChange=!0}))}updateAfterFilterChanged(){this.processingFilterChange=!1}isSuppressFlashingCellsBecauseFiltering(){return!(this.gos.get("allowShowChangeAfterFilter")??!1)&&this.processingFilterChange}onNewRowsLoaded(t){this.forEachColumnFilter(e=>{e.onNewRowsLoaded&&e.onNewRowsLoaded()}).then(()=>this.updateFilterFlagInColumns(t,{afterDataChange:!0})).then(()=>this.updateActiveFilters())}createValueGetter(t){return({node:e})=>this.valueService.getValue(t,e,!0)}createGetValue(t){return(e,n)=>{const i=n?this.columnModel.getCol(n):t;return i?this.valueService.getValue(i,e,!0):void 0}}isFilterActive(t){const{filter:e}=this.cachedFilter(t)??{};return e?e.isFilterActive():this.getModelFromInitialState(t)!=null}getOrCreateFilterWrapper(t){if(!t.isFilterAllowed())return null;let e=this.cachedFilter(t);return e||(e=this.createFilterWrapper(t),this.setColumnFilterWrapper(t,e)),e}cachedFilter(t){return this.allColumnFilters.get(t.getColId())}getDefaultFilter(t){var n;let e;if(xl.__isRegistered("@ag-grid-enterprise/set-filter",this.gridId))e="agSetColumnFilter";else{const i=(n=this.dataTypeService)==null?void 0:n.getBaseDataType(t);i==="number"?e="agNumberColumnFilter":i==="date"||i==="dateString"?e="agDateColumnFilter":e="agTextColumnFilter"}return e}getDefaultFloatingFilter(t){var n;let e;if(xl.__isRegistered("@ag-grid-enterprise/set-filter",this.gridId))e="agSetColumnFloatingFilter";else{const i=(n=this.dataTypeService)==null?void 0:n.getBaseDataType(t);i==="number"?e="agNumberColumnFloatingFilter":i==="date"||i==="dateString"?e="agDateColumnFloatingFilter":e="agTextColumnFloatingFilter"}return e}createFilterInstance(t,e){const n=this.getDefaultFilter(t),i=t.getColDef();let r;const o={...this.createFilterParams(t,i),filterModifiedCallback:()=>this.filterModifiedCallbackFactory(r,t)(),filterChangedCallback:s=>this.filterChangedCallbackFactory(r,t)(s),doesRowPassOtherFilter:s=>this.filterManager?this.filterManager.doesRowPassOtherFilters(r,s):!0},c=this.userComponentFactory.getFilterDetails(i,o,n);return c?{filterPromise:()=>{const s=c.newAgStackInstance();return s!=null&&s.then(f=>{r=f,e&&(e.filter=f)}),s},compDetails:c}:{filterPromise:null,compDetails:null}}createFilterParams(t,e){return this.gos.addGridCommonParams({column:t,colDef:X$(e),rowModel:this.rowModel,filterChangedCallback:()=>{},filterModifiedCallback:()=>{},valueGetter:this.createValueGetter(t),getValue:this.createGetValue(t),doesRowPassOtherFilter:()=>!0})}createFilterWrapper(t){const e={column:t,filterPromise:null,compiledElement:null,compDetails:null},{filterPromise:n,compDetails:i}=this.createFilterInstance(t,e);return e.filterPromise=(n==null?void 0:n())??null,e.compDetails=i,e}onColumnsChanged(){var e;const t=[];this.allColumnFilters.forEach((n,i)=>{let r;n.column.isPrimary()?r=this.columnModel.getColDefCol(i):r=this.columnModel.getCol(i),!(r&&r===n.column)&&(t.push(n.column),this.disposeFilterWrapper(n,"columnChanged"),this.disposeColumnListener(i))}),t.length>0?(e=this.filterManager)==null||e.onFilterChanged({columns:t,source:"api"}):this.updateDependentFilters()}updateDependentFilters(){const t=this.columnModel.getAutoCols();t==null||t.forEach(e=>{e.getColDef().filter==="agGroupColumnFilter"&&this.getOrCreateFilterWrapper(e)})}isFilterAllowed(t){if(!t.isFilterAllowed())return!1;const{filter:n}=this.allColumnFilters.get(t.getColId())??{};return n&&typeof(n==null?void 0:n.isFilterAllowed)=="function"?n.isFilterAllowed():!0}getFloatingFilterCompDetails(t,e){const n=f=>{var w;const v=(w=this.getOrCreateFilterWrapper(t))==null?void 0:w.filterPromise;v!=null&&v.then(C=>{f(S1(C))})},i=t.getColDef(),r={...this.createFilterParams(t,i),filterChangedCallback:()=>n(f=>this.filterChangedCallbackFactory(f,t)())},o=this.userComponentFactory.mergeParamsWithApplicationProvidedParams(i,T3,r);let c=qhe(this.frameworkOverrides,i,()=>this.getDefaultFloatingFilter(t));c==null&&(c="agReadOnlyFloatingFilter");const s={column:t,filterParams:o,currentParentModel:()=>this.getCurrentFloatingFilterParentModel(t),parentFilterInstance:n,showParentFilter:e,suppressFilterButton:!1};return this.userComponentFactory.getFloatingFilterCompDetails(i,s,c)}getCurrentFloatingFilterParentModel(t){return this.getModelFromFilterWrapper(this.cachedFilter(t)??{column:t})}destroyFilter(t,e="api"){var r;const n=t.getColId(),i=this.allColumnFilters.get(n);this.disposeColumnListener(n),delete this.initialFilterModel[n],i&&(this.disposeFilterWrapper(i,e),(r=this.filterManager)==null||r.onFilterChanged({columns:[t],source:"api"}))}disposeColumnListener(t){const e=this.allColumnListeners.get(t);e&&(this.allColumnListeners.delete(t),e())}disposeFilterWrapper(t,e){t.filterPromise.then(n=>{this.destroyBean(n),t.column.setFilterActive(!1,"filterDestroyed"),this.allColumnFilters.delete(t.column.getColId());const i={type:"filterDestroyed",source:e,column:t.column};this.eventService.dispatchEvent(i)})}filterModifiedCallbackFactory(t,e){return()=>{const n={type:"filterModified",column:e,filterInstance:t};this.eventService.dispatchEvent(n)}}filterChangedCallbackFactory(t,e){return n=>{const i=(n==null?void 0:n.source)??"columnFilter",r={filter:t,additionalEventAttributes:n,columns:[e],source:i};this.callOnFilterChangedOutsideRenderCycle(r)}}checkDestroyFilter(t){const e=this.allColumnFilters.get(t);if(!e)return;const n=e.column,{compDetails:i}=n.isFilterAllowed()?this.createFilterInstance(n):{compDetails:null};if(this.areFilterCompsDifferent(e.compDetails,i)){this.destroyFilter(n,"paramsUpdated");return}const r=n.getColDef().filterParams;if(!e.filterPromise){this.destroyFilter(n,"paramsUpdated");return}e.filterPromise.then(o=>{(o!=null&&o.refresh?o.refresh({...this.createFilterParams(n,n.getColDef()),filterModifiedCallback:this.filterModifiedCallbackFactory(o,n),filterChangedCallback:this.filterChangedCallbackFactory(o,n),doesRowPassOtherFilter:s=>this.filterManager?this.filterManager.doesRowPassOtherFilters(o,s):!0,...r}):!0)===!1&&this.destroyFilter(n,"paramsUpdated")})}setColumnFilterWrapper(t,e){const n=t.getColId();this.allColumnFilters.set(n,e),this.allColumnListeners.set(n,this.addManagedListeners(t,{colDefChanged:()=>this.checkDestroyFilter(n)})[0])}areFilterCompsDifferent(t,e){if(!e||!t)return!0;const{componentClass:n}=t,{componentClass:i}=e;return!(n===i||(n==null?void 0:n.render)&&(i==null?void 0:i.render)&&n.render===i.render)}hasFloatingFilters(){return this.columnModel.getCols().some(e=>e.getColDef().floatingFilter)}getFilterInstance(t,e){e&&this.getFilterInstanceImpl(t).then(n=>{const i=S1(n);e(i)})}getColumnFilterInstance(t){return new Promise(e=>{this.getFilterInstanceImpl(t).then(n=>{e(S1(n))})})}getFilterInstanceImpl(t){var i;const e=this.columnModel.getColDefCol(t);return e?((i=this.getOrCreateFilterWrapper(e))==null?void 0:i.filterPromise)??Zo.resolve(null):Zo.resolve(void 0)}processFilterModelUpdateQueue(){this.filterModelUpdateQueue.forEach(({model:t,source:e})=>this.setFilterModel(t,e)),this.filterModelUpdateQueue=[],this.columnFilterModelUpdateQueue.forEach(({key:t,model:e,resolve:n})=>{this.setColumnFilterModel(t,e).then(()=>n())}),this.columnFilterModelUpdateQueue=[]}getColumnFilterModel(t){const e=this.getFilterWrapper(t);return e?this.getModelFromFilterWrapper(e):null}setColumnFilterModel(t,e){var o;if((o=this.dataTypeService)!=null&&o.isPendingInference()){let c=()=>{};const s=new Promise(f=>{c=f});return this.columnFilterModelUpdateQueue.push({key:t,model:e,resolve:c}),s}const n=this.columnModel.getColDefCol(t),i=n?this.getOrCreateFilterWrapper(n):null;return i?(c=>new Promise(s=>{c.then(f=>s(f))}))(this.setModelOnFilterWrapper(i.filterPromise,e)):Promise.resolve()}getFilterWrapper(t){const e=this.columnModel.getColDefCol(t);return e?this.cachedFilter(e)??null:null}destroy(){super.destroy(),this.allColumnFilters.forEach(t=>this.disposeFilterWrapper(t,"gridDestroyed")),this.allColumnListeners.clear()}};function Xhe(t){var e;return!!((e=t.filterManager)!=null&&e.isAnyFilterPresent())}function Khe(t,e="api"){var n;(n=t.filterManager)==null||n.onFilterChanged({source:e})}var Yhe=class extends Js{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field data-ref="eFloatingFilterText"></ag-input-text-field>
            </div>`,[DA]),this.eFloatingFilterText=qi}wireBeans(t){this.columnNameService=t.columnNameService}destroy(){super.destroy()}init(t){this.params=t;const e=this.columnNameService.getDisplayNameForColumn(t.column,"header",!0),n=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setDisabled(!0).setInputAriaLabel(`${e} ${n("ariaFilterInput","Filter Input")}`)}onParentModelChanged(t){if(t==null){this.eFloatingFilterText.setValue("");return}this.params.parentFilterInstance(e=>{if(e.getModelAsString){const n=e.getModelAsString(t);this.eFloatingFilterText.setValue(n)}})}onParamsUpdated(t){this.refresh(t)}refresh(t){this.init(t)}},X7=class extends Js{wireBeans(t){this.columnNameService=t.columnNameService}getDefaultDebounceMs(){return 0}destroy(){super.destroy()}isEventFromFloatingFilter(t){return t&&t.afterFloatingFilter}isEventFromDataChange(t){return t==null?void 0:t.afterDataChange}getLastType(){return this.lastType}isReadOnly(){return this.readOnly}setLastTypeFromModel(t){if(!t){this.lastType=this.optionsFactory.getDefaultOption();return}const e=t.operator;let n;e?n=t.conditions[0]:n=t,this.lastType=n.type}canWeEditAfterModelFromParentFilter(t){if(!t)return this.isTypeEditable(this.lastType);if(t.operator)return!1;const n=t;return this.isTypeEditable(n.type)}init(t){this.setSimpleParams(t,!1)}setSimpleParams(t,e=!0){this.optionsFactory=new D7,this.optionsFactory.init(t.filterParams,this.getDefaultFilterOptions()),e||(this.lastType=this.optionsFactory.getDefaultOption()),this.readOnly=!!t.filterParams.readOnly;const n=this.isTypeEditable(this.optionsFactory.getDefaultOption());this.setEditable(n)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.setSimpleParams(t)}doesFilterHaveSingleInput(t){const e=this.optionsFactory.getCustomOption(t),{numberOfInputs:n}=e||{};return n==null||n==1}isTypeEditable(t){const e=["inRange","empty","blank","notBlank"];return!!t&&!this.isReadOnly()&&this.doesFilterHaveSingleInput(t)&&e.indexOf(t)<0}getAriaLabel(t){const e=this.columnNameService.getDisplayNameForColumn(t.column,"header",!0),n=this.localeService.getLocaleTextFunc();return`${e} ${n("ariaFilterInput","Filter Input")}`}},Jhe=class extends X7{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field data-ref="eReadOnlyText"></ag-input-text-field>
                <div data-ref="eDateWrapper" style="display: flex;"></div>
            </div>`,[DA]),this.eReadOnlyText=qi,this.eDateWrapper=qi}wireBeans(t){super.wireBeans(t),this.context=t.context,this.userComponentFactory=t.userComponentFactory}getDefaultFilterOptions(){return H7}init(t){super.init(t),this.params=t,this.filterParams=t.filterParams,this.createDateComponent(),this.filterModelFormatter=new W7(this.filterParams,this.localeService,this.optionsFactory);const e=this.localeService.getLocaleTextFunc();this.eReadOnlyText.setDisabled(!0).setInputAriaLabel(e("ariaDateFilterInput","Date Filter Input"))}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.params=t,this.filterParams=t.filterParams,this.updateDateComponent(),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory,dateFilterParams:this.filterParams}),this.updateCompOnModelChange(t.currentParentModel())}updateCompOnModelChange(t){const e=!this.isReadOnly()&&this.canWeEditAfterModelFromParentFilter(t);if(this.setEditable(e),e){if(t){const n=t;this.dateComp.setDate(Oc(n.dateFrom))}else this.dateComp.setDate(null);this.eReadOnlyText.setValue("")}else this.eReadOnlyText.setValue(this.filterModelFormatter.getModelAsString(t)),this.dateComp.setDate(null)}setEditable(t){Do(this.eDateWrapper,t),Do(this.eReadOnlyText.getGui(),!t)}onParentModelChanged(t,e){this.isEventFromFloatingFilter(e)||this.isEventFromDataChange(e)||(super.setLastTypeFromModel(t),this.updateCompOnModelChange(t))}onDateChanged(){const t=this.dateComp.getDate(),e=eh(t);this.params.parentFilterInstance(n=>{if(n){const i=Oc(e);n.onFloatingFilterChanged(this.getLastType()||null,i)}})}getDateComponentParams(){const t=A3(this.params.filterParams,this.getDefaultDebounceMs());return{onDateChanged:Kl(this.onDateChanged.bind(this),t),filterParams:this.params.column.getColDef().filterParams}}createDateComponent(){this.dateComp=new G7(this.context,this.userComponentFactory,this.getDateComponentParams(),this.eDateWrapper,t=>{t.setInputAriaLabel(this.getAriaLabel(this.params))}),this.addDestroyFunc(()=>this.dateComp.destroy())}updateDateComponent(){const t=this.gos.addGridCommonParams(this.getDateComponentParams());this.dateComp.updateParams(t)}getFilterModelFormatter(){return this.filterModelFormatter}},Qhe=class extends Js{constructor(){super(`
            <div class="ag-filter-filter">
                <ag-input-text-field class="ag-date-filter" data-ref="eDateInput"></ag-input-text-field>
            </div>`,[DA]),this.eDateInput=qi}destroy(){super.destroy()}init(t){this.params=t,this.setParams(t);const e=this.eDateInput.getInputElement();this.addManagedListeners(e,{mouseDown:()=>{this.eDateInput.isDisabled()||this.usingSafariDatePicker||e.focus()},input:n=>{n.target===this.gos.getActiveDomElement()&&(this.eDateInput.isDisabled()||this.params.onDateChanged())}})}setParams(t){const e=this.eDateInput.getInputElement(),n=this.shouldUseBrowserDatePicker(t);this.usingSafariDatePicker=n&&Qp(),e.type=n?"date":"text";const{minValidYear:i,maxValidYear:r,minValidDate:o,maxValidDate:c}=t.filterParams||{};if(o&&i&&Tn("DateFilter should not have both minValidDate and minValidYear parameters set at the same time! minValidYear will be ignored."),c&&r&&Tn("DateFilter should not have both maxValidDate and maxValidYear parameters set at the same time! maxValidYear will be ignored."),o&&c){const[s,f]=[o,c].map(v=>v instanceof Date?v:Oc(v));s&&f&&s.getTime()>f.getTime()&&Tn("DateFilter parameter minValidDate should always be lower than or equal to parameter maxValidDate.")}o?o instanceof Date?e.min=E1(o):e.min=o:i&&(e.min=`${i}-01-01`),c?c instanceof Date?e.max=E1(c):e.max=c:r&&(e.max=`${r}-12-31`)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams(t)}getDate(){return Oc(this.eDateInput.getValue())}setDate(t){this.eDateInput.setValue(eh(t,!1))}setInputPlaceholder(t){this.eDateInput.setInputPlaceholder(t)}setInputAriaLabel(t){this.eDateInput.setAriaLabel(t)}setDisabled(t){this.eDateInput.setDisabled(t)}afterGuiAttached(t){(!t||!t.suppressFocus)&&this.eDateInput.getInputElement().focus()}shouldUseBrowserDatePicker(t){return t.filterParams&&t.filterParams.browserDatePicker!=null?t.filterParams.browserDatePicker:x3()||l7()||Qp()&&a7()>=14.1}},K7=class extends wn{constructor(t){super(),this.params=t,this.eFloatingFilterTextInput=qi,this.valueChangedListener=()=>{}}setupGui(t){var i;this.eFloatingFilterTextInput=this.createManagedBean(new z_((i=this.params)==null?void 0:i.config));const e=this.eFloatingFilterTextInput.getGui();t.appendChild(e);const n=r=>this.valueChangedListener(r);this.addManagedListeners(e,{input:n,keydown:n})}setEditable(t){this.eFloatingFilterTextInput.setDisabled(!t)}setAutoComplete(t){this.eFloatingFilterTextInput.setAutoComplete(t)}getValue(){return this.eFloatingFilterTextInput.getValue()}setValue(t,e){this.eFloatingFilterTextInput.setValue(t,e)}setValueChangedListener(t){this.valueChangedListener=t}setParams(t){this.setAriaLabel(t.ariaLabel),t.autoComplete!==void 0&&this.setAutoComplete(t.autoComplete)}setAriaLabel(t){this.eFloatingFilterTextInput.setInputAriaLabel(t)}},Y7=class extends X7{constructor(){super(...arguments),this.eFloatingFilterInputContainer=qi}postConstruct(){this.setTemplate(`
            <div class="ag-floating-filter-input" role="presentation" data-ref="eFloatingFilterInputContainer"></div>
        `)}getDefaultDebounceMs(){return 500}onParentModelChanged(t,e){this.isEventFromFloatingFilter(e)||this.isEventFromDataChange(e)||(this.setLastTypeFromModel(t),this.setEditable(this.canWeEditAfterModelFromParentFilter(t)),this.floatingFilterInputService.setValue(this.getFilterModelFormatter().getModelAsString(t)))}init(t){this.setupFloatingFilterInputService(t),super.init(t),this.setTextInputParams(t)}setupFloatingFilterInputService(t){this.floatingFilterInputService=this.createFloatingFilterInputService(t),this.floatingFilterInputService.setupGui(this.eFloatingFilterInputContainer)}setTextInputParams(t){this.params=t;const e=t.browserAutoComplete??!1;if(this.floatingFilterInputService.setParams({ariaLabel:this.getAriaLabel(t),autoComplete:e}),this.applyActive=lT(this.params.filterParams),!this.isReadOnly()){const n=A3(this.params.filterParams,this.getDefaultDebounceMs()),i=Kl(this.syncUpWithParentFilter.bind(this),n);this.floatingFilterInputService.setValueChangedListener(i)}}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.setTextInputParams(t)}recreateFloatingFilterInputService(t){const e=this.floatingFilterInputService.getValue();Cu(this.eFloatingFilterInputContainer),this.destroyBean(this.floatingFilterInputService),this.setupFloatingFilterInputService(t),this.floatingFilterInputService.setValue(e,!0)}syncUpWithParentFilter(t){const e=t.key===mn.ENTER;if(this.applyActive&&!e)return;let n=this.floatingFilterInputService.getValue();this.params.filterParams.trimInput&&(n=U7(n),this.floatingFilterInputService.setValue(n,!0)),this.params.parentFilterInstance(i=>{i&&i.onFloatingFilterChanged(this.getLastType()||null,n||null)})}setEditable(t){this.floatingFilterInputService.setEditable(t)}},ede=class extends wn{constructor(){super(...arguments),this.valueChangedListener=()=>{},this.numberInputActive=!0}setupGui(t){this.eFloatingFilterNumberInput=this.createManagedBean(new I3),this.eFloatingFilterTextInput=this.createManagedBean(new z_),this.eFloatingFilterTextInput.setDisabled(!0);const e=this.eFloatingFilterNumberInput.getGui(),n=this.eFloatingFilterTextInput.getGui();t.appendChild(e),t.appendChild(n),this.setupListeners(e,i=>this.valueChangedListener(i)),this.setupListeners(n,i=>this.valueChangedListener(i))}setEditable(t){this.numberInputActive=t,this.eFloatingFilterNumberInput.setDisplayed(this.numberInputActive),this.eFloatingFilterTextInput.setDisplayed(!this.numberInputActive)}setAutoComplete(t){this.eFloatingFilterNumberInput.setAutoComplete(t),this.eFloatingFilterTextInput.setAutoComplete(t)}getValue(){return this.getActiveInputElement().getValue()}setValue(t,e){this.getActiveInputElement().setValue(t,e)}getActiveInputElement(){return this.numberInputActive?this.eFloatingFilterNumberInput:this.eFloatingFilterTextInput}setValueChangedListener(t){this.valueChangedListener=t}setupListeners(t,e){this.addManagedListeners(t,{input:e,keydown:e})}setParams(t){this.setAriaLabel(t.ariaLabel),t.autoComplete!==void 0&&this.setAutoComplete(t.autoComplete)}setAriaLabel(t){this.eFloatingFilterNumberInput.setInputAriaLabel(t),this.eFloatingFilterTextInput.setInputAriaLabel(t)}},tde=class extends Y7{init(t){var e;super.init(t),this.filterModelFormatter=new N7(this.localeService,this.optionsFactory,(e=t.filterParams)==null?void 0:e.numberFormatter)}onParamsUpdated(t){this.refresh(t)}refresh(t){PL(t.filterParams)!==this.allowedCharPattern&&this.recreateFloatingFilterInputService(t),super.refresh(t),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory})}getDefaultFilterOptions(){return k7}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(t){return this.allowedCharPattern=PL(t.filterParams),this.allowedCharPattern?this.createManagedBean(new K7({config:{allowedCharPattern:this.allowedCharPattern}})):this.createManagedBean(new ede)}},nde=class extends Y7{init(t){super.init(t),this.filterModelFormatter=new z7(this.localeService,this.optionsFactory)}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory})}getDefaultFilterOptions(){return B7}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(){return this.createManagedBean(new K7)}};function ide(t){var e;return!!((e=t.filterManager)!=null&&e.isQuickFilterPresent())}function rde(t){return t.gos.get("quickFilterText")}function sde(t){var e;(e=t.filterManager)==null||e.resetQuickFilterCache()}var ode=class extends wn{constructor(){super(...arguments),this.beanName="quickFilterService",this.quickFilter=null,this.quickFilterParts=null}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.rowModel=t.rowModel,this.pivotResultColsService=t.pivotResultColsService}postConstruct(){const t=this.resetQuickFilterCache.bind(this);this.addManagedEventListeners({columnPivotModeChanged:t,newColumnsLoaded:t,columnRowGroupChanged:t,columnVisible:()=>{this.gos.get("includeHiddenColumnsInQuickFilter")||this.resetQuickFilterCache()}}),this.addManagedPropertyListener("quickFilterText",e=>this.setQuickFilter(e.currentValue)),this.addManagedPropertyListeners(["includeHiddenColumnsInQuickFilter","applyQuickFilterBeforePivotOrAgg"],()=>this.onQuickFilterColumnConfigChanged()),this.quickFilter=this.parseQuickFilter(this.gos.get("quickFilterText")),this.parser=this.gos.get("quickFilterParser"),this.matcher=this.gos.get("quickFilterMatcher"),this.setQuickFilterParts(),this.addManagedPropertyListeners(["quickFilterMatcher","quickFilterParser"],()=>this.setQuickFilterParserAndMatcher())}refreshQuickFilterCols(){var r;const t=this.columnModel.isPivotMode(),e=this.columnModel.getAutoCols(),n=this.columnModel.getColDefCols();let i=(t&&!this.gos.get("applyQuickFilterBeforePivotOrAgg")?(r=this.pivotResultColsService.getPivotResultCols())==null?void 0:r.list:n)??[];e&&(i=i.concat(e)),this.colsForQuickFilter=this.gos.get("includeHiddenColumnsInQuickFilter")?i:i.filter(o=>o.isVisible()||o.isRowGroupActive())}isQuickFilterPresent(){return this.quickFilter!==null}doesRowPassQuickFilter(t){const e=this.gos.get("cacheQuickFilter");return this.matcher?this.doesRowPassQuickFilterMatcher(e,t):this.quickFilterParts.every(n=>e?this.doesRowPassQuickFilterCache(t,n):this.doesRowPassQuickFilterNoCache(t,n))}resetQuickFilterCache(){this.rowModel.forEachNode(t=>t.quickFilterAggregateText=null)}setQuickFilterParts(){const{quickFilter:t,parser:e}=this;t?this.quickFilterParts=e?e(t):t.split(" "):this.quickFilterParts=null}parseQuickFilter(t){return $n(t)?this.gos.isRowModelType("clientSide")?t.toUpperCase():(Tn("Quick filtering only works with the Client-Side Row Model"),null):null}setQuickFilter(t){if(t!=null&&typeof t!="string"){Tn(`Grid option quickFilterText only supports string inputs, received: ${typeof t}`);return}const e=this.parseQuickFilter(t);this.quickFilter!==e&&(this.quickFilter=e,this.setQuickFilterParts(),this.dispatchLocalEvent({type:"quickFilterChanged"}))}setQuickFilterParserAndMatcher(){const t=this.gos.get("quickFilterParser"),e=this.gos.get("quickFilterMatcher"),n=t!==this.parser||e!==this.matcher;this.parser=t,this.matcher=e,n&&(this.setQuickFilterParts(),this.dispatchLocalEvent({type:"quickFilterChanged"}))}onQuickFilterColumnConfigChanged(){this.refreshQuickFilterCols(),this.resetQuickFilterCache(),this.isQuickFilterPresent()&&this.dispatchLocalEvent({type:"quickFilterChanged"})}doesRowPassQuickFilterNoCache(t,e){return this.colsForQuickFilter.some(n=>{const i=this.getQuickFilterTextForColumn(n,t);return $n(i)&&i.indexOf(e)>=0})}doesRowPassQuickFilterCache(t,e){return this.checkGenerateQuickFilterAggregateText(t),t.quickFilterAggregateText.indexOf(e)>=0}doesRowPassQuickFilterMatcher(t,e){let n;t?(this.checkGenerateQuickFilterAggregateText(e),n=e.quickFilterAggregateText):n=this.getQuickFilterAggregateText(e);const{quickFilterParts:i,matcher:r}=this;return r(i,n)}checkGenerateQuickFilterAggregateText(t){t.quickFilterAggregateText||(t.quickFilterAggregateText=this.getQuickFilterAggregateText(t))}getQuickFilterTextForColumn(t,e){let n=this.valueService.getValue(t,e,!0);const i=t.getColDef();if(i.getQuickFilterText){const r=this.gos.addGridCommonParams({value:n,node:e,data:e.data,column:t,colDef:i});n=i.getQuickFilterText(r)}return $n(n)?n.toString().toUpperCase():null}getQuickFilterAggregateText(t){const e=[];return this.colsForQuickFilter.forEach(n=>{const i=this.getQuickFilterTextForColumn(n,t);$n(i)&&e.push(i)}),e.join(`
`)}},O3={version:lr,moduleName:"@ag-grid-community/filter-core",beans:[lhe]},ade={version:lr,moduleName:"@ag-grid-community/filter-api",apiFunctions:{isAnyFilterPresent:Xhe,onFilterChanged:Khe},dependantModules:[O3]},k3={version:lr,moduleName:"@ag-grid-community/column-filter",beans:[Zhe],dependantModules:[O3]},lde={version:lr,moduleName:"@ag-grid-community/column-filter-api",apiFunctions:{isColumnFilterPresent:Bhe,getFilterInstance:zhe,getColumnFilterInstance:Uhe,destroyFilter:Vhe,setFilterModel:Ghe,getFilterModel:Hhe,getColumnFilterModel:Whe,setColumnFilterModel:jhe,showColumnFilter:$he},dependantModules:[k3,ade]},J7={version:lr,moduleName:"@ag-grid-community/floating-filter-core",controllers:[{name:"headerFilterCell",classImp:Nhe}],dependantModules:[k3]},cde={version:lr,moduleName:"@ag-grid-community/read-only-floating-filter",userComponents:[{name:"agReadOnlyFloatingFilter",classImp:Yhe}],dependantModules:[J7]},ude={version:lr,moduleName:"@ag-grid-community/simple-filter",dependantModules:[k3],userComponents:[{name:"agTextColumnFilter",classImp:The},{name:"agNumberColumnFilter",classImp:Rhe},{name:"agDateColumnFilter",classImp:Ihe},{name:"agDateInput",classImp:Qhe}]},hde={version:lr,moduleName:"@ag-grid-community/simple-floating-filter",dependantModules:[ude,J7],userComponents:[{name:"agTextColumnFloatingFilter",classImp:nde},{name:"agNumberColumnFloatingFilter",classImp:tde},{name:"agDateColumnFloatingFilter",classImp:Jhe}]},Q7={version:lr,moduleName:"@ag-grid-community/quick-filter-core",beans:[ode],dependantModules:[O3]},dde={version:lr,moduleName:"@ag-grid-community/quick-filter-api",apiFunctions:{isQuickFilterPresent:ide,getQuickFilter:rde,resetQuickFilter:sde},dependantModules:[Q7]},fde={version:lr,moduleName:"@ag-grid-community/quick-filter",dependantModules:[Q7,dde]},pde={version:lr,moduleName:"@ag-grid-community/filter",dependantModules:[hde,cde,fde,lde]},IL=(t=>(t.COLUMN_GROUP="group",t.COLUMN="column",t.FLOATING_FILTER="filter",t))(IL||{}),mde=class extends wn{constructor(){super(...arguments),this.beanName="headerNavigationService",this.currentHeaderRowWithoutSpan=-1}wireBeans(t){this.focusService=t.focusService,this.headerPositionUtils=t.headerPositionUtils,this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.visibleColService=t.visibleColsService}postConstruct(){this.ctrlsService.whenReady(e=>{this.gridBodyCon=e.gridBodyCtrl});const t=this.gos.getDocument();this.addManagedElementListeners(t,{mousedown:()=>this.setCurrentHeaderRowWithoutSpan(-1)})}getHeaderRowCount(){const t=this.ctrlsService.getHeaderRowContainerCtrl();return t?t.getRowCount():0}getHeaderPositionForColumn(t,e){let n;if(typeof t=="string"?(n=this.columnModel.getCol(t),n||(n=this.visibleColService.getColumnGroup(t))):n=t,!n)return null;const r=this.ctrlsService.getHeaderRowContainerCtrl().getAllCtrls(),o=Yr(r).getType()==="filter",c=this.getHeaderRowCount()-1;let s=-1,f=n;for(;f;)s++,f=f.getParent();let v=s;return e&&o&&v===c-1&&v++,v===-1?null:{headerRowIndex:v,column:n}}navigateVertically(t,e,n){if(e||(e=this.focusService.getFocusedHeader()),!e)return!1;const{headerRowIndex:i}=e,r=e.column,o=this.getHeaderRowCount(),c=t===0;let{headerRowIndex:s,column:f,headerRowIndexWithoutSpan:v}=c?this.headerPositionUtils.getColumnVisibleParent(r,i):this.headerPositionUtils.getColumnVisibleChild(r,i),w=!1;return s<0&&(s=0,f=r,w=!0),s>=o?(s=-1,this.setCurrentHeaderRowWithoutSpan(-1)):v!==void 0&&(this.currentHeaderRowWithoutSpan=v),!w&&!f?!1:this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:s,column:f},allowUserOverride:!0,event:n})}setCurrentHeaderRowWithoutSpan(t){this.currentHeaderRowWithoutSpan=t}navigateHorizontally(t,e=!1,n){const i=this.focusService.getFocusedHeader(),r=t===2,o=this.gos.get("enableRtl");let c,s;if(this.currentHeaderRowWithoutSpan!==-1?i.headerRowIndex=this.currentHeaderRowWithoutSpan:this.currentHeaderRowWithoutSpan=i.headerRowIndex,r!==o?(s="Before",c=this.headerPositionUtils.findHeader(i,s)):(s="After",c=this.headerPositionUtils.findHeader(i,s)),c||!e)return this.focusService.focusHeaderPosition({headerPosition:c,direction:s,fromTab:e,allowUserOverride:!0,event:n});if(e){const f=this.gos.getCallback("tabToNextHeader");if(f)return this.focusService.focusHeaderPositionFromUserFunc({userFunc:f,headerPosition:c,direction:s})}return this.focusNextHeaderRow(i,s,n)}focusNextHeaderRow(t,e,n){const i=t.headerRowIndex;let r=null,o;if(e==="Before"?i>0&&(o=i-1,this.currentHeaderRowWithoutSpan-=1,r=this.headerPositionUtils.findColAtEdgeForHeaderRow(o,"end")):(o=i+1,this.currentHeaderRowWithoutSpan<this.getHeaderRowCount()?this.currentHeaderRowWithoutSpan+=1:this.setCurrentHeaderRowWithoutSpan(-1),r=this.headerPositionUtils.findColAtEdgeForHeaderRow(o,"start")),!r)return!1;const{column:c,headerRowIndex:s}=this.headerPositionUtils.getHeaderIndexToFocus(r.column,r==null?void 0:r.headerRowIndex);return this.focusService.focusHeaderPosition({headerPosition:{column:c,headerRowIndex:s},direction:e,fromTab:!0,allowUserOverride:!0,event:n})}scrollToColumn(t,e="After"){if(t.getPinned())return;let n;if(oa(t)){const i=t.getDisplayedLeafColumns();n=e==="Before"?Yr(i):i[0]}else n=t;this.gridBodyCon.getScrollFeature().ensureColumnVisible(n)}},gde=class extends wn{wireBeans(t){this.headerNavigationService=t.headerNavigationService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService,this.filterManager=t.filterManager,this.menuService=t.menuService}setComp(t,e,n){this.comp=t,this.eGui=e,this.createManagedBean(new B_(n,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addManagedEventListeners({columnPivotModeChanged:this.onPivotModeChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this)}),this.onPivotModeChanged(),this.setupHeaderHeight();const i=this.onHeaderContextMenu.bind(this);this.addManagedElementListeners(this.eGui,{contextmenu:i}),this.mockContextMenuForIPad(i),this.ctrlsService.register("gridHeaderCtrl",this)}setupHeaderHeight(){const t=this.setHeaderHeight.bind(this);t(),this.addManagedPropertyListener("headerHeight",t),this.addManagedPropertyListener("pivotHeaderHeight",t),this.addManagedPropertyListener("groupHeaderHeight",t),this.addManagedPropertyListener("pivotGroupHeaderHeight",t),this.addManagedPropertyListener("floatingFiltersHeight",t),this.addManagedEventListeners({displayedColumnsChanged:t,columnHeaderHeightChanged:t,gridStylesChanged:t,advancedFilterEnabledChanged:t})}getHeaderHeight(){return this.headerHeight}setHeaderHeight(){var w;const{columnModel:t}=this;let e=0,n=t.getHeaderRowCount(),i;((w=this.filterManager)==null?void 0:w.hasFloatingFilters())&&(n++,e=1);const o=this.columnModel.getColumnGroupHeaderRowHeight(),c=this.columnModel.getColumnHeaderRowHeight(),s=1+e,f=n-s;if(i=e*t.getFloatingFiltersHeight(),i+=f*o,i+=c,this.headerHeight===i)return;this.headerHeight=i;const v=`${i+1}px`;this.comp.setHeightAndMinHeight(v),this.eventService.dispatchEvent({type:"headerHeightChanged"})}onPivotModeChanged(){const t=this.columnModel.isPivotMode();this.comp.addOrRemoveCssClass("ag-pivot-on",t),this.comp.addOrRemoveCssClass("ag-pivot-off",!t)}onDisplayedColumnsChanged(){const e=this.visibleColsService.getAllCols().some(n=>n.isSpanHeaderHeight());this.comp.addOrRemoveCssClass("ag-header-allow-overflow",e)}onTabKeyDown(t){const e=this.gos.get("enableRtl"),n=t.shiftKey!==e?2:3;(this.headerNavigationService.navigateHorizontally(n,!0,t)||this.focusService.focusNextGridCoreContainer(t.shiftKey))&&t.preventDefault()}handleKeyDown(t){let e=null;switch(t.key){case mn.LEFT:e=2;case mn.RIGHT:{$n(e)||(e=3),this.headerNavigationService.navigateHorizontally(e,!1,t);break}case mn.UP:e=0;case mn.DOWN:{$n(e)||(e=1),this.headerNavigationService.navigateVertically(e,null,t)&&t.preventDefault();break}default:return}}onFocusOut(t){const{relatedTarget:e}=t;!e&&this.eGui.contains(this.gos.getActiveDomElement())||this.eGui.contains(e)||this.focusService.clearFocusedHeader()}onHeaderContextMenu(t,e,n){if(!t&&!n||!this.menuService.isHeaderContextMenuEnabled())return;const{target:i}=t??e;(i===this.eGui||i===this.ctrlsService.getHeaderRowContainerCtrl().getViewport())&&this.menuService.showHeaderContextMenu(void 0,t,n)}mockContextMenuForIPad(t){if(!wv())return;const e=new Jg(this.eGui),n=i=>{t(void 0,i.touchStart,i.touchEvent)};this.addManagedListeners(e,{longTap:n}),this.addDestroyFunc(()=>e.destroy())}},N3=class extends wn{constructor(t,e=!1){super(),this.callback=t,this.addSpacer=e}wireBeans(t){this.visibleColsService=t.visibleColsService,this.scrollVisibleService=t.scrollVisibleService}postConstruct(){const t=this.setWidth.bind(this);this.addManagedPropertyListener("domLayout",t),this.addManagedEventListeners({columnContainerWidthChanged:t,displayedColumnsChanged:t,leftPinnedWidthChanged:t}),this.addSpacer&&this.addManagedEventListeners({rightPinnedWidthChanged:t,scrollVisibilityChanged:t,scrollbarWidthChanged:t}),this.setWidth()}setWidth(){const t=this.gos.isDomLayout("print"),e=this.visibleColsService.getBodyContainerWidth(),n=this.visibleColsService.getColsLeftWidth(),i=this.visibleColsService.getDisplayedColumnsRightWidth();let r;t?r=e+n+i:(r=e,this.addSpacer&&(this.gos.get("enableRtl")?n:i)===0&&this.scrollVisibleService.isVerticalScrollShowing()&&(r+=this.gos.getScrollbarWidth())),this.callback(r)}},vde=class extends wn{constructor(t){super(),this.columnsToAggregate=[],this.columnsToGroup=[],this.columnsToPivot=[],this.pinned=t}wireBeans(t){this.funcColsService=t.funcColsService}onDragEnter(t){if(this.clearColumnsList(),this.gos.get("functionsReadOnly"))return;const e=t.dragItem.columns;e&&e.forEach(n=>{n.isPrimary()&&(n.isAnyFunctionActive()||(n.isAllowValue()?this.columnsToAggregate.push(n):n.isAllowRowGroup()?this.columnsToGroup.push(n):n.isAllowPivot()&&this.columnsToPivot.push(n)))})}getIconName(){return this.columnsToAggregate.length+this.columnsToGroup.length+this.columnsToPivot.length>0?this.pinned?"pinned":"move":null}onDragLeave(t){this.clearColumnsList()}clearColumnsList(){this.columnsToAggregate.length=0,this.columnsToGroup.length=0,this.columnsToPivot.length=0}onDragging(t){}onDragStop(t){this.columnsToAggregate.length>0&&this.funcColsService.addValueColumns(this.columnsToAggregate,"toolPanelDragAndDrop"),this.columnsToGroup.length>0&&this.funcColsService.addRowGroupColumns(this.columnsToGroup,"toolPanelDragAndDrop"),this.columnsToPivot.length>0&&this.funcColsService.addPivotColumns(this.columnsToPivot,"toolPanelDragAndDrop")}};function B3(t){const{isFromHeader:e,hDirection:n,xPosition:i,fromEnter:r,fakeEvent:o,pinned:c,gos:s,columnModel:f,columnMoveService:v,presentedColsService:w}=t,C=n===0,M=n===1;let{allMovingColumns:F}=t;if(e){const ce=[];F.forEach(ae=>{var ue;let pe=null,fe=ae.getParent();for(;fe!=null&&fe.getDisplayedLeafColumns().length===1;)pe=fe,fe=fe.getParent();pe!=null?(!!((ue=pe.getColGroupDef())!=null&&ue.marryChildren)?pe.getProvidedColumnGroup().getLeafColumns():pe.getLeafColumns()).forEach(rt=>{ce.includes(rt)||ce.push(rt)}):ce.includes(ae)||ce.push(ae)}),F=ce}const N=F.slice();f.sortColsLikeCols(N);const z=wde({movingCols:N,draggingRight:M,xPosition:i,pinned:c,gos:s,columnModel:f,presentedColsService:w}),L=yde(N,f);if(z.length===0)return;const P=z[0];let H=L!==null&&!r;if(e&&(H=L!==null),H&&!o&&(C&&P>=L||M&&P<=L))return;const j=w.getAllCols(),q=[];let le=null;for(let ce=0;ce<z.length;ce++){const ae=z[ce],pe=v.getProposedColumnOrder(N,ae);if(!v.doesOrderPassRules(pe))continue;const fe=pe.filter(Ee=>j.includes(Ee));if(le===null)le=fe;else if(!k_(fe,le))break;const ue=_de(pe);q.push({move:ae,fragCount:ue})}if(q.length!==0)return q.sort((ce,ae)=>ce.fragCount-ae.fragCount),eq(F,q[0].move,"uiColumnMoved",!1,v)}function eq(t,e,n,i,r){return r.moveColumns(t,e,n,i),i?null:{columns:t,toIndex:e}}function yde(t,e){const n=e.getCols(),i=sce(t.map(f=>n.indexOf(f))),r=i[0];return Yr(i)-r!==i.length-1?null:r}function _de(t){function e(i){const r=[];let o=i.getOriginalParent();for(;o!=null;)r.push(o),o=o.getOriginalParent();return r}let n=0;for(let i=0;i<t.length-1;i++){let r=e(t[i]),o=e(t[i+1]);[r,o]=r.length>o.length?[r,o]:[o,r],r.forEach(c=>{o.indexOf(c)===-1&&n++})}return n}function xde(t,e){switch(e){case"left":return t.getLeftCols();case"right":return t.getRightCols();default:return t.getCenterCols()}}function wde(t){const{movingCols:e,draggingRight:n,xPosition:i,pinned:r,gos:o,columnModel:c,presentedColsService:s}=t;if(o.get("suppressMovableColumns")||e.some(j=>j.getColDef().suppressMovable))return[];const v=xde(s,r),w=c.getCols(),C=v.filter(j=>t_(e,j)),M=v.filter(j=>!t_(e,j)),F=w.filter(j=>!t_(e,j));let N=0,z=i;if(n){let j=0;C.forEach(q=>j+=q.getActualWidth()),z-=j}if(z>0){for(let j=0;j<M.length;j++){const q=M[j];if(z-=q.getActualWidth(),z<0)break;N++}n&&N++}let L;if(N>0){const j=M[N-1];L=F.indexOf(j)+1}else L=F.indexOf(M[0]),L===-1&&(L=0);const P=[L],H=(j,q)=>j-q;if(n){let j=L+1;const q=w.length-1;for(;j<=q;)P.push(j),j++;P.sort(H)}else{let j=L;const q=w.length-1;let le=w[j];for(;j<=q&&v.indexOf(le)<0;)j++,P.push(j),le=w[j];j=L-1;const ce=0;for(;j>=ce;)P.push(j),j--;P.sort(H).reverse()}return P}function z3(t,e,n,i,r){const o=r.getHeaderRowContainerCtrl(e).getViewport();return n&&(t-=o.getBoundingClientRect().left),i.get("enableRtl")&&(t=o.clientWidth-t),e==null&&(t+=r.get("center").getCenterViewportScrollLeft()),t}var Cde=class extends wn{constructor(t){super(),this.needToMoveLeft=!1,this.needToMoveRight=!1,this.lastMovedInfo=null,this.pinned=t,this.isCenterContainer=!$n(t)}wireBeans(t){this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnMoveService=t.columnMoveService,this.dragAndDropService=t.dragAndDropService,this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(t=>{this.gridBodyCon=t.gridBodyCtrl})}getIconName(){return this.pinned?"pinned":"move"}onDragEnter(t){const e=t.dragItem.columns;if(t.dragSource.type===0)this.setColumnsVisible(e,!0,"uiColumnDragged");else{const i=t.dragItem.visibleState,r=(e||[]).filter(o=>i[o.getId()]);this.setColumnsVisible(r,!0,"uiColumnDragged")}this.setColumnsPinned(e,this.pinned,"uiColumnDragged"),this.onDragging(t,!0,!0)}onDragLeave(){this.ensureIntervalCleared(),this.lastMovedInfo=null}setColumnsVisible(t,e,n){if(t){const i=t.filter(r=>!r.getColDef().lockVisible);this.columnModel.setColsVisible(i,e,n)}}setColumnsPinned(t,e,n){if(t){const i=t.filter(r=>!r.getColDef().lockPinned);this.columnModel.setColsPinned(i,e,n)}}onDragStop(){this.onDragging(this.lastDraggingEvent,!1,!0,!0),this.ensureIntervalCleared(),this.lastMovedInfo=null}checkCenterForScrolling(t){if(this.isCenterContainer){const e=this.ctrlsService.get("center"),n=e.getCenterViewportScrollLeft(),i=n+e.getCenterWidth();this.gos.get("enableRtl")?(this.needToMoveRight=t<n+50,this.needToMoveLeft=t>i-50):(this.needToMoveLeft=t<n+50,this.needToMoveRight=t>i-50),this.needToMoveLeft||this.needToMoveRight?this.ensureIntervalStarted():this.ensureIntervalCleared()}}onDragging(t=this.lastDraggingEvent,e=!1,n=!1,i=!1){var v;if(i){if(this.lastMovedInfo){const{columns:w,toIndex:C}=this.lastMovedInfo;eq(w,C,"uiColumnMoved",!0,this.columnMoveService)}return}if(this.lastDraggingEvent=t,Hr(t.hDirection))return;const r=z3(t.x,this.pinned,!1,this.gos,this.ctrlsService);e||this.checkCenterForScrolling(r);const o=this.normaliseDirection(t.hDirection),c=t.dragSource.type,s=((v=t.dragSource.getDragItem().columns)==null?void 0:v.filter(w=>w.getColDef().lockPinned?w.getPinned()==this.pinned:!0))||[],f=B3({allMovingColumns:s,isFromHeader:c===1,hDirection:o,xPosition:r,pinned:this.pinned,fromEnter:e,fakeEvent:n,gos:this.gos,columnModel:this.columnModel,columnMoveService:this.columnMoveService,presentedColsService:this.visibleColsService});f&&(this.lastMovedInfo=f)}normaliseDirection(t){if(this.gos.get("enableRtl"))switch(t){case 0:return 1;case 1:return 0;default:_s(`Unknown direction ${t}`)}else return t}ensureIntervalStarted(){this.movingIntervalId||(this.intervalCount=0,this.failedMoveAttempts=0,this.movingIntervalId=window.setInterval(this.moveInterval.bind(this),100),this.dragAndDropService.setGhostIcon(this.needToMoveLeft?"left":"right",!0))}ensureIntervalCleared(){this.movingIntervalId&&(window.clearInterval(this.movingIntervalId),this.movingIntervalId=null,this.dragAndDropService.setGhostIcon("move"))}moveInterval(){let t;this.intervalCount++,t=10+this.intervalCount*5,t>100&&(t=100);let e=null;const n=this.gridBodyCon.getScrollFeature();if(this.needToMoveLeft?e=n.scrollHorizontally(-t):this.needToMoveRight&&(e=n.scrollHorizontally(t)),e!==0)this.onDragging(this.lastDraggingEvent),this.failedMoveAttempts=0;else{this.failedMoveAttempts++;const r=this.lastDraggingEvent.dragItem.columns.filter(o=>!o.getColDef().lockPinned);if(r.length>0&&(this.dragAndDropService.setGhostIcon("pinned"),this.failedMoveAttempts>7)){const o=this.needToMoveLeft?"left":"right";this.setColumnsPinned(r,o,"uiColumnDragged"),this.dragAndDropService.nudge()}}}},Sde=class extends wn{wireBeans(t){this.dragAndDropService=t.dragAndDropService,this.columnModel=t.columnModel,this.ctrlsService=t.ctrlsService}constructor(t,e){super(),this.pinned=t,this.eContainer=e}postConstruct(){this.ctrlsService.whenReady(t=>{switch(this.pinned){case"left":this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.left.getContainerElement()],[t.bottomLeft.getContainerElement()],[t.topLeft.getContainerElement()]];break;case"right":this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.right.getContainerElement()],[t.bottomRight.getContainerElement()],[t.topRight.getContainerElement()]];break;default:this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.center.getViewportElement()],[t.bottomCenter.getViewportElement()],[t.topCenter.getViewportElement()]];break}}),this.moveColumnFeature=this.createManagedBean(new Cde(this.pinned)),this.bodyDropPivotTarget=this.createManagedBean(new vde(this.pinned)),this.dragAndDropService.addDropTarget(this)}isInterestedIn(t){return t===1||t===0&&this.gos.get("allowDragFromColumnsToolPanel")}getSecondaryContainers(){return this.eSecondaryContainers}getContainer(){return this.eContainer}getIconName(){return this.currentDropListener.getIconName()}isDropColumnInPivotMode(t){return this.columnModel.isPivotMode()&&t.dragSource.type===0}onDragEnter(t){this.currentDropListener=this.isDropColumnInPivotMode(t)?this.bodyDropPivotTarget:this.moveColumnFeature,this.currentDropListener.onDragEnter(t)}onDragLeave(t){this.currentDropListener.onDragLeave(t)}onDragging(t){this.currentDropListener.onDragging(t)}onDragStop(t){this.currentDropListener.onDragStop(t)}},bde=class extends wn{wireBeans(t){this.horizontalResizeService=t.horizontalResizeService,this.pinnedWidthService=t.pinnedWidthService,this.ctrlsService=t.ctrlsService,this.columnSizeService=t.columnSizeService,this.columnAutosizeService=t.columnAutosizeService}constructor(t,e,n,i,r){super(),this.pinned=t,this.column=e,this.eResize=n,this.comp=i,this.ctrl=r}postConstruct(){const t=[];let e,n;const i=()=>{if(Do(this.eResize,e),!e)return;const c=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(t.push(c),n){const s=this.gos.get("skipHeaderOnAutoSize"),f=()=>{this.columnAutosizeService.autoSizeColumn(this.column,"uiColumnResized",s)};this.eResize.addEventListener("dblclick",f);const v=new Jg(this.eResize);v.addEventListener("doubleTap",f),t.push(()=>{this.eResize.removeEventListener("dblclick",f),v.removeEventListener("doubleTap",f),v.destroy()})}},r=()=>{t.forEach(c=>c()),t.length=0},o=()=>{const c=this.column.isResizable(),s=!this.gos.get("suppressAutoSize")&&!this.column.getColDef().suppressAutoSize;(c!==e||s!==n)&&(e=c,n=s,r(),i())};o(),this.addDestroyFunc(r),this.ctrl.addRefreshFunction(o)}onResizing(t,e){const{column:n,lastResizeAmount:i,resizeStartWidth:r}=this,o=this.normaliseResizeAmount(e),c=r+o,s=[{key:n,newWidth:c}];if(this.column.getPinned()){const f=this.pinnedWidthService.getPinnedLeftWidth(),v=this.pinnedWidthService.getPinnedRightWidth(),w=VS(this.ctrlsService.getGridBodyCtrl().getBodyViewportElement())-50;if(f+v+(o-i)>w)return}this.lastResizeAmount=o,this.columnSizeService.setColumnWidths(s,this.resizeWithShiftKey,t,"uiColumnResized"),t&&this.toggleColumnResizing(!1)}onResizeStart(t){this.resizeStartWidth=this.column.getActualWidth(),this.lastResizeAmount=0,this.resizeWithShiftKey=t,this.toggleColumnResizing(!0)}toggleColumnResizing(t){this.comp.addOrRemoveCssClass("ag-column-resizing",t)}normaliseResizeAmount(t){let e=t;const n=this.pinned!=="left",i=this.pinned==="right";return this.gos.get("enableRtl")?n&&(e*=-1):i&&(e*=-1),e}},Ede=class extends wn{constructor(t){super(),this.cbSelectAllVisible=!1,this.processingEventFromCheckbox=!1,this.column=t}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}onSpaceKeyDown(t){const e=this.cbSelectAll;e.isDisplayed()&&!e.getGui().contains(this.gos.getActiveDomElement())&&(t.preventDefault(),e.setValue(!e.getValue()))}getCheckboxGui(){return this.cbSelectAll.getGui()}setComp(t){this.headerCellCtrl=t,this.cbSelectAll=this.createManagedBean(new M3),this.cbSelectAll.addCssClass("ag-header-select-all"),ld(this.cbSelectAll.getGui(),"presentation"),this.showOrHideSelectAll(),this.addManagedEventListeners({newColumnsLoaded:this.onNewColumnsLoaded.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),selectionChanged:this.onSelectionChanged.bind(this),paginationChanged:this.onSelectionChanged.bind(this),modelUpdated:this.onModelChanged.bind(this)}),this.addManagedListeners(this.cbSelectAll,{fieldValueChanged:this.onCbSelectAll.bind(this)}),y3(this.cbSelectAll.getGui(),!0),this.cbSelectAll.getInputElement().setAttribute("tabindex","-1"),this.refreshSelectAllLabel()}onNewColumnsLoaded(){this.showOrHideSelectAll()}onDisplayedColumnsChanged(){this.isAlive()&&this.showOrHideSelectAll()}showOrHideSelectAll(){this.cbSelectAllVisible=this.isCheckboxSelection(),this.cbSelectAll.setDisplayed(this.cbSelectAllVisible,{skipAriaHidden:!0}),this.cbSelectAllVisible&&(this.checkRightRowModelType("selectAllCheckbox"),this.checkSelectionType("selectAllCheckbox"),this.updateStateOfCheckbox()),this.refreshSelectAllLabel()}onModelChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}onSelectionChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}updateStateOfCheckbox(){if(this.processingEventFromCheckbox)return;this.processingEventFromCheckbox=!0;const t=this.selectionService.getSelectAllState(this.isFilteredOnly(),this.isCurrentPageOnly());this.cbSelectAll.setValue(t);const e=this.selectionService.hasNodesToSelect(this.isFilteredOnly(),this.isCurrentPageOnly());this.cbSelectAll.setDisabled(!e),this.refreshSelectAllLabel(),this.processingEventFromCheckbox=!1}refreshSelectAllLabel(){const t=this.localeService.getLocaleTextFunc(),n=this.cbSelectAll.getValue()?t("ariaChecked","checked"):t("ariaUnchecked","unchecked"),i=t("ariaRowSelectAll","Press Space to toggle all rows selection");this.cbSelectAllVisible?this.headerCellCtrl.setAriaDescriptionProperty("selectAll",`${i} (${n})`):this.headerCellCtrl.setAriaDescriptionProperty("selectAll",null),this.cbSelectAll.setInputAriaLabel(`${i} (${n})`),this.headerCellCtrl.announceAriaDescription()}checkSelectionType(t){return this.gos.get("rowSelection")==="multiple"?!0:(Tn(`${t} is only available if using 'multiple' rowSelection.`),!1)}checkRightRowModelType(t){const e=this.rowModel.getType();return e==="clientSide"||e==="serverSide"?!0:(Tn(`${t} is only available if using 'clientSide' or 'serverSide' rowModelType, you are using ${e}.`),!1)}onCbSelectAll(){if(this.processingEventFromCheckbox||!this.cbSelectAllVisible)return;const t=this.cbSelectAll.getValue(),e=this.isFilteredOnly(),n=this.isCurrentPageOnly();let i="uiSelectAll";n?i="uiSelectAllCurrentPage":e&&(i="uiSelectAllFiltered");const r={source:i,justFiltered:e,justCurrentPage:n};t?this.selectionService.selectAllRowNodes(r):this.selectionService.deselectAllRowNodes(r)}isCheckboxSelection(){let t=this.column.getColDef().headerCheckboxSelection;if(typeof t=="function"){const e=t,n=this.gos.addGridCommonParams({column:this.column,colDef:this.column.getColDef()});t=e(n)}return t?this.checkRightRowModelType("headerCheckboxSelection")&&this.checkSelectionType("headerCheckboxSelection"):!1}isFilteredOnly(){return!!this.column.getColDef().headerCheckboxSelectionFilteredOnly}isCurrentPageOnly(){return!!this.column.getColDef().headerCheckboxSelectionCurrentPageOnly}},Mde=class extends FA{constructor(t,e,n){super(t,e,n),this.refreshFunctions=[],this.userHeaderClasses=new Set,this.ariaDescriptionProperties=new Map,this.column=t}setComp(t,e,n,i){this.comp=t,this.setGui(e),this.updateState(),this.setupWidth(),this.setupMovingCss(),this.setupMenuClass(),this.setupSortableClass(),this.setupWrapTextClass(),this.refreshSpanHeaderHeight(),this.setupAutoHeight(i),this.addColumnHoverListener(),this.setupFilterClass(),this.setupClassesFromColDef(),this.setupTooltip(),this.addActiveHeaderMouseListeners(),this.setupSelectAll(),this.setupUserComp(),this.refreshAria(),this.resizeFeature=this.createManagedBean(new bde(this.getPinned(),this.column,n,t,this)),this.createManagedBean(new L3([this.column],e)),this.createManagedBean(new F3(this.column,e,this.beans)),this.createManagedBean(new B_(e,{shouldStopEventPropagation:r=>this.shouldStopEventPropagation(r),onTabKeyDown:()=>null,handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addResizeAndMoveKeyboardListeners(),this.addManagedPropertyListeners(["suppressMovableColumns","suppressMenuHide","suppressAggFuncInHeader"],this.refresh.bind(this)),this.addManagedListeners(this.column,{colDefChanged:this.refresh.bind(this)}),this.addManagedEventListeners({columnValueChanged:this.onColumnValueChanged.bind(this),columnRowGroupChanged:this.onColumnRowGroupChanged.bind(this),columnPivotChanged:this.onColumnPivotChanged.bind(this),headerHeightChanged:this.onHeaderHeightChanged.bind(this)})}resizeHeader(t,e){if(!this.column.isResizable())return;const n=this.column.getActualWidth(),i=this.column.getMinWidth(),r=this.column.getMaxWidth(),o=Math.min(Math.max(n+t,i),r);this.beans.columnSizeService.setColumnWidths([{key:this.column,newWidth:o}],e,!0,"uiColumnResized")}moveHeader(t){const{eGui:e,column:n,gos:i,ctrlsService:r}=this,o=this.getPinned(),c=e.getBoundingClientRect().left,s=n.getActualWidth(),f=i.get("enableRtl"),w=z3(t===0!==f?c-20:c+s+20,o,!0,i,r);B3({allMovingColumns:[n],isFromHeader:!0,hDirection:t,xPosition:w,pinned:o,fromEnter:!1,fakeEvent:!1,gos:i,columnModel:this.beans.columnModel,columnMoveService:this.beans.columnMoveService,presentedColsService:this.beans.visibleColsService}),r.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(n,"auto")}setupUserComp(){const t=this.lookupUserCompDetails();this.setCompDetails(t)}setCompDetails(t){this.userCompDetails=t,this.comp.setUserCompDetails(t)}lookupUserCompDetails(){const t=this.createParams(),e=this.column.getColDef();return this.userComponentFactory.getHeaderCompDetails(e,t)}createParams(){return this.gos.addGridCommonParams({column:this.column,displayName:this.displayName,enableSorting:this.column.isSortable(),enableMenu:this.menuEnabled,enableFilterButton:this.openFilterEnabled&&this.menuService.isHeaderFilterButtonEnabled(this.column),enableFilterIcon:!this.openFilterEnabled||this.menuService.isLegacyMenuEnabled(),showColumnMenu:e=>{this.menuService.showColumnMenu({column:this.column,buttonElement:e,positionBy:"button"})},showColumnMenuAfterMouseClick:e=>{this.menuService.showColumnMenu({column:this.column,mouseEvent:e,positionBy:"mouse"})},showFilter:e=>{this.menuService.showFilterMenu({column:this.column,buttonElement:e,containerType:"columnFilter",positionBy:"button"})},progressSort:e=>{this.beans.sortController.progressSort(this.column,!!e,"uiColumnSorted")},setSort:(e,n)=>{this.beans.sortController.setSortForColumn(this.column,e,!!n,"uiColumnSorted")},eGridHeader:this.getGui(),setTooltip:(e,n)=>{this.setupTooltip(e,n)}})}setupSelectAll(){this.selectAllFeature=this.createManagedBean(new Ede(this.column)),this.selectAllFeature.setComp(this)}getSelectAllGui(){return this.selectAllFeature.getCheckboxGui()}handleKeyDown(t){super.handleKeyDown(t),t.key===mn.SPACE&&this.selectAllFeature.onSpaceKeyDown(t),t.key===mn.ENTER&&this.onEnterKeyDown(t),t.key===mn.DOWN&&t.altKey&&this.showMenuOnKeyPress(t,!1)}onEnterKeyDown(t){if(t.ctrlKey||t.metaKey)this.showMenuOnKeyPress(t,!0);else if(this.sortable){const e=t.shiftKey;this.beans.sortController.progressSort(this.column,e,"uiColumnSorted")}}showMenuOnKeyPress(t,e){const n=this.comp.getUserCompInstance();!n||!(n instanceof RL)||n.onMenuKeyboardShortcut(e)&&t.preventDefault()}onFocusIn(t){if(!this.getGui().contains(t.relatedTarget)){const e=this.getRowIndex();this.focusService.setFocusedHeader(e,this.column),this.announceAriaDescription()}this.focusService.isKeyboardMode()&&this.setActiveHeader(!0)}onFocusOut(t){this.getGui().contains(t.relatedTarget)||this.setActiveHeader(!1)}setupTooltip(t,e){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature));const n=this.gos.get("tooltipShowMode")==="whenTruncated",i=this.eGui,r=this.column.getColDef();!e&&n&&!r.headerComponent&&(e=()=>{const s=i.querySelector(".ag-header-cell-text");return s?s.scrollWidth>s.clientWidth:!0});const o={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getGui:()=>i,getLocation:()=>"header",getTooltipValue:()=>t??this.column.getColDef().headerTooltip,shouldDisplayTooltip:e},c=this.createManagedBean(new Sw(o));this.refreshFunctions.push(()=>c.refreshToolTip())}setupClassesFromColDef(){const t=()=>{const e=this.column.getColDef(),n=j7(e,this.gos,this.column,null),i=this.userHeaderClasses;this.userHeaderClasses=new Set(n),n.forEach(r=>{i.has(r)?i.delete(r):this.comp.addOrRemoveCssClass(r,!0)}),i.forEach(r=>this.comp.addOrRemoveCssClass(r,!1))};this.refreshFunctions.push(t),t()}setDragSource(t){if(this.dragSourceElement=t,this.removeDragSource(),!t||!this.draggable)return;const{column:e,beans:n,displayName:i,dragAndDropService:r,gos:o}=this,{columnModel:c}=n;let s=!this.gos.get("suppressDragLeaveHidesColumns");const f=this.dragSource={type:1,eElement:t,getDefaultIconName:()=>s?"hide":"notAllowed",getDragItem:()=>this.createDragItem(e),dragItemName:i,onDragStarted:()=>{s=!o.get("suppressDragLeaveHidesColumns"),e.setMoving(!0,"uiColumnMoved")},onDragStopped:()=>e.setMoving(!1,"uiColumnMoved"),onGridEnter:v=>{var w;if(s){const C=((w=v==null?void 0:v.columns)==null?void 0:w.filter(M=>!M.getColDef().lockVisible))||[];c.setColsVisible(C,!0,"uiColumnMoved")}},onGridExit:v=>{var w;if(s){const C=((w=v==null?void 0:v.columns)==null?void 0:w.filter(M=>!M.getColDef().lockVisible))||[];c.setColsVisible(C,!1,"uiColumnMoved")}}};r.addDragSource(f,!0)}createDragItem(t){const e={};return e[t.getId()]=t.isVisible(),{columns:[t],visibleState:e}}updateState(){this.menuEnabled=this.menuService.isColumnMenuInHeaderEnabled(this.column),this.openFilterEnabled=this.menuService.isFilterMenuInHeaderEnabled(this.column),this.sortable=this.column.isSortable(),this.displayName=this.calculateDisplayName(),this.draggable=this.workOutDraggable()}addRefreshFunction(t){this.refreshFunctions.push(t)}refresh(){this.updateState(),this.refreshHeaderComp(),this.refreshAria(),this.refreshFunctions.forEach(t=>t())}refreshHeaderComp(){const t=this.lookupUserCompDetails();(this.comp.getUserCompInstance()!=null&&this.userCompDetails.componentClass==t.componentClass?this.attemptHeaderCompRefresh(t.params):!1)?this.setDragSource(this.dragSourceElement):this.setCompDetails(t)}attemptHeaderCompRefresh(t){const e=this.comp.getUserCompInstance();return!e||!e.refresh?!1:e.refresh(t)}calculateDisplayName(){return this.beans.columnNameService.getDisplayNameForColumn(this.column,"header",!0)}checkDisplayName(){this.displayName!==this.calculateDisplayName()&&this.refresh()}workOutDraggable(){const t=this.column.getColDef();return!!(!this.gos.get("suppressMovableColumns")&&!t.suppressMovable&&!t.lockPosition)||!!t.enableRowGroup||!!t.enablePivot}onColumnRowGroupChanged(){this.checkDisplayName()}onColumnPivotChanged(){this.checkDisplayName()}onColumnValueChanged(){this.checkDisplayName()}setupWidth(){const t=()=>{const e=this.column.getActualWidth();this.comp.setWidth(`${e}px`)};this.addManagedListeners(this.column,{widthChanged:t}),t()}setupMovingCss(){const t=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.column.isMoving())};this.addManagedListeners(this.column,{movingChanged:t}),t()}setupMenuClass(){const t=()=>{this.comp.addOrRemoveCssClass("ag-column-menu-visible",this.column.isMenuVisible())};this.addManagedListeners(this.column,{menuVisibleChanged:t}),t()}setupSortableClass(){const t=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-sortable",!!this.sortable)};t(),this.addRefreshFunction(t),this.addManagedEventListeners({sortChanged:this.refreshAriaSort.bind(this)})}setupFilterClass(){const t=()=>{const e=this.column.isFilterActive();this.comp.addOrRemoveCssClass("ag-header-cell-filtered",e),this.refreshAria()};this.addManagedListeners(this.column,{filterActiveChanged:t}),t()}setupWrapTextClass(){const t=()=>{const e=!!this.column.getColDef().wrapHeaderText;this.comp.addOrRemoveCssClass("ag-header-cell-wrap-text",e)};t(),this.addRefreshFunction(t)}onDisplayedColumnsChanged(){super.onDisplayedColumnsChanged(),this.isAlive()&&this.onHeaderHeightChanged()}onHeaderHeightChanged(){this.refreshSpanHeaderHeight()}refreshSpanHeaderHeight(){const{eGui:t,column:e,comp:n,beans:i}=this;if(!e.isSpanHeaderHeight()){t.style.removeProperty("top"),t.style.removeProperty("height"),n.addOrRemoveCssClass("ag-header-span-height",!1),n.addOrRemoveCssClass("ag-header-span-total",!1);return}const{numberOfParents:r,isSpanningTotal:o}=this.column.getColumnGroupPaddingInfo();n.addOrRemoveCssClass("ag-header-span-height",r>0);const{columnModel:c}=i,s=c.getColumnHeaderRowHeight();if(r===0){n.addOrRemoveCssClass("ag-header-span-total",!1),t.style.setProperty("top","0px"),t.style.setProperty("height",`${s}px`);return}n.addOrRemoveCssClass("ag-header-span-total",o);const v=c.isPivotMode()?c.getPivotGroupHeaderHeight():c.getGroupHeaderHeight(),w=r*v;t.style.setProperty("top",`${-w}px`),t.style.setProperty("height",`${s+w}px`)}setupAutoHeight(t){const{columnModel:e,resizeObserverService:n}=this.beans,i=v=>{if(!this.isAlive())return;const{paddingTop:w,paddingBottom:C,borderBottomWidth:M,borderTopWidth:F}=N_(this.getGui()),N=w+C+M+F,L=t.offsetHeight+N;if(v<5){const P=this.beans.gos.getDocument(),H=!P||!P.contains(t),j=L==0;if(H||j){window.setTimeout(()=>i(v+1),0);return}}e.setColHeaderHeight(this.column,L)};let r=!1,o;const c=()=>{const v=this.column.isAutoHeaderHeight();v&&!r&&s(),!v&&r&&f()},s=()=>{r=!0,i(0),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!0),o=n.observeResize(t,()=>i(0))},f=()=>{r=!1,o&&o(),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!1),o=void 0};c(),this.addDestroyFunc(()=>f()),this.addManagedListeners(this.column,{widthChanged:()=>r&&i(0)}),this.addManagedEventListeners({sortChanged:()=>{r&&window.setTimeout(()=>i(0))}}),this.addRefreshFunction(c)}refreshAriaSort(){if(this.sortable){const t=this.localeService.getLocaleTextFunc(),e=this.beans.sortController.getDisplaySortForColumn(this.column)||null;this.comp.setAriaSort(Hce(e)),this.setAriaDescriptionProperty("sort",t("ariaSortableColumn","Press ENTER to sort"))}else this.comp.setAriaSort(),this.setAriaDescriptionProperty("sort",null)}refreshAriaMenu(){if(this.menuEnabled){const t=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("menu",t("ariaMenuColumn","Press ALT DOWN to open column menu"))}else this.setAriaDescriptionProperty("menu",null)}refreshAriaFilterButton(){if(this.openFilterEnabled&&!this.menuService.isLegacyMenuEnabled()){const t=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("filterButton",t("ariaFilterColumn","Press CTRL ENTER to open filter"))}else this.setAriaDescriptionProperty("filterButton",null)}refreshAriaFiltered(){const t=this.localeService.getLocaleTextFunc();this.column.isFilterActive()?this.setAriaDescriptionProperty("filter",t("ariaColumnFiltered","Column Filtered")):this.setAriaDescriptionProperty("filter",null)}setAriaDescriptionProperty(t,e){e!=null?this.ariaDescriptionProperties.set(t,e):this.ariaDescriptionProperties.delete(t)}announceAriaDescription(){if(!this.eGui.contains(this.beans.gos.getActiveDomElement()))return;const t=Array.from(this.ariaDescriptionProperties.keys()).sort((e,n)=>e==="filter"?-1:n.charCodeAt(0)-e.charCodeAt(0)).map(e=>this.ariaDescriptionProperties.get(e)).join(". ");this.beans.ariaAnnouncementService.announceValue(t)}refreshAria(){this.refreshAriaSort(),this.refreshAriaMenu(),this.refreshAriaFilterButton(),this.refreshAriaFiltered()}addColumnHoverListener(){const t=()=>{if(!this.gos.get("columnHoverHighlight"))return;const e=this.beans.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",e)};this.addManagedEventListeners({columnHoverChanged:t}),t()}getColId(){return this.column.getColId()}addActiveHeaderMouseListeners(){const t=i=>this.handleMouseOverChange(i.type==="mouseenter"),e=()=>this.dispatchColumnMouseEvent("columnHeaderClicked",this.column),n=i=>this.handleContextMenuMouseEvent(i,void 0,this.column);this.addManagedListeners(this.getGui(),{mouseenter:t,mouseleave:t,click:e,contextmenu:n})}handleMouseOverChange(t){this.setActiveHeader(t);const n={type:t?"columnHeaderMouseOver":"columnHeaderMouseLeave",column:this.column};this.eventService.dispatchEvent(n)}setActiveHeader(t){this.comp.addOrRemoveCssClass("ag-header-active",t)}getAnchorElementForMenu(t){const e=this.comp.getUserCompInstance();return e instanceof RL?e.getAnchorElementForMenu(t):this.getGui()}destroy(){super.destroy(),this.refreshFunctions=null,this.selectAllFeature=null,this.dragSourceElement=null,this.userCompDetails=null,this.userHeaderClasses=null,this.ariaDescriptionProperties=null}},Rde=class extends wn{wireBeans(t){this.horizontalResizeService=t.horizontalResizeService,this.autoWidthCalculator=t.autoWidthCalculator,this.visibleColsService=t.visibleColsService,this.columnSizeService=t.columnSizeService,this.columnAutosizeService=t.columnAutosizeService}constructor(t,e,n,i){super(),this.eResize=e,this.comp=t,this.pinned=n,this.columnGroup=i}postConstruct(){if(!this.columnGroup.isResizable()){this.comp.setResizableDisplayed(!1);return}const t=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(this.addDestroyFunc(t),!this.gos.get("suppressAutoSize")){const e=this.gos.get("skipHeaderOnAutoSize");this.eResize.addEventListener("dblclick",()=>{const n=[];this.columnGroup.getDisplayedLeafColumns().forEach(r=>{r.getColDef().suppressAutoSize||n.push(r.getColId())}),n.length>0&&this.columnAutosizeService.autoSizeCols({colKeys:n,skipHeader:e,stopAtGroup:this.columnGroup,source:"uiColumnResized"}),this.resizeLeafColumnsToFit("uiColumnResized")})}}onResizeStart(t){const e=this.getInitialValues(t);this.storeLocalValues(e),this.toggleColumnResizing(!0)}onResizing(t,e,n="uiColumnResized"){const i=this.normaliseDragChange(e),r=this.resizeStartWidth+i;this.resizeColumnsFromLocalValues(r,n,t)}getInitialValues(t){const e=this.getColumnsToResize(),n=this.getInitialSizeOfColumns(e),i=this.getSizeRatiosOfColumns(e,n),r={columnsToResize:e,resizeStartWidth:n,resizeRatios:i};let o=null;if(t&&(o=this.visibleColsService.getGroupAtDirection(this.columnGroup,"After")),o){const c=o.getDisplayedLeafColumns(),s=r.groupAfterColumns=c.filter(v=>v.isResizable()),f=r.groupAfterStartWidth=this.getInitialSizeOfColumns(s);r.groupAfterRatios=this.getSizeRatiosOfColumns(s,f)}else r.groupAfterColumns=void 0,r.groupAfterStartWidth=void 0,r.groupAfterRatios=void 0;return r}storeLocalValues(t){const{columnsToResize:e,resizeStartWidth:n,resizeRatios:i,groupAfterColumns:r,groupAfterStartWidth:o,groupAfterRatios:c}=t;this.resizeCols=e,this.resizeStartWidth=n,this.resizeRatios=i,this.resizeTakeFromCols=r,this.resizeTakeFromStartWidth=o,this.resizeTakeFromRatios=c}clearLocalValues(){this.resizeCols=void 0,this.resizeRatios=void 0,this.resizeTakeFromCols=void 0,this.resizeTakeFromRatios=void 0}resizeLeafColumnsToFit(t){const e=this.autoWidthCalculator.getPreferredWidthForColumnGroup(this.columnGroup),n=this.getInitialValues();e>n.resizeStartWidth&&this.resizeColumns(n,e,t,!0)}resizeColumnsFromLocalValues(t,e,n=!0){if(!this.resizeCols||!this.resizeRatios)return;const i={columnsToResize:this.resizeCols,resizeStartWidth:this.resizeStartWidth,resizeRatios:this.resizeRatios,groupAfterColumns:this.resizeTakeFromCols??void 0,groupAfterStartWidth:this.resizeTakeFromStartWidth??void 0,groupAfterRatios:this.resizeTakeFromRatios??void 0};this.resizeColumns(i,t,e,n)}resizeColumns(t,e,n,i=!0){const{columnsToResize:r,resizeStartWidth:o,resizeRatios:c,groupAfterColumns:s,groupAfterStartWidth:f,groupAfterRatios:v}=t,w=[];if(w.push({columns:r,ratios:c,width:e}),s){const C=e-o;w.push({columns:s,ratios:v,width:f-C})}this.columnSizeService.resizeColumnSets({resizeSets:w,finished:i,source:n}),i&&this.toggleColumnResizing(!1)}toggleColumnResizing(t){this.comp.addOrRemoveCssClass("ag-column-resizing",t)}getColumnsToResize(){return this.columnGroup.getDisplayedLeafColumns().filter(e=>e.isResizable())}getInitialSizeOfColumns(t){return t.reduce((e,n)=>e+n.getActualWidth(),0)}getSizeRatiosOfColumns(t,e){return t.map(n=>n.getActualWidth()/e)}normaliseDragChange(t){let e=t;return this.gos.get("enableRtl")?this.pinned!=="left"&&(e*=-1):this.pinned==="right"&&(e*=-1),e}destroy(){super.destroy(),this.clearLocalValues()}},Tde=class extends wn{constructor(t,e){super(),this.removeChildListenersFuncs=[],this.columnGroup=e,this.comp=t}postConstruct(){this.addListenersToChildrenColumns(),this.addManagedListeners(this.columnGroup,{displayedChildrenChanged:this.onDisplayedChildrenChanged.bind(this)}),this.onWidthChanged(),this.addDestroyFunc(this.removeListenersOnChildrenColumns.bind(this))}addListenersToChildrenColumns(){this.removeListenersOnChildrenColumns();const t=this.onWidthChanged.bind(this);this.columnGroup.getLeafColumns().forEach(e=>{e.addEventListener("widthChanged",t),e.addEventListener("visibleChanged",t),this.removeChildListenersFuncs.push(()=>{e.removeEventListener("widthChanged",t),e.removeEventListener("visibleChanged",t)})})}removeListenersOnChildrenColumns(){this.removeChildListenersFuncs.forEach(t=>t()),this.removeChildListenersFuncs=[]}onDisplayedChildrenChanged(){this.addListenersToChildrenColumns(),this.onWidthChanged()}onWidthChanged(){const t=this.columnGroup.getActualWidth();this.comp.setWidth(`${t}px`),this.comp.addOrRemoveCssClass("ag-hidden",t===0)}},Ade=class extends FA{constructor(t,e,n){super(t,e,n),this.onSuppressColMoveChange=()=>{if(!this.isAlive()||this.isSuppressMoving())this.removeDragSource();else if(!this.dragSource){const i=this.getGui();this.setDragSource(i)}},this.column=t}setComp(t,e,n){this.comp=t,this.setGui(e),this.displayName=this.beans.columnNameService.getDisplayNameForColumnGroup(this.column,"header"),this.addClasses(),this.setupMovingCss(),this.setupExpandable(),this.setupTooltip(),this.addDestroyFunc(()=>{this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature))}),this.setupUserComp(),this.addHeaderMouseListeners();const i=this.getParentRowCtrl().getPinned(),r=this.column.getProvidedColumnGroup().getLeafColumns();this.createManagedBean(new L3(r,e)),this.createManagedBean(new F3(this.column,e,this.beans)),this.createManagedBean(new Tde(t,this.column)),this.resizeFeature=this.createManagedBean(new Rde(t,n,i,this.column)),this.createManagedBean(new B_(e,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:()=>{},handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)})),this.addManagedPropertyListener("suppressMovableColumns",this.onSuppressColMoveChange),this.addResizeAndMoveKeyboardListeners()}resizeHeader(t,e){if(!this.resizeFeature)return;const n=this.resizeFeature.getInitialValues(e);this.resizeFeature.resizeColumns(n,n.resizeStartWidth+t,"uiColumnResized",!0)}moveHeader(t){const{beans:e,eGui:n,column:i,gos:r,ctrlsService:o}=this,c=r.get("enableRtl"),s=t===0,f=this.getPinned(),v=n.getBoundingClientRect(),w=v.left,C=v.width,M=z3(s!==c?w-20:w+C+20,f,!0,r,o),F=i.getGroupId(),N=this.focusService.getFocusedHeader();B3({allMovingColumns:this.column.getLeafColumns(),isFromHeader:!0,hDirection:t,xPosition:M,pinned:f,fromEnter:!1,fakeEvent:!1,gos:r,columnModel:e.columnModel,columnMoveService:e.columnMoveService,presentedColsService:e.visibleColsService});const z=i.getDisplayedLeafColumns(),L=s?z[0]:Yr(z);this.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(L,"auto"),!this.isAlive()&&N&&this.restoreFocus(F,i,N)}restoreFocus(t,e,n){const i=e.getLeafColumns();if(!i.length)return;const r=i[0].getParent();if(!r)return;const o=this.findGroupWidthId(r,t);o&&this.focusService.focusHeaderPosition({headerPosition:{...n,column:o}})}findGroupWidthId(t,e){for(;t;){if(t.getGroupId()===e)return t;t=t.getParent()}return null}resizeLeafColumnsToFit(t){this.resizeFeature&&this.resizeFeature.resizeLeafColumnsToFit(t)}setupUserComp(){const t=this.gos.addGridCommonParams({displayName:this.displayName,columnGroup:this.column,setExpanded:n=>{this.beans.columnModel.setColumnGroupOpened(this.column.getProvidedColumnGroup(),n,"gridInitializing")},setTooltip:(n,i)=>{this.setupTooltip(n,i)}}),e=this.userComponentFactory.getHeaderGroupCompDetails(t);this.comp.setUserCompDetails(e)}addHeaderMouseListeners(){const t=i=>this.handleMouseOverChange(i.type==="mouseenter"),e=()=>this.dispatchColumnMouseEvent("columnHeaderClicked",this.column.getProvidedColumnGroup()),n=i=>this.handleContextMenuMouseEvent(i,void 0,this.column.getProvidedColumnGroup());this.addManagedListeners(this.getGui(),{mouseenter:t,mouseleave:t,click:e,contextmenu:n})}handleMouseOverChange(t){const n={type:t?"columnHeaderMouseOver":"columnHeaderMouseLeave",column:this.column.getProvidedColumnGroup()};this.eventService.dispatchEvent(n)}setupTooltip(t,e){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature));const n=this.column.getColGroupDef(),i=this.gos.get("tooltipShowMode")==="whenTruncated",r=this.eGui;!e&&i&&!(n!=null&&n.headerGroupComponent)&&(e=()=>{const c=r.querySelector(".ag-header-group-text");return c?c.scrollWidth>c.clientWidth:!0});const o={getColumn:()=>this.column,getGui:()=>r,getLocation:()=>"headerGroup",getTooltipValue:()=>t??(n&&n.headerTooltip),shouldDisplayTooltip:e};n&&(o.getColDef=()=>n),this.createManagedBean(new Sw(o))}setupExpandable(){const t=this.column.getProvidedColumnGroup();this.refreshExpanded();const e=this.refreshExpanded.bind(this);this.addManagedListeners(t,{expandedChanged:e,expandableChanged:e})}refreshExpanded(){const{column:t}=this;this.expandable=t.isExpandable();const e=t.isExpanded();this.expandable?this.comp.setAriaExpanded(e?"true":"false"):this.comp.setAriaExpanded(void 0)}getColId(){return this.column.getUniqueId()}addClasses(){const t=this.column.getColGroupDef(),e=j7(t,this.gos,null,this.column);this.column.isPadding()?(e.push("ag-header-group-cell-no-group"),this.column.getLeafColumns().every(i=>i.isSpanHeaderHeight())&&e.push("ag-header-span-height")):e.push("ag-header-group-cell-with-group"),e.forEach(n=>this.comp.addOrRemoveCssClass(n,!0))}setupMovingCss(){const e=this.column.getProvidedColumnGroup().getLeafColumns(),n=()=>this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.column.isMoving());e.forEach(i=>{this.addManagedListeners(i,{movingChanged:n})}),n()}onFocusIn(t){if(!this.eGui.contains(t.relatedTarget)){const e=this.getRowIndex();this.beans.focusService.setFocusedHeader(e,this.column)}}handleKeyDown(t){super.handleKeyDown(t);const e=this.getWrapperHasFocus();if(!(!this.expandable||!e)&&t.key===mn.ENTER){const n=this.column,i=!n.isExpanded();this.beans.columnModel.setColumnGroupOpened(n.getProvidedColumnGroup(),i,"uiColumnExpanded")}}setDragSource(t){if(!this.isAlive()||this.isSuppressMoving()||(this.removeDragSource(),!t))return;const{beans:e,column:n,displayName:i,gos:r,dragAndDropService:o}=this,{columnModel:c}=e,s=n.getProvidedColumnGroup().getLeafColumns();let f=!r.get("suppressDragLeaveHidesColumns");const v=this.dragSource={type:1,eElement:t,getDefaultIconName:()=>f?"hide":"notAllowed",dragItemName:i,getDragItem:()=>this.getDragItemForGroup(n),onDragStarted:()=>{f=!r.get("suppressDragLeaveHidesColumns"),s.forEach(w=>w.setMoving(!0,"uiColumnDragged"))},onDragStopped:()=>s.forEach(w=>w.setMoving(!1,"uiColumnDragged")),onGridEnter:w=>{var C;if(f){const M=((C=w==null?void 0:w.columns)==null?void 0:C.filter(F=>!F.getColDef().lockVisible))||[];c.setColsVisible(M,!0,"uiColumnMoved")}},onGridExit:w=>{var C;if(f){const M=((C=w==null?void 0:w.columns)==null?void 0:C.filter(F=>!F.getColDef().lockVisible))||[];c.setColsVisible(M,!1,"uiColumnMoved")}}};o.addDragSource(v,!0)}getDragItemForGroup(t){const e=t.getProvidedColumnGroup().getLeafColumns(),n={};e.forEach(r=>n[r.getId()]=r.isVisible());const i=[];return this.beans.visibleColsService.getAllCols().forEach(r=>{e.indexOf(r)>=0&&(i.push(r),Xl(e,r))}),e.forEach(r=>i.push(r)),{columns:i,visibleState:n}}isSuppressMoving(){let t=!1;return this.column.getLeafColumns().forEach(n=>{(n.getColDef().suppressMovable||n.getColDef().lockPosition)&&(t=!0)}),t||this.gos.get("suppressMovableColumns")}},Pde=0,MD=class extends wn{constructor(t,e,n){super(),this.instanceId=Pde++,this.rowIndex=t,this.pinned=e,this.type=n;const i=n=="group"?"ag-header-row-column-group":n=="filter"?"ag-header-row-column-filter":"ag-header-row-column";this.headerRowClass=`ag-header-row ${i}`}wireBeans(t){this.beans=t}postConstruct(){this.isPrintLayout=this.gos.isDomLayout("print"),this.isEnsureDomOrder=this.gos.get("ensureDomOrder")}getInstanceId(){return this.instanceId}areCellsRendered(){return this.comp?this.getHeaderCellCtrls().every(t=>t.getGui()!=null):!1}setComp(t,e=!0){this.comp=t,e&&(this.onRowHeightChanged(),this.onVirtualColumnsChanged()),this.setWidth(),this.addEventListeners()}getHeaderRowClass(){return this.headerRowClass}getAriaRowIndex(){return this.rowIndex+1}addEventListeners(){const t=this.onRowHeightChanged.bind(this);this.addManagedEventListeners({columnResized:this.onColumnResized.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),virtualColumnsChanged:e=>this.onVirtualColumnsChanged(e.afterScroll),columnHeaderHeightChanged:t,gridStylesChanged:t,advancedFilterEnabledChanged:t}),this.addManagedPropertyListener("domLayout",this.onDisplayedColumnsChanged.bind(this)),this.addManagedPropertyListener("ensureDomOrder",e=>this.isEnsureDomOrder=e.currentValue),this.addManagedPropertyListeners(["headerHeight","pivotHeaderHeight","groupHeaderHeight","pivotGroupHeaderHeight","floatingFiltersHeight"],t)}getHeaderCellCtrl(t){if(this.headerCellCtrls)return sR(this.headerCellCtrls).find(e=>e.getColumnGroupChild()===t)}onDisplayedColumnsChanged(){this.isPrintLayout=this.gos.isDomLayout("print"),this.onVirtualColumnsChanged(),this.setWidth(),this.onRowHeightChanged()}getType(){return this.type}onColumnResized(){this.setWidth()}setWidth(){const t=this.getWidthForRow();this.comp.setWidth(`${t}px`)}getWidthForRow(){const{visibleColsService:t}=this.beans;return this.isPrintLayout?this.pinned!=null?0:t.getContainerWidth("right")+t.getContainerWidth("left")+t.getContainerWidth(null):t.getContainerWidth(this.pinned)}onRowHeightChanged(){const{topOffset:t,rowHeight:e}=this.getTopAndHeight();this.comp.setTop(t+"px"),this.comp.setHeight(e+"px")}getTopAndHeight(){const{columnModel:t,filterManager:e}=this.beans;let n=t.getHeaderRowCount();const i=[];let r=0;e!=null&&e.hasFloatingFilters()&&(n++,r=1);const o=t.getColumnGroupHeaderRowHeight(),c=t.getColumnHeaderRowHeight(),s=1+r,f=n-s;for(let C=0;C<f;C++)i.push(o);i.push(c);for(let C=0;C<r;C++)i.push(t.getFloatingFiltersHeight());let v=0;for(let C=0;C<this.rowIndex;C++)v+=i[C];const w=i[this.rowIndex];return{topOffset:v,rowHeight:w}}getPinned(){return this.pinned}getRowIndex(){return this.rowIndex}onVirtualColumnsChanged(t=!1){const e=this.getHeaderCtrls(),n=this.isEnsureDomOrder||this.isPrintLayout;this.comp.setHeaderCtrls(e,n,t)}getHeaderCtrls(){const t=this.headerCellCtrls;this.headerCellCtrls=new Map;const e=this.getColumnsInViewport();for(const i of e)this.recycleAndCreateHeaderCtrls(i,t);const n=i=>{const{focusService:r,visibleColsService:o}=this.beans;return r.isHeaderWrapperFocused(i)?o.isVisible(i.getColumnGroupChild()):!1};if(t)for(const[i,r]of t)n(r)?this.headerCellCtrls.set(i,r):this.destroyBean(r);return this.getHeaderCellCtrls()}getHeaderCellCtrls(){var t;return Array.from(((t=this.headerCellCtrls)==null?void 0:t.values())??[])}recycleAndCreateHeaderCtrls(t,e){if(!this.headerCellCtrls||t.isEmptyGroup())return;const n=t.getUniqueId();let i;if(e&&(i=e.get(n),e.delete(n)),i&&i.getColumnGroupChild()!=t&&(this.destroyBean(i),i=void 0),i==null)switch(this.type){case"filter":{i=this.createBean(this.beans.ctrlsFactory.getInstance("headerFilterCell",t,this.beans,this));break}case"group":i=this.createBean(new Ade(t,this.beans,this));break;default:i=this.createBean(new Mde(t,this.beans,this));break}this.headerCellCtrls.set(n,i)}getColumnsInViewport(){return this.isPrintLayout?this.getColumnsInViewportPrintLayout():this.getColumnsInViewportNormalLayout()}getColumnsInViewportPrintLayout(){if(this.pinned!=null)return[];let t=[];const e=this.getActualDepth(),{columnViewportService:n}=this.beans;return["left",null,"right"].forEach(i=>{const r=n.getHeadersToRender(i,e);t=t.concat(r)}),t}getActualDepth(){return this.type=="filter"?this.rowIndex-1:this.rowIndex}getColumnsInViewportNormalLayout(){return this.beans.columnViewportService.getHeadersToRender(this.pinned,this.getActualDepth())}findHeaderCellCtrl(t){return this.headerCellCtrls?this.getHeaderCellCtrls().find(i=>i.getColumnGroupChild()==t):void 0}focusHeader(t,e){const n=this.findHeaderCellCtrl(t);return n?n.focus(e):!1}destroy(){this.headerCellCtrls&&this.headerCellCtrls.forEach(t=>{this.destroyBean(t)}),this.headerCellCtrls=void 0,super.destroy()}},Ide=class extends wn{constructor(t){super(),this.hidden=!1,this.includeFloatingFilter=!1,this.groupsRowCtrls=[],this.pinned=t}wireBeans(t){this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService,this.pinnedWidthService=t.pinnedWidthService,this.columnModel=t.columnModel,this.focusService=t.focusService,this.filterManager=t.filterManager}setComp(t,e){this.comp=t,this.eViewport=e,this.setupCenterWidth(),this.setupPinnedWidth(),this.setupDragAndDrop(this.eViewport);const n=this.onDisplayedColumnsChanged.bind(this);this.addManagedEventListeners({gridColumnsChanged:this.onGridColumnsChanged.bind(this),displayedColumnsChanged:n,advancedFilterEnabledChanged:n}),this.ctrlsService.registerHeaderContainer(this,this.pinned),this.columnModel.isReady()&&this.refresh()}getAllCtrls(){const t=[...this.groupsRowCtrls];return this.columnsRowCtrl&&t.push(this.columnsRowCtrl),this.filtersRowCtrl&&t.push(this.filtersRowCtrl),t}refresh(t=!1){const e=new rw,n=this.focusService.getFocusHeaderToUseAfterRefresh(),i=()=>{const s=this.columnModel.getHeaderRowCount()-1;this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls);for(let f=0;f<s;f++){const v=this.createBean(new MD(e.next(),this.pinned,"group"));this.groupsRowCtrls.push(v)}},r=()=>{const s=e.next(),f=!this.hidden&&(this.columnsRowCtrl==null||!t||this.columnsRowCtrl.getRowIndex()!==s);(f||this.hidden)&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),f&&(this.columnsRowCtrl=this.createBean(new MD(s,this.pinned,"column")))},o=()=>{var v;this.includeFloatingFilter=!!((v=this.filterManager)!=null&&v.hasFloatingFilters())&&!this.hidden;const s=()=>{this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)};if(!this.includeFloatingFilter){s();return}const f=e.next();if(this.filtersRowCtrl){const w=this.filtersRowCtrl.getRowIndex()!==f;(!t||w)&&s()}this.filtersRowCtrl||(this.filtersRowCtrl=this.createBean(new MD(f,this.pinned,"filter")))};i(),r(),o();const c=this.getAllCtrls();this.comp.setCtrls(c),this.restoreFocusOnHeader(n)}getHeaderCtrlForColumn(t){if(av(t))return this.columnsRowCtrl?this.columnsRowCtrl.getHeaderCellCtrl(t):void 0;if(this.groupsRowCtrls.length!==0)for(let e=0;e<this.groupsRowCtrls.length;e++){const n=this.groupsRowCtrls[e].getHeaderCellCtrl(t);if(n)return n}}getHtmlElementForColumnHeader(t){const e=this.getHeaderCtrlForColumn(t);return e?e.getGui():null}getRowType(t){const n=this.getAllCtrls()[t];return n?n.getType():void 0}focusHeader(t,e,n){const r=this.getAllCtrls()[t];return r?r.focusHeader(e,n):!1}getViewport(){return this.eViewport}getRowCount(){return this.groupsRowCtrls.length+(this.columnsRowCtrl?1:0)+(this.filtersRowCtrl?1:0)}setHorizontalScroll(t){this.comp.setViewportScrollLeft(t)}destroy(){this.filtersRowCtrl&&(this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)),this.columnsRowCtrl&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),this.groupsRowCtrls&&this.groupsRowCtrls.length&&(this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls)),super.destroy()}setupDragAndDrop(t){const e=new Sde(this.pinned,t);this.createManagedBean(e)}restoreFocusOnHeader(t){if(!t)return;const{column:e}=t;e.getPinned()==this.pinned&&this.focusService.focusHeaderPosition({headerPosition:t})}onGridColumnsChanged(){this.refresh(!0)}onDisplayedColumnsChanged(){var e;const t=((e=this.filterManager)==null?void 0:e.hasFloatingFilters())&&!this.hidden;this.includeFloatingFilter!==t&&this.refresh(!0)}setupCenterWidth(){this.pinned==null&&this.createManagedBean(new N3(t=>this.comp.setCenterWidth(`${t}px`),!0))}setupPinnedWidth(){if(this.pinned==null)return;const t=this.pinned==="left",e=this.pinned==="right";this.hidden=!0;const n=()=>{const i=t?this.pinnedWidthService.getPinnedLeftWidth():this.pinnedWidthService.getPinnedRightWidth();if(i==null)return;const r=i==0,o=this.hidden!==r,c=this.gos.get("enableRtl"),s=this.gos.getScrollbarWidth(),v=this.scrollVisibleService.isVerticalScrollShowing()&&(c&&t||!c&&e)?i+s:i;this.comp.setPinnedContainerWidth(`${v}px`),this.comp.setDisplayed(!r),o&&(this.hidden=r,this.refresh())};this.addManagedEventListeners({leftPinnedWidthChanged:n,rightPinnedWidthChanged:n,scrollVisibilityChanged:n,scrollbarWidthChanged:n})}},U3=class extends wn{constructor(t){super(),this.view=t}postConstruct(){this.addManagedPropertyListener("domLayout",this.updateLayoutClasses.bind(this)),this.updateLayoutClasses()}updateLayoutClasses(){const t=this.getDomLayout(),e={autoHeight:t==="autoHeight",normal:t==="normal",print:t==="print"},n=e.autoHeight?"ag-layout-auto-height":e.print?"ag-layout-print":"ag-layout-normal";this.view.updateLayoutClasses(n,e)}getDomLayout(){const t=this.gos.get("domLayout")??"normal";return["normal","print","autoHeight"].indexOf(t)===-1?(Tn(`${t} is not valid for DOM Layout, valid values are 'normal', 'autoHeight', 'print'.`),"normal"):t}},Dde=class extends Js{constructor(){super(`
            <div class="ag-overlay" role="presentation">
                <div class="ag-overlay-panel" role="presentation">
                    <div class="ag-overlay-wrapper" data-ref="eOverlayWrapper" role="presentation"></div>
                </div>
            </div>`),this.eOverlayWrapper=qi,this.activePromise=null,this.activeOverlay=null,this.updateListenerDestroyFunc=null,this.activeOverlayWrapperCssClass=null}wireBeans(t){this.overlayService=t.overlayService}updateLayoutClasses(t,e){const n=this.eOverlayWrapper.classList;n.toggle("ag-layout-auto-height",e.autoHeight),n.toggle("ag-layout-normal",e.normal),n.toggle("ag-layout-print",e.print)}postConstruct(){this.createManagedBean(new U3(this)),this.setDisplayed(!1,{skipAriaHidden:!0}),this.overlayService.registerOverlayWrapperComp(this)}setWrapperTypeClass(t){const e=this.eOverlayWrapper.classList;this.activeOverlayWrapperCssClass&&e.toggle(this.activeOverlayWrapperCssClass,!1),this.activeOverlayWrapperCssClass=t,e.toggle(t,!0)}showOverlay(t,e,n){this.setWrapperTypeClass(e),this.destroyActiveOverlay(),this.activePromise=t,t==null||t.then(i=>{if(this.activePromise!==t){this.activeOverlay!==i&&(this.destroyBean(i),i=null);return}if(this.activePromise=null,!!i&&this.activeOverlay!=i&&(this.eOverlayWrapper.appendChild(i.getGui()),this.activeOverlay=i,n)){const r=i;this.updateListenerDestroyFunc=this.addManagedPropertyListener(n,({currentValue:o})=>{var c;(c=r.refresh)==null||c.call(r,this.gos.addGridCommonParams({...o??{}}))})}}),this.setDisplayed(!0,{skipAriaHidden:!0})}destroyActiveOverlay(){this.activePromise=null;const t=this.activeOverlay;if(!t)return;this.activeOverlay=null;const e=this.updateListenerDestroyFunc;e&&(e(),this.updateListenerDestroyFunc=null),this.destroyBean(t),Cu(this.eOverlayWrapper)}hideOverlay(){this.destroyActiveOverlay(),this.setDisplayed(!1,{skipAriaHidden:!0})}destroy(){this.destroyActiveOverlay(),super.destroy()}},tq=class extends Js{constructor(t,e){super(),this.direction=e,this.eViewport=qi,this.eContainer=qi,this.hideTimeout=null,this.setTemplate(t)}wireBeans(t){this.animationFrameService=t.animationFrameService}postConstruct(){this.addManagedEventListeners({scrollVisibilityChanged:this.onScrollVisibilityChanged.bind(this)}),this.onScrollVisibilityChanged(),this.addOrRemoveCssClass("ag-apple-scrollbar",c7()||wv())}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.invisibleScrollbar=h7(),this.invisibleScrollbar&&(this.hideAndShowInvisibleScrollAsNeeded(),this.addActiveListenerToggles()))}addActiveListenerToggles(){const t=this.getGui(),e=()=>this.addOrRemoveCssClass("ag-scrollbar-active",!0),n=()=>this.addOrRemoveCssClass("ag-scrollbar-active",!1);this.addManagedListeners(t,{mouseenter:e,mousedown:e,touchstart:e,mouseleave:n,touchend:n})}onScrollVisibilityChanged(){this.invisibleScrollbar===void 0&&this.initialiseInvisibleScrollbar(),this.animationFrameService.requestAnimationFrame(()=>this.setScrollVisible())}hideAndShowInvisibleScrollAsNeeded(){this.addManagedEventListeners({bodyScroll:t=>{t.direction===this.direction&&(this.hideTimeout!==null&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=null),this.addOrRemoveCssClass("ag-scrollbar-scrolling",!0))},bodyScrollEnd:()=>{this.hideTimeout=window.setTimeout(()=>{this.addOrRemoveCssClass("ag-scrollbar-scrolling",!1),this.hideTimeout=null},400)}})}attemptSettingScrollPosition(t){const e=this.getViewport();xce(()=>Ef(e),()=>this.setScrollPosition(t),100)}getViewport(){return this.eViewport}getContainer(){return this.eContainer}onScrollCallback(t){this.addManagedElementListeners(this.getViewport(),{scroll:t})}},Fde=class extends tq{constructor(){super(`<div class="ag-body-horizontal-scroll" aria-hidden="true">
            <div class="ag-horizontal-left-spacer" data-ref="eLeftSpacer"></div>
            <div class="ag-body-horizontal-scroll-viewport" data-ref="eViewport">
                <div class="ag-body-horizontal-scroll-container" data-ref="eContainer"></div>
            </div>
            <div class="ag-horizontal-right-spacer" data-ref="eRightSpacer"></div>
        </div>`,"horizontal"),this.eLeftSpacer=qi,this.eRightSpacer=qi}wireBeans(t){super.wireBeans(t),this.visibleColsService=t.visibleColsService,this.pinnedRowModel=t.pinnedRowModel,this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService}postConstruct(){super.postConstruct();const t=this.setFakeHScrollSpacerWidths.bind(this);this.addManagedEventListeners({displayedColumnsChanged:t,displayedColumnsWidthChanged:t,pinnedRowDataChanged:this.onPinnedRowDataChanged.bind(this)}),this.addManagedPropertyListener("domLayout",t),this.ctrlsService.register("fakeHScrollComp",this),this.createManagedBean(new N3(e=>this.eContainer.style.width=`${e}px`)),this.addManagedPropertyListeners(["suppressHorizontalScroll"],this.onScrollVisibilityChanged.bind(this))}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.enableRtl=this.gos.get("enableRtl"),super.initialiseInvisibleScrollbar(),this.invisibleScrollbar&&this.refreshCompBottom())}onPinnedRowDataChanged(){this.refreshCompBottom()}refreshCompBottom(){if(!this.invisibleScrollbar)return;const t=this.pinnedRowModel.getPinnedBottomTotalHeight();this.getGui().style.bottom=`${t}px`}onScrollVisibilityChanged(){super.onScrollVisibilityChanged(),this.setFakeHScrollSpacerWidths()}setFakeHScrollSpacerWidths(){const t=this.scrollVisibleService.isVerticalScrollShowing();let e=this.visibleColsService.getDisplayedColumnsRightWidth();const n=!this.enableRtl&&t,i=this.gos.getScrollbarWidth();n&&(e+=i),sd(this.eRightSpacer,e),this.eRightSpacer.classList.toggle("ag-scroller-corner",e<=i);let r=this.visibleColsService.getColsLeftWidth();this.enableRtl&&t&&(r+=i),sd(this.eLeftSpacer,r),this.eLeftSpacer.classList.toggle("ag-scroller-corner",r<=i)}setScrollVisible(){const t=this.scrollVisibleService.isHorizontalScrollShowing(),e=this.invisibleScrollbar,n=this.gos.get("suppressHorizontalScroll"),i=t&&this.gos.getScrollbarWidth()||0,o=n?0:i===0&&e?16:i;this.addOrRemoveCssClass("ag-scrollbar-invisible",e),C1(this.getGui(),o),C1(this.eViewport,o),C1(this.eContainer,o),this.setDisplayed(t,{skipAriaHidden:!0})}getScrollPosition(){return sT(this.getViewport(),this.enableRtl)}setScrollPosition(t){Ef(this.getViewport())||this.attemptSettingScrollPosition(t),oT(this.getViewport(),t,this.enableRtl)}},nq=class extends wn{wireBeans(t){this.maxDivHeightScaler=t.rowContainerHeightService}constructor(t,e){super(),this.eContainer=t,this.eViewport=e}postConstruct(){this.addManagedEventListeners({rowContainerHeightChanged:this.onHeightChanged.bind(this)})}onHeightChanged(){const t=this.maxDivHeightScaler.getUiContainerHeight(),e=t!=null?`${t}px`:"";this.eContainer.style.height=e,this.eViewport&&(this.eViewport.style.height=e)}},Lde=class extends tq{wireBeans(t){super.wireBeans(t),this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService}constructor(){super(`<div class="ag-body-vertical-scroll" aria-hidden="true">
            <div class="ag-body-vertical-scroll-viewport" data-ref="eViewport">
                <div class="ag-body-vertical-scroll-container" data-ref="eContainer"></div>
            </div>
        </div>`,"vertical")}postConstruct(){super.postConstruct(),this.createManagedBean(new nq(this.eContainer)),this.ctrlsService.register("fakeVScrollComp",this),this.addManagedEventListeners({rowContainerHeightChanged:this.onRowContainerHeightChanged.bind(this)})}setScrollVisible(){const t=this.scrollVisibleService.isVerticalScrollShowing(),e=this.invisibleScrollbar,n=t&&this.gos.getScrollbarWidth()||0,i=n===0&&e?16:n;this.addOrRemoveCssClass("ag-scrollbar-invisible",e),sd(this.getGui(),i),sd(this.eViewport,i),sd(this.eContainer,i),this.setDisplayed(t,{skipAriaHidden:!0})}onRowContainerHeightChanged(){const{ctrlsService:t}=this,n=t.getGridBodyCtrl().getBodyViewportElement(),i=this.getScrollPosition(),r=n.scrollTop;i!=r&&this.setScrollPosition(r,!0)}getScrollPosition(){return this.getViewport().scrollTop}setScrollPosition(t,e){!e&&!Ef(this.getViewport())&&this.attemptSettingScrollPosition(t),this.getViewport().scrollTop=t}},Ode=class extends wn{constructor(t){super(),this.lastScrollSource=[null,null],this.scrollLeft=-1,this.nextScrollTop=-1,this.scrollTop=-1,this.lastOffsetHeight=-1,this.lastScrollTop=-1,this.eBodyViewport=t,this.resetLastHScrollDebounced=Kl(()=>this.lastScrollSource[1]=null,500),this.resetLastVScrollDebounced=Kl(()=>this.lastScrollSource[0]=null,500)}wireBeans(t){this.ctrlsService=t.ctrlsService,this.animationFrameService=t.animationFrameService,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService,this.rowModel=t.rowModel,this.heightScaler=t.rowContainerHeightService,this.rowRenderer=t.rowRenderer,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService}postConstruct(){this.enableRtl=this.gos.get("enableRtl"),this.addManagedEventListeners({displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this)}),this.ctrlsService.whenReady(t=>{this.centerRowsCtrl=t.center,this.onDisplayedColumnsWidthChanged(),this.addScrollListener()})}addScrollListener(){const{fakeHScrollComp:t,fakeVScrollComp:e}=this.ctrlsService.getParams();this.addManagedElementListeners(this.centerRowsCtrl.getViewportElement(),{scroll:this.onHScroll.bind(this)}),t.onScrollCallback(this.onFakeHScroll.bind(this));const n=this.gos.get("debounceVerticalScrollbar"),i=n?Kl(this.onVScroll.bind(this),100):this.onVScroll.bind(this),r=n?Kl(this.onFakeVScroll.bind(this),100):this.onFakeVScroll.bind(this);this.addManagedElementListeners(this.eBodyViewport,{scroll:i}),e.onScrollCallback(r)}onDisplayedColumnsWidthChanged(){this.enableRtl&&this.horizontallyScrollHeaderCenterAndFloatingCenter()}horizontallyScrollHeaderCenterAndFloatingCenter(t){if(this.centerRowsCtrl==null)return;t===void 0&&(t=this.centerRowsCtrl.getCenterViewportScrollLeft());const n=this.enableRtl?t:-t,{topCenter:i,stickyTopCenter:r,stickyBottomCenter:o,centerHeader:c,bottomCenter:s,fakeHScrollComp:f}=this.ctrlsService.getParams();c.setHorizontalScroll(-n),s.setContainerTranslateX(n),i.setContainerTranslateX(n),r.setContainerTranslateX(n),o.setContainerTranslateX(n);const v=this.centerRowsCtrl.getViewportElement(),w=this.lastScrollSource[1]===0;t=Math.abs(t),w?f.setScrollPosition(t):oT(v,t,this.enableRtl)}isControllingScroll(t,e){return this.lastScrollSource[e]==null?(this.lastScrollSource[e]=t,!0):this.lastScrollSource[e]===t}onFakeHScroll(){this.isControllingScroll(1,1)&&this.onHScrollCommon(1)}onHScroll(){this.isControllingScroll(0,1)&&this.onHScrollCommon(0)}onHScrollCommon(t){const e=this.centerRowsCtrl.getViewportElement(),{scrollLeft:n}=e;if(this.shouldBlockScrollUpdate(1,n,!0))return;let i;t===0?i=sT(e,this.enableRtl):i=this.ctrlsService.get("fakeHScrollComp").getScrollPosition(),this.doHorizontalScroll(Math.round(i)),this.resetLastHScrollDebounced()}onFakeVScroll(){this.isControllingScroll(1,0)&&this.onVScrollCommon(1)}onVScroll(){this.isControllingScroll(0,0)&&this.onVScrollCommon(0)}onVScrollCommon(t){let e;t===0?e=this.eBodyViewport.scrollTop:e=this.ctrlsService.get("fakeVScrollComp").getScrollPosition(),!this.shouldBlockScrollUpdate(0,e,!0)&&(this.animationFrameService.setScrollTop(e),this.nextScrollTop=e,t===0?this.ctrlsService.get("fakeVScrollComp").setScrollPosition(e):this.eBodyViewport.scrollTop=e,this.gos.get("suppressAnimationFrame")?this.scrollGridIfNeeded():this.animationFrameService.schedule(),this.resetLastVScrollDebounced())}doHorizontalScroll(t){const e=this.ctrlsService.get("fakeHScrollComp").getScrollPosition();this.scrollLeft===t&&t===e||(this.scrollLeft=t,this.fireScrollEvent(1),this.horizontallyScrollHeaderCenterAndFloatingCenter(t),this.centerRowsCtrl.onHorizontalViewportChanged(!0))}fireScrollEvent(t){const e={type:"bodyScroll",direction:t===1?"horizontal":"vertical",left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(e),window.clearTimeout(this.scrollTimer),this.scrollTimer=void 0,this.scrollTimer=window.setTimeout(()=>{const n={...e,type:"bodyScrollEnd"};this.eventService.dispatchEvent(n)},100)}shouldBlockScrollUpdate(t,e,n=!1){return n&&!wv()?!1:t===0?this.shouldBlockVerticalScroll(e):this.shouldBlockHorizontalScroll(e)}shouldBlockVerticalScroll(t){const e=C3(this.eBodyViewport),{scrollHeight:n}=this.eBodyViewport;return t<0||t+e>n}shouldBlockHorizontalScroll(t){const e=this.centerRowsCtrl.getCenterWidth(),{scrollWidth:n}=this.centerRowsCtrl.getViewportElement();if(this.enableRtl&&rT()){if(t>0)return!0}else if(t<0)return!0;return Math.abs(t)+e>n}redrawRowsAfterScroll(){this.fireScrollEvent(0)}checkScrollLeft(){this.scrollLeft!==this.centerRowsCtrl.getCenterViewportScrollLeft()&&this.onHScrollCommon(0)}scrollGridIfNeeded(){const t=this.scrollTop!=this.nextScrollTop;return t&&(this.scrollTop=this.nextScrollTop,this.redrawRowsAfterScroll()),t}setHorizontalScrollPosition(t,e=!1){const i=this.centerRowsCtrl.getViewportElement().scrollWidth-this.centerRowsCtrl.getCenterWidth();!e&&this.shouldBlockScrollUpdate(1,t)&&(this.enableRtl&&rT()?t=t>0?0:i:t=Math.min(Math.max(t,0),i)),oT(this.centerRowsCtrl.getViewportElement(),Math.abs(t),this.enableRtl),this.doHorizontalScroll(t)}setVerticalScrollPosition(t){this.eBodyViewport.scrollTop=t}getVScrollPosition(){return this.lastScrollTop=this.eBodyViewport.scrollTop,this.lastOffsetHeight=this.eBodyViewport.offsetHeight,{top:this.lastScrollTop,bottom:this.lastScrollTop+this.lastOffsetHeight}}getApproximateVScollPosition(){return this.lastScrollTop>=0&&this.lastOffsetHeight>=0?{top:this.scrollTop,bottom:this.scrollTop+this.lastOffsetHeight}:this.getVScrollPosition()}getHScrollPosition(){return this.centerRowsCtrl.getHScrollPosition()}isHorizontalScrollShowing(){return this.centerRowsCtrl.isHorizontalScrollShowing()}scrollHorizontally(t){const e=this.centerRowsCtrl.getViewportElement().scrollLeft;return this.setHorizontalScrollPosition(e+t),this.centerRowsCtrl.getViewportElement().scrollLeft-e}scrollToTop(){this.eBodyViewport.scrollTop=0}ensureNodeVisible(t,e=null){const n=this.rowModel.getRowCount();let i=-1;for(let r=0;r<n;r++){const o=this.rowModel.getRow(r);if(typeof t=="function"){if(o&&t(o)){i=r;break}}else if(t===o||t===o.data){i=r;break}}i>=0&&this.ensureIndexVisible(i,e)}ensureIndexVisible(t,e){if(this.gos.isDomLayout("print"))return;const n=this.rowModel.getRowCount();if(typeof t!="number"||t<0||t>=n){Tn("Invalid row index for ensureIndexVisible: "+t);return}const r=this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel");this.getFrameworkOverrides().wrapIncoming(()=>{var w;r||(w=this.paginationService)==null||w.goToPageWithIndex(t);const o=this.ctrlsService.getGridBodyCtrl(),c=o.getStickyTopHeight(),s=o.getStickyBottomHeight(),f=this.rowModel.getRow(t);let v;do{const C=f.rowTop,M=f.rowHeight,F=this.pageBoundsService.getPixelOffset(),N=f.rowTop-F,z=N+f.rowHeight,L=this.getVScrollPosition(),P=this.heightScaler.getDivStretchOffset(),H=L.top+P,j=L.bottom+P,q=j-H,le=this.heightScaler.getScrollPositionForPixel(N),ce=this.heightScaler.getScrollPositionForPixel(z-q),ae=Math.min((le+ce)/2,N),pe=H+c>N,fe=j-s<z;let ue=null;e==="top"?ue=le:e==="bottom"?ue=ce:e==="middle"?ue=ae:pe?ue=le-c:fe&&(ue=ce+s),ue!==null&&(this.setVerticalScrollPosition(ue),this.rowRenderer.redraw({afterScroll:!0})),v=C!==f.rowTop||M!==f.rowHeight}while(v);this.animationFrameService.flushAllFrames()})}ensureColumnVisible(t,e="auto"){const n=this.columnModel.getCol(t);if(!n||n.isPinned()||!this.visibleColsService.isColDisplayed(n))return;const i=this.getPositionedHorizontalScroll(n,e);this.getFrameworkOverrides().wrapIncoming(()=>{i!==null&&this.centerRowsCtrl.setCenterViewportScrollLeft(i),this.centerRowsCtrl.onHorizontalViewportChanged(),this.animationFrameService.flushAllFrames()})}setScrollPosition(t,e){this.getFrameworkOverrides().wrapIncoming(()=>{this.centerRowsCtrl.setCenterViewportScrollLeft(e),this.setVerticalScrollPosition(t),this.rowRenderer.redraw({afterScroll:!0}),this.animationFrameService.flushAllFrames()})}getPositionedHorizontalScroll(t,e){const{columnBeforeStart:n,columnAfterEnd:i}=this.isColumnOutsideViewport(t),r=this.centerRowsCtrl.getCenterWidth()<t.getActualWidth(),o=this.centerRowsCtrl.getCenterWidth(),c=this.enableRtl;let s=(c?n:i)||r,f=c?i:n;e!=="auto"&&(s=e==="start",f=e==="end");const v=e==="middle";if(s||f||v){const{colLeft:w,colMiddle:C,colRight:M}=this.getColumnBounds(t);return v?C-o/2:s?c?M:w:c?w-o:M-o}return null}isColumnOutsideViewport(t){const{start:e,end:n}=this.getViewportBounds(),{colLeft:i,colRight:r}=this.getColumnBounds(t),o=this.enableRtl,c=o?e>r:n<r,s=o?n<i:e>i;return{columnBeforeStart:c,columnAfterEnd:s}}getColumnBounds(t){const e=this.enableRtl,n=this.visibleColsService.getBodyContainerWidth(),i=t.getActualWidth(),r=t.getLeft(),o=e?-1:1,c=e?n-r:r,s=c+i*o,f=c+i/2*o;return{colLeft:c,colMiddle:f,colRight:s}}getViewportBounds(){const t=this.centerRowsCtrl.getCenterWidth(),e=this.centerRowsCtrl.getCenterViewportScrollLeft(),n=e,i=t+e;return{start:n,end:i,width:t}}},kde="ag-force-vertical-scroll",Nde="ag-selectable",Bde="ag-column-moving",zde=class extends wn{constructor(){super(...arguments),this.stickyTopHeight=0,this.stickyBottomHeight=0}wireBeans(t){this.animationFrameService=t.animationFrameService,this.rowContainerHeightService=t.rowContainerHeightService,this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.scrollVisibleService=t.scrollVisibleService,this.menuService=t.menuService,this.headerNavigationService=t.headerNavigationService,this.dragAndDropService=t.dragAndDropService,this.pinnedRowModel=t.pinnedRowModel,this.rowRenderer=t.rowRenderer,this.popupService=t.popupService,this.mouseEventService=t.mouseEventService,this.rowModel=t.rowModel,this.filterManager=t.filterManager,this.environment=t.environment}getScrollFeature(){return this.bodyScrollFeature}getBodyViewportElement(){return this.eBodyViewport}setComp(t,e,n,i,r,o,c){var s;this.comp=t,this.eGridBody=e,this.eBodyViewport=n,this.eTop=i,this.eBottom=r,this.eStickyTop=o,this.eStickyBottom=c,this.setCellTextSelection(this.gos.get("enableCellTextSelection")),this.addManagedPropertyListener("enableCellTextSelection",f=>this.setCellTextSelection(f.currentValue)),this.createManagedBean(new U3(this.comp)),this.bodyScrollFeature=this.createManagedBean(new Ode(this.eBodyViewport)),this.addRowDragListener(),this.setupRowAnimationCssClass(),this.addEventListeners(),this.addFocusListeners([i,n,r,o,c]),this.onGridColumnsChanged(),this.addBodyViewportListener(),this.setFloatingHeights(),this.disableBrowserDragging(),this.addStopEditingWhenGridLosesFocus(),(s=this.filterManager)==null||s.setupAdvancedFilterHeaderComp(i),this.ctrlsService.register("gridBodyCtrl",this)}getComp(){return this.comp}addEventListeners(){this.addManagedEventListeners({gridColumnsChanged:this.onGridColumnsChanged.bind(this),scrollVisibilityChanged:this.onScrollVisibilityChanged.bind(this),pinnedRowDataChanged:this.setFloatingHeights.bind(this),pinnedHeightChanged:this.setFloatingHeights.bind(this),headerHeightChanged:this.onHeaderHeightChanged.bind(this)})}addFocusListeners(t){t.forEach(e=>{this.addManagedElementListeners(e,{focusin:n=>{const{target:i}=n,r=Ax(i,"ag-root",e);e.classList.toggle("ag-has-focus",!r)},focusout:n=>{const{target:i,relatedTarget:r}=n,o=e.contains(r),c=Ax(r,"ag-root",e);Ax(i,"ag-root",e)||(!o||c)&&e.classList.remove("ag-has-focus")}})})}setColumnMovingCss(t){this.comp.setColumnMovingCss(Bde,t)}setCellTextSelection(t=!1){this.comp.setCellSelectableCss(Nde,t)}onScrollVisibilityChanged(){const t=this.scrollVisibleService.isVerticalScrollShowing();this.setVerticalScrollPaddingVisible(t),this.setStickyWidth(t),this.setStickyBottomOffsetBottom();const e=t&&this.gos.getScrollbarWidth()||0,n=h7()?16:0,i=`calc(100% + ${e+n}px)`;this.animationFrameService.requestAnimationFrame(()=>this.comp.setBodyViewportWidth(i))}onGridColumnsChanged(){const t=this.columnModel.getCols();this.comp.setColumnCount(t.length)}disableBrowserDragging(){this.addManagedElementListeners(this.eGridBody,{dragstart:t=>{if(t.target instanceof HTMLImageElement)return t.preventDefault(),!1}})}addStopEditingWhenGridLosesFocus(){if(!this.gos.get("stopEditingWhenCellsLoseFocus"))return;const t=n=>{const i=n.relatedTarget;if(ML(i)===null){this.rowRenderer.stopEditing();return}let r=e.some(o=>o.contains(i))&&this.mouseEventService.isElementInThisGrid(i);if(!r){const o=this.popupService;r=o.getActivePopups().some(c=>c.contains(i))||o.isElementWithinCustomPopup(i)}r||this.rowRenderer.stopEditing()},e=[this.eBodyViewport,this.eBottom,this.eTop,this.eStickyTop,this.eStickyBottom];e.forEach(n=>this.addManagedElementListeners(n,{focusout:t}))}updateRowCount(){var i;const t=this.headerNavigationService.getHeaderRowCount()+(((i=this.filterManager)==null?void 0:i.getHeaderRowCount())??0),e=this.rowModel.isLastRowIndexKnown()?this.rowModel.getRowCount():-1,n=e===-1?-1:t+e;this.comp.setRowCount(n)}registerBodyViewportResizeListener(t){this.comp.registerBodyViewportResizeListener(t)}setVerticalScrollPaddingVisible(t){const e=t?"scroll":"hidden";this.comp.setPinnedTopBottomOverflowY(e)}isVerticalScrollShowing(){const t=this.gos.get("alwaysShowVerticalScroll"),e=t?kde:null,n=this.gos.isDomLayout("normal");return this.comp.setAlwaysVerticalScrollClass(e,t),t||n&&uue(this.eBodyViewport)}setupRowAnimationCssClass(){let t=this.environment.hasMeasuredSizes();const e=()=>{const n=t&&this.gos.isAnimateRows()&&!this.rowContainerHeightService.isStretching(),i=n?"ag-row-animation":"ag-row-no-animation";this.comp.setRowAnimationCssOnBodyViewport(i,n)};e(),this.addManagedEventListeners({heightScaleChanged:e}),this.addManagedPropertyListener("animateRows",e),this.addManagedEventListeners({gridStylesChanged:()=>{!t&&this.environment.hasMeasuredSizes()&&(t=!0,e())}})}getGridBodyElement(){return this.eGridBody}addBodyViewportListener(){const t=this.onBodyViewportContextMenu.bind(this);this.addManagedElementListeners(this.eBodyViewport,{contextmenu:t}),this.mockContextMenuForIPad(t),this.addManagedElementListeners(this.eBodyViewport,{wheel:this.onBodyViewportWheel.bind(this)}),this.addManagedElementListeners(this.eStickyTop,{wheel:this.onStickyWheel.bind(this)}),this.addManagedElementListeners(this.eStickyBottom,{wheel:this.onStickyWheel.bind(this)}),this.addFullWidthContainerWheelListener()}addFullWidthContainerWheelListener(){const t=this.eBodyViewport.querySelector(".ag-full-width-container"),e=this.eBodyViewport.querySelector(".ag-center-cols-viewport");t&&e&&this.addManagedElementListeners(t,{wheel:n=>this.onFullWidthContainerWheel(n,e)})}onFullWidthContainerWheel(t,e){!t.deltaX||Math.abs(t.deltaY)>Math.abs(t.deltaX)||!this.mouseEventService.isEventFromThisGrid(t)||(t.preventDefault(),e.scrollBy({left:t.deltaX}))}onBodyViewportContextMenu(t,e,n){if(!t&&!n)return;this.gos.get("preventDefaultOnContextMenu")&&(t||n).preventDefault();const{target:i}=t||e;(i===this.eBodyViewport||i===this.ctrlsService.get("center").getViewportElement())&&this.menuService.showContextMenu({mouseEvent:t,touchEvent:n,value:null,anchorToElement:this.eGridBody})}mockContextMenuForIPad(t){if(!wv())return;const e=new Jg(this.eBodyViewport),n=i=>{t(void 0,i.touchStart,i.touchEvent)};this.addManagedListeners(e,{longTap:n}),this.addDestroyFunc(()=>e.destroy())}onBodyViewportWheel(t){this.gos.get("suppressScrollWhenPopupsAreOpen")&&this.popupService.hasAnchoredPopup()&&t.preventDefault()}onStickyWheel(t){t.preventDefault(),t.offsetY&&this.scrollVertically(t.deltaY)}getGui(){return this.eGridBody}scrollVertically(t){const e=this.eBodyViewport.scrollTop;return this.bodyScrollFeature.setVerticalScrollPosition(e+t),this.eBodyViewport.scrollTop-e}addRowDragListener(){this.rowDragFeature=this.createManagedBean(new rhe(this.eBodyViewport)),this.dragAndDropService.addDropTarget(this.rowDragFeature)}getRowDragFeature(){return this.rowDragFeature}setFloatingHeights(){const{pinnedRowModel:t}=this,e=t.getPinnedTopTotalHeight(),n=t.getPinnedBottomTotalHeight();this.comp.setTopHeight(e),this.comp.setBottomHeight(n),this.comp.setTopDisplay(e?"inherit":"none"),this.comp.setBottomDisplay(n?"inherit":"none"),this.setStickyTopOffsetTop(),this.setStickyBottomOffsetBottom()}setStickyTopHeight(t=0){this.comp.setStickyTopHeight(`${t}px`),this.stickyTopHeight=t}getStickyTopHeight(){return this.stickyTopHeight}setStickyBottomHeight(t=0){this.comp.setStickyBottomHeight(`${t}px`),this.stickyBottomHeight=t}getStickyBottomHeight(){return this.stickyBottomHeight}setStickyWidth(t){if(!t)this.comp.setStickyTopWidth("100%"),this.comp.setStickyBottomWidth("100%");else{const e=this.gos.getScrollbarWidth();this.comp.setStickyTopWidth(`calc(100% - ${e}px)`),this.comp.setStickyBottomWidth(`calc(100% - ${e}px)`)}}onHeaderHeightChanged(){this.setStickyTopOffsetTop()}setStickyTopOffsetTop(){var r;const e=this.ctrlsService.get("gridHeaderCtrl").getHeaderHeight()+(((r=this.filterManager)==null?void 0:r.getHeaderHeight())??0),n=this.pinnedRowModel.getPinnedTopTotalHeight();let i=0;e>0&&(i+=e),n>0&&(i+=n),i>0&&(i+=1),this.comp.setStickyTopTop(`${i}px`)}setStickyBottomOffsetBottom(){const t=this.pinnedRowModel.getPinnedBottomTotalHeight(),n=this.scrollVisibleService.isHorizontalScrollShowing()&&this.gos.getScrollbarWidth()||0,i=t+n;this.comp.setStickyBottomBottom(`${i}px`)}sizeColumnsToFit(t,e){const i=this.isVerticalScrollShowing()?this.gos.getScrollbarWidth():0,o=VS(this.eGridBody)-i;if(o>0){this.columnSizeService.sizeColumnsToFit(o,"sizeColumnsToFit",!1,t);return}e===void 0?window.setTimeout(()=>{this.sizeColumnsToFit(t,100)},0):e===100?window.setTimeout(()=>{this.sizeColumnsToFit(t,500)},100):e===500?window.setTimeout(()=>{this.sizeColumnsToFit(t,-1)},500):Tn("tried to call sizeColumnsToFit() but the grid is coming back with zero width, maybe the grid is not visible yet on the screen?")}addScrollEventListener(t){this.eBodyViewport.addEventListener("scroll",t,{passive:!0})}removeScrollEventListener(t){this.eBodyViewport.removeEventListener("scroll",t)}},Ude=class extends wn{wireBeans(t){this.ctrlsService=t.ctrlsService,this.pinnedWidthService=t.pinnedWidthService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnSizeService=t.columnSizeService,this.scrollVisibleService=t.scrollVisibleService,this.columnViewportService=t.columnViewportService}constructor(t){super(),this.centerContainerCtrl=t}postConstruct(){this.ctrlsService.whenReady(t=>{this.gridBodyCtrl=t.gridBodyCtrl,this.listenForResize()}),this.addManagedEventListeners({scrollbarWidthChanged:this.onScrollbarWidthChanged.bind(this)}),this.addManagedPropertyListeners(["alwaysShowHorizontalScroll","alwaysShowVerticalScroll"],()=>{this.checkViewportAndScrolls()})}listenForResize(){const t=()=>this.onCenterViewportResized();this.centerContainerCtrl.registerViewportResizeListener(t),this.gridBodyCtrl.registerBodyViewportResizeListener(t)}onScrollbarWidthChanged(){this.checkViewportAndScrolls()}onCenterViewportResized(){if(this.centerContainerCtrl.isViewportInTheDOMTree()){this.keepPinnedColumnsNarrowerThanViewport(),this.checkViewportAndScrolls();const t=this.centerContainerCtrl.getCenterWidth();t!==this.centerWidth&&(this.centerWidth=t,this.columnSizeService.refreshFlexedColumns({viewportWidth:this.centerWidth,updateBodyWidths:!0,fireResizedEvent:!0}))}else this.bodyHeight=0}keepPinnedColumnsNarrowerThanViewport(){const t=this.gridBodyCtrl.getBodyViewportElement(),e=VS(t);if(e<=50)return;let n=this.getPinnedColumnsOverflowingViewport(e-50);const i=this.gos.getCallback("processUnpinnedColumns");n.length&&(i&&(n=i({columns:n,viewportWidth:e})),this.columnModel.setColsPinned(n,null,"viewportSizeFeature"))}getPinnedColumnsOverflowingViewport(t){const e=this.pinnedWidthService.getPinnedRightWidth(),n=this.pinnedWidthService.getPinnedLeftWidth(),i=e+n;if(i<t)return[];const r=[...this.visibleColsService.getLeftCols()],o=[...this.visibleColsService.getRightCols()];let c=0,s=0;const f=0,v=[];let w=i-f-t;for(;(s<r.length||c<o.length)&&w>0;){if(c<o.length){const C=o[c++];w-=C.getActualWidth(),v.push(C)}if(s<r.length&&w>0){const C=r[s++];w-=C.getActualWidth(),v.push(C)}}return v}checkViewportAndScrolls(){this.updateScrollVisibleService(),this.checkBodyHeight(),this.onHorizontalViewportChanged(),this.gridBodyCtrl.getScrollFeature().checkScrollLeft()}getBodyHeight(){return this.bodyHeight}checkBodyHeight(){const t=this.gridBodyCtrl.getBodyViewportElement(),e=C3(t);if(this.bodyHeight!==e){this.bodyHeight=e;const n={type:"bodyHeightChanged"};this.eventService.dispatchEvent(n)}}updateScrollVisibleService(){this.updateScrollVisibleServiceImpl(),setTimeout(this.updateScrollVisibleServiceImpl.bind(this),500)}updateScrollVisibleServiceImpl(){const t={horizontalScrollShowing:this.isHorizontalScrollShowing(),verticalScrollShowing:this.gridBodyCtrl.isVerticalScrollShowing()};this.scrollVisibleService.setScrollsVisible(t)}isHorizontalScrollShowing(){return this.centerContainerCtrl.isHorizontalScrollShowing()}onHorizontalViewportChanged(){const t=this.centerContainerCtrl.getCenterWidth(),e=this.centerContainerCtrl.getViewportScrollLeft();this.columnViewportService.setScrollPosition(t,e)}},Vde=class extends wn{wireBeans(t){this.dragService=t.dragService,this.rangeService=t.rangeService}constructor(t){super(),this.eContainer=t}postConstruct(){if(!this.rangeService)return;this.params={eElement:this.eContainer,onDragStart:this.rangeService.onDragStart.bind(this.rangeService),onDragStop:this.rangeService.onDragStop.bind(this.rangeService),onDragging:this.rangeService.onDragging.bind(this.rangeService)},this.addManagedPropertyListener("enableRangeSelection",e=>{if(e.currentValue){this.enableFeature();return}this.disableFeature()}),this.addDestroyFunc(()=>this.disableFeature()),this.gos.get("enableRangeSelection")&&this.enableFeature()}enableFeature(){this.dragService.addDragSource(this.params)}disableFeature(){this.dragService.removeDragSource(this.params)}},Gde=class extends Js{constructor(){super(`
            <div class="ag-selection-checkbox" role="presentation">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[R3]),this.eCheckbox=qi}postConstruct(){this.eCheckbox.setPassive(!0)}getCheckboxId(){return this.eCheckbox.getInputElement().id}onDataChanged(){this.onSelectionChanged()}onSelectableChanged(){this.showOrHideSelect()}onSelectionChanged(){const t=this.localeService.getLocaleTextFunc(),e=this.rowNode.isSelected(),n=_3(t,e),[i,r]=this.rowNode.selectable?["ariaRowToggleSelection","Press Space to toggle row selection"]:["ariaRowSelectionDisabled","Row Selection is disabled for this row"],o=t(i,r);this.eCheckbox.setValue(e,!0),this.eCheckbox.setInputAriaLabel(`${o} (${n})`)}onClicked(t,e,n){return this.rowNode.setSelectedParams({newValue:t,rangeSelect:n.shiftKey,groupSelectsFiltered:e,event:n,source:"checkboxSelected"})}init(t){if(this.rowNode=t.rowNode,this.column=t.column,this.overrides=t.overrides,this.onSelectionChanged(),this.addManagedListeners(this.eCheckbox.getInputElement(),{dblclick:i=>tw(i),click:i=>{tw(i);const r=this.gos.get("groupSelectsFiltered"),o=this.eCheckbox.getValue();this.shouldHandleIndeterminateState(o,r)?this.onClicked(!0,r,i||{})===0&&this.onClicked(!1,r,i):o?this.onClicked(!1,r,i):this.onClicked(!0,r,i||{})}}),this.addManagedListeners(this.rowNode,{rowSelected:this.onSelectionChanged.bind(this),dataChanged:this.onDataChanged.bind(this),selectableChanged:this.onSelectableChanged.bind(this)}),this.gos.get("isRowSelectable")||typeof this.getIsVisible()=="function"){const i=this.showOrHideSelect.bind(this);this.addManagedEventListeners({displayedColumnsChanged:i}),this.addManagedListeners(this.rowNode,{dataChanged:i,cellChanged:i}),this.showOrHideSelect()}this.eCheckbox.getInputElement().setAttribute("tabindex","-1")}shouldHandleIndeterminateState(t,e){return e&&(this.eCheckbox.getPreviousValue()===void 0||t===void 0)&&this.gos.isRowModelType("clientSide")}showOrHideSelect(){var i,r,o;let t=this.rowNode.selectable;const e=this.getIsVisible();if(t)if(typeof e=="function"){const c=(i=this.overrides)==null?void 0:i.callbackParams;if(!this.column)t=e({...c,node:this.rowNode,data:this.rowNode.data});else{const s=this.column.createColumnFunctionCallbackParams(this.rowNode);t=e({...c,...s})}}else t=e??!1;if((r=this.column)==null?void 0:r.getColDef().showDisabledCheckboxes){this.eCheckbox.setDisabled(!t),this.setVisible(!0),this.setDisplayed(!0);return}if((o=this.overrides)!=null&&o.removeHidden){this.setDisplayed(t);return}this.setVisible(t)}getIsVisible(){var t,e;return this.overrides?this.overrides.isVisible:(e=(t=this.column)==null?void 0:t.getColDef())==null?void 0:e.checkboxSelection}},Hde=class extends Js{constructor(t,e,n){super('<div class="ag-drag-handle ag-row-drag" draggable="true"></div>'),this.rowNode=t,this.column=e,this.eCell=n}postConstruct(){this.getGui().appendChild(gu("rowDrag",this.gos,null)),this.addGuiEventListener("mousedown",e=>{e.stopPropagation()}),this.addDragSource(),this.checkVisibility()}addDragSource(){this.addGuiEventListener("dragstart",this.onDragStart.bind(this))}onDragStart(t){const e=this.column.getColDef().dndSourceOnRowDrag;t.dataTransfer.setDragImage(this.eCell,0,0);const n=()=>{try{const i=JSON.stringify(this.rowNode.data);t.dataTransfer.setData("application/json",i),t.dataTransfer.setData("text/plain",i)}catch{}};if(e){const i=this.gos.addGridCommonParams({rowNode:this.rowNode,dragEvent:t});e(i)}else n()}checkVisibility(){const t=this.column.isDndSource(this.rowNode);this.setDisplayed(t)}},Wde=class extends wn{constructor(t,e){super(),this.staticClasses=[],this.cellCtrl=t,this.beans=e,this.column=t.getColumn(),this.rowNode=t.getRowNode()}setComp(t){this.cellComp=t,this.applyUserStyles(),this.applyCellClassRules(),this.applyClassesFromColDef()}applyCellClassRules(){const t=this.column.getColDef(),{cellClassRules:e}=t,n=this.beans.gos.addGridCommonParams({value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,colDef:t,column:this.column,rowIndex:this.rowNode.rowIndex});this.beans.stylingService.processClassRules(e===this.cellClassRules?void 0:this.cellClassRules,e,n,i=>this.cellComp.addOrRemoveCssClass(i,!0),i=>this.cellComp.addOrRemoveCssClass(i,!1)),this.cellClassRules=e}applyUserStyles(){const t=this.column.getColDef();if(!t.cellStyle)return;let e;if(typeof t.cellStyle=="function"){const n=this.beans.gos.addGridCommonParams({column:this.column,value:this.cellCtrl.getValue(),colDef:t,data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex}),i=t.cellStyle;e=i(n)}else e=t.cellStyle;e&&this.cellComp.setUserStyles(e)}applyClassesFromColDef(){const t=this.column.getColDef(),e=this.beans.gos.addGridCommonParams({value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,column:this.column,colDef:t,rowIndex:this.rowNode.rowIndex});this.staticClasses.length&&this.staticClasses.forEach(n=>this.cellComp.addOrRemoveCssClass(n,!1)),this.staticClasses=this.beans.stylingService.getStaticCellClasses(t,e),this.staticClasses.length&&this.staticClasses.forEach(n=>this.cellComp.addOrRemoveCssClass(n,!0))}destroy(){super.destroy()}},jde=class extends wn{constructor(t,e,n,i,r){super(),this.cellCtrl=t,this.beans=e,this.rowNode=i,this.rowCtrl=r}setComp(t){this.eGui=t}onKeyDown(t){const e=t.key;switch(e){case mn.ENTER:this.onEnterKeyDown(t);break;case mn.F2:this.onF2KeyDown(t);break;case mn.ESCAPE:this.onEscapeKeyDown(t);break;case mn.TAB:this.onTabKeyDown(t);break;case mn.BACKSPACE:case mn.DELETE:this.onBackspaceOrDeleteKeyDown(e,t);break;case mn.DOWN:case mn.UP:case mn.RIGHT:case mn.LEFT:this.onNavigationKeyDown(t,e);break}}onNavigationKeyDown(t,e){this.cellCtrl.isEditing()||(t.shiftKey&&this.cellCtrl.isRangeSelectionEnabled()?this.onShiftRangeSelect(t):this.beans.navigationService.navigateToNextCell(t,e,this.cellCtrl.getCellPosition(),!0),t.preventDefault())}onShiftRangeSelect(t){if(!this.beans.rangeService)return;const e=this.beans.rangeService.extendLatestRangeInDirection(t);e&&this.beans.navigationService.ensureCellVisible(e)}onTabKeyDown(t){this.beans.navigationService.onTabKeyDown(this.cellCtrl,t)}onBackspaceOrDeleteKeyDown(t,e){const{cellCtrl:n,beans:i,rowNode:r}=this,{gos:o,rangeService:c,eventService:s}=i;if(!n.isEditing()){if(s.dispatchEvent({type:"keyShortcutChangedCellStart"}),Ehe(t,o.get("enableCellEditingOnBackspace"))){if(c&&o.get("enableRangeSelection"))c.clearCellRangeCellValues({dispatchWrapperEvents:!0,wrapperEventSource:"deleteKey"});else if(n.isCellEditable()){const f=n.getColumn(),v=this.beans.valueService.parseValue(f,r,"",r.getValueFromValueService(f))??null;r.setDataValue(f,v,"cellClear")}}else n.startRowOrCellEdit(t,e);s.dispatchEvent({type:"keyShortcutChangedCellEnd"})}}onEnterKeyDown(t){if(this.cellCtrl.isEditing()||this.rowCtrl.isEditing())this.cellCtrl.stopEditingAndFocus(!1,t.shiftKey);else if(this.beans.gos.get("enterNavigatesVertically")){const e=t.shiftKey?mn.UP:mn.DOWN;this.beans.navigationService.navigateToNextCell(null,e,this.cellCtrl.getCellPosition(),!1)}else this.cellCtrl.startRowOrCellEdit(mn.ENTER,t),this.cellCtrl.isEditing()&&t.preventDefault()}onF2KeyDown(t){this.cellCtrl.isEditing()||this.cellCtrl.startRowOrCellEdit(mn.F2,t)}onEscapeKeyDown(t){this.cellCtrl.isEditing()&&(this.cellCtrl.stopRowOrCellEdit(!0),this.cellCtrl.focusCell(!0))}processCharacter(t){if(t.target!==this.eGui||this.cellCtrl.isEditing())return;const i=t.key;i===" "?this.onSpaceKeyDown(t):(this.cellCtrl.startRowOrCellEdit(i,t),t.preventDefault())}onSpaceKeyDown(t){const{gos:e}=this.beans;if(!this.cellCtrl.isEditing()&&e.isRowSelection()){const n=this.rowNode.isSelected(),i=!n;if(i||!e.get("suppressRowDeselection")){const r=this.beans.gos.get("groupSelectsFiltered"),o=this.rowNode.setSelectedParams({newValue:i,rangeSelect:t.shiftKey,groupSelectsFiltered:r,event:t,source:"spaceKey"});n===void 0&&o===0&&this.rowNode.setSelectedParams({newValue:!1,rangeSelect:t.shiftKey,groupSelectsFiltered:r,event:t,source:"spaceKey"})}}t.preventDefault()}destroy(){super.destroy()}},$de=class extends wn{constructor(t,e,n){super(),this.cellCtrl=t,this.beans=e,this.column=n}onMouseEvent(t,e){if(!Yg(e))switch(t){case"click":this.onCellClicked(e);break;case"mousedown":case"touchstart":this.onMouseDown(e);break;case"dblclick":this.onCellDoubleClicked(e);break;case"mouseout":this.onMouseOut(e);break;case"mouseover":this.onMouseOver(e);break}}onCellClicked(t){if(this.isDoubleClickOnIPad()){this.onCellDoubleClicked(t),t.preventDefault();return}const{eventService:e,rangeService:n,gos:i}=this.beans,r=t.ctrlKey||t.metaKey;n&&r&&n.getCellRangeCount(this.cellCtrl.getCellPosition())>1&&n.intersectLastRange(!0);const o=this.cellCtrl.createEvent(t,"cellClicked");e.dispatchEvent(o);const c=this.column.getColDef();c.onCellClicked&&window.setTimeout(()=>{this.beans.frameworkOverrides.wrapOutgoing(()=>{c.onCellClicked(o)})},0),(i.get("singleClickEdit")||c.singleClickEdit)&&!i.get("suppressClickEdit")&&!(t.shiftKey&&(n==null?void 0:n.getCellRanges().length)!=0)&&this.cellCtrl.startRowOrCellEdit()}isDoubleClickOnIPad(){if(!wv()||Z$("dblclick"))return!1;const t=new Date().getTime(),e=t-this.lastIPadMouseClickEvent<200;return this.lastIPadMouseClickEvent=t,e}onCellDoubleClicked(t){const{column:e,beans:n,cellCtrl:i}=this,{eventService:r,frameworkOverrides:o,gos:c}=n,s=e.getColDef(),f=i.createEvent(t,"cellDoubleClicked");r.dispatchEvent(f),typeof s.onCellDoubleClicked=="function"&&window.setTimeout(()=>{o.wrapOutgoing(()=>{s.onCellDoubleClicked(f)})},0),!c.get("singleClickEdit")&&!c.get("suppressClickEdit")&&i.startRowOrCellEdit(null,t)}onMouseDown(t){const{ctrlKey:e,metaKey:n,shiftKey:i}=t,r=t.target,{cellCtrl:o,beans:c}=this,{eventService:s,rangeService:f,focusService:v,gos:w}=c;if(this.isRightClickInExistingRange(t))return;const C=f&&f.getCellRanges().length!=0;if(!i||!C){const F=w.get("enableCellTextSelection")&&t.defaultPrevented,N=(Qp()||F)&&!o.isEditing()&&!w3(r);o.focusCell(N)}if(i&&C&&!v.isCellFocused(o.getCellPosition())){t.preventDefault();const M=v.getFocusedCell();if(M){const{column:F,rowIndex:N,rowPinned:z}=M,L=c.rowRenderer.getRowByPosition({rowIndex:N,rowPinned:z}),P=L==null?void 0:L.getCellCtrl(F);P!=null&&P.isEditing()&&P.stopEditing(),v.setFocusedCell({column:F,rowIndex:N,rowPinned:z,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}}if(!this.containsWidget(r)){if(f){const M=this.cellCtrl.getCellPosition();if(i)f.extendLatestRangeToCell(M);else{const F=e||n;f.setRangeToCell(M,F)}}s.dispatchEvent(this.cellCtrl.createEvent(t,"cellMouseDown"))}}isRightClickInExistingRange(t){const{rangeService:e}=this.beans;if(e){const n=e.isCellInAnyRange(this.cellCtrl.getCellPosition()),i=t.button===2||t.ctrlKey&&this.beans.gos.get("allowContextMenuWithControlKey");if(n&&i)return!0}return!1}containsWidget(t){return Ax(t,"ag-selection-checkbox",3)}onMouseOut(t){if(this.mouseStayingInsideCell(t))return;const e=this.cellCtrl.createEvent(t,"cellMouseOut");this.beans.eventService.dispatchEvent(e),this.beans.columnHoverService.clearMouseOver()}onMouseOver(t){if(this.mouseStayingInsideCell(t))return;const e=this.cellCtrl.createEvent(t,"cellMouseOver");this.beans.eventService.dispatchEvent(e),this.beans.columnHoverService.setMouseOver([this.column])}mouseStayingInsideCell(t){if(!t.target||!t.relatedTarget)return!1;const e=this.cellCtrl.getGui(),n=e.contains(t.target),i=e.contains(t.relatedTarget);return n&&i}destroy(){super.destroy()}},qde=class extends wn{constructor(t,e){super(),this.cellCtrl=t,this.beans=e,this.column=t.getColumn(),this.rowNode=t.getRowNode()}setupRowSpan(){this.rowSpan=this.column.getRowSpan(this.rowNode),this.addManagedListeners(this.beans.eventService,{newColumnsLoaded:()=>this.onNewColumnsLoaded()})}setComp(t){this.eGui=t,this.setupColSpan(),this.setupRowSpan(),this.onLeftChanged(),this.onWidthChanged(),this.applyRowSpan()}onNewColumnsLoaded(){const t=this.column.getRowSpan(this.rowNode);this.rowSpan!==t&&(this.rowSpan=t,this.applyRowSpan(!0))}onDisplayColumnsChanged(){const t=this.getColSpanningList();k_(this.colsSpanning,t)||(this.colsSpanning=t,this.onWidthChanged(),this.onLeftChanged())}setupColSpan(){this.column.getColDef().colSpan!=null&&(this.colsSpanning=this.getColSpanningList(),this.addManagedListeners(this.beans.eventService,{displayedColumnsChanged:this.onDisplayColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onWidthChanged.bind(this)}))}onWidthChanged(){if(!this.eGui)return;const t=this.getCellWidth();this.eGui.style.width=`${t}px`}getCellWidth(){return this.colsSpanning?this.colsSpanning.reduce((t,e)=>t+e.getActualWidth(),0):this.column.getActualWidth()}getColSpanningList(){const t=this.column.getColSpan(this.rowNode),e=[];if(t===1)e.push(this.column);else{let n=this.column;const i=this.column.getPinned();for(let r=0;n&&r<t&&(e.push(n),n=this.beans.visibleColsService.getColAfter(n),!(!n||Hr(n)||i!==n.getPinned()));r++);}return e}onLeftChanged(){if(!this.eGui)return;const t=this.modifyLeftForPrintLayout(this.getCellLeft());this.eGui.style.left=t+"px"}getCellLeft(){let t;return this.beans.gos.get("enableRtl")&&this.colsSpanning?t=Yr(this.colsSpanning):t=this.column,t.getLeft()}modifyLeftForPrintLayout(t){if(!this.cellCtrl.isPrintLayout()||this.column.getPinned()==="left")return t;const e=this.beans.visibleColsService.getColsLeftWidth();if(this.column.getPinned()==="right"){const n=this.beans.visibleColsService.getBodyContainerWidth();return e+n+(t||0)}return e+(t||0)}applyRowSpan(t){if(this.rowSpan===1&&!t)return;const n=this.beans.gos.getRowHeightAsNumber()*this.rowSpan;this.eGui.style.height=`${n}px`,this.eGui.style.zIndex="1"}destroy(){super.destroy()}},kC="ag-cell-range-selected",Zde="ag-cell-range-chart",Xde="ag-cell-range-single-cell",Kde="ag-cell-range-chart-category",Yde="ag-cell-range-handle",Jde="ag-cell-range-top",Qde="ag-cell-range-right",efe="ag-cell-range-bottom",tfe="ag-cell-range-left",nfe=class{constructor(t,e){this.beans=t,this.rangeService=t.rangeService,this.selectionHandleFactory=t.selectionHandleFactory,this.cellCtrl=e}setComp(t,e){this.cellComp=t,this.eGui=e,this.onRangeSelectionChanged()}onRangeSelectionChanged(){this.cellComp&&(this.rangeCount=this.rangeService.getCellRangeCount(this.cellCtrl.getCellPosition()),this.hasChartRange=this.getHasChartRange(),this.cellComp.addOrRemoveCssClass(kC,this.rangeCount!==0),this.cellComp.addOrRemoveCssClass(`${kC}-1`,this.rangeCount===1),this.cellComp.addOrRemoveCssClass(`${kC}-2`,this.rangeCount===2),this.cellComp.addOrRemoveCssClass(`${kC}-3`,this.rangeCount===3),this.cellComp.addOrRemoveCssClass(`${kC}-4`,this.rangeCount>=4),this.cellComp.addOrRemoveCssClass(Zde,this.hasChartRange),nT(this.eGui,this.rangeCount>0?!0:void 0),this.cellComp.addOrRemoveCssClass(Xde,this.isSingleCell()),this.updateRangeBorders(),this.refreshHandle())}updateRangeBorders(){const t=this.getRangeBorders(),e=this.isSingleCell(),n=!e&&t.top,i=!e&&t.right,r=!e&&t.bottom,o=!e&&t.left;this.cellComp.addOrRemoveCssClass(Jde,n),this.cellComp.addOrRemoveCssClass(Qde,i),this.cellComp.addOrRemoveCssClass(efe,r),this.cellComp.addOrRemoveCssClass(tfe,o)}isSingleCell(){const{rangeService:t}=this.beans;return this.rangeCount===1&&!!t&&!t.isMoreThanOneCell()}getHasChartRange(){const{rangeService:t}=this.beans;if(!this.rangeCount||!t)return!1;const e=t.getCellRanges();return e.length>0&&e.every(n=>t_([1,0],n.type))}updateRangeBordersIfRangeCount(){this.rangeCount>0&&(this.updateRangeBorders(),this.refreshHandle())}getRangeBorders(){const t=this.beans.gos.get("enableRtl");let e=!1,n=!1,i=!1,r=!1;const o=this.cellCtrl.getCellPosition().column,c=this.beans.visibleColsService;let s,f;t?(s=c.getColAfter(o),f=c.getColBefore(o)):(s=c.getColBefore(o),f=c.getColAfter(o));const v=this.rangeService.getCellRanges().filter(w=>this.rangeService.isCellInSpecificRange(this.cellCtrl.getCellPosition(),w));s||(r=!0),f||(n=!0);for(let w=0;w<v.length&&!(e&&n&&i&&r);w++){const C=v[w],M=this.rangeService.getRangeStartRow(C),F=this.rangeService.getRangeEndRow(C);!e&&this.beans.rowPositionUtils.sameRow(M,this.cellCtrl.getCellPosition())&&(e=!0),!i&&this.beans.rowPositionUtils.sameRow(F,this.cellCtrl.getCellPosition())&&(i=!0),!r&&s&&C.columns.indexOf(s)<0&&(r=!0),!n&&f&&C.columns.indexOf(f)<0&&(n=!0)}return{top:e,right:n,bottom:i,left:r}}refreshHandle(){if(this.beans.context.isDestroyed())return;const t=this.shouldHaveSelectionHandle();this.selectionHandle&&!t&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),t&&this.addSelectionHandle(),this.cellComp.addOrRemoveCssClass(Yde,!!this.selectionHandle)}shouldHaveSelectionHandle(){const t=this.beans.gos,e=this.rangeService.getCellRanges(),n=e.length;if(this.rangeCount<1||n<1)return!1;const i=Yr(e),r=this.cellCtrl.getCellPosition(),o=t.get("enableFillHandle")&&!this.cellCtrl.isSuppressFillHandle(),c=t.get("enableRangeHandle");let s=n===1&&!this.cellCtrl.isEditing()&&(o||c);if(this.hasChartRange){const v=e[0].type===1&&this.rangeService.isCellInSpecificRange(r,e[0]);this.cellComp.addOrRemoveCssClass(Kde,v),s=i.type===0}return s&&i.endRow!=null&&this.rangeService.isContiguousRange(i)&&this.rangeService.isBottomRightCell(i,r)}addSelectionHandle(){const t=this.beans.gos,e=Yr(this.rangeService.getCellRanges()).type,i=t.get("enableFillHandle")&&Hr(e)?0:1;this.selectionHandle&&this.selectionHandle.getType()!==i&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),this.selectionHandle||(this.selectionHandle=this.selectionHandleFactory.createSelectionHandle(i)),this.selectionHandle.refresh(this.cellCtrl)}destroy(){this.beans.context.destroyBean(this.selectionHandle)}},ife="ag-cell",rfe="ag-cell-auto-height",sfe="ag-cell-normal-height",ofe="ag-cell-focus",afe="ag-cell-first-right-pinned",lfe="ag-cell-last-left-pinned",cfe="ag-cell-not-inline-editing",ufe="ag-column-hover",hfe="ag-cell-wrap-text",dfe=0,iq=class DL extends wn{constructor(e,n,i,r){super(),this.column=e,this.rowNode=n,this.beans=i,this.rowCtrl=r,this.cellRangeFeature=null,this.cellPositionFeature=null,this.cellCustomStyleFeature=null,this.tooltipFeature=null,this.cellMouseListenerFeature=null,this.cellKeyboardListenerFeature=null,this.suppressRefreshCell=!1,this.onCellCompAttachedFuncs=[],this.instanceId=e.getId()+"-"+dfe++,this.colIdSanitised=wf(this.column.getId()),i.gos.get("suppressCellFocus")||(this.tabIndex=-1),this.createCellPosition(),this.addFeatures(),this.updateAndFormatValue(!1)}shouldRestoreFocus(){return this.beans.focusService.shouldRestoreFocus(this.cellPosition)}addFeatures(){this.cellPositionFeature=new qde(this,this.beans),this.addDestroyFunc(()=>{var n;(n=this.cellPositionFeature)==null||n.destroy(),this.cellPositionFeature=null}),this.cellCustomStyleFeature=new Wde(this,this.beans),this.addDestroyFunc(()=>{var n;(n=this.cellCustomStyleFeature)==null||n.destroy(),this.cellCustomStyleFeature=null}),this.cellMouseListenerFeature=new $de(this,this.beans,this.column),this.addDestroyFunc(()=>{var n;(n=this.cellMouseListenerFeature)==null||n.destroy(),this.cellMouseListenerFeature=null}),this.cellKeyboardListenerFeature=new jde(this,this.beans,this.column,this.rowNode,this.rowCtrl),this.addDestroyFunc(()=>{var n;(n=this.cellKeyboardListenerFeature)==null||n.destroy(),this.cellKeyboardListenerFeature=null}),this.column.isTooltipEnabled()&&(this.enableTooltipFeature(),this.addDestroyFunc(()=>{this.disableTooltipFeature()})),this.beans.rangeService&&this.beans.gos.get("enableRangeSelection")&&(this.cellRangeFeature=new nfe(this.beans,this),this.addDestroyFunc(()=>{var n;(n=this.cellRangeFeature)==null||n.destroy(),this.cellRangeFeature=null}))}enableTooltipFeature(e,n){const i=()=>{const c=this.column.getColDef(),s=this.rowNode.data;if(c.tooltipField&&$n(s))return w1(s,c.tooltipField,this.column.isTooltipFieldContainsDots());const f=c.tooltipValueGetter;return f?f(this.beans.gos.addGridCommonParams({location:"cell",colDef:this.column.getColDef(),column:this.column,rowIndex:this.cellPosition.rowIndex,node:this.rowNode,data:this.rowNode.data,value:this.value,valueFormatted:this.valueFormatted})):null},r=this.beans.gos.get("tooltipShowMode")==="whenTruncated";!n&&r&&!this.isCellRenderer()&&(n=()=>{const c=this.getGui(),s=c.children.length===0?c:c.querySelector(".ag-cell-value");return s?s.scrollWidth>s.clientWidth:!0});const o={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getRowIndex:()=>this.cellPosition.rowIndex,getRowNode:()=>this.rowNode,getGui:()=>this.getGui(),getLocation:()=>"cell",getTooltipValue:e!=null?()=>e:i,getValueFormatted:()=>this.valueFormatted,shouldDisplayTooltip:n};this.tooltipFeature=new Sw(o,this.beans)}disableTooltipFeature(){this.tooltipFeature&&(this.tooltipFeature.destroy(),this.tooltipFeature=null)}setComp(e,n,i,r,o){var c,s,f,v;this.cellComp=e,this.eGui=n,this.printLayout=r,this.addDomData(),this.onCellFocused(this.focusEventToRestore),this.applyStaticCssClasses(),this.setWrapText(),this.onFirstRightPinnedChanged(),this.onLastLeftPinnedChanged(),this.onColumnHover(),this.setupControlComps(),this.setupAutoHeight(i),this.refreshFirstAndLastStyles(),this.refreshAriaColIndex(),(c=this.cellPositionFeature)==null||c.setComp(n),(s=this.cellCustomStyleFeature)==null||s.setComp(e),(f=this.tooltipFeature)==null||f.refreshToolTip(),(v=this.cellKeyboardListenerFeature)==null||v.setComp(this.eGui),this.cellRangeFeature&&this.cellRangeFeature.setComp(e,n),o&&this.isCellEditable()?this.startEditing():this.showValue(),this.onCellCompAttachedFuncs.length&&(this.onCellCompAttachedFuncs.forEach(w=>w()),this.onCellCompAttachedFuncs=[])}setupAutoHeight(e){if(this.isAutoHeight=this.column.isAutoHeight(),!this.isAutoHeight||!e)return;const n=e.parentElement,i=this.beans.gos.getRowHeightForNode(this.rowNode).height,r=s=>{if(this.editing||!this.isAlive())return;const{paddingTop:f,paddingBottom:v,borderBottomWidth:w,borderTopWidth:C}=N_(n),M=f+v+w+C,N=e.offsetHeight+M;if(s<5){const L=this.beans.gos.getDocument(),P=!L||!L.contains(e),H=N==0;if(P||H){window.setTimeout(()=>r(s+1),0);return}}const z=Math.max(N,i);this.rowNode.setRowAutoHeight(z,this.column)},o=()=>r(0);o();const c=this.beans.resizeObserverService.observeResize(e,o);this.addDestroyFunc(()=>{c(),this.rowNode.setRowAutoHeight(void 0,this.column)})}getCellAriaRole(){return this.column.getColDef().cellAriaRole??"gridcell"}getInstanceId(){return this.instanceId}getColumnIdSanitised(){return this.colIdSanitised}getTabIndex(){return this.tabIndex}isCellRenderer(){const e=this.column.getColDef();return e.cellRenderer!=null||e.cellRendererSelector!=null}getValueToDisplay(){return this.valueFormatted??this.value}showValue(e=!1){var r;const n=this.getValueToDisplay();let i;if(this.rowNode.stub){const o=this.createCellRendererParams();i=this.beans.userComponentFactory.getLoadingCellRendererDetails(this.column.getColDef(),o)}else if(this.isCellRenderer()){const o=this.createCellRendererParams();i=this.beans.userComponentFactory.getCellRendererDetails(this.column.getColDef(),o)}this.cellComp.setRenderDetails(i,n,e),(r=this.cellRangeFeature)==null||r.refreshHandle()}setupControlComps(){const e=this.column.getColDef();this.includeSelection=this.isIncludeControl(e.checkboxSelection),this.includeRowDrag=this.isIncludeControl(e.rowDrag),this.includeDndSource=this.isIncludeControl(e.dndSource),this.cellComp.setIncludeSelection(this.includeSelection),this.cellComp.setIncludeDndSource(this.includeDndSource),this.cellComp.setIncludeRowDrag(this.includeRowDrag)}isForceWrapper(){return this.beans.gos.get("enableCellTextSelection")||this.column.isAutoHeight()}isIncludeControl(e){return this.rowNode.rowPinned!=null?!1:typeof e=="function"||e===!0}refreshShouldDestroy(){const e=this.column.getColDef(),n=this.includeSelection!=this.isIncludeControl(e.checkboxSelection),i=this.includeRowDrag!=this.isIncludeControl(e.rowDrag),r=this.includeDndSource!=this.isIncludeControl(e.dndSource),o=this.isAutoHeight!=this.column.isAutoHeight();return n||i||r||o}startEditing(e=null,n=!1,i=null){const{editService:r}=this.beans;if(!(!this.isCellEditable()||this.editing||!r)){if(!this.cellComp){this.onCellCompAttachedFuncs.push(()=>{this.startEditing(e,n,i)});return}r.startEditing(this,e,n,i)}}setEditing(e,n){var i;this.editCompDetails=n,this.editing!==e&&(this.editing=e,(i=this.cellRangeFeature)==null||i.refreshHandle())}stopRowOrCellEdit(e=!1){this.beans.gos.get("editType")==="fullRow"?this.rowCtrl.stopEditing(e):this.stopEditing(e)}onPopupEditorClosed(){this.editing&&this.stopEditingAndFocus()}stopEditing(e=!1){const{editService:n}=this.beans;return!this.editing||!n?!1:n.stopEditing(this,e)}createCellRendererParams(){return this.beans.gos.addGridCommonParams({value:this.value,valueFormatted:this.valueFormatted,getValue:()=>this.rowNode.getValueFromValueService(this.column),setValue:n=>this.beans.valueService.setValue(this.rowNode,this.column,n),formatValue:this.formatValue.bind(this),data:this.rowNode.data,node:this.rowNode,pinned:this.column.getPinned(),colDef:this.column.getColDef(),column:this.column,refreshCell:this.refreshCell.bind(this),eGridCell:this.getGui(),eParentOfValue:this.cellComp.getParentOfValue(),registerRowDragger:(n,i,r,o)=>this.registerRowDragger(n,i,o),setTooltip:(n,i)=>{var r;this.tooltipFeature&&this.disableTooltipFeature(),this.enableTooltipFeature(n,i),(r=this.tooltipFeature)==null||r.refreshToolTip()}})}setFocusOutOnEditor(){var e;this.editing&&((e=this.beans.editService)==null||e.setFocusOutOnEditor(this))}setFocusInOnEditor(){var e;this.editing&&((e=this.beans.editService)==null||e.setFocusInOnEditor(this))}onCellChanged(e){e.column===this.column&&this.refreshCell({})}refreshOrDestroyCell(e){var n;this.refreshShouldDestroy()?(n=this.rowCtrl)==null||n.recreateCell(this):this.refreshCell(e)}refreshCell(e){var w,C,M,F,N;if(this.suppressRefreshCell||this.editing)return;const n=this.column.getColDef(),i=e!=null&&!!e.newData,r=e!=null&&!!e.suppressFlash||!!n.suppressCellFlash,o=n.field==null&&n.valueGetter==null&&n.showRowGroup==null,c=e&&e.forceRefresh||o||i,s=!!this.cellComp,f=this.updateAndFormatValue(s),v=c||f;if(s){if(v){this.showValue(i);const z=(w=this.beans.filterManager)==null?void 0:w.isSuppressFlashingCellsBecauseFiltering();!r&&!z&&(this.beans.gos.get("enableCellChangeFlash")||n.enableCellChangeFlash)&&this.flashCell(),(C=this.cellCustomStyleFeature)==null||C.applyUserStyles(),(M=this.cellCustomStyleFeature)==null||M.applyClassesFromColDef()}(F=this.tooltipFeature)==null||F.refreshToolTip(),(N=this.cellCustomStyleFeature)==null||N.applyCellClassRules()}}stopEditingAndFocus(e=!1,n=!1){var i;(i=this.beans.editService)==null||i.stopEditingAndFocus(this,e,n)}flashCell(e){const n=(e==null?void 0:e.flashDuration)??(e==null?void 0:e.flashDelay),i=(e==null?void 0:e.fadeDuration)??(e==null?void 0:e.fadeDelay);this.animateCell("data-changed",n,i)}animateCell(e,n,i){if(!this.cellComp)return;const r=`ag-cell-${e}`,o=`ag-cell-${e}-animation`,{gos:c}=this.beans;n||(n=c.get("cellFlashDuration")),$n(i)||(i=c.get("cellFadeDuration")),this.cellComp.addOrRemoveCssClass(r,!0),this.cellComp.addOrRemoveCssClass(o,!1),this.beans.frameworkOverrides.wrapIncoming(()=>{window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(r,!1),this.cellComp.addOrRemoveCssClass(o,!0),this.eGui.style.transition=`background-color ${i}ms`,window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(o,!1),this.eGui.style.transition="")},i))},n)})}onFlashCells(e){if(!this.cellComp)return;const n=this.beans.cellPositionUtils.createId(this.getCellPosition());e.cells[n]&&this.animateCell("highlight")}isCellEditable(){return this.column.isCellEditable(this.rowNode)}isSuppressFillHandle(){return this.column.isSuppressFillHandle()}formatValue(e){return this.callValueFormatter(e)??e}callValueFormatter(e){return this.beans.valueService.formatValue(this.column,this.rowNode,e)}updateAndFormatValue(e){const n=this.value,i=this.valueFormatted;return this.value=this.rowNode.getValueFromValueService(this.column),this.valueFormatted=this.callValueFormatter(this.value),e?!this.valuesAreEqual(n,this.value)||this.valueFormatted!=i:!0}valuesAreEqual(e,n){const i=this.column.getColDef();return i.equals?i.equals(e,n):e===n}getComp(){return this.cellComp}getValue(){return this.value}addDomData(){const e=this.getGui();this.beans.gos.setDomData(e,DL.DOM_DATA_KEY_CELL_CTRL,this),this.addDestroyFunc(()=>this.beans.gos.setDomData(e,DL.DOM_DATA_KEY_CELL_CTRL,null))}createEvent(e,n){return this.beans.gos.addGridCommonParams({type:n,node:this.rowNode,data:this.rowNode.data,value:this.value,column:this.column,colDef:this.column.getColDef(),rowPinned:this.rowNode.rowPinned,event:e,rowIndex:this.rowNode.rowIndex})}processCharacter(e){var n;(n=this.cellKeyboardListenerFeature)==null||n.processCharacter(e)}onKeyDown(e){var n;(n=this.cellKeyboardListenerFeature)==null||n.onKeyDown(e)}onMouseEvent(e,n){var i;(i=this.cellMouseListenerFeature)==null||i.onMouseEvent(e,n)}getGui(){return this.eGui}getColSpanningList(){return this.cellPositionFeature.getColSpanningList()}onLeftChanged(){var e;this.cellComp&&((e=this.cellPositionFeature)==null||e.onLeftChanged())}onDisplayedColumnsChanged(){this.eGui&&(this.refreshAriaColIndex(),this.refreshFirstAndLastStyles())}refreshFirstAndLastStyles(){const{cellComp:e,column:n,beans:i}=this;$7(e,n,i.visibleColsService)}refreshAriaColIndex(){const e=this.beans.visibleColsService.getAriaColIndex(this.column);o7(this.getGui(),e)}isSuppressNavigable(){return this.column.isSuppressNavigable(this.rowNode)}onWidthChanged(){var e;return(e=this.cellPositionFeature)==null?void 0:e.onWidthChanged()}getColumn(){return this.column}getRowNode(){return this.rowNode}isPrintLayout(){return this.printLayout}getCellPosition(){return this.cellPosition}isEditing(){return this.editing}startRowOrCellEdit(e,n=null){if(!this.cellComp){this.onCellCompAttachedFuncs.push(()=>{this.startRowOrCellEdit(e,n)});return}this.beans.gos.get("editType")==="fullRow"?this.rowCtrl.startRowEditing(e,this):this.startEditing(e,!0,n)}getRowCtrl(){return this.rowCtrl}getRowPosition(){return{rowIndex:this.cellPosition.rowIndex,rowPinned:this.cellPosition.rowPinned}}updateRangeBordersIfRangeCount(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.updateRangeBordersIfRangeCount()}onRangeSelectionChanged(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()}isRangeSelectionEnabled(){return this.cellRangeFeature!=null}focusCell(e=!1){this.beans.focusService.setFocusedCell({rowIndex:this.getCellPosition().rowIndex,column:this.column,rowPinned:this.rowNode.rowPinned,forceBrowserFocus:e})}onRowIndexChanged(){this.createCellPosition(),this.onCellFocused(),this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()}onFirstRightPinnedChanged(){if(!this.cellComp)return;const e=this.column.isFirstRightPinned();this.cellComp.addOrRemoveCssClass(afe,e)}onLastLeftPinnedChanged(){if(!this.cellComp)return;const e=this.column.isLastLeftPinned();this.cellComp.addOrRemoveCssClass(lfe,e)}onCellFocused(e){if(this.beans.gos.get("suppressCellFocus"))return;const n=this.beans.focusService.isCellFocused(this.cellPosition);if(!this.cellComp){n&&(e!=null&&e.forceBrowserFocus)&&(this.focusEventToRestore=e);return}if(this.focusEventToRestore=void 0,this.cellComp.addOrRemoveCssClass(ofe,n),n&&e&&e.forceBrowserFocus){let r=this.cellComp.getFocusableElement();if(this.editing){const o=this.beans.focusService.findFocusableElements(r,null,!0);o.length&&(r=o[0])}r.focus({preventScroll:!!e.preventScrollOnBrowserFocus})}const i=this.beans.gos.get("editType")==="fullRow";!n&&!i&&this.editing&&this.stopRowOrCellEdit(),n&&this.rowCtrl.announceDescription()}createCellPosition(){this.cellPosition={rowIndex:this.rowNode.rowIndex,rowPinned:n_(this.rowNode.rowPinned),column:this.column}}applyStaticCssClasses(){this.cellComp.addOrRemoveCssClass(ife,!0),this.cellComp.addOrRemoveCssClass(cfe,!0);const e=this.column.isAutoHeight()==!0;this.cellComp.addOrRemoveCssClass(rfe,e),this.cellComp.addOrRemoveCssClass(sfe,!e)}onColumnHover(){if(!this.cellComp||!this.beans.gos.get("columnHoverHighlight"))return;const e=this.beans.columnHoverService.isHovered(this.column);this.cellComp.addOrRemoveCssClass(ufe,e)}onColDefChanged(){var n;if(!this.cellComp)return;this.column.isTooltipEnabled()?(this.disableTooltipFeature(),this.enableTooltipFeature()):this.disableTooltipFeature(),this.setWrapText(),this.editing?(n=this.beans.editService)==null||n.handleColDefChanged(this):this.refreshOrDestroyCell({forceRefresh:!0,suppressFlash:!0})}setWrapText(){const e=this.column.getColDef().wrapText==!0;this.cellComp.addOrRemoveCssClass(hfe,e)}dispatchCellContextMenuEvent(e){const n=this.column.getColDef(),i=this.createEvent(e,"cellContextMenu");this.beans.eventService.dispatchEvent(i),n.onCellContextMenu&&window.setTimeout(()=>{this.beans.frameworkOverrides.wrapOutgoing(()=>{n.onCellContextMenu(i)})},0)}getCellRenderer(){return this.cellComp?this.cellComp.getCellRenderer():null}getCellEditor(){return this.cellComp?this.cellComp.getCellEditor():null}destroy(){this.onCellCompAttachedFuncs=[],super.destroy()}createSelectionCheckbox(){const e=new Gde;return this.beans.context.createBean(e),e.init({rowNode:this.rowNode,column:this.column}),e}createDndSource(){const e=new Hde(this.rowNode,this.column,this.eGui);return this.beans.context.createBean(e),e}registerRowDragger(e,n,i){if(this.customRowDragComp){this.customRowDragComp.setDragElement(e,n);return}const r=this.createRowDragComp(e,n,i);r&&(this.customRowDragComp=r,this.addDestroyFunc(()=>{this.beans.context.destroyBean(r),this.customRowDragComp=null}))}createRowDragComp(e,n,i){const r=this.beans.gos.get("pagination"),o=this.beans.gos.get("rowDragManaged"),c=this.beans.gos.isRowModelType("clientSide");if(o){if(!c){Tn("managed row dragging is only allowed in the Client Side Row Model");return}if(r){Tn("managed row dragging is not possible when doing pagination");return}}const s=new TL(()=>this.value,this.rowNode,this.column,e,n,i);return this.beans.context.createBean(s),s}setSuppressRefreshCell(e){this.suppressRefreshCell=e}getEditCompDetails(){return this.editCompDetails}};iq.DOM_DATA_KEY_CELL_CTRL="cellCtrl";var r_=iq,ffe=0,rq=class FL extends wn{constructor(e,n,i,r,o){var c;super(),this.allRowGuis=[],this.active=!0,this.centerCellCtrls={list:[],map:{}},this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}},this.slideInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.fadeInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.rowDragComps=[],this.lastMouseDownOnDragger=!1,this.emptyStyle={},this.updateColumnListsPending=!1,this.rowId=null,this.businessKeySanitised=null,this.beans=n,this.gos=n.gos,this.rowNode=e,this.paginationPage=((c=n.paginationService)==null?void 0:c.getCurrentPage())??0,this.useAnimationFrameForCreate=r,this.printLayout=o,this.suppressRowTransform=this.gos.get("suppressRowTransform"),this.instanceId=e.id+"-"+ffe++,this.rowId=wf(e.id),this.initRowBusinessKey(),this.rowFocused=n.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned),this.rowLevel=n.rowCssClassCalculator.calculateRowLevel(this.rowNode),this.setRowType(),this.setAnimateFlags(i),this.rowStyles=this.processStylesFromGridOptions(),this.isFullWidth()&&!this.gos.get("suppressCellFocus")&&(this.tabIndex=-1),this.addListeners()}initRowBusinessKey(){this.businessKeyForNodeFunc=this.gos.get("getBusinessKeyForNode"),this.updateRowBusinessKey()}updateRowBusinessKey(){if(typeof this.businessKeyForNodeFunc!="function")return;const e=this.businessKeyForNodeFunc(this.rowNode);this.businessKeySanitised=wf(e)}getRowId(){return this.rowId}getRowStyles(){return this.rowStyles}getTabIndex(){return this.tabIndex}isSticky(){return this.rowNode.sticky}getInstanceId(){return this.instanceId}updateGui(e,n){e==="left"?this.leftGui=n:e==="right"?this.rightGui=n:e==="fullWidth"?this.fullWidthGui=n:this.centerGui=n}setComp(e,n,i){const r={rowComp:e,element:n,containerType:i};this.allRowGuis.push(r),this.updateGui(i,r),this.initialiseRowComp(r),this.rowType!=="FullWidthLoading"&&!this.rowNode.rowPinned&&this.beans.rowRenderer.dispatchFirstDataRenderedEvent()}unsetComp(e){this.allRowGuis=this.allRowGuis.filter(n=>n.containerType!==e),this.updateGui(e,void 0)}isCacheable(){return this.rowType==="FullWidthDetail"&&this.gos.get("keepDetailRows")}setCached(e){const n=e?"none":"";this.allRowGuis.forEach(i=>i.element.style.display=n)}initialiseRowComp(e){const n=this.gos;this.listenOnDomOrder(e),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights(),this.onRowHeightChanged(e),this.updateRowIndexes(e),this.setFocusedClasses(e),this.setStylesFromGridOptions(!1,e),n.isRowSelection()&&this.rowNode.selectable&&this.onRowSelected(e),this.updateColumnLists(!this.useAnimationFrameForCreate);const i=e.rowComp;this.getInitialRowClasses(e.containerType).forEach(o=>i.addOrRemoveCssClass(o,!0)),this.executeSlideAndFadeAnimations(e),this.rowNode.group&&tT(e.element,this.rowNode.expanded==!0),this.setRowCompRowId(i),this.setRowCompRowBusinessKey(i),n.setDomData(e.element,FL.DOM_DATA_KEY_ROW_CTRL,this),this.addDestroyFunc(()=>n.setDomData(e.element,FL.DOM_DATA_KEY_ROW_CTRL,null)),this.useAnimationFrameForCreate?this.beans.animationFrameService.createTask(this.addHoverFunctionality.bind(this,e.element),this.rowNode.rowIndex,"createTasksP2"):this.addHoverFunctionality(e.element),this.isFullWidth()&&this.setupFullWidth(e),n.get("rowDragEntireRow")&&this.addRowDraggerToRow(e),this.useAnimationFrameForCreate&&this.beans.animationFrameService.addDestroyTask(()=>{this.isAlive()&&e.rowComp.addOrRemoveCssClass("ag-after-created",!0)}),this.executeProcessRowPostCreateFunc()}setRowCompRowBusinessKey(e){this.businessKeySanitised!=null&&e.setRowBusinessKey(this.businessKeySanitised)}getBusinessKey(){return this.businessKeySanitised}setRowCompRowId(e){this.rowId=wf(this.rowNode.id),this.rowId!=null&&e.setRowId(this.rowId)}executeSlideAndFadeAnimations(e){const{containerType:n}=e;this.slideInAnimation[n]&&(U5(()=>{this.onTopChanged()}),this.slideInAnimation[n]=!1),this.fadeInAnimation[n]&&(U5(()=>{e.rowComp.addOrRemoveCssClass("ag-opacity-zero",!1)}),this.fadeInAnimation[n]=!1)}addRowDraggerToRow(e){if(this.gos.get("enableRangeSelection")){Tn("Setting `rowDragEntireRow: true` in the gridOptions doesn't work with `enableRangeSelection: true`");return}const n=this.beans.localeService.getLocaleTextFunc(),i=new TL(()=>`1 ${n("rowDragRow","row")}`,this.rowNode,void 0,e.element,void 0,!0),r=this.createBean(i,this.beans.context);this.rowDragComps.push(r)}setupFullWidth(e){const n=this.getPinnedForContainer(e.containerType);if(this.rowType=="FullWidthDetail"&&!xl.__assertRegistered("@ag-grid-enterprise/master-detail","cell renderer 'agDetailCellRenderer' (for master detail)",this.beans.context.getGridId()))return;const i=this.createFullWidthCompDetails(e.element,n);e.rowComp.showFullWidth(i)}isPrintLayout(){return this.printLayout}getFullWidthCellRenderers(){var e,n;return this.gos.get("embedFullWidthRows")?this.allRowGuis.map(i=>{var r;return(r=i==null?void 0:i.rowComp)==null?void 0:r.getFullWidthCellRenderer()}):[(n=(e=this.fullWidthGui)==null?void 0:e.rowComp)==null?void 0:n.getFullWidthCellRenderer()]}getCellElement(e){const n=this.getCellCtrl(e);return n?n.getGui():null}executeProcessRowPostCreateFunc(){const e=this.gos.getCallback("processRowPostCreate");if(!e||!this.areAllContainersReady())return;const n={eRow:this.centerGui.element,ePinnedLeftRow:this.leftGui?this.leftGui.element:void 0,ePinnedRightRow:this.rightGui?this.rightGui.element:void 0,node:this.rowNode,rowIndex:this.rowNode.rowIndex,addRenderedRowListener:this.addEventListener.bind(this)};e(n)}areAllContainersReady(){const e=!!this.leftGui||!this.beans.visibleColsService.isPinningLeft(),n=!!this.centerGui,i=!!this.rightGui||!this.beans.visibleColsService.isPinningRight();return e&&n&&i}setRowType(){const e=this.rowNode.stub&&!this.gos.get("suppressServerSideFullWidthLoadingRow"),n=this.rowNode.isFullWidthCell(),i=this.gos.get("masterDetail")&&this.rowNode.detail,r=this.beans.columnModel.isPivotMode(),c=!!this.rowNode.group&&!this.rowNode.footer&&this.gos.isGroupUseEntireRow(r);e?this.rowType="FullWidthLoading":i?this.rowType="FullWidthDetail":n?this.rowType="FullWidth":c?this.rowType="FullWidthGroup":this.rowType="Normal"}updateColumnLists(e=!1,n=!1){if(this.isFullWidth())return;if(e||this.gos.get("suppressAnimationFrame")||this.printLayout){this.updateColumnListsImpl(n);return}this.updateColumnListsPending||(this.beans.animationFrameService.createTask(()=>{this.active&&this.updateColumnListsImpl(!0)},this.rowNode.rowIndex,"createTasksP1"),this.updateColumnListsPending=!0)}createCellCtrls(e,n,i=null){const r={list:[],map:{}},o=(c,s)=>{r.list.push(s),r.map[c]=s};return n.forEach(c=>{const s=c.getInstanceId();let f=e.map[s];f||(f=new r_(c,this.rowNode,this.beans,this)),o(s,f)}),e.list.forEach(c=>{if(r.map[c.getColumn().getInstanceId()]!=null)return;if(!this.isCellEligibleToBeRemoved(c,i)){o(c.getColumn().getInstanceId(),c);return}c.destroy()}),r}updateColumnListsImpl(e){this.updateColumnListsPending=!1,this.createAllCellCtrls(),this.setCellCtrls(e)}setCellCtrls(e){this.allRowGuis.forEach(n=>{const i=this.getCellCtrlsForContainer(n.containerType);n.rowComp.setCellCtrls(i,e)})}getCellCtrlsForContainer(e){switch(e){case"left":return this.leftCellCtrls.list;case"right":return this.rightCellCtrls.list;case"fullWidth":return[];case"center":return this.centerCellCtrls.list}}createAllCellCtrls(){const e=this.beans.columnViewportService,n=this.beans.visibleColsService;if(this.printLayout)this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,n.getAllCols()),this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}};else{const i=e.getColsWithinViewport(this.rowNode);this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,i);const r=n.getLeftColsForRow(this.rowNode);this.leftCellCtrls=this.createCellCtrls(this.leftCellCtrls,r,"left");const o=n.getRightColsForRow(this.rowNode);this.rightCellCtrls=this.createCellCtrls(this.rightCellCtrls,o,"right")}}isCellEligibleToBeRemoved(e,n){if(e.getColumn().getPinned()!=n)return!0;const c=e.isEditing(),s=this.beans.focusService.isCellFocused(e.getCellPosition());if(c||s){const v=e.getColumn();return!(this.beans.visibleColsService.getAllCols().indexOf(v)>=0)}return!0}getDomOrder(){return this.gos.get("ensureDomOrder")||this.gos.isDomLayout("print")}listenOnDomOrder(e){const n=()=>{e.rowComp.setDomOrder(this.getDomOrder())};this.addManagedPropertyListener("domLayout",n),this.addManagedPropertyListener("ensureDomOrder",n)}setAnimateFlags(e){if(this.isSticky()||!e)return;const n=$n(this.rowNode.oldRowTop),i=this.beans.visibleColsService.isPinningLeft(),r=this.beans.visibleColsService.isPinningRight();if(n){if(this.isFullWidth()&&!this.gos.get("embedFullWidthRows")){this.slideInAnimation.fullWidth=!0;return}this.slideInAnimation.center=!0,this.slideInAnimation.left=i,this.slideInAnimation.right=r}else{if(this.isFullWidth()&&!this.gos.get("embedFullWidthRows")){this.fadeInAnimation.fullWidth=!0;return}this.fadeInAnimation.center=!0,this.fadeInAnimation.left=i,this.fadeInAnimation.right=r}}isEditing(){return this.editingRow}isFullWidth(){return this.rowType!=="Normal"}refreshFullWidth(){const e=(s,f)=>s?s.rowComp.refreshFullWidth(()=>this.createFullWidthCompDetails(s.element,f).params):!0,n=e(this.fullWidthGui,null),i=e(this.centerGui,null),r=e(this.leftGui,"left"),o=e(this.rightGui,"right");return n&&i&&r&&o}addListeners(){this.addManagedListeners(this.rowNode,{heightChanged:()=>this.onRowHeightChanged(),rowSelected:()=>this.onRowSelected(),rowIndexChanged:this.onRowIndexChanged.bind(this),topChanged:this.onTopChanged.bind(this),expandedChanged:this.updateExpandedCss.bind(this),hasChildrenChanged:this.updateExpandedCss.bind(this)}),this.rowNode.detail&&this.addManagedListeners(this.rowNode.parent,{dataChanged:this.onRowNodeDataChanged.bind(this)}),this.addManagedListeners(this.rowNode,{dataChanged:this.onRowNodeDataChanged.bind(this),cellChanged:this.postProcessCss.bind(this),rowHighlightChanged:this.onRowNodeHighlightChanged.bind(this),draggingChanged:this.postProcessRowDragging.bind(this),uiLevelChanged:this.onUiLevelChanged.bind(this)}),this.addManagedListeners(this.beans.eventService,{paginationPixelOffsetChanged:this.onPaginationPixelOffsetChanged.bind(this),heightScaleChanged:this.onTopChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),virtualColumnsChanged:this.onVirtualColumnsChanged.bind(this),cellFocused:this.onCellFocusChanged.bind(this),cellFocusCleared:this.onCellFocusChanged.bind(this),paginationChanged:this.onPaginationChanged.bind(this),modelUpdated:this.refreshFirstAndLastRowStyles.bind(this),columnMoved:()=>this.updateColumnLists()}),this.addDestroyFunc(()=>{this.destroyBeans(this.rowDragComps,this.beans.context),this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature,this.beans.context))}),this.addManagedPropertyListeners(["rowDragEntireRow"],()=>{if(this.gos.get("rowDragEntireRow")){this.allRowGuis.forEach(n=>{this.addRowDraggerToRow(n)});return}this.rowDragComps=this.destroyBeans(this.rowDragComps,this.beans.context)}),this.addListenersForCellComps()}addListenersForCellComps(){this.addManagedListeners(this.rowNode,{rowIndexChanged:()=>{this.getAllCellCtrls().forEach(e=>e.onRowIndexChanged())},cellChanged:e=>{this.getAllCellCtrls().forEach(n=>n.onCellChanged(e))}})}onRowNodeDataChanged(e){if(this.isFullWidth()!==!!this.rowNode.isFullWidthCell()){this.beans.rowRenderer.redrawRow(this.rowNode);return}if(this.isFullWidth()){this.refreshFullWidth()||this.beans.rowRenderer.redrawRow(this.rowNode);return}this.getAllCellCtrls().forEach(i=>i.refreshCell({suppressFlash:!e.update,newData:!e.update})),this.allRowGuis.forEach(i=>{this.setRowCompRowId(i.rowComp),this.updateRowBusinessKey(),this.setRowCompRowBusinessKey(i.rowComp)}),this.onRowSelected(),this.postProcessCss()}postProcessCss(){this.setStylesFromGridOptions(!0),this.postProcessClassesFromGridOptions(),this.postProcessRowClassRules(),this.postProcessRowDragging()}onRowNodeHighlightChanged(){const e=this.rowNode.highlighted;this.allRowGuis.forEach(n=>{const i=e===0,r=e===1;n.rowComp.addOrRemoveCssClass("ag-row-highlight-above",i),n.rowComp.addOrRemoveCssClass("ag-row-highlight-below",r)})}postProcessRowDragging(){const e=this.rowNode.dragging;this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-dragging",e))}updateExpandedCss(){const e=this.rowNode.isExpandable(),n=this.rowNode.expanded==!0;this.allRowGuis.forEach(i=>{i.rowComp.addOrRemoveCssClass("ag-row-group",e),i.rowComp.addOrRemoveCssClass("ag-row-group-expanded",e&&n),i.rowComp.addOrRemoveCssClass("ag-row-group-contracted",e&&!n),tT(i.element,e&&n)})}onDisplayedColumnsChanged(){this.updateColumnLists(!0),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights()}onVirtualColumnsChanged(){this.updateColumnLists(!1,!0)}getRowPosition(){return{rowPinned:n_(this.rowNode.rowPinned),rowIndex:this.rowNode.rowIndex}}onKeyboardNavigate(e){const n=this.allRowGuis.find(f=>f.element.contains(e.target));if(!((n?n.element:null)===e.target))return;const o=this.rowNode,c=this.beans.focusService.getFocusedCell(),s={rowIndex:o.rowIndex,rowPinned:o.rowPinned,column:c&&c.column};this.beans.navigationService.navigateToNextCell(e,e.key,s,!0),e.preventDefault()}onTabKeyDown(e){if(e.defaultPrevented||Yg(e))return;const n=this.allRowGuis.find(c=>c.element.contains(e.target)),i=n?n.element:null,r=i===e.target;let o=null;r||(o=this.beans.focusService.findNextFocusableElement(i,!1,e.shiftKey)),(this.isFullWidth()&&r||!o)&&this.beans.navigationService.onTabKeyDown(this,e)}getFullWidthElement(){return this.fullWidthGui?this.fullWidthGui.element:null}getRowYPosition(){var n;const e=(n=this.allRowGuis.find(i=>Ef(i.element)))==null?void 0:n.element;return e?e.getBoundingClientRect().top:0}onFullWidthRowFocused(e){var o;const n=this.rowNode,i=e?this.isFullWidth()&&e.rowIndex===n.rowIndex&&e.rowPinned==n.rowPinned:!1,r=this.fullWidthGui?this.fullWidthGui.element:(o=this.centerGui)==null?void 0:o.element;r&&(r.classList.toggle("ag-full-width-focus",i),i&&(e!=null&&e.forceBrowserFocus)&&r.focus({preventScroll:!0}))}recreateCell(e){this.centerCellCtrls=this.removeCellCtrl(this.centerCellCtrls,e),this.leftCellCtrls=this.removeCellCtrl(this.leftCellCtrls,e),this.rightCellCtrls=this.removeCellCtrl(this.rightCellCtrls,e),e.destroy(),this.updateColumnLists()}removeCellCtrl(e,n){const i={list:[],map:{}};return e.list.forEach(r=>{r!==n&&(i.list.push(r),i.map[r.getColumn().getInstanceId()]=r)}),i}onMouseEvent(e,n){switch(e){case"dblclick":this.onRowDblClick(n);break;case"click":this.onRowClick(n);break;case"touchstart":case"mousedown":this.onRowMouseDown(n);break}}createRowEvent(e,n){return this.gos.addGridCommonParams({type:e,node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,rowPinned:this.rowNode.rowPinned,event:n})}createRowEventWithSource(e,n){const i=this.createRowEvent(e,n);return i.source=this,i}onRowDblClick(e){if(Yg(e))return;const n=this.createRowEventWithSource("rowDoubleClicked",e);this.beans.eventService.dispatchEvent(n)}onRowMouseDown(e){if(this.lastMouseDownOnDragger=Ax(e.target,"ag-row-drag",3),!this.isFullWidth())return;const n=this.rowNode,i=this.beans.visibleColsService;this.beans.rangeService&&this.beans.rangeService.removeAllCellRanges();const r=this.getFullWidthElement(),o=e.target;let c=!0;r&&r.contains(o)&&w3(o)&&(c=!1),this.beans.focusService.setFocusedCell({rowIndex:n.rowIndex,column:i.getAllCols()[0],rowPinned:n.rowPinned,forceBrowserFocus:c})}onRowClick(e){if(Yg(e)||this.lastMouseDownOnDragger)return;const i=this.createRowEventWithSource("rowClicked",e);this.beans.eventService.dispatchEvent(i);const r=e.ctrlKey||e.metaKey,o=e.shiftKey;if(this.gos.get("groupSelectsChildren")&&this.rowNode.group||this.isRowSelectionBlocked()||this.gos.get("suppressRowClickSelection"))return;const s=this.gos.get("rowMultiSelectWithClick"),f=!this.gos.get("suppressRowDeselection"),v="rowClicked";if(this.rowNode.isSelected())s?this.rowNode.setSelectedParams({newValue:!1,event:e,source:v}):r?f&&this.rowNode.setSelectedParams({newValue:!1,event:e,source:v}):this.rowNode.setSelectedParams({newValue:!0,clearSelection:!o,rangeSelect:o,event:e,source:v});else{const w=s?!1:!r;this.rowNode.setSelectedParams({newValue:!0,clearSelection:w,rangeSelect:o,event:e,source:v})}}isRowSelectionBlocked(){return!this.rowNode.selectable||!!this.rowNode.rowPinned||!this.gos.isRowSelection()}setupDetailRowAutoHeight(e){if(this.rowType!=="FullWidthDetail"||!this.gos.get("detailRowAutoHeight"))return;const n=()=>{const r=e.clientHeight;if(r!=null&&r>0){const o=()=>{this.rowNode.setRowHeight(r),this.beans.rowModel.getType()==="clientSide"?this.beans.rowModel.onRowHeightChanged():this.beans.rowModel.getType()==="serverSide"&&this.beans.rowModel.onRowHeightChanged()};window.setTimeout(o,0)}},i=this.beans.resizeObserverService.observeResize(e,n);this.addDestroyFunc(i),n()}createFullWidthCompDetails(e,n){const{gos:i,rowNode:r}=this,o=i.addGridCommonParams({fullWidth:!0,data:r.data,node:r,value:r.key,valueFormatted:r.key,eGridCell:e,eParentOfValue:e,pinned:n,addRenderedRowListener:this.addEventListener.bind(this),registerRowDragger:(s,f,v,w)=>this.addFullWidthRowDragging(s,f,v,w),setTooltip:(s,f)=>this.refreshRowTooltip(s,f)}),c=this.beans.userComponentFactory;switch(this.rowType){case"FullWidthDetail":return c.getFullWidthDetailCellRendererDetails(o);case"FullWidthGroup":return c.getFullWidthGroupCellRendererDetails(o);case"FullWidthLoading":return c.getFullWidthLoadingCellRendererDetails(o);default:return c.getFullWidthCellRendererDetails(o)}}refreshRowTooltip(e,n){if(!this.fullWidthGui)return;const i={getGui:()=>this.fullWidthGui.element,getTooltipValue:()=>e,getLocation:()=>"fullWidthRow",shouldDisplayTooltip:n};this.tooltipFeature&&this.destroyBean(this.tooltipFeature,this.beans.context),this.tooltipFeature=this.createBean(new Sw(i,this.beans))}addFullWidthRowDragging(e,n,i="",r){if(!this.isFullWidth())return;const o=new TL(()=>i,this.rowNode,void 0,e,n,r);this.createBean(o,this.beans.context),this.addDestroyFunc(()=>{this.destroyBean(o,this.beans.context)})}onUiLevelChanged(){const e=this.beans.rowCssClassCalculator.calculateRowLevel(this.rowNode);if(this.rowLevel!=e){const n="ag-row-level-"+e,i="ag-row-level-"+this.rowLevel;this.allRowGuis.forEach(r=>{r.rowComp.addOrRemoveCssClass(n,!0),r.rowComp.addOrRemoveCssClass(i,!1)})}this.rowLevel=e}isFirstRowOnPage(){return this.rowNode.rowIndex===this.beans.pageBoundsService.getFirstRow()}isLastRowOnPage(){return this.rowNode.rowIndex===this.beans.pageBoundsService.getLastRow()}refreshFirstAndLastRowStyles(){const e=this.isFirstRowOnPage(),n=this.isLastRowOnPage();this.firstRowOnPage!==e&&(this.firstRowOnPage=e,this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass("ag-row-first",e))),this.lastRowOnPage!==n&&(this.lastRowOnPage=n,this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass("ag-row-last",n)))}stopEditing(e=!1){var n;this.stoppingRowEdit||(n=this.beans.rowEditService)==null||n.stopEditing(this,e)}setInlineEditingCss(e){this.allRowGuis.forEach(n=>{n.rowComp.addOrRemoveCssClass("ag-row-inline-editing",e),n.rowComp.addOrRemoveCssClass("ag-row-not-inline-editing",!e)})}setEditingRow(e){this.editingRow=e}startRowEditing(e=null,n=null,i=null){var r;this.editingRow||(r=this.beans.rowEditService)==null||r.startEditing(this,e,n,i)}getAllCellCtrls(){return this.leftCellCtrls.list.length===0&&this.rightCellCtrls.list.length===0?this.centerCellCtrls.list:[...this.centerCellCtrls.list,...this.leftCellCtrls.list,...this.rightCellCtrls.list]}postProcessClassesFromGridOptions(){const e=this.beans.rowCssClassCalculator.processClassesFromGridOptions(this.rowNode);!e||!e.length||e.forEach(n=>{this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass(n,!0))})}postProcessRowClassRules(){this.beans.rowCssClassCalculator.processRowClassRules(this.rowNode,e=>{this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass(e,!0))},e=>{this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass(e,!1))})}setStylesFromGridOptions(e,n){e&&(this.rowStyles=this.processStylesFromGridOptions()),this.forEachGui(n,i=>i.rowComp.setUserStyles(this.rowStyles))}getPinnedForContainer(e){return e==="left"||e==="right"?e:null}getInitialRowClasses(e){const n=this.getPinnedForContainer(e),i={rowNode:this.rowNode,rowFocused:this.rowFocused,fadeRowIn:this.fadeInAnimation[e],rowIsEven:this.rowNode.rowIndex%2===0,rowLevel:this.rowLevel,fullWidthRow:this.isFullWidth(),firstRowOnPage:this.isFirstRowOnPage(),lastRowOnPage:this.isLastRowOnPage(),printLayout:this.printLayout,expandable:this.rowNode.isExpandable(),pinned:n};return this.beans.rowCssClassCalculator.getInitialRowClasses(i)}processStylesFromGridOptions(){const e=this.gos.get("rowStyle");if(e&&typeof e=="function"){Tn("rowStyle should be an object of key/value styles, not be a function, use getRowStyle() instead");return}const n=this.gos.getCallback("getRowStyle");let i;if(n){const r={data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex};i=n(r)}return i||e?Object.assign({},e,i):this.emptyStyle}onRowSelected(e){const n=!!this.rowNode.isSelected();this.forEachGui(e,i=>{i.rowComp.addOrRemoveCssClass("ag-row-selected",n),nT(i.element,n),i.element.contains(this.gos.getActiveDomElement())&&(i===this.centerGui||i===this.fullWidthGui)&&this.announceDescription()})}announceDescription(){if(this.isRowSelectionBlocked())return;const e=this.rowNode.isSelected();if(e&&this.gos.get("suppressRowDeselection"))return;const i=this.beans.localeService.getLocaleTextFunc()(e?"ariaRowDeselect":"ariaRowSelect",`Press SPACE to ${e?"deselect":"select"} this row.`);this.beans.ariaAnnouncementService.announceValue(i)}addHoverFunctionality(e){if(!this.active)return;const{rowNode:n,beans:i,gos:r}=this;this.addManagedListeners(e,{mouseenter:()=>n.onMouseEnter(),mouseleave:()=>n.onMouseLeave()}),this.addManagedListeners(n,{mouseEnter:()=>{!i.dragService.isDragging()&&!r.get("suppressRowHoverHighlight")&&(e.classList.add("ag-row-hover"),n.setHovered(!0))},mouseLeave:()=>{e.classList.remove("ag-row-hover"),n.setHovered(!1)}})}roundRowTopToBounds(e){const n=this.beans.ctrlsService.getGridBodyCtrl().getScrollFeature().getApproximateVScollPosition(),i=this.applyPaginationOffset(n.top,!0)-100,r=this.applyPaginationOffset(n.bottom,!0)+100;return Math.min(Math.max(i,e),r)}getFrameworkOverrides(){return this.beans.frameworkOverrides}forEachGui(e,n){e?n(e):this.allRowGuis.forEach(n)}onRowHeightChanged(e){if(this.rowNode.rowHeight==null)return;const n=this.rowNode.rowHeight,i=this.beans.environment.getDefaultRowHeight(),o=this.gos.isGetRowHeightFunction()?this.gos.getRowHeightForNode(this.rowNode).height:void 0,c=o?`${Math.min(i,o)-2}px`:void 0;this.forEachGui(e,s=>{s.element.style.height=`${n}px`,c&&s.element.style.setProperty("--ag-line-height",c)})}addEventListener(e,n){super.addEventListener(e,n)}removeEventListener(e,n){super.removeEventListener(e,n)}destroyFirstPass(e=!1){if(this.active=!1,!e&&this.gos.isAnimateRows()&&!this.isSticky())if(this.rowNode.rowTop!=null){const r=this.roundRowTopToBounds(this.rowNode.rowTop);this.setRowTop(r)}else this.allRowGuis.forEach(r=>r.rowComp.addOrRemoveCssClass("ag-opacity-zero",!0));this.rowNode.setHovered(!1);const n=this.createRowEvent("virtualRowRemoved");this.dispatchLocalEvent(n),this.beans.eventService.dispatchEvent(n),super.destroy()}destroySecondPass(){this.allRowGuis.length=0,this.stopEditing();const e=n=>(n.list.forEach(i=>i.destroy()),{list:[],map:{}});this.centerCellCtrls=e(this.centerCellCtrls),this.leftCellCtrls=e(this.leftCellCtrls),this.rightCellCtrls=e(this.rightCellCtrls)}setFocusedClasses(e){this.forEachGui(e,n=>{n.rowComp.addOrRemoveCssClass("ag-row-focus",this.rowFocused),n.rowComp.addOrRemoveCssClass("ag-row-no-focus",!this.rowFocused)})}onCellFocusChanged(){const e=this.beans.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned);e!==this.rowFocused&&(this.rowFocused=e,this.setFocusedClasses()),!e&&this.editingRow&&this.stopEditing(!1)}onPaginationChanged(){var n;const e=((n=this.beans.paginationService)==null?void 0:n.getCurrentPage())??0;this.paginationPage!==e&&(this.paginationPage=e,this.onTopChanged()),this.refreshFirstAndLastRowStyles()}onTopChanged(){this.setRowTop(this.rowNode.rowTop)}onPaginationPixelOffsetChanged(){this.onTopChanged()}applyPaginationOffset(e,n=!1){if(this.rowNode.isRowPinned()||this.rowNode.sticky)return e;const i=this.beans.pageBoundsService.getPixelOffset();return e+i*(n?1:-1)}setRowTop(e){if(!this.printLayout&&$n(e)){const n=this.applyPaginationOffset(e),o=`${this.rowNode.isRowPinned()||this.rowNode.sticky?n:this.beans.rowContainerHeightService.getRealPixelPosition(n)}px`;this.setRowTopStyle(o)}}getInitialRowTop(e){return this.suppressRowTransform?this.getInitialRowTopShared(e):void 0}getInitialTransform(e){return this.suppressRowTransform?void 0:`translateY(${this.getInitialRowTopShared(e)})`}getInitialRowTopShared(e){if(this.printLayout)return"";const n=this.rowNode;let i;if(this.isSticky())i=n.stickyRowTop;else{const r=this.slideInAnimation[e]?this.roundRowTopToBounds(n.oldRowTop):n.rowTop,o=this.applyPaginationOffset(r);i=n.isRowPinned()?o:this.beans.rowContainerHeightService.getRealPixelPosition(o)}return i+"px"}setRowTopStyle(e){this.allRowGuis.forEach(n=>this.suppressRowTransform?n.rowComp.setTop(e):n.rowComp.setTransform(`translateY(${e})`))}getRowNode(){return this.rowNode}getCellCtrl(e){let n=null;return this.getAllCellCtrls().forEach(i=>{i.getColumn()==e&&(n=i)}),n!=null||this.getAllCellCtrls().forEach(i=>{i.getColSpanningList().indexOf(e)>=0&&(n=i)}),n}onRowIndexChanged(){this.rowNode.rowIndex!=null&&(this.onCellFocusChanged(),this.updateRowIndexes(),this.postProcessCss())}getRowIndex(){return this.rowNode.getRowIndexString()}updateRowIndexes(e){var c;const n=this.rowNode.getRowIndexString();if(n===null)return;const i=this.beans.headerNavigationService.getHeaderRowCount()+(((c=this.beans.filterManager)==null?void 0:c.getHeaderRowCount())??0),r=this.rowNode.rowIndex%2===0,o=i+this.rowNode.rowIndex+1;this.forEachGui(e,s=>{s.rowComp.setRowIndex(n),s.rowComp.addOrRemoveCssClass("ag-row-even",r),s.rowComp.addOrRemoveCssClass("ag-row-odd",!r),Yce(s.element,o)})}setStoppingRowEdit(e){this.stoppingRowEdit=e}};rq.DOM_DATA_KEY_ROW_CTRL="renderedRow";var s_=rq,pfe=class extends wn{wireBeans(t){this.mouseEventService=t.mouseEventService,this.valueService=t.valueService,this.menuService=t.menuService,this.ctrlsService=t.ctrlsService,this.navigationService=t.navigationService,this.focusService=t.focusService,this.undoRedoService=t.undoRedoService,this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.rangeService=t.rangeService,this.clipboardService=t.clipboardService}constructor(t){super(),this.element=t}postConstruct(){this.addKeyboardListeners(),this.addMouseListeners(),this.mockContextMenuForIPad()}addKeyboardListeners(){const t="keydown",e=this.processKeyboardEvent.bind(this,t);this.addManagedElementListeners(this.element,{[t]:e})}addMouseListeners(){["dblclick","contextmenu","mouseover","mouseout","click",Z$("touchstart")?"touchstart":"mousedown"].forEach(n=>{const i=this.processMouseEvent.bind(this,n);this.addManagedElementListeners(this.element,{[n]:i})})}processMouseEvent(t,e){if(!this.mouseEventService.isEventFromThisGrid(e)||Yg(e))return;const n=this.getRowForEvent(e),i=this.mouseEventService.getRenderedCellForEvent(e);t==="contextmenu"?this.handleContextMenuMouseEvent(e,void 0,n,i):(i&&i.onMouseEvent(t,e),n&&n.onMouseEvent(t,e))}mockContextMenuForIPad(){if(!wv())return;const t=new Jg(this.element),e=n=>{const i=this.getRowForEvent(n.touchEvent),r=this.mouseEventService.getRenderedCellForEvent(n.touchEvent);this.handleContextMenuMouseEvent(void 0,n.touchEvent,i,r)};this.addManagedListeners(t,{longTap:e}),this.addDestroyFunc(()=>t.destroy())}getRowForEvent(t){let e=t.target;for(;e;){const n=this.gos.getDomData(e,s_.DOM_DATA_KEY_ROW_CTRL);if(n)return n;e=e.parentElement}return null}handleContextMenuMouseEvent(t,e,n,i){const r=n?n.getRowNode():null,o=i?i.getColumn():null;let c=null;if(o){const v=t||e;i.dispatchCellContextMenuEvent(v??null),c=this.valueService.getValue(o,r)}const s=this.ctrlsService.getGridBodyCtrl(),f=i?i.getGui():s.getGridBodyElement();this.menuService.showContextMenu({mouseEvent:t,touchEvent:e,rowNode:r,column:o,value:c,anchorToElement:f})}getControlsForEventTarget(t){return{cellCtrl:vL(this.gos,t,r_.DOM_DATA_KEY_CELL_CTRL),rowCtrl:vL(this.gos,t,s_.DOM_DATA_KEY_ROW_CTRL)}}processKeyboardEvent(t,e){const{cellCtrl:n,rowCtrl:i}=this.getControlsForEventTarget(e.target);e.defaultPrevented||(n?this.processCellKeyboardEvent(n,t,e):i&&i.isFullWidth()&&this.processFullWidthRowKeyboardEvent(i,t,e))}processCellKeyboardEvent(t,e,n){const i=t.getRowNode(),r=t.getColumn(),o=t.isEditing();if(!AL(this.gos,n,i,r,o)&&e==="keydown"&&(!o&&this.navigationService.handlePageScrollingKey(n)||t.onKeyDown(n),this.doGridOperations(n,t.isEditing()),O7(n)&&t.processCharacter(n)),e==="keydown"){const s=t.createEvent(n,"cellKeyDown");this.eventService.dispatchEvent(s)}}processFullWidthRowKeyboardEvent(t,e,n){const i=t.getRowNode(),r=this.focusService.getFocusedCell(),o=r&&r.column;if(!AL(this.gos,n,i,o,!1)){const s=n.key;if(e==="keydown")switch(s){case mn.PAGE_HOME:case mn.PAGE_END:case mn.PAGE_UP:case mn.PAGE_DOWN:this.navigationService.handlePageScrollingKey(n,!0);break;case mn.UP:case mn.DOWN:t.onKeyboardNavigate(n);break;case mn.TAB:t.onTabKeyDown(n);break}}if(e==="keydown"){const s=t.createRowEvent("cellKeyDown",n);this.eventService.dispatchEvent(s)}}doGridOperations(t,e){if(!t.ctrlKey&&!t.metaKey||e||!this.mouseEventService.isEventFromThisGrid(t))return;const n=bhe(t);if(n===mn.A)return this.onCtrlAndA(t);if(n===mn.C)return this.onCtrlAndC(t);if(n===mn.D)return this.onCtrlAndD(t);if(n===mn.V)return this.onCtrlAndV(t);if(n===mn.X)return this.onCtrlAndX(t);if(n===mn.Y)return this.onCtrlAndY();if(n===mn.Z)return this.onCtrlAndZ(t)}onCtrlAndA(t){const{pinnedRowModel:e,rowModel:n,rangeService:i}=this;if(i&&n.isRowsToRender()){const[r,o]=[e.isEmpty("top"),e.isEmpty("bottom")],c=r?null:"top";let s,f;o?(s=null,f=n.getRowCount()-1):(s="bottom",f=e.getPinnedBottomRowNodes().length-1);const v=this.visibleColsService.getAllCols();if(Va(v))return;i.setCellRange({rowStartIndex:0,rowStartPinned:c,rowEndIndex:f,rowEndPinned:s,columnStart:v[0],columnEnd:Yr(v)})}t.preventDefault()}onCtrlAndC(t){if(!this.clipboardService||this.gos.get("enableCellTextSelection"))return;const{cellCtrl:e,rowCtrl:n}=this.getControlsForEventTarget(t.target);e!=null&&e.isEditing()||n!=null&&n.isEditing()||(t.preventDefault(),this.clipboardService.copyToClipboard())}onCtrlAndX(t){if(!this.clipboardService||this.gos.get("enableCellTextSelection")||this.gos.get("suppressCutToClipboard"))return;const{cellCtrl:e,rowCtrl:n}=this.getControlsForEventTarget(t.target);e!=null&&e.isEditing()||n!=null&&n.isEditing()||(t.preventDefault(),this.clipboardService.cutToClipboard(void 0,"ui"))}onCtrlAndV(t){const{cellCtrl:e,rowCtrl:n}=this.getControlsForEventTarget(t.target);e!=null&&e.isEditing()||n!=null&&n.isEditing()||this.clipboardService&&!this.gos.get("suppressClipboardPaste")&&this.clipboardService.pasteFromClipboard()}onCtrlAndD(t){this.clipboardService&&!this.gos.get("suppressClipboardPaste")&&this.clipboardService.copyRangeDown(),t.preventDefault()}onCtrlAndZ(t){!this.gos.get("undoRedoCellEditing")||!this.undoRedoService||(t.preventDefault(),t.shiftKey?this.undoRedoService.redo("ui"):this.undoRedoService.undo("ui"))}onCtrlAndY(){var t;(t=this.undoRedoService)==null||t.redo("ui")}},mfe=class extends wn{wireBeans(t){this.pinnedWidthService=t.pinnedWidthService}constructor(t){super(),this.element=t}postConstruct(){this.addManagedEventListeners({leftPinnedWidthChanged:this.onPinnedLeftWidthChanged.bind(this)})}onPinnedLeftWidthChanged(){const t=this.pinnedWidthService.getPinnedLeftWidth(),e=t>0;Do(this.element,e),sd(this.element,t)}getWidth(){return this.pinnedWidthService.getPinnedLeftWidth()}},gfe=class extends wn{wireBeans(t){this.pinnedWidthService=t.pinnedWidthService}constructor(t){super(),this.element=t}postConstruct(){this.addManagedEventListeners({rightPinnedWidthChanged:this.onPinnedRightWidthChanged.bind(this)})}onPinnedRightWidthChanged(){const t=this.pinnedWidthService.getPinnedRightWidth(),e=t>0;Do(this.element,e),sd(this.element,t)}getWidth(){return this.pinnedWidthService.getPinnedRightWidth()}},IE=t=>t.getTopRowCtrls(),DE=t=>t.getStickyTopRowCtrls(),FE=t=>t.getStickyBottomRowCtrls(),LE=t=>t.getBottomRowCtrls(),OE=t=>t.getCentreRowCtrls(),vfe={center:{type:"center",container:"ag-center-cols-container",viewport:"ag-center-cols-viewport",getRowCtrls:OE},left:{type:"left",container:"ag-pinned-left-cols-container",pinnedType:"left",getRowCtrls:OE},right:{type:"right",container:"ag-pinned-right-cols-container",pinnedType:"right",getRowCtrls:OE},fullWidth:{type:"fullWidth",container:"ag-full-width-container",fullWidth:!0,getRowCtrls:OE},topCenter:{type:"center",container:"ag-floating-top-container",viewport:"ag-floating-top-viewport",getRowCtrls:IE},topLeft:{type:"left",container:"ag-pinned-left-floating-top",pinnedType:"left",getRowCtrls:IE},topRight:{type:"right",container:"ag-pinned-right-floating-top",pinnedType:"right",getRowCtrls:IE},topFullWidth:{type:"fullWidth",container:"ag-floating-top-full-width-container",fullWidth:!0,getRowCtrls:IE},stickyTopCenter:{type:"center",container:"ag-sticky-top-container",viewport:"ag-sticky-top-viewport",getRowCtrls:DE},stickyTopLeft:{type:"left",container:"ag-pinned-left-sticky-top",pinnedType:"left",getRowCtrls:DE},stickyTopRight:{type:"right",container:"ag-pinned-right-sticky-top",pinnedType:"right",getRowCtrls:DE},stickyTopFullWidth:{type:"fullWidth",container:"ag-sticky-top-full-width-container",fullWidth:!0,getRowCtrls:DE},stickyBottomCenter:{type:"center",container:"ag-sticky-bottom-container",viewport:"ag-sticky-bottom-viewport",getRowCtrls:FE},stickyBottomLeft:{type:"left",container:"ag-pinned-left-sticky-bottom",pinnedType:"left",getRowCtrls:FE},stickyBottomRight:{type:"right",container:"ag-pinned-right-sticky-bottom",pinnedType:"right",getRowCtrls:FE},stickyBottomFullWidth:{type:"fullWidth",container:"ag-sticky-bottom-full-width-container",fullWidth:!0,getRowCtrls:FE},bottomCenter:{type:"center",container:"ag-floating-bottom-container",viewport:"ag-floating-bottom-viewport",getRowCtrls:LE},bottomLeft:{type:"left",container:"ag-pinned-left-floating-bottom",pinnedType:"left",getRowCtrls:LE},bottomRight:{type:"right",container:"ag-pinned-right-floating-bottom",pinnedType:"right",getRowCtrls:LE},bottomFullWidth:{type:"fullWidth",container:"ag-floating-bottom-full-width-container",fullWidth:!0,getRowCtrls:LE}};function sq(t){return vfe[t]}var yfe=["topCenter","topLeft","topRight"],_fe=["bottomCenter","bottomLeft","bottomRight"],xfe=["center","left","right"],wfe=["center","left","right","fullWidth"],Cfe=["stickyTopCenter","stickyBottomCenter","center","topCenter","bottomCenter"],Sfe=["left","bottomLeft","topLeft","stickyTopLeft","stickyBottomLeft"],bfe=["right","bottomRight","topRight","stickyTopRight","stickyBottomRight"],oq=["stickyTopCenter","stickyTopLeft","stickyTopRight"],aq=["stickyBottomCenter","stickyBottomLeft","stickyBottomRight"],Efe=[...oq,"stickyTopFullWidth",...aq,"stickyBottomFullWidth"],Mfe=[...yfe,..._fe,...xfe,...oq,...aq],Rfe=class extends wn{constructor(t){super(),this.visible=!0,this.EMPTY_CTRLS=[],this.name=t,this.options=sq(t)}wireBeans(t){this.dragService=t.dragService,this.ctrlsService=t.ctrlsService,this.columnViewportService=t.columnViewportService,this.resizeObserverService=t.resizeObserverService,this.rowRenderer=t.rowRenderer}postConstruct(){this.enableRtl=this.gos.get("enableRtl"),this.forContainers(["center"],()=>{this.viewportSizeFeature=this.createManagedBean(new Ude(this)),this.addManagedEventListeners({stickyTopOffsetChanged:this.onStickyTopOffsetChanged.bind(this)})})}onStickyTopOffsetChanged(t){this.comp.setOffsetTop(`${t.offset}px`)}registerWithCtrlsService(){this.options.fullWidth||this.ctrlsService.register(this.name,this)}forContainers(t,e){t.indexOf(this.name)>=0&&e()}getContainerElement(){return this.eContainer}getViewportSizeFeature(){return this.viewportSizeFeature}setComp(t,e,n){this.comp=t,this.eContainer=e,this.eViewport=n,this.createManagedBean(new pfe(this.eContainer)),this.addPreventScrollWhileDragging(),this.listenOnDomOrder(),this.stopHScrollOnPinnedRows(),this.forContainers(Sfe,()=>{this.pinnedWidthFeature=this.createManagedBean(new mfe(this.eContainer)),this.addManagedEventListeners({leftPinnedWidthChanged:()=>this.onPinnedWidthChanged()})}),this.forContainers(bfe,()=>{this.pinnedWidthFeature=this.createManagedBean(new gfe(this.eContainer)),this.addManagedEventListeners({rightPinnedWidthChanged:()=>this.onPinnedWidthChanged()})}),this.forContainers(wfe,()=>this.createManagedBean(new nq(this.eContainer,this.name==="center"?n:void 0))),this.forContainers(Mfe,()=>this.createManagedBean(new Vde(this.eContainer))),this.forContainers(Cfe,()=>this.createManagedBean(new N3(i=>this.comp.setContainerWidth(`${i}px`)))),this.addListeners(),this.registerWithCtrlsService()}addListeners(){this.addManagedEventListeners({displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this),displayedRowsChanged:t=>this.onDisplayedRowsChanged(t.afterScroll)}),this.onDisplayedColumnsChanged(),this.onDisplayedColumnsWidthChanged(),this.onDisplayedRowsChanged()}listenOnDomOrder(){if(Efe.indexOf(this.name)>=0){this.comp.setDomOrder(!0);return}const e=()=>{const n=this.gos.get("ensureDomOrder"),i=this.gos.isDomLayout("print");this.comp.setDomOrder(n||i)};this.addManagedPropertyListener("domLayout",e),e()}stopHScrollOnPinnedRows(){this.forContainers(["topCenter","stickyTopCenter","bottomCenter","stickyBottomCenter"],()=>{const t=()=>this.eViewport.scrollLeft=0;this.addManagedElementListeners(this.eViewport,{scroll:t})})}onDisplayedColumnsChanged(){this.forContainers(["center"],()=>this.onHorizontalViewportChanged())}onDisplayedColumnsWidthChanged(){this.forContainers(["center"],()=>this.onHorizontalViewportChanged())}addPreventScrollWhileDragging(){const t=e=>{this.dragService.isDragging()&&e.cancelable&&e.preventDefault()};this.eContainer.addEventListener("touchmove",t,{passive:!1}),this.addDestroyFunc(()=>this.eContainer.removeEventListener("touchmove",t))}onHorizontalViewportChanged(t=!1){const e=this.getCenterWidth(),n=this.getCenterViewportScrollLeft();this.columnViewportService.setScrollPosition(e,n,t)}getCenterWidth(){return VS(this.eViewport)}getCenterViewportScrollLeft(){return sT(this.eViewport,this.enableRtl)}registerViewportResizeListener(t){const e=this.resizeObserverService.observeResize(this.eViewport,t);this.addDestroyFunc(()=>e())}isViewportInTheDOMTree(){return m7(this.eViewport)}getViewportScrollLeft(){return sT(this.eViewport,this.enableRtl)}isHorizontalScrollShowing(){return this.gos.get("alwaysShowHorizontalScroll")||cue(this.eViewport)}getViewportElement(){return this.eViewport}setContainerTranslateX(t){this.eContainer.style.transform=`translateX(${t}px)`}getHScrollPosition(){return{left:this.eViewport.scrollLeft,right:this.eViewport.scrollLeft+this.eViewport.offsetWidth}}setCenterViewportScrollLeft(t){oT(this.eViewport,t,this.enableRtl)}isContainerVisible(){return!(this.options.pinnedType!=null)||!!this.pinnedWidthFeature&&this.pinnedWidthFeature.getWidth()>0}onPinnedWidthChanged(){const t=this.isContainerVisible();this.visible!=t&&(this.visible=t,this.onDisplayedRowsChanged())}onDisplayedRowsChanged(t=!1){const e=this.options.getRowCtrls(this.rowRenderer);if(!this.visible||e.length===0){this.comp.setRowCtrls({rowCtrls:this.EMPTY_CTRLS});return}const n=this.gos.isDomLayout("print"),r=this.gos.get("embedFullWidthRows")||n,o=e.filter(c=>{const s=c.isFullWidth();return this.options.fullWidth?!r&&s:r||!s});this.comp.setRowCtrls({rowCtrls:o,useFlushSync:t})}};function NC(t){return t.map(e=>`<ag-row-container name="${e}"></ag-row-container>`).join("")}`${NC(["topLeft","topCenter","topRight","topFullWidth"])}${NC(["left","center","right","fullWidth"])}${NC(["stickyTopLeft","stickyTopCenter","stickyTopRight","stickyTopFullWidth"])}${NC(["stickyBottomLeft","stickyBottomCenter","stickyBottomRight","stickyBottomFullWidth"])}${NC(["bottomLeft","bottomCenter","bottomRight","bottomFullWidth"])}`;var Tfe=class extends wn{constructor(){super(...arguments),this.beanName="scrollVisibleService"}wireBeans(t){this.ctrlsService=t.ctrlsService,this.columnAnimationService=t.columnAnimationService}postConstruct(){this.addManagedEventListeners({displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this)})}onDisplayedColumnsChanged(){this.update()}onDisplayedColumnsWidthChanged(){this.update()}update(){this.columnAnimationService.isActive()?this.columnAnimationService.executeLaterVMTurn(()=>{this.columnAnimationService.executeLaterVMTurn(()=>this.updateImpl())}):this.updateImpl()}updateImpl(){const t=this.ctrlsService.get("center");if(!t||this.columnAnimationService.isActive())return;const e={horizontalScrollShowing:t.isHorizontalScrollShowing(),verticalScrollShowing:this.isVerticalScrollShowing()};this.setScrollsVisible(e)}setScrollsVisible(t){if(this.horizontalScrollShowing!==t.horizontalScrollShowing||this.verticalScrollShowing!==t.verticalScrollShowing){this.horizontalScrollShowing=t.horizontalScrollShowing,this.verticalScrollShowing=t.verticalScrollShowing;const n={type:"scrollVisibilityChanged"};this.eventService.dispatchEvent(n)}}isHorizontalScrollShowing(){return this.horizontalScrollShowing}isVerticalScrollShowing(){return this.verticalScrollShowing}},Y5="__ag_grid_instance",lq=class cq extends wn{constructor(){super(...arguments),this.beanName="mouseEventService",this.gridInstanceId=cq.gridInstanceSequence.next()}wireBeans(e){this.ctrlsService=e.ctrlsService}stampTopLevelGridCompWithGridInstance(e){e[Y5]=this.gridInstanceId}getRenderedCellForEvent(e){return vL(this.gos,e.target,r_.DOM_DATA_KEY_CELL_CTRL)}isEventFromThisGrid(e){return this.isElementInThisGrid(e.target)}isElementInThisGrid(e){let n=e;for(;n;){const i=n[Y5];if($n(i))return i===this.gridInstanceId;n=n.parentElement}return!1}getCellPositionForEvent(e){const n=this.getRenderedCellForEvent(e);return n?n.getCellPosition():null}getNormalisedPosition(e){const n=this.gos.isDomLayout("normal"),i=e;let r,o;if(i.clientX!=null||i.clientY!=null?(r=i.clientX,o=i.clientY):(r=i.x,o=i.y),n){const c=this.ctrlsService.getGridBodyCtrl(),s=c.getScrollFeature().getVScrollPosition(),f=c.getScrollFeature().getHScrollPosition();r+=f.left,o+=s.top}return{x:r,y:o}}};lq.gridInstanceSequence=new rw;var Afe=lq,Pfe=class extends wn{constructor(){super(),this.beanName="navigationService",this.onPageDown=V5(this.onPageDown,100),this.onPageUp=V5(this.onPageUp,100)}wireBeans(t){this.mouseEventService=t.mouseEventService,this.pageBoundsService=t.pageBoundsService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.ctrlsService=t.ctrlsService,this.rowRenderer=t.rowRenderer,this.headerNavigationService=t.headerNavigationService,this.rowPositionUtils=t.rowPositionUtils,this.cellNavigationService=t.cellNavigationService,this.pinnedRowModel=t.pinnedRowModel,this.rangeService=t.rangeService}postConstruct(){this.ctrlsService.whenReady(t=>{this.gridBodyCon=t.gridBodyCtrl})}handlePageScrollingKey(t,e=!1){const n=t.key,i=t.altKey,r=t.ctrlKey||t.metaKey,o=!!this.rangeService&&t.shiftKey,c=this.mouseEventService.getCellPositionForEvent(t);let s=!1;switch(n){case mn.PAGE_HOME:case mn.PAGE_END:!r&&!i&&(this.onHomeOrEndKey(n),s=!0);break;case mn.LEFT:case mn.RIGHT:case mn.UP:case mn.DOWN:if(!c)return!1;r&&!i&&!o&&(this.onCtrlUpDownLeftRight(n,c),s=!0);break;case mn.PAGE_DOWN:case mn.PAGE_UP:!r&&!i&&(s=this.handlePageUpDown(n,c,e));break}return s&&t.preventDefault(),s}handlePageUpDown(t,e,n){return n&&(e=this.focusService.getFocusedCell()),e?(t===mn.PAGE_UP?this.onPageUp(e):this.onPageDown(e),!0):!1}navigateTo(t){var c;const{scrollIndex:e,scrollType:n,scrollColumn:i,focusIndex:r,focusColumn:o}=t;$n(i)&&!i.isPinned()&&this.gridBodyCon.getScrollFeature().ensureColumnVisible(i),$n(e)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(e,n),t.isAsync||this.gridBodyCon.getScrollFeature().ensureIndexVisible(r),this.focusService.setFocusedCell({rowIndex:r,column:o,rowPinned:null,forceBrowserFocus:!0}),(c=this.rangeService)==null||c.setRangeToCell({rowIndex:r,rowPinned:null,column:o})}onPageDown(t){const n=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),i=this.getViewportHeight(),r=this.pageBoundsService.getPixelOffset(),o=n.top+i,c=this.rowModel.getRowIndexAtPixel(o+r);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(t,c):this.navigateToNextPage(t,c)}onPageUp(t){const n=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),i=this.pageBoundsService.getPixelOffset(),r=n.top,o=this.rowModel.getRowIndexAtPixel(r+i);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(t,o,!0):this.navigateToNextPage(t,o,!0)}navigateToNextPage(t,e,n=!1){const i=this.getViewportHeight(),r=this.pageBoundsService.getFirstRow(),o=this.pageBoundsService.getLastRow(),c=this.pageBoundsService.getPixelOffset(),s=this.rowModel.getRow(t.rowIndex),f=n?(s==null?void 0:s.rowHeight)-i-c:i-c,v=(s==null?void 0:s.rowTop)+f;let w=this.rowModel.getRowIndexAtPixel(v+c);if(w===t.rowIndex){const M=n?-1:1;e=w=t.rowIndex+M}let C;n?(C="bottom",w<r&&(w=r),e<r&&(e=r)):(C="top",w>o&&(w=o),e>o&&(e=o)),this.isRowTallerThanView(w)&&(e=w,C="top"),this.navigateTo({scrollIndex:e,scrollType:C,scrollColumn:null,focusIndex:w,focusColumn:t.column})}navigateToNextPageWithAutoHeight(t,e,n=!1){this.navigateTo({scrollIndex:e,scrollType:n?"bottom":"top",scrollColumn:null,focusIndex:e,focusColumn:t.column}),setTimeout(()=>{const i=this.getNextFocusIndexForAutoHeight(t,n);this.navigateTo({scrollIndex:e,scrollType:n?"bottom":"top",scrollColumn:null,focusIndex:i,focusColumn:t.column,isAsync:!0})},50)}getNextFocusIndexForAutoHeight(t,e=!1){const n=e?-1:1,i=this.getViewportHeight(),r=this.pageBoundsService.getLastRow();let o=0,c=t.rowIndex;for(;c>=0&&c<=r;){const s=this.rowModel.getRow(c);if(s){const f=s.rowHeight??0;if(o+f>i)break;o+=f}c+=n}return Math.max(0,Math.min(c,r))}getViewportHeight(){const{gridBodyCtrl:t,center:e}=this.ctrlsService.getParams(),n=t.getScrollFeature().getVScrollPosition(),i=this.gos.getScrollbarWidth();let r=n.bottom-n.top;return e.isHorizontalScrollShowing()&&(r-=i),r}isRowTallerThanView(t){const e=this.rowModel.getRow(t);if(!e)return!1;const n=e.rowHeight;return typeof n!="number"?!1:n>this.getViewportHeight()}onCtrlUpDownLeftRight(t,e){const n=this.cellNavigationService.getNextCellToFocus(t,e,!0),{rowIndex:i}=n,r=n.column;this.navigateTo({scrollIndex:i,scrollType:null,scrollColumn:r,focusIndex:i,focusColumn:r})}onHomeOrEndKey(t){const e=t===mn.PAGE_HOME,n=this.visibleColsService.getAllCols(),i=e?n[0]:Yr(n),r=e?this.pageBoundsService.getFirstRow():this.pageBoundsService.getLastRow();this.navigateTo({scrollIndex:r,scrollType:null,scrollColumn:i,focusIndex:r,focusColumn:i})}onTabKeyDown(t,e){const n=e.shiftKey,i=this.tabToNextCellCommon(t,n,e);if(i!==!1){i&&e.preventDefault();return}if(n){const{rowIndex:r,rowPinned:o}=t.getRowPosition();(o?r===0:r===this.pageBoundsService.getFirstRow())&&(this.gos.get("headerHeight")===0||this.gos.get("suppressHeaderFocus")?this.focusService.focusNextGridCoreContainer(!0,!0):(e.preventDefault(),this.focusService.focusPreviousFromFirstCell(e)))}else t instanceof r_&&t.focusCell(!0),this.focusService.focusNextGridCoreContainer(n)&&e.preventDefault()}tabToNextCell(t,e){const n=this.focusService.getFocusedCell();if(!n)return!1;let i=this.getCellByPosition(n);return!i&&(i=this.rowRenderer.getRowByPosition(n),!i||!i.isFullWidth())?!1:!!this.tabToNextCellCommon(i,t,e)}tabToNextCellCommon(t,e,n){let i=t.isEditing();if(!i&&t instanceof r_){const c=t.getRowCtrl();c&&(i=c.isEditing())}let r;return i?this.gos.get("editType")==="fullRow"?r=this.moveToNextEditingRow(t,e,n):r=this.moveToNextEditingCell(t,e,n):r=this.moveToNextCellNotEditing(t,e),r===null?r:r||!!this.focusService.getFocusedHeader()}moveToNextEditingCell(t,e,n=null){const i=t.getCellPosition();t.getGui().focus(),t.stopEditing();const r=this.findNextCellToFocusOn(i,e,!0);return r===!1?null:r==null?!1:(r.startEditing(null,!0,n),r.focusCell(!1),!0)}moveToNextEditingRow(t,e,n=null){const i=t.getCellPosition(),r=this.findNextCellToFocusOn(i,e,!0);if(r===!1)return null;if(r==null)return!1;const o=r.getCellPosition(),c=this.isCellEditable(i),s=this.isCellEditable(o),f=o&&i.rowIndex===o.rowIndex&&i.rowPinned===o.rowPinned;return c&&t.setFocusOutOnEditor(),f||(t.getRowCtrl().stopEditing(),r.getRowCtrl().startRowEditing(void 0,void 0,n)),s?(r.setFocusInOnEditor(),r.focusCell()):r.focusCell(!0),!0}moveToNextCellNotEditing(t,e){const n=this.visibleColsService.getAllCols();let i;t instanceof s_?i={...t.getRowPosition(),column:e?n[0]:Yr(n)}:i=t.getCellPosition();const r=this.findNextCellToFocusOn(i,e,!1);if(r===!1)return null;if(r instanceof r_)r.focusCell(!0);else if(r)return this.tryToFocusFullWidthRow(r.getRowPosition(),e);return $n(r)}findNextCellToFocusOn(t,e,n){var r;let i=t;for(;;){t!==i&&(t=i),e||(i=this.getLastCellOfColSpan(i)),i=this.cellNavigationService.getNextTabbedCell(i,e);const o=this.gos.getCallback("tabToNextCell");if($n(o)){const v=o({backwards:e,editing:n,previousCellPosition:t,nextCellPosition:i||null});if(v===!0||v===null)v===null&&Tn("Returning `null` from tabToNextCell is deprecated. Return `true` to stay on the current cell, or `false` to let the browser handle the tab behaviour."),i=t;else{if(v===!1)return!1;i={rowIndex:v.rowIndex,column:v.column,rowPinned:v.rowPinned}}}if(!i)return null;if(i.rowIndex<0){const f=this.headerNavigationService.getHeaderRowCount();return this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:f+i.rowIndex,column:i.column},fromCell:!0}),null}const c=this.gos.get("editType")==="fullRow";if(n&&!c&&!this.isCellEditable(i))continue;this.ensureCellVisible(i);const s=this.getCellByPosition(i);if(!s){const f=this.rowRenderer.getRowByPosition(i);if(!f||!f.isFullWidth()||n)continue;return f}if(!s.isSuppressNavigable())return(r=this.rangeService)==null||r.setRangeToCell(i),s}}isCellEditable(t){const e=this.lookupRowNodeForCell(t);return e?t.column.isCellEditable(e):!1}getCellByPosition(t){const e=this.rowRenderer.getRowByPosition(t);return e?e.getCellCtrl(t.column):null}lookupRowNodeForCell(t){return t.rowPinned==="top"?this.pinnedRowModel.getPinnedTopRow(t.rowIndex):t.rowPinned==="bottom"?this.pinnedRowModel.getPinnedBottomRow(t.rowIndex):this.rowModel.getRow(t.rowIndex)}navigateToNextCell(t,e,n,i){let r=n,o=!1;for(;r&&(r===n||!this.isValidNavigateCell(r));)this.gos.get("enableRtl")?e===mn.LEFT&&(r=this.getLastCellOfColSpan(r)):e===mn.RIGHT&&(r=this.getLastCellOfColSpan(r)),r=this.cellNavigationService.getNextCellToFocus(e,r),o=Hr(r);if(o&&t&&t.key===mn.UP&&(r={rowIndex:-1,rowPinned:null,column:n.column}),i){const s=this.gos.getCallback("navigateToNextCell");if($n(s)){const v=s({key:e,previousCellPosition:n,nextCellPosition:r||null,event:t});$n(v)?r={rowPinned:v.rowPinned,rowIndex:v.rowIndex,column:v.column}:r=null}}if(!r)return;if(r.rowIndex<0){const s=this.headerNavigationService.getHeaderRowCount();this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:s+r.rowIndex,column:n.column},event:t||void 0,fromCell:!0});return}const c=this.getNormalisedPosition(r);c?this.focusPosition(c):this.tryToFocusFullWidthRow(r)}getNormalisedPosition(t){this.ensureCellVisible(t);const e=this.getCellByPosition(t);return e?(t=e.getCellPosition(),this.ensureCellVisible(t),t):null}tryToFocusFullWidthRow(t,e=!1){const n=this.visibleColsService.getAllCols(),i=this.rowRenderer.getRowByPosition(t);if(!i||!i.isFullWidth())return!1;const r=this.focusService.getFocusedCell(),o={rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:t.column||(e?Yr(n):n[0])};this.focusPosition(o);const c=r!=null?this.rowPositionUtils.before(o,r):!1,s={type:"fullWidthRowFocused",rowIndex:o.rowIndex,rowPinned:o.rowPinned,column:o.column,isFullWidthCell:!0,fromBelow:c};return this.eventService.dispatchEvent(s),!0}focusPosition(t){var e;this.focusService.setFocusedCell({rowIndex:t.rowIndex,column:t.column,rowPinned:t.rowPinned,forceBrowserFocus:!0}),(e=this.rangeService)==null||e.setRangeToCell(t)}isValidNavigateCell(t){return!!this.rowPositionUtils.getRowNode(t)}getLastCellOfColSpan(t){const e=this.getCellByPosition(t);if(!e)return t;const n=e.getColSpanningList();return n.length===1?t:{rowIndex:t.rowIndex,column:Yr(n),rowPinned:t.rowPinned}}ensureCellVisible(t){const e=this.gos.isGroupRowsSticky(),n=this.rowModel.getRow(t.rowIndex);!(e&&(n==null?void 0:n.sticky))&&Hr(t.rowPinned)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(t.rowIndex),t.column.isPinned()||this.gridBodyCon.getScrollFeature().ensureColumnVisible(t.column)}},Ife=class extends wn{constructor(){super(...arguments),this.beanName="horizontalResizeService"}wireBeans(t){this.dragService=t.dragService,this.ctrlsService=t.ctrlsService}addResizeBar(t){const e={dragStartPixels:t.dragStartPixels||0,eElement:t.eResizeBar,onDragStart:this.onDragStart.bind(this,t),onDragStop:this.onDragStop.bind(this,t),onDragging:this.onDragging.bind(this,t),includeTouch:!0,stopPropagationForTouch:!0};return this.dragService.addDragSource(e),()=>this.dragService.removeDragSource(e)}onDragStart(t,e){this.dragStartX=e.clientX,this.setResizeIcons();const n=e instanceof MouseEvent&&e.shiftKey===!0;t.onResizeStart(n)}setResizeIcons(){const t=this.ctrlsService.get("gridCtrl");t.setResizeCursor(!0),t.disableUserSelect(!0)}onDragStop(t,e){t.onResizeEnd(this.resizeAmount),this.resetIcons()}resetIcons(){const t=this.ctrlsService.get("gridCtrl");t.setResizeCursor(!1),t.disableUserSelect(!1)}onDragging(t,e){this.resizeAmount=e.clientX-this.dragStartX,t.onResizing(this.resizeAmount)}},Dfe=class extends wn{constructor(){super(...arguments),this.beanName="filterMenuFactory"}wireBeans(t){this.popupService=t.popupService,this.focusService=t.focusService,this.ctrlsService=t.ctrlsService,this.menuService=t.menuService}hideActiveMenu(){this.hidePopup&&this.hidePopup()}showMenuAfterMouseEvent(t,e,n){this.showPopup(t,i=>{this.popupService.positionPopupUnderMouseEvent({column:t,type:n,mouseEvent:e,ePopup:i})},n,e.target,this.menuService.isLegacyMenuEnabled())}showMenuAfterButtonClick(t,e,n){let i=-1,r="left";const o=this.menuService.isLegacyMenuEnabled();!o&&this.gos.get("enableRtl")&&(i=1,r="right");const c=o?void 0:4*i,s=o?void 0:4;this.showPopup(t,f=>{this.popupService.positionPopupByComponent({type:n,eventSource:e,ePopup:f,nudgeX:c,nudgeY:s,alignSide:r,keepWithinBounds:!0,position:"under",column:t})},n,e,o)}showPopup(t,e,n,i,r){const o=t?this.createBean(new che(t,"COLUMN_MENU")):void 0;if(this.activeMenu=o,!(o!=null&&o.hasFilter())||!t)throw new Error("AG Grid - unable to show popup filter, filter instantiation failed");const c=document.createElement("div");ld(c,"presentation"),c.classList.add("ag-menu"),r||c.classList.add("ag-filter-menu"),[this.tabListener]=this.addManagedElementListeners(c,{keydown:N=>this.trapFocusWithin(N,c)}),c.appendChild(o==null?void 0:o.getGui());let s;const f=()=>o==null?void 0:o.afterGuiDetached(),v=this.menuService.isColumnMenuAnchoringEnabled()?i??this.ctrlsService.getGridBodyCtrl().getGui():void 0,w=N=>{t.setMenuVisible(!1,"contextMenu");const z=N instanceof KeyboardEvent;if(this.tabListener&&(this.tabListener=this.tabListener()),z&&i&&Ef(i)){const L=this.focusService.findTabbableParent(i);L&&L.focus()}f(),this.destroyBean(this.activeMenu),this.dispatchVisibleChangedEvent(!1,n,t)},C=this.localeService.getLocaleTextFunc(),M=r&&n!=="columnFilter"?C("ariaLabelColumnMenu","Column Menu"):C("ariaLabelColumnFilter","Column Filter"),F=this.popupService.addPopup({modal:!0,eChild:c,closeOnEsc:!0,closedCallback:w,positionCallback:()=>e(c),anchorToElement:v,ariaLabel:M});F&&(this.hidePopup=s=F.hideFunc),o.afterInit().then(()=>{e(c),o.afterGuiAttached({container:n,hidePopup:s})}),t.setMenuVisible(!0,"contextMenu"),this.dispatchVisibleChangedEvent(!0,n,t)}trapFocusWithin(t,e){t.key!==mn.TAB||t.defaultPrevented||this.focusService.findNextFocusableElement(e,!1,t.shiftKey)||(t.preventDefault(),this.focusService.focusInto(e,t.shiftKey))}dispatchVisibleChangedEvent(t,e,n){const i={type:"columnMenuVisibleChanged",visible:t,switchingTab:!1,key:e,column:n??null};this.eventService.dispatchEvent(i)}isMenuEnabled(t){return t.isFilterAllowed()&&(t.getColDef().menuTabs??["filterMenuTab"]).includes("filterMenuTab")}showMenuAfterContextMenuEvent(){}destroy(){this.destroyBean(this.activeMenu),super.destroy()}},Ffe=50,Lfe=class extends wn{constructor(){super(...arguments),this.beanName="resizeObserverService",this.polyfillFunctions=[]}observeResize(t,e){const n=this.gos.getWindow(),i=()=>{const s=new n.ResizeObserver(e);return s.observe(t),()=>s.disconnect()},r=()=>{let s=(t==null?void 0:t.clientWidth)??0,f=(t==null?void 0:t.clientHeight)??0,v=!0;const w=()=>{if(v){const C=(t==null?void 0:t.clientWidth)??0,M=(t==null?void 0:t.clientHeight)??0;(C!==s||M!==f)&&(s=C,f=M,e()),this.doNextPolyfillTurn(w)}};return w(),()=>v=!1},o=this.gos.get("suppressBrowserResizeObserver");return!!n.ResizeObserver&&!o?i():this.getFrameworkOverrides().wrapIncoming(()=>r(),"resize-observer")}doNextPolyfillTurn(t){this.polyfillFunctions.push(t),this.schedulePolyfill()}schedulePolyfill(){if(this.polyfillScheduled)return;const t=()=>{const e=this.polyfillFunctions;this.polyfillScheduled=!1,this.polyfillFunctions=[],e.forEach(n=>n())};this.polyfillScheduled=!0,window.setTimeout(t,Ffe)}},Ofe=class extends wn{constructor(){super(...arguments),this.beanName="animationFrameService",this.createTasksP1={list:[],sorted:!1},this.createTasksP2={list:[],sorted:!1},this.destroyTasks=[],this.ticking=!1,this.scrollGoingDown=!0,this.lastPage=0,this.lastScrollTop=0,this.taskCount=0,this.cancelledTasks=new Set}wireBeans(t){this.ctrlsService=t.ctrlsService,this.paginationService=t.paginationService}setScrollTop(t){var n;const e=this.gos.get("pagination");if(this.scrollGoingDown=t>=this.lastScrollTop,e&&t===0){const i=((n=this.paginationService)==null?void 0:n.getCurrentPage())??0;i!==this.lastPage&&(this.lastPage=i,this.scrollGoingDown=!0)}this.lastScrollTop=t}postConstruct(){this.useAnimationFrame=!this.gos.get("suppressAnimationFrame")}isOn(){return this.useAnimationFrame}verifyAnimationFrameOn(t){this.useAnimationFrame===!1&&Tn(`AnimationFrameService.${t} called but animation frames are off`)}createTask(t,e,n){this.verifyAnimationFrameOn(n);const i={task:t,index:e,createOrder:++this.taskCount};this.addTaskToList(this[n],i),this.schedule()}cancelTask(t){this.cancelledTasks.add(t)}addTaskToList(t,e){t.list.push(e),t.sorted=!1}sortTaskList(t){if(t.sorted)return;const e=this.scrollGoingDown?1:-1;t.list.sort((n,i)=>n.index!==i.index?e*(i.index-n.index):i.createOrder-n.createOrder),t.sorted=!0}addDestroyTask(t){this.verifyAnimationFrameOn("createTasksP3"),this.destroyTasks.push(t),this.schedule()}executeFrame(t){this.verifyAnimationFrameOn("executeFrame");const e=this.createTasksP1,n=e.list,i=this.createTasksP2,r=i.list,o=this.destroyTasks,c=new Date().getTime();let s=new Date().getTime()-c;const f=t<=0,v=this.ctrlsService.getGridBodyCtrl();for(;f||s<t;){if(!v.getScrollFeature().scrollGridIfNeeded()){let C;if(n.length)this.sortTaskList(e),C=n.pop().task;else if(r.length)this.sortTaskList(i),C=r.pop().task;else if(o.length)C=o.pop();else{this.cancelledTasks.clear();break}this.cancelledTasks.has(C)||C()}s=new Date().getTime()-c}n.length||r.length||o.length?this.requestFrame():this.stopTicking()}stopTicking(){this.ticking=!1}flushAllFrames(){this.useAnimationFrame&&this.executeFrame(-1)}schedule(){this.useAnimationFrame&&(this.ticking||(this.ticking=!0,this.requestFrame()))}requestFrame(){const t=this.executeFrame.bind(this,60);this.requestAnimationFrame(t)}requestAnimationFrame(t){const e=this.gos.getWindow();e.requestAnimationFrame?e.requestAnimationFrame(t):e.webkitRequestAnimationFrame?e.webkitRequestAnimationFrame(t):e.setTimeout(t,0)}isQueueEmpty(){return!this.ticking}debounce(t){let e=!1;return()=>{if(!this.isOn()){window.setTimeout(t,0);return}e||(e=!0,this.addDestroyTask(()=>{e=!1,t()}))}}},kfe=class extends wn{constructor(){super(...arguments),this.beanName="expansionService"}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.isClientSideRowModel=this.rowModel.getType()==="clientSide"}expandRows(t){if(!this.isClientSideRowModel)return;const e=new Set(t);this.rowModel.forEachNode(n=>{n.id&&e.has(n.id)&&(n.expanded=!0)}),this.onGroupExpandedOrCollapsed()}getExpandedRows(){const t=[];return this.rowModel.forEachNode(({expanded:e,id:n})=>{e&&n&&t.push(n)}),t}expandAll(t){this.isClientSideRowModel&&this.rowModel.expandOrCollapseAll(t)}setRowNodeExpanded(t,e,n,i){t&&(n&&t.parent&&t.parent.level!==-1&&this.setRowNodeExpanded(t.parent,e,n,i),t.setExpanded(e,void 0,i))}onGroupExpandedOrCollapsed(){this.isClientSideRowModel&&this.rowModel.refreshModel({step:"map"})}},Nfe=class extends wn{constructor(){super(...arguments),this.beanName="menuService"}wireBeans(t){this.filterMenuFactory=t.filterMenuFactory,this.ctrlsService=t.ctrlsService,this.animationFrameService=t.animationFrameService,this.filterManager=t.filterManager,this.rowRenderer=t.rowRenderer,this.columnChooserFactory=t.columnChooserFactory,this.contextMenuFactory=t.contextMenuFactory,this.enterpriseMenuFactory=t.enterpriseMenuFactory}postConstruct(){this.activeMenuFactory=this.enterpriseMenuFactory??this.filterMenuFactory}showColumnMenu(t){this.showColumnMenuCommon(this.activeMenuFactory,t,"columnMenu")}showFilterMenu(t){const e=this.enterpriseMenuFactory&&this.isLegacyMenuEnabled()?this.enterpriseMenuFactory:this.filterMenuFactory;this.showColumnMenuCommon(e,t,t.containerType,!0)}showHeaderContextMenu(t,e,n){this.activeMenuFactory.showMenuAfterContextMenuEvent(t,e,n)}getContextMenuPosition(t,e){const n=this.getRowCtrl(t),i=this.getCellGui(n,e);if(!i)return n?{x:0,y:n.getRowYPosition()}:{x:0,y:0};const r=i.getBoundingClientRect();return{x:r.x+r.width/2,y:r.y+r.height/2}}showContextMenu(t){var o;const{rowNode:e}=t,n=t.column;let{anchorToElement:i,value:r}=t;e&&n&&r==null&&(r=e.getValueFromValueService(n)),i==null&&(i=this.getContextMenuAnchorElement(e,n)),(o=this.contextMenuFactory)==null||o.onContextMenu(t.mouseEvent??null,t.touchEvent??null,e??null,n??null,r,i)}showColumnChooser(t){var e;(e=this.columnChooserFactory)==null||e.showColumnChooser(t)}hidePopupMenu(){var t;(t=this.contextMenuFactory)==null||t.hideActiveMenu(),this.activeMenuFactory.hideActiveMenu()}hideColumnChooser(){var t;(t=this.columnChooserFactory)==null||t.hideActiveColumnChooser()}isColumnMenuInHeaderEnabled(t){const{suppressMenu:e,suppressHeaderMenuButton:n}=t.getColDef();return!(n??e)&&this.activeMenuFactory.isMenuEnabled(t)&&(this.isLegacyMenuEnabled()||!!this.enterpriseMenuFactory)}isFilterMenuInHeaderEnabled(t){var e;return!t.getColDef().suppressHeaderFilterButton&&!!((e=this.filterManager)!=null&&e.isFilterAllowed(t))}isHeaderContextMenuEnabled(t){return!(t!=null&&t.getColDef().suppressHeaderContextMenu)&&this.getColumnMenuType()==="new"}isHeaderMenuButtonAlwaysShowEnabled(){return this.isSuppressMenuHide()}isHeaderMenuButtonEnabled(){const t=!this.isSuppressMenuHide();return!(wv()&&t)}isHeaderFilterButtonEnabled(t){return this.isFilterMenuInHeaderEnabled(t)&&!this.isLegacyMenuEnabled()&&!this.isFloatingFilterButtonDisplayed(t)}isFilterMenuItemEnabled(t){var e;return!!((e=this.filterManager)!=null&&e.isFilterAllowed(t))&&!this.isLegacyMenuEnabled()&&!this.isFilterMenuInHeaderEnabled(t)&&!this.isFloatingFilterButtonDisplayed(t)}isColumnMenuAnchoringEnabled(){return!this.isLegacyMenuEnabled()}areAdditionalColumnMenuItemsEnabled(){return this.getColumnMenuType()==="new"}isLegacyMenuEnabled(){return this.getColumnMenuType()==="legacy"}isFloatingFilterButtonEnabled(t){var i;const e=t.getColDef(),n=(i=e.floatingFilterComponentParams)==null?void 0:i.suppressFilterButton;return n!=null&&Tn("As of v31.1, 'colDef.floatingFilterComponentParams.suppressFilterButton' is deprecated. Use 'colDef.suppressFloatingFilterButton' instead."),e.suppressFloatingFilterButton==null?!n:!e.suppressFloatingFilterButton}getColumnMenuType(){return this.gos.get("columnMenu")}isFloatingFilterButtonDisplayed(t){return!!t.getColDef().floatingFilter&&this.isFloatingFilterButtonEnabled(t)}isSuppressMenuHide(){const t=this.gos.get("suppressMenuHide");return this.isLegacyMenuEnabled()?this.gos.exists("suppressMenuHide")?t:!1:t}showColumnMenuCommon(t,e,n,i){const{positionBy:r}=e,o=e.column;if(r==="button"){const{buttonElement:c}=e;t.showMenuAfterButtonClick(o,c,n,i)}else if(r==="mouse"){const{mouseEvent:c}=e;t.showMenuAfterMouseEvent(o,c,n,i)}else o&&(this.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(o,"auto"),this.animationFrameService.requestAnimationFrame(()=>{const c=this.ctrlsService.getHeaderRowContainerCtrl(o.getPinned()).getHeaderCtrlForColumn(o);t.showMenuAfterButtonClick(o,c.getAnchorElementForMenu(i),n,!0)}))}getRowCtrl(t){const{rowIndex:e,rowPinned:n}=t||{};if(e!=null)return this.rowRenderer.getRowByPosition({rowIndex:e,rowPinned:n})||void 0}getCellGui(t,e){if(!t||!e)return;const n=t.getCellCtrl(e);return(n==null?void 0:n.getGui())||void 0}getContextMenuAnchorElement(t,e){const n=this.ctrlsService.getGridBodyCtrl().getGridBodyElement(),i=this.getRowCtrl(t);if(!i)return n;const r=this.getCellGui(i,e);return r||(i.isFullWidth()?i.getFullWidthElement():n)}},Bfe=class extends zy{constructor(t){super(t,"ag-text-area",null,"textarea")}setValue(t,e){const n=super.setValue(t,e);return this.eInput.value=t,n}setCols(t){return this.eInput.cols=t,this}setRows(t){return this.eInput.rows=t,this}},zfe={selector:"AG-INPUT-TEXT-AREA",component:Bfe},Ufe=class extends bw{constructor(){super(`<div class="ag-large-text">
        <ag-input-text-area data-ref="eTextArea" class="ag-large-text-input"></ag-input-text-area>
        </div>`,[zfe]),this.eTextArea=qi}init(t){this.params=t,this.focusAfterAttached=t.cellStartedEdit,this.eTextArea.setMaxLength(t.maxLength||200).setCols(t.cols||60).setRows(t.rows||10),$n(t.value,!0)&&this.eTextArea.setValue(t.value.toString(),!0),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.activateTabIndex()}onKeyDown(t){const e=t.key;(e===mn.LEFT||e===mn.UP||e===mn.RIGHT||e===mn.DOWN||t.shiftKey&&e===mn.ENTER)&&t.stopPropagation()}afterGuiAttached(){const t=this.localeService.getLocaleTextFunc();this.eTextArea.setInputAriaLabel(t("ariaInputEditor","Input Editor")),this.focusAfterAttached&&this.eTextArea.getFocusableElement().focus()}getValue(){const t=this.eTextArea.getValue();return!$n(t)&&!$n(this.params.value)?this.params.value:this.params.parseValue(t)}},Vfe=class extends bw{constructor(t){super('<div class="ag-popup-editor" tabindex="-1"/>'),this.params=t}postConstruct(){this.gos.setDomData(this.getGui(),"popupEditorWrapper",!0),this.addKeyDownListener()}addKeyDownListener(){const t=this.getGui(),e=this.params,n=i=>{AL(this.gos,i,e.node,e.column,!0)||e.onKeyDown(i)};this.addManagedElementListeners(t,{keydown:n})}},Gfe=class extends bw{constructor(){super(`<div class="ag-cell-edit-wrapper">
                <ag-select class="ag-cell-editor" data-ref="eSelect"></ag-select>
            </div>`,[ghe]),this.eSelect=qi,this.startedByEnter=!1}wireBeans(t){this.valueService=t.valueService}init(t){this.focusAfterAttached=t.cellStartedEdit;const{eSelect:e,valueService:n,gos:i}=this,{values:r,value:o,eventKey:c}=t;if(Hr(r)){Tn("no values found for select cellEditor");return}this.startedByEnter=c!=null?c===mn.ENTER:!1;let s=!1;r.forEach(C=>{const M={value:C},F=n.formatValue(t.column,null,C),N=F!=null;M.text=N?F:C,e.addOption(M),s=s||o===C}),s?e.setValue(t.value,!0):t.values.length&&e.setValue(t.values[0],!0);const{valueListGap:f,valueListMaxWidth:v,valueListMaxHeight:w}=t;f!=null&&e.setPickerGap(f),w!=null&&e.setPickerMaxHeight(w),v!=null&&e.setPickerMaxWidth(v),i.get("editType")!=="fullRow"&&this.addManagedListeners(this.eSelect,{selectedItem:()=>t.stopEditing()})}afterGuiAttached(){this.focusAfterAttached&&this.eSelect.getFocusableElement().focus(),this.startedByEnter&&setTimeout(()=>{this.isAlive()&&this.eSelect.showPicker()})}focusIn(){this.eSelect.getFocusableElement().focus()}getValue(){return this.eSelect.getValue()}isPopup(){return!1}},LA=class extends bw{constructor(t){super(`
            <div class="ag-cell-edit-wrapper">
                ${t.getTemplate()}
            </div>`,t.getAgComponents()),this.cellEditorInput=t,this.eInput=qi}init(t){this.params=t;const e=this.eInput;this.cellEditorInput.init(e,t);let n;if(t.cellStartedEdit){this.focusAfterAttached=!0;const i=t.eventKey;i===mn.BACKSPACE||t.eventKey===mn.DELETE?n="":i&&i.length===1?n=i:(n=this.cellEditorInput.getStartValue(),i!==mn.F2&&(this.highlightAllOnFocus=!0))}else this.focusAfterAttached=!1,n=this.cellEditorInput.getStartValue();n!=null&&e.setStartValue(n),this.addManagedElementListeners(e.getGui(),{keydown:i=>{const{key:r}=i;(r===mn.PAGE_UP||r===mn.PAGE_DOWN)&&i.preventDefault()}})}afterGuiAttached(){var i,r;const t=this.localeService.getLocaleTextFunc(),e=this.eInput;if(e.setInputAriaLabel(t("ariaInputEditor","Input Editor")),!this.focusAfterAttached)return;Qp()||e.getFocusableElement().focus();const n=e.getInputElement();this.highlightAllOnFocus?n.select():(r=(i=this.cellEditorInput).setCaret)==null||r.call(i)}focusIn(){const t=this.eInput,e=t.getFocusableElement(),n=t.getInputElement();e.focus(),n.select()}getValue(){return this.cellEditorInput.getValue()}isPopup(){return!1}},Hfe=class{getTemplate(){return'<ag-input-text-field class="ag-cell-editor" data-ref="eInput"></ag-input-text-field>'}getAgComponents(){return[DA]}init(t,e){this.eInput=t,this.params=e,e.maxLength!=null&&t.setMaxLength(e.maxLength)}getValue(){const t=this.eInput.getValue();return!$n(t)&&!$n(this.params.value)?this.params.value:this.params.parseValue(t)}getStartValue(){return this.params.useFormatter||this.params.column.getColDef().refData?this.params.formatValue(this.params.value):this.params.value}setCaret(){const t=this.eInput.getValue(),e=$n(t)&&t.length||0;e&&this.eInput.getInputElement().setSelectionRange(e,e)}},uq=class extends LA{constructor(){super(new Hfe)}},Wfe=class{getTemplate(){return'<ag-input-number-field class="ag-cell-editor" data-ref="eInput"></ag-input-number-field>'}getAgComponents(){return[Mhe]}init(t,e){this.eInput=t,this.params=e,e.max!=null&&t.setMax(e.max),e.min!=null&&t.setMin(e.min),e.precision!=null&&t.setPrecision(e.precision),e.step!=null&&t.setStep(e.step);const n=t.getInputElement();e.preventStepping?t.addManagedElementListeners(n,{keydown:this.preventStepping}):e.showStepperButtons&&n.classList.add("ag-number-field-input-stepper")}preventStepping(t){(t.key===mn.UP||t.key===mn.DOWN)&&t.preventDefault()}getValue(){const t=this.eInput.getValue();if(!$n(t)&&!$n(this.params.value))return this.params.value;let e=this.params.parseValue(t);if(e==null)return e;if(typeof e=="string"){if(e==="")return null;e=Number(e)}return isNaN(e)?null:e}getStartValue(){return this.params.value}},jfe=class extends LA{constructor(){super(new Wfe)}},$fe=class extends z_{constructor(t){super(t,"ag-date-field","date")}postConstruct(){super.postConstruct();const t=Qp();this.addManagedListeners(this.eInput,{wheel:this.onWheel.bind(this),mousedown:()=>{this.isDisabled()||t||this.eInput.focus()}}),this.eInput.step="any"}onWheel(t){this.gos.getActiveDomElement()===this.eInput&&t.preventDefault()}setMin(t){const e=t instanceof Date?eh(t??null,!1)??void 0:t;return this.min===e?this:(this.min=e,Up(this.eInput,"min",e),this)}setMax(t){const e=t instanceof Date?eh(t??null,!1)??void 0:t;return this.max===e?this:(this.max=e,Up(this.eInput,"max",e),this)}setStep(t){return this.step===t?this:(this.step=t,Up(this.eInput,"step",t),this)}getDate(){if(this.eInput.validity.valid)return Oc(this.getValue())??void 0}setDate(t,e){this.setValue(eh(t??null,!1),e)}},hq={selector:"AG-INPUT-DATE-FIELD",component:$fe},qfe=class{getTemplate(){return'<ag-input-date-field class="ag-cell-editor" data-ref="eInput"></ag-input-date-field>'}getAgComponents(){return[hq]}init(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)}getValue(){const t=this.eInput.getDate();return!$n(t)&&!$n(this.params.value)?this.params.value:t??null}getStartValue(){const{value:t}=this.params;if(t instanceof Date)return eh(t,!1)}},Zfe=class extends LA{constructor(){super(new qfe)}},Xfe=class{constructor(t){this.getDataTypeService=t}getTemplate(){return'<ag-input-date-field class="ag-cell-editor" data-ref="eInput"></ag-input-date-field>'}getAgComponents(){return[hq]}init(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)}getValue(){const t=this.formatDate(this.eInput.getDate());return!$n(t)&&!$n(this.params.value)?this.params.value:this.params.parseValue(t??"")}getStartValue(){return eh(this.parseDate(this.params.value??void 0)??null,!1)}parseDate(t){const e=this.getDataTypeService();return e?e.getDateParserFunction(this.params.column)(t):Oc(t)??void 0}formatDate(t){const e=this.getDataTypeService();return e?e.getDateFormatterFunction(this.params.column)(t):eh(t??null,!1)??void 0}},Kfe=class extends LA{wireBeans(t){this.dataTypeService=t.dataTypeService}constructor(){super(new Xfe(()=>this.dataTypeService))}},Yfe=class extends bw{constructor(){super(`
            <div class="ag-cell-wrapper ag-cell-edit-wrapper ag-checkbox-edit">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[R3]),this.eCheckbox=qi}init(t){this.params=t;const e=t.value??void 0;this.eCheckbox.setValue(e),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.setAriaLabel(e),this.addManagedListeners(this.eCheckbox,{fieldValueChanged:i=>this.setAriaLabel(i.selected)})}getValue(){return this.eCheckbox.getValue()}focusIn(){this.eCheckbox.getFocusableElement().focus()}afterGuiAttached(){this.params.cellStartedEdit&&this.focusIn()}isPopup(){return!1}setAriaLabel(t){const e=this.localeService.getLocaleTextFunc(),n=_3(e,t),i=e("ariaToggleCellValue","Press SPACE to toggle cell value");this.eCheckbox.setInputAriaLabel(`${i} (${n})`)}},o1=class{constructor(t){this.cellValueChanges=t}},RD=class extends o1{constructor(t,e,n,i){super(t),this.initialRange=e,this.finalRange=n,this.ranges=i}},Jfe=10,J5=class{constructor(t){this.actionStack=[],this.maxStackSize=t||Jfe,this.actionStack=new Array(this.maxStackSize)}pop(){return this.actionStack.pop()}push(t){t.cellValueChanges&&t.cellValueChanges.length>0&&(this.actionStack.length===this.maxStackSize&&this.actionStack.shift(),this.actionStack.push(t))}clear(){this.actionStack=[]}getCurrentStackSize(){return this.actionStack.length}},Qfe=class extends wn{constructor(){super(...arguments),this.beanName="undoRedoService",this.cellValueChanges=[],this.activeCellEdit=null,this.activeRowEdit=null,this.isPasting=!1,this.isRangeInAction=!1,this.onCellValueChanged=t=>{const e={column:t.column,rowIndex:t.rowIndex,rowPinned:t.rowPinned},n=this.activeCellEdit!==null&&this.cellPositionUtils.equals(this.activeCellEdit,e),i=this.activeRowEdit!==null&&this.rowPositionUtils.sameRow(this.activeRowEdit,e);if(!(n||i||this.isPasting||this.isRangeInAction))return;const{rowPinned:o,rowIndex:c,column:s,oldValue:f,value:v}=t,w={rowPinned:o,rowIndex:c,columnId:s.getColId(),newValue:v,oldValue:f};this.cellValueChanges.push(w)},this.clearStacks=()=>{this.undoStack.clear(),this.redoStack.clear()}}wireBeans(t){this.focusService=t.focusService,this.ctrlsService=t.ctrlsService,this.cellPositionUtils=t.cellPositionUtils,this.rowPositionUtils=t.rowPositionUtils,this.columnModel=t.columnModel,this.rangeService=t.rangeService}postConstruct(){if(!this.gos.get("undoRedoCellEditing"))return;const t=this.gos.get("undoRedoCellEditingLimit");if(t<=0)return;this.undoStack=new J5(t),this.redoStack=new J5(t),this.addListeners();const e=this.clearStacks.bind(this);this.addManagedEventListeners({cellValueChanged:this.onCellValueChanged.bind(this),modelUpdated:n=>{n.keepUndoRedoStack||this.clearStacks()},columnPivotModeChanged:e,newColumnsLoaded:e,columnGroupOpened:e,columnRowGroupChanged:e,columnMoved:e,columnPinned:e,columnVisible:e,rowDragEnd:e}),this.ctrlsService.whenReady(n=>{this.gridBodyCtrl=n.gridBodyCtrl})}getCurrentUndoStackSize(){return this.undoStack?this.undoStack.getCurrentStackSize():0}getCurrentRedoStackSize(){return this.redoStack?this.redoStack.getCurrentStackSize():0}undo(t){const e={type:"undoStarted",source:t};this.eventService.dispatchEvent(e);const n=this.undoRedo(this.undoStack,this.redoStack,"initialRange","oldValue","undo"),i={type:"undoEnded",source:t,operationPerformed:n};this.eventService.dispatchEvent(i)}redo(t){const e={type:"redoStarted",source:t};this.eventService.dispatchEvent(e);const n=this.undoRedo(this.redoStack,this.undoStack,"finalRange","newValue","redo"),i={type:"redoEnded",source:t,operationPerformed:n};this.eventService.dispatchEvent(i)}undoRedo(t,e,n,i,r){if(!t)return!1;const o=t.pop();return!o||!o.cellValueChanges?!1:(this.processAction(o,c=>c[i],r),o instanceof RD?this.processRange(this.rangeService,o.ranges||[o[n]]):this.processCell(o.cellValueChanges),e.push(o),!0)}processAction(t,e,n){t.cellValueChanges.forEach(i=>{const{rowIndex:r,rowPinned:o,columnId:c}=i,s={rowIndex:r,rowPinned:o},f=this.rowPositionUtils.getRowNode(s);f.displayed&&f.setDataValue(c,e(i),n)})}processRange(t,e){let n;t.removeAllCellRanges(!0),e.forEach((i,r)=>{if(!i)return;const o=i.startRow,c=i.endRow;r===e.length-1&&(n={rowPinned:o.rowPinned,rowIndex:o.rowIndex,columnId:i.startColumn.getColId()},this.setLastFocusedCell(n));const s={rowStartIndex:o.rowIndex,rowStartPinned:o.rowPinned,rowEndIndex:c.rowIndex,rowEndPinned:c.rowPinned,columnStart:i.startColumn,columns:i.columns};t.addCellRange(s)})}processCell(t){const e=t[0],{rowIndex:n,rowPinned:i}=e,r={rowIndex:n,rowPinned:i},o=this.rowPositionUtils.getRowNode(r),c={rowPinned:e.rowPinned,rowIndex:o.rowIndex,columnId:e.columnId};this.setLastFocusedCell(c,this.rangeService)}setLastFocusedCell(t,e){const{rowIndex:n,columnId:i,rowPinned:r}=t,o=this.gridBodyCtrl.getScrollFeature(),c=this.columnModel.getCol(i);if(!c)return;o.ensureIndexVisible(n),o.ensureColumnVisible(c);const s={rowIndex:n,column:c,rowPinned:r};this.focusService.setFocusedCell({...s,forceBrowserFocus:!0}),e==null||e.setRangeToCell(s)}addListeners(){this.addManagedEventListeners({rowEditingStarted:t=>{this.activeRowEdit={rowIndex:t.rowIndex,rowPinned:t.rowPinned}},rowEditingStopped:()=>{const t=new o1(this.cellValueChanges);this.pushActionsToUndoStack(t),this.activeRowEdit=null},cellEditingStarted:t=>{this.activeCellEdit={column:t.column,rowIndex:t.rowIndex,rowPinned:t.rowPinned}},cellEditingStopped:t=>{if(this.activeCellEdit=null,t.valueChanged&&!this.activeRowEdit&&!this.isPasting&&!this.isRangeInAction){const n=new o1(this.cellValueChanges);this.pushActionsToUndoStack(n)}},pasteStart:()=>{this.isPasting=!0},pasteEnd:()=>{const t=new o1(this.cellValueChanges);this.pushActionsToUndoStack(t),this.isPasting=!1},fillStart:()=>{this.isRangeInAction=!0},fillEnd:t=>{const e=new RD(this.cellValueChanges,t.initialRange,t.finalRange);this.pushActionsToUndoStack(e),this.isRangeInAction=!1},keyShortcutChangedCellStart:()=>{this.isRangeInAction=!0},keyShortcutChangedCellEnd:()=>{let t;this.rangeService&&this.gos.get("enableRangeSelection")?t=new RD(this.cellValueChanges,void 0,void 0,[...this.rangeService.getCellRanges()]):t=new o1(this.cellValueChanges),this.pushActionsToUndoStack(t),this.isRangeInAction=!1}})}pushActionsToUndoStack(t){this.undoStack.push(t),this.cellValueChanges=[],this.redoStack.clear()}};function epe(t){return t.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition()}function tpe(t){return t.ctrlsService.getGridBodyCtrl().getScrollFeature().getHScrollPosition()}function dq(t,e,n="auto"){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(e,n),"ensureVisible")}function fq(t,e,n){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureIndexVisible(e,n),"ensureVisible")}function npe(t,e,n=null){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureNodeVisible(e,n),"ensureVisible")}function ipe(t){var e;(e=t.undoRedoService)==null||e.undo("api")}function rpe(t){var e;(e=t.undoRedoService)==null||e.redo("api")}function spe(t,e={}){return t.rowRenderer.getCellEditorInstances(e).map(S1)}function ope(t){return t.rowRenderer.getEditingCells()}function ape(t,e=!1){t.rowRenderer.stopEditing(e)}function lpe(t,e){const n=t.columnModel.getCol(e.colKey);if(!n){Tn(`no column found for ${e.colKey}`);return}const i={rowIndex:e.rowIndex,rowPinned:e.rowPinned||null,column:n};e.rowPinned==null&&fq(t,e.rowIndex),dq(t,e.colKey);const o=t.navigationService.getCellByPosition(i);o&&(t.focusService.isCellFocused(i)||t.focusService.setFocusedCell(i),o.startRowOrCellEdit(e.key))}function cpe(t){var e;return((e=t.undoRedoService)==null?void 0:e.getCurrentUndoStackSize())??0}function upe(t){var e;return((e=t.undoRedoService)==null?void 0:e.getCurrentRedoStackSize())??0}var hpe=class extends wn{constructor(){super(...arguments),this.beanName="editService"}wireBeans(t){this.navigationService=t.navigationService,this.userComponentFactory=t.userComponentFactory,this.valueService=t.valueService}startEditing(t,e=null,n=!1,i=null){const r=this.createCellEditorParams(t,e,n),o=t.getColumn().getColDef(),c=this.userComponentFactory.getCellEditorDetails(o,r),s=(c==null?void 0:c.popupFromSelector)!=null?c.popupFromSelector:!!o.cellEditorPopup,f=(c==null?void 0:c.popupPositionFromSelector)!=null?c.popupPositionFromSelector:o.cellEditorPopupPosition;t.setEditing(!0,c),t.getComp().setEditDetails(c,s,f,this.gos.get("reactiveCustomComponents"));const v=t.createEvent(i,"cellEditingStarted");this.eventService.dispatchEvent(v)}stopEditing(t,e){const n=t.getComp(),{newValue:i,newValueExists:r}=this.takeValueFromCellEditor(e,n),o=t.getRowNode(),c=t.getColumn(),s=o.getValueFromValueService(c);let f=!1;r&&(f=this.saveNewValue(t,s,i,o,c)),t.setEditing(!1,void 0),n.setEditDetails(),t.updateAndFormatValue(!1),t.refreshCell({forceRefresh:!0,suppressFlash:!0});const v={...t.createEvent(null,"cellEditingStopped"),oldValue:s,newValue:i,valueChanged:f};return this.eventService.dispatchEvent(v),f}handleColDefChanged(t){const e=t.getCellEditor();if(e!=null&&e.refresh){const{eventKey:n,cellStartedEdit:i}=t.getEditCompDetails().params,r=this.createCellEditorParams(t,n,i),o=t.getColumn().getColDef(),c=this.userComponentFactory.getCellEditorDetails(o,r);e.refresh(c.params)}}setFocusOutOnEditor(t){const e=t.getComp().getCellEditor();e&&e.focusOut&&e.focusOut()}setFocusInOnEditor(t){const e=t.getComp().getCellEditor();e&&e.focusIn?e.focusIn():t.focusCell(!0)}stopEditingAndFocus(t,e=!1,n=!1){t.stopRowOrCellEdit(),t.focusCell(!0),e||this.navigateAfterEdit(n,t.getCellPosition())}createPopupEditorWrapper(t){return new Vfe(t)}takeValueFromCellEditor(t,e){const n={newValueExists:!1};if(t)return n;const i=e.getCellEditor();return!i||i.isCancelAfterEnd&&i.isCancelAfterEnd()?n:{newValue:i.getValue(),newValueExists:!0}}saveNewValue(t,e,n,i,r){if(n===e)return!1;t.setSuppressRefreshCell(!0);const o=i.setDataValue(r,n,"edit");return t.setSuppressRefreshCell(!1),o}createCellEditorParams(t,e,n){const i=t.getColumn(),r=t.getRowNode();return this.gos.addGridCommonParams({value:r.getValueFromValueService(i),eventKey:e,column:i,colDef:i.getColDef(),rowIndex:t.getCellPosition().rowIndex,node:r,data:r.data,cellStartedEdit:n,onKeyDown:t.onKeyDown.bind(t),stopEditing:t.stopEditingAndFocus.bind(t),eGridCell:t.getGui(),parseValue:o=>this.valueService.parseValue(i,r,o,t.getValue()),formatValue:t.formatValue.bind(t)})}navigateAfterEdit(t,e){if(this.gos.get("enterNavigatesVerticallyAfterEdit")){const i=t?mn.UP:mn.DOWN;this.navigationService.navigateToNextCell(null,i,e,!1)}}},dpe=class extends wn{constructor(){super(...arguments),this.beanName="rowEditService"}startEditing(t,e=null,n=null,i=null){t.getAllCellCtrls().reduce((o,c)=>{const s=c===n;return s?c.startEditing(e,s,i):c.startEditing(null,s,i),o?!0:c.isEditing()},!1)&&this.setEditing(t,!0)}stopEditing(t,e=!1){const n=t.getAllCellCtrls(),i=t.isEditing();t.setStoppingRowEdit(!0);let r=!1;for(const o of n){const c=o.stopEditing(e);i&&!e&&!r&&c&&(r=!0)}if(r){const o=t.createRowEvent("rowValueChanged");this.eventService.dispatchEvent(o)}i&&this.setEditing(t,!1),t.setStoppingRowEdit(!1)}setEditing(t,e){t.setEditingRow(e),t.forEachGui(void 0,i=>i.rowComp.addOrRemoveCssClass("ag-row-editing",e));const n=e?t.createRowEvent("rowEditingStarted"):t.createRowEvent("rowEditingStopped");this.eventService.dispatchEvent(n)}},U_={version:lr,moduleName:"@ag-grid-community/edit-core",beans:[hpe]},fpe={version:lr,moduleName:"@ag-grid-community/edit-api",apiFunctions:{undoCellEditing:ipe,redoCellEditing:rpe,getCellEditorInstances:spe,getEditingCells:ope,stopEditing:ape,startEditingCell:lpe,getCurrentUndoSize:cpe,getCurrentRedoSize:upe},dependantModules:[U_]},ppe={version:lr,moduleName:"@ag-grid-community/undo-redo-edit",beans:[Qfe],dependantModules:[U_]},mpe={version:lr,moduleName:"@ag-grid-community/full-row-edit",beans:[dpe],dependantModules:[U_]},pq={version:lr,moduleName:"@ag-grid-community/default-editor",userComponents:[{name:"agCellEditor",classImp:uq}],dependantModules:[U_]},gpe={version:lr,moduleName:"@ag-grid-community/data-type-editors",userComponents:[{name:"agTextCellEditor",classImp:uq},{name:"agNumberCellEditor",classImp:jfe},{name:"agDateCellEditor",classImp:Zfe},{name:"agDateStringCellEditor",classImp:Kfe},{name:"agCheckboxCellEditor",classImp:Yfe}],dependantModules:[pq]},vpe={version:lr,moduleName:"@ag-grid-community/select-editor",userComponents:[{name:"agSelectCellEditor",classImp:Gfe}],dependantModules:[U_]},ype={version:lr,moduleName:"@ag-grid-community/large-text-editor",userComponents:[{name:"agLargeTextCellEditor",classImp:Ufe}],dependantModules:[U_]},_pe={version:lr,moduleName:"@ag-grid-community/all-editors",dependantModules:[pq,gpe,vpe,ype]},xpe={version:lr,moduleName:"@ag-grid-community/editing",dependantModules:[U_,ppe,mpe,_pe,fpe]},wpe=class extends wn{constructor(){super(...arguments),this.beanName="autoWidthCalculator"}wireBeans(t){this.rowRenderer=t.rowRenderer,this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(t=>{this.centerRowContainerCtrl=t.center})}getPreferredWidthForColumn(t,e){const n=this.getHeaderCellForColumn(t);if(!n)return-1;const i=this.rowRenderer.getAllCellsForColumn(t);return e||i.push(n),this.addElementsToContainerAndGetWidth(i)}getPreferredWidthForColumnGroup(t){const e=this.getHeaderCellForColumn(t);return e?this.addElementsToContainerAndGetWidth([e]):-1}addElementsToContainerAndGetWidth(t){const e=document.createElement("form");e.style.position="fixed";const n=this.centerRowContainerCtrl.getContainerElement();t.forEach(o=>this.cloneItemIntoDummy(o,e)),n.appendChild(e);const i=e.offsetWidth;n.removeChild(e);const r=this.getAutoSizePadding();return i+r}getAutoSizePadding(){return this.gos.get("autoSizePadding")}getHeaderCellForColumn(t){let e=null;return this.ctrlsService.getHeaderRowContainerCtrls().forEach(n=>{const i=n.getHtmlElementForColumnHeader(t);i!=null&&(e=i)}),e}cloneItemIntoDummy(t,e){const n=t.cloneNode(!0);n.style.width="",n.style.position="static",n.style.left="";const i=document.createElement("div"),r=i.classList;["ag-header-cell","ag-header-group-cell"].some(s=>n.classList.contains(s))?(r.add("ag-header","ag-header-row"),i.style.position="static"):r.add("ag-row");let c=t.parentElement;for(;c;){if(["ag-header-row","ag-row"].some(f=>c.classList.contains(f))){for(let f=0;f<c.classList.length;f++){const v=c.classList[f];v!="ag-row-position-absolute"&&r.add(v)}break}c=c.parentElement}i.appendChild(n),e.appendChild(i)}},Cpe=class extends wn{constructor(t,e){super(),this.createRowCon=t,this.destroyRowCtrls=e,this.stickyTopRowCtrls=[],this.stickyBottomRowCtrls=[],this.topContainerHeight=0,this.bottomContainerHeight=0,this.extraTopHeight=0,this.extraBottomHeight=0}wireBeans(t){this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer,this.ctrlsService=t.ctrlsService,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.isClientSide=this.rowModel.getType()==="clientSide",this.ctrlsService.whenReady(t=>{this.gridBodyCtrl=t.gridBodyCtrl})}getStickyTopRowCtrls(){return this.stickyTopRowCtrls}getStickyBottomRowCtrls(){return this.stickyBottomRowCtrls}setOffsetTop(t){if(this.extraTopHeight===t)return;this.extraTopHeight=t;const e={type:"stickyTopOffsetChanged",offset:t};this.eventService.dispatchEvent(e)}setOffsetBottom(t){this.extraBottomHeight!==t&&(this.extraBottomHeight=t)}resetOffsets(){this.setOffsetBottom(0),this.setOffsetTop(0)}getExtraTopHeight(){return this.extraTopHeight}getExtraBottomHeight(){return this.extraBottomHeight}getLastPixelOfGroup(t){return this.isClientSide?this.getClientSideLastPixelOfGroup(t):this.getServerSideLastPixelOfGroup(t)}getFirstPixelOfGroup(t){return t.footer?t.sibling.rowTop+t.sibling.rowHeight-1:t.hasChildren()?t.rowTop-1:0}getServerSideLastPixelOfGroup(t){var e,n;if(this.isClientSide)throw new Error("This func should only be called in server side row model.");if(t.isExpandable()||t.footer){if(t.master)return t.detailNode.rowTop+t.detailNode.rowHeight;if(!t.sibling||Math.abs(t.sibling.rowIndex-t.rowIndex)===1){let r=(e=t.childStore)==null?void 0:e.getStoreBounds();return t.footer&&(r=(n=t.sibling.childStore)==null?void 0:n.getStoreBounds()),((r==null?void 0:r.heightPx)??0)+((r==null?void 0:r.topPx)??0)}return t.footer?t.rowTop+t.rowHeight:t.sibling.rowTop+t.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}getClientSideLastPixelOfGroup(t){if(!this.isClientSide)throw new Error("This func should only be called in client side row model.");if(t.isExpandable()||t.footer){if(t.footer&&t.rowIndex===0)return Number.MAX_SAFE_INTEGER;if(!t.sibling||Math.abs(t.sibling.rowIndex-t.rowIndex)===1){let i=t.footer?t.sibling:t;for(;i.isExpandable()&&i.expanded;)if(i.master)i=i.detailNode;else if(i.childrenAfterSort){if(i.childrenAfterSort.length===0)break;i=Yr(i.childrenAfterSort)}return i.rowTop+i.rowHeight}return t.footer?t.rowTop+t.rowHeight:t.sibling.rowTop+t.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}updateStickyRows(t){const e=t==="top";let n=0;if(!this.canRowsBeSticky())return this.refreshNodesAndContainerHeight(t,new Set,n);const i=e?this.rowRenderer.getFirstVisibleVerticalPixel()-this.extraTopHeight:this.rowRenderer.getLastVisibleVerticalPixel()-this.extraTopHeight,r=new Set,o=v=>{if(r.add(v),e){const w=this.getLastPixelOfGroup(v),C=i+n+v.rowHeight;w<C?v.stickyRowTop=n+(w-C):v.stickyRowTop=n}else{const w=this.getFirstPixelOfGroup(v),C=i-(n+v.rowHeight);w>C?v.stickyRowTop=n-(w-C):v.stickyRowTop=n}n=0,r.forEach(w=>{const C=w.stickyRowTop+w.rowHeight;n<C&&(n=C)})},c=this.areFooterRowsStickySuppressed(),s=this.gos.get("suppressGroupRowsSticky"),f=v=>v.displayed?v.footer?c===!0||c==="grand"&&v.level===-1||c==="group"&&v.level>-1?!1:!r.has(v):v.isExpandable()?s===!0?!1:!r.has(v)&&v.expanded:!1:!1;for(let v=0;v<100;v++){let w=i+n;e||(w=i-n);const C=this.rowModel.getRowIndexAtPixel(w),M=this.rowModel.getRow(C);if(M==null)break;const N=this.getStickyAncestors(M).find(L=>(e?L.rowIndex<C:L.rowIndex>C)&&f(L));if(N){o(N);continue}if((e?M.rowTop<w:M.rowTop+M.rowHeight>w)&&f(M)){o(M);continue}break}return e||r.forEach(v=>{v.stickyRowTop=n-(v.stickyRowTop+v.rowHeight)}),this.refreshNodesAndContainerHeight(t,r,n)}areFooterRowsStickySuppressed(){const t=this.gos.get("suppressStickyTotalRow");if(t===!0)return!0;const e=!!this.gos.get("groupIncludeFooter")||t==="group",n=!!this.gos.get("groupIncludeTotalFooter")||t==="grand";return e&&n?!0:n?"grand":e?"group":!1}canRowsBeSticky(){const t=this.gos.isGroupRowsSticky(),e=this.areFooterRowsStickySuppressed(),n=this.gos.get("suppressGroupRowsSticky");return t&&(!e||!n)}getStickyAncestors(t){const e=[];let n=t.footer?t.sibling:t.parent;for(;n;)n.sibling&&e.push(n.sibling),e.push(n),n=n.parent;return e.reverse()}checkStickyRows(){const t=this.updateStickyRows("top"),e=this.updateStickyRows("bottom");return t||e}destroyStickyCtrls(){this.refreshNodesAndContainerHeight("top",new Set,0),this.refreshNodesAndContainerHeight("bottom",new Set,0)}refreshStickyNode(t){const e=new Set;if(this.stickyTopRowCtrls.some(n=>n.getRowNode()===t)){for(let n=0;n<this.stickyTopRowCtrls.length;n++){const i=this.stickyTopRowCtrls[n].getRowNode();i!==t&&e.add(i)}this.refreshNodesAndContainerHeight("top",e,this.topContainerHeight)&&this.checkStickyRows();return}for(let n=0;n<this.stickyBottomRowCtrls.length;n++){const i=this.stickyBottomRowCtrls[n].getRowNode();i!==t&&e.add(i)}this.refreshNodesAndContainerHeight("bottom",e,this.bottomContainerHeight)&&this.checkStickyRows()}refreshNodesAndContainerHeight(t,e,n){const i=t==="top",r=i?this.stickyTopRowCtrls:this.stickyBottomRowCtrls,o={},c=[];for(let M=0;M<r.length;M++){const F=r[M].getRowNode();if(!e.has(F)){o[F.id]=r[M],F.sticky=!1;continue}c.push(r[M])}const s=new Set;for(let M=0;M<c.length;M++)s.add(c[M].getRowNode());const f=[];e.forEach(M=>{s.has(M)||(M.sticky=!0,f.push(this.createRowCon(M,!1,!1)))});let v=!!f.length||c.length!==r.length;i?this.topContainerHeight!==n&&(this.topContainerHeight=n,this.gridBodyCtrl.setStickyTopHeight(n),v=!0):this.bottomContainerHeight!==n&&(this.bottomContainerHeight=n,this.gridBodyCtrl.setStickyBottomHeight(n),v=!0),this.destroyRowCtrls(o,!1);const w=[...c,...f];w.sort((M,F)=>F.getRowNode().rowIndex-M.getRowNode().rowIndex),i||w.reverse(),w.forEach(M=>M.setRowTop(M.getRowNode().stickyRowTop));let C=0;return i?(e.forEach(M=>{M.rowIndex<this.pageBoundsService.getFirstRow()&&(C+=M.rowHeight)}),C>this.topContainerHeight&&(C=this.topContainerHeight),this.setOffsetTop(C)):(e.forEach(M=>{M.rowIndex>this.pageBoundsService.getLastRow()&&(C+=M.rowHeight)}),C>this.bottomContainerHeight&&(C=this.bottomContainerHeight),this.setOffsetBottom(C)),v?(i?this.stickyTopRowCtrls=w:this.stickyBottomRowCtrls=w,!0):!1}ensureRowHeightsValid(){let t=!1;const e=n=>{const i=n.getRowNode();if(i.rowHeightEstimated){const r=this.gos.getRowHeightForNode(i);i.setRowHeight(r.height),t=!0}};return this.stickyTopRowCtrls.forEach(e),this.stickyBottomRowCtrls.forEach(e),t}},Spe=class extends wn{constructor(){super(...arguments),this.beanName="rowRenderer",this.destroyFuncsForColumnListeners=[],this.rowCtrlsByRowIndex={},this.zombieRowCtrls={},this.allRowCtrls=[],this.topRowCtrls=[],this.bottomRowCtrls=[],this.refreshInProgress=!1,this.dataFirstRenderedFired=!1,this.setupRangeSelectionListeners=()=>{const t=()=>{this.getAllCellCtrls().forEach(o=>o.onRangeSelectionChanged())},e=()=>{this.getAllCellCtrls().forEach(o=>o.updateRangeBordersIfRangeCount())},n=()=>{this.eventService.addEventListener("rangeSelectionChanged",t),this.eventService.addEventListener("columnMoved",e),this.eventService.addEventListener("columnPinned",e),this.eventService.addEventListener("columnVisible",e)},i=()=>{this.eventService.removeEventListener("rangeSelectionChanged",t),this.eventService.removeEventListener("columnMoved",e),this.eventService.removeEventListener("columnPinned",e),this.eventService.removeEventListener("columnVisible",e)};this.addDestroyFunc(()=>i()),this.addManagedPropertyListener("enableRangeSelection",o=>{o.currentValue?n():i()}),this.gos.get("enableRangeSelection")&&n()}}wireBeans(t){this.animationFrameService=t.animationFrameService,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.pinnedRowModel=t.pinnedRowModel,this.rowModel=t.rowModel,this.focusService=t.focusService,this.beans=t,this.rowContainerHeightService=t.rowContainerHeightService,this.ctrlsService=t.ctrlsService,this.environment=t.environment}postConstruct(){this.ctrlsService.whenReady(t=>{this.gridBodyCtrl=t.gridBodyCtrl,this.initialise()})}initialise(){if(this.addManagedEventListeners({paginationChanged:this.onPageLoaded.bind(this),pinnedRowDataChanged:this.onPinnedRowDataChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),bodyScroll:this.onBodyScroll.bind(this),bodyHeightChanged:this.redraw.bind(this)}),this.addManagedPropertyListeners(["domLayout","embedFullWidthRows"],()=>this.onDomLayoutChanged()),this.addManagedPropertyListeners(["suppressMaxRenderedRowRestriction","rowBuffer"],()=>this.redraw()),this.addManagedPropertyListeners(["suppressCellFocus","getBusinessKeyForNode","fullWidthCellRenderer","fullWidthCellRendererParams","rowStyle","getRowStyle","rowClass","getRowClass","rowClassRules","suppressStickyTotalRow","groupRowRenderer","groupRowRendererParams","loadingCellRenderer","loadingCellRendererParams","detailCellRenderer","detailCellRendererParams","enableRangeSelection","enableCellTextSelection"],()=>this.redrawRows()),this.gos.isGroupRowsSticky()){const t=this.rowModel.getType();(t==="clientSide"||t==="serverSide")&&(this.stickyRowFeature=this.createManagedBean(new Cpe(this.createRowCon.bind(this),this.destroyRowCtrls.bind(this))))}this.registerCellEventListeners(),this.initialiseCache(),this.printLayout=this.gos.isDomLayout("print"),this.embedFullWidthRows=this.printLayout||this.gos.get("embedFullWidthRows"),this.redrawAfterModelUpdate()}initialiseCache(){if(this.gos.get("keepDetailRows")){const t=this.getKeepDetailRowsCount(),e=t??3;this.cachedRowCtrls=new bpe(e)}}getKeepDetailRowsCount(){return this.gos.get("keepDetailRowsCount")}getStickyTopRowCtrls(){return this.stickyRowFeature?this.stickyRowFeature.getStickyTopRowCtrls():[]}getStickyBottomRowCtrls(){return this.stickyRowFeature?this.stickyRowFeature.getStickyBottomRowCtrls():[]}updateAllRowCtrls(){const t=CL(this.rowCtrlsByRowIndex),e=CL(this.zombieRowCtrls),n=this.cachedRowCtrls?this.cachedRowCtrls.getEntries():[];e.length>0||n.length>0?this.allRowCtrls=[...t,...e,...n]:this.allRowCtrls=t}onCellFocusChanged(t){this.getAllCellCtrls().forEach(e=>e.onCellFocused(t)),this.getFullWidthRowCtrls().forEach(e=>e.onFullWidthRowFocused(t))}registerCellEventListeners(){this.addManagedEventListeners({cellFocused:t=>{this.onCellFocusChanged(t)},cellFocusCleared:()=>this.onCellFocusChanged(),flashCells:t=>{this.getAllCellCtrls().forEach(e=>e.onFlashCells(t))},columnHoverChanged:()=>{this.getAllCellCtrls().forEach(t=>t.onColumnHover())},displayedColumnsChanged:()=>{this.getAllCellCtrls().forEach(t=>t.onDisplayedColumnsChanged())},displayedColumnsWidthChanged:()=>{this.printLayout&&this.getAllCellCtrls().forEach(t=>t.onLeftChanged())}}),this.setupRangeSelectionListeners(),this.refreshListenersToColumnsForCellComps(),this.addManagedEventListeners({gridColumnsChanged:this.refreshListenersToColumnsForCellComps.bind(this)}),this.addDestroyFunc(this.removeGridColumnListeners.bind(this))}removeGridColumnListeners(){this.destroyFuncsForColumnListeners.forEach(t=>t()),this.destroyFuncsForColumnListeners.length=0}refreshListenersToColumnsForCellComps(){this.removeGridColumnListeners(),this.columnModel.getCols().forEach(e=>{const n=f=>{this.getAllCellCtrls().forEach(v=>{v.getColumn()===e&&f(v)})},i=()=>{n(f=>f.onLeftChanged())},r=()=>{n(f=>f.onWidthChanged())},o=()=>{n(f=>f.onFirstRightPinnedChanged())},c=()=>{n(f=>f.onLastLeftPinnedChanged())},s=()=>{n(f=>f.onColDefChanged())};e.addEventListener("leftChanged",i),e.addEventListener("widthChanged",r),e.addEventListener("firstRightPinnedChanged",o),e.addEventListener("lastLeftPinnedChanged",c),e.addEventListener("colDefChanged",s),this.destroyFuncsForColumnListeners.push(()=>{e.removeEventListener("leftChanged",i),e.removeEventListener("widthChanged",r),e.removeEventListener("firstRightPinnedChanged",o),e.removeEventListener("lastLeftPinnedChanged",c),e.removeEventListener("colDefChanged",s)})})}onDomLayoutChanged(){const t=this.gos.isDomLayout("print"),e=t||this.gos.get("embedFullWidthRows"),n=e!==this.embedFullWidthRows||this.printLayout!==t;this.printLayout=t,this.embedFullWidthRows=e,n&&this.redrawAfterModelUpdate({domLayoutChanged:!0})}datasourceChanged(){this.firstRenderedRow=0,this.lastRenderedRow=-1;const t=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(t)}onPageLoaded(t){const e={recycleRows:t.keepRenderedRows,animate:t.animate,newData:t.newData,newPage:t.newPage,onlyBody:!0};this.redrawAfterModelUpdate(e)}getAllCellsForColumn(t){const e=[];return this.getAllRowCtrls().forEach(n=>{const i=n.getCellElement(t);i&&e.push(i)}),e}refreshFloatingRowComps(){this.refreshFloatingRows(this.topRowCtrls,this.pinnedRowModel.getPinnedTopRowNodes()),this.refreshFloatingRows(this.bottomRowCtrls,this.pinnedRowModel.getPinnedBottomRowNodes())}getTopRowCtrls(){return this.topRowCtrls}getCentreRowCtrls(){return this.allRowCtrls}getBottomRowCtrls(){return this.bottomRowCtrls}refreshFloatingRows(t,e){const n=Object.fromEntries(e.map(r=>[r.id,r])),i=Object.fromEntries(t.map(r=>[r.getRowNode().id,r]));for(let r=0;r<e.length;r++){const o=e[r],c=t[r];c&&n[c.getRowNode().id]===void 0&&(c.destroyFirstPass(),c.destroySecondPass()),o.id in i?(t[r]=i[o.id],delete i[o.id]):t[r]=new s_(o,this.beans,!1,!1,this.printLayout)}t.length=e.length}onPinnedRowDataChanged(){const t={recycleRows:!0};this.redrawAfterModelUpdate(t)}redrawRow(t,e=!1){var n;if(t.sticky)this.stickyRowFeature.refreshStickyNode(t);else if((n=this.cachedRowCtrls)!=null&&n.has(t)){this.cachedRowCtrls.removeRow(t);return}else{const i=r=>{const o=r[t.rowIndex];o&&o.getRowNode()===t&&(o.destroyFirstPass(),o.destroySecondPass(),r[t.rowIndex]=this.createRowCon(t,!1,!1))};switch(t.rowPinned){case"top":i(this.topRowCtrls);break;case"bottom":i(this.bottomRowCtrls);break;default:i(this.rowCtrlsByRowIndex),this.updateAllRowCtrls()}}e||this.dispatchDisplayedRowsChanged(!1)}redrawRows(t){if(t!=null){t==null||t.forEach(n=>this.redrawRow(n,!0)),this.dispatchDisplayedRowsChanged(!1);return}this.redrawAfterModelUpdate()}getCellToRestoreFocusToAfterRefresh(t){const e=t!=null&&t.suppressKeepFocus?null:this.focusService.getFocusCellToUseAfterRefresh();if(e==null)return null;const n=this.gos.getActiveDomElement(),i=this.gos.getDomData(n,r_.DOM_DATA_KEY_CELL_CTRL),r=this.gos.getDomData(n,s_.DOM_DATA_KEY_ROW_CTRL);return i||r?e:null}redrawAfterModelUpdate(t={}){this.getLockOnRefresh();const e=this.getCellToRestoreFocusToAfterRefresh(t);this.updateContainerHeights(),this.scrollToTopIfNewData(t);const n=!t.domLayoutChanged&&!!t.recycleRows,i=t.animate&&this.gos.isAnimateRows(),r=n?this.getRowsToRecycle():null;if(n||this.removeAllRowComps(),this.workOutFirstAndLastRowsToRender(),this.stickyRowFeature){this.stickyRowFeature.checkStickyRows();const o=this.stickyRowFeature.getExtraTopHeight()+this.stickyRowFeature.getExtraBottomHeight();o&&this.updateContainerHeights(o)}this.recycleRows(r,i),this.gridBodyCtrl.updateRowCount(),t.onlyBody||this.refreshFloatingRowComps(),this.dispatchDisplayedRowsChanged(),e!=null&&this.restoreFocusedCell(e),this.releaseLockOnRefresh()}scrollToTopIfNewData(t){var i;const e=t.newData||t.newPage,n=this.gos.get("suppressScrollOnNewData");e&&!n&&(this.gridBodyCtrl.getScrollFeature().scrollToTop(),(i=this.stickyRowFeature)==null||i.resetOffsets())}updateContainerHeights(t=0){if(this.printLayout){this.rowContainerHeightService.setModelHeight(null);return}let e=this.pageBoundsService.getCurrentPageHeight();e===0&&(e=1),this.rowContainerHeightService.setModelHeight(e+t)}getLockOnRefresh(){var t,e,n,i;if(this.refreshInProgress){const r=((e=(t=this.frameworkOverrides).getLockOnRefreshError)==null?void 0:e.call(t))??"";throw new Error("AG Grid: cannot get grid to draw rows when it is in the middle of drawing rows. Your code probably called a grid API method while the grid was in the render stage. To overcome this, put the API call into a timeout, e.g. instead of api.redrawRows(), call setTimeout(function() { api.redrawRows(); }, 0). To see what part of your code that caused the refresh check this stacktrace."+r)}this.refreshInProgress=!0,(i=(n=this.frameworkOverrides).getLockOnRefresh)==null||i.call(n)}releaseLockOnRefresh(){var t,e;this.refreshInProgress=!1,(e=(t=this.frameworkOverrides).releaseLockOnRefresh)==null||e.call(t)}isRefreshInProgress(){return this.refreshInProgress}restoreFocusedCell(t){t&&setTimeout(()=>{this.focusService.setRestoreFocusedCell(t),this.onCellFocusChanged(this.gos.addGridCommonParams({rowIndex:t.rowIndex,column:t.column,rowPinned:t.rowPinned,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0,type:"cellFocused"}))})}stopEditing(t=!1){this.getAllRowCtrls().forEach(e=>{e.stopEditing(t)})}getAllCellCtrls(){const t=[],e=this.getAllRowCtrls(),n=e.length;for(let i=0;i<n;i++){const r=e[i].getAllCellCtrls(),o=r.length;for(let c=0;c<o;c++)t.push(r[c])}return t}getAllRowCtrls(){const t=this.stickyRowFeature&&this.stickyRowFeature.getStickyTopRowCtrls()||[],e=this.stickyRowFeature&&this.stickyRowFeature.getStickyBottomRowCtrls()||[],n=[...this.topRowCtrls,...this.bottomRowCtrls,...t,...e];for(const i in this.rowCtrlsByRowIndex)n.push(this.rowCtrlsByRowIndex[i]);return n}addRenderedRowListener(t,e,n){const i=this.rowCtrlsByRowIndex[e];i&&i.addEventListener(t,n)}flashCells(t={}){this.getCellCtrls(t.rowNodes,t.columns).forEach(e=>e.flashCell(t))}refreshCells(t={}){const e={forceRefresh:t.force,newData:!1,suppressFlash:t.suppressFlash};for(const n of this.getCellCtrls(t.rowNodes,t.columns))n.refreshOrDestroyCell(e);this.refreshFullWidth(t.rowNodes)}refreshFullWidth(t){if(!t)return;let e=null;this.stickyRowFeature&&j5()&&(e=this.getCellToRestoreFocusToAfterRefresh()||null);for(const n of this.getRowCtrls(t)){if(!n.isFullWidth())continue;n.refreshFullWidth()||this.redrawRow(n.getRowNode(),!0)}this.dispatchDisplayedRowsChanged(!1),e&&this.restoreFocusedCell(e)}getCellRendererInstances(t){var r;const e=this.getCellCtrls(t.rowNodes,t.columns).map(o=>o.getCellRenderer()).filter(o=>o!=null);if((r=t.columns)!=null&&r.length)return e;const n=[],i=this.mapRowNodes(t.rowNodes);return this.getAllRowCtrls().forEach(o=>{if(i&&!this.isRowInMap(o.getRowNode(),i)||!o.isFullWidth())return;const c=o.getFullWidthCellRenderers();for(let s=0;s<c.length;s++){const f=c[s];f!=null&&n.push(f)}}),[...n,...e]}getCellEditorInstances(t){const e=[];return this.getCellCtrls(t.rowNodes,t.columns).forEach(n=>{const i=n.getCellEditor();i&&e.push(i)}),e}getEditingCells(){const t=[];return this.getAllCellCtrls().forEach(e=>{if(e.isEditing()){const n=e.getCellPosition();t.push(n)}}),t}mapRowNodes(t){if(!t)return;const e={top:{},bottom:{},normal:{}};return t.forEach(n=>{const i=n.id;switch(n.rowPinned){case"top":e.top[i]=n;break;case"bottom":e.bottom[i]=n;break;default:e.normal[i]=n;break}}),e}isRowInMap(t,e){const n=t.id;switch(t.rowPinned){case"top":return e.top[n]!=null;case"bottom":return e.bottom[n]!=null;default:return e.normal[n]!=null}}getRowCtrls(t){const e=this.mapRowNodes(t),n=this.getAllRowCtrls();return!t||!e?n:n.filter(i=>{const r=i.getRowNode();return this.isRowInMap(r,e)})}getCellCtrls(t,e){let n;$n(e)&&(n={},e.forEach(r=>{const o=this.columnModel.getCol(r);$n(o)&&(n[o.getId()]=!0)}));const i=[];return this.getRowCtrls(t).forEach(r=>{r.getAllCellCtrls().forEach(o=>{const c=o.getColumn().getId();n&&!n[c]||i.push(o)})}),i}destroy(){this.removeAllRowComps(),super.destroy()}removeAllRowComps(){const t=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(t),this.stickyRowFeature&&this.stickyRowFeature.destroyStickyCtrls()}getRowsToRecycle(){const t=[];td(this.rowCtrlsByRowIndex,(n,i)=>{i.getRowNode().id==null&&t.push(n)}),this.removeRowCtrls(t);const e={};return td(this.rowCtrlsByRowIndex,(n,i)=>{const r=i.getRowNode();e[r.id]=i}),this.rowCtrlsByRowIndex={},e}removeRowCtrls(t,e=!1){t.forEach(n=>{const i=this.rowCtrlsByRowIndex[n];i&&(i.destroyFirstPass(e),i.destroySecondPass()),delete this.rowCtrlsByRowIndex[n]})}onBodyScroll(t){t.direction==="vertical"&&this.redraw({afterScroll:!0})}redraw(t={}){const{afterScroll:e}=t;let n;this.stickyRowFeature&&j5()&&(n=this.getCellToRestoreFocusToAfterRefresh()||void 0);const i=this.firstRenderedRow,r=this.lastRenderedRow;this.workOutFirstAndLastRowsToRender();let o=!1;if(this.stickyRowFeature){o=this.stickyRowFeature.checkStickyRows();const s=this.stickyRowFeature.getExtraTopHeight()+this.stickyRowFeature.getExtraBottomHeight();s&&this.updateContainerHeights(s)}const c=this.firstRenderedRow!==i||this.lastRenderedRow!==r;if(!(e&&!o&&!c)&&(this.getLockOnRefresh(),this.recycleRows(null,!1,e),this.releaseLockOnRefresh(),this.dispatchDisplayedRowsChanged(e&&!o),n!=null)){const s=this.getCellToRestoreFocusToAfterRefresh();n!=null&&s==null&&(this.animationFrameService.flushAllFrames(),this.restoreFocusedCell(n))}}removeRowCompsNotToDraw(t,e){const n={};t.forEach(o=>n[o]=!0);const r=Object.keys(this.rowCtrlsByRowIndex).filter(o=>!n[o]);this.removeRowCtrls(r,e)}calculateIndexesToDraw(t){const e=Ahe(this.firstRenderedRow,this.lastRenderedRow),n=(r,o)=>{const c=o.getRowNode().rowIndex;c!=null&&(c<this.firstRenderedRow||c>this.lastRenderedRow)&&this.doNotUnVirtualiseRow(o)&&e.push(c)};td(this.rowCtrlsByRowIndex,n),td(t,n),e.sort((r,o)=>r-o);const i=[];for(let r=0;r<e.length;r++){const o=e[r],c=this.rowModel.getRow(o);c&&!c.sticky&&i.push(o)}return i}recycleRows(t,e=!1,n=!1){const i=this.calculateIndexesToDraw(t);(this.printLayout||n)&&(e=!1),this.removeRowCompsNotToDraw(i,!e),i.forEach(r=>{this.createOrUpdateRowCtrl(r,t,e,n)}),t&&(n&&!this.gos.get("suppressAnimationFrame")&&!this.printLayout?this.beans.animationFrameService.addDestroyTask(()=>{this.destroyRowCtrls(t,e),this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}):this.destroyRowCtrls(t,e)),this.updateAllRowCtrls()}dispatchDisplayedRowsChanged(t=!1){const e={type:"displayedRowsChanged",afterScroll:t};this.eventService.dispatchEvent(e)}onDisplayedColumnsChanged(){const t=this.visibleColsService.isPinningLeft(),e=this.visibleColsService.isPinningRight();(this.pinningLeft!==t||e!==this.pinningRight)&&(this.pinningLeft=t,this.pinningRight=e,this.embedFullWidthRows&&this.redrawFullWidthEmbeddedRows())}redrawFullWidthEmbeddedRows(){const t=[];this.getFullWidthRowCtrls().forEach(e=>{const n=e.getRowNode().rowIndex;t.push(n.toString())}),this.refreshFloatingRowComps(),this.removeRowCtrls(t),this.redraw({afterScroll:!0})}getFullWidthRowCtrls(t){const e=this.mapRowNodes(t);return this.getAllRowCtrls().filter(n=>{if(!n.isFullWidth())return!1;const i=n.getRowNode();return!(e!=null&&!this.isRowInMap(i,e))})}createOrUpdateRowCtrl(t,e,n,i){let r,o=this.rowCtrlsByRowIndex[t];if(o||(r=this.rowModel.getRow(t),$n(r)&&$n(e)&&e[r.id]&&r.alreadyRendered&&(o=e[r.id],e[r.id]=null)),!o)if(r||(r=this.rowModel.getRow(t)),$n(r))o=this.createRowCon(r,n,i);else return;return r&&(r.alreadyRendered=!0),this.rowCtrlsByRowIndex[t]=o,o}destroyRowCtrls(t,e){const n=[];td(t,(i,r)=>{if(r){if(this.cachedRowCtrls&&r.isCacheable()){this.cachedRowCtrls.addRow(r);return}r.destroyFirstPass(!e),e?(this.zombieRowCtrls[r.getInstanceId()]=r,n.push(()=>{r.destroySecondPass(),delete this.zombieRowCtrls[r.getInstanceId()]})):r.destroySecondPass()}}),e&&(n.push(()=>{this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}),yce(n))}getRowBuffer(){return this.gos.get("rowBuffer")}getRowBufferInPixels(){const t=this.getRowBuffer(),e=this.gos.getRowHeightAsNumber();return t*e}workOutFirstAndLastRowsToRender(){this.rowContainerHeightService.updateOffset();let t,e;if(!this.rowModel.isRowsToRender())t=0,e=-1;else if(this.printLayout)this.environment.refreshRowHeightVariable(),t=this.pageBoundsService.getFirstRow(),e=this.pageBoundsService.getLastRow();else{const s=this.getRowBufferInPixels(),f=this.ctrlsService.getGridBodyCtrl(),v=this.gos.get("suppressRowVirtualisation");let w=!1,C,M;do{const P=this.pageBoundsService.getPixelOffset(),{pageFirstPixel:H,pageLastPixel:j}=this.pageBoundsService.getCurrentPagePixelRange(),q=this.rowContainerHeightService.getDivStretchOffset(),le=f.getScrollFeature().getVScrollPosition(),ce=le.top,ae=le.bottom;v?(C=H+q,M=j+q):(C=Math.max(ce+P-s,H)+q,M=Math.min(ae+P+s,j)+q),this.firstVisibleVPixel=Math.max(ce+P,H)+q,this.lastVisibleVPixel=Math.min(ae+P,j)+q,w=this.ensureAllRowsInRangeHaveHeightsCalculated(C,M)}while(w);let F=this.rowModel.getRowIndexAtPixel(C),N=this.rowModel.getRowIndexAtPixel(M);const z=this.pageBoundsService.getFirstRow(),L=this.pageBoundsService.getLastRow();F<z&&(F=z),N>L&&(N=L),t=F,e=N}const n=this.gos.isDomLayout("normal"),i=this.gos.get("suppressMaxRenderedRowRestriction"),r=Math.max(this.getRowBuffer(),500);n&&!i&&e-t>r&&(e=t+r);const o=t!==this.firstRenderedRow,c=e!==this.lastRenderedRow;if(o||c){this.firstRenderedRow=t,this.lastRenderedRow=e;const s={type:"viewportChanged",firstRow:t,lastRow:e};this.eventService.dispatchEvent(s)}}dispatchFirstDataRenderedEvent(){if(this.dataFirstRenderedFired)return;this.dataFirstRenderedFired=!0;const t={type:"firstDataRendered",firstRow:this.firstRenderedRow,lastRow:this.lastRenderedRow};window.requestAnimationFrame(()=>{this.beans.eventService.dispatchEvent(t)})}ensureAllRowsInRangeHaveHeightsCalculated(t,e){var o,c;const n=(o=this.pinnedRowModel)==null?void 0:o.ensureRowHeightsValid(),i=(c=this.stickyRowFeature)==null?void 0:c.ensureRowHeightsValid(),r=this.rowModel.ensureRowHeightsValid(t,e,this.pageBoundsService.getFirstRow(),this.pageBoundsService.getLastRow());return(r||i)&&this.eventService.dispatchEvent({type:"recalculateRowBounds"}),i||r||n?(this.updateContainerHeights(),!0):!1}getFirstVisibleVerticalPixel(){return this.firstVisibleVPixel}getLastVisibleVerticalPixel(){return this.lastVisibleVPixel}getFirstVirtualRenderedRow(){return this.firstRenderedRow}getLastVirtualRenderedRow(){return this.lastRenderedRow}doNotUnVirtualiseRow(t){const i=t.getRowNode(),r=this.focusService.isRowNodeFocused(i),o=t.isEditing(),c=i.detail;return r||o||c?!!this.isRowPresent(i):!1}isRowPresent(t){return this.rowModel.isRowPresent(t)?this.paginationService?this.paginationService.isRowPresent(t):!0:!1}createRowCon(t,e,n){const i=this.cachedRowCtrls?this.cachedRowCtrls.getRow(t):null;if(i)return i;const r=this.gos.get("suppressAnimationFrame"),o=n&&!r&&!this.printLayout;return new s_(t,this.beans,e,o,this.printLayout)}getRenderedNodes(){const t=this.rowCtrlsByRowIndex;return Object.values(t).map(e=>e.getRowNode())}getRowByPosition(t){let e;const{rowIndex:n}=t;switch(t.rowPinned){case"top":e=this.topRowCtrls[n];break;case"bottom":e=this.bottomRowCtrls[n];break;default:e=this.rowCtrlsByRowIndex[n],e||(e=this.getStickyTopRowCtrls().find(i=>i.getRowNode().rowIndex===n)||null,e||(e=this.getStickyBottomRowCtrls().find(i=>i.getRowNode().rowIndex===n)||null));break}return e}isRangeInRenderedViewport(t,e){if(t==null||e==null)return!1;const i=t>this.lastRenderedRow;return!(e<this.firstRenderedRow)&&!i}},bpe=class{constructor(t){this.entriesMap={},this.entriesList=[],this.maxCount=t}addRow(t){if(this.entriesMap[t.getRowNode().id]=t,this.entriesList.push(t),t.setCached(!0),this.entriesList.length>this.maxCount){const e=this.entriesList[0];e.destroyFirstPass(),e.destroySecondPass(),this.removeFromCache(e)}}getRow(t){if(t==null||t.id==null)return null;const e=this.entriesMap[t.id];return e?(this.removeFromCache(e),e.setCached(!1),e.getRowNode()!=t?null:e):null}has(t){return this.entriesMap[t.id]!=null}removeRow(t){const e=t.id,n=this.entriesMap[e];delete this.entriesMap[e],Xl(this.entriesList,n)}removeFromCache(t){const e=t.getRowNode().id;delete this.entriesMap[e],Xl(this.entriesList,t)}getEntries(){return this.entriesList}},Epe=class extends wn{constructor(){super(...arguments),this.beanName="pinnedRowModel",this.nextId=0}wireBeans(t){this.beans=t}postConstruct(){this.setPinnedTopRowData(),this.setPinnedBottomRowData(),this.addManagedPropertyListener("pinnedTopRowData",()=>this.setPinnedTopRowData()),this.addManagedPropertyListener("pinnedBottomRowData",()=>this.setPinnedBottomRowData()),this.addManagedEventListeners({gridStylesChanged:this.onGridStylesChanges.bind(this)})}isEmpty(t){const e=t==="top"?this.pinnedTopRows:this.pinnedBottomRows;return Va(e)}isRowsToRender(t){return!this.isEmpty(t)}getRowAtPixel(t,e){const n=e==="top"?this.pinnedTopRows:this.pinnedBottomRows;if(Va(n))return 0;for(let i=0;i<n.length;i++){const r=n[i];if(r.rowTop+r.rowHeight-1>=t)return i}return n.length-1}onGridStylesChanges(t){if(t.rowHeightChanged){const e=n=>{n.setRowHeight(n.rowHeight,!0)};this.pinnedBottomRows.forEach(e),this.pinnedTopRows.forEach(e)}}ensureRowHeightsValid(){var r,o;let t=!1,e=0;const n=c=>{if(c.rowHeightEstimated){const s=this.gos.getRowHeightForNode(c);c.setRowTop(e),c.setRowHeight(s.height),e+=s.height,t=!0}};(r=this.pinnedBottomRows)==null||r.forEach(n),e=0,(o=this.pinnedTopRows)==null||o.forEach(n);const i={type:"pinnedHeightChanged"};return this.eventService.dispatchEvent(i),t}setPinnedTopRowData(){const t=this.gos.get("pinnedTopRowData");this.pinnedTopRows=this.createNodesFromData(t,!0);const e={type:"pinnedRowDataChanged"};this.eventService.dispatchEvent(e)}setPinnedBottomRowData(){const t=this.gos.get("pinnedBottomRowData");this.pinnedBottomRows=this.createNodesFromData(t,!1);const e={type:"pinnedRowDataChanged"};this.eventService.dispatchEvent(e)}createNodesFromData(t,e){const n=[];if(t){const i=this.gos.getRowIdCallback(),r=e?Vp.ID_PREFIX_TOP_PINNED:Vp.ID_PREFIX_BOTTOM_PINNED;let o=0;const c=e?"top":"bottom";t.forEach((s,f)=>{const v=new Vp(this.beans);v.data=s,v.id=(i==null?void 0:i({data:s,level:0,rowPinned:c}))??r+this.nextId++,v.rowPinned=c,v.setRowTop(o),v.setRowHeight(this.gos.getRowHeightForNode(v).height),v.setRowIndex(f),o+=v.rowHeight,n.push(v)})}return n}getPinnedTopRowNodes(){return this.pinnedTopRows}getPinnedBottomRowNodes(){return this.pinnedBottomRows}getPinnedTopTotalHeight(){return this.getTotalHeight(this.pinnedTopRows)}getPinnedTopRowCount(){return this.pinnedTopRows?this.pinnedTopRows.length:0}getPinnedBottomRowCount(){return this.pinnedBottomRows?this.pinnedBottomRows.length:0}getPinnedTopRow(t){return this.pinnedTopRows[t]}getPinnedBottomRow(t){return this.pinnedBottomRows[t]}forEachPinnedTopRow(t){Va(this.pinnedTopRows)||this.pinnedTopRows.forEach(t)}forEachPinnedBottomRow(t){Va(this.pinnedBottomRows)||this.pinnedBottomRows.forEach(t)}getPinnedBottomTotalHeight(){return this.getTotalHeight(this.pinnedBottomRows)}getTotalHeight(t){if(!t||t.length===0)return 0;const e=Yr(t);return e.rowTop+e.rowHeight}},Mpe=class extends wn{constructor(t){super(),this.state="needsLoading",this.version=0,this.id=t}getId(){return this.id}load(){this.state="loading",this.loadFromDatasource()}getVersion(){return this.version}setStateWaitingToLoad(){this.version++,this.state="needsLoading"}getState(){return this.state}pageLoadFailed(t){this.isRequestMostRecentAndLive(t)&&(this.state="failed",this.processServerFail()),this.dispatchLoadCompleted(!1)}success(t,e){this.successCommon(t,e)}pageLoaded(t,e,n){this.successCommon(t,{rowData:e,rowCount:n})}isRequestMostRecentAndLive(t){const e=t===this.version,n=this.isAlive();return e&&n}successCommon(t,e){this.dispatchLoadCompleted(),this.isRequestMostRecentAndLive(t)&&(this.state="loaded",this.processServerResult(e))}dispatchLoadCompleted(t=!0){const e={type:"loadComplete",success:t,block:this};this.dispatchLocalEvent(e)}},Rpe=class extends wn{constructor(){super(...arguments),this.beanName="rowNodeBlockLoader",this.activeBlockLoadsCount=0,this.blocks=[],this.active=!0}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.maxConcurrentRequests=this.getMaxConcurrentDatasourceRequests();const t=this.gos.get("blockLoadDebounceMillis");t&&t>0&&(this.checkBlockToLoadDebounce=Kl(this.performCheckBlocksToLoad.bind(this),t))}getMaxConcurrentDatasourceRequests(){const t=this.gos.get("maxConcurrentDatasourceRequests");if(t==null)return 2;if(!(t<=0))return t}addBlock(t){this.blocks.push(t),t.addEventListener("loadComplete",this.loadComplete.bind(this)),this.checkBlockToLoad()}removeBlock(t){Xl(this.blocks,t)}destroy(){super.destroy(),this.active=!1}loadComplete(){this.activeBlockLoadsCount--,this.checkBlockToLoad(),this.dispatchLocalEvent({type:"blockLoaded"}),this.activeBlockLoadsCount==0&&this.dispatchLocalEvent({type:"blockLoaderFinished"})}checkBlockToLoad(){this.checkBlockToLoadDebounce?this.checkBlockToLoadDebounce():this.performCheckBlocksToLoad()}performCheckBlocksToLoad(){if(!this.active)return;if(this.printCacheStatus(),this.maxConcurrentRequests!=null&&this.activeBlockLoadsCount>=this.maxConcurrentRequests){this.gos.get("debug")&&nd("RowNodeBlockLoader - checkBlockToLoad: max loads exceeded");return}const t=this.getAvailableLoadingCount(),e=this.blocks.filter(n=>n.getState()==="needsLoading").slice(0,t);this.registerLoads(e.length),e.forEach(n=>n.load()),this.printCacheStatus()}getBlockState(){if(this.gos.isRowModelType("serverSide"))return this.rowModel.getBlockStates();const t={};return this.blocks.forEach(e=>{const{id:n,state:i}=e.getBlockStateJson();t[n]=i}),t}printCacheStatus(){this.gos.get("debug")&&nd(`RowNodeBlockLoader - printCacheStatus: activePageLoadsCount = ${this.activeBlockLoadsCount}, blocks = ${JSON.stringify(this.getBlockState())}`)}isLoading(){return this.activeBlockLoadsCount>0}registerLoads(t){this.activeBlockLoadsCount+=t}getAvailableLoadingCount(){return this.maxConcurrentRequests!==void 0?this.maxConcurrentRequests-this.activeBlockLoadsCount:void 0}},Tpe={version:lr,moduleName:"@ag-grid-community/row-node-block",beans:[Rpe]},Ape=class{constructor(){this.root=null,this.end=null,this.cachedRange=[]}init(t){this.rowModel=t}reset(){this.root=null,this.end=null,this.cachedRange.length=0}setRoot(t){this.root=t,this.end=null,this.cachedRange.length=0}setEndRange(t){this.end=t,this.cachedRange.length=0}getRange(){if(this.cachedRange.length===0){const t=this.getRoot(),e=this.getEnd();if(t==null||e==null)return this.cachedRange;this.cachedRange=this.rowModel.getNodesInRangeForSelection(t,e)}return this.cachedRange}isInRange(t){return this.root===null?!1:this.getRange().some(e=>e.id===t.id)}getRoot(){var t;return this.root&&((t=this.root)==null?void 0:t.key)===null&&(this.root=this.rowModel.getRowNode(this.root.id)??null),this.root}getEnd(){var t;return this.end&&((t=this.end)==null?void 0:t.key)===null&&(this.end=this.rowModel.getRowNode(this.end.id)??null),this.end}truncate(t){const e=this.getRange();if(e.length===0)return{keep:[],discard:[]};const n=e[0].id===this.root.id,i=e.findIndex(r=>r.id===t.id);if(i>-1){const r=e.slice(0,i),o=e.slice(i+1);return this.setEndRange(t),n?{keep:r,discard:o}:{keep:o,discard:r}}else return{keep:e,discard:[]}}extend(t,e=!1){const n=this.getRoot();if(n==null){const r=this.getRange().slice();return e&&t.depthFirstSearch(o=>!o.group&&r.push(o)),r.push(t),this.setRoot(t),{keep:r,discard:[]}}if(this.rowModel.getNodesInRangeForSelection(n,t).find(r=>{var o;return r.id===((o=this.end)==null?void 0:o.id)}))return this.setEndRange(t),{keep:this.getRange(),discard:[]};{const r=this.getRange().slice();return this.setEndRange(t),{keep:this.getRange(),discard:r}}}},Ppe=class extends wn{constructor(){super(...arguments),this.beanName="stylingService"}wireBeans(t){this.expressionService=t.expressionService}processAllCellClasses(t,e,n,i){this.processClassRules(void 0,t.cellClassRules,e,n,i),this.processStaticCellClasses(t,e,n)}processClassRules(t,e,n,i,r){if(e==null&&t==null)return;const o={},c={},s=(f,v)=>{f.split(" ").forEach(w=>{w.trim()!=""&&v(w)})};if(e){const f=Object.keys(e);for(let v=0;v<f.length;v++){const w=f[v],C=e[w];let M;typeof C=="string"?M=this.expressionService.evaluate(C,n):typeof C=="function"&&(M=C(n)),s(w,F=>{M?o[F]=!0:c[F]=!0})}}t&&r&&Object.keys(t).forEach(f=>s(f,v=>{o[v]||(c[v]=!0)})),r&&Object.keys(c).forEach(r),Object.keys(o).forEach(i)}getStaticCellClasses(t,e){const{cellClass:n}=t;if(!n)return[];let i;return typeof n=="function"?i=n(e):i=n,typeof i=="string"&&(i=[i]),i||[]}processStaticCellClasses(t,e,n){this.getStaticCellClasses(t,e).forEach(r=>{n(r)})}},lR=(t=>(t.TAB_GUARD="ag-tab-guard",t.TAB_GUARD_TOP="ag-tab-guard-top",t.TAB_GUARD_BOTTOM="ag-tab-guard-bottom",t))(lR||{}),mq=class extends wn{constructor(t){super(),this.skipTabGuardFocus=!1,this.forcingFocusOut=!1,this.allowFocus=!1;const{comp:e,eTopGuard:n,eBottomGuard:i,focusTrapActive:r,forceFocusOutWhenTabGuardsAreEmpty:o,isFocusableContainer:c,focusInnerElement:s,onFocusIn:f,onFocusOut:v,shouldStopEventPropagation:w,onTabKeyDown:C,handleKeyDown:M,eFocusableElement:F}=t;this.comp=e,this.eTopGuard=n,this.eBottomGuard=i,this.providedFocusInnerElement=s,this.eFocusableElement=F,this.focusTrapActive=!!r,this.forceFocusOutWhenTabGuardsAreEmpty=!!o,this.isFocusableContainer=!!c,this.providedFocusIn=f,this.providedFocusOut=v,this.providedShouldStopEventPropagation=w,this.providedOnTabKeyDown=C,this.providedHandleKeyDown=M}wireBeans(t){this.focusService=t.focusService}postConstruct(){this.createManagedBean(new B_(this.eFocusableElement,{shouldStopEventPropagation:()=>this.shouldStopEventPropagation(),onTabKeyDown:t=>this.onTabKeyDown(t),handleKeyDown:t=>this.handleKeyDown(t),onFocusIn:t=>this.onFocusIn(t),onFocusOut:t=>this.onFocusOut(t)})),this.activateTabGuards(),[this.eTopGuard,this.eBottomGuard].forEach(t=>this.addManagedElementListeners(t,{focus:this.onFocus.bind(this)}))}handleKeyDown(t){this.providedHandleKeyDown&&this.providedHandleKeyDown(t)}tabGuardsAreActive(){return!!this.eTopGuard&&this.eTopGuard.hasAttribute("tabIndex")}shouldStopEventPropagation(){return this.providedShouldStopEventPropagation?this.providedShouldStopEventPropagation():!1}activateTabGuards(){if(this.forcingFocusOut)return;const t=this.gos.get("tabIndex");this.comp.setTabIndex(t.toString())}deactivateTabGuards(){this.comp.setTabIndex()}onFocus(t){if(this.isFocusableContainer&&!this.eFocusableElement.contains(t.relatedTarget)&&!this.allowFocus){this.findNextElementOutsideAndFocus(t.target===this.eBottomGuard);return}if(this.skipTabGuardFocus){this.skipTabGuardFocus=!1;return}if(this.forceFocusOutWhenTabGuardsAreEmpty&&this.focusService.findFocusableElements(this.eFocusableElement,".ag-tab-guard").length===0){this.findNextElementOutsideAndFocus(t.target===this.eBottomGuard);return}if(this.isFocusableContainer&&this.eFocusableElement.contains(t.relatedTarget))return;const e=t.target===this.eBottomGuard;this.providedFocusInnerElement?this.providedFocusInnerElement(e):this.focusInnerElement(e)}findNextElementOutsideAndFocus(t){const e=this.gos.getDocument(),n=this.focusService.findFocusableElements(e.body,null,!0),i=n.indexOf(t?this.eTopGuard:this.eBottomGuard);if(i===-1)return;let r,o;t?(r=0,o=i):(r=i+1,o=n.length);const c=n.slice(r,o),s=this.gos.get("tabIndex");c.sort((f,v)=>{const w=parseInt(f.getAttribute("tabindex")||"0"),C=parseInt(v.getAttribute("tabindex")||"0");return C===s?1:w===s?-1:w===0?1:C===0?-1:w-C}),c[t?c.length-1:0].focus()}onFocusIn(t){this.focusTrapActive||this.forcingFocusOut||(this.providedFocusIn&&this.providedFocusIn(t),this.isFocusableContainer||this.deactivateTabGuards())}onFocusOut(t){this.focusTrapActive||(this.providedFocusOut&&this.providedFocusOut(t),this.eFocusableElement.contains(t.relatedTarget)||this.activateTabGuards())}onTabKeyDown(t){if(this.providedOnTabKeyDown){this.providedOnTabKeyDown(t);return}if(this.focusTrapActive||t.defaultPrevented)return;const e=this.tabGuardsAreActive();e&&this.deactivateTabGuards();const n=this.getNextFocusableElement(t.shiftKey);e&&setTimeout(()=>this.activateTabGuards(),0),n&&(n.focus(),t.preventDefault())}focusInnerElement(t=!1){const e=this.focusService.findFocusableElements(this.eFocusableElement);this.tabGuardsAreActive()&&(e.splice(0,1),e.splice(e.length-1,1)),e.length&&e[t?e.length-1:0].focus({preventScroll:!0})}getNextFocusableElement(t){return this.focusService.findNextFocusableElement(this.eFocusableElement,!1,t)}forceFocusOutOfContainer(t=!1){if(this.forcingFocusOut)return;const e=t?this.eTopGuard:this.eBottomGuard;this.activateTabGuards(),this.skipTabGuardFocus=!0,this.forcingFocusOut=!0,e.focus(),window.setTimeout(()=>{this.forcingFocusOut=!1,this.activateTabGuards()})}isTabGuard(t,e){return t===this.eTopGuard&&!e||t===this.eBottomGuard&&(e??!0)}setAllowFocus(t){this.allowFocus=t}},Ipe=class extends wn{constructor(t){super(),this.comp=t}initialiseTabGuard(t){this.eTopGuard=this.createTabGuard("top"),this.eBottomGuard=this.createTabGuard("bottom"),this.eFocusableElement=this.comp.getFocusableElement();const{eTopGuard:e,eBottomGuard:n,eFocusableElement:i}=this,r=[e,n],o={setTabIndex:z=>{r.forEach(L=>z!=null?L.setAttribute("tabindex",z):L.removeAttribute("tabindex"))}};this.addTabGuards(e,n);const{focusTrapActive:c=!1,onFocusIn:s,onFocusOut:f,focusInnerElement:v,handleKeyDown:w,onTabKeyDown:C,shouldStopEventPropagation:M,forceFocusOutWhenTabGuardsAreEmpty:F,isFocusableContainer:N}=t;this.tabGuardCtrl=this.createManagedBean(new mq({comp:o,focusTrapActive:c,eTopGuard:e,eBottomGuard:n,eFocusableElement:i,onFocusIn:s,onFocusOut:f,focusInnerElement:v,handleKeyDown:w,onTabKeyDown:C,shouldStopEventPropagation:M,forceFocusOutWhenTabGuardsAreEmpty:F,isFocusableContainer:N}))}getTabGuardCtrl(){return this.tabGuardCtrl}createTabGuard(t){const e=this.gos.getDocument().createElement("div"),n=t==="top"?"ag-tab-guard-top":"ag-tab-guard-bottom";return e.classList.add("ag-tab-guard",n),ld(e,"presentation"),e}addTabGuards(t,e){this.eFocusableElement.insertAdjacentElement("afterbegin",t),this.eFocusableElement.insertAdjacentElement("beforeend",e)}removeAllChildrenExceptTabGuards(){const t=[this.eTopGuard,this.eBottomGuard];Cu(this.comp.getFocusableElement()),this.addTabGuards(...t)}forceFocusOutOfContainer(t=!1){this.tabGuardCtrl.forceFocusOutOfContainer(t)}appendChild(t,e,n){b3(e)||(e=e.getGui());const{eBottomGuard:i}=this;i?i.insertAdjacentElement("beforebegin",e):t(e,n)}},Dpe=class extends Js{initialiseTabGuard(e){this.tabGuardFeature=this.createManagedBean(new Ipe(this)),this.tabGuardFeature.initialiseTabGuard(e)}forceFocusOutOfContainer(e=!1){this.tabGuardFeature.forceFocusOutOfContainer(e)}appendChild(e,n){this.tabGuardFeature.appendChild(super.appendChild.bind(this),e,n)}},Fpe=0,Lpe=200,Ope=class extends wn{constructor(){super(...arguments),this.beanName="popupService",this.popupList=[]}wireBeans(t){this.ctrlsService=t.ctrlsService,this.resizeObserverService=t.resizeObserverService,this.environment=t.environment}postConstruct(){this.ctrlsService.whenReady(t=>{this.gridCtrl=t.gridCtrl}),this.addManagedEventListeners({gridStylesChanged:this.handleThemeChange.bind(this)})}getPopupParent(){const t=this.gos.get("popupParent");return t||this.gridCtrl.getGui()}positionPopupForMenu(t){const{eventSource:e,ePopup:n}=t,i=this.getPopupIndex(n);if(i!==-1){const F=this.popupList[i];F.alignedToElement=e}const r=e.getBoundingClientRect(),o=this.getParentRect(),c=this.keepXYWithinBounds(n,r.top-o.top,0),s=n.clientWidth>0?n.clientWidth:200;n.style.minWidth=`${s}px`;const v=o.right-o.left-s;let w;this.gos.get("enableRtl")?(w=M(),w<0&&(w=C(),this.setAlignedStyles(n,"left")),w>v&&(w=0,this.setAlignedStyles(n,"right"))):(w=C(),w>v&&(w=M(),this.setAlignedStyles(n,"right")),w<0&&(w=0,this.setAlignedStyles(n,"left"))),n.style.left=`${w}px`,n.style.top=`${c}px`;function C(){return r.right-o.left-2}function M(){return r.left-o.left-s}}positionPopupUnderMouseEvent(t){const{ePopup:e,nudgeX:n,nudgeY:i,skipObserver:r}=t;this.positionPopup({ePopup:e,nudgeX:n,nudgeY:i,keepWithinBounds:!0,skipObserver:r,updatePosition:()=>this.calculatePointerAlign(t.mouseEvent),postProcessCallback:()=>this.callPostProcessPopup(t.type,t.ePopup,null,t.mouseEvent,t.column,t.rowNode)})}calculatePointerAlign(t){const e=this.getParentRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}positionPopupByComponent(t){const{ePopup:e,nudgeX:n,nudgeY:i,keepWithinBounds:r,eventSource:o,alignSide:c="left",position:s="over",column:f,rowNode:v,type:w}=t,C=o.getBoundingClientRect(),M=this.getParentRect(),F=this.getPopupIndex(e);if(F!==-1){const z=this.popupList[F];z.alignedToElement=o}const N=()=>{let z=C.left-M.left;c==="right"&&(z-=e.offsetWidth-C.width);let L;return s==="over"?(L=C.top-M.top,this.setAlignedStyles(e,"over")):(this.setAlignedStyles(e,"under"),this.shouldRenderUnderOrAbove(e,C,M,t.nudgeY||0)==="under"?L=C.top-M.top+C.height:L=C.top-e.offsetHeight-(i||0)*2-M.top),{x:z,y:L}};this.positionPopup({ePopup:e,nudgeX:n,nudgeY:i,keepWithinBounds:r,updatePosition:N,postProcessCallback:()=>this.callPostProcessPopup(w,e,o,null,f,v)})}shouldRenderUnderOrAbove(t,e,n,i){const r=n.bottom-e.bottom,o=e.top-n.top,c=t.offsetHeight+i;return r>c?"under":o>c||o>r?"above":"under"}setAlignedStyles(t,e){const n=this.getPopupIndex(t);if(n===-1)return;const i=this.popupList[n],{alignedToElement:r}=i;!r||(["right","left","over","above","under"].forEach(c=>{r.classList.remove(`ag-has-popup-positioned-${c}`),t.classList.remove(`ag-popup-positioned-${c}`)}),!e)||(r.classList.add(`ag-has-popup-positioned-${e}`),t.classList.add(`ag-popup-positioned-${e}`))}callPostProcessPopup(t,e,n,i,r,o){const c=this.gos.getCallback("postProcessPopup");c&&c({column:r,rowNode:o,ePopup:e,type:t,eventSource:n,mouseEvent:i})}positionPopup(t){const{ePopup:e,keepWithinBounds:n,nudgeX:i,nudgeY:r,skipObserver:o,updatePosition:c}=t,s={width:0,height:0},f=(v=!1)=>{let{x:w,y:C}=c();v&&e.clientWidth===s.width&&e.clientHeight===s.height||(s.width=e.clientWidth,s.height=e.clientHeight,i&&(w+=i),r&&(C+=r),n&&(w=this.keepXYWithinBounds(e,w,1),C=this.keepXYWithinBounds(e,C,0)),e.style.left=`${w}px`,e.style.top=`${C}px`,t.postProcessCallback&&t.postProcessCallback())};if(f(),!o){const v=this.resizeObserverService.observeResize(e,()=>f(!0));setTimeout(()=>v(),Lpe)}}getActivePopups(){return this.popupList.map(t=>t.element)}getPopupList(){return this.popupList}getParentRect(){const t=this.gos.getDocument();let e=this.getPopupParent();return e===t.body?e=t.documentElement:getComputedStyle(e).position==="static"&&(e=e.offsetParent),p7(e)}keepXYWithinBounds(t,e,n){const i=n===0,r=i?"clientHeight":"clientWidth",o=i?"top":"left",c=i?"height":"width",s=i?"scrollTop":"scrollLeft",f=this.gos.getDocument(),v=f.documentElement,w=this.getPopupParent(),C=t.getBoundingClientRect(),M=w.getBoundingClientRect(),F=f.documentElement.getBoundingClientRect(),N=w===f.body,z=Math.ceil(C[c]);let P=N?(i?f7:iT)(v)+v[s]:w[r];N&&(P-=Math.abs(F[o]-M[o]));const H=P-z;return Math.min(Math.max(e,0),Math.abs(H))}addPopup(t){const e=this.gos.getDocument(),{eChild:n,ariaLabel:i,alwaysOnTop:r,positionCallback:o,anchorToElement:c}=t;if(!e)return Tn("could not find the document, document is empty"),{hideFunc:()=>{}};const s=this.getPopupIndex(n);if(s!==-1)return{hideFunc:this.popupList[s].hideFunc};this.initialisePopupPosition(n);const f=this.createPopupWrapper(n,i,!!r),v=this.addEventListenersToPopup({...t,wrapperEl:f});return o&&o(),this.addPopupToPopupList(n,f,v,c),{hideFunc:v}}initialisePopupPosition(t){const n=this.getPopupParent().getBoundingClientRect();$n(t.style.top)||(t.style.top=`${n.top*-1}px`),$n(t.style.left)||(t.style.left=`${n.left*-1}px`)}createPopupWrapper(t,e,n){const i=this.getPopupParent(),r=document.createElement("div");return this.environment.applyThemeClasses(r),r.classList.add("ag-popup"),t.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr","ag-popup-child"),t.hasAttribute("role")||ld(t,"dialog"),nw(t,e),r.appendChild(t),i.appendChild(r),n?this.setAlwaysOnTop(t,!0):this.bringPopupToFront(t),r}handleThemeChange(t){if(t.themeChanged)for(const e of this.popupList)this.environment.applyThemeClasses(e.wrapper)}addEventListenersToPopup(t){const e=this.gos.getDocument(),n=this.getPopupParent(),{wrapperEl:i,eChild:r,closedCallback:o,afterGuiAttached:c,closeOnEsc:s,modal:f}=t;let v=!1;const w=N=>{if(!i.contains(this.gos.getActiveDomElement()))return;N.key===mn.ESCAPE&&!Yg(N)&&F({keyboardEvent:N})},C=N=>F({mouseEvent:N}),M=N=>F({touchEvent:N}),F=(N={})=>{const{mouseEvent:z,touchEvent:L,keyboardEvent:P,forceHide:H}=N;!H&&(this.isEventFromCurrentPopup({mouseEvent:z,touchEvent:L},r)||v)||(v=!0,n.removeChild(i),e.removeEventListener("keydown",w),e.removeEventListener("mousedown",C),e.removeEventListener("touchstart",M),e.removeEventListener("contextmenu",C),this.eventService.removeEventListener("dragStarted",C),o&&o(z||L||P),this.removePopupFromPopupList(r))};return c&&c({hidePopup:F}),window.setTimeout(()=>{s&&e.addEventListener("keydown",w),f&&(e.addEventListener("mousedown",C),this.eventService.addEventListener("dragStarted",C),e.addEventListener("touchstart",M),e.addEventListener("contextmenu",C))},0),F}addPopupToPopupList(t,e,n,i){this.popupList.push({element:t,wrapper:e,hideFunc:n,instanceId:Fpe++,isAnchored:!!i}),i&&this.setPopupPositionRelatedToElement(t,i)}getPopupIndex(t){return this.popupList.findIndex(e=>e.element===t)}setPopupPositionRelatedToElement(t,e){const n=this.getPopupIndex(t);if(n===-1)return;const i=this.popupList[n];if(i.stopAnchoringPromise&&i.stopAnchoringPromise.then(o=>o&&o()),i.stopAnchoringPromise=void 0,i.isAnchored=!1,!e)return;const r=this.keepPopupPositionedRelativeTo({element:e,ePopup:t,hidePopup:i.hideFunc});return i.stopAnchoringPromise=r,i.isAnchored=!0,r}removePopupFromPopupList(t){this.setAlignedStyles(t,null),this.setPopupPositionRelatedToElement(t,null),this.popupList=this.popupList.filter(e=>e.element!==t)}keepPopupPositionedRelativeTo(t){const e=this.getPopupParent(),n=e.getBoundingClientRect(),{element:i,ePopup:r}=t,o=i.getBoundingClientRect(),c=n.top-o.top,s=n.left-o.left;let f=c,v=s;const w=r.style.top,C=parseInt(w.substring(0,w.length-1),10),M=r.style.left,F=parseInt(M.substring(0,M.length-1),10),N=this.getFrameworkOverrides();return new Zo(z=>{N.wrapIncoming(()=>{N.setInterval(()=>{const L=e.getBoundingClientRect(),P=i.getBoundingClientRect();if(P.top==0&&P.left==0&&P.height==0&&P.width==0){t.hidePopup();return}const j=L.top-P.top;if(j!=f){const le=this.keepXYWithinBounds(r,C+c-j,0);r.style.top=`${le}px`}f=j;const q=L.left-P.left;if(q!=v){const le=this.keepXYWithinBounds(r,F+s-q,1);r.style.left=`${le}px`}v=q},200).then(L=>{z(()=>{L!=null&&window.clearInterval(L)})})},"popupPositioning")})}hasAnchoredPopup(){return this.popupList.some(t=>t.isAnchored)}isEventFromCurrentPopup(t,e){const{mouseEvent:n,touchEvent:i}=t,r=n||i;if(!r)return!1;const o=this.getPopupIndex(e);if(o===-1)return!1;for(let c=o;c<this.popupList.length;c++){const s=this.popupList[c];if(uce(s.element,r))return!0}return this.isElementWithinCustomPopup(r.target)}isElementWithinCustomPopup(t){const e=this.gos.getDocument();for(;t&&t!==e.body;){if(t.classList.contains("ag-custom-component-popup")||t.parentElement===null)return!0;t=t.parentElement}return!1}getWrapper(t){for(;!t.classList.contains("ag-popup")&&t.parentElement;)t=t.parentElement;return t.classList.contains("ag-popup")?t:null}setAlwaysOnTop(t,e){const n=this.getWrapper(t);n&&(n.classList.toggle("ag-always-on-top",!!e),e&&this.bringPopupToFront(n))}bringPopupToFront(t){const e=this.getPopupParent(),n=Array.prototype.slice.call(e.querySelectorAll(".ag-popup")),i=n.length,r=Array.prototype.slice.call(e.querySelectorAll(".ag-popup.ag-always-on-top")),o=r.length,c=this.getWrapper(t);if(!c||i<=1||!e.contains(t))return!1;const s=n.indexOf(c),f=c.querySelectorAll("div"),v=[];f.forEach(C=>{C.scrollTop!==0&&v.push([C,C.scrollTop])});let w=!1;for(o?c.classList.contains("ag-always-on-top")?s!==i-1&&(Yr(r).insertAdjacentElement("afterend",c),w=!0):s!==i-o-1&&(r[0].insertAdjacentElement("beforebegin",c),w=!0):s!==i-1&&(Yr(n).insertAdjacentElement("afterend",c),w=!0);v.length;){const C=v.pop();C[0].scrollTop=C[1]}return w}},kpe=["touchstart","touchend","touchmove","touchcancel"],gq=class{constructor(t="javascript"){this.frameworkName=t,this.renderingEngine="vanilla",this.wrapIncoming=e=>e(),this.wrapOutgoing=e=>e()}setInterval(t,e){return new Zo(n=>{n(window.setInterval(t,e))})}addEventListener(t,e,n,i){const r=t_(kpe,e);t.addEventListener(e,n,{capture:!!i,passive:r})}get shouldWrapOutgoing(){return!1}frameworkComponent(t){return null}isFrameworkComponent(t){return!1}getDocLink(t){return`https://www.ag-grid.com/${this.frameworkName==="solid"?"react":this.frameworkName}-data-grid${t?`/${t}`:""}`}},Npe=class extends wn{constructor(){super(...arguments),this.beanName="cellNavigationService"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer,this.pinnedRowModel=t.pinnedRowModel,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService}getNextCellToFocus(t,e,n=!1){return n?this.getNextCellToFocusWithCtrlPressed(t,e):this.getNextCellToFocusWithoutCtrlPressed(t,e)}getNextCellToFocusWithCtrlPressed(t,e){const n=t===mn.UP,i=t===mn.DOWN,r=t===mn.LEFT;let o,c;if(n||i)c=n?this.pageBoundsService.getFirstRow():this.pageBoundsService.getLastRow(),o=e.column;else{const s=this.visibleColsService.getAllCols(),f=this.gos.get("enableRtl");c=e.rowIndex,o=r!==f?s[0]:Yr(s)}return{rowIndex:c,rowPinned:null,column:o}}getNextCellToFocusWithoutCtrlPressed(t,e){let n=e,i=!1;for(;!i;){switch(t){case mn.UP:n=this.getCellAbove(n);break;case mn.DOWN:n=this.getCellBelow(n);break;case mn.RIGHT:this.gos.get("enableRtl")?n=this.getCellToLeft(n):n=this.getCellToRight(n);break;case mn.LEFT:this.gos.get("enableRtl")?n=this.getCellToRight(n):n=this.getCellToLeft(n);break;default:n=null,Tn("unknown key for navigation ",t);break}n?i=this.isCellGoodToFocusOn(n):i=!0}return n}isCellGoodToFocusOn(t){const e=t.column;let n;switch(t.rowPinned){case"top":n=this.pinnedRowModel.getPinnedTopRow(t.rowIndex);break;case"bottom":n=this.pinnedRowModel.getPinnedBottomRow(t.rowIndex);break;default:n=this.rowModel.getRow(t.rowIndex);break}return n?!e.isSuppressNavigable(n):!1}getCellToLeft(t){if(!t)return null;const e=this.visibleColsService.getColBefore(t.column);return e?{rowIndex:t.rowIndex,column:e,rowPinned:t.rowPinned}:null}getCellToRight(t){if(!t)return null;const e=this.visibleColsService.getColAfter(t.column);return e?{rowIndex:t.rowIndex,column:e,rowPinned:t.rowPinned}:null}getRowBelow(t){const e=t.rowIndex,n=t.rowPinned;if(this.isLastRowInContainer(t))switch(n){case"bottom":return null;case"top":return this.rowModel.isRowsToRender()?{rowIndex:this.pageBoundsService.getFirstRow(),rowPinned:null}:this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null;default:return this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null}const i=this.rowModel.getRow(t.rowIndex),r=this.getNextStickyPosition(i);return r||{rowIndex:e+1,rowPinned:n}}getNextStickyPosition(t,e){if(!this.gos.isGroupRowsSticky()||!t||!t.sticky)return;const n=this.rowRenderer.getStickyTopRowCtrls().some(s=>s.getRowNode().rowIndex===t.rowIndex);let i=[];n?i=[...this.rowRenderer.getStickyTopRowCtrls()].sort((s,f)=>s.getRowNode().rowIndex-f.getRowNode().rowIndex):i=[...this.rowRenderer.getStickyBottomRowCtrls()].sort((s,f)=>f.getRowNode().rowIndex-s.getRowNode().rowIndex);const r=e?-1:1,o=i.findIndex(s=>s.getRowNode().rowIndex===t.rowIndex),c=i[o+r];if(c)return{rowIndex:c.getRowNode().rowIndex,rowPinned:null}}getCellBelow(t){if(!t)return null;const e=this.getRowBelow(t);return e?{rowIndex:e.rowIndex,column:t.column,rowPinned:e.rowPinned}:null}isLastRowInContainer(t){const e=t.rowPinned,n=t.rowIndex;return e==="top"?this.pinnedRowModel.getPinnedTopRowNodes().length-1<=n:e==="bottom"?this.pinnedRowModel.getPinnedBottomRowNodes().length-1<=n:this.pageBoundsService.getLastRow()<=n}getRowAbove(t){const e=t.rowIndex,n=t.rowPinned;if(n?e===0:e===this.pageBoundsService.getFirstRow())return n==="top"?null:n?this.rowModel.isRowsToRender()?this.getLastBodyCell():this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null:this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null;const r=this.rowModel.getRow(t.rowIndex),o=this.getNextStickyPosition(r,!0);return o||{rowIndex:e-1,rowPinned:n}}getCellAbove(t){if(!t)return null;const e=this.getRowAbove({rowIndex:t.rowIndex,rowPinned:t.rowPinned});return e?{rowIndex:e.rowIndex,column:t.column,rowPinned:e.rowPinned}:null}getLastBodyCell(){return{rowIndex:this.pageBoundsService.getLastRow(),rowPinned:null}}getLastFloatingTopRow(){return{rowIndex:this.pinnedRowModel.getPinnedTopRowNodes().length-1,rowPinned:"top"}}getNextTabbedCell(t,e){return e?this.getNextTabbedCellBackwards(t):this.getNextTabbedCellForwards(t)}getNextTabbedCellForwards(t){var o;const e=this.visibleColsService.getAllCols();let n=t.rowIndex,i=t.rowPinned,r=this.visibleColsService.getColAfter(t.column);if(!r){r=e[0];const c=this.getRowBelow(t);if(Hr(c)||!c.rowPinned&&!(((o=this.paginationService)==null?void 0:o.isRowInPage(c))??!0))return null;n=c?c.rowIndex:null,i=c?c.rowPinned:null}return{rowIndex:n,column:r,rowPinned:i}}getNextTabbedCellBackwards(t){var o;const e=this.visibleColsService.getAllCols();let n=t.rowIndex,i=t.rowPinned,r=this.visibleColsService.getColBefore(t.column);if(!r){r=Yr(e);const c=this.getRowAbove({rowIndex:t.rowIndex,rowPinned:t.rowPinned});if(Hr(c)||!c.rowPinned&&!(((o=this.paginationService)==null?void 0:o.isRowInPage(c))??!0))return null;n=c?c.rowIndex:null,i=c?c.rowPinned:null}return{rowIndex:n,column:r,rowPinned:i}}};function Bpe(t,e){t.eventService.dispatchEvent(e)}var zpe=class extends wn{constructor(){super(...arguments),this.beanName="apiFunctionService",this.functions={dispatchEvent:Bpe},this.isDestroyed=!1}wireBeans(t){this.beans=t}postConstruct(){this.preDestroyLink=this.frameworkOverrides.getDocLink("grid-lifecycle/#grid-pre-destroyed")}callFunction(t,e){var i;const n=this.functions[t];if(n)return n.apply(n,[this.beans,...e]);if(this.isDestroyed)return this.destroyedHandler(t);this.isFrameworkMethod(t)||(i=this.beans.validationService)==null||i.warnMissingApiFunction(t)}addFunction(t,e){const{validationService:n}=this.beans;n&&(e=n.validateApiFunction(t,e)),this.functions[t]=e}destroy(){this.functions={},this.isDestroyed=!0,super.destroy()}destroyedHandler(t){if(t==="isDestroyed")return!0;t!=="destroy"&&Tn(`Grid API function ${t}() cannot be called as the grid has been destroyed.
Either clear local references to the grid api, when it is destroyed, or check gridApi.isDestroyed() to avoid calling methods against a destroyed grid.
To run logic when the grid is about to be destroyed use the gridPreDestroy event. See: ${this.preDestroyLink}`)}isFrameworkMethod(t){return["preWireBeans","wireBeans","preConstruct","postConstruct"].includes(t)}};function Upe(t){const e=t.getBean("apiFunctionService");return new Proxy(e,{get(n,i){if(i!=="then")return(...r)=>n.callFunction(i,r)}})}function Vpe(t){return{beanName:"gridApi",bean:Upe(t)}}var Gpe=class extends wn{constructor(){super(...arguments),this.beanName="columnDefFactory"}buildColumnDefs(t,e,n){const i=[],r={};return t.forEach(o=>{const c=this.createDefFromColumn(o,e,n);let s=!0,f=c,v=o.getOriginalParent(),w=null;for(;v;){let C=null;if(v.isPadding()){v=v.getOriginalParent();continue}const M=r[v.getGroupId()];if(M){M.children.push(f),s=!1;break}if(C=this.createDefFromGroup(v),C&&(C.children=[f],r[C.groupId]=C,f=C,v=v.getOriginalParent()),v!=null&&w===v){s=!1;break}w=v}s&&i.push(f)}),i}createDefFromGroup(t){const e=wL(t.getColGroupDef(),["children"]);return e&&(e.groupId=t.getGroupId()),e}createDefFromColumn(t,e,n){const i=wL(t.getColDef());return i.colId=t.getColId(),i.width=t.getActualWidth(),i.rowGroup=t.isRowGroupActive(),i.rowGroupIndex=t.isRowGroupActive()?e.indexOf(t):null,i.pivot=t.isPivotActive(),i.pivotIndex=t.isPivotActive()?n.indexOf(t):null,i.aggFunc=t.isValueActive()?t.getAggFunc():null,i.hide=t.isVisible()?void 0:!0,i.pinned=t.isPinned()?t.getPinned():null,i.sort=t.getSort()?t.getSort():null,i.sortIndex=t.getSortIndex()!=null?t.getSortIndex():null,i}},Hpe=class extends wn{constructor(){super(...arguments),this.beanName="columnEventDispatcher"}visibleCols(){const t={type:"displayedColumnsChanged"};this.eventService.dispatchEvent(t)}gridColumns(){const t={type:"gridColumnsChanged"};this.eventService.dispatchEvent(t)}headerHeight(t){const e={type:"columnHeaderHeightChanged",column:t,columns:[t],source:"autosizeColumnHeaderHeight"};this.eventService.dispatchEvent(e)}groupOpened(t){const e={type:"columnGroupOpened",columnGroup:t.length===1?t[0]:void 0,columnGroups:t};this.eventService.dispatchEvent(e)}rowGroupChanged(t,e){const n={type:"columnRowGroupChanged",columns:t,column:t.length===1?t[0]:null,source:e};this.eventService.dispatchEvent(n)}genericColumnEvent(t,e,n){const i={type:t,columns:e,column:e.length===1?e[0]:null,source:n};this.eventService.dispatchEvent(i)}pivotModeChanged(){const t={type:"columnPivotModeChanged"};this.eventService.dispatchEvent(t)}virtualColumnsChanged(t){const e={type:"virtualColumnsChanged",afterScroll:t};this.eventService.dispatchEvent(e)}newColumnsLoaded(t){const e={type:"newColumnsLoaded",source:t};this.eventService.dispatchEvent(e)}everythingChanged(t){const e={type:"columnEverythingChanged",source:t};this.eventService.dispatchEvent(e)}columnMoved(t){const{movedColumns:e,source:n,toIndex:i,finished:r}=t,o={type:"columnMoved",columns:e,column:e&&e.length===1?e[0]:null,toIndex:i,finished:r,source:n};this.eventService.dispatchEvent(o)}columnPinned(t,e){if(!t.length)return;const n=t.length===1?t[0]:null,i=this.getCommonValue(t,o=>o.getPinned()),r={type:"columnPinned",pinned:i??null,columns:t,column:n,source:e};this.eventService.dispatchEvent(r)}columnVisible(t,e){if(!t.length)return;const n=t.length===1?t[0]:null,r={type:"columnVisible",visible:this.getCommonValue(t,o=>o.isVisible()),columns:t,column:n,source:e};this.eventService.dispatchEvent(r)}getCommonValue(t,e){if(!t||t.length==0)return;const n=e(t[0]);for(let i=1;i<t.length;i++)if(n!==e(t[i]))return;return n}columnChanged(t,e,n){const i={type:t,columns:e,column:e&&e.length==1?e[0]:null,source:n};this.eventService.dispatchEvent(i)}columnResized(t,e,n,i=null){if(t&&t.length){const r={type:"columnResized",columns:t,column:t.length===1?t[0]:null,flexColumns:i,finished:e,source:n};this.eventService.dispatchEvent(r)}}},Wpe=class extends wn{constructor(){super(...arguments),this.beanName="columnGetStateService"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService}getColumnState(){const t=this.columnModel.getColDefCols();if(Hr(t)||!this.columnModel.isAlive())return[];const n=this.columnModel.getAllCols().map(this.createStateItemFromColumn.bind(this));return this.orderColumnStateList(n),n}createStateItemFromColumn(t){const e=this.funcColsService.getRowGroupColumns(),n=this.funcColsService.getPivotColumns(),i=t.isRowGroupActive()?e.indexOf(t):null,r=t.isPivotActive()?n.indexOf(t):null,o=t.isValueActive()?t.getAggFunc():null,c=t.getSort()!=null?t.getSort():null,s=t.getSortIndex()!=null?t.getSortIndex():null,f=t.getFlex()!=null&&t.getFlex()>0?t.getFlex():null;return{colId:t.getColId(),width:t.getActualWidth(),hide:!t.isVisible(),pinned:t.getPinned(),sort:c,sortIndex:s,aggFunc:o,rowGroup:t.isRowGroupActive(),rowGroupIndex:i,pivot:t.isPivotActive(),pivotIndex:r,flex:f}}orderColumnStateList(t){const e=this.columnModel.getCols(),n=new Map(e.map((i,r)=>[i.getColId(),r]));t.sort((i,r)=>{const o=n.has(i.colId)?n.get(i.colId):-1,c=n.has(r.colId)?n.get(r.colId):-1;return o-c})}},jpe=class extends wn{constructor(){super(...arguments),this.beanName="columnGroupStateService"}wireBeans(t){this.columnModel=t.columnModel,this.columnAnimationService=t.columnAnimationService,this.eventDispatcher=t.columnEventDispatcher,this.visibleColsService=t.visibleColsService}getColumnGroupState(){const t=[],e=this.columnModel.getColTree();return Jp(null,e,n=>{ql(n)&&t.push({groupId:n.getGroupId(),open:n.isExpanded()})}),t}resetColumnGroupState(t){const e=this.columnModel.getColDefColTree();if(!e)return;const n=[];Jp(null,e,i=>{if(ql(i)){const r=i.getColGroupDef(),o={groupId:i.getGroupId(),open:r?r.openByDefault:void 0};n.push(o)}}),this.setColumnGroupState(n,t)}setColumnGroupState(t,e){if(!this.columnModel.getColTree())return;this.columnAnimationService.start();const i=[];t.forEach(r=>{const o=r.groupId,c=r.open,s=this.columnModel.getProvidedColGroup(o);s&&s.isExpanded()!==c&&(s.setExpanded(c),i.push(s))}),this.visibleColsService.refresh(e,!0),i.length&&this.eventDispatcher.groupOpened(i),this.columnAnimationService.finish()}},$pe=class extends wn{constructor(){super(...arguments),this.beanName="columnViewportService",this.colsWithinViewport=[],this.headerColsWithinViewport=[],this.colsWithinViewportHash="",this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={}}wireBeans(t){this.visibleColsService=t.visibleColsService,this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher}postConstruct(){this.suppressColumnVirtualisation=this.gos.get("suppressColumnVirtualisation")}setScrollPosition(t,e,n=!1){const i=this.visibleColsService.isBodyWidthDirty();if(!(t===this.scrollWidth&&e===this.scrollPosition&&!i)){if(this.scrollWidth=t,this.scrollPosition=e,this.visibleColsService.setBodyWidthDirty(),this.gos.get("enableRtl")){const o=this.visibleColsService.getBodyContainerWidth();this.viewportLeft=o-this.scrollPosition-this.scrollWidth,this.viewportRight=o-this.scrollPosition}else this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition;this.columnModel.isReady()&&this.checkViewportColumns(n)}}getHeadersToRender(t,e){let n;switch(t){case"left":n=this.rowsOfHeadersToRenderLeft[e];break;case"right":n=this.rowsOfHeadersToRenderRight[e];break;default:n=this.rowsOfHeadersToRenderCenter[e];break}return n||[]}extractViewportColumns(){const t=this.visibleColsService.getCenterCols();this.isColumnVirtualisationSuppressed()?(this.colsWithinViewport=t,this.headerColsWithinViewport=t):(this.colsWithinViewport=t.filter(this.isColumnInRowViewport.bind(this)),this.headerColsWithinViewport=t.filter(this.isColumnInHeaderViewport.bind(this)))}isColumnVirtualisationSuppressed(){return this.suppressColumnVirtualisation||this.viewportRight===0}clear(){this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={},this.colsWithinViewportHash=""}isColumnInHeaderViewport(t){return t.isAutoHeaderHeight()?!0:this.isColumnInRowViewport(t)}isColumnInRowViewport(t){if(t.isAutoHeight())return!0;const e=t.getLeft()||0,n=e+t.getActualWidth(),i=this.viewportLeft-200,r=this.viewportRight+200,o=e<i&&n<i,c=e>r&&n>r;return!o&&!c}getViewportColumns(){const t=this.visibleColsService.getLeftCols(),e=this.visibleColsService.getRightCols();return this.colsWithinViewport.concat(t).concat(e)}getColsWithinViewport(t){if(!this.columnModel.isColSpanActive())return this.colsWithinViewport;const e=r=>{const o=r.getLeft();return $n(o)&&o>this.viewportLeft},n=this.isColumnVirtualisationSuppressed()?null:this.isColumnInRowViewport.bind(this),i=this.visibleColsService.getColsCenter();return this.visibleColsService.getColsForRow(t,i,n,e)}checkViewportColumns(t=!1){this.extractViewport()&&this.eventDispatcher.virtualColumnsChanged(t)}calculateHeaderRows(){this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={};const t={},e=this.visibleColsService.getLeftCols(),n=this.visibleColsService.getRightCols();this.headerColsWithinViewport.concat(e).concat(n).forEach(o=>t[o.getId()]=!0);const r=(o,c,s)=>{let f=!1;for(let v=0;v<o.length;v++){const w=o[v];let C=!1;if(av(w))C=t[w.getId()]===!0;else{const F=w.getDisplayedChildren();F&&(C=r(F,c,s+1))}C&&(f=!0,c[s]||(c[s]=[]),c[s].push(w))}return f};r(this.visibleColsService.getTreeLeft(),this.rowsOfHeadersToRenderLeft,0),r(this.visibleColsService.getTreeRight(),this.rowsOfHeadersToRenderRight,0),r(this.visibleColsService.getTreeCenter(),this.rowsOfHeadersToRenderCenter,0)}extractViewport(){const t=i=>`${i.getId()}-${i.getPinned()||"normal"}`;this.extractViewportColumns();const e=this.getViewportColumns().map(t).join("#"),n=this.colsWithinViewportHash!==e;return n&&(this.colsWithinViewportHash=e,this.calculateHeaderRows()),n}},qpe=class extends wn{constructor(){super(...arguments),this.beanName="agComponentUtils"}wireBeans(t){this.componentMetadataProvider=t.componentMetadataProvider}adaptFunction(t,e){const n=this.componentMetadataProvider.retrieve(t);return n&&n.functionAdapter?n.functionAdapter(e):null}adaptCellRendererFunction(t){class e{refresh(){return!1}getGui(){return this.eGui}init(i){const r=t(i),o=typeof r;if(o==="string"||o==="number"||o==="boolean"){this.eGui=iw("<span>"+r+"</span>");return}if(r==null){this.eGui=iw("<span></span>");return}this.eGui=r}}return e}doesImplementIComponent(t){return t?t.prototype&&"getGui"in t.prototype:!1}},Zpe=class extends wn{constructor(){super(...arguments),this.beanName="componentMetadataProvider"}wireBeans(t){this.agComponentUtils=t.agComponentUtils}postConstruct(){this.componentMetaData={dateComponent:{mandatoryMethodList:["getDate","setDate"],optionalMethodList:["afterGuiAttached","setInputPlaceholder","setInputAriaLabel","setDisabled","onParamsUpdated","refresh"]},detailCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},headerComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},headerGroupComponent:{mandatoryMethodList:[],optionalMethodList:[]},loadingCellRenderer:{mandatoryMethodList:[],optionalMethodList:[],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},loadingOverlayComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},noRowsOverlayComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},floatingFilterComponent:{mandatoryMethodList:["onParentModelChanged"],optionalMethodList:["afterGuiAttached","onParamsUpdated","refresh"]},cellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},cellEditor:{mandatoryMethodList:["getValue"],optionalMethodList:["isPopup","isCancelBeforeStart","isCancelAfterEnd","getPopupPosition","focusIn","focusOut","afterGuiAttached","refresh"]},innerRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},fullWidthCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},groupRowRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},filter:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged","refresh"]},statusPanel:{mandatoryMethodList:[],optionalMethodList:["refresh"]},toolPanel:{mandatoryMethodList:[],optionalMethodList:["refresh","getState"]},tooltipComponent:{mandatoryMethodList:[],optionalMethodList:[]},menuItem:{mandatoryMethodList:[],optionalMethodList:["setActive","select","setExpanded","configureDefaults"]}}}retrieve(t){return this.componentMetaData[t]}},Xpe=["rowPositionUtils","cellPositionUtils","headerPositionUtils","paginationAutoPageSizeService","apiFunctionService","gridApi","userComponentRegistry","agComponentUtils","componentMetadataProvider","resizeObserverService","userComponentFactory","rowContainerHeightService","horizontalResizeService","localeService","validationService","pinnedRowModel","dragService","visibleColsService","eventService","gos","popupService","selectionService","columnFilterService","quickFilterService","filterManager","columnModel","headerNavigationService","pageBoundsService","paginationService","pageBoundsListener","rowRenderer","expressionService","columnFactory","alignedGridsService","navigationService","valueCache","valueService","loggerFactory","autoWidthCalculator","filterMenuFactory","dragAndDropService","focusService","mouseEventService","environment","cellNavigationService","stylingService","scrollVisibleService","sortController","columnHoverService","columnAnimationService","selectableService","autoColService","changeDetectionService","animationFrameService","undoRedoService","columnDefFactory","rowCssClassCalculator","rowNodeBlockLoader","rowNodeSorter","ctrlsService","pinnedWidthService","rowNodeEventThrottle","ctrlsFactory","dataTypeService","syncService","overlayService","stateService","expansionService","apiEventService","ariaAnnouncementService","menuService","columnApplyStateService","columnEventDispatcher","columnMoveService","columnAutosizeService","columnGetStateService","columnGroupStateService","columnSizeService","funcColsService","columnNameService","columnViewportService","pivotResultColsService","showRowGroupColsService"],Q5=Object.fromEntries(Xpe.map((t,e)=>[t,e]));function Kpe(t,e){const n=(t.beanName?Q5[t.beanName]:void 0)??Number.MAX_SAFE_INTEGER,i=(e.beanName?Q5[e.beanName]:void 0)??Number.MAX_SAFE_INTEGER;return n-i}function Ype(t,e){return(t==null?void 0:t.beanName)==="gridDestroyService"?-1:0}var Jpe=class extends wn{constructor(){super(...arguments),this.beanName="ctrlsFactory",this.registry={}}register(t){this.registry[t.name]=t.classImp}getInstance(t,...e){const n=this.registry[t];if(n!=null)return new n(...e)}},Qpe=class extends wn{constructor(){super(...arguments),this.beanName="ctrlsService",this.params={},this.ready=!1,this.readyCallbacks=[]}checkReady(){const t=this.params;this.ready=t.gridCtrl!=null&&t.gridBodyCtrl!=null&&t.center!=null&&t.left!=null&&t.right!=null&&t.bottomCenter!=null&&t.bottomLeft!=null&&t.bottomRight!=null&&t.topCenter!=null&&t.topLeft!=null&&t.topRight!=null&&t.stickyTopCenter!=null&&t.stickyTopLeft!=null&&t.stickyTopRight!=null&&t.stickyBottomCenter!=null&&t.stickyBottomLeft!=null&&t.stickyBottomRight!=null&&t.centerHeader!=null&&t.leftHeader!=null&&t.rightHeader!=null&&t.fakeHScrollComp!=null&&t.fakeVScrollComp!=null&&t.gridHeaderCtrl!=null,this.ready&&(this.readyCallbacks.forEach(e=>e(t)),this.readyCallbacks.length=0)}whenReady(t){this.ready?t(this.params):this.readyCallbacks.push(t)}register(t,e){this.params[t]=e,this.checkReady()}registerHeaderContainer(t,e){const n=this.params;switch(e){case"left":n.leftHeader=t;break;case"right":n.rightHeader=t;break;default:n.centerHeader=t;break}this.checkReady()}get(t){return this.params[t]}getParams(){return this.params}getGridBodyCtrl(){return this.params.gridBodyCtrl}getHeaderRowContainerCtrls(){const{leftHeader:t,centerHeader:e,rightHeader:n}=this.params;return[t,n,e]}getHeaderRowContainerCtrl(t){const e=this.params;switch(t){case"left":return e.leftHeader;case"right":return e.rightHeader;default:return e.centerHeader}}},eme=class extends wn{constructor(){super(...arguments),this.beanName="cellPositionUtils"}createId(t){const{rowIndex:e,rowPinned:n,column:i}=t;return this.createIdFromValues({rowIndex:e,column:i,rowPinned:n})}createIdFromValues(t){const{rowIndex:e,rowPinned:n,column:i}=t;return`${e}.${n??"null"}.${i.getId()}`}equals(t,e){const n=t.column===e.column,i=t.rowPinned===e.rowPinned,r=t.rowIndex===e.rowIndex;return n&&i&&r}},tme=class extends wn{constructor(){super(...arguments),this.beanName="rowNodeEventThrottle",this.events=[]}wireBeans(t){this.animationFrameService=t.animationFrameService,this.rowModel=t.rowModel}postConstruct(){this.rowModel.getType()=="clientSide"&&(this.clientSideRowModel=this.rowModel)}dispatchExpanded(t,e){if(this.clientSideRowModel==null){this.eventService.dispatchEvent(t);return}this.events.push(t);const n=()=>{this.clientSideRowModel&&this.clientSideRowModel.onRowGroupOpened(),this.events.forEach(i=>this.eventService.dispatchEvent(i)),this.events=[]};e?n():(this.dispatchExpandedDebounced==null&&(this.dispatchExpandedDebounced=this.animationFrameService.debounce(n)),this.dispatchExpandedDebounced())}},nme=class extends wn{constructor(){super(...arguments),this.beanName="rowPositionUtils"}wireBeans(t){this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.pageBoundsService=t.pageBoundsService}getFirstRow(){let t=0,e;return this.pinnedRowModel.getPinnedTopRowCount()?e="top":this.rowModel.getRowCount()?(e=null,t=this.pageBoundsService.getFirstRow()):this.pinnedRowModel.getPinnedBottomRowCount()&&(e="bottom"),e===void 0?null:{rowIndex:t,rowPinned:e}}getLastRow(){let t,e=null;const n=this.pinnedRowModel.getPinnedBottomRowCount(),i=this.pinnedRowModel.getPinnedTopRowCount();return n?(e="bottom",t=n-1):this.rowModel.getRowCount()?(e=null,t=this.pageBoundsService.getLastRow()):i&&(e="top",t=i-1),t===void 0?null:{rowIndex:t,rowPinned:e}}getRowNode(t){switch(t.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowNodes()[t.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowNodes()[t.rowIndex];default:return this.rowModel.getRow(t.rowIndex)}}sameRow(t,e){return!t&&!e?!0:t&&!e||!t&&e?!1:t.rowIndex===e.rowIndex&&t.rowPinned==e.rowPinned}before(t,e){switch(t.rowPinned){case"top":if(e.rowPinned!=="top")return!0;break;case"bottom":if(e.rowPinned!=="bottom")return!1;break;default:if($n(e.rowPinned))return e.rowPinned!=="top";break}return t.rowIndex<e.rowIndex}},eH={cssName:"--ag-row-height",changeKey:"rowHeightChanged",defaultValue:42},tH={cssName:"--ag-header-height",changeKey:"headerHeightChanged",defaultValue:48},nH={cssName:"--ag-list-item-height",changeKey:"listItemHeightChanged",defaultValue:24},ime=class extends wn{constructor(){super(...arguments),this.beanName="environment",this.sizeEls=new Map,this.lastKnownValues=new Map,this.themeClasses=[],this.eThemeAncestor=null,this.eMeasurementContainer=null,this.sizesMeasured=!1}wireBeans(t){this.resizeObserverService=t.resizeObserverService,this.eGridDiv=t.eGridDiv}postConstruct(){this.addManagedPropertyListener("rowHeight",()=>this.refreshRowHeightVariable()),this.themeClasses=this.getAncestorThemeClasses(),this.setUpThemeClassObservers(),this.getSizeEl(eH),this.getSizeEl(tH),this.getSizeEl(nH)}getDefaultRowHeight(){return this.getCSSVariablePixelValue(eH)}getDefaultHeaderHeight(){return this.getCSSVariablePixelValue(tH)}getDefaultListItemHeight(){return this.getCSSVariablePixelValue(nH)}hasMeasuredSizes(){return this.sizesMeasured}getThemeClasses(){return this.themeClasses}applyThemeClasses(t){for(const e of Array.from(t.classList))e.startsWith("ag-theme-")&&!this.themeClasses.includes(e)&&t.classList.remove(e);for(const e of this.themeClasses)t.classList.contains(e)||t.classList.add(e)}getThemeAncestorElement(){return this.eThemeAncestor}refreshRowHeightVariable(){const t=this.eGridDiv.style.getPropertyValue("--ag-line-height").trim(),e=this.gos.get("rowHeight");if(e==null||isNaN(e)||!isFinite(e))return t!==null&&this.eGridDiv.style.setProperty("--ag-line-height",null),-1;const n=`${e}px`;return t!=n?(this.eGridDiv.style.setProperty("--ag-line-height",n),e):t!=""?parseFloat(t):-1}getCSSVariablePixelValue(t){const e=this.lastKnownValues.get(t);if(e!=null)return e;const n=this.measureSizeEl(t);return n==="detached"||n==="no-styles"?t.defaultValue:(this.lastKnownValues.set(t,n),n)}measureSizeEl(t){const e=this.getSizeEl(t);if(e.offsetParent==null)return"detached";const n=e.offsetWidth;return n===iH?"no-styles":(this.sizesMeasured=!0,n)}getSizeEl(t){let e=this.sizeEls.get(t);if(e)return e;let n=this.eMeasurementContainer;n||(n=this.eMeasurementContainer=document.createElement("div"),n.className="ag-measurement-container",this.eGridDiv.appendChild(n)),e=document.createElement("div"),e.style.width=`var(${t.cssName}, ${iH}px)`,n.appendChild(e),this.sizeEls.set(t,e);let i=this.measureSizeEl(t);i==="no-styles"&&Tn(`no value for ${t.cssName}. This usually means that the grid has been initialised before styles have been loaded. The default value of ${t.defaultValue} will be used and updated when styles load.`);const r=this.resizeObserverService.observeResize(e,()=>{const o=this.measureSizeEl(t);o==="detached"||o==="no-styles"||(this.lastKnownValues.set(t,o),o!==i&&(i=o,this.fireGridStylesChangedEvent(t.changeKey)))});return this.addDestroyFunc(()=>r()),e}fireGridStylesChangedEvent(t){const e={type:"gridStylesChanged",[t]:!0};this.eventService.dispatchEvent(e)}setUpThemeClassObservers(){const t=new MutationObserver(()=>{const n=this.getAncestorThemeClasses();rme(n,this.themeClasses)||(this.themeClasses=n,this.fireGridStylesChangedEvent("themeChanged"))});let e=this.eGridDiv;for(;e;)t.observe(e||this.eGridDiv,{attributes:!0,attributeFilter:["class"]}),e=e.parentElement}getAncestorThemeClasses(){let t=this.eGridDiv;const e=[];for(this.eThemeAncestor=null;t;){const n=Array.from(t.classList).filter(i=>i.startsWith("ag-theme-"));for(const i of n)this.eThemeAncestor=t,e.includes(i)||e.unshift(i);t=t.parentElement}return Object.freeze(e)}},rme=(t,e)=>t.length===e.length&&t.findIndex((n,i)=>t[i]!==e[i])===-1,iH=15538,sme=class extends wn{constructor(){super(...arguments),this.beanName="eventService",this.globalEventService=new Cw}wireBeans(t){this.globalEventListener=t.globalEventListener,this.globalSyncEventListener=t.globalSyncEventListener}postConstruct(){if(this.globalEventListener){const t=this.gos.useAsyncEvents();this.addGlobalListener(this.globalEventListener,t)}this.globalSyncEventListener&&this.addGlobalListener(this.globalSyncEventListener,!1)}addEventListener(t,e,n){this.globalEventService.addEventListener(t,e,n)}removeEventListener(t,e,n){this.globalEventService.removeEventListener(t,e,n)}addGlobalListener(t,e=!1){this.globalEventService.addGlobalListener(t,e)}removeGlobalListener(t,e=!1){this.globalEventService.removeGlobalListener(t,e)}dispatchLocalEvent(){}dispatchEvent(t){this.globalEventService.dispatchEvent(this.gos.addGridCommonParams(t))}dispatchEventOnce(t){this.globalEventService.dispatchEventOnce(this.gos.addGridCommonParams(t))}},V3=class hu extends wn{constructor(){super(...arguments),this.beanName="focusService"}wireBeans(e){this.eGridDiv=e.eGridDiv,this.columnModel=e.columnModel,this.visibleColsService=e.visibleColsService,this.headerNavigationService=e.headerNavigationService,this.headerPositionUtils=e.headerPositionUtils,this.rowRenderer=e.rowRenderer,this.rowPositionUtils=e.rowPositionUtils,this.cellPositionUtils=e.cellPositionUtils,this.navigationService=e.navigationService,this.ctrlsService=e.ctrlsService,this.filterManager=e.filterManager,this.rangeService=e.rangeService,this.advancedFilterService=e.advancedFilterService}static addKeyboardModeEvents(e){this.instanceCount>0||(e.addEventListener("keydown",hu.toggleKeyboardMode),e.addEventListener("mousedown",hu.toggleKeyboardMode))}static removeKeyboardModeEvents(e){this.instanceCount>0||(e.addEventListener("keydown",hu.toggleKeyboardMode),e.addEventListener("mousedown",hu.toggleKeyboardMode))}static toggleKeyboardMode(e){const n=hu.keyboardModeActive,i=e.type==="keydown";i&&(e.ctrlKey||e.metaKey||e.altKey)||n!==i&&(hu.keyboardModeActive=i)}static unregisterGridCompController(e){hu.removeKeyboardModeEvents(e)}postConstruct(){const e=this.clearFocusedCell.bind(this);this.addManagedEventListeners({columnPivotModeChanged:e,newColumnsLoaded:this.onColumnEverythingChanged.bind(this),columnGroupOpened:e,columnRowGroupChanged:e}),this.registerKeyboardFocusEvents(),this.ctrlsService.whenReady(n=>{this.gridCtrl=n.gridCtrl})}registerKeyboardFocusEvents(){const e=this.gos.getDocument();hu.addKeyboardModeEvents(e),hu.instanceCount++,this.addDestroyFunc(()=>{hu.instanceCount--,hu.unregisterGridCompController(e)})}onColumnEverythingChanged(){if(!this.focusedCellPosition)return;const e=this.focusedCellPosition.column,n=this.columnModel.getCol(e.getId());e!==n&&this.clearFocusedCell()}isKeyboardMode(){return hu.keyboardModeActive}getFocusCellToUseAfterRefresh(){return this.gos.get("suppressFocusAfterRefresh")||!this.focusedCellPosition||this.isDomDataMissingInHierarchy(this.gos.getActiveDomElement(),s_.DOM_DATA_KEY_ROW_CTRL)?null:this.focusedCellPosition}getFocusHeaderToUseAfterRefresh(){return this.gos.get("suppressFocusAfterRefresh")||!this.focusedHeaderPosition||this.isDomDataMissingInHierarchy(this.gos.getActiveDomElement(),FA.DOM_DATA_KEY_HEADER_CTRL)?null:this.focusedHeaderPosition}isDomDataMissingInHierarchy(e,n){let i=e;for(;i;){if(this.gos.getDomData(i,n))return!1;i=i.parentNode}return!0}getFocusedCell(){return this.focusedCellPosition}shouldRestoreFocus(e){return this.isCellRestoreFocused(e)?(setTimeout(()=>{this.restoredFocusedCellPosition=null},0),!0):!1}isCellRestoreFocused(e){return this.restoredFocusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.restoredFocusedCellPosition)}setRestoreFocusedCell(e){this.getFrameworkOverrides().renderingEngine==="react"&&(this.restoredFocusedCellPosition=e)}getFocusEventParams(){const{rowIndex:e,rowPinned:n,column:i}=this.focusedCellPosition,r={rowIndex:e,rowPinned:n,column:i,isFullWidthCell:!1},o=this.rowRenderer.getRowByPosition({rowIndex:e,rowPinned:n});return o&&(r.isFullWidthCell=o.isFullWidth()),r}clearFocusedCell(){if(this.restoredFocusedCellPosition=null,this.focusedCellPosition==null)return;const e={type:"cellFocusCleared",...this.getFocusEventParams()};this.focusedCellPosition=null,this.eventService.dispatchEvent(e)}setFocusedCell(e){const{column:n,rowIndex:i,rowPinned:r,forceBrowserFocus:o=!1,preventScrollOnBrowserFocus:c=!1}=e,s=this.columnModel.getCol(n);if(!s){this.focusedCellPosition=null;return}this.focusedCellPosition=s?{rowIndex:i,rowPinned:n_(r),column:s}:null;const f={type:"cellFocused",...this.getFocusEventParams(),forceBrowserFocus:o,preventScrollOnBrowserFocus:c};this.eventService.dispatchEvent(f)}isCellFocused(e){return this.focusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.focusedCellPosition)}isRowNodeFocused(e){return this.isRowFocused(e.rowIndex,e.rowPinned)}isHeaderWrapperFocused(e){if(this.focusedHeaderPosition==null)return!1;const n=e.getColumnGroupChild(),i=e.getRowIndex(),r=e.getPinned(),{column:o,headerRowIndex:c}=this.focusedHeaderPosition;return n===o&&i===c&&r==o.getPinned()}clearFocusedHeader(){this.focusedHeaderPosition=null}getFocusedHeader(){return this.focusedHeaderPosition}setFocusedHeader(e,n){this.focusedHeaderPosition={headerRowIndex:e,column:n}}focusHeaderPosition(e){var v;if(this.gos.get("suppressHeaderFocus"))return!1;const{direction:n,fromTab:i,allowUserOverride:r,event:o,fromCell:c,rowWithoutSpanValue:s}=e;let{headerPosition:f}=e;if(c&&((v=this.filterManager)!=null&&v.isAdvancedFilterHeaderActive()))return this.focusAdvancedFilter(f);if(r){const w=this.getFocusedHeader(),C=this.headerNavigationService.getHeaderRowCount();if(i){const M=this.gos.getCallback("tabToNextHeader");M&&(f=this.getHeaderPositionFromUserFunc({userFunc:M,direction:n,currentPosition:w,headerPosition:f,headerRowCount:C}))}else{const M=this.gos.getCallback("navigateToNextHeader");if(M&&o){const F={key:o.key,previousHeaderPosition:w,nextHeaderPosition:f,headerRowCount:C,event:o};f=M(F)}}}return f?this.focusProvidedHeaderPosition({headerPosition:f,direction:n,event:o,fromCell:c,rowWithoutSpanValue:s}):!1}focusHeaderPositionFromUserFunc(e){if(this.gos.get("suppressHeaderFocus"))return!1;const{userFunc:n,headerPosition:i,direction:r,event:o}=e,c=this.getFocusedHeader(),s=this.headerNavigationService.getHeaderRowCount(),f=this.getHeaderPositionFromUserFunc({userFunc:n,direction:r,currentPosition:c,headerPosition:i,headerRowCount:s});return!!f&&this.focusProvidedHeaderPosition({headerPosition:f,direction:r,event:o})}getHeaderPositionFromUserFunc(e){const{userFunc:n,direction:i,currentPosition:r,headerPosition:o,headerRowCount:c}=e,f=n({backwards:i==="Before",previousHeaderPosition:r,nextHeaderPosition:o,headerRowCount:c});return f===!0||f===null?(f===null&&Tn("Since v31.3 Returning `null` from tabToNextHeader is deprecated. Return `true` to stay on the current header, or `false` to let the browser handle the tab behaviour."),r):f===!1?null:f}focusProvidedHeaderPosition(e){var C;const{headerPosition:n,direction:i,fromCell:r,rowWithoutSpanValue:o,event:c}=e,{column:s,headerRowIndex:f}=n;if(f===-1)return(C=this.filterManager)!=null&&C.isAdvancedFilterHeaderActive()?this.focusAdvancedFilter(n):this.focusGridView(s);this.headerNavigationService.scrollToColumn(s,i);const w=this.ctrlsService.getHeaderRowContainerCtrl(s.getPinned()).focusHeader(n.headerRowIndex,s,c);return w&&(o!=null||r)&&this.headerNavigationService.setCurrentHeaderRowWithoutSpan(o??-1),w}focusFirstHeader(){let e=this.visibleColsService.getAllCols()[0];if(!e)return!1;e.getParent()&&(e=this.visibleColsService.getColGroupAtLevel(e,0));const n=this.headerPositionUtils.getHeaderIndexToFocus(e,0);return this.focusHeaderPosition({headerPosition:n,rowWithoutSpanValue:0})}focusLastHeader(e){const n=this.headerNavigationService.getHeaderRowCount()-1,i=Yr(this.visibleColsService.getAllCols());return this.focusHeaderPosition({headerPosition:{headerRowIndex:n,column:i},rowWithoutSpanValue:-1,event:e})}focusPreviousFromFirstCell(e){var n;return(n=this.filterManager)!=null&&n.isAdvancedFilterHeaderActive()?this.focusAdvancedFilter(null):this.focusLastHeader(e)}isAnyCellFocused(){return!!this.focusedCellPosition}isRowFocused(e,n){return this.focusedCellPosition==null?!1:this.focusedCellPosition.rowIndex===e&&this.focusedCellPosition.rowPinned===n_(n)}findFocusableElements(e,n,i=!1){const r=aue;let o=d7;n&&(o+=", "+n),i&&(o+=', [tabindex="-1"]');const c=Array.prototype.slice.apply(e.querySelectorAll(r)).filter(v=>Ef(v)),s=Array.prototype.slice.apply(e.querySelectorAll(o));return s.length?((v,w)=>v.filter(C=>w.indexOf(C)===-1))(c,s):c}focusInto(e,n=!1,i=!1){const r=this.findFocusableElements(e,null,i),o=n?Yr(r):r[0];return o?(o.focus({preventScroll:!0}),!0):!1}findFocusableElementBeforeTabGuard(e,n){if(!n)return null;const i=this.findFocusableElements(e),r=i.indexOf(n);if(r===-1)return null;let o=-1;for(let c=r-1;c>=0;c--)if(i[c].classList.contains("ag-tab-guard-top")){o=c;break}return o<=0?null:i[o-1]}findNextFocusableElement(e=this.eGridDiv,n,i){const r=this.findFocusableElements(e,n?':not([tabindex="-1"])':null),o=this.gos.getActiveDomElement();let c;n?c=r.findIndex(f=>f.contains(o)):c=r.indexOf(o);const s=c+(i?-1:1);return s<0||s>=r.length?null:r[s]}isTargetUnderManagedComponent(e,n){if(!n)return!1;const i=e.querySelectorAll(`.${B_.FOCUS_MANAGED_CLASS}`);if(!i.length)return!1;for(let r=0;r<i.length;r++)if(i[r].contains(n))return!0;return!1}findTabbableParent(e,n=5){let i=0;for(;e&&ML(e)===null&&++i<=n;)e=e.parentElement;return ML(e)===null?null:e}focusGridView(e,n){var s;if(this.gos.get("suppressCellFocus"))return n?this.gos.get("suppressHeaderFocus")?this.focusNextGridCoreContainer(!0,!0):this.focusLastHeader():this.focusNextGridCoreContainer(!1);const i=n?this.rowPositionUtils.getLastRow():this.rowPositionUtils.getFirstRow();if(!i)return!1;const{rowIndex:r,rowPinned:o}=i,c=this.getFocusedHeader();return!e&&c&&(e=c.column),r==null||!e?!1:(this.navigationService.ensureCellVisible({rowIndex:r,column:e,rowPinned:o}),this.setFocusedCell({rowIndex:r,column:e,rowPinned:n_(o),forceBrowserFocus:!0}),(s=this.rangeService)==null||s.setRangeToCell({rowIndex:r,rowPinned:o,column:e}),!0)}focusNextGridCoreContainer(e,n=!1){return!n&&this.gridCtrl.focusNextInnerContainer(e)?!0:((n||!e&&!this.gridCtrl.isDetailGrid())&&this.gridCtrl.forceFocusOutOfContainer(e),!1)}focusAdvancedFilter(e){var n;return this.advancedFilterFocusColumn=e==null?void 0:e.column,((n=this.advancedFilterService)==null?void 0:n.getCtrl().focusHeaderComp())??!1}focusNextFromAdvancedFilter(e,n){var r;const i=(n?void 0:this.advancedFilterFocusColumn)??((r=this.visibleColsService.getAllCols())==null?void 0:r[0]);return e?this.focusHeaderPosition({headerPosition:{column:i,headerRowIndex:this.headerNavigationService.getHeaderRowCount()-1}}):this.focusGridView(i)}clearAdvancedFilterColumn(){this.advancedFilterFocusColumn=void 0}addFocusableContainer(e){this.gridCtrl.addFocusableContainer(e)}removeFocusableContainer(e){this.gridCtrl.removeFocusableContainer(e)}focusGridInnerElement(e){return this.gridCtrl.focusInnerElement(e)}};V3.keyboardModeActive=!1;V3.instanceCount=0;var ome=V3,ame=class extends wn{constructor(){super(...arguments),this.beanName="pinnedWidthService"}wireBeans(t){this.visibleColsService=t.visibleColsService}postConstruct(){const t=this.checkContainerWidths.bind(this);this.addManagedEventListeners({displayedColumnsChanged:t,displayedColumnsWidthChanged:t}),this.addManagedPropertyListener("domLayout",t)}checkContainerWidths(){const t=this.gos.isDomLayout("print"),e=t?0:this.visibleColsService.getColsLeftWidth(),n=t?0:this.visibleColsService.getDisplayedColumnsRightWidth();e!=this.leftWidth&&(this.leftWidth=e,this.eventService.dispatchEvent({type:"leftPinnedWidthChanged"})),n!=this.rightWidth&&(this.rightWidth=n,this.eventService.dispatchEvent({type:"rightPinnedWidthChanged"}))}getPinnedRightWidth(){return this.rightWidth}getPinnedLeftWidth(){return this.leftWidth}},lme=class extends wn{constructor(){super(...arguments),this.additionalFocusableContainers=new Set}wireBeans(t){this.beans=t,this.focusService=t.focusService,this.visibleColsService=t.visibleColsService}setComp(t,e,n){this.view=t,this.eGridHostDiv=e,this.eGui=n,this.eGui.setAttribute("grid-id",this.gridId);const{dragAndDropService:i,mouseEventService:r,ctrlsService:o,resizeObserverService:c}=this.beans;i.addDropTarget({getContainer:()=>this.eGui,isInterestedIn:f=>f===1||f===0,getIconName:()=>"notAllowed"}),r.stampTopLevelGridCompWithGridInstance(e),this.createManagedBean(new U3(this.view)),this.addRtlSupport();const s=c.observeResize(this.eGridHostDiv,this.onGridSizeChanged.bind(this));this.addDestroyFunc(()=>s()),o.register("gridCtrl",this)}isDetailGrid(){var e;const t=this.focusService.findTabbableParent(this.getGui());return((e=t==null?void 0:t.getAttribute("row-id"))==null?void 0:e.startsWith("detail"))||!1}getOptionalSelectors(){var e,n,i,r,o;const t=this.beans;return{paginationSelector:(e=t.paginationService)==null?void 0:e.getPaginationSelector(),gridHeaderDropZonesSelector:(n=t.columnDropZonesService)==null?void 0:n.getDropZoneSelector(),sideBarSelector:(i=t.sideBarService)==null?void 0:i.getSideBarSelector(),statusBarSelector:(r=t.statusBarService)==null?void 0:r.getStatusPanelSelector(),watermarkSelector:(o=t.licenseManager)==null?void 0:o.getWatermarkSelector()}}onGridSizeChanged(){const t={type:"gridSizeChanged",clientWidth:this.eGridHostDiv.clientWidth,clientHeight:this.eGridHostDiv.clientHeight};this.eventService.dispatchEvent(t)}addRtlSupport(){const t=this.gos.get("enableRtl")?"ag-rtl":"ag-ltr";this.view.setRtlClass(t)}destroyGridUi(){this.view.destroyGridUi()}getGui(){return this.eGui}setResizeCursor(t){this.view.setCursor(t?"ew-resize":null)}disableUserSelect(t){this.view.setUserSelect(t?"none":null)}focusNextInnerContainer(t){const e=this.getFocusableContainers(),n=this.gos.getActiveDomElement(),i=e.findIndex(o=>o.getGui().contains(n)),r=i+(t?-1:1);if(r<0||r>=e.length)return!1;if(r===0){if(i>0){const o=this.visibleColsService.getAllCols(),c=Yr(o);if(this.focusService.focusGridView(c,!0))return!0}return!1}return this.focusContainer(e[r],t)}focusInnerElement(t){const e=this.getFocusableContainers(),n=this.visibleColsService.getAllCols(),i=this.gos.getCallback("focusGridInnerElement");if(i&&i({fromBottom:!!t}))return!0;if(t){if(e.length>1)return this.focusContainer(Yr(e),!0);const r=Yr(n);if(this.focusService.focusGridView(r,!0))return!0}if(this.gos.get("headerHeight")===0||this.gos.get("suppressHeaderFocus")){if(this.focusService.focusGridView(n[0]))return!0;for(let r=1;r<e.length;r++)if(this.focusService.focusInto(e[r].getGui()))return!0;return!1}return this.focusService.focusFirstHeader()}forceFocusOutOfContainer(t=!1){this.view.forceFocusOutOfContainer(t)}addFocusableContainer(t){this.additionalFocusableContainers.add(t)}removeFocusableContainer(t){this.additionalFocusableContainers.delete(t)}focusContainer(t,e){var i,r;(i=t==null?void 0:t.setAllowFocus)==null||i.call(t,!0);const n=this.focusService.focusInto(t.getGui(),e);return(r=t==null?void 0:t.setAllowFocus)==null||r.call(t,!1),n}getFocusableContainers(){return[...this.view.getFocusableContainers(),...this.additionalFocusableContainers.values()]}destroy(){this.additionalFocusableContainers.clear(),super.destroy()}},cme=class extends wn{constructor(){super(...arguments),this.beanName="alignedGridsService",this.consuming=!1}wireBeans(t){this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.ctrlsService=t.ctrlsService,this.columnApplyStateService=t.columnApplyStateService}getAlignedGridApis(){let t=this.gos.get("alignedGrids")??[];const e=typeof t=="function";typeof t=="function"&&(t=t());const n=()=>`See ${this.getFrameworkOverrides().getDocLink("aligned-grids")}`;return t.map(r=>{var c;if(!r){_s("alignedGrids contains an undefined option."),e||_s(`You may want to configure via a callback to avoid setup race conditions:
                     "alignedGrids: () => [linkedGrid]"`),_s(n());return}if(this.isGridApi(r))return r;const o=r;return"current"in o?(c=o.current)==null?void 0:c.api:(o.api||_s(`alignedGrids - No api found on the linked grid. If you are passing gridOptions to alignedGrids since v31 this is no longer valid. ${n()}`),o.api)}).filter(r=>!!r&&!r.isDestroyed())}isGridApi(t){return!!t&&!!t.dispatchEvent}postConstruct(){const t=this.fireColumnEvent.bind(this);this.addManagedEventListeners({columnMoved:t,columnVisible:t,columnPinned:t,columnGroupOpened:t,columnResized:t,bodyScroll:this.fireScrollEvent.bind(this),alignedGridColumn:({event:e})=>this.onColumnEvent(e),alignedGridScroll:({event:e})=>this.onScrollEvent(e)})}fireEvent(t){this.consuming||this.getAlignedGridApis().forEach(e=>{e.isDestroyed()||e.dispatchEvent(t)})}onEvent(t){this.consuming=!0,t(),this.consuming=!1}fireColumnEvent(t){const e={type:"alignedGridColumn",event:t};this.fireEvent(e)}fireScrollEvent(t){if(t.direction!=="horizontal")return;const e={type:"alignedGridScroll",event:t};this.fireEvent(e)}onScrollEvent(t){this.onEvent(()=>{this.ctrlsService.getGridBodyCtrl().getScrollFeature().setHorizontalScrollPosition(t.left,!0)})}getMasterColumns(t){const e=[];return t.columns?t.columns.forEach(n=>{e.push(n)}):t.column&&e.push(t.column),e}getColumnIds(t){const e=[];return t.columns?t.columns.forEach(n=>{e.push(n.getColId())}):t.column&&e.push(t.column.getColId()),e}onColumnEvent(t){this.onEvent(()=>{switch(t.type){case"columnMoved":case"columnVisible":case"columnPinned":case"columnResized":{const e=t;this.processColumnEvent(e);break}case"columnGroupOpened":{const e=t;this.processGroupOpenedEvent(e);break}case"columnPivotChanged":Tn("pivoting is not supported with aligned grids. You can only use one of these features at a time in a grid.");break}})}processGroupOpenedEvent(t){t.columnGroups.forEach(e=>{let n=null;if(e){const i=e.getGroupId();n=this.columnModel.getProvidedColGroup(i)}e&&!n||this.columnModel.setColumnGroupOpened(n,e.isExpanded(),"alignedGridChanged")})}processColumnEvent(t){var c;const e=t.column;let n=null;if(e&&(n=this.columnModel.getColDefCol(e.getColId())),e&&!n)return;const i=this.getMasterColumns(t);switch(t.type){case"columnMoved":{const f=t.api.getColumnState().map(v=>({colId:v.colId}));this.columnApplyStateService.applyColumnState({state:f,applyOrder:!0},"alignedGridChanged")}break;case"columnVisible":{const f=t.api.getColumnState().map(v=>({colId:v.colId,hide:v.hide}));this.columnApplyStateService.applyColumnState({state:f},"alignedGridChanged")}break;case"columnPinned":{const f=t.api.getColumnState().map(v=>({colId:v.colId,pinned:v.pinned}));this.columnApplyStateService.applyColumnState({state:f},"alignedGridChanged")}break;case"columnResized":{const s=t,f={};i.forEach(v=>{f[v.getId()]={key:v.getColId(),newWidth:v.getActualWidth()}}),(c=s.flexColumns)==null||c.forEach(v=>{f[v.getId()]&&delete f[v.getId()]}),this.columnSizeService.setColumnWidths(Object.values(f),!1,s.finished,"alignedGridChanged");break}}const o=this.ctrlsService.getGridBodyCtrl().isVerticalScrollShowing();this.getAlignedGridApis().forEach(s=>{s.setGridOption("alwaysShowVerticalScroll",o)})}},ume={version:lr,moduleName:"@ag-grid-community/aligned-grid",beans:[cme]};function hme(t,e){const n=t.columnModel.getColDefCol(e);return n?n.getColDef():null}function dme(t){return t.columnModel.getColumnDefs()}function fme(t,e){typeof e=="number"?t.columnSizeService.sizeColumnsToFit(e,"api"):t.ctrlsService.getGridBodyCtrl().sizeColumnsToFit(e)}function pme(t,e,n){t.columnModel.setColumnGroupOpened(e,n,"api")}function mme(t,e,n){return t.visibleColsService.getColumnGroup(e,n)}function gme(t,e){return t.columnModel.getProvidedColGroup(e)}function vme(t,e,n){return t.columnNameService.getDisplayNameForColumn(e,n)||""}function yme(t,e,n){return t.columnNameService.getDisplayNameForColumnGroup(e,n)||""}function _me(t,e){return t.columnModel.getColDefCol(e)}function xme(t){return t.columnModel.getColDefCols()}function wme(t,e){return t.columnApplyStateService.applyColumnState(e,"api")}function Cme(t){return t.columnGetStateService.getColumnState()}function Sme(t){t.columnApplyStateService.resetColumnState("api")}function bme(t){return t.columnGroupStateService.getColumnGroupState()}function Eme(t,e){t.columnGroupStateService.setColumnGroupState(e,"api")}function Mme(t){t.columnGroupStateService.resetColumnGroupState("api")}function Rme(t){return t.visibleColsService.isPinningLeft()||t.visibleColsService.isPinningRight()}function Tme(t){return t.visibleColsService.isPinningLeft()}function Ame(t){return t.visibleColsService.isPinningRight()}function Pme(t,e){return t.visibleColsService.getColAfter(e)}function Ime(t,e){return t.visibleColsService.getColBefore(e)}function Dme(t,e,n){t.columnModel.setColsVisible([e],n,"api")}function Fme(t,e,n){t.columnModel.setColsVisible(e,n,"api")}function Lme(t,e,n){t.columnModel.setColsPinned([e],n,"api")}function Ome(t,e,n){t.columnModel.setColsPinned(e,n,"api")}function kme(t){return t.columnModel.getCols()}function Nme(t){return t.visibleColsService.getLeftCols()}function Bme(t){return t.visibleColsService.getCenterCols()}function zme(t){return t.visibleColsService.getRightCols()}function Ume(t){return t.visibleColsService.getAllCols()}function Vme(t){return t.columnViewportService.getViewportColumns()}function Gme(t,e,n){t.columnMoveService.moveColumns([e],n,"api")}function Hme(t,e,n){t.columnMoveService.moveColumnByIndex(e,n,"api")}function Wme(t,e,n){t.columnMoveService.moveColumns(e,n,"api")}function jme(t,e,n,i=!0,r="api"){t.columnSizeService.setColumnWidths([{key:e,newWidth:n}],!1,i,r)}function $me(t,e,n=!0,i="api"){t.columnSizeService.setColumnWidths(e,!1,n,i)}function qme(t){return t.visibleColsService.getTreeLeft()}function Zme(t){return t.visibleColsService.getTreeCenter()}function Xme(t){return t.visibleColsService.getTreeRight()}function Kme(t){return t.visibleColsService.getAllTrees()}function Yme(t,e,n){return t.columnAutosizeService.autoSizeCols({colKeys:[e],skipHeader:n,source:"api"})}function Jme(t,e,n){t.columnAutosizeService.autoSizeCols({colKeys:e,skipHeader:n,source:"api"})}function Qme(t,e){t.columnAutosizeService.autoSizeAllColumns("api",e)}var rH={january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},sH=["january","february","march","april","may","june","july","august","september","october","november","december"],ege=class extends wn{constructor(){super(...arguments),this.beanName="dataTypeService",this.dataTypeDefinitions={},this.isWaitingForRowData=!1,this.isColumnTypeOverrideInDataTypeDefinitions=!1,this.columnStateUpdatesPendingInference={},this.columnStateUpdateListenerDestroyFuncs=[]}wireBeans(t){this.rowModel=t.rowModel,this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.valueService=t.valueService,this.columnApplyStateService=t.columnApplyStateService}postConstruct(){this.groupHideOpenParents=this.gos.get("groupHideOpenParents"),this.addManagedPropertyListener("groupHideOpenParents",()=>{this.groupHideOpenParents=this.gos.get("groupHideOpenParents")}),this.processDataTypeDefinitions(),this.addManagedPropertyListener("dataTypeDefinitions",t=>{this.processDataTypeDefinitions(),this.columnModel.recreateColumnDefs(fx(t.source))})}processDataTypeDefinitions(){const t=this.getDefaultDataTypes();this.dataTypeDefinitions={},this.formatValueFuncs={};const e=i=>r=>{const{column:o,node:c,value:s}=r;let f=o.getColDef().valueFormatter;return f===i.groupSafeValueFormatter&&(f=i.valueFormatter),this.valueService.formatValue(o,c,s,f)};Object.entries(t).forEach(([i,r])=>{const o={...r,groupSafeValueFormatter:this.createGroupSafeValueFormatter(r)};this.dataTypeDefinitions[i]=o,this.formatValueFuncs[i]=e(o)});const n=this.gos.get("dataTypeDefinitions")??{};this.dataTypeMatchers={},Object.entries(n).forEach(([i,r])=>{const o=this.processDataTypeDefinition(r,n,[i],t);o&&(this.dataTypeDefinitions[i]=o,r.dataTypeMatcher&&(this.dataTypeMatchers[i]=r.dataTypeMatcher),this.formatValueFuncs[i]=e(o))}),this.checkObjectValueHandlers(t),["dateString","text","number","boolean","date"].forEach(i=>{const r=this.dataTypeMatchers[i];r&&delete this.dataTypeMatchers[i],this.dataTypeMatchers[i]=r??t[i].dataTypeMatcher})}mergeDataTypeDefinitions(t,e){const n={...t,...e};return t.columnTypes&&e.columnTypes&&e.appendColumnTypes&&(n.columnTypes=[...aR(t.columnTypes),...aR(e.columnTypes)]),n}processDataTypeDefinition(t,e,n,i){let r;const o=t.extendsDataType;if(t.columnTypes&&(this.isColumnTypeOverrideInDataTypeDefinitions=!0),t.extendsDataType===t.baseDataType){let c=i[o];const s=e[o];if(c&&s&&(c=s),!this.validateDataTypeDefinition(t,c,o))return;r=this.mergeDataTypeDefinitions(c,t)}else{if(n.includes(o)){Tn('Data type definition hierarchies (via the "extendsDataType" property) cannot contain circular references.');return}const c=e[o];if(!this.validateDataTypeDefinition(t,c,o))return;const s=this.processDataTypeDefinition(c,e,[...n,o],i);if(!s)return;r=this.mergeDataTypeDefinitions(s,t)}return{...r,groupSafeValueFormatter:this.createGroupSafeValueFormatter(r)}}validateDataTypeDefinition(t,e,n){return e?e.baseDataType!==t.baseDataType?(Tn('The "baseDataType" property of a data type definition must match that of its parent.'),!1):!0:(Tn(`The data type definition ${n} does not exist.`),!1)}createGroupSafeValueFormatter(t){if(t.valueFormatter)return e=>{var n,i;if((n=e.node)!=null&&n.group){const r=e.column.getAggFunc();if(r){if(r==="first"||r==="last")return t.valueFormatter(e);if(t.baseDataType==="number"&&r!=="count"){if(typeof e.value=="number")return t.valueFormatter(e);if(typeof e.value=="object"){if(!e.value)return;if("toNumber"in e.value)return t.valueFormatter({...e,value:e.value.toNumber()});if("value"in e.value)return t.valueFormatter({...e,value:e.value.value})}}}if(!this.gos.get("suppressGroupMaintainValueType"))return}else if(this.groupHideOpenParents&&e.column.isRowGroupActive()){if(typeof e.value!="string"||(i=t.dataTypeMatcher)!=null&&i.call(t,e.value))return t.valueFormatter(e);if(!this.gos.get("suppressGroupMaintainValueType"))return}return t.valueFormatter(e)}}updateColDefAndGetColumnType(t,e,n){let{cellDataType:i}=e;const{field:r}=e;if(i===void 0&&(i=t.cellDataType),(i==null||i===!0)&&(i=this.canInferCellDataType(t,e)?this.inferCellDataType(r,n):!1),!i){t.cellDataType=!1;return}const o=this.dataTypeDefinitions[i];if(!o){Tn(`Missing data type definition - "${i}"`);return}return t.cellDataType=i,o.groupSafeValueFormatter&&(t.valueFormatter=o.groupSafeValueFormatter),o.valueParser&&(t.valueParser=o.valueParser),o.suppressDefaultProperties||this.setColDefPropertiesForBaseDataType(t,i,o,n),o.columnTypes}addColumnListeners(t){if(!this.isWaitingForRowData)return;const e=this.columnStateUpdatesPendingInference[t.getColId()];if(!e)return;const n=i=>{e.add(i.key)};t.addEventListener("columnStateUpdated",n),this.columnStateUpdateListenerDestroyFuncs.push(()=>t.removeEventListener("columnStateUpdated",n))}canInferCellDataType(t,e){if(this.rowModel.getType()!=="clientSide")return!1;const n={cellRenderer:!0,valueGetter:!0,valueParser:!0,refData:!0};if(this.doColDefPropsPreventInference(e,n))return!1;const i=e.type===null?t.type:e.type;if(i){const r=this.gos.get("columnTypes")??{};if(aR(i).some(c=>{const s=r[c.trim()];return s&&this.doColDefPropsPreventInference(s,n)}))return!1}return!this.doColDefPropsPreventInference(t,n)}doColDefPropsPreventInference(t,e){return[["cellRenderer","agSparklineCellRenderer"],["valueGetter",void 0],["valueParser",void 0],["refData",void 0]].some(([n,i])=>this.doesColDefPropPreventInference(t,e,n,i))}doesColDefPropPreventInference(t,e,n,i){if(!e[n])return!1;const r=t[n];return r===null?(e[n]=!1,!1):i===void 0?!!r:r===i}inferCellDataType(t,e){if(!t)return;let n;const i=this.getInitialData();if(i){const o=t.indexOf(".")>=0&&!this.gos.get("suppressFieldDotNotation");n=w1(i,t,o)}else this.initWaitForRowData(e);if(n==null)return;const[r]=Object.entries(this.dataTypeMatchers).find(([o,c])=>c(n))??["object"];return r}getInitialData(){const t=this.gos.get("rowData");if(t!=null&&t.length)return t[0];if(this.initialData)return this.initialData;{const e=this.rowModel.getRootNode().allLeafChildren;if(e!=null&&e.length)return e[0].data}return null}initWaitForRowData(t){if(this.columnStateUpdatesPendingInference[t]=new Set,this.isWaitingForRowData)return;this.isWaitingForRowData=!0;const e=this.isColumnTypeOverrideInDataTypeDefinitions;e&&this.columnModel.queueResizeOperations();const[n]=this.addManagedEventListeners({rowDataUpdateStarted:i=>{const{firstRowData:r}=i;if(!r)return;n==null||n(),this.isWaitingForRowData=!1,this.processColumnsPendingInference(r,e),this.columnStateUpdatesPendingInference={},e&&this.columnModel.processResizeOperations();const o={type:"dataTypesInferred"};this.eventService.dispatchEvent(o)}})}isPendingInference(){return this.isWaitingForRowData}processColumnsPendingInference(t,e){this.initialData=t;const n=[];this.destroyColumnStateUpdateListeners();const i={},r={};Object.entries(this.columnStateUpdatesPendingInference).forEach(([o,c])=>{const s=this.columnModel.getCol(o);if(!s)return;const f=s.getColDef();if(!this.columnModel.resetColDefIntoCol(s,"cellDataTypeInferred"))return;const v=s.getColDef();if(e&&v.type&&v.type!==f.type){const w=this.getUpdatedColumnState(s,c);w.rowGroup&&w.rowGroupIndex==null&&(i[o]=w),w.pivot&&w.pivotIndex==null&&(r[o]=w),n.push(w)}}),e&&n.push(...this.funcColsService.generateColumnStateForRowGroupAndPivotIndexes(i,r)),n.length&&this.columnApplyStateService.applyColumnState({state:n},"cellDataTypeInferred"),this.initialData=null}getUpdatedColumnState(t,e){const n=this.columnApplyStateService.getColumnStateFromColDef(t);return e.forEach(i=>{delete n[i],i==="rowGroup"?delete n.rowGroupIndex:i==="pivot"&&delete n.pivotIndex}),n}checkObjectValueHandlers(t){const e=this.dataTypeDefinitions.object,n=t.object;this.hasObjectValueParser=e.valueParser!==n.valueParser,this.hasObjectValueFormatter=e.valueFormatter!==n.valueFormatter}getDateStringTypeDefinition(t){return t?this.getDataTypeDefinition(t)??this.dataTypeDefinitions.dateString:this.dataTypeDefinitions.dateString}getDateParserFunction(t){return this.getDateStringTypeDefinition(t).dateParser}getDateFormatterFunction(t){return this.getDateStringTypeDefinition(t).dateFormatter}getDataTypeDefinition(t){const e=t.getColDef();if(e.cellDataType)return this.dataTypeDefinitions[e.cellDataType]}getBaseDataType(t){var e;return(e=this.getDataTypeDefinition(t))==null?void 0:e.baseDataType}checkType(t,e){var i;if(e==null)return!0;const n=(i=this.getDataTypeDefinition(t))==null?void 0:i.dataTypeMatcher;return n?n(e):!0}validateColDef(t){t.cellDataType==="object"&&(t.valueFormatter===this.dataTypeDefinitions.object.groupSafeValueFormatter&&!this.hasObjectValueFormatter&&Tn('Cell data type is "object" but no value formatter has been provided. Please either provide an object data type definition with a value formatter, or set "colDef.valueFormatter"'),t.editable&&t.valueParser===this.dataTypeDefinitions.object.valueParser&&!this.hasObjectValueParser&&Tn('Cell data type is "object" but no value parser has been provided. Please either provide an object data type definition with a value parser, or set "colDef.valueParser"'))}getFormatValue(t){return this.formatValueFuncs[t]}setColDefPropertiesForBaseDataType(t,e,n,i){const r=this.formatValueFuncs[e],o=xl.__isRegistered("@ag-grid-enterprise/set-filter",this.gridId),c=this.localeService.getLocaleTextFunc(),s=f=>{const{filterParams:v}=t;t.filterParams=typeof v=="object"?{...v,...f}:f};switch(n.baseDataType){case"number":{t.cellEditor="agNumberCellEditor",o&&s({comparator:(f,v)=>{const w=f==null?0:parseInt(f),C=v==null?0:parseInt(v);return w===C?0:w>C?1:-1}});break}case"boolean":{t.cellEditor="agCheckboxCellEditor",t.cellRenderer="agCheckboxCellRenderer",t.suppressKeyboardEvent=f=>!!f.colDef.editable&&f.event.key===mn.SPACE,s(o?{valueFormatter:f=>$n(f.value)?c(String(f.value),f.value?"True":"False"):c("blanks","(Blanks)")}:{maxNumConditions:1,debounceMs:0,filterOptions:["empty",{displayKey:"true",displayName:"True",predicate:(f,v)=>v,numberOfInputs:0},{displayKey:"false",displayName:"False",predicate:(f,v)=>v===!1,numberOfInputs:0}]});break}case"date":{t.cellEditor="agDateCellEditor",t.keyCreator=r,o&&s({valueFormatter:f=>{const v=r(f);return $n(v)?v:c("blanks","(Blanks)")},treeList:!0,treeListFormatter:(f,v)=>{if(v===1&&f!=null){const w=sH[Number(f)-1];return c(w,rH[w])}return f??c("blanks","(Blanks)")}});break}case"dateString":{t.cellEditor="agDateStringCellEditor",t.keyCreator=r;const f=n.dateParser;s(o?{valueFormatter:v=>{const w=r(v);return $n(w)?w:c("blanks","(Blanks)")},treeList:!0,treeListPathGetter:v=>{const w=f(v??void 0);return w?[String(w.getFullYear()),String(w.getMonth()+1),String(w.getDate())]:null},treeListFormatter:(v,w)=>{if(w===1&&v!=null){const C=sH[Number(v)-1];return c(C,rH[C])}return v??c("blanks","(Blanks)")}}:{comparator:(v,w)=>{const C=f(w);return w==null||C<v?-1:C>v?1:0}});break}case"object":{t.cellEditorParams={useFormatter:!0},t.comparator=(f,v)=>{const w=this.columnModel.getColDefCol(i),C=w==null?void 0:w.getColDef();if(!w||!C)return 0;const M=f==null?"":r({column:w,node:null,value:f}),F=v==null?"":r({column:w,node:null,value:v});return M===F?0:M>F?1:-1},t.keyCreator=r,o?s({valueFormatter:f=>{const v=r(f);return $n(v)?v:c("blanks","(Blanks)")}}):t.filterValueGetter=f=>r({column:f.column,node:f.node,value:this.valueService.getValue(f.column,f.node)});break}}}getDefaultDataTypes(){const t=n=>!!n.match("^\\d{4}-\\d{2}-\\d{2}$"),e=this.localeService.getLocaleTextFunc();return{number:{baseDataType:"number",valueParser:n=>{var i,r;return((r=(i=n.newValue)==null?void 0:i.trim)==null?void 0:r.call(i))===""?null:Number(n.newValue)},valueFormatter:n=>n.value==null?"":typeof n.value!="number"||isNaN(n.value)?e("invalidNumber","Invalid Number"):String(n.value),dataTypeMatcher:n=>typeof n=="number"},text:{baseDataType:"text",valueParser:n=>n.newValue===""?null:yL(n.newValue),dataTypeMatcher:n=>typeof n=="string"},boolean:{baseDataType:"boolean",valueParser:n=>{var i,r;return n.newValue==null?n.newValue:((r=(i=n.newValue)==null?void 0:i.trim)==null?void 0:r.call(i))===""?null:String(n.newValue).toLowerCase()==="true"},valueFormatter:n=>n.value==null?"":String(n.value),dataTypeMatcher:n=>typeof n=="boolean"},date:{baseDataType:"date",valueParser:n=>Oc(n.newValue==null?null:String(n.newValue)),valueFormatter:n=>n.value==null?"":!(n.value instanceof Date)||isNaN(n.value.getTime())?e("invalidDate","Invalid Date"):eh(n.value,!1)??"",dataTypeMatcher:n=>n instanceof Date},dateString:{baseDataType:"dateString",dateParser:n=>Oc(n)??void 0,dateFormatter:n=>eh(n??null,!1)??void 0,valueParser:n=>t(String(n.newValue))?n.newValue:null,valueFormatter:n=>t(String(n.value))?n.value:"",dataTypeMatcher:n=>typeof n=="string"&&t(n)},object:{baseDataType:"object",valueParser:()=>null,valueFormatter:n=>yL(n.value)??""}}}destroyColumnStateUpdateListeners(){this.columnStateUpdateListenerDestroyFuncs.forEach(t=>t()),this.columnStateUpdateListenerDestroyFuncs=[]}destroy(){this.dataTypeDefinitions={},this.dataTypeMatchers={},this.formatValueFuncs={},this.columnStateUpdatesPendingInference={},this.destroyColumnStateUpdateListeners(),super.destroy()}},tge={version:lr,moduleName:"@ag-grid-community/data-type",beans:[ege]},nge={version:lr,moduleName:"@ag-grid-community/column-api",apiFunctions:{getColumnDef:hme,getColumnDefs:dme,sizeColumnsToFit:fme,setColumnGroupOpened:pme,getColumnGroup:mme,getProvidedColumnGroup:gme,getDisplayNameForColumn:vme,getDisplayNameForColumnGroup:yme,getColumn:_me,getColumns:xme,applyColumnState:wme,getColumnState:Cme,resetColumnState:Sme,getColumnGroupState:bme,setColumnGroupState:Eme,resetColumnGroupState:Mme,isPinning:Rme,isPinningLeft:Tme,isPinningRight:Ame,getDisplayedColAfter:Pme,getDisplayedColBefore:Ime,setColumnVisible:Dme,setColumnsVisible:Fme,setColumnPinned:Lme,setColumnsPinned:Ome,getAllGridColumns:kme,getDisplayedLeftColumns:Nme,getDisplayedCenterColumns:Bme,getDisplayedRightColumns:zme,getAllDisplayedColumns:Ume,getAllDisplayedVirtualColumns:Vme,moveColumn:Gme,moveColumnByIndex:Hme,moveColumns:Wme,setColumnWidth:jme,setColumnWidths:$me,getLeftDisplayedColumnGroups:qme,getCenterDisplayedColumnGroups:Zme,getRightDisplayedColumnGroups:Xme,getAllDisplayedColumnGroups:Kme,autoSizeColumn:Yme,autoSizeColumns:Jme,autoSizeAllColumns:Qme}};function ige(t,e){t.ctrlsService.getGridBodyCtrl().getRowDragFeature().addRowDropZone(e)}function rge(t,e){const n=t.dragAndDropService.findExternalZone(e);n&&t.dragAndDropService.removeDropTarget(n)}function sge(t,e){return t.ctrlsService.getGridBodyCtrl().getRowDragFeature().getRowDropZone(e)}var oge={version:lr,moduleName:"@ag-grid-community/drag-api",apiFunctions:{addRowDropZone:ige,removeRowDropZone:rge,getRowDropZoneParams:sge}};function age(t){return t.pinnedRowModel.getPinnedTopRowCount()}function lge(t){return t.pinnedRowModel.getPinnedBottomRowCount()}function cge(t,e){return t.pinnedRowModel.getPinnedTopRow(e)}function uge(t,e){return t.pinnedRowModel.getPinnedBottomRow(e)}var hge={version:lr,moduleName:"@ag-grid-community/pinned-row-api",apiFunctions:{getPinnedTopRowCount:age,getPinnedBottomRowCount:lge,getPinnedTopRow:cge,getPinnedBottomRow:uge}};function dge(t){t.overlayService.showLoadingOverlay()}function fge(t){t.overlayService.showNoRowsOverlay()}function pge(t){t.overlayService.hideOverlay()}var mge={version:lr,moduleName:"@ag-grid-community/overlay-api",apiFunctions:{showLoadingOverlay:dge,showNoRowsOverlay:fge,hideOverlay:pge}};function gge(t,e,n){if(!e)return;const i=t.ctrlsService.getGridBodyCtrl().getGui(),r=`aria-${e}`;n===null?i.removeAttribute(r):i.setAttribute(r,n)}function vge(t,e={}){t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.refreshCells(e))}function yge(t,e={}){const n=i=>Tn(`Since v31.1 api.flashCells parameter '${i}Delay' is deprecated. Please use '${i}Duration' instead.`);$n(e.fadeDelay)&&n("fade"),$n(e.flashDelay)&&n("flash"),t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.flashCells(e))}function _ge(t){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getHeaderRowContainerCtrls().forEach(e=>e.refresh()))}function xge(t){return t.animationFrameService.isQueueEmpty()}function wge(t){t.animationFrameService.flushAllFrames()}function Cge(t){return{rowHeight:t.gos.getRowHeightAsNumber(),headerHeight:t.columnModel.getHeaderHeight()}}function Sge(t,e={}){return t.rowRenderer.getCellRendererInstances(e).map(S1)}var bge={version:lr,moduleName:"@ag-grid-community/render-api",apiFunctions:{setGridAriaProperty:gge,refreshCells:vge,flashCells:yge,refreshHeader:_ge,isAnimationFrameQueueEmpty:xge,flushAllAnimationFrames:wge,getSizesForCurrentTheme:Cge,getCellRendererInstances:Sge}};function Ege(t){t.valueCache.expire()}function Mge(t,e,n){return vq(t,{colKey:e,rowNode:n})}function vq(t,e){const{colKey:n,rowNode:i,useFormatter:r}=e,o=t.columnModel.getColDefCol(n)??t.columnModel.getCol(n);if(Hr(o))return null;const c=t.valueService.getValue(o,i);return r?t.valueService.formatValue(o,i,c)??wf(c,!0):c}function Rge(t){return t.context.getGridId()}function Tge(t){t.gridDestroyService.destroy()}function Age(t){return t.gridDestroyService.isDestroyCalled()}function Pge(t,e){return t.gos.get(e)}function Ige(t,e,n){yq(t,{[e]:n})}function yq(t,e){t.gos.updateGridOptions({options:e})}function Dge(t,e,n){t.apiEventService.addEventListener(e,n)}function Fge(t,e,n){t.apiEventService.removeEventListener(e,n)}function Lge(t,e){t.apiEventService.addGlobalListener(e)}function Oge(t,e){t.apiEventService.removeGlobalListener(e)}function kge(t){return t.focusService.getFocusedCell()}function Nge(t){return t.focusService.clearFocusedCell()}function Bge(t,e,n,i){t.focusService.setFocusedCell({rowIndex:e,column:n,rowPinned:i,forceBrowserFocus:!0})}function zge(t,e){return t.navigationService.tabToNextCell(!1,e)}function Uge(t,e){return t.navigationService.tabToNextCell(!0,e)}function Vge(t,e,n=!1){const i=t.headerNavigationService.getHeaderPositionForColumn(e,n);i&&t.focusService.focusHeaderPosition({headerPosition:i})}function Gge(t,e,n){const i=t.columnModel.getCol(e);t.menuService.showColumnMenu({column:i,buttonElement:n,positionBy:"button"})}function Hge(t,e,n){let i=t.columnModel.getCol(e);if(i||(i=t.columnModel.getColDefCol(e)),!i){_s(`column '${e}' not found`);return}t.menuService.showColumnMenu({column:i,mouseEvent:n,positionBy:"mouse"})}function Wge(t,e){const n=t.columnModel.getCol(e);if(!n){_s(`column '${e}' not found`);return}t.menuService.showColumnMenu({column:n,positionBy:"auto"})}function jge(t){t.menuService.hidePopupMenu()}function $ge(t,e={}){const n=e?e.rowNodes:void 0;t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.redrawRows(n))}function qge(t,e,n,i,r){t.expansionService.setRowNodeExpanded(e,n,i,r)}function Zge(t,e){return t.rowModel.getRowNode(e)}function Xge(t,e,n,i){t.rowRenderer.addRenderedRowListener(e,n,i)}function Kge(t){return t.rowRenderer.getRenderedNodes()}function Yge(t,e,n){t.rowModel.forEachNode(e,n)}function Jge(t){return _q(t)}function _q(t){return t.rowRenderer.getFirstVirtualRenderedRow()}function Qge(t){return xq(t)}function xq(t){return t.rowRenderer.getLastVirtualRenderedRow()}function eve(t,e){return t.rowModel.getRow(e)}function tve(t){return t.rowModel.getRowCount()}function nve(t){return t.rowModel}function ive(t,e){if(!e.nodes.every(s=>s.rowPinned?(Tn("cannot select pinned rows"),!1):s.id===void 0?(Tn("cannot select node until id for node is known"),!1):!0))return;const{nodes:i,source:r,newValue:o}=e,c=i;t.selectionService.setNodesSelected({nodes:c,source:r??"api",newValue:o})}function rve(t,e="apiSelectAll"){t.selectionService.selectAllRowNodes({source:e})}function sve(t,e="apiSelectAll"){t.selectionService.deselectAllRowNodes({source:e})}function ove(t,e="apiSelectAllFiltered"){t.selectionService.selectAllRowNodes({source:e,justFiltered:!0})}function ave(t,e="apiSelectAllFiltered"){t.selectionService.deselectAllRowNodes({source:e,justFiltered:!0})}function lve(t,e="apiSelectAllCurrentPage"){t.selectionService.selectAllRowNodes({source:e,justCurrentPage:!0})}function cve(t,e="apiSelectAllCurrentPage"){t.selectionService.deselectAllRowNodes({source:e,justCurrentPage:!0})}function uve(t){return t.selectionService.getSelectedNodes()}function hve(t){return t.selectionService.getSelectedRows()}function dve(t){t.sortController.onSortChanged("api")}var fve={version:lr,moduleName:"@ag-grid-community/core-api",apiFunctions:{getGridId:Rge,destroy:Tge,isDestroyed:Age,getGridOption:Pge,setGridOption:Ige,updateGridOptions:yq}},pve={version:lr,moduleName:"@ag-grid-community/row-selection-api",apiFunctions:{setNodesSelected:ive,selectAll:rve,deselectAll:sve,selectAllFiltered:ove,deselectAllFiltered:ave,selectAllOnCurrentPage:lve,deselectAllOnCurrentPage:cve,getSelectedNodes:uve,getSelectedRows:hve}},mve={version:lr,moduleName:"@ag-grid-community/row-api",apiFunctions:{redrawRows:$ge,setRowNodeExpanded:qge,getRowNode:Zge,addRenderedRowListener:Xge,getRenderedNodes:Kge,forEachNode:Yge,getFirstDisplayedRow:Jge,getFirstDisplayedRowIndex:_q,getLastDisplayedRow:Qge,getLastDisplayedRowIndex:xq,getDisplayedRowAtIndex:eve,getDisplayedRowCount:tve,getModel:nve}},gve={version:lr,moduleName:"@ag-grid-community/scroll-api",apiFunctions:{getVerticalPixelRange:epe,getHorizontalPixelRange:tpe,ensureColumnVisible:dq,ensureIndexVisible:fq,ensureNodeVisible:npe}},vve={version:lr,moduleName:"@ag-grid-community/keyboard-navigation-api",apiFunctions:{getFocusedCell:kge,clearFocusedCell:Nge,setFocusedCell:Bge,setFocusedHeader:Vge,tabToNextCell:zge,tabToPreviousCell:Uge}},yve={version:lr,moduleName:"@ag-grid-community/event-api",apiFunctions:{addEventListener:Dge,addGlobalListener:Lge,removeEventListener:Fge,removeGlobalListener:Oge}},_ve={version:lr,moduleName:"@ag-grid-community/cell-api",apiFunctions:{expireValueCache:Ege,getValue:Mge,getCellValue:vq}},xve={version:lr,moduleName:"@ag-grid-community/menu-api",apiFunctions:{showColumnMenuAfterButtonClick:Gge,showColumnMenuAfterMouseClick:Hge,showColumnMenu:Wge,hidePopupMenu:jge}},wve={version:lr,moduleName:"@ag-grid-community/sort-api",apiFunctions:{onSortChanged:dve}},Cve={version:lr,moduleName:"@ag-grid-community/api",dependantModules:[fve,hge,pve,nge,mve,oge,gve,mge,vve,yve,bge,_ve,xve,wve]};function Sve(t){var e;return((e=t.stateService)==null?void 0:e.getState())??{}}var bve=class extends wn{constructor(){super(...arguments),this.beanName="stateService",this.suppressEvents=!0,this.queuedUpdateSources=new Set,this.dispatchStateUpdateEventDebounced=Kl(()=>this.dispatchQueuedStateUpdateEvents(),0),this.onRowGroupOpenedDebounced=Kl(()=>this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState()),0),this.onRowSelectedDebounced=Kl(()=>{this.staleStateKeys.delete("rowSelection"),this.updateCachedState("rowSelection",this.getRowSelectionState())},0),this.staleStateKeys=new Set}wireBeans(t){this.filterManager=t.filterManager,this.ctrlsService=t.ctrlsService,this.pivotResultColsService=t.pivotResultColsService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnGroupStateService=t.columnGroupStateService,this.columnGetStateService=t.columnGetStateService,this.paginationService=t.paginationService,this.rowModel=t.rowModel,this.selectionService=t.selectionService,this.expansionService=t.expansionService,this.columnAnimationService=t.columnAnimationService,this.columnApplyStateService=t.columnApplyStateService,this.sideBarService=t.sideBarService,this.rangeService=t.rangeService}postConstruct(){this.isClientSideRowModel=this.rowModel.getType()==="clientSide",this.cachedState=this.gos.get("initialState")??{},this.ctrlsService.whenReady(()=>this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnGridReady()));const[t,e,n]=this.addManagedEventListeners({newColumnsLoaded:({source:i})=>{i==="gridInitializing"&&(t(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnColumnsInitialised()))},rowCountReady:()=>{e==null||e(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnRowCountReady())},firstDataRendered:()=>{n==null||n(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnFirstDataRendered())}})}getState(){return this.staleStateKeys.size&&this.refreshStaleState(),this.cachedState}setupStateOnGridReady(){this.updateCachedState("sideBar",this.getSideBarState());const t=()=>this.updateCachedState("sideBar",this.getSideBarState());this.addManagedEventListeners({toolPanelVisibleChanged:t,sideBarUpdated:t})}setupStateOnColumnsInitialised(){const t=this.gos.get("initialState")??{};this.setColumnState(t),this.setColumnGroupState(t),this.updateColumnState(["aggregation","columnOrder","columnPinning","columnSizing","columnVisibility","pivot","pivot","rowGroup","sort"]),this.updateCachedState("columnGroup",this.getColumnGroupState()),this.addManagedEventListeners({columnValueChanged:()=>this.updateColumnState(["aggregation"]),columnMoved:()=>this.updateColumnState(["columnOrder"]),columnPinned:()=>this.updateColumnState(["columnPinning"]),columnResized:()=>this.updateColumnState(["columnSizing"]),columnVisible:()=>this.updateColumnState(["columnVisibility"]),columnPivotChanged:()=>this.updateColumnState(["pivot"]),columnPivotModeChanged:()=>this.updateColumnState(["pivot"]),columnRowGroupChanged:()=>this.updateColumnState(["rowGroup"]),sortChanged:()=>this.updateColumnState(["sort"]),newColumnsLoaded:()=>this.updateColumnState(["aggregation","columnOrder","columnPinning","columnSizing","columnVisibility","pivot","rowGroup","sort"]),columnGroupOpened:()=>this.updateCachedState("columnGroup",this.getColumnGroupState())})}setupStateOnRowCountReady(){const{filter:t,rowGroupExpansion:e,rowSelection:n,pagination:i}=this.gos.get("initialState")??{},r=this.gos.get("advancedFilterModel");(t||r)&&this.setFilterState(t,r),e&&this.setRowGroupExpansionState(e),n&&this.setRowSelectionState(n),i&&this.setPaginationState(i),this.updateCachedState("filter",this.getFilterState()),this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState()),this.updateCachedState("rowSelection",this.getRowSelectionState()),this.updateCachedState("pagination",this.getPaginationState()),this.addManagedEventListeners({filterChanged:()=>this.updateCachedState("filter",this.getFilterState()),rowGroupOpened:()=>this.onRowGroupOpenedDebounced(),expandOrCollapseAll:()=>this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState()),selectionChanged:()=>{this.staleStateKeys.add("rowSelection"),this.onRowSelectedDebounced()},paginationChanged:o=>{(o.newPage||o.newPageSize)&&this.updateCachedState("pagination",this.getPaginationState())}})}setupStateOnFirstDataRendered(){const{scroll:t,rangeSelection:e,focusedCell:n,columnOrder:i}=this.gos.get("initialState")??{};n&&this.setFocusedCellState(n),e&&this.setRangeSelectionState(e),t&&this.setScrollState(t),this.setColumnPivotState(!!(i!=null&&i.orderedColIds)),this.updateCachedState("sideBar",this.getSideBarState()),this.updateCachedState("focusedCell",this.getFocusedCellState()),this.updateCachedState("rangeSelection",this.getRangeSelectionState()),this.updateCachedState("scroll",this.getScrollState()),this.addManagedEventListeners({cellFocused:()=>this.updateCachedState("focusedCell",this.getFocusedCellState()),rangeSelectionChanged:r=>{r.finished&&this.updateCachedState("rangeSelection",this.getRangeSelectionState())},bodyScrollEnd:()=>this.updateCachedState("scroll",this.getScrollState())})}getColumnState(){const t=this.columnModel.isPivotMode(),e=[],n=[],i=[],r=[],o=[],c=[],s=[],f=[],v=[],w=this.columnGetStateService.getColumnState();for(let C=0;C<w.length;C++){const{colId:M,sort:F,sortIndex:N,rowGroup:z,rowGroupIndex:L,aggFunc:P,pivot:H,pivotIndex:j,pinned:q,hide:le,width:ce,flex:ae}=w[C];v.push(M),F&&(e[N??0]={colId:M,sort:F}),z&&(n[L??0]=M),typeof P=="string"&&i.push({colId:M,aggFunc:P}),H&&(r[j??0]=M),q&&(q==="right"?c:o).push(M),le&&s.push(M),(ae||ce)&&f.push({colId:M,flex:ae??void 0,width:ce})}return{sort:e.length?{sortModel:e}:void 0,rowGroup:n.length?{groupColIds:n}:void 0,aggregation:i.length?{aggregationModel:i}:void 0,pivot:r.length||t?{pivotMode:t,pivotColIds:r}:void 0,columnPinning:o.length||c.length?{leftColIds:o,rightColIds:c}:void 0,columnVisibility:s.length?{hiddenColIds:s}:void 0,columnSizing:f.length?{columnSizingModel:f}:void 0,columnOrder:v.length?{orderedColIds:v}:void 0}}setColumnState(t){const{sort:e,rowGroup:n,aggregation:i,pivot:r,columnPinning:o,columnVisibility:c,columnSizing:s,columnOrder:f}=t,v={},w=N=>{let z=v[N];return z||(z={colId:N},v[N]=z,z)};e&&e.sortModel.forEach(({colId:N,sort:z},L)=>{const P=w(N);P.sort=z,P.sortIndex=L}),n&&n.groupColIds.forEach((N,z)=>{const L=w(N);L.rowGroup=!0,L.rowGroupIndex=z}),i&&i.aggregationModel.forEach(({colId:N,aggFunc:z})=>{w(N).aggFunc=z}),r&&(r.pivotColIds.forEach((N,z)=>{const L=w(N);L.pivot=!0,L.pivotIndex=z}),this.gos.updateGridOptions({options:{pivotMode:r.pivotMode},source:"gridInitializing"})),o&&(o.leftColIds.forEach(N=>{w(N).pinned="left"}),o.rightColIds.forEach(N=>{w(N).pinned="right"})),c&&c.hiddenColIds.forEach(N=>{w(N).hide=!0}),s&&s.columnSizingModel.forEach(({colId:N,flex:z,width:L})=>{const P=w(N);P.flex=z??null,P.width=L});const C=f==null?void 0:f.orderedColIds,M=!!(C!=null&&C.length),F=M?C.map(N=>w(N)):Object.values(v);if(F.length){this.columnStates=F;const N={sort:null,sortIndex:null,rowGroup:null,rowGroupIndex:null,aggFunc:null,pivot:null,pivotIndex:null,pinned:null,hide:null,flex:null};this.columnApplyStateService.applyColumnState({state:F,applyOrder:M,defaultState:N},"gridInitializing")}}setColumnPivotState(t){const e=this.columnStates;this.columnStates=void 0;const n=this.columnGroupStates;if(this.columnGroupStates=void 0,!!this.pivotResultColsService.isPivotResultColsPresent()){if(e){const i=[];for(const r of e)this.pivotResultColsService.getPivotResultCol(r.colId)&&i.push(r);this.columnApplyStateService.applyColumnState({state:i,applyOrder:t},"gridInitializing")}n&&this.columnGroupStateService.setColumnGroupState(n,"gridInitializing")}}getColumnGroupState(){const t=this.columnGroupStateService.getColumnGroupState(),e=[];return t.forEach(({groupId:n,open:i})=>{i&&e.push(n)}),e.length?{openColumnGroupIds:e}:void 0}setColumnGroupState(t){var r;if(!Object.prototype.hasOwnProperty.call(t,"columnGroup"))return;const e=new Set((r=t.columnGroup)==null?void 0:r.openColumnGroupIds),i=this.columnGroupStateService.getColumnGroupState().map(({groupId:o})=>{const c=e.has(o);return c&&e.delete(o),{groupId:o,open:c}});e.forEach(o=>{i.push({groupId:o,open:!0})}),i.length&&(this.columnGroupStates=i),this.columnGroupStateService.setColumnGroupState(i,"gridInitializing")}getFilterState(){var n,i;let t=(n=this.filterManager)==null?void 0:n.getFilterModel();t&&Object.keys(t).length===0&&(t=void 0);const e=((i=this.filterManager)==null?void 0:i.getAdvancedFilterModel())??void 0;return t||e?{filterModel:t,advancedFilterModel:e}:void 0}setFilterState(t,e){var r,o;const{filterModel:n,advancedFilterModel:i}=t??{advancedFilterModel:e};n&&((r=this.filterManager)==null||r.setFilterModel(n,"columnFilter")),i&&((o=this.filterManager)==null||o.setAdvancedFilterModel(i))}getRangeSelectionState(){var e;const t=(e=this.rangeService)==null?void 0:e.getCellRanges().map(n=>{const{id:i,type:r,startRow:o,endRow:c,columns:s,startColumn:f}=n;return{id:i,type:r,startRow:o,endRow:c,colIds:s.map(v=>v.getColId()),startColId:f.getColId()}});return t!=null&&t.length?{cellRanges:t}:void 0}setRangeSelectionState(t){if(!this.gos.get("enableRangeSelection")||!this.rangeService)return;const e=[];t.cellRanges.forEach(n=>{const i=[];if(n.colIds.forEach(o=>{const c=this.columnModel.getCol(o);c&&i.push(c)}),!i.length)return;let r=this.columnModel.getCol(n.startColId);if(!r){const o=this.visibleColsService.getAllCols(),c=new Set(i);r=o.find(s=>c.has(s))}e.push({...n,columns:i,startColumn:r})}),this.rangeService.setCellRanges(e)}getScrollState(){var i;if(!this.isClientSideRowModel)return;const t=(i=this.ctrlsService.getGridBodyCtrl())==null?void 0:i.getScrollFeature(),{left:e}=(t==null?void 0:t.getHScrollPosition())??{left:0},{top:n}=(t==null?void 0:t.getVScrollPosition())??{top:0};return n||e?{top:n,left:e}:void 0}setScrollState(t){var i;if(!this.isClientSideRowModel)return;const{top:e,left:n}=t;(i=this.ctrlsService.getGridBodyCtrl())==null||i.getScrollFeature().setScrollPosition(e,n)}getSideBarState(){var t,e;return(e=(t=this.sideBarService)==null?void 0:t.getSideBarComp())==null?void 0:e.getState()}getFocusedCellState(){if(!this.isClientSideRowModel)return;const t=this.focusService.getFocusedCell();if(t){const{column:e,rowIndex:n,rowPinned:i}=t;return{colId:e.getColId(),rowIndex:n,rowPinned:i}}}setFocusedCellState(t){if(!this.isClientSideRowModel)return;const{colId:e,rowIndex:n,rowPinned:i}=t;this.focusService.setFocusedCell({column:this.columnModel.getCol(e),rowIndex:n,rowPinned:i,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}getPaginationState(){if(!this.paginationService)return;const t=this.paginationService.getCurrentPage(),e=this.gos.get("paginationAutoPageSize")?void 0:this.paginationService.getPageSize();if(!(!t&&!e))return{page:t,pageSize:e}}setPaginationState(t){this.paginationService&&(t.pageSize&&!this.gos.get("paginationAutoPageSize")&&this.paginationService.setPageSize(t.pageSize,"initialState"),typeof t.page=="number"&&this.paginationService.setPage(t.page))}getRowSelectionState(){var n;const t=this.selectionService.getSelectionState();return!t||!Array.isArray(t)&&(t.selectAll===!1||t.selectAllChildren===!1)&&!((n=t==null?void 0:t.toggledNodes)!=null&&n.length)?void 0:t}setRowSelectionState(t){this.selectionService.setSelectionState(t,"gridInitializing")}getRowGroupExpansionState(){const t=this.expansionService.getExpandedRows();return t.length?{expandedRowGroupIds:t}:void 0}setRowGroupExpansionState(t){this.expansionService.expandRows(t.expandedRowGroupIds)}updateColumnState(t){const e=this.getColumnState();let n=!1;Object.entries(e).forEach(([i,r])=>{eT(r,this.cachedState[i])||(n=!0)}),this.cachedState={...this.cachedState,...e},n&&this.dispatchStateUpdateEvent(t)}updateCachedState(t,e){const n=this.cachedState[t];this.setCachedStateValue(t,e),eT(e,n)||this.dispatchStateUpdateEvent([t])}setCachedStateValue(t,e){this.cachedState={...this.cachedState,[t]:e}}refreshStaleState(){this.staleStateKeys.forEach(t=>{switch(t){case"rowSelection":this.setCachedStateValue(t,this.getRowSelectionState());break}}),this.staleStateKeys.clear()}dispatchStateUpdateEvent(t){this.suppressEvents||(t.forEach(e=>this.queuedUpdateSources.add(e)),this.dispatchStateUpdateEventDebounced())}dispatchQueuedStateUpdateEvents(){const t=Array.from(this.queuedUpdateSources);this.queuedUpdateSources.clear();const e={type:"stateUpdated",sources:t,state:this.cachedState};this.eventService.dispatchEvent(e)}suppressEventsAndDispatchInitEvent(t){this.suppressEvents=!0,this.columnAnimationService.setSuppressAnimation(!0),t(),setTimeout(()=>{this.suppressEvents=!1,this.queuedUpdateSources.clear(),this.isAlive()&&(this.columnAnimationService.setSuppressAnimation(!1),this.dispatchStateUpdateEvent(["gridInitializing"]))})}},wq={version:lr,moduleName:"@ag-grid-community/state-core",beans:[bve]},Eve={version:lr,moduleName:"@ag-grid-community/state-api",apiFunctions:{getState:Sve},dependantModules:[wq]},Mve={version:lr,moduleName:"@ag-grid-community/state",dependantModules:[wq,Eve]};function Rve(t){return t.rowModel.isLastRowIndexKnown()}function Tve(t){var e;return((e=t.paginationService)==null?void 0:e.getPageSize())??100}function Ave(t){var e;return((e=t.paginationService)==null?void 0:e.getCurrentPage())??0}function Pve(t){var e;return((e=t.paginationService)==null?void 0:e.getTotalPages())??1}function Ive(t){return t.paginationService?t.paginationService.getMasterRowCount():t.rowModel.getRowCount()}function Dve(t){var e;(e=t.paginationService)==null||e.goToNextPage()}function Fve(t){var e;(e=t.paginationService)==null||e.goToPreviousPage()}function Lve(t){var e;(e=t.paginationService)==null||e.goToFirstPage()}function Ove(t){var e;(e=t.paginationService)==null||e.goToLastPage()}function kve(t,e){var n;(n=t.paginationService)==null||n.goToPage(e)}var Nve=class extends wn{constructor(){super(...arguments),this.beanName="paginationAutoPageSizeService"}wireBeans(t){this.ctrlsService=t.ctrlsService,this.paginationService=t.paginationService}postConstruct(){this.ctrlsService.whenReady(t=>{this.centerRowsCtrl=t.center;const e=this.checkPageSize.bind(this);this.addManagedEventListeners({bodyHeightChanged:e,scrollVisibilityChanged:e}),this.addManagedPropertyListener("paginationAutoPageSize",this.onPaginationAutoSizeChanged.bind(this)),this.checkPageSize()})}notActive(){return!this.gos.get("paginationAutoPageSize")||this.centerRowsCtrl==null}onPaginationAutoSizeChanged(){this.notActive()?this.paginationService.unsetAutoCalculatedPageSize():this.checkPageSize()}checkPageSize(){if(this.notActive())return;const t=this.centerRowsCtrl.getViewportSizeFeature().getBodyHeight();if(t>0){const e=()=>{const n=Math.max(this.gos.getRowHeightAsNumber(),1),i=Math.floor(t/n);this.paginationService.setPageSize(i,"autoCalculated")};this.isBodyRendered?Kl(()=>e(),50)():(e(),this.isBodyRendered=!0)}else this.isBodyRendered=!1}};function Bve(t,e,n){t.addManagedElementListeners(e,{keydown:i=>{if(!i.defaultPrevented&&i.key===mn.TAB){const r=i.shiftKey;n.findNextFocusableElement(e,!1,r)||n.focusNextGridCoreContainer(r)&&i.preventDefault()}}})}var zve=class extends Js{constructor(){super('<span class="ag-paging-page-size"></span>'),this.hasEmptyOption=!1,this.handlePageSizeItemSelected=()=>{if(!this.selectPageSizeComp)return;const t=this.selectPageSizeComp.getValue();if(!t)return;const e=Number(t);isNaN(e)||e<1||e===this.paginationService.getPageSize()||(this.paginationService.setPageSize(e,"pageSizeSelector"),this.hasEmptyOption&&this.toggleSelectDisplay(!0),this.selectPageSizeComp.getFocusableElement().focus())}}wireBeans(t){this.paginationService=t.paginationService}postConstruct(){this.addManagedPropertyListener("paginationPageSizeSelector",()=>{this.onPageSizeSelectorValuesChange()}),this.addManagedEventListeners({paginationChanged:t=>this.handlePaginationChanged(t)})}handlePaginationChanged(t){if(!this.selectPageSizeComp||!(t!=null&&t.newPageSize))return;const e=this.paginationService.getPageSize();this.getPageSizeSelectorValues().includes(e)?this.selectPageSizeComp.setValue(e.toString()):this.hasEmptyOption?this.selectPageSizeComp.setValue(""):this.toggleSelectDisplay(!0)}toggleSelectDisplay(t){this.selectPageSizeComp&&this.reset(),t&&(this.reloadPageSizesSelector(),this.selectPageSizeComp&&this.appendChild(this.selectPageSizeComp))}reset(){Cu(this.getGui()),this.selectPageSizeComp&&(this.selectPageSizeComp=this.destroyBean(this.selectPageSizeComp))}onPageSizeSelectorValuesChange(){this.selectPageSizeComp&&this.shouldShowPageSizeSelector()&&this.reloadPageSizesSelector()}shouldShowPageSizeSelector(){return this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel")&&!this.gos.get("paginationAutoPageSize")&&this.gos.get("paginationPageSizeSelector")!==!1}reloadPageSizesSelector(){const t=this.getPageSizeSelectorValues(),e=this.paginationService.getPageSize(),n=!e||!t.includes(e);n&&(t.unshift(""),Tn(`The paginationPageSize grid option is set to a value that is not in the list of page size options.
                Please make sure that the paginationPageSize grid option is set to one of the values in the 
                paginationPageSizeSelector array, or set the paginationPageSizeSelector to false to hide the page size selector.`)),this.selectPageSizeComp&&(this.selectPageSizeComp=this.destroyBean(this.selectPageSizeComp));const i=this.localeService.getLocaleTextFunc(),r=i("pageSizeSelectorLabel","Page Size:"),o=t.map(s=>({value:String(s),text:String(s)})),c=i("ariaPageSizeSelectorLabel","Page Size");this.selectPageSizeComp=this.createManagedBean(new P3).addOptions(o).setValue(String(n?"":e)).setAriaLabel(c).setLabel(r).onValueChange(()=>this.handlePageSizeItemSelected()),this.hasEmptyOption=n}getPageSizeSelectorValues(){const t=[20,50,100],e=this.gos.get("paginationPageSizeSelector");return!Array.isArray(e)||!this.validateValues(e)?t:[...e].sort((n,i)=>n-i)}validateValues(t){if(!t.length)return Tn(`The paginationPageSizeSelector grid option is an empty array. This is most likely a mistake.
                If you want to hide the page size selector, please set the paginationPageSizeSelector to false.`),!1;for(let e=0;e<t.length;e++){const n=t[e],i=typeof n=="number",r=n>0;if(!i)return Tn(`The paginationPageSizeSelector grid option contains a non-numeric value.
                    Please make sure that all values in the paginationPageSizeSelector array are numbers.`),!1;if(!r)return Tn(`The paginationPageSizeSelector grid option contains a negative number or zero.
                    Please make sure that all values in the paginationPageSizeSelector array are positive.`),!1}return!0}destroy(){this.toggleSelectDisplay(!1),super.destroy()}},Uve={selector:"AG-PAGE-SIZE-SELECTOR",component:zve},Vve=class extends Dpe{constructor(){super(),this.btFirst=qi,this.btPrevious=qi,this.btNext=qi,this.btLast=qi,this.lbRecordCount=qi,this.lbFirstRowOnPage=qi,this.lbLastRowOnPage=qi,this.lbCurrent=qi,this.lbTotal=qi,this.pageSizeComp=qi,this.previousAndFirstButtonsDisabled=!1,this.nextButtonDisabled=!1,this.lastButtonDisabled=!1,this.areListenersSetup=!1,this.allowFocusInnerElement=!1}wireBeans(t){this.rowNodeBlockLoader=t.rowNodeBlockLoader,this.rowModel=t.rowModel,this.paginationService=t.paginationService,this.focusService=t.focusService}postConstruct(){const t=this.gos.get("enableRtl");this.setTemplate(this.getTemplate(),[Uve]);const{btFirst:e,btPrevious:n,btNext:i,btLast:r}=this;this.activateTabIndex([e,n,i,r]),e.insertAdjacentElement("afterbegin",gu(t?"last":"first",this.gos)),n.insertAdjacentElement("afterbegin",gu(t?"next":"previous",this.gos)),i.insertAdjacentElement("afterbegin",gu(t?"previous":"next",this.gos)),r.insertAdjacentElement("afterbegin",gu(t?"first":"last",this.gos)),this.addManagedPropertyListener("pagination",this.onPaginationChanged.bind(this)),this.addManagedPropertyListener("suppressPaginationPanel",this.onPaginationChanged.bind(this)),this.addManagedPropertyListeners(["paginationPageSizeSelector","paginationAutoPageSize","suppressPaginationPanel"],()=>this.onPageSizeRelatedOptionsChange()),this.pageSizeComp.toggleSelectDisplay(this.pageSizeComp.shouldShowPageSizeSelector()),this.initialiseTabGuard({onTabKeyDown:()=>{},focusInnerElement:o=>{this.allowFocusInnerElement?this.tabGuardFeature.getTabGuardCtrl().focusInnerElement(o):this.focusService.focusGridInnerElement(o)},forceFocusOutWhenTabGuardsAreEmpty:!0}),this.onPaginationChanged()}setAllowFocus(t){this.allowFocusInnerElement=t}onPaginationChanged(){const e=this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel");this.setDisplayed(e),e&&(this.setupListeners(),this.enableOrDisableButtons(),this.updateRowLabels(),this.setCurrentPageLabel(),this.setTotalLabels(),this.onPageSizeRelatedOptionsChange())}onPageSizeRelatedOptionsChange(){this.pageSizeComp.toggleSelectDisplay(this.pageSizeComp.shouldShowPageSizeSelector())}setupListeners(){this.areListenersSetup||(this.addManagedEventListeners({paginationChanged:this.onPaginationChanged.bind(this)}),[{el:this.btFirst,fn:this.onBtFirst.bind(this)},{el:this.btPrevious,fn:this.onBtPrevious.bind(this)},{el:this.btNext,fn:this.onBtNext.bind(this)},{el:this.btLast,fn:this.onBtLast.bind(this)}].forEach(t=>{const{el:e,fn:n}=t;this.addManagedListeners(e,{click:n,keydown:i=>{(i.key===mn.ENTER||i.key===mn.SPACE)&&(i.preventDefault(),n())}})}),Bve(this,this.getGui(),this.focusService),this.areListenersSetup=!0)}onBtFirst(){this.previousAndFirstButtonsDisabled||this.paginationService.goToFirstPage()}setCurrentPageLabel(){const t=this.paginationService.getTotalPages()>0,e=this.paginationService.getCurrentPage(),n=t?e+1:0;this.lbCurrent.textContent=this.formatNumber(n)}formatNumber(t){const e=this.gos.getCallback("paginationNumberFormatter");if(e)return e({value:t});const n=this.localeService.getLocaleTextFunc(),i=n("thousandSeparator",","),r=n("decimalSeparator",".");return Phe(t,i,r)}getTemplate(){const t=this.localeService.getLocaleTextFunc(),e=t("page","Page"),n=t("to","to"),i=t("of","of"),r=t("firstPage","First Page"),o=t("previousPage","Previous Page"),c=t("nextPage","Next Page"),s=t("lastPage","Last Page"),f=this.getCompId();return`<div class="ag-paging-panel ag-unselectable" id="ag-${f}">
                <ag-page-size-selector data-ref="pageSizeComp"></ag-page-size-selector>
                <span class="ag-paging-row-summary-panel" role="status">
                    <span id="ag-${f}-first-row" data-ref="lbFirstRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${f}-to">${n}</span>
                    <span id="ag-${f}-last-row" data-ref="lbLastRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${f}-of">${i}</span>
                    <span id="ag-${f}-row-count" data-ref="lbRecordCount" class="ag-paging-row-summary-panel-number"></span>
                </span>
                <span class="ag-paging-page-summary-panel" role="presentation">
                    <div data-ref="btFirst" class="ag-button ag-paging-button" role="button" aria-label="${r}"></div>
                    <div data-ref="btPrevious" class="ag-button ag-paging-button" role="button" aria-label="${o}"></div>
                    <span class="ag-paging-description" role="status">
                        <span id="ag-${f}-start-page">${e}</span>
                        <span id="ag-${f}-start-page-number" data-ref="lbCurrent" class="ag-paging-number"></span>
                        <span id="ag-${f}-of-page">${i}</span>
                        <span id="ag-${f}-of-page-number" data-ref="lbTotal" class="ag-paging-number"></span>
                    </span>
                    <div data-ref="btNext" class="ag-button ag-paging-button" role="button" aria-label="${c}"></div>
                    <div data-ref="btLast" class="ag-button ag-paging-button" role="button" aria-label="${s}"></div>
                </span>
            </div>`}onBtNext(){this.nextButtonDisabled||this.paginationService.goToNextPage()}onBtPrevious(){this.previousAndFirstButtonsDisabled||this.paginationService.goToPreviousPage()}onBtLast(){this.lastButtonDisabled||this.paginationService.goToLastPage()}enableOrDisableButtons(){const t=this.paginationService.getCurrentPage(),e=this.rowModel.isLastRowIndexKnown(),n=this.paginationService.getTotalPages();this.previousAndFirstButtonsDisabled=t===0,this.toggleButtonDisabled(this.btFirst,this.previousAndFirstButtonsDisabled),this.toggleButtonDisabled(this.btPrevious,this.previousAndFirstButtonsDisabled);const i=this.isZeroPagesToDisplay(),r=t===n-1;this.nextButtonDisabled=r||i,this.lastButtonDisabled=!e||i||t===n-1,this.toggleButtonDisabled(this.btNext,this.nextButtonDisabled),this.toggleButtonDisabled(this.btLast,this.lastButtonDisabled)}toggleButtonDisabled(t,e){qce(t,e),t.classList.toggle("ag-disabled",e)}updateRowLabels(){var c;const t=this.paginationService.getCurrentPage(),e=this.paginationService.getPageSize(),n=this.rowModel.isLastRowIndexKnown(),i=this.rowModel.isLastRowIndexKnown()?this.paginationService.getMasterRowCount():null;let r,o;if(this.isZeroPagesToDisplay()?r=o=0:(r=e*t+1,o=r+e-1,n&&o>i&&(o=i)),this.lbFirstRowOnPage.textContent=this.formatNumber(r),(c=this.rowNodeBlockLoader)!=null&&c.isLoading()){const s=this.localeService.getLocaleTextFunc();this.lbLastRowOnPage.innerHTML=s("pageLastRowUnknown","?")}else this.lbLastRowOnPage.textContent=this.formatNumber(o)}isZeroPagesToDisplay(){const t=this.rowModel.isLastRowIndexKnown(),e=this.paginationService.getTotalPages();return t&&e===0}setTotalLabels(){const t=this.rowModel.isLastRowIndexKnown(),e=this.paginationService.getTotalPages(),n=t?this.paginationService.getMasterRowCount():null;if(n===1){const i=this.rowModel.getRow(0);if(i&&i.group&&!(i.groupData||i.aggData)){this.setTotalLabelsToZero();return}}if(t)this.lbTotal.textContent=this.formatNumber(e),this.lbRecordCount.textContent=this.formatNumber(n);else{const i=this.localeService.getLocaleTextFunc()("more","more");this.lbTotal.innerHTML=i,this.lbRecordCount.innerHTML=i}}setTotalLabelsToZero(){this.lbFirstRowOnPage.textContent=this.formatNumber(0),this.lbCurrent.textContent=this.formatNumber(0),this.lbLastRowOnPage.textContent=this.formatNumber(0),this.lbTotal.textContent=this.formatNumber(0),this.lbRecordCount.textContent=this.formatNumber(0)}},Gve={selector:"AG-PAGINATION",component:Vve},Hve=class extends wn{constructor(){super(...arguments),this.beanName="paginationService",this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=0,this.masterRowCount=0}wireBeans(t){this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.active=this.gos.get("pagination"),this.pageSizeFromGridOptions=this.gos.get("paginationPageSize"),this.paginateChildRows=this.isPaginateChildRows(),this.addManagedPropertyListener("pagination",this.onPaginationGridOptionChanged.bind(this)),this.addManagedPropertyListener("paginationPageSize",this.onPageSizeGridOptionChanged.bind(this))}getPaginationSelector(){return Gve}isPaginateChildRows(){return this.gos.get("groupRemoveSingleChildren")||this.gos.get("groupRemoveLowestSingleChildren")?!0:this.gos.get("paginateChildRows")}onPaginationGridOptionChanged(){this.active=this.gos.get("pagination"),this.calculatePages(),this.dispatchPaginationChangedEvent({keepRenderedRows:!0})}onPageSizeGridOptionChanged(){this.setPageSize(this.gos.get("paginationPageSize"),"gridOptions")}goToPage(t){!this.active||this.currentPage===t||typeof this.currentPage!="number"||(this.currentPage=t,this.calculatePages(),this.dispatchPaginationChangedEvent({newPage:!0}))}isRowPresent(t){return t.rowIndex>=this.topDisplayedRowIndex&&t.rowIndex<=this.bottomDisplayedRowIndex}getPageForIndex(t){return Math.floor(t/this.pageSize)}goToPageWithIndex(t){if(!this.active)return;const e=this.getPageForIndex(t);this.goToPage(e)}isRowInPage(t){return this.active?this.getPageForIndex(t.rowIndex)===this.currentPage:!0}getCurrentPage(){return this.currentPage}goToNextPage(){this.goToPage(this.currentPage+1)}goToPreviousPage(){this.goToPage(this.currentPage-1)}goToFirstPage(){this.goToPage(0)}goToLastPage(){const t=this.rowModel.getRowCount(),e=Math.floor(t/this.pageSize);this.goToPage(e)}getPageSize(){return this.pageSize}getTotalPages(){return this.totalPages}setPage(t){this.currentPage=t}get pageSize(){return $n(this.pageSizeAutoCalculated)?this.pageSizeAutoCalculated:$n(this.pageSizeFromPageSizeSelector)?this.pageSizeFromPageSizeSelector:$n(this.pageSizeFromInitialState)?this.pageSizeFromInitialState:$n(this.pageSizeFromGridOptions)?this.pageSizeFromGridOptions:this.defaultPageSize}calculatePages(){this.active?this.paginateChildRows?this.calculatePagesAllRows():this.calculatePagesMasterRowsOnly():this.calculatedPagesNotActive(),this.pageBoundsService.calculateBounds(this.topDisplayedRowIndex,this.bottomDisplayedRowIndex)}unsetAutoCalculatedPageSize(){if(this.pageSizeAutoCalculated===void 0)return;const t=this.pageSizeAutoCalculated;this.pageSizeAutoCalculated=void 0,this.pageSize!==t&&(this.calculatePages(),this.dispatchPaginationChangedEvent({newPageSize:!0}))}setPageSize(t,e){const n=this.pageSize;switch(e){case"autoCalculated":this.pageSizeAutoCalculated=t;break;case"pageSizeSelector":this.pageSizeFromPageSizeSelector=t,this.currentPage!==0&&this.goToFirstPage();break;case"initialState":this.pageSizeFromInitialState=t;break;case"gridOptions":this.pageSizeFromGridOptions=t,this.pageSizeFromInitialState=void 0,this.pageSizeFromPageSizeSelector=void 0,this.currentPage!==0&&this.goToFirstPage();break}n!==this.pageSize&&(this.calculatePages(),this.dispatchPaginationChangedEvent({newPageSize:!0,keepRenderedRows:!0}))}setZeroRows(){this.masterRowCount=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=-1,this.currentPage=0,this.totalPages=0}adjustCurrentPageIfInvalid(){this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!isFinite(this.currentPage)||isNaN(this.currentPage)||this.currentPage<0)&&(this.currentPage=0)}calculatePagesMasterRowsOnly(){if(this.masterRowCount=this.rowModel.getTopLevelRowCount(),this.masterRowCount<=0){this.setZeroRows();return}const t=this.masterRowCount-1;this.totalPages=Math.floor(t/this.pageSize)+1,this.adjustCurrentPageIfInvalid();const e=this.pageSize*this.currentPage;let n=this.pageSize*(this.currentPage+1)-1;if(n>t&&(n=t),this.topDisplayedRowIndex=this.rowModel.getTopLevelRowDisplayedIndex(e),n===t)this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1;else{const i=this.rowModel.getTopLevelRowDisplayedIndex(n+1);this.bottomDisplayedRowIndex=i-1}}getMasterRowCount(){return this.masterRowCount}calculatePagesAllRows(){if(this.masterRowCount=this.rowModel.getRowCount(),this.masterRowCount===0){this.setZeroRows();return}const t=this.masterRowCount-1;this.totalPages=Math.floor(t/this.pageSize)+1,this.adjustCurrentPageIfInvalid(),this.topDisplayedRowIndex=this.pageSize*this.currentPage,this.bottomDisplayedRowIndex=this.pageSize*(this.currentPage+1)-1,this.bottomDisplayedRowIndex>t&&(this.bottomDisplayedRowIndex=t)}calculatedPagesNotActive(){this.setPageSize(void 0,"autoCalculated"),this.totalPages=1,this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1}dispatchPaginationChangedEvent(t){const{keepRenderedRows:e=!1,newPage:n=!1,newPageSize:i=!1}=t,r={type:"paginationChanged",animate:!1,newData:!1,newPage:n,newPageSize:i,keepRenderedRows:e};this.eventService.dispatchEvent(r)}},Cq={version:lr,moduleName:"@ag-grid-community/pagination-core",beans:[Hve,Nve]},Wve={version:lr,moduleName:"@ag-grid-community/pagination-api",dependantModules:[Cq],apiFunctions:{paginationIsLastPageFound:Rve,paginationGetPageSize:Tve,paginationGetCurrentPage:Ave,paginationGetTotalPages:Pve,paginationGetRowCount:Ive,paginationGoToNextPage:Dve,paginationGoToPreviousPage:Fve,paginationGoToFirstPage:Lve,paginationGoToLastPage:Ove,paginationGoToPage:kve}},jve={version:lr,moduleName:"@ag-grid-community/pagination",dependantModules:[Cq,Wve]},pn="@ag-grid-community/core",af="@ag-grid-community/client-side-row-model",oH="@ag-grid-community/csv-export",kE="@ag-grid-community/infinite-row-model",NE="@ag-grid-enterprise/advanced-filter",Gh="@ag-grid-enterprise/charts",E0="@ag-grid-enterprise/clipboard",BC="@ag-grid-enterprise/excel-export",BE="@ag-grid-enterprise/master-detail",TD="@ag-grid-enterprise/menu",AD="@ag-grid-enterprise/range-selection",$s="@ag-grid-enterprise/row-grouping",xp="@ag-grid-enterprise/server-side-row-model",lf="@ag-grid-enterprise/side-bar",$ve="@ag-grid-enterprise/status-bar",qve={dispatchEvent:pn,getState:pn,getGridId:pn,destroy:pn,isDestroyed:pn,getGridOption:pn,setGridOption:pn,updateGridOptions:pn,setNodesSelected:pn,selectAll:pn,deselectAll:pn,selectAllFiltered:pn,deselectAllFiltered:pn,selectAllOnCurrentPage:pn,deselectAllOnCurrentPage:pn,getSelectedNodes:pn,getSelectedRows:pn,redrawRows:pn,setRowNodeExpanded:pn,getRowNode:pn,addRenderedRowListener:pn,getRenderedNodes:pn,forEachNode:pn,getFirstDisplayedRow:pn,getFirstDisplayedRowIndex:pn,getLastDisplayedRow:pn,getLastDisplayedRowIndex:pn,getDisplayedRowAtIndex:pn,getDisplayedRowCount:pn,getModel:pn,getVerticalPixelRange:pn,getHorizontalPixelRange:pn,ensureColumnVisible:pn,ensureIndexVisible:pn,ensureNodeVisible:pn,getFocusedCell:pn,clearFocusedCell:pn,setFocusedCell:pn,tabToNextCell:pn,tabToPreviousCell:pn,setFocusedHeader:pn,addEventListener:pn,addGlobalListener:pn,removeEventListener:pn,removeGlobalListener:pn,expireValueCache:pn,getValue:pn,getCellValue:pn,showColumnMenuAfterButtonClick:pn,showColumnMenuAfterMouseClick:pn,showColumnMenu:pn,hidePopupMenu:pn,onSortChanged:pn,getPinnedTopRowCount:pn,getPinnedBottomRowCount:pn,getPinnedTopRow:pn,getPinnedBottomRow:pn,showLoadingOverlay:pn,showNoRowsOverlay:pn,hideOverlay:pn,setGridAriaProperty:pn,refreshCells:pn,flashCells:pn,refreshHeader:pn,isAnimationFrameQueueEmpty:pn,flushAllAnimationFrames:pn,getSizesForCurrentTheme:pn,getCellRendererInstances:pn,addRowDropZone:pn,removeRowDropZone:pn,getRowDropZoneParams:pn,getColumnDef:pn,getColumnDefs:pn,sizeColumnsToFit:pn,setColumnGroupOpened:pn,getColumnGroup:pn,getProvidedColumnGroup:pn,getDisplayNameForColumn:pn,getDisplayNameForColumnGroup:pn,getColumn:pn,getColumns:pn,applyColumnState:pn,getColumnState:pn,resetColumnState:pn,getColumnGroupState:pn,setColumnGroupState:pn,resetColumnGroupState:pn,isPinning:pn,isPinningLeft:pn,isPinningRight:pn,getDisplayedColAfter:pn,getDisplayedColBefore:pn,setColumnVisible:pn,setColumnsVisible:pn,setColumnPinned:pn,setColumnsPinned:pn,getAllGridColumns:pn,getDisplayedLeftColumns:pn,getDisplayedCenterColumns:pn,getDisplayedRightColumns:pn,getAllDisplayedColumns:pn,getAllDisplayedVirtualColumns:pn,moveColumn:pn,moveColumnByIndex:pn,moveColumns:pn,setColumnWidth:pn,setColumnWidths:pn,getLeftDisplayedColumnGroups:pn,getCenterDisplayedColumnGroups:pn,getRightDisplayedColumnGroups:pn,getAllDisplayedColumnGroups:pn,autoSizeColumn:pn,autoSizeColumns:pn,autoSizeAllColumns:pn,undoCellEditing:pn,redoCellEditing:pn,getCellEditorInstances:pn,getEditingCells:pn,stopEditing:pn,startEditingCell:pn,getCurrentUndoSize:pn,getCurrentRedoSize:pn,isAnyFilterPresent:pn,onFilterChanged:pn,isColumnFilterPresent:pn,getFilterInstance:pn,getColumnFilterInstance:pn,destroyFilter:pn,setFilterModel:pn,getFilterModel:pn,getColumnFilterModel:pn,setColumnFilterModel:pn,showColumnFilter:pn,isQuickFilterPresent:pn,getQuickFilter:pn,resetQuickFilter:pn,paginationIsLastPageFound:pn,paginationGetPageSize:pn,paginationGetCurrentPage:pn,paginationGetTotalPages:pn,paginationGetRowCount:pn,paginationGoToNextPage:pn,paginationGoToPreviousPage:pn,paginationGoToFirstPage:pn,paginationGoToLastPage:pn,paginationGoToPage:pn,expandAll:pn,collapseAll:pn,onRowHeightChanged:pn,setRowCount:pn,getCacheBlockState:pn,onGroupExpandedOrCollapsed:af,refreshClientSideRowModel:af,forEachLeafNode:af,forEachNodeAfterFilter:af,forEachNodeAfterFilterAndSort:af,resetRowHeights:af,applyTransaction:af,applyTransactionAsync:af,flushAsyncTransactions:af,getBestCostNodeSelection:af,getDataAsCsv:oH,exportDataAsCsv:oH,refreshInfiniteCache:kE,purgeInfiniteCache:kE,getInfiniteRowCount:kE,isLastRowIndexKnown:kE,getAdvancedFilterModel:NE,setAdvancedFilterModel:NE,showAdvancedFilterBuilder:NE,hideAdvancedFilterBuilder:NE,getChartModels:Gh,getChartRef:Gh,getChartImageDataURL:Gh,downloadChart:Gh,openChartToolPanel:Gh,closeChartToolPanel:Gh,createRangeChart:Gh,createPivotChart:Gh,createCrossFilterChart:Gh,updateChart:Gh,restoreChart:Gh,copyToClipboard:E0,cutToClipboard:E0,copySelectedRowsToClipboard:E0,copySelectedRangeToClipboard:E0,copySelectedRangeDown:E0,pasteFromClipboard:E0,getDataAsExcel:BC,exportDataAsExcel:BC,getSheetDataForExcel:BC,getMultipleSheetsAsExcel:BC,exportMultipleSheetsAsExcel:BC,addDetailGridInfo:BE,removeDetailGridInfo:BE,getDetailGridInfo:BE,forEachDetailGridInfo:BE,showContextMenu:TD,showColumnChooser:TD,hideColumnChooser:TD,getCellRanges:AD,addCellRange:AD,clearRangeSelection:AD,addAggFunc:$s,addAggFuncs:$s,clearAggFuncs:$s,setColumnAggFunc:$s,isPivotMode:$s,getPivotResultColumn:$s,setValueColumns:$s,getValueColumns:$s,removeValueColumn:$s,removeValueColumns:$s,addValueColumn:$s,addValueColumns:$s,setRowGroupColumns:$s,removeRowGroupColumn:$s,removeRowGroupColumns:$s,addRowGroupColumn:$s,addRowGroupColumns:$s,getRowGroupColumns:$s,moveRowGroupColumn:$s,setPivotColumns:$s,removePivotColumn:$s,removePivotColumns:$s,addPivotColumn:$s,addPivotColumns:$s,getPivotColumns:$s,setPivotResultColumns:$s,getPivotResultColumns:$s,getServerSideSelectionState:xp,setServerSideSelectionState:xp,applyServerSideTransaction:xp,applyServerSideTransactionAsync:xp,applyServerSideRowData:xp,retryServerSideLoads:xp,flushServerSideAsyncTransactions:xp,refreshServerSide:xp,getServerSideGroupLevelState:xp,isSideBarVisible:lf,setSideBarVisible:lf,setSideBarPosition:lf,openToolPanel:lf,closeToolPanel:lf,getOpenedToolPanel:lf,refreshToolPanel:lf,isToolPanelShowing:lf,getToolPanelInstance:lf,getSideBar:lf,getStatusPanel:$ve},au="clientSide",Mc="serverSide",M0="infinite",Zve={onGroupExpandedOrCollapsed:[au],refreshClientSideRowModel:[au],forEachLeafNode:[au],forEachNodeAfterFilter:[au],forEachNodeAfterFilterAndSort:[au],resetRowHeights:[au],applyTransaction:[au],applyTransactionAsync:[au],flushAsyncTransactions:[au],getBestCostNodeSelection:[au],getServerSideSelectionState:[Mc],setServerSideSelectionState:[Mc],applyServerSideTransaction:[Mc],applyServerSideTransactionAsync:[Mc],applyServerSideRowData:[Mc],retryServerSideLoads:[Mc],flushServerSideAsyncTransactions:[Mc],refreshServerSide:[Mc],getServerSideGroupLevelState:[Mc],refreshInfiniteCache:[M0],purgeInfiniteCache:[M0],getInfiniteRowCount:[M0],isLastRowIndexKnown:[M0],expandAll:[au,Mc],collapseAll:[au,Mc],onRowHeightChanged:[au,Mc],setRowCount:[M0,Mc],getCacheBlockState:[M0,Mc]},Xve={getValue:{version:"v31.3",new:"getCellValue"},getFirstDisplayedRow:{version:"v31.1",new:"getFirstDisplayedRowIndex"},getLastDisplayedRow:{version:"v31.1",new:"getLastDisplayedRowIndex"},getModel:{version:"v31.1",message:"Please use the appropriate grid API methods instead."},setColumnVisible:{version:"v31.1",old:"setColumnVisible(key,visible)",new:"setColumnsVisible([key],visible)"},setColumnPinned:{version:"v31.1",old:"setColumnPinned(key,pinned)",new:"setColumnsPinned([key],pinned)"},moveColumn:{version:"v31.1",old:"moveColumn(key, toIndex)",new:"moveColumns([key], toIndex)"},setColumnWidth:{version:"v31.1",old:"setColumnWidth(col, width)",new:"setColumnWidths([{key: col, newWidth: width}])"},autoSizeColumn:{version:"v31.1",old:"autoSizeColumn(key, skipHeader)",new:"autoSizeColumns([key], skipHeader)"},addAggFunc:{version:"v31.1",old:"addAggFunc(key, func)",new:"addAggFuncs({ key: func })"},removeValueColumn:{version:"v31.1",old:"removeValueColumn(colKey)",new:"removeValueColumns([colKey])"},addValueColumn:{version:"v31.1",old:"addValueColumn(colKey)",new:"addValueColumns([colKey])"},removeRowGroupColumn:{version:"v31.1",old:"removeRowGroupColumn(colKey)",new:"removeRowGroupColumns([colKey])"},addRowGroupColumn:{version:"v31.1",old:"addRowGroupColumn(colKey)",new:"addRowGroupColumns([colKey])"},removePivotColumn:{version:"v31.1",old:"removePivotColumn(colKey)",new:"removePivotColumns([colKey])"},addPivotColumn:{version:"v31.1",old:"addPivotColumn(colKey)",new:"addPivotColumns([colKey])"},showColumnMenuAfterButtonClick:{version:"v31.1",message:"Use 'IHeaderParams.showColumnMenu' within a header component, or 'api.showColumnMenu' elsewhere."},showColumnMenuAfterMouseClick:{version:"v31.1",message:"Use 'IHeaderParams.showColumnMenuAfterMouseClick' within a header component, or 'api.showColumnMenu' elsewhere."},getFilterInstance:{version:"v31.1",message:"'getFilterInstance' is deprecated. To get/set individual filter models, use 'getColumnFilterModel' or 'setColumnFilterModel' instead. To get hold of the filter instance, use 'getColumnFilterInstance' which returns the instance asynchronously."},showLoadingOverlay:{version:"v32",message:'`showLoadingOverlay` is deprecated. Use the grid option "loading"=true instead or setGridOption("loading", true).'}};function Kve(t,e){const n=qve[t];n?xl.__assertRegistered(n,`api.${t}`,e)&&Tn(`API function '${t}' not registered to module '${n}'`):_s(`Unknown API function: '${t}' on GridApi.`)}function Yve(t,e,n){const i=Xve[t];if(i){const{version:o,new:c,old:s,message:f}=i,v=s??t;return(...w)=>{const C=c?`Please use ${c} instead. `:"";return Tn(`Since ${o} api.${v} is deprecated. ${C}${f??""}`),e.apply(e,w)}}const r=Zve[t];return r?(...o)=>{const c=n.rowModel.getType();if(!r.includes(c)){_s(`api.${t} can only be called when gridOptions.rowModelType is ${r.join(" or ")}`);return}return e.apply(e,o)}:e}var Jve={columnsMenuParams:{version:"31.1",message:"Use `columnChooserParams` instead."},suppressMenu:{version:"31.1",message:"Use `suppressHeaderMenuButton` instead."},suppressCellFlash:{version:"31.2",message:"Use `enableCellChangeFlash={false}` in the ColDef"}},mg=(t,e)=>(e.rowModelType??"clientSide")==="clientSide"?{module:"@ag-grid-enterprise/row-grouping"}:null,Qve={enableRowGroup:mg,rowGroup:mg,rowGroupIndex:mg,enablePivot:mg,enableValue:mg,pivot:mg,pivotIndex:mg,aggFunc:mg,cellEditor:t=>t.cellEditor==="agRichSelect"||t.cellEditor==="agRichSelectCellEditor"?{module:"@ag-grid-enterprise/rich-select"}:null,menuTabs:t=>{var n;const e=["columnsMenuTab","generalMenuTab"];return(n=t.menuTabs)!=null&&n.some(i=>e.includes(i))?{module:"@ag-grid-enterprise/menu"}:null},columnsMenuParams:{module:["@ag-grid-enterprise/menu","@ag-grid-enterprise/column-tool-panel"]},columnChooserParams:{module:["@ag-grid-enterprise/menu","@ag-grid-enterprise/column-tool-panel"]},headerCheckboxSelection:{supportedRowModels:["clientSide","serverSide"],dependencies:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelection is only supported with rowSelection=multiple"},headerCheckboxSelectionFilteredOnly:{supportedRowModels:["clientSide"],dependencies:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelectionFilteredOnly is only supported with rowSelection=multiple"},headerCheckboxSelectionCurrentPageOnly:{supportedRowModels:["clientSide"],dependencies:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelectionCurrentPageOnly is only supported with rowSelection=multiple"},children:()=>px},eye={headerName:void 0,columnGroupShow:void 0,headerClass:void 0,toolPanelClass:void 0,headerValueGetter:void 0,pivotKeys:void 0,groupId:void 0,colId:void 0,sort:void 0,initialSort:void 0,field:void 0,type:void 0,cellDataType:void 0,tooltipComponent:void 0,tooltipField:void 0,headerTooltip:void 0,cellClass:void 0,showRowGroup:void 0,filter:void 0,initialAggFunc:void 0,defaultAggFunc:void 0,aggFunc:void 0,pinned:void 0,initialPinned:void 0,chartDataType:void 0,cellAriaRole:void 0,cellEditorPopupPosition:void 0,headerGroupComponent:void 0,headerGroupComponentParams:void 0,cellStyle:void 0,cellRenderer:void 0,cellRendererParams:void 0,cellEditor:void 0,cellEditorParams:void 0,filterParams:void 0,pivotValueColumn:void 0,headerComponent:void 0,headerComponentParams:void 0,floatingFilterComponent:void 0,floatingFilterComponentParams:void 0,tooltipComponentParams:void 0,refData:void 0,columnsMenuParams:void 0,columnChooserParams:void 0,children:void 0,sortingOrder:void 0,allowedAggFuncs:void 0,menuTabs:void 0,pivotTotalColumnIds:void 0,cellClassRules:void 0,icons:void 0,sortIndex:void 0,initialSortIndex:void 0,flex:void 0,initialFlex:void 0,width:void 0,initialWidth:void 0,minWidth:void 0,maxWidth:void 0,rowGroupIndex:void 0,initialRowGroupIndex:void 0,pivotIndex:void 0,initialPivotIndex:void 0,suppressCellFlash:void 0,suppressColumnsToolPanel:void 0,suppressFiltersToolPanel:void 0,openByDefault:void 0,marryChildren:void 0,suppressStickyLabel:void 0,hide:void 0,initialHide:void 0,rowGroup:void 0,initialRowGroup:void 0,pivot:void 0,initialPivot:void 0,checkboxSelection:void 0,showDisabledCheckboxes:void 0,headerCheckboxSelection:void 0,headerCheckboxSelectionFilteredOnly:void 0,headerCheckboxSelectionCurrentPageOnly:void 0,suppressMenu:void 0,suppressHeaderMenuButton:void 0,suppressMovable:void 0,lockPosition:void 0,lockVisible:void 0,lockPinned:void 0,unSortIcon:void 0,suppressSizeToFit:void 0,suppressAutoSize:void 0,enableRowGroup:void 0,enablePivot:void 0,enableValue:void 0,editable:void 0,suppressPaste:void 0,suppressNavigable:void 0,enableCellChangeFlash:void 0,rowDrag:void 0,dndSource:void 0,autoHeight:void 0,wrapText:void 0,sortable:void 0,resizable:void 0,singleClickEdit:void 0,floatingFilter:void 0,cellEditorPopup:void 0,suppressFillHandle:void 0,wrapHeaderText:void 0,autoHeaderHeight:void 0,dndSourceOnRowDrag:void 0,valueGetter:void 0,valueSetter:void 0,filterValueGetter:void 0,keyCreator:void 0,valueFormatter:void 0,valueParser:void 0,comparator:void 0,equals:void 0,pivotComparator:void 0,suppressKeyboardEvent:void 0,suppressHeaderKeyboardEvent:void 0,colSpan:void 0,rowSpan:void 0,getQuickFilterText:void 0,onCellValueChanged:void 0,onCellClicked:void 0,onCellDoubleClicked:void 0,onCellContextMenu:void 0,rowDragText:void 0,tooltipValueGetter:void 0,cellRendererSelector:void 0,cellEditorSelector:void 0,suppressSpanHeaderHeight:void 0,useValueFormatterForExport:void 0,useValueParserForImport:void 0,mainMenuItems:void 0,contextMenuItems:void 0,suppressFloatingFilterButton:void 0,suppressHeaderFilterButton:void 0,suppressHeaderContextMenu:void 0,loadingCellRenderer:void 0,loadingCellRendererParams:void 0,loadingCellRendererSelector:void 0,context:void 0},tye=Object.keys(eye),px={objectName:"colDef",allProperties:tye,docsUrl:"column-properties/",deprecations:Jve,validations:Qve},nye=()=>({advancedFilterModel:{version:"31",message:"Use `initialState.filter.advancedFilterModel` instead."},suppressAsyncEvents:{version:"31",message:"Events should be handled asynchronously."},cellFadeDelay:{version:"31.1",renamed:"cellFadeDuration"},cellFlashDelay:{version:"31.1",renamed:"cellFlashDuration"},suppressServerSideInfiniteScroll:{version:"31.1"},serverSideSortOnServer:{version:"31.1"},serverSideFilterOnServer:{version:"31.1"},enableCellChangeFlash:{version:"31.2",message:"Use `enableCellChangeFlash` in the `ColDef` or `defaultColDef` for all columns."},groupIncludeFooter:{version:"31.3",message:"Use `groupTotalRow` instead."},groupIncludeTotalFooter:{version:"31.3",message:"Use `grandTotalRow` instead."},suppressLoadingOverlay:{version:"32",message:"Use `loading`=false instead."}}),iye={suppressContextMenu:!1,preventDefaultOnContextMenu:!1,allowContextMenuWithControlKey:!1,suppressMenuHide:!0,enableBrowserTooltips:!1,tooltipTrigger:"hover",tooltipShowDelay:2e3,tooltipHideDelay:1e4,tooltipMouseTrack:!1,tooltipShowMode:"standard",tooltipInteraction:!1,copyHeadersToClipboard:!1,copyGroupHeadersToClipboard:!1,clipboardDelimiter:"	",suppressCopyRowsToClipboard:!1,suppressCopySingleCellRanges:!1,suppressLastEmptyLineOnPaste:!1,suppressClipboardPaste:!1,suppressClipboardApi:!1,suppressCutToClipboard:!1,maintainColumnOrder:!1,suppressFieldDotNotation:!1,allowDragFromColumnsToolPanel:!1,suppressMovableColumns:!1,suppressColumnMoveAnimation:!1,suppressDragLeaveHidesColumns:!1,suppressRowGroupHidesColumns:!1,suppressAutoSize:!1,autoSizePadding:20,skipHeaderOnAutoSize:!1,singleClickEdit:!1,suppressClickEdit:!1,readOnlyEdit:!1,stopEditingWhenCellsLoseFocus:!1,enterNavigatesVertically:!1,enterNavigatesVerticallyAfterEdit:!1,enableCellEditingOnBackspace:!1,undoRedoCellEditing:!1,undoRedoCellEditingLimit:10,suppressCsvExport:!1,suppressExcelExport:!1,cacheQuickFilter:!1,includeHiddenColumnsInQuickFilter:!1,excludeChildrenWhenTreeDataFiltering:!1,enableAdvancedFilter:!1,includeHiddenColumnsInAdvancedFilter:!1,enableCharts:!1,masterDetail:!1,keepDetailRows:!1,keepDetailRowsCount:10,detailRowAutoHeight:!1,tabIndex:0,rowBuffer:10,valueCache:!1,valueCacheNeverExpires:!1,enableCellExpressions:!1,suppressTouch:!1,suppressFocusAfterRefresh:!1,suppressAsyncEvents:!1,suppressBrowserResizeObserver:!1,suppressPropertyNamesCheck:!1,suppressChangeDetection:!1,debug:!1,suppressLoadingOverlay:!1,suppressNoRowsOverlay:!1,pagination:!1,paginationPageSize:100,paginationPageSizeSelector:!0,paginationAutoPageSize:!1,paginateChildRows:!1,suppressPaginationPanel:!1,pivotMode:!1,pivotPanelShow:"never",pivotDefaultExpanded:0,pivotSuppressAutoColumn:!1,suppressExpandablePivotGroups:!1,functionsReadOnly:!1,suppressAggFuncInHeader:!1,alwaysAggregateAtRootLevel:!1,aggregateOnlyChangedColumns:!1,suppressAggFilteredOnly:!1,removePivotHeaderRowWhenSingleValueColumn:!1,animateRows:!0,enableCellChangeFlash:!1,cellFlashDelay:500,cellFlashDuration:500,cellFadeDelay:1e3,cellFadeDuration:1e3,allowShowChangeAfterFilter:!1,domLayout:"normal",ensureDomOrder:!1,enableRtl:!1,suppressColumnVirtualisation:!1,suppressMaxRenderedRowRestriction:!1,suppressRowVirtualisation:!1,rowDragManaged:!1,suppressRowDrag:!1,suppressMoveWhenRowDragging:!1,rowDragEntireRow:!1,rowDragMultiRow:!1,embedFullWidthRows:!1,groupDisplayType:"singleColumn",groupDefaultExpanded:0,groupMaintainOrder:!1,groupSelectsChildren:!1,groupIncludeTotalFooter:!1,groupSuppressBlankHeader:!1,groupSelectsFiltered:!1,showOpenedGroup:!1,groupRemoveSingleChildren:!1,groupRemoveLowestSingleChildren:!1,groupHideOpenParents:!1,groupAllowUnbalanced:!1,rowGroupPanelShow:"never",suppressMakeColumnVisibleAfterUnGroup:!1,treeData:!1,rowGroupPanelSuppressSort:!1,suppressGroupRowsSticky:!1,rowModelType:"clientSide",asyncTransactionWaitMillis:50,suppressModelUpdateAfterUpdateTransaction:!1,cacheOverflowSize:1,infiniteInitialRowCount:1,serverSideInitialRowCount:1,suppressServerSideInfiniteScroll:!1,cacheBlockSize:100,maxBlocksInCache:-1,maxConcurrentDatasourceRequests:2,blockLoadDebounceMillis:0,purgeClosedRowNodes:!1,serverSideSortAllLevels:!1,serverSideOnlyRefreshFilteredGroups:!1,serverSideSortOnServer:!1,serverSideFilterOnServer:!1,serverSidePivotResultFieldSeparator:"_",viewportRowModelPageSize:5,viewportRowModelBufferSize:5,alwaysShowHorizontalScroll:!1,alwaysShowVerticalScroll:!1,debounceVerticalScrollbar:!1,suppressHorizontalScroll:!1,suppressScrollOnNewData:!1,suppressScrollWhenPopupsAreOpen:!1,suppressAnimationFrame:!1,suppressMiddleClickScrolls:!1,suppressPreventDefaultOnMouseWheel:!1,rowMultiSelectWithClick:!1,suppressRowDeselection:!1,suppressRowClickSelection:!1,suppressCellFocus:!1,suppressHeaderFocus:!1,suppressMultiRangeSelection:!1,enableCellTextSelection:!1,enableRangeSelection:!1,enableRangeHandle:!1,enableFillHandle:!1,fillHandleDirection:"xy",suppressClearOnFillReduction:!1,accentedSort:!1,unSortIcon:!1,suppressMultiSort:!1,alwaysMultiSort:!1,suppressMaintainUnsortedOrder:!1,suppressRowHoverHighlight:!1,suppressRowTransform:!1,columnHoverHighlight:!1,deltaSort:!1,enableGroupEdit:!1,suppressGroupMaintainValueType:!1,groupLockGroupColumns:0,serverSideEnableClientSideSort:!1,suppressServerSideFullWidthLoadingRow:!1,pivotMaxGeneratedColumns:-1,columnMenu:"new",reactiveCustomComponents:!0},rye=()=>({sideBar:{module:"@ag-grid-enterprise/side-bar"},statusBar:{module:"@ag-grid-enterprise/status-bar"},enableCharts:{module:"@ag-grid-enterprise/charts"},getMainMenuItems:{module:"@ag-grid-enterprise/menu"},getContextMenuItems:{module:"@ag-grid-enterprise/menu"},allowContextMenuWithControlKey:{module:"@ag-grid-enterprise/menu"},enableAdvancedFilter:{module:"@ag-grid-enterprise/advanced-filter"},treeData:{supportedRowModels:["clientSide","serverSide"],module:"@ag-grid-enterprise/row-grouping",dependencies:t=>{const e=t.rowModelType??"clientSide";switch(e){case"clientSide":{const n=`treeData requires 'getDataPath' in the ${e} row model.`;return t.getDataPath?null:n}case"serverSide":{const n=`treeData requires 'isServerSideGroup' and 'getServerSideGroupKey' in the ${e} row model.`;return t.isServerSideGroup&&t.getServerSideGroupKey?null:n}}return null}},masterDetail:{module:"@ag-grid-enterprise/master-detail"},enableRangeSelection:{module:"@ag-grid-enterprise/range-selection"},enableRangeHandle:{dependencies:{enableRangeSelection:[!0]}},enableFillHandle:{dependencies:{enableRangeSelection:[!0]}},groupDefaultExpanded:{supportedRowModels:["clientSide"]},groupIncludeFooter:{supportedRowModels:["clientSide","serverSide"],dependencies:t=>{switch(t.rowModelType??"clientSide"){case"clientSide":return null;case"serverSide":return t.suppressServerSideInfiniteScroll?"groupIncludeFooter is not supported alongside suppressServerSideInfiniteScroll":null}return null}},groupHideOpenParents:{supportedRowModels:["clientSide"],dependencies:{groupTotalRow:[void 0,"bottom"]}},groupIncludeTotalFooter:{supportedRowModels:["clientSide"]},groupRemoveSingleChildren:{dependencies:{groupHideOpenParents:[void 0,!1],groupRemoveLowestSingleChildren:[void 0,!1]}},groupRemoveLowestSingleChildren:{dependencies:{groupHideOpenParents:[void 0,!1],groupRemoveSingleChildren:[void 0,!1]}},groupSelectsChildren:{dependencies:{rowSelection:["multiple"]}},viewportDatasource:{supportedRowModels:["viewport"],module:"@ag-grid-enterprise/viewport-row-model"},serverSideDatasource:{supportedRowModels:["serverSide"],module:"@ag-grid-enterprise/server-side-row-model"},cacheBlockSize:{supportedRowModels:["serverSide","infinite"]},datasource:{supportedRowModels:["infinite"],module:"@ag-grid-community/infinite-row-model"},rowData:{supportedRowModels:["clientSide"],module:"@ag-grid-community/client-side-row-model"},columnDefs:()=>px,defaultColDef:()=>px,defaultColGroupDef:()=>px,autoGroupColumnDef:()=>px}),sye=()=>({objectName:"gridOptions",allProperties:[...iS.ALL_PROPERTIES,...rS.EVENT_CALLBACKS],propertyExceptions:["api"],docsUrl:"grid-options/",deprecations:nye(),validations:rye()}),oye=class extends wn{constructor(){super(...arguments),this.beanName="validationService"}wireBeans(t){this.beans=t,this.gridOptions=t.gridOptions}postConstruct(){this.processGridOptions(this.gridOptions)}processGridOptions(t){this.processOptions(t,sye())}processColumnDefs(t){this.processOptions(t,px)}warnMissingApiFunction(t){Kve(t,this.gridId)}validateApiFunction(t,e){return Yve(t,e,this.beans)}processOptions(t,e){const{validations:n,deprecations:i,allProperties:r,propertyExceptions:o,objectName:c,docsUrl:s}=e;r&&this.gridOptions.suppressPropertyNamesCheck!==!0&&this.checkProperties(t,[...o??[],...Object.keys(i)],r,c,s);const f=new Set;Object.keys(t).forEach(w=>{const C=i[w];if(C)if("renamed"in C){const{renamed:H,version:j}=C;f.add(`As of v${j}, ${String(w)} is deprecated. Please use ${String(H)} instead.`),t[H]=t[w]}else{const{message:H,version:j}=C;f.add(`As of v${j}, ${String(w)} is deprecated. ${H??""}`)}const M=t[w];if(M==null||M===!1)return;const F=n[w];let N;if(F)if(typeof F=="function"){const H=F(t,this.gridOptions);if(!H)return;if("objectName"in H){const j=t[w];if(Array.isArray(j)){j.forEach(q=>{this.processOptions(q,H)});return}this.processOptions(t[w],H);return}N=H}else N=F;else return;const{module:z,dependencies:L,supportedRowModels:P}=N;if(P){const H=this.gridOptions.rowModelType??"clientSide";if(!P.includes(H)){f.add(`${String(w)} is not supported with the '${H}' row model.`);return}}if(z){const H=Array.isArray(z)?z:[z];let j=!0;if(H.forEach(q=>{xl.__assertRegistered(q,String(w),this.gridId)||(j=!1,f.add(`${String(w)} is only available when ${q} is loaded.`))}),!j)return}if(L){const H=this.checkForWarning(w,L,t);if(H){f.add(H);return}}}),f.size>0&&f.forEach(w=>{Tn(w)})}checkForWarning(t,e,n){if(typeof e=="function")return e(n,this.gridOptions);const r=Object.entries(e).find(([s,f])=>{const v=n[s];return!f.includes(v)});if(!r)return null;const[o,c]=r;return c.length>1?`'${String(t)}' requires '${o}' to be one of [${c.join(", ")}].`:`'${String(t)}' requires '${o}' to be ${c[0]}.`}checkProperties(t,e,n,i,r){const o=["__ob__","__v_skip","__metadata__"],c=Fue(Object.getOwnPropertyNames(t),[...o,...e,...n],n);if(td(c,(s,f)=>{let v=`invalid ${i} property '${s}' did you mean any of these: ${f.slice(0,8).join(", ")}.`;n.includes("context")&&(v+=`
If you are trying to annotate ${i} with application data, use the '${i}.context' property instead.`),Tn(v)}),Object.keys(c).length>0&&r){const s=this.getFrameworkOverrides().getDocLink(r);Tn(`to see all the valid ${i} properties please check: ${s}`)}}},aye={version:lr,moduleName:"@ag-grid-community/core"},lye={version:lr,moduleName:"@ag-grid-community/core-validations",beans:[oye]},Sq={version:lr,moduleName:"@ag-grid-community/core-community-features",dependantModules:[aye,lye,xpe,pde,Mve,tge,ume,jve,Cve]},cye=class extends wn{constructor(){super(...arguments),this.beanName="gridDestroyService",this.destroyCalled=!1}wireBeans(t){this.beans=t}destroy(){var e,n;if(this.destroyCalled)return;const t={type:"gridPreDestroyed",state:((e=this.beans.stateService)==null?void 0:e.getState())??{}};this.eventService.dispatchEvent(t),this.destroyCalled=!0,(n=this.beans.ctrlsService.get("gridCtrl"))==null||n.destroyGridUi(),this.beans.context.destroy(),super.destroy()}isDestroyCalled(){return this.destroyCalled}},cR=new Set(["gridPreDestroyed","fillStart","pasteStart"]),uye=t=>t==="checkboxSelected"||t==="rowClicked"||t==="spaceKey"||t==="uiSelectAll"||t==="uiSelectAllCurrentPage"||t==="uiSelectAllFiltered",hye=new Map([...iS.BOOLEAN_PROPERTIES.map(t=>[t,xL]),...iS.NUMBER_PROPERTIES.map(t=>[t,V7]),["groupAggFiltering",t=>typeof t=="function"?t:xL(t)],["pageSize",of(1)],["autoSizePadding",of(0)],["keepDetailRowsCount",of(1)],["rowBuffer",of(0)],["infiniteInitialRowCount",of(1)],["cacheOverflowSize",of(1)],["cacheBlockSize",of(1)],["serverSideInitialRowCount",of(1)],["viewportRowModelPageSize",of(1)],["viewportRowModelBufferSize",of(0)]]);function bq(t,e){const n=hye.get(t);return n?n(e):e}function dye(t){const e={};return Object.entries(t).forEach(([n,i])=>{const r=bq(n,i);e[n]=r}),e}var Eq=class Mq extends wn{constructor(){super(...arguments),this.beanName="gos",this.domDataKey="__AG_"+Math.random().toString(),this.propertyEventService=new Cw,this.globalEventHandlerFactory=e=>(n,i)=>{if(!this.isAlive())return;const r=cR.has(n);if(r&&!e||!r&&e)return;const o=rS.getCallbackForEvent(n),c=this.gridOptions[o];typeof c=="function"&&this.frameworkOverrides.wrapOutgoing(()=>{c(i)})}}wireBeans(e){this.gridOptions=e.gridOptions,this.eGridDiv=e.eGridDiv,this.validationService=e.validationService,this.environment=e.environment,this.api=e.gridApi}get gridOptionsContext(){return this.gridOptions.context}postConstruct(){const e=!this.get("suppressAsyncEvents");this.eventService.addGlobalListener(this.globalEventHandlerFactory().bind(this),e),this.eventService.addGlobalListener(this.globalEventHandlerFactory(!0).bind(this),!1),this.propertyEventService.setFrameworkOverrides(this.frameworkOverrides),this.getScrollbarWidth(),this.addManagedEventListeners({gridOptionsChanged:({options:n})=>{this.updateGridOptions({options:n,force:!0,source:"gridOptionsUpdated"})}})}get(e){return this.gridOptions[e]??iye[e]}getCallback(e){return this.mergeGridCommonParams(this.gridOptions[e])}exists(e){return $n(this.gridOptions[e])}mergeGridCommonParams(e){return e&&(i=>{const r=i;return r.api=this.api,r.context=this.gridOptionsContext,e(r)})}updateGridOptions({options:e,force:n,source:i="api"}){var c;const r={id:Mq.changeSetId++,properties:[]},o=[];Object.entries(e).forEach(([s,f])=>{i==="api"&&Uce[s]&&Tn(`${s} is an initial property and cannot be updated.`);const v=bq(s,f),w=n||typeof v=="object"&&i==="api",C=this.gridOptions[s];if(w||C!==v){this.gridOptions[s]=v;const M={type:s,currentValue:v,previousValue:C,changeSet:r,source:i};o.push(M)}}),(c=this.validationService)==null||c.processGridOptions(this.gridOptions),r.properties=o.map(s=>s.type),o.forEach(s=>{this.gridOptions.debug&&nd(`Updated property ${s.type} from`,s.previousValue," to ",s.currentValue),this.propertyEventService.dispatchEvent(s)})}addPropertyEventListener(e,n){this.propertyEventService.addEventListener(e,n)}removePropertyEventListener(e,n){this.propertyEventService.removeEventListener(e,n)}getScrollbarWidth(){if(this.scrollbarWidth==null){const n=typeof this.gridOptions.scrollbarWidth=="number"&&this.gridOptions.scrollbarWidth>=0?this.gridOptions.scrollbarWidth:oue();n!=null&&(this.scrollbarWidth=n,this.eventService.dispatchEvent({type:"scrollbarWidthChanged"}))}return this.scrollbarWidth}isRowModelType(e){return this.gridOptions.rowModelType===e||e==="clientSide"&&Hr(this.gridOptions.rowModelType)}isDomLayout(e){return(this.gridOptions.domLayout??"normal")===e}isRowSelection(){return this.gridOptions.rowSelection==="single"||this.gridOptions.rowSelection==="multiple"}useAsyncEvents(){return!this.get("suppressAsyncEvents")}isGetRowHeightFunction(){return typeof this.gridOptions.getRowHeight=="function"}getRowHeightForNode(e,n=!1,i){if(i==null&&(i=this.environment.getDefaultRowHeight()),this.isGetRowHeightFunction()){if(n)return{height:i,estimated:!0};const o={node:e,data:e.data},c=this.getCallback("getRowHeight")(o);if(this.isNumeric(c))return c===0&&Tn("The return of `getRowHeight` cannot be zero. If the intention is to hide rows, use a filter instead."),{height:Math.max(1,c),estimated:!1}}return e.detail&&this.get("masterDetail")?this.getMasterDetailRowHeight():{height:this.gridOptions.rowHeight&&this.isNumeric(this.gridOptions.rowHeight)?this.gridOptions.rowHeight:i,estimated:!1}}getMasterDetailRowHeight(){return this.get("detailRowAutoHeight")?{height:1,estimated:!1}:this.isNumeric(this.gridOptions.detailRowHeight)?{height:this.gridOptions.detailRowHeight,estimated:!1}:{height:300,estimated:!1}}getRowHeightAsNumber(){if(!this.gridOptions.rowHeight||Hr(this.gridOptions.rowHeight))return this.environment.getDefaultRowHeight();const e=this.environment.refreshRowHeightVariable();return e!==-1?e:(Tn("row height must be a number if not using standard row model"),this.environment.getDefaultRowHeight())}isNumeric(e){return!isNaN(e)&&typeof e=="number"&&isFinite(e)}getDomDataKey(){return this.domDataKey}getDomData(e,n){const i=e[this.getDomDataKey()];return i?i[n]:void 0}setDomData(e,n,i){const r=this.getDomDataKey();let o=e[r];Hr(o)&&(o={},e[r]=o),o[n]=i}getDocument(){let e=null;return this.gridOptions.getDocument&&$n(this.gridOptions.getDocument)?e=this.gridOptions.getDocument():this.eGridDiv&&(e=this.eGridDiv.ownerDocument),e&&$n(e)?e:document}getWindow(){return this.getDocument().defaultView||window}getRootNode(){return this.eGridDiv.getRootNode()}getActiveDomElement(){return this.getRootNode().activeElement}getAsyncTransactionWaitMillis(){return $n(this.gridOptions.asyncTransactionWaitMillis)?this.gridOptions.asyncTransactionWaitMillis:50}isAnimateRows(){return this.get("ensureDomOrder")?!1:this.get("animateRows")}isGroupRowsSticky(){return!(this.get("paginateChildRows")||this.get("groupHideOpenParents")||this.isDomLayout("print"))}isColumnsSortingCoupledToGroup(){const e=this.gridOptions.autoGroupColumnDef;return!(e!=null&&e.comparator)&&!this.get("treeData")}getGroupAggFiltering(){const e=this.gridOptions.groupAggFiltering;if(typeof e=="function")return this.getCallback("groupAggFiltering");if(e===!0)return()=>!0}getGrandTotalRow(){const e=this.gridOptions.grandTotalRow;if(e)return e;if(this.gridOptions.groupIncludeTotalFooter)return"bottom"}getGroupTotalRowCallback(){const e=this.get("groupTotalRow");if(typeof e=="function")return this.getCallback("groupTotalRow");if(e)return()=>e;const n=this.get("groupIncludeFooter");if(typeof n=="function"){const i=this.getCallback("groupIncludeFooter");return r=>i(r)?"bottom":void 0}return()=>n?"bottom":void 0}isGroupMultiAutoColumn(){return this.gridOptions.groupDisplayType?this.gridOptions.groupDisplayType==="multipleColumns":this.get("groupHideOpenParents")}isGroupUseEntireRow(e){return e?!1:this.gridOptions.groupDisplayType==="groupRows"}getGridCommonParams(){return{api:this.api,context:this.gridOptionsContext}}addGridCommonParams(e){const n=e;return n.api=this.api,n.context=this.gridOptionsContext,n}getRowIdCallback(){const e=this.getCallback("getRowId");return e===void 0?e:n=>{let i=e(n);return typeof i!="string"&&(Tn("The getRowId callback must return a string. The ID ",i," is being cast to a string."),i=String(i)),i}}};Eq.changeSetId=0;var fye=Eq,pye=class extends wn{constructor(){super(...arguments),this.beanName="headerPositionUtils"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService}findHeader(t,e){let n,i;if(oa(t.column)?n=this.visibleColsService.getGroupAtDirection(t.column,e):(i=`getCol${e}`,n=this.visibleColsService[i](t.column)),!n)return;const{headerRowIndex:r}=t;if(this.getHeaderRowType(r)!=="filter"){const s=[n];for(;n.getParent();)n=n.getParent(),s.push(n);n=s[s.length-1-r]}const{column:o,headerRowIndex:c}=this.getHeaderIndexToFocus(n,r);return{column:o,headerRowIndex:c}}getHeaderIndexToFocus(t,e){let n;if(oa(t)&&this.isAnyChildSpanningHeaderHeight(t)&&t.isPadding()){const i=t;n=i.getLeafColumns()[0];let r=n;for(;r!==i;)e++,r=r.getParent()}return{column:n||t,headerRowIndex:e}}isAnyChildSpanningHeaderHeight(t){return t?t.getLeafColumns().some(e=>e.isSpanHeaderHeight()):!1}getColumnVisibleParent(t,e){const n=this.getHeaderRowType(e),i=n==="filter",r=n==="column";let o=i?t:t.getParent(),c=e-1,s=c;if(r&&this.isAnyChildSpanningHeaderHeight(t.getParent())){for(;o&&o.isPadding();)o=o.getParent(),c--;s=c,c<0&&(o=t,c=e,s=void 0)}return{column:o,headerRowIndex:c,headerRowIndexWithoutSpan:s}}getColumnVisibleChild(t,e,n="After"){const i=this.getHeaderRowType(e);let r=t,o=e+1;const c=o;if(i==="group"){const s=t.getDisplayedLeafColumns(),f=n==="After"?s[0]:Yr(s),v=[];let w=f;for(;w.getParent()!==t;)w=w.getParent(),v.push(w);if(r=f,f.isSpanHeaderHeight())for(let C=v.length-1;C>=0;C--){const M=v[C];if(!M.isPadding()){r=M;break}o++}else r=Yr(v),r||(r=f)}return{column:r,headerRowIndex:o,headerRowIndexWithoutSpan:c}}getHeaderRowType(t){const e=this.ctrlsService.getHeaderRowContainerCtrl();if(e)return e.getRowType(t)}findColAtEdgeForHeaderRow(t,e){const n=this.visibleColsService.getAllCols(),i=n[e==="start"?0:n.length-1];if(!i)return;const o=this.ctrlsService.getHeaderRowContainerCtrl(i.getPinned()).getRowType(t);if(o=="group"){const c=this.visibleColsService.getColGroupAtLevel(i,t);return{headerRowIndex:t,column:c}}return{headerRowIndex:o==null?-1:t,column:i}}},mye=class extends wn{constructor(){super(...arguments),this.beanName="localeService"}getLocaleTextFunc(){const t=this.gos.getCallback("getLocaleText");if(t)return(n,i,r)=>t({key:n,defaultValue:i,variableValues:r});const e=this.gos.get("localeText");return(n,i,r)=>{let o=e&&e[n];if(o&&r&&r.length){let c=0;for(;!(c>=r.length||o.indexOf("${variable}")===-1);)o=o.replace("${variable}",r[c++])}return o??i}}},gye=class extends wn{constructor(){super(...arguments),this.beanName="apiEventService",this.syncEventListeners=new Map,this.asyncEventListeners=new Map,this.syncGlobalEventListeners=new Set,this.globalEventListenerPairs=new Map}postConstruct(){this.frameworkEventWrappingService=new f3(this.getFrameworkOverrides())}addEventListener(t,e){const n=this.frameworkEventWrappingService.wrap(e),i=this.gos.useAsyncEvents()&&!cR.has(t),r=i?this.asyncEventListeners:this.syncEventListeners;r.has(t)||r.set(t,new Set),r.get(t).add(n),this.eventService.addEventListener(t,n,i)}removeEventListener(t,e){var o;const n=this.frameworkEventWrappingService.unwrap(e),i=this.asyncEventListeners.get(t),r=!!(i!=null&&i.delete(n));r||(o=this.syncEventListeners.get(t))==null||o.delete(n),this.eventService.removeEventListener(t,n,r)}addGlobalListener(t){const e=this.frameworkEventWrappingService.wrapGlobal(t);if(this.gos.useAsyncEvents()){const i=(o,c)=>{cR.has(o)&&e(o,c)},r=(o,c)=>{cR.has(o)||e(o,c)};this.globalEventListenerPairs.set(t,{syncListener:i,asyncListener:r}),this.eventService.addGlobalListener(i,!1),this.eventService.addGlobalListener(r,!0)}else this.syncGlobalEventListeners.add(e),this.eventService.addGlobalListener(e,!1)}removeGlobalListener(t){const e=this.frameworkEventWrappingService.unwrapGlobal(t);if(this.globalEventListenerPairs.has(e)){const{syncListener:i,asyncListener:r}=this.globalEventListenerPairs.get(e);this.eventService.removeGlobalListener(i,!1),this.eventService.removeGlobalListener(r,!0),this.globalEventListenerPairs.delete(t)}else this.syncGlobalEventListeners.delete(e),this.eventService.removeGlobalListener(e,!1)}destroyEventListeners(t,e){t.forEach((n,i)=>{n.forEach(r=>this.eventService.removeEventListener(i,r,e)),n.clear()}),t.clear()}destroyGlobalListeners(t,e){t.forEach(n=>this.eventService.removeGlobalListener(n,e)),t.clear()}destroy(){super.destroy(),this.destroyEventListeners(this.syncEventListeners,!1),this.destroyEventListeners(this.asyncEventListeners,!0),this.destroyGlobalListeners(this.syncGlobalEventListeners,!1),this.globalEventListenerPairs.forEach(({syncListener:t,asyncListener:e})=>{this.eventService.removeGlobalListener(t,!1),this.eventService.removeGlobalListener(e,!0)}),this.globalEventListenerPairs.clear()}},vye=class extends wn{constructor(){super(...arguments),this.beanName="pageBoundsListener"}wireBeans(t){this.rowModel=t.rowModel,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.addManagedEventListeners({modelUpdated:this.onModelUpdated.bind(this),recalculateRowBounds:this.calculatePages.bind(this)}),this.onModelUpdated()}onModelUpdated(t){this.calculatePages();const e={type:"paginationChanged",animate:t?t.animate:!1,newData:t?t.newData:!1,newPage:t?t.newPage:!1,newPageSize:t?t.newPageSize:!1,keepRenderedRows:t?t.keepRenderedRows:!1};this.eventService.dispatchEvent(e)}calculatePages(){this.paginationService?this.paginationService.calculatePages():this.pageBoundsService.calculateBounds(0,this.rowModel.getRowCount()-1)}},yye=class extends wn{constructor(){super(...arguments),this.beanName="pageBoundsService",this.pixelOffset=0}wireBeans(t){this.rowModel=t.rowModel}getFirstRow(){return this.topRowBounds?this.topRowBounds.rowIndex:-1}getLastRow(){return this.bottomRowBounds?this.bottomRowBounds.rowIndex:-1}getCurrentPageHeight(){return Hr(this.topRowBounds)||Hr(this.bottomRowBounds)?0:Math.max(this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight-this.topRowBounds.rowTop,0)}getCurrentPagePixelRange(){const t=this.topRowBounds?this.topRowBounds.rowTop:0,e=this.bottomRowBounds?this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight:0;return{pageFirstPixel:t,pageLastPixel:e}}calculateBounds(t,e){this.topRowBounds=this.rowModel.getRowBounds(t),this.topRowBounds&&(this.topRowBounds.rowIndex=t),this.bottomRowBounds=this.rowModel.getRowBounds(e),this.bottomRowBounds&&(this.bottomRowBounds.rowIndex=e),this.calculatePixelOffset()}getPixelOffset(){return this.pixelOffset}calculatePixelOffset(){const t=$n(this.topRowBounds)?this.topRowBounds.rowTop:0;this.pixelOffset!==t&&(this.pixelOffset=t,this.eventService.dispatchEvent({type:"paginationPixelOffsetChanged"}))}},_ye=class extends wn{constructor(){super(),this.beanName="ariaAnnouncementService",this.descriptionContainer=null,this.announceValue=Kl(this.announceValue.bind(this),200)}wireBeans(t){this.eGridDiv=t.eGridDiv}postConstruct(){const t=this.gos.getDocument(),e=this.descriptionContainer=t.createElement("div");e.classList.add("ag-aria-description-container"),s7(e,"polite"),$ce(e,"additions text"),jce(e,!0),this.eGridDiv.appendChild(e)}announceValue(t){this.descriptionContainer&&(this.descriptionContainer.textContent="",setTimeout(()=>{this.isAlive()&&this.descriptionContainer&&(this.descriptionContainer.textContent=t)},50))}destroy(){super.destroy();const{descriptionContainer:t}=this;t&&(Cu(t),t.parentElement&&t.parentElement.removeChild(t)),this.descriptionContainer=null,this.eGridDiv=null}},xye=class extends wn{constructor(){super(...arguments),this.beanName="columnAnimationService",this.executeNextFuncs=[],this.executeLaterFuncs=[],this.active=!1,this.suppressAnimation=!1,this.animationThreadCount=0}wireBeans(t){this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(t=>this.gridBodyCtrl=t.gridBodyCtrl)}isActive(){return this.active&&!this.suppressAnimation}setSuppressAnimation(t){this.suppressAnimation=t}start(){this.active||this.gos.get("suppressColumnMoveAnimation")||this.gos.get("enableRtl")||(this.ensureAnimationCssClassPresent(),this.active=!0)}finish(){this.active&&this.flush(()=>{this.active=!1})}executeNextVMTurn(t){this.active?this.executeNextFuncs.push(t):t()}executeLaterVMTurn(t){this.active?this.executeLaterFuncs.push(t):t()}ensureAnimationCssClassPresent(){this.animationThreadCount++;const t=this.animationThreadCount;this.gridBodyCtrl.setColumnMovingCss(!0),this.executeLaterFuncs.push(()=>{this.animationThreadCount===t&&this.gridBodyCtrl.setColumnMovingCss(!1)})}flush(t){if(this.executeNextFuncs.length===0&&this.executeLaterFuncs.length===0){t();return}const e=n=>{for(;n.length;){const i=n.pop();i&&i()}};this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>e(this.executeNextFuncs),0),window.setTimeout(()=>{t(),e(this.executeLaterFuncs)},200)})}},wye=class extends wn{constructor(){super(...arguments),this.beanName="columnHoverService"}setMouseOver(t){this.selectedColumns=t;const e={type:"columnHoverChanged"};this.eventService.dispatchEvent(e)}clearMouseOver(){this.selectedColumns=null;const t={type:"columnHoverChanged"};this.eventService.dispatchEvent(t)}isHovered(t){return!!this.selectedColumns&&this.selectedColumns.indexOf(t)>=0}},Cye=class extends wn{constructor(){super(...arguments),this.beanName="overlayService",this.state=0,this.showInitialOverlay=!0}wireBeans(t){this.userComponentFactory=t.userComponentFactory,this.rowModel=t.rowModel,this.columnModel=t.columnModel}postConstruct(){const t=()=>this.updateOverlayVisibility();this.addManagedEventListeners({newColumnsLoaded:t,rowDataUpdated:t}),this.addManagedPropertyListener("loading",t)}registerOverlayWrapperComp(t){this.overlayWrapperComp=t,this.updateOverlayVisibility()}showLoadingOverlay(){this.showInitialOverlay=!1;const t=this.gos.get("loading");!t&&(t!==void 0||this.gos.get("suppressLoadingOverlay"))||this.doShowLoadingOverlay()}showNoRowsOverlay(){this.showInitialOverlay=!1,!(this.gos.get("loading")||this.gos.get("suppressNoRowsOverlay"))&&this.doShowNoRowsOverlay()}hideOverlay(){this.showInitialOverlay=!1,!this.gos.get("loading")&&this.doHideOverlay()}updateOverlayVisibility(){let t=this.gos.get("loading");this.showInitialOverlay&&t===void 0&&!this.gos.get("suppressLoadingOverlay")&&(t=!this.gos.get("columnDefs")||!this.columnModel.isReady()||!this.gos.get("rowData")&&this.gos.isRowModelType("clientSide")),t?this.state!==1&&this.doShowLoadingOverlay():(this.showInitialOverlay=!1,this.rowModel.isEmpty()&&!this.gos.get("suppressNoRowsOverlay")&&this.gos.isRowModelType("clientSide")?this.state!==2&&this.doShowNoRowsOverlay():this.state!==0&&this.doHideOverlay())}doShowLoadingOverlay(){this.state=1,this.showOverlay(this.userComponentFactory.getLoadingOverlayCompDetails({}),"ag-overlay-loading-wrapper","loadingOverlayComponentParams")}doShowNoRowsOverlay(){this.state=2,this.showOverlay(this.userComponentFactory.getNoRowsOverlayCompDetails({}),"ag-overlay-no-rows-wrapper","noRowsOverlayComponentParams")}doHideOverlay(){this.state=0,this.overlayWrapperComp.hideOverlay()}showOverlay(t,e,n){const i=t.newAgStackInstance();this.overlayWrapperComp.showOverlay(i,e,n)}},Sye=class extends wn{constructor(){super(...arguments),this.beanName="rowCssClassCalculator"}wireBeans(t){this.stylingService=t.stylingService}getInitialRowClasses(t){const e=[];return $n(t.extraCssClass)&&e.push(t.extraCssClass),e.push("ag-row"),e.push(t.rowFocused?"ag-row-focus":"ag-row-no-focus"),t.fadeRowIn&&e.push("ag-opacity-zero"),e.push(t.rowIsEven?"ag-row-even":"ag-row-odd"),t.rowNode.isRowPinned()&&e.push("ag-row-pinned"),t.rowNode.isSelected()&&e.push("ag-row-selected"),t.rowNode.footer&&e.push("ag-row-footer"),e.push("ag-row-level-"+t.rowLevel),t.rowNode.stub&&e.push("ag-row-loading"),t.fullWidthRow&&e.push("ag-full-width-row"),t.expandable&&(e.push("ag-row-group"),e.push(t.rowNode.expanded?"ag-row-group-expanded":"ag-row-group-contracted")),t.rowNode.dragging&&e.push("ag-row-dragging"),B5(e,this.processClassesFromGridOptions(t.rowNode)),B5(e,this.preProcessRowClassRules(t.rowNode)),e.push(t.printLayout?"ag-row-position-relative":"ag-row-position-absolute"),t.firstRowOnPage&&e.push("ag-row-first"),t.lastRowOnPage&&e.push("ag-row-last"),t.fullWidthRow&&(t.pinned==="left"&&e.push("ag-cell-last-left-pinned"),t.pinned==="right"&&e.push("ag-cell-first-right-pinned")),e}processClassesFromGridOptions(t){const e=[],n=o=>{typeof o=="string"?e.push(o):Array.isArray(o)&&o.forEach(c=>e.push(c))},i=this.gos.get("rowClass");if(i){if(typeof i=="function")return Tn("rowClass should not be a function, please use getRowClass instead"),[];n(i)}const r=this.gos.getCallback("getRowClass");if(r){const o={data:t.data,node:t,rowIndex:t.rowIndex},c=r(o);n(c)}return e}preProcessRowClassRules(t){const e=[];return this.processRowClassRules(t,n=>{e.push(n)},()=>{}),e}processRowClassRules(t,e,n){const i=this.gos.addGridCommonParams({data:t.data,node:t,rowIndex:t.rowIndex});this.stylingService.processClassRules(void 0,this.gos.get("rowClassRules"),i,e,n)}calculateRowLevel(t){return t.group?t.level:t.parent?t.parent.level+1:0}},bye=class extends wn{constructor(){super(...arguments),this.beanName="rowContainerHeightService",this.scrollY=0,this.uiBodyHeight=0}wireBeans(t){this.ctrlsService=t.ctrlsService}postConstruct(){this.addManagedEventListeners({bodyHeightChanged:this.updateOffset.bind(this)}),this.maxDivHeight=iue(),this.gos.get("debug")&&nd("RowContainerHeightService - maxDivHeight = "+this.maxDivHeight)}isStretching(){return this.stretching}getDivStretchOffset(){return this.divStretchOffset}updateOffset(){if(!this.stretching)return;const e=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition().top,n=this.getUiBodyHeight();(e!==this.scrollY||n!==this.uiBodyHeight)&&(this.scrollY=e,this.uiBodyHeight=n,this.calculateOffset())}calculateOffset(){this.setUiContainerHeight(this.maxDivHeight),this.pixelsToShave=this.modelHeight-this.uiContainerHeight,this.maxScrollY=this.uiContainerHeight-this.uiBodyHeight;const t=this.scrollY/this.maxScrollY,e=t*this.pixelsToShave;this.gos.get("debug")&&nd(`RowContainerHeightService - Div Stretch Offset = ${e} (${this.pixelsToShave} * ${t})`),this.setDivStretchOffset(e)}setUiContainerHeight(t){t!==this.uiContainerHeight&&(this.uiContainerHeight=t,this.eventService.dispatchEvent({type:"rowContainerHeightChanged"}))}clearOffset(){this.setUiContainerHeight(this.modelHeight),this.pixelsToShave=0,this.setDivStretchOffset(0)}setDivStretchOffset(t){const e=typeof t=="number"?Math.floor(t):null;this.divStretchOffset!==e&&(this.divStretchOffset=e,this.eventService.dispatchEvent({type:"heightScaleChanged"}))}setModelHeight(t){this.modelHeight=t,this.stretching=t!=null&&this.maxDivHeight>0&&t>this.maxDivHeight,this.stretching?this.calculateOffset():this.clearOffset()}getUiContainerHeight(){return this.uiContainerHeight}getRealPixelPosition(t){return t-this.divStretchOffset}getUiBodyHeight(){const e=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition();return e.bottom-e.top}getScrollPositionForPixel(t){if(this.pixelsToShave<=0)return t;const e=this.modelHeight-this.getUiBodyHeight(),n=t/e;return this.maxScrollY*n}},Eye=class extends wn{constructor(){super(...arguments),this.beanName="rowNodeSorter"}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.showRowGroupColsService=t.showRowGroupColsService}postConstruct(){this.isAccentedSort=this.gos.get("accentedSort"),this.primaryColumnsSortGroups=this.gos.isColumnsSortingCoupledToGroup(),this.addManagedPropertyListener("accentedSort",t=>this.isAccentedSort=t.currentValue),this.addManagedPropertyListener("autoGroupColumnDef",()=>this.primaryColumnsSortGroups=this.gos.isColumnsSortingCoupledToGroup())}doFullSort(t,e){const n=(r,o)=>({currentPos:o,rowNode:r}),i=t.map(n);return i.sort(this.compareRowNodes.bind(this,e)),i.map(r=>r.rowNode)}compareRowNodes(t,e,n){const i=e.rowNode,r=n.rowNode;for(let o=0,c=t.length;o<c;o++){const s=t[o],f=s.sort==="desc",v=this.getValue(i,s.column),w=this.getValue(r,s.column);let C;const M=this.getComparator(s,i);if(M?C=M(v,w,i,r,f):C=pce(v,w,this.isAccentedSort),!isNaN(C)&&C!==0)return s.sort==="asc"?C:C*-1}return e.currentPos-n.currentPos}getComparator(t,e){const n=t.column,i=n.getColDef().comparator;if(i!=null)return i;if(!n.getColDef().showRowGroup)return;const r=!e.group&&n.getColDef().field;if(!r)return;const o=this.columnModel.getColDefCol(r);if(o)return o.getColDef().comparator}getValue(t,e){var i,r,o;if(!this.primaryColumnsSortGroups)return this.valueService.getValue(e,t,!1,!1);if(t.rowGroupColumn===e){if(this.gos.isGroupUseEntireRow(this.columnModel.isPivotActive())){const f=(i=t.allLeafChildren)==null?void 0:i[0];return f?this.valueService.getValue(e,f,!1,!1):void 0}const s=(r=this.showRowGroupColsService)==null?void 0:r.getShowRowGroupCol(e.getId());return s?(o=t.groupData)==null?void 0:o[s.getId()]:void 0}if(!(t.group&&e.getColDef().showRowGroup))return this.valueService.getValue(e,t,!1,!1)}},OA=class{constructor(t,e){this.active=!0,this.nodeIdsToColumns={},this.mapToItems={},this.keepingColumns=t,this.pathRoot={rowNode:e,children:null},this.mapToItems[e.id]=this.pathRoot}setInactive(){this.active=!1}isActive(){return this.active}depthFirstSearchChangedPath(t,e){if(t.children)for(let n=0;n<t.children.length;n++)this.depthFirstSearchChangedPath(t.children[n],e);e(t.rowNode)}depthFirstSearchEverything(t,e,n){if(t.childrenAfterGroup)for(let i=0;i<t.childrenAfterGroup.length;i++){const r=t.childrenAfterGroup[i];r.childrenAfterGroup?this.depthFirstSearchEverything(t.childrenAfterGroup[i],e,n):n&&e(r)}e(t)}forEachChangedNodeDepthFirst(t,e=!1,n=!1){this.active&&!n?this.depthFirstSearchChangedPath(this.pathRoot,t):this.depthFirstSearchEverything(this.pathRoot.rowNode,t,e)}executeFromRootNode(t){t(this.pathRoot.rowNode)}createPathItems(t){let e=t,n=0;for(;!this.mapToItems[e.id];){const i={rowNode:e,children:null};this.mapToItems[e.id]=i,n++,e=e.parent}return n}populateColumnsMap(t,e){if(!this.keepingColumns||!e)return;let n=t;for(;n;)this.nodeIdsToColumns[n.id]||(this.nodeIdsToColumns[n.id]={}),e.forEach(i=>this.nodeIdsToColumns[n.id][i.getId()]=!0),n=n.parent}linkPathItems(t,e){let n=t;for(let i=0;i<e;i++){const r=this.mapToItems[n.id],o=this.mapToItems[n.parent.id];o.children||(o.children=[]),o.children.push(r),n=n.parent}}addParentNode(t,e){if(!t||t.isRowPinned())return;const n=this.createPathItems(t);this.linkPathItems(t,n),this.populateColumnsMap(t,e)}canSkip(t){return this.active&&!this.mapToItems[t.id]}getValueColumnsForNode(t,e){if(!this.keepingColumns)return e;const n=this.nodeIdsToColumns[t.id];return e.filter(r=>n[r.getId()])}getNotValueColumnsForNode(t,e){if(!this.keepingColumns)return null;const n=this.nodeIdsToColumns[t.id];return e.filter(r=>!n[r.getId()])}},Rq=class extends wn{constructor(){super(...arguments),this.beanName="selectionService",this.selectedNodes=new Map,this.selectionCtx=new Ape}wireBeans(t){this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.selectionCtx.init(this.rowModel),this.rowSelection=this.gos.get("rowSelection"),this.groupSelectsChildren=this.gos.get("groupSelectsChildren"),this.addManagedPropertyListeners(["groupSelectsChildren","rowSelection"],()=>{this.groupSelectsChildren=this.gos.get("groupSelectsChildren"),this.rowSelection=this.gos.get("rowSelection"),this.deselectAllRowNodes({source:"api"})}),this.addManagedEventListeners({rowSelected:this.onRowSelected.bind(this)})}destroy(){super.destroy(),this.resetNodes(),this.selectionCtx.reset()}isMultiselect(){return this.rowSelection==="multiple"}overrideSelectionValue(t,e){if(!uye(e))return t;const n=this.selectionCtx.getRoot();return n?n.isSelected()??!1:!0}setNodesSelected(t){var C;const{newValue:e,clearSelection:n,suppressFinishActions:i,rangeSelect:r,nodes:o,event:c,source:s}=t;if(o.length===0)return 0;if(o.length>1&&!this.isMultiselect())return Tn("cannot multi select while rowSelection='single'"),0;const f=this.groupSelectsChildren&&t.groupSelectsFiltered===!0,v=o.map(M=>M.footer?M.sibling:M);if(r){if(v.length>1)return Tn("cannot range select while selecting multiple rows"),0;const M=v[0],F=this.overrideSelectionValue(e,s);if(this.isMultiselect()){if(this.selectionCtx.isInRange(M)){const N=this.selectionCtx.truncate(M);return F&&this.selectRange(N.discard,!1,s),this.selectRange(N.keep,F,s)}else if(this.selectionCtx.getRoot()!==M){const L=this.selectionCtx.extend(M,this.groupSelectsChildren);return F&&this.selectRange(L.discard,!1,s),this.selectRange(L.keep,F,s)}}}i||this.selectionCtx.setRoot(v[0]);let w=0;for(let M=0;M<v.length;M++){const F=v[M];f&&F.group||F.selectThisNode(e,c,s)&&w++,this.groupSelectsChildren&&((C=F.childrenAfterGroup)!=null&&C.length)&&(w+=this.selectChildren(F,e,f,s))}return i||(e&&(n||!this.isMultiselect())&&(w+=this.clearOtherNodes(v[0],s)),w>0&&(this.updateGroupsFromChildrenSelections(s),this.dispatchSelectionChanged(s))),w}selectRange(t,e,n){let i=0;return t.forEach(r=>{if(r.group&&this.groupSelectsChildren)return;r.selectThisNode(e,void 0,n)&&i++}),i>0&&(this.updateGroupsFromChildrenSelections(n),this.dispatchSelectionChanged(n)),i}selectChildren(t,e,n,i){const r=n?t.childrenAfterAggFilter:t.childrenAfterGroup;return Hr(r)?0:this.setNodesSelected({newValue:e,clearSelection:!1,suppressFinishActions:!0,groupSelectsFiltered:n,source:i,nodes:r})}getSelectedNodes(){const t=[];return this.selectedNodes.forEach(e=>{e&&t.push(e)}),t}getSelectedRows(){const t=[];return this.selectedNodes.forEach(e=>{e&&e.data&&t.push(e.data)}),t}getSelectionCount(){return this.selectedNodes.size}filterFromSelection(t){const e=new Map;this.selectedNodes.forEach((n,i)=>{n&&t(n)&&e.set(i,n)}),this.selectedNodes=e}updateGroupsFromChildrenSelections(t,e){if(!this.groupSelectsChildren||this.rowModel.getType()!=="clientSide")return!1;const i=this.rowModel.getRootNode();e||(e=new OA(!0,i),e.setInactive());let r=!1;return e.forEachChangedNodeDepthFirst(o=>{if(o!==i){const c=o.calculateSelectedFromChildren();r=o.selectThisNode(c===null?!1:c,void 0,t)||r}}),r}clearOtherNodes(t,e){const n=new Map;let i=0;return this.selectedNodes.forEach(r=>{if(r&&r.id!==t.id){const o=this.selectedNodes.get(r.id);i+=o.setSelectedParams({newValue:!1,clearSelection:!1,suppressFinishActions:!0,source:e}),this.groupSelectsChildren&&r.parent&&n.set(r.parent.id,r.parent)}}),n.forEach(r=>{const o=r.calculateSelectedFromChildren();r.selectThisNode(o===null?!1:o,void 0,e)}),i}onRowSelected(t){const e=t.node;this.groupSelectsChildren&&e.group||(e.isSelected()?this.selectedNodes.set(e.id,e):this.selectedNodes.delete(e.id))}syncInRowNode(t,e){this.syncInOldRowNode(t,e),this.syncInNewRowNode(t)}syncInOldRowNode(t,e){if($n(e)&&t.id!==e.id&&e){const i=e.id;this.selectedNodes.get(i)==t&&this.selectedNodes.set(e.id,e)}}syncInNewRowNode(t){this.selectedNodes.has(t.id)?(t.setSelectedInitialValue(!0),this.selectedNodes.set(t.id,t)):t.setSelectedInitialValue(!1)}reset(t){const e=this.getSelectionCount();this.resetNodes(),e&&this.dispatchSelectionChanged(t)}resetNodes(){var t;(t=this.selectedNodes)==null||t.clear()}getBestCostNodeSelection(){if(this.rowModel.getType()!=="clientSide")return;const e=this.rowModel.getTopLevelNodes();if(e===null)return;const n=[];function i(r){for(let o=0,c=r.length;o<c;o++){const s=r[o];if(s.isSelected())n.push(s);else{const f=s;f.group&&f.children&&i(f.children)}}}return i(e),n}isEmpty(){let t=0;return this.selectedNodes.forEach(e=>{e&&t++}),t===0}deselectAllRowNodes(t){const e=c=>c.selectThisNode(!1,void 0,i),n=this.rowModel.getType()==="clientSide",{source:i,justFiltered:r,justCurrentPage:o}=t;if(o||r){if(!n){_s("selecting just filtered only works when gridOptions.rowModelType='clientSide'");return}this.getNodesToSelect(r,o).forEach(e)}else this.selectedNodes.forEach(c=>{c&&e(c)}),this.reset(i);this.selectionCtx.reset(),n&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(i),this.dispatchSelectionChanged(i)}getSelectedCounts(t,e){let n=0,i=0;const r=o=>{this.groupSelectsChildren&&o.group||(o.isSelected()?n++:o.selectable&&i++)};return this.getNodesToSelect(t,e).forEach(r),{selectedCount:n,notSelectedCount:i}}getSelectAllState(t,e){const{selectedCount:n,notSelectedCount:i}=this.getSelectedCounts(t,e);return n===0&&i===0?!1:n>0&&i>0?null:n>0}hasNodesToSelect(t=!1,e=!1){return this.getNodesToSelect(t,e).filter(n=>n.selectable).length>0}getNodesToSelect(t=!1,e=!1){if(this.rowModel.getType()!=="clientSide")throw new Error(`selectAll only available when rowModelType='clientSide', ie not ${this.rowModel.getType()}`);const n=[];if(e)return this.forEachNodeOnPage(r=>{if(!r.group){n.push(r);return}if(!r.expanded){const o=c=>{var s;n.push(c),(s=c.childrenAfterFilter)!=null&&s.length&&c.childrenAfterFilter.forEach(o)};o(r);return}this.groupSelectsChildren||n.push(r)}),n;const i=this.rowModel;return t?(i.forEachNodeAfterFilter(r=>{n.push(r)}),n):(i.forEachNode(r=>{n.push(r)}),n)}forEachNodeOnPage(t){const e=this.pageBoundsService.getFirstRow(),n=this.pageBoundsService.getLastRow();for(let i=e;i<=n;i++){const r=this.rowModel.getRow(i);r&&t(r)}}selectAllRowNodes(t){if(this.rowModel.getType()!=="clientSide")throw new Error(`selectAll only available when rowModelType='clientSide', ie not ${this.rowModel.getType()}`);const{source:e,justFiltered:n,justCurrentPage:i}=t,r=this.getNodesToSelect(n,i);r.forEach(o=>o.selectThisNode(!0,void 0,e)),this.selectionCtx.setRoot(r[0]??null),this.selectionCtx.setEndRange(Yr(r)??null),this.rowModel.getType()==="clientSide"&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(e),this.dispatchSelectionChanged(e)}getSelectionState(){const t=[];return this.selectedNodes.forEach(e=>{e!=null&&e.id&&t.push(e.id)}),t.length?t:null}setSelectionState(t,e){if(!Array.isArray(t))return;const n=new Set(t),i=[];this.rowModel.forEachNode(r=>{n.has(r.id)&&i.push(r)}),this.setNodesSelected({newValue:!0,nodes:i,source:e})}dispatchSelectionChanged(t){const e={type:"selectionChanged",source:t};this.eventService.dispatchEvent(e)}},Mye=class extends wn{constructor(){super(...arguments),this.beanName="selectableService"}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}postConstruct(){this.addManagedPropertyListener("isRowSelectable",()=>this.updateSelectable())}updateSelectableAfterGrouping(){this.updateSelectable(!0)}updateSelectable(t=!1){const e=!!this.gos.get("rowSelection"),n=this.gos.get("isRowSelectable");if(!e||!n)return;const i=this.gos.get("groupSelectsChildren"),r=this.rowModel.getType()==="clientSide"&&i,o=[],c=s=>{if(t&&!s.group)return;if(r&&s.group){const v=s.childrenAfterGroup.some(w=>w.selectable===!0);s.setRowSelectable(v,!0);return}const f=n?n(s):!0;s.setRowSelectable(f,!0),!f&&s.isSelected()&&o.push(s)};if(r){const s=this.rowModel;new OA(!1,s.getRootNode()).forEachChangedNodeDepthFirst(c,!0,!0)}else this.rowModel.forEachNode(c);o.length&&this.selectionService.setNodesSelected({nodes:o,newValue:!1,source:"selectableChanged"}),r&&this.selectionService instanceof Rq&&this.selectionService.updateGroupsFromChildrenSelections("selectableChanged")}},aH=["asc","desc",null],Rye=class extends wn{constructor(){super(...arguments),this.beanName="sortController"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.showRowGroupColsService=t.showRowGroupColsService}progressSort(t,e,n){const i=this.getNextSortDirection(t);this.setSortForColumn(t,i,e,n)}setSortForColumn(t,e,n,i){e!=="asc"&&e!=="desc"&&(e=null);const r=this.gos.isColumnsSortingCoupledToGroup();let o=[t];if(r&&t.getColDef().showRowGroup){const f=this.funcColsService.getSourceColumnsForGroupColumn(t),v=f==null?void 0:f.filter(w=>w.isSortable());v&&(o=[t,...v])}o.forEach(f=>f.setSort(e,i));const c=(n||this.gos.get("alwaysMultiSort"))&&!this.gos.get("suppressMultiSort"),s=[];if(!c){const f=this.clearSortBarTheseColumns(o,i);s.push(...f)}this.updateSortIndex(t),s.push(...o),this.dispatchSortChangedEvents(i,s)}updateSortIndex(t){var s;const e=this.gos.isColumnsSortingCoupledToGroup(),n=(s=this.showRowGroupColsService)==null?void 0:s.getShowRowGroupCol(t.getId()),i=e&&n||t,r=this.getColumnsWithSortingOrdered();this.columnModel.getAllCols().forEach(f=>f.setSortIndex(null));const o=r.filter(f=>e&&f.getColDef().showRowGroup?!1:f!==i);(i.getSort()?[...o,i]:o).forEach((f,v)=>{f.setSortIndex(v)})}onSortChanged(t,e){this.dispatchSortChangedEvents(t,e)}isSortActive(){const e=this.columnModel.getAllCols().filter(n=>!!n.getSort());return e&&e.length>0}dispatchSortChangedEvents(t,e){const n={type:"sortChanged",source:t};e&&(n.columns=e),this.eventService.dispatchEvent(n)}clearSortBarTheseColumns(t,e){const n=[];return this.columnModel.getAllCols().forEach(i=>{t.includes(i)||(i.getSort()&&n.push(i),i.setSort(void 0,e))}),n}getNextSortDirection(t){let e;if(t.getColDef().sortingOrder?e=t.getColDef().sortingOrder:this.gos.get("sortingOrder")?e=this.gos.get("sortingOrder"):e=aH,!Array.isArray(e)||e.length<=0)return Tn(`sortingOrder must be an array with at least one element, currently it's ${e}`),null;const n=e.indexOf(t.getSort()),i=n<0,r=n==e.length-1;let o;return i||r?o=e[0]:o=e[n+1],aH.indexOf(o)<0?(Tn("invalid sort type ",o),null):o}getIndexedSortMap(){let t=this.columnModel.getAllCols().filter(o=>!!o.getSort());if(this.columnModel.isPivotMode()){const o=this.gos.isColumnsSortingCoupledToGroup();t=t.filter(c=>{var w;const s=!!c.getAggFunc(),f=!c.isPrimary(),v=o?(w=this.showRowGroupColsService)==null?void 0:w.getShowRowGroupCol(c.getId()):c.getColDef().showRowGroup;return s||f||v})}const e=this.funcColsService.getRowGroupColumns().filter(o=>!!o.getSort()),n={};t.forEach((o,c)=>n[o.getId()]=c),t.sort((o,c)=>{const s=o.getSortIndex(),f=c.getSortIndex();if(s!=null&&f!=null)return s-f;if(s==null&&f==null){const v=n[o.getId()],w=n[c.getId()];return v>w?1:-1}else return f==null?-1:1});const i=this.gos.isColumnsSortingCoupledToGroup()&&!!e.length;i&&(t=[...new Set(t.map(o=>{var c;return((c=this.showRowGroupColsService)==null?void 0:c.getShowRowGroupCol(o.getId()))??o}))]);const r=new Map;return t.forEach((o,c)=>r.set(o,c)),i&&e.forEach(o=>{const c=this.showRowGroupColsService.getShowRowGroupCol(o.getId());r.set(o,r.get(c))}),r}getColumnsWithSortingOrdered(){return[...this.getIndexedSortMap().entries()].sort(([t,e],[n,i])=>e-i).map(([t])=>t)}getSortModel(){return this.getColumnsWithSortingOrdered().filter(t=>t.getSort()).map(t=>({sort:t.getSort(),colId:t.getId()}))}getSortOptions(){return this.getColumnsWithSortingOrdered().filter(t=>t.getSort()).map(t=>({sort:t.getSort(),column:t}))}canColumnDisplayMixedSort(t){const e=this.gos.isColumnsSortingCoupledToGroup(),n=!!t.getColDef().showRowGroup;return e&&n}getDisplaySortForColumn(t){const e=this.funcColsService.getSourceColumnsForGroupColumn(t);if(!this.canColumnDisplayMixedSort(t)||!(e!=null&&e.length))return t.getSort();const i=t.getColDef().field!=null||!!t.getColDef().valueGetter?[t,...e]:e,r=i[0].getSort();return i.every(c=>c.getSort()==r)?r:"mixed"}getDisplaySortIndexForColumn(t){return this.getIndexedSortMap().get(t)}},Tye=class extends wn{constructor(){super(...arguments),this.beanName="syncService",this.waitingForColumns=!1}wireBeans(t){this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.rowModel=t.rowModel}postConstruct(){this.addManagedPropertyListener("columnDefs",t=>this.setColumnDefs(t))}start(){this.ctrlsService.whenReady(()=>{const t=this.gos.get("columnDefs");t?this.setColumnsAndData(t):this.waitingForColumns=!0,this.gridReady()})}setColumnsAndData(t){this.columnModel.setColumnDefs(t??[],"gridInitializing"),this.rowModel.start()}gridReady(){this.dispatchGridReadyEvent();const t=xl.__isRegistered("@ag-grid-enterprise/core",this.gridId);this.gos.get("debug")&&nd(`initialised successfully, enterprise = ${t}`)}dispatchGridReadyEvent(){const t={type:"gridReady"};this.eventService.dispatchEvent(t)}setColumnDefs(t){const e=this.gos.get("columnDefs");if(e){if(this.waitingForColumns){this.waitingForColumns=!1,this.setColumnsAndData(e);return}this.columnModel.setColumnDefs(e,fx(t.source))}}},Aye="paste",Pye=class extends wn{constructor(){super(...arguments),this.beanName="changeDetectionService"}wireBeans(t){this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer}postConstruct(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel),this.addManagedEventListeners({cellValueChanged:this.onCellValueChanged.bind(this)})}onCellValueChanged(t){t.source!==Aye&&this.doChangeDetection(t.node,t.column)}doChangeDetection(t,e){if(this.gos.get("suppressChangeDetection"))return;const n=[t];if(this.clientSideRowModel&&!t.isRowPinned()){const i=this.gos.get("aggregateOnlyChangedColumns"),r=new OA(i,this.clientSideRowModel.getRootNode());r.addParentNode(t.parent,[e]),this.clientSideRowModel.doAggregate(r),r.forEachChangedNodeDepthFirst(o=>{n.push(o)})}this.rowRenderer.refreshCells({rowNodes:n})}},Iye=class extends wn{constructor(){super(...arguments),this.beanName="expressionService",this.expressionToFunctionCache={}}evaluate(t,e){if(typeof t=="string")return this.evaluateExpression(t,e);_s("value should be either a string or a function",t)}evaluateExpression(t,e){try{return this.createExpressionFunction(t)(e.value,e.context,e.oldValue,e.newValue,e.value,e.node,e.data,e.colDef,e.rowIndex,e.api,e.getValue,e.column,e.columnGroup)}catch(n){return nd("Processing of the expression failed"),nd("Expression = ",t),nd("Params = ",e),nd("Exception = ",n),null}}createExpressionFunction(t){if(this.expressionToFunctionCache[t])return this.expressionToFunctionCache[t];const e=this.createFunctionBody(t),n=new Function("x, ctx, oldValue, newValue, value, node, data, colDef, rowIndex, api, getValue, column, columnGroup",e);return this.expressionToFunctionCache[t]=n,n}createFunctionBody(t){return t.indexOf("return")>=0?t:"return "+t+";"}},Dye=class extends wn{constructor(){super(...arguments),this.beanName="valueCache",this.cacheVersion=0}postConstruct(){this.active=this.gos.get("valueCache"),this.neverExpires=this.gos.get("valueCacheNeverExpires")}onDataChanged(){this.neverExpires||this.expire()}expire(){this.cacheVersion++}setValue(t,e,n){this.active&&(t.__cacheVersion!==this.cacheVersion&&(t.__cacheVersion=this.cacheVersion,t.__cacheData={}),t.__cacheData[e]=n)}getValue(t,e){if(!(!this.active||t.__cacheVersion!==this.cacheVersion))return t.__cacheData[e]}},Fye=class extends wn{constructor(){super(...arguments),this.beanName="valueService",this.initialised=!1,this.isSsrm=!1}wireBeans(t){this.expressionService=t.expressionService,this.columnModel=t.columnModel,this.valueCache=t.valueCache,this.dataTypeService=t.dataTypeService}postConstruct(){this.initialised||this.init()}init(){this.isSsrm=this.gos.isRowModelType("serverSide"),this.cellExpressions=this.gos.get("enableCellExpressions"),this.isTreeData=this.gos.get("treeData"),this.initialised=!0;const t=n=>this.callColumnCellValueChangedHandler(n),e=this.gos.useAsyncEvents();this.eventService.addEventListener("cellValueChanged",t,e),this.addDestroyFunc(()=>this.eventService.removeEventListener("cellValueChanged",t,e)),this.addManagedPropertyListener("treeData",n=>this.isTreeData=n.currentValue)}getValue(t,e,n=!1,i=!1){if(this.initialised||this.init(),!e)return;const r=t.getColDef(),o=r.field,c=t.getColId(),s=e.data;let f;const v=e.groupData&&e.groupData[c]!==void 0,w=!i&&e.aggData&&e.aggData[c]!==void 0,C=this.isSsrm&&i&&!!t.getColDef().aggFunc,M=this.isSsrm&&e.footer&&e.field&&(t.getColDef().showRowGroup===!0||t.getColDef().showRowGroup===e.field);if(n&&r.filterValueGetter?f=this.executeFilterValueGetter(r.filterValueGetter,s,t,e):this.isTreeData&&w?f=e.aggData[c]:this.isTreeData&&r.valueGetter?f=this.executeValueGetter(r.valueGetter,s,t,e):this.isTreeData&&o&&s?f=w1(s,o,t.isFieldContainsDots()):v?f=e.groupData[c]:w?f=e.aggData[c]:r.valueGetter?f=this.executeValueGetter(r.valueGetter,s,t,e):M?f=w1(s,e.field,t.isFieldContainsDots()):o&&s&&!C&&(f=w1(s,o,t.isFieldContainsDots())),this.cellExpressions&&typeof f=="string"&&f.indexOf("=")===0){const F=f.substring(1);f=this.executeValueGetter(F,s,t,e)}if(f==null){const F=this.getOpenedGroup(e,t);if(F!=null)return F}return f}parseValue(t,e,n,i){const r=t.getColDef(),o=this.gos.addGridCommonParams({node:e,data:e==null?void 0:e.data,oldValue:i,newValue:n,colDef:r,column:t}),c=r.valueParser;return $n(c)?typeof c=="function"?c(o):this.expressionService.evaluate(c,o):n}formatValue(t,e,n,i,r=!0){let o=null,c;const s=t.getColDef();if(i?c=i:r&&(c=s.valueFormatter),c){const f=this.gos.addGridCommonParams({value:n,node:e,data:e?e.data:null,colDef:s,column:t});typeof c=="function"?o=c(f):o=this.expressionService.evaluate(c,f)}else if(s.refData)return s.refData[n]||"";return o==null&&Array.isArray(n)&&(o=n.join(", ")),o}getOpenedGroup(t,e){if(!this.gos.get("showOpenedGroup")||!e.getColDef().showRowGroup)return;const i=e.getColDef().showRowGroup;let r=t.parent;for(;r!=null;){if(r.rowGroupColumn&&(i===!0||i===r.rowGroupColumn.getColId()))return r.key;r=r.parent}}setValue(t,e,n,i){const r=this.columnModel.getColDefCol(e);if(!t||!r)return!1;Hr(t.data)&&(t.data={});const{field:o,valueSetter:c}=r.getColDef();if(Hr(o)&&Hr(c))return Tn("you need either field or valueSetter set on colDef for editing to work"),!1;if(this.dataTypeService&&!this.dataTypeService.checkType(r,n))return Tn("Data type of the new value does not match the cell data type of the column"),!1;const s=this.gos.addGridCommonParams({node:t,data:t.data,oldValue:this.getValue(r,t),newValue:n,colDef:r.getColDef(),column:r});s.newValue=n;let f;if($n(c)?typeof c=="function"?f=c(s):f=this.expressionService.evaluate(c,s):f=this.setValueUsingField(t.data,o,n,r.isFieldContainsDots()),f===void 0&&(f=!0),!f)return!1;t.resetQuickFilterAggregateText(),this.valueCache.onDataChanged(),s.newValue=this.getValue(r,t);const v={type:"cellValueChanged",event:null,rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:s.column,api:s.api,colDef:s.colDef,context:s.context,data:t.data,node:t,oldValue:s.oldValue,newValue:s.newValue,value:s.newValue,source:i};return this.eventService.dispatchEvent(v),!0}callColumnCellValueChangedHandler(t){const e=t.colDef.onCellValueChanged;typeof e=="function"&&this.getFrameworkOverrides().wrapOutgoing(()=>{e({node:t.node,data:t.data,oldValue:t.oldValue,newValue:t.newValue,colDef:t.colDef,column:t.column,api:t.api,context:t.context})})}setValueUsingField(t,e,n,i){if(!e)return!1;let r=!1;if(!i)r=t[e]===n,r||(t[e]=n);else{const o=e.split(".");let c=t;for(;o.length>0&&c;){const s=o.shift();o.length===0?(r=c[s]===n,r||(c[s]=n)):c=c[s]}}return!r}executeFilterValueGetter(t,e,n,i){const r=this.gos.addGridCommonParams({data:e,node:i,column:n,colDef:n.getColDef(),getValue:this.getValueCallback.bind(this,i)});return typeof t=="function"?t(r):this.expressionService.evaluate(t,r)}executeValueGetter(t,e,n,i){const r=n.getColId(),o=this.valueCache.getValue(i,r);if(o!==void 0)return o;const c=this.gos.addGridCommonParams({data:e,node:i,column:n,colDef:n.getColDef(),getValue:this.getValueCallback.bind(this,i)});let s;return typeof t=="function"?s=t(c):s=this.expressionService.evaluate(t,c),this.valueCache.setValue(i,r,s),s}getValueCallback(t,e){const n=this.columnModel.getColDefCol(e);return n?this.getValue(n,t):null}getKeyForNode(t,e){const n=this.getValue(t,e),i=t.getColDef().keyCreator;let r=n;if(i){const o=this.gos.addGridCommonParams({value:n,colDef:t.getColDef(),column:t,node:e,data:e.data});r=i(o)}return typeof r=="string"||r==null||(r=String(r),r==="[object Object]"&&Tn("a column you are grouping or pivoting by has objects as values. If you want to group by complex objects then either a) use a colDef.keyCreator (se AG Grid docs) or b) to toString() on the object to return a key")),r}},LL=class{};LL.gridOptions=void 0;var Lye=1,Oye=class{create(t,e,n,i,r){let o={};LL.gridOptions?(Xu(o,LL.gridOptions,!0,!0),o={...o,...e}):o=e;const c=dye(o),s=c.gridId??String(Lye++),f=this.getRegisteredModules(r,s),v=this.createBeansList(c.rowModelType,f,s),w=this.createProvidedBeans(t,c,r);if(!v){_s("Failed to create grid.");return}const C={providedBeanInstances:w,beanClasses:v,gridId:s,beanInitComparator:Kpe,beanDestroyComparator:Ype,derivedBeans:[Vpe]},M=new ehe(C);return this.registerModuleUserComponents(M,f),this.registerControllers(M,f),this.registerModuleApiFunctions(M,f),n(M),M.getBean("syncService").start(),i&&i(M),M.getBean("gridApi")}registerControllers(t,e){const n=t.getBean("ctrlsFactory");e.forEach(i=>{i.controllers&&i.controllers.forEach(r=>n.register(r))})}getRegisteredModules(t,e){const n=t?t.modules:null,i=xl.__getRegisteredModules(e),r=[],o={},c=(s,f,v)=>{(C=>{o[C.moduleName]||(o[C.moduleName]=!0,r.push(C),xl.__register(C,s,v))})(f),f.dependantModules&&f.dependantModules.forEach(C=>c(s,C,v))};return c(!!(n!=null&&n.length)||!xl.__isPackageBased(),Sq,void 0),n&&n.forEach(s=>c(!0,s,e)),i&&i.forEach(s=>c(!xl.__isPackageBased(),s,void 0)),r}registerModuleUserComponents(t,e){const n=this.extractModuleEntity(e,r=>r.userComponents?r.userComponents:[]),i=t.getBean("userComponentRegistry");n.forEach(r=>{i.registerDefaultComponent(r.name,r.classImp)})}registerModuleApiFunctions(t,e){const n=t.getBean("apiFunctionService");e.forEach(i=>{const r=i.apiFunctions??{};Object.keys(r).forEach(c=>{n==null||n.addFunction(c,r[c])})})}createProvidedBeans(t,e,n){let i=n?n.frameworkOverrides:null;Hr(i)&&(i=new gq);const r={gridOptions:e,eGridDiv:t,globalEventListener:n?n.globalEventListener:null,globalSyncEventListener:n?n.globalSyncEventListener:null,frameworkOverrides:i};return n&&n.providedBeanInstances&&Object.assign(r,n.providedBeanInstances),r}createBeansList(t="clientSide",e,n){const i=e.filter(f=>!f.rowModel||f.rowModel===t),r={clientSide:"@ag-grid-community/client-side-row-model",infinite:"@ag-grid-community/infinite-row-model",serverSide:"@ag-grid-enterprise/server-side-row-model",viewport:"@ag-grid-enterprise/viewport-row-model"};if(!r[t]){_s("Could not find row model for rowModelType = ",t);return}if(!xl.__assertRegistered(r[t],`rowModelType = '${t}'`,n))return;const o=[nme,eme,pye,cye,zpe,Oue,qpe,Zpe,Lfe,b7,bye,Ife,mye,Epe,she,Nce,sme,fye,Ope,Rq,bce,mde,yye,vye,Spe,Iye,Sce,Pfe,Dye,Fye,wpe,Dfe,nhe,ome,Afe,ime,Npe,Ppe,Tfe,Rye,wye,xye,Mye,Pye,Ofe,Gpe,Sye,Eye,Qpe,ame,tme,Jpe,Tye,Cye,kfe,gye,_ye,Nfe,Ace,Hpe,Pce,Rce,Wpe,jpe,kce,Tce,Lce,$pe,Oce],c=this.extractModuleEntity(i,f=>f.beans?f.beans:[]);o.push(...c);const s=[];return o.forEach(f=>{s.indexOf(f)<0&&s.push(f)}),s}extractModuleEntity(t,e){return[].concat(...t.map(e))}},Tq=class extends wn{constructor(){super(...arguments),this.beanName="rowModelHelperService"}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){const t=this.rowModel;switch(t.getType()){case"clientSide":this.clientSideRowModel=t;break;case"infinite":this.infiniteRowModel=t;break;case"serverSide":this.serverSideRowModel=t;break}}getClientSideRowModel(){return this.clientSideRowModel}getInfiniteRowModel(){return this.infiniteRowModel}getServerSideRowModel(){return this.serverSideRowModel}};function kye(t){t.expansionService.expandAll(!0)}function Nye(t){t.expansionService.expandAll(!1)}function Bye(t){var i,r;const e=(i=t.rowModelHelperService)==null?void 0:i.getClientSideRowModel(),n=(r=t.rowModelHelperService)==null?void 0:r.getServerSideRowModel();e?e.onRowHeightChanged():n&&n.onRowHeightChanged()}function zye(t,e,n){var o,c;const i=(o=t.rowModelHelperService)==null?void 0:o.getServerSideRowModel();if(i){if(t.funcColsService.isRowGroupEmpty()){i.setRowCount(e,n);return}_s("setRowCount cannot be used while using row grouping.");return}const r=(c=t.rowModelHelperService)==null?void 0:c.getInfiniteRowModel();if(r){r.setRowCount(e,n);return}}function Uye(t){var e;return((e=t.rowNodeBlockLoader)==null?void 0:e.getBlockState())??{}}var Vye={version:lr,moduleName:"@ag-grid-community/csrm-ssrm-shared-api",apiFunctions:{expandAll:kye,collapseAll:Nye,onRowHeightChanged:Bye}},Gye={version:lr,moduleName:"@ag-grid-community/ssrm-infinite-shared-api",apiFunctions:{setRowCount:zye,getCacheBlockState:Uye}},Hye=class{wrap(t,e,n=[],i){const r=this.createWrapper(t,i);return e.forEach(o=>{this.createMethod(r,o,!0)}),n.forEach(o=>{this.createMethod(r,o,!1)}),r}unwrap(t){return t}createMethod(t,e,n){t.addMethod(e,this.createMethodProxy(t,e,n))}createMethodProxy(t,e,n){return function(){return t.hasMethod(e)?t.callMethod(e,arguments):(n&&Tn("Framework component is missing the method "+e+"()"),null)}}};function Wye(t,e){if(!t)return!1;const n=(c,s)=>{const f=e[c.id],v=e[s.id],w=f!==void 0,C=v!==void 0,M=w&&C,F=!w&&!C;return M?f-v:F?c.__objectId-s.__objectId:w?1:-1};let i,r,o=!1;for(let c=0;c<t.length-1;c++)if(i=t[c],r=t[c+1],n(i,r)>0){o=!0;break}return o?(t.sort(n),!0):!1}var Ew=typeof global>"u"?{}:global;Ew.HTMLElement=typeof HTMLElement>"u"?{}:HTMLElement;Ew.HTMLButtonElement=typeof HTMLButtonElement>"u"?{}:HTMLButtonElement;Ew.HTMLSelectElement=typeof HTMLSelectElement>"u"?{}:HTMLSelectElement;Ew.HTMLInputElement=typeof HTMLInputElement>"u"?{}:HTMLInputElement;Ew.Node=typeof Node>"u"?{}:Node;Ew.MouseEvent=typeof MouseEvent>"u"?{}:MouseEvent;var jye="ROOT_NODE_ID",PD=0,$ye=class{constructor(t,e,n,i,r,o){this.nextId=0,this.rowCountReady=!1,this.allNodesMap={},this.rootNode=t,this.gos=e,this.eventService=n,this.funcColsService=i,this.beans=o,this.selectionService=r,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id=jye,this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[]}getCopyOfNodesMap(){return X$(this.allNodesMap)}getRowNode(t){return this.allNodesMap[t]}setRowData(t){if(typeof t=="string"){Tn("rowData must be an array.");return}this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(t);const e=this.rootNode,n=this.rootNode.sibling;e.childrenAfterFilter=null,e.childrenAfterGroup=null,e.childrenAfterAggFilter=null,e.childrenAfterSort=null,e.childrenMapped=null,e.updateHasChildren(),this.nextId=0,this.allNodesMap={},t?e.allLeafChildren=t.map(i=>this.createNode(i,this.rootNode,PD)):(e.allLeafChildren=[],e.childrenAfterGroup=[]),n&&(n.childrenAfterFilter=e.childrenAfterFilter,n.childrenAfterGroup=e.childrenAfterGroup,n.childrenAfterAggFilter=e.childrenAfterAggFilter,n.childrenAfterSort=e.childrenAfterSort,n.childrenMapped=e.childrenMapped,n.allLeafChildren=e.allLeafChildren)}updateRowData(t,e){this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(t.add);const n={remove:[],update:[],add:[]},i=[];return this.executeRemove(t,n,i),this.executeUpdate(t,n,i),this.executeAdd(t,n),this.updateSelection(i,"rowDataChanged"),e&&Wye(this.rootNode.allLeafChildren,e),n}isRowCountReady(){return this.rowCountReady}dispatchRowDataUpdateStartedEvent(t){const e={type:"rowDataUpdateStarted",firstRowData:t!=null&&t.length?t[0]:null};this.eventService.dispatchEvent(e)}updateSelection(t,e){const n=t.length>0;if(n&&this.selectionService.setNodesSelected({newValue:!1,nodes:t,suppressFinishActions:!0,source:e}),this.selectionService.updateGroupsFromChildrenSelections(e),n){const i={type:"selectionChanged",source:e};this.eventService.dispatchEvent(i)}}executeAdd(t,e){var c;const{add:n,addIndex:i}=t;if(Va(n))return;const r=n.map(s=>this.createNode(s,this.rootNode,PD)),o=this.rootNode.allLeafChildren;if(typeof i=="number"&&i>=0){const s=o.length;let f=i;if(this.gos.get("treeData")&&i>0&&s>0){for(let M=0;M<s;M++)if(((c=o[M])==null?void 0:c.rowIndex)==i-1){f=M+1;break}}const w=o.slice(0,f),C=o.slice(f,o.length);this.rootNode.allLeafChildren=[...w,...r,...C]}else this.rootNode.allLeafChildren=[...o,...r];this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=o),e.add=r}executeRemove(t,e,n){var o;const{remove:i}=t;if(Va(i))return;const r={};i.forEach(c=>{const s=this.lookupRowNode(c);s&&(s.isSelected()&&n.push(s),s.clearRowTopAndRowIndex(),r[s.id]=!0,delete this.allNodesMap[s.id],e.remove.push(s))}),this.rootNode.allLeafChildren=((o=this.rootNode.allLeafChildren)==null?void 0:o.filter(c=>!r[c.id]))??null,this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren)}executeUpdate(t,e,n){const{update:i}=t;Va(i)||i.forEach(r=>{const o=this.lookupRowNode(r);o&&(o.updateData(r),!o.selectable&&o.isSelected()&&n.push(o),this.setMasterForRow(o,r,PD,!1),e.update.push(o))})}lookupRowNode(t){var i;const e=this.gos.getRowIdCallback();let n;if(e){const r=e({data:t,level:0});if(n=this.allNodesMap[r],!n)return _s(`could not find row id=${r}, data item was not found for this id`),null}else if(n=(i=this.rootNode.allLeafChildren)==null?void 0:i.find(r=>r.data===t),!n)return _s("could not find data item as object was not found",t),_s("Consider using getRowId to help the Grid find matching row data"),null;return n||null}createNode(t,e,n){const i=new Vp(this.beans);return i.group=!1,this.setMasterForRow(i,t,n,!0),e&&(i.parent=e),i.level=n,i.setDataAndId(t,this.nextId.toString()),this.allNodesMap[i.id]&&Tn(`duplicate node id '${i.id}' detected from getRowId callback, this could cause issues in your grid.`),this.allNodesMap[i.id]=i,this.nextId++,i}setMasterForRow(t,e,n,i){if(this.gos.get("treeData"))t.setMaster(!1),i&&(t.expanded=!1);else{if(this.gos.get("masterDetail")){const c=this.gos.get("isRowMaster");c?t.setMaster(c(e)):t.setMaster(!0)}else t.setMaster(!1);if(i){const c=this.funcColsService.getRowGroupColumns(),s=c?c.length:0,f=n+s;t.expanded=t.master?this.isExpanded(f):!1}}}isExpanded(t){const e=this.gos.get("groupDefaultExpanded");return e===-1?!0:t<e}},qye=class extends wn{constructor(){super(...arguments),this.beanName="rowModel",this.onRowHeightChanged_debounced=Kl(this.onRowHeightChanged.bind(this),100),this.rowsToDisplay=[],this.hasStarted=!1,this.shouldSkipSettingDataOnStart=!1,this.isRefreshingModel=!1,this.rowCountReady=!1}wireBeans(t){this.beans=t,this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.selectionService=t.selectionService,this.valueCache=t.valueCache,this.environment=t.environment,this.filterStage=t.filterStage,this.sortStage=t.sortStage,this.flattenStage=t.flattenStage,this.groupStage=t.groupStage,this.aggregationStage=t.aggregationStage,this.pivotStage=t.pivotStage,this.filterAggregatesStage=t.filterAggregatesStage}postConstruct(){const t=this.refreshModel.bind(this,{step:"group"}),e=!this.gos.get("suppressAnimationFrame"),n=this.refreshModel.bind(this,{step:"group",afterColumnsChanged:!0,keepRenderedRows:!0,animate:e});this.addManagedEventListeners({newColumnsLoaded:n,columnRowGroupChanged:t,columnValueChanged:this.onValueChanged.bind(this),columnPivotChanged:this.refreshModel.bind(this,{step:"pivot"}),filterChanged:this.onFilterChanged.bind(this),sortChanged:this.onSortChanged.bind(this),columnPivotModeChanged:t,gridStylesChanged:this.onGridStylesChanges.bind(this),gridReady:this.onGridReady.bind(this)}),this.addPropertyListeners(),this.rootNode=new Vp(this.beans),this.nodeManager=new $ye(this.rootNode,this.gos,this.eventService,this.funcColsService,this.selectionService,this.beans)}addPropertyListeners(){const t=new Set(["treeData","masterDetail"]),e=new Set(["groupDefaultExpanded","groupAllowUnbalanced","initialGroupOrderComparator","groupHideOpenParents","groupDisplayType"]),n=new Set(["excludeChildrenWhenTreeDataFiltering"]),i=new Set(["removePivotHeaderRowWhenSingleValueColumn","pivotRowTotals","pivotColumnGroupTotals","suppressExpandablePivotGroups"]),r=new Set(["getGroupRowAgg","alwaysAggregateAtRootLevel","groupIncludeTotalFooter","suppressAggFilteredOnly","grandTotalRow"]),o=new Set(["postSortRows","groupDisplayType","accentedSort"]),c=new Set([]),s=new Set(["groupRemoveSingleChildren","groupRemoveLowestSingleChildren","groupIncludeFooter","groupTotalRow"]),f=[...t,...e,...n,...i,...i,...r,...o,...c,...s];this.addManagedPropertyListeners(f,v=>{var M;const w=(M=v.changeSet)==null?void 0:M.properties;if(!w)return;const C=F=>w.some(N=>F.has(N));if(C(t)){this.setRowData(this.rootNode.allLeafChildren.map(F=>F.data));return}if(C(e)){this.refreshModel({step:"group"});return}if(C(n)){this.refreshModel({step:"filter"});return}if(C(i)){this.refreshModel({step:"pivot"});return}if(C(r)){this.refreshModel({step:"aggregate"});return}if(C(o)){this.refreshModel({step:"sort"});return}if(C(c)){this.refreshModel({step:"filter_aggregates"});return}C(s)&&this.refreshModel({step:"map"})}),this.addManagedPropertyListener("rowHeight",()=>this.resetRowHeights())}start(){this.hasStarted=!0,this.shouldSkipSettingDataOnStart?this.dispatchUpdateEventsAndRefresh():this.setInitialData()}setInitialData(){const t=this.gos.get("rowData");t&&(this.shouldSkipSettingDataOnStart=!0,this.setRowData(t))}ensureRowHeightsValid(t,e,n,i){let r,o=!1;do{r=!1;const c=this.getRowIndexAtPixel(t),s=this.getRowIndexAtPixel(e),f=Math.max(c,n),v=Math.min(s,i);for(let w=f;w<=v;w++){const C=this.getRow(w);if(C.rowHeightEstimated){const M=this.gos.getRowHeightForNode(C);C.setRowHeight(M.height),r=!0,o=!0}}r&&this.setRowTopAndRowIndex()}while(r);return o}setRowTopAndRowIndex(){const t=this.environment.getDefaultRowHeight();let e=0;const n=new Set,i=this.gos.isDomLayout("normal");for(let r=0;r<this.rowsToDisplay.length;r++){const o=this.rowsToDisplay[r];if(o.id!=null&&n.add(o.id),o.rowHeight==null){const c=this.gos.getRowHeightForNode(o,i,t);o.setRowHeight(c.height,c.estimated)}o.setRowTop(e),o.setRowIndex(r),e+=o.rowHeight}return n}clearRowTopAndRowIndex(t,e){const n=t.isActive(),i=o=>{o&&o.id!=null&&!e.has(o.id)&&o.clearRowTopAndRowIndex()},r=o=>{if(i(o),i(o.detailNode),i(o.sibling),o.hasChildren()&&o.childrenAfterGroup){const c=o.level==-1;n&&!c&&!o.expanded||o.childrenAfterGroup.forEach(r)}};r(this.rootNode)}ensureRowsAtPixel(t,e,n=0){const i=this.getRowIndexAtPixel(e),r=this.getRow(i),o=!this.gos.get("suppressAnimationFrame");return r===t[0]?!1:(t.forEach(c=>{Xl(this.rootNode.allLeafChildren,c)}),t.forEach((c,s)=>{QR(this.rootNode.allLeafChildren,c,Math.max(i+n,0)+s)}),this.refreshModel({step:"group",keepRenderedRows:!0,keepEditingRows:!0,animate:o}),!0)}highlightRowAtPixel(t,e){const n=e!=null?this.getRowIndexAtPixel(e):null,i=n!=null?this.getRow(n):null;if(!i||!t||i===t||e==null){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null);return}const r=this.getHighlightPosition(e,i);this.lastHighlightedRow&&this.lastHighlightedRow!==i&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null),i.setHighlighted(r),this.lastHighlightedRow=i}getHighlightPosition(t,e){if(!e){const r=this.getRowIndexAtPixel(t);if(e=this.getRow(r||0),!e)return 1}const{rowTop:n,rowHeight:i}=e;return t-n<i/2?0:1}getLastHighlightedRowNode(){return this.lastHighlightedRow}isLastRowIndexKnown(){return!0}getRowCount(){return this.rowsToDisplay?this.rowsToDisplay.length:0}getTopLevelRowCount(){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return 1;const e=this.rootNode.sibling?1:0,n=this.rootNode.childrenAfterAggFilter;return(n?n.length:0)+e}getTopLevelRowDisplayedIndex(t){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return t;let n=t;if(this.rowsToDisplay[0].footer){if(t===0)return 0;n-=1}let i=this.rootNode.childrenAfterSort[n];if(this.gos.get("groupHideOpenParents"))for(;i.expanded&&i.childrenAfterSort&&i.childrenAfterSort.length>0;)i=i.childrenAfterSort[0];return i.rowIndex}getRowBounds(t){if(Hr(this.rowsToDisplay))return null;const e=this.rowsToDisplay[t];return e?{rowTop:e.rowTop,rowHeight:e.rowHeight}:null}onRowGroupOpened(){const t=this.gos.isAnimateRows();this.refreshModel({step:"map",keepRenderedRows:!0,animate:t})}onFilterChanged(t){if(t.afterDataChange)return;const e=this.gos.isAnimateRows(),i=t.columns.length===0||t.columns.some(r=>r.isPrimary())?"filter":"filter_aggregates";this.refreshModel({step:i,keepRenderedRows:!0,animate:e})}onSortChanged(){const t=this.gos.isAnimateRows();this.refreshModel({step:"sort",keepRenderedRows:!0,animate:t,keepEditingRows:!0})}getType(){return"clientSide"}onValueChanged(){this.columnModel.isPivotActive()?this.refreshModel({step:"pivot"}):this.refreshModel({step:"aggregate"})}createChangePath(t){const e=Va(t),n=new OA(!1,this.rootNode);return(e||this.gos.get("treeData"))&&n.setInactive(),n}isSuppressModelUpdateAfterUpdateTransaction(t){if(!this.gos.get("suppressModelUpdateAfterUpdateTransaction")||t.rowNodeTransactions==null)return!1;const e=t.rowNodeTransactions.filter(i=>i.add!=null&&i.add.length>0||i.remove!=null&&i.remove.length>0);return e==null||e.length==0}buildRefreshModelParams(t){let e="group";const n={everything:"group",group:"group",filter:"filter",map:"map",aggregate:"aggregate",sort:"sort",pivot:"pivot"};if($n(t)&&(e=n[t]),Hr(e)){_s(`invalid step ${t}, available steps are ${Object.keys(n).join(", ")}`);return}const i=!this.gos.get("suppressAnimationFrame");return{step:e,keepRenderedRows:!0,keepEditingRows:!0,animate:i}}refreshModel(t){if(!this.hasStarted||this.isRefreshingModel||this.columnModel.isChangeEventsDispatching())return;const e=typeof t=="object"&&"step"in t?t:this.buildRefreshModelParams(t);if(!e||this.isSuppressModelUpdateAfterUpdateTransaction(e))return;const n=this.createChangePath(e.rowNodeTransactions);switch(this.isRefreshingModel=!0,e.step){case"group":this.doRowGrouping(e.rowNodeTransactions,e.rowNodeOrder,n,!!e.afterColumnsChanged);case"filter":this.doFilter(n);case"pivot":this.doPivot(n);case"aggregate":this.doAggregate(n);case"filter_aggregates":this.doFilterAggregates(n);case"sort":this.doSort(e.rowNodeTransactions,n);case"map":this.doRowsToDisplay()}const i=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(n,i),this.isRefreshingModel=!1;const r={type:"modelUpdated",animate:e.animate,keepRenderedRows:e.keepRenderedRows,newData:e.newData,newPage:!1,keepUndoRedoStack:e.keepUndoRedoStack};this.eventService.dispatchEvent(r)}isEmpty(){const t=Hr(this.rootNode.allLeafChildren)||this.rootNode.allLeafChildren.length===0;return Hr(this.rootNode)||t||!this.columnModel.isReady()}isRowsToRender(){return $n(this.rowsToDisplay)&&this.rowsToDisplay.length>0}getNodesInRangeForSelection(t,e){let n=!1,i=!1;const r=[],o=this.gos.get("groupSelectsChildren");return this.forEachNodeAfterFilterAndSort(c=>{if(i)return;if(n&&(c===e||c===t)&&(i=!0,c.group&&o)){r.push(...c.allLeafChildren);return}if(!n){if(c!==e&&c!==t)return;n=!0}if(!c.group||!o){r.push(c);return}}),r}setDatasource(t){_s("should never call setDatasource on clientSideRowController")}getTopLevelNodes(){return this.rootNode?this.rootNode.childrenAfterGroup:null}getRootNode(){return this.rootNode}getRow(t){return this.rowsToDisplay[t]}isRowPresent(t){return this.rowsToDisplay.indexOf(t)>=0}getRowIndexAtPixel(t){if(this.isEmpty()||this.rowsToDisplay.length===0)return-1;let e=0,n=this.rowsToDisplay.length-1;if(t<=0)return 0;if(Yr(this.rowsToDisplay).rowTop<=t)return this.rowsToDisplay.length-1;let r=-1,o=-1;for(;;){const c=Math.floor((e+n)/2),s=this.rowsToDisplay[c];if(this.isRowInPixel(s,t)||(s.rowTop<t?e=c+1:s.rowTop>t&&(n=c-1),r===e&&o===n))return c;r=e,o=n}}isRowInPixel(t,e){const n=t.rowTop,i=t.rowTop+t.rowHeight;return n<=e&&i>e}forEachLeafNode(t){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach((e,n)=>t(e,n))}forEachNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterGroup||[]],callback:t,recursionType:0,index:0,includeFooterNodes:e})}forEachNodeAfterFilter(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterAggFilter||[]],callback:t,recursionType:1,index:0,includeFooterNodes:e})}forEachNodeAfterFilterAndSort(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterSort||[]],callback:t,recursionType:2,index:0,includeFooterNodes:e})}forEachPivotNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:t,recursionType:3,index:0,includeFooterNodes:e})}recursivelyWalkNodesAndCallback(t){const{nodes:e,callback:n,recursionType:i,includeFooterNodes:r}=t;let{index:o}=t;const c=s=>{var F;const f=(F=e[0])==null?void 0:F.parent;if(!f)return;const v=r&&this.gos.getGrandTotalRow(),w=this.gos.getGroupTotalRowCallback(),C=r&&w({node:f});if(f===this.rootNode){v===s&&(f.createFooter(),n(f.sibling,o++));return}C===s&&(f.createFooter(),n(f.sibling,o++))};c("top");for(let s=0;s<e.length;s++){const f=e[s];if(n(f,o++),f.hasChildren()&&!f.footer){let v=null;switch(i){case 0:v=f.childrenAfterGroup;break;case 1:v=f.childrenAfterAggFilter;break;case 2:v=f.childrenAfterSort;break;case 3:v=f.leafGroup?null:f.childrenAfterSort;break}v&&(o=this.recursivelyWalkNodesAndCallback({nodes:[...v],callback:n,recursionType:i,index:o,includeFooterNodes:r}))}}return c("bottom"),o}doAggregate(t){var e;(e=this.aggregationStage)==null||e.execute({rowNode:this.rootNode,changedPath:t})}doFilterAggregates(t){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:t}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter}expandOrCollapseAll(t){const e=this.gos.get("treeData"),n=this.columnModel.isPivotActive(),i=c=>{c&&c.forEach(s=>{const f=()=>{s.expanded=t,i(s.childrenAfterGroup)};if(e){$n(s.childrenAfterGroup)&&f();return}if(n){!s.leafGroup&&f();return}s.group&&f()})};this.rootNode&&i(this.rootNode.childrenAfterGroup),this.refreshModel({step:"map"});const o={type:"expandOrCollapseAll",source:t?"expandAll":"collapseAll"};this.eventService.dispatchEvent(o)}doSort(t,e){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,changedPath:e})}doRowGrouping(t,e,n,i){if(this.groupStage){if(t?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,rowNodeOrder:e,changedPath:n}):this.groupStage.execute({rowNode:this.rootNode,changedPath:n,afterColumnsChanged:i}),this.gos.get("groupSelectsChildren")&&this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",n)){const o={type:"selectionChanged",source:"rowGroupChanged"};this.eventService.dispatchEvent(o)}}else this.rootNode.childrenAfterGroup=this.rootNode.allLeafChildren,this.rootNode.sibling&&(this.rootNode.sibling.childrenAfterGroup=this.rootNode.childrenAfterGroup),this.rootNode.updateHasChildren();this.nodeManager.isRowCountReady()&&(this.rowCountReady=!0,this.eventService.dispatchEventOnce({type:"rowCountReady"}))}doFilter(t){this.filterStage.execute({rowNode:this.rootNode,changedPath:t})}doPivot(t){var e;(e=this.pivotStage)==null||e.execute({rowNode:this.rootNode,changedPath:t})}getCopyOfNodesMap(){return this.nodeManager.getCopyOfNodesMap()}getRowNode(t){if(typeof t=="string"&&t.indexOf(Vp.ID_PREFIX_ROW_GROUP)==0){let n;return this.forEachNode(i=>{i.id===t&&(n=i)}),n}return this.nodeManager.getRowNode(t)}setRowData(t){this.selectionService.reset("rowDataChanged"),this.nodeManager.setRowData(t),this.hasStarted&&this.dispatchUpdateEventsAndRefresh()}dispatchUpdateEventsAndRefresh(){const t={type:"rowDataUpdated"};this.eventService.dispatchEvent(t),this.refreshModel({step:"group",newData:!0})}batchUpdateRowData(t,e){if(this.applyAsyncTransactionsTimeout==null){this.rowDataTransactionBatch=[];const n=this.gos.getAsyncTransactionWaitMillis();this.applyAsyncTransactionsTimeout=window.setTimeout(()=>{this.executeBatchUpdateRowData()},n)}this.rowDataTransactionBatch.push({rowDataTransaction:t,callback:e})}flushAsyncTransactions(){this.applyAsyncTransactionsTimeout!=null&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())}executeBatchUpdateRowData(){this.valueCache.onDataChanged();const t=[],e=[];let n=!1;if(this.rowDataTransactionBatch&&this.rowDataTransactionBatch.forEach(i=>{const r=this.nodeManager.updateRowData(i.rowDataTransaction,void 0);e.push(r),i.callback&&t.push(i.callback.bind(null,r)),typeof i.rowDataTransaction.addIndex=="number"&&(n=!0)}),this.commonUpdateRowData(e,void 0,n),t.length>0&&window.setTimeout(()=>{t.forEach(i=>i())},0),e.length>0){const i={type:"asyncTransactionsFlushed",results:e};this.eventService.dispatchEvent(i)}this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0}updateRowData(t,e){this.valueCache.onDataChanged();const n=this.nodeManager.updateRowData(t,e),i=typeof t.addIndex=="number";return this.commonUpdateRowData([n],e,i),n}createRowNodeOrder(){if(this.gos.get("suppressMaintainUnsortedOrder"))return;const e={};if(this.rootNode&&this.rootNode.allLeafChildren)for(let n=0;n<this.rootNode.allLeafChildren.length;n++){const i=this.rootNode.allLeafChildren[n];e[i.id]=n}return e}commonUpdateRowData(t,e,n){if(!this.hasStarted)return;const i=!this.gos.get("suppressAnimationFrame");n&&(e=this.createRowNodeOrder());const r={type:"rowDataUpdated"};this.eventService.dispatchEvent(r),this.refreshModel({step:"group",rowNodeTransactions:t,rowNodeOrder:e,keepRenderedRows:!0,keepEditingRows:!0,animate:i})}doRowsToDisplay(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})}onRowHeightChanged(){this.refreshModel({step:"map",keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}resetRowHeights(){const t=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),this.rootNode.sibling&&this.rootNode.sibling.setRowHeight(this.rootNode.sibling.rowHeight,!0),t&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let t=!1;return this.forEachNode(e=>{e.setRowHeight(e.rowHeight,!0);const n=e.detailNode;n&&n.setRowHeight(n.rowHeight,!0),e.sibling&&e.sibling.setRowHeight(e.sibling.rowHeight,!0),t=!0}),t}onGridStylesChanges(t){if(t.rowHeightChanged){if(this.columnModel.isAutoRowHeightActive())return;this.resetRowHeights()}}onGridReady(){this.hasStarted||this.setInitialData()}isRowDataLoaded(){return this.rowCountReady}};function Zye(t){t.expansionService.onGroupExpandedOrCollapsed()}function Xye(t,e){var n,i;(i=(n=t.rowModelHelperService)==null?void 0:n.getClientSideRowModel())==null||i.refreshModel(e)}function Kye(t,e){var n,i;(i=(n=t.rowModelHelperService)==null?void 0:n.getClientSideRowModel())==null||i.forEachLeafNode(e)}function Yye(t,e){var n,i;(i=(n=t.rowModelHelperService)==null?void 0:n.getClientSideRowModel())==null||i.forEachNodeAfterFilter(e)}function Jye(t,e){var n,i;(i=(n=t.rowModelHelperService)==null?void 0:n.getClientSideRowModel())==null||i.forEachNodeAfterFilterAndSort(e)}function Qye(t){var e,n;if(t.columnModel.isAutoRowHeightActive()){Tn("calling gridApi.resetRowHeights() makes no sense when using Auto Row Height.");return}(n=(e=t.rowModelHelperService)==null?void 0:e.getClientSideRowModel())==null||n.resetRowHeights()}function e_e(t,e){return t.frameworkOverrides.wrapIncoming(()=>{var n,i;return(i=(n=t.rowModelHelperService)==null?void 0:n.getClientSideRowModel())==null?void 0:i.updateRowData(e)})}function t_e(t,e,n){t.frameworkOverrides.wrapIncoming(()=>{var i,r;return(r=(i=t.rowModelHelperService)==null?void 0:i.getClientSideRowModel())==null?void 0:r.batchUpdateRowData(e,n)})}function n_e(t){t.frameworkOverrides.wrapIncoming(()=>{var e,n;return(n=(e=t.rowModelHelperService)==null?void 0:e.getClientSideRowModel())==null?void 0:n.flushAsyncTransactions()})}function i_e(t){return t.selectionService.getBestCostNodeSelection()}var r_e=class extends wn{constructor(){super(...arguments),this.beanName="filterStage"}wireBeans(t){this.filterManager=t.filterManager}execute(t){const{changedPath:e}=t;this.filter(e)}filter(t){var n;const e=!!((n=this.filterManager)!=null&&n.isChildFilterPresent());this.filterNodes(e,t)}filterNodes(t,e){const n=(i,r)=>{i.hasChildren()&&t&&!r?i.childrenAfterFilter=i.childrenAfterGroup.filter(o=>{const c=o.childrenAfterFilter&&o.childrenAfterFilter.length>0,s=o.data&&this.filterManager.doesRowPassFilter({rowNode:o});return c||s}):i.childrenAfterFilter=i.childrenAfterGroup,i.sibling&&(i.sibling.childrenAfterFilter=i.childrenAfterFilter)};if(this.doingTreeDataFiltering()){const i=(o,c)=>{if(o.childrenAfterGroup)for(let s=0;s<o.childrenAfterGroup.length;s++){const f=o.childrenAfterGroup[s],v=c||this.filterManager.doesRowPassFilter({rowNode:f});f.childrenAfterGroup?i(o.childrenAfterGroup[s],v):n(f,v)}n(o,c)},r=o=>i(o,!1);e.executeFromRootNode(r)}else{const i=r=>n(r,!1);e.forEachChangedNodeDepthFirst(i,!0)}}doingTreeDataFiltering(){return this.gos.get("treeData")&&!this.gos.get("excludeChildrenWhenTreeDataFiltering")}},s_e=class extends wn{constructor(){super(...arguments),this.beanName="flattenStage"}wireBeans(t){this.beans=t,this.columnModel=t.columnModel}execute(t){const e=t.rowNode,n=[],i=this.columnModel.isPivotMode(),r=i&&e.leafGroup,o=r?[e]:e.childrenAfterSort,c=this.getFlattenDetails();this.recursivelyAddToRowsToDisplay(c,o,n,i,0);const s=n.length>0;if(!r&&s&&c.grandTotalRow){e.createFooter();const v=c.grandTotalRow==="top";this.addRowNodeToRowsToDisplay(c,e.sibling,n,0,v)}return n}getFlattenDetails(){const t=this.gos.get("groupRemoveSingleChildren");return{groupRemoveLowestSingleChildren:!t&&this.gos.get("groupRemoveLowestSingleChildren"),groupRemoveSingleChildren:t,isGroupMultiAutoColumn:this.gos.isGroupMultiAutoColumn(),hideOpenParents:this.gos.get("groupHideOpenParents"),grandTotalRow:this.gos.getGrandTotalRow(),groupTotalRow:this.gos.getGroupTotalRowCallback()}}recursivelyAddToRowsToDisplay(t,e,n,i,r){if(!Va(e))for(let o=0;o<e.length;o++){const c=e[o],s=c.hasChildren(),f=i&&!s,v=t.groupRemoveSingleChildren&&s&&c.childrenAfterGroup.length===1,w=t.groupRemoveLowestSingleChildren&&s&&c.leafGroup&&c.childrenAfterGroup.length===1,C=i&&c.leafGroup,M=t.hideOpenParents&&c.expanded&&!c.master&&!C;if(!f&&!M&&!v&&!w&&this.addRowNodeToRowsToDisplay(t,c,n,r),!(i&&c.leafGroup)){if(s){const N=v||w;if(c.expanded||N){const z=t.groupTotalRow({node:c});z||c.destroyFooter();const L=N?r:r+1;z==="top"&&(c.createFooter(),this.addRowNodeToRowsToDisplay(t,c.sibling,n,L)),this.recursivelyAddToRowsToDisplay(t,c.childrenAfterSort,n,i,L),z==="bottom"&&(c.createFooter(),this.addRowNodeToRowsToDisplay(t,c.sibling,n,L))}}else if(c.master&&c.expanded){const N=this.createDetailNode(c);this.addRowNodeToRowsToDisplay(t,N,n,r)}}}}addRowNodeToRowsToDisplay(t,e,n,i,r){r?n.unshift(e):n.push(e),e.setUiLevel(t.isGroupMultiAutoColumn?0:i)}createDetailNode(t){if($n(t.detailNode))return t.detailNode;const e=new Vp(this.beans);return e.detail=!0,e.selectable=!1,e.parent=t,$n(t.id)&&(e.id="detail_"+t.id),e.data=t.data,e.level=t.level+1,t.detailNode=e,e}},o_e=class extends wn{constructor(){super(...arguments),this.beanName="immutableService"}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}postConstruct(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel,this.addManagedPropertyListener("rowData",()=>this.onRowDataUpdated()))}isActive(){const t=this.gos.exists("getRowId");return this.gos.get("resetRowDataOnUpdate")?!1:t}setRowData(t){const e=this.createTransactionForRowData(t);if(!e)return;const[n,i]=e;this.clientSideRowModel.updateRowData(n,i)}createTransactionForRowData(t){if(Hr(this.clientSideRowModel)){_s("ImmutableService only works with ClientSideRowModel");return}const e=this.gos.getRowIdCallback();if(e==null){_s("ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!");return}const n={remove:[],update:[],add:[]},i=this.clientSideRowModel.getCopyOfNodesMap(),o=this.gos.get("suppressMaintainUnsortedOrder")?void 0:{};return $n(t)&&t.forEach((c,s)=>{const f=e({data:c,level:0}),v=i[f];o&&(o[f]=s),v?(v.data!==c&&n.update.push(c),i[f]=void 0):n.add.push(c)}),td(i,(c,s)=>{s&&n.remove.push(s.data)}),[n,o]}onRowDataUpdated(){const t=this.gos.get("rowData");t&&(this.isActive()?this.setRowData(t):(this.selectionService.reset("rowDataChanged"),this.clientSideRowModel.setRowData(t)))}},a_e=class extends wn{constructor(){super(...arguments),this.beanName="sortService"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.rowNodeSorter=t.rowNodeSorter,this.showRowGroupColsService=t.showRowGroupColsService}sort(t,e,n,i,r,o){const c=this.gos.get("groupMaintainOrder"),s=this.columnModel.getCols().some(M=>M.isRowGroupActive());let f={};n&&i&&(f=this.calculateDirtyNodes(i));const v=this.columnModel.isPivotMode(),w=this.gos.getCallback("postSortRows"),C=M=>{var z;this.pullDownGroupDataForHideOpenParents(M.childrenAfterAggFilter,!0);const F=v&&M.leafGroup;if(c&&s&&!M.leafGroup&&!o){const L=(z=this.funcColsService.getRowGroupColumns())==null?void 0:z[M.level+1],P=(L==null?void 0:L.getSort())===null,H=M.childrenAfterAggFilter.slice(0);if(M.childrenAfterSort&&!P){const j={};M.childrenAfterSort.forEach((q,le)=>{j[q.id]=le}),H.sort((q,le)=>(j[q.id]??0)-(j[le.id]??0))}M.childrenAfterSort=H}else!e||F?M.childrenAfterSort=M.childrenAfterAggFilter.slice(0):n?M.childrenAfterSort=this.doDeltaSort(M,f,r,t):M.childrenAfterSort=this.rowNodeSorter.doFullSort(M.childrenAfterAggFilter,t);if(M.sibling&&(M.sibling.childrenAfterSort=M.childrenAfterSort),this.updateChildIndexes(M),w){const L={nodes:M.childrenAfterSort};w(L)}};r&&r.forEachChangedNodeDepthFirst(C),this.updateGroupDataForHideOpenParents(r)}calculateDirtyNodes(t){const e={},n=i=>{i&&i.forEach(r=>e[r.id]=!0)};return t&&t.forEach(i=>{n(i.add),n(i.update),n(i.remove)}),e}doDeltaSort(t,e,n,i){const r=t.childrenAfterAggFilter,o=t.childrenAfterSort;if(!o)return this.rowNodeSorter.doFullSort(r,i);const c={},s=[];r.forEach(C=>{e[C.id]||!n.canSkip(C)?s.push(C):c[C.id]=!0});const f=o.filter(C=>c[C.id]),v=(C,M)=>({currentPos:M,rowNode:C}),w=s.map(v).sort((C,M)=>this.rowNodeSorter.compareRowNodes(i,C,M));return this.mergeSortedArrays(i,w,f.map(v)).map(({rowNode:C})=>C)}mergeSortedArrays(t,e,n){const i=[];let r=0,o=0;for(;r<e.length&&o<n.length;)this.rowNodeSorter.compareRowNodes(t,e[r],n[o])<0?i.push(e[r++]):i.push(n[o++]);for(;r<e.length;)i.push(e[r++]);for(;o<n.length;)i.push(n[o++]);return i}updateChildIndexes(t){if(Hr(t.childrenAfterSort))return;const e=t.childrenAfterSort;for(let n=0;n<e.length;n++){const i=e[n],r=n===0,o=n===t.childrenAfterSort.length-1;i.setFirstChild(r),i.setLastChild(o),i.setChildIndex(n)}}updateGroupDataForHideOpenParents(t){if(!this.gos.get("groupHideOpenParents"))return;if(this.gos.get("treeData"))return Tn("The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them."),!1;const e=n=>{this.pullDownGroupDataForHideOpenParents(n.childrenAfterSort,!1),n.childrenAfterSort.forEach(i=>{i.hasChildren()&&e(i)})};t&&t.executeFromRootNode(n=>e(n))}pullDownGroupDataForHideOpenParents(t,e){!this.gos.get("groupHideOpenParents")||Hr(t)||t.forEach(n=>{var r;(((r=this.showRowGroupColsService)==null?void 0:r.getShowRowGroupCols())??[]).forEach(o=>{const c=o.getColDef().showRowGroup;if(typeof c!="string"){_s("groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");return}const s=c,f=this.columnModel.getColDefCol(s);if(f!==n.rowGroupColumn)if(e)n.setGroupValue(o.getId(),void 0);else{const w=n.getFirstChildOfFirstChild(f);w&&n.setGroupValue(o.getId(),w.key)}})})}},l_e=class extends wn{constructor(){super(...arguments),this.beanName="sortStage"}wireBeans(t){this.sortService=t.sortService,this.sortController=t.sortController}execute(t){const e=this.sortController.getSortOptions(),n=$n(e)&&e.length>0,i=n&&$n(t.rowNodeTransactions)&&this.gos.get("deltaSort"),r=e.some(o=>this.gos.isColumnsSortingCoupledToGroup()?o.column.isPrimary()&&o.column.isRowGroupActive():!!o.column.getColDef().showRowGroup);this.sortService.sort(e,n,i,t.rowNodeTransactions,t.changedPath,r)}},G3="32.0.2",Aq={version:G3,moduleName:"@ag-grid-community/client-side-row-model-core",rowModel:"clientSide",beans:[qye,r_e,l_e,s_e,a_e,o_e]},c_e={version:G3,moduleName:"@ag-grid-community/client-side-row-model-api",beans:[Tq],apiFunctions:{onGroupExpandedOrCollapsed:Zye,refreshClientSideRowModel:Xye,forEachLeafNode:Kye,forEachNodeAfterFilter:Yye,forEachNodeAfterFilterAndSort:Jye,resetRowHeights:Qye,applyTransaction:e_e,applyTransactionAsync:t_e,flushAsyncTransactions:n_e,getBestCostNodeSelection:i_e},dependantModules:[Aq,Vye]},u_e={version:G3,moduleName:"@ag-grid-community/client-side-row-model",dependantModules:[Aq,c_e]},h_e=class extends wn{setBeans(t){this.beans=t}getFileName(t){const e=this.getDefaultFileExtension();return(t==null||!t.length)&&(t=this.getDefaultFileName()),t.indexOf(".")===-1?`${t}.${e}`:t}getData(t){const e=this.createSerializingSession(t);return this.beans.gridSerializer.serialize(e,t)}getDefaultFileName(){return`export.${this.getDefaultFileExtension()}`}},d_e=class{constructor(t){this.groupColumns=[];const{columnModel:e,funcColsService:n,columnNameService:i,valueService:r,gos:o,processCellCallback:c,processHeaderCallback:s,processGroupHeaderCallback:f,processRowGroupCallback:v}=t;this.columnModel=e,this.funcColsService=n,this.columnNameService=i,this.valueService=r,this.gos=o,this.processCellCallback=c,this.processHeaderCallback=s,this.processGroupHeaderCallback=f,this.processRowGroupCallback=v}prepare(t){this.groupColumns=t.filter(e=>!!e.getColDef().showRowGroup)}extractHeaderValue(t){return this.getHeaderName(this.processHeaderCallback,t)??""}extractRowCellValue(t,e,n,i,r){const c=(!this.gos.get("groupHideOpenParents")||r.footer)&&this.shouldRenderGroupSummaryCell(r,t,e)?this.createValueForGroupNode(t,r):this.valueService.getValue(t,r);return this.processCell({accumulatedRowIndex:n,rowNode:r,column:t,value:c,processCellCallback:this.processCellCallback,type:i})}shouldRenderGroupSummaryCell(t,e,n){var c;if(!(t&&t.group))return!1;if(this.groupColumns.indexOf(e)!==-1){if(((c=t.groupData)==null?void 0:c[e.getId()])!=null||this.gos.isRowModelType("serverSide")&&t.group)return!0;if(t.footer&&t.level===-1){const s=e.getColDef();return s==null||s.showRowGroup===!0||s.showRowGroup===this.funcColsService.getRowGroupColumns()[0].getId()}}const o=this.gos.isGroupUseEntireRow(this.columnModel.isPivotMode());return n===0&&o}getHeaderName(t,e){return t?t(this.gos.addGridCommonParams({column:e})):this.columnNameService.getDisplayNameForColumn(e,"csv",!0)}createValueForGroupNode(t,e){if(this.processRowGroupCallback)return this.processRowGroupCallback(this.gos.addGridCommonParams({column:t,node:e}));const n=this.gos.get("treeData"),i=this.gos.get("suppressGroupMaintainValueType"),r=f=>{var w;if(n||i)return f.key;const v=(w=f.groupData)==null?void 0:w[t.getId()];return!v||!f.rowGroupColumn||f.rowGroupColumn.getColDef().useValueFormatterForExport===!1?v:this.valueService.formatValue(f.rowGroupColumn,f,v)??v},o=e.footer,c=[r(e)];if(!this.gos.isGroupMultiAutoColumn())for(;e.parent;)e=e.parent,c.push(r(e));const s=c.reverse().join(" -> ");return o?`Total ${s}`:s}processCell(t){const{accumulatedRowIndex:e,rowNode:n,column:i,value:r,processCellCallback:o,type:c}=t;return o?{value:o(this.gos.addGridCommonParams({accumulatedRowIndex:e,column:i,node:n,value:r,type:c,parseValue:s=>this.valueService.parseValue(i,n,s,this.valueService.getValue(i,n)),formatValue:s=>this.valueService.formatValue(i,n,s)??s}))??""}:i.getColDef().useValueFormatterForExport!==!1?{value:r??"",valueFormatted:this.valueService.formatValue(i,n,r)}:{value:r??""}}},f_e=class{static download(t,e){const n=document.defaultView||window;if(!n){Tn("There is no `window` associated with the current `document`");return}const i=document.createElement("a"),r=n.URL.createObjectURL(e);i.setAttribute("href",r),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0,view:n})),document.body.removeChild(i),n.setTimeout(()=>{n.URL.revokeObjectURL(r)},0)}},lH=`\r
`,p_e=class extends d_e{constructor(t){super(t),this.isFirstLine=!0,this.result="";const{suppressQuotes:e,columnSeparator:n}=t;this.suppressQuotes=e,this.columnSeparator=n}addCustomContent(t){t&&(typeof t=="string"?(/^\s*\n/.test(t)||this.beginNewLine(),t=t.replace(/\r?\n/g,lH),this.result+=t):t.forEach(e=>{this.beginNewLine(),e.forEach((n,i)=>{i!==0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(n.data.value||""),n.mergeAcross&&this.appendEmptyCells(n.mergeAcross)})}))}onNewHeaderGroupingRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderGroupingRowColumn.bind(this)}}onNewHeaderGroupingRowColumn(t,e,n,i){n!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(e),this.appendEmptyCells(i)}appendEmptyCells(t){for(let e=1;e<=t;e++)this.result+=this.columnSeparator+this.putInQuotes("")}onNewHeaderRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderRowColumn.bind(this)}}onNewHeaderRowColumn(t,e){e!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(this.extractHeaderValue(t))}onNewBodyRow(){return this.beginNewLine(),{onColumn:this.onNewBodyRowColumn.bind(this)}}onNewBodyRowColumn(t,e,n){e!=0&&(this.result+=this.columnSeparator);const i=this.extractRowCellValue(t,e,e,"csv",n);this.result+=this.putInQuotes(i.valueFormatted??i.value)}putInQuotes(t){if(this.suppressQuotes)return t;if(t==null)return'""';let e;return typeof t=="string"?e=t:typeof t.toString=="function"?e=t.toString():(Tn("unknown value type during csv conversion"),e=""),'"'+e.replace(/"/g,'""')+'"'}parse(){return this.result}beginNewLine(){this.isFirstLine||(this.result+=lH),this.isFirstLine=!1}},m_e=class extends h_e{constructor(){super(...arguments),this.beanName="csvCreator"}wireBeans(t){this.columnModel=t.columnModel,this.columnNameService=t.columnNameService,this.funcColsService=t.funcColsService,this.valueService=t.valueService,this.gridSerializer=t.gridSerializer}postConstruct(){this.setBeans({gridSerializer:this.gridSerializer,gos:this.gos})}getMergedParams(t){const e=this.gos.get("defaultCsvExportParams");return Object.assign({},e,t)}export(t){if(this.isExportSuppressed()){Tn("Export cancelled. Export is not allowed as per your configuration.");return}const e=this.getMergedParams(t),n=this.getData(e),i=new Blob(["\uFEFF",n],{type:"text/plain"}),r=typeof e.fileName=="function"?e.fileName(this.gos.getGridCommonParams()):e.fileName;f_e.download(this.getFileName(r),i)}exportDataAsCsv(t){this.export(t)}getDataAsCsv(t,e=!1){const n=e?Object.assign({},t):this.getMergedParams(t);return this.getData(n)}getDefaultFileExtension(){return"csv"}createSerializingSession(t){const{columnModel:e,columnNameService:n,funcColsService:i,valueService:r,gos:o}=this,{processCellCallback:c,processHeaderCallback:s,processGroupHeaderCallback:f,processRowGroupCallback:v,suppressQuotes:w,columnSeparator:C}=t;return new p_e({columnModel:e,columnNameService:n,funcColsService:i,valueService:r,gos:o,processCellCallback:c||void 0,processHeaderCallback:s||void 0,processGroupHeaderCallback:f||void 0,processRowGroupCallback:v||void 0,suppressQuotes:w||!1,columnSeparator:C||","})}isExportSuppressed(){return this.gos.get("suppressCsvExport")}};function g_e(t,e){var n;return(n=t.csvCreator)==null?void 0:n.getDataAsCsv(e)}function v_e(t,e){var n;(n=t.csvCreator)==null||n.exportDataAsCsv(e)}var y_e=class extends wn{constructor(){super(...arguments),this.beanName="gridSerializer"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.columnModel=t.columnModel,this.columnNameService=t.columnNameService,this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.selectionService=t.selectionService,this.rowNodeSorter=t.rowNodeSorter,this.sortController=t.sortController}serialize(t,e={}){const{allColumns:n,columnKeys:i,skipRowGroups:r}=e,o=this.getColumnsToExport(n,r,i);return wce(this.prepareSession(o),this.prependContent(e),this.exportColumnGroups(e,o),this.exportHeaders(e,o),this.processPinnedTopRows(e,o),this.processRows(e,o),this.processPinnedBottomRows(e,o),this.appendContent(e))(t).parse()}processRow(t,e,n,i){var P;const r=e.shouldRowBeSkipped||(()=>!1),o=this.gos.get("groupRemoveSingleChildren"),c=this.gos.get("groupRemoveLowestSingleChildren"),f=e.rowPositions!=null||!!e.onlySelected,v=this.gos.get("groupHideOpenParents")&&!f,w=this.columnModel.isPivotMode()?i.leafGroup:!i.group,C=!!i.footer,M=c&&i.leafGroup,F=i.allChildrenCount===1&&((P=i.childrenAfterGroup)==null?void 0:P.length)===1&&(o||M);if(!w&&!C&&(e.skipRowGroups||F||v)||e.onlySelected&&!i.isSelected()||e.skipPinnedTop&&i.rowPinned==="top"||e.skipPinnedBottom&&i.rowPinned==="bottom"||i.level===-1&&!w&&!C||r(this.gos.addGridCommonParams({node:i})))return;const L=t.onNewBodyRow(i);if(n.forEach((H,j)=>{L.onColumn(H,j,i)}),e.getCustomContentBelowRow){const H=e.getCustomContentBelowRow(this.gos.addGridCommonParams({node:i}));H&&t.addCustomContent(H)}}appendContent(t){return e=>{const n=t.appendContent;return n&&e.addCustomContent(n),e}}prependContent(t){return e=>{const n=t.prependContent;return n&&e.addCustomContent(n),e}}prepareSession(t){return e=>(e.prepare(t),e)}exportColumnGroups(t,e){return n=>{if(!t.skipColumnGroupHeaders){const i=new t7,r=this.visibleColsService.createGroups({columns:e,idCreator:i,pinned:null,isStandaloneStructure:!0});this.recursivelyAddHeaderGroups(r,n,t.processGroupHeaderCallback)}return n}}exportHeaders(t,e){return n=>{if(!t.skipColumnHeaders){const i=n.onNewHeaderRow();e.forEach((r,o)=>{i.onColumn(r,o,void 0)})}return n}}processPinnedTopRows(t,e){return n=>{const i=this.processRow.bind(this,n,t,e);return t.rowPositions?t.rowPositions.filter(r=>r.rowPinned==="top").sort((r,o)=>r.rowIndex-o.rowIndex).map(r=>this.pinnedRowModel.getPinnedTopRow(r.rowIndex)).forEach(i):this.pinnedRowModel.forEachPinnedTopRow(i),n}}processRows(t,e){return n=>{const i=this.rowModel,r=i.getType(),o=r==="clientSide",c=r==="serverSide",s=!o&&t.onlySelected,f=this.processRow.bind(this,n,t,e),{exportedRows:v="filteredAndSorted"}=t;if(t.rowPositions)t.rowPositions.filter(w=>w.rowPinned==null).sort((w,C)=>w.rowIndex-C.rowIndex).map(w=>i.getRow(w.rowIndex)).forEach(f);else if(this.columnModel.isPivotMode())o?i.forEachPivotNode(f,!0):c?i.forEachNodeAfterFilterAndSort(f,!0):i.forEachNode(f);else if(t.onlySelectedAllPages||s){const w=this.selectionService.getSelectedNodes();this.replicateSortedOrder(w),w.forEach(f)}else v==="all"?i.forEachNode(f):o||c?i.forEachNodeAfterFilterAndSort(f,!0):i.forEachNode(f);return n}}replicateSortedOrder(t){const e=this.sortController.getSortOptions(),n=(i,r)=>{var o,c;return i.rowIndex!=null&&r.rowIndex!=null?i.rowIndex-r.rowIndex:i.level===r.level?((o=i.parent)==null?void 0:o.id)===((c=r.parent)==null?void 0:c.id)?this.rowNodeSorter.compareRowNodes(e,{rowNode:i,currentPos:i.rowIndex??-1},{rowNode:r,currentPos:r.rowIndex??-1}):n(i.parent,r.parent):i.level>r.level?n(i.parent,r):n(i,r.parent)};t.sort(n)}processPinnedBottomRows(t,e){return n=>{const i=this.processRow.bind(this,n,t,e);return t.rowPositions?t.rowPositions.filter(r=>r.rowPinned==="bottom").sort((r,o)=>r.rowIndex-o.rowIndex).map(r=>this.pinnedRowModel.getPinnedBottomRow(r.rowIndex)).forEach(i):this.pinnedRowModel.forEachPinnedBottomRow(i),n}}getColumnsToExport(t=!1,e=!1,n){const i=this.columnModel.isPivotMode();if(n&&n.length)return this.columnModel.getColsForKeys(n);const r=this.gos.get("treeData");let o=[];return t&&!i?o=this.columnModel.getCols():o=this.visibleColsService.getAllCols(),e&&!r&&(o=o.filter(c=>c.getColId()!==zS)),o}recursivelyAddHeaderGroups(t,e,n){const i=[];t.forEach(r=>{const o=r;o.getChildren&&o.getChildren().forEach(c=>i.push(c))}),t.length>0&&oa(t[0])&&this.doAddHeaderHeader(e,t,n),i&&i.length>0&&this.recursivelyAddHeaderGroups(i,e,n)}doAddHeaderHeader(t,e,n){const i=t.onNewHeaderGroupingRow();let r=0;e.forEach(o=>{const c=o;let s;n?s=n(this.gos.addGridCommonParams({columnGroup:c})):s=this.columnNameService.getDisplayNameForColumnGroup(c,"header");const f=c.getLeafColumns().reduce((v,w,C,M)=>{let F=Yr(v);return w.getColumnGroupShow()==="open"?(!F||F[1]!=null)&&(F=[C],v.push(F)):F&&F[1]==null&&(F[1]=C-1),C===M.length-1&&F&&F[1]==null&&(F[1]=C),v},[]);i.onColumn(c,s||"",r++,c.getLeafColumns().length-1,f)})}},H3="32.0.2",Pq={version:H3,moduleName:"@ag-grid-community/csv-export-core",beans:[m_e,y_e]},__e={version:H3,moduleName:"@ag-grid-community/csv-export-api",apiFunctions:{getDataAsCsv:g_e,exportDataAsCsv:v_e},dependantModules:[Pq]},x_e={version:H3,moduleName:"@ag-grid-community/csv-export",dependantModules:[Pq,__e]},w_e=class extends Mpe{wireBeans(t){this.beans=t}constructor(t,e,n){super(t),this.parentCache=e,this.params=n,this.startRow=t*n.blockSize,this.endRow=this.startRow+n.blockSize}postConstruct(){this.createRowNodes()}getBlockStateJson(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}}setDataAndId(t,e,n){$n(e)?t.setDataAndId(e,n.toString()):t.setDataAndId(void 0,void 0)}loadFromDatasource(){const t=this.createLoadParams();if(Hr(this.params.datasource.getRows)){Tn("datasource is missing getRows method");return}window.setTimeout(()=>{this.params.datasource.getRows(t)},0)}processServerFail(){}createLoadParams(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gos.getGridCommonParams().context}}forEachNode(t,e,n){this.rowNodes.forEach((i,r)=>{this.startRow+r<n&&t(i,e.next())})}getLastAccessed(){return this.lastAccessed}getRow(t,e=!1){e||(this.lastAccessed=this.params.lastAccessedSequence.next());const n=t-this.startRow;return this.rowNodes[n]}getStartRow(){return this.startRow}getEndRow(){return this.endRow}createRowNodes(){this.rowNodes=[];for(let t=0;t<this.params.blockSize;t++){const e=this.startRow+t,n=new Vp(this.beans);n.setRowHeight(this.params.rowHeight),n.uiLevel=0,n.setRowIndex(e),n.setRowTop(this.params.rowHeight*e),this.rowNodes.push(n)}}processServerResult(t){this.rowNodes.forEach((n,i)=>{const r=t.rowData?t.rowData[i]:void 0;!n.id&&n.alreadyRendered&&r&&(this.rowNodes[i]=new Vp(this.beans),this.rowNodes[i].setRowIndex(n.rowIndex),this.rowNodes[i].setRowTop(n.rowTop),this.rowNodes[i].setRowHeight(n.rowHeight),n.clearRowTopAndRowIndex()),this.setDataAndId(this.rowNodes[i],r,this.startRow+i)});const e=t.rowCount!=null&&t.rowCount>=0?t.rowCount:void 0;this.parentCache.pageLoaded(this,e)}destroy(){this.rowNodes.forEach(t=>{t.clearRowTopAndRowIndex()}),super.destroy()}},C_e=2,S_e=class extends wn{constructor(t){super(),this.lastRowIndexKnown=!1,this.blocks={},this.blockCount=0,this.rowCount=t.initialRowCount,this.params=t}wireBeans(t){this.rowRenderer=t.rowRenderer,this.focusService=t.focusService}getRow(t,e=!1){const n=Math.floor(t/this.params.blockSize);let i=this.blocks[n];if(!i){if(e)return;i=this.createBlock(n)}return i.getRow(t)}createBlock(t){const e=this.createBean(new w_e(t,this,this.params));return this.blocks[e.getId()]=e,this.blockCount++,this.purgeBlocksIfNeeded(e),this.params.rowNodeBlockLoader.addBlock(e),e}refreshCache(){if(this.blockCount==0){this.purgeCache();return}this.getBlocksInOrder().forEach(e=>e.setStateWaitingToLoad()),this.params.rowNodeBlockLoader.checkBlockToLoad()}destroy(){this.getBlocksInOrder().forEach(t=>this.destroyBlock(t)),super.destroy()}getRowCount(){return this.rowCount}isLastRowIndexKnown(){return this.lastRowIndexKnown}pageLoaded(t,e){this.isAlive()&&(this.gos.get("debug")&&nd(`InfiniteCache - onPageLoaded: page = ${t.getId()}, lastRow = ${e}`),this.checkRowCount(t,e),this.onCacheUpdated())}purgeBlocksIfNeeded(t){const e=this.getBlocksInOrder().filter(c=>c!=t),n=(c,s)=>s.getLastAccessed()-c.getLastAccessed();e.sort(n);const i=this.params.maxBlocksInCache>0,r=i?this.params.maxBlocksInCache-1:null,o=C_e-1;e.forEach((c,s)=>{const f=c.getState()==="needsLoading"&&s>=o,v=i?s>=r:!1;if(f||v){if(this.isBlockCurrentlyDisplayed(c)||this.isBlockFocused(c))return;this.removeBlockFromCache(c)}})}isBlockFocused(t){const e=this.focusService.getFocusCellToUseAfterRefresh();if(!e||e.rowPinned!=null)return!1;const n=t.getStartRow(),i=t.getEndRow();return e.rowIndex>=n&&e.rowIndex<i}isBlockCurrentlyDisplayed(t){const e=t.getStartRow(),n=t.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(e,n)}removeBlockFromCache(t){t&&this.destroyBlock(t)}checkRowCount(t,e){if(typeof e=="number"&&e>=0)this.rowCount=e,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){const i=(t.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<i&&(this.rowCount=i)}}setRowCount(t,e){this.rowCount=t,$n(e)&&(this.lastRowIndexKnown=e),this.lastRowIndexKnown||this.rowCount%this.params.blockSize===0&&this.rowCount++,this.onCacheUpdated()}forEachNodeDeep(t){const e=new rw;this.getBlocksInOrder().forEach(n=>n.forEachNode(t,e,this.rowCount))}getBlocksInOrder(){const t=(n,i)=>n.getId()-i.getId();return CL(this.blocks).sort(t)}destroyBlock(t){delete this.blocks[t.getId()],this.destroyBean(t),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(t)}onCacheUpdated(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();const t={type:"storeUpdated"};this.eventService.dispatchEvent(t)}}destroyAllBlocksPastVirtualRowCount(){const t=[];this.getBlocksInOrder().forEach(e=>{e.getId()*this.params.blockSize>=this.rowCount&&t.push(e)}),t.length>0&&t.forEach(e=>this.destroyBlock(e))}purgeCache(){this.getBlocksInOrder().forEach(t=>this.removeBlockFromCache(t)),this.lastRowIndexKnown=!1,this.rowCount===0&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()}getRowNodesInRange(t,e){const n=[];let i=-1,r=!1;const o=new rw;let c=!1;return this.getBlocksInOrder().forEach(f=>{if(!c){if(r&&i+1!==f.getId()){c=!0;return}i=f.getId(),f.forEachNode(v=>{const w=v===t||v===e;(r||w)&&n.push(v),w&&(r=!r)},o,this.rowCount)}}),c||r?[]:n}},b_e=class extends wn{constructor(){super(...arguments),this.beanName="rowModel"}wireBeans(t){this.filterManager=t.filterManager,this.sortController=t.sortController,this.selectionService=t.selectionService,this.rowRenderer=t.rowRenderer,this.rowNodeBlockLoader=t.rowNodeBlockLoader}getRowBounds(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}}ensureRowHeightsValid(){return!1}postConstruct(){this.gos.isRowModelType("infinite")&&(this.rowHeight=this.gos.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc(()=>this.destroyCache()),this.verifyProps())}verifyProps(){this.gos.exists("initialGroupOrderComparator")&&Tn("initialGroupOrderComparator cannot be used with Infinite Row Model as sorting is done on the server side")}start(){this.setDatasource(this.gos.get("datasource"))}destroy(){this.destroyDatasource(),super.destroy()}destroyDatasource(){this.datasource&&(this.destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)}addEventListeners(){this.addManagedEventListeners({filterChanged:this.onFilterChanged.bind(this),sortChanged:this.onSortChanged.bind(this),newColumnsLoaded:this.onColumnEverything.bind(this),storeUpdated:this.onCacheUpdated.bind(this)}),this.addManagedPropertyListener("datasource",()=>this.setDatasource(this.gos.get("datasource"))),this.addManagedPropertyListener("cacheBlockSize",()=>this.resetCache()),this.addManagedPropertyListener("rowHeight",()=>{this.rowHeight=this.gos.getRowHeightAsNumber(),this.cacheParams.rowHeight=this.rowHeight,this.updateRowHeights()})}onFilterChanged(){this.reset()}onSortChanged(){this.reset()}onColumnEverything(){let t;this.cacheParams?t=this.isSortModelDifferent():t=!0,t&&this.reset()}isSortModelDifferent(){return!eT(this.cacheParams.sortModel,this.sortController.getSortModel())}getType(){return"infinite"}setDatasource(t){this.destroyDatasource(),this.datasource=t,t&&this.reset()}isEmpty(){return!this.infiniteCache}isRowsToRender(){return!!this.infiniteCache}getNodesInRangeForSelection(t,e){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(t,e):[]}reset(){if(!this.datasource)return;this.gos.getRowIdCallback()!=null||this.selectionService.reset("rowDataChanged"),this.resetCache()}createModelUpdatedEvent(){return{type:"modelUpdated",newPage:!1,newPageSize:!1,newData:!1,keepRenderedRows:!0,animate:!1}}resetCache(){var e;this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:((e=this.filterManager)==null?void 0:e.getFilterModel())??{},sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.gos.get("infiniteInitialRowCount"),maxBlocksInCache:this.gos.get("maxBlocksInCache"),rowHeight:this.gos.getRowHeightAsNumber(),overflowSize:this.gos.get("cacheOverflowSize"),blockSize:this.gos.get("cacheBlockSize"),lastAccessedSequence:new rw},this.infiniteCache=this.createBean(new S_e(this.cacheParams)),this.eventService.dispatchEventOnce({type:"rowCountReady"});const t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)}updateRowHeights(){this.forEachNode(e=>{e.setRowHeight(this.rowHeight),e.setRowTop(this.rowHeight*e.rowIndex)});const t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)}destroyCache(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))}onCacheUpdated(){const t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)}getRow(t){if(this.infiniteCache&&!(t>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(t)}getRowNode(t){let e;return this.forEachNode(n=>{n.id===t&&(e=n)}),e}forEachNode(t){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(t)}getTopLevelRowCount(){return this.getRowCount()}getTopLevelRowDisplayedIndex(t){return t}getRowIndexAtPixel(t){if(this.rowHeight!==0){const e=Math.floor(t/this.rowHeight),n=this.getRowCount()-1;return e>n?n:e}return 0}getRowCount(){return this.infiniteCache?this.infiniteCache.getRowCount():0}isRowPresent(t){return!!this.getRowNode(t.id)}refreshCache(){this.infiniteCache&&this.infiniteCache.refreshCache()}purgeCache(){this.infiniteCache&&this.infiniteCache.purgeCache()}isLastRowIndexKnown(){return this.infiniteCache?this.infiniteCache.isLastRowIndexKnown():!1}setRowCount(t,e){this.infiniteCache&&this.infiniteCache.setRowCount(t,e)}};function E_e(t){var e,n;(n=(e=t.rowModelHelperService)==null?void 0:e.getInfiniteRowModel())==null||n.refreshCache()}function M_e(t){var e,n;(n=(e=t.rowModelHelperService)==null?void 0:e.getInfiniteRowModel())==null||n.purgeCache()}function R_e(t){var e,n;return(n=(e=t.rowModelHelperService)==null?void 0:e.getInfiniteRowModel())==null?void 0:n.getRowCount()}function T_e(t){var e,n;return(n=(e=t.rowModelHelperService)==null?void 0:e.getInfiniteRowModel())==null?void 0:n.isLastRowIndexKnown()}var W3="32.0.2",Iq={version:W3,moduleName:"@ag-grid-community/infinite-row-model-core",rowModel:"infinite",beans:[b_e],dependantModules:[Tpe]},A_e={version:W3,moduleName:"@ag-grid-community/infinite-row-model-api",beans:[Tq],apiFunctions:{refreshInfiniteCache:E_e,purgeInfiniteCache:M_e,getInfiniteRowCount:R_e,isLastRowIndexKnown:T_e},dependantModules:[Iq,Gye]},P_e={version:W3,moduleName:"@ag-grid-community/infinite-row-model",dependantModules:[Iq,A_e]};xl.__registerModules([Sq,u_e,P_e,x_e],!1,void 0);var sc=kn.createContext({}),HS=(t,e,n,i)=>{if(!t||t.componentFromFramework||e.isDestroyed())return;const o=t.newAgStackInstance();if(o==null)return;let c,s,f=!1;return o.then(v=>{if(f){e.destroyBean(v);return}c=v,s=c.getGui(),n.appendChild(s),cH(i,c)}),()=>{f=!0,c&&(s&&s.parentElement&&s.parentElement.removeChild(s),e.destroyBean(c),i&&cH(i,void 0))}},cH=(t,e)=>{if(t)if(t instanceof Function)t(e);else{const n=t;n.current=e}},Kh=(...t)=>t.filter(n=>n!=null&&n!=="").join(" "),Ku=class Dq{constructor(...e){this.classesMap={},e.forEach(n=>{this.classesMap[n]=!0})}setClass(e,n){if(!!this.classesMap[e]==n)return this;const r=new Dq;return r.classesMap={...this.classesMap},r.classesMap[e]=n,r}toString(){return Object.keys(this.classesMap).filter(n=>this.classesMap[n]).join(" ")}},Mw=t=>{const e=()=>typeof Symbol=="function"&&Symbol.for,n=()=>e()?Symbol.for("react.memo"):60115;return typeof t=="function"&&!(t.prototype&&t.prototype.isReactComponent)||typeof t=="object"&&t.$$typeof===n()},Fq=VR.createRoot!=null&&VR.flushSync!=null;function I_e(){return!Fq}var uR=!1;function D_e(t){return uR||setTimeout(()=>uR=!1,0),uR=!0,t()}var j3=(t,e)=>{Fq&&t&&!uR?VR.flushSync(e):e()};function $3(t,e,n){if(e==null||t==null)return e;if(t===e||e.length===0&&t.length===0)return t;if(n||t.length===0&&e.length>0||t.length>0&&e.length===0)return e;const i=[],r=[],o=new Map,c=new Map;for(let s=0;s<e.length;s++){const f=e[s];c.set(f.getInstanceId(),f)}for(let s=0;s<t.length;s++){const f=t[s];o.set(f.getInstanceId(),f),c.has(f.getInstanceId())&&i.push(f)}for(let s=0;s<e.length;s++){const f=e[s],v=f.getInstanceId();o.has(v)||r.push(f)}return i.length===t.length&&r.length===0?t:i.length===0&&r.length===e.length?e:i.length===0?r:r.length===0?i:[...i,...r]}var Lq=Q.forwardRef((t,e)=>{var ft;const{ctrlsFactory:n,context:i}=Q.useContext(sc),r=Q.useRef(null),o=Q.useRef(null),c=Q.useRef(null),s=Q.useRef(null),f=Q.useRef(null),v=Q.useRef(),[w,C]=Q.useState(),[M,F]=Q.useState(),[N,z]=Q.useState(),[L,P]=Q.useState(()=>new Ku),[H,j]=Q.useState(()=>new Ku("ag-hidden")),[q,le]=Q.useState(()=>new Ku("ag-hidden")),[ce,ae]=Q.useState(()=>new Ku("ag-invisible"));Q.useImperativeHandle(e,()=>({refresh(){return!1}})),Q.useLayoutEffect(()=>HS(w,i,o.current),[w]);const pe=Q.useCallback(Me=>{if(r.current=Me,!r.current){i.destroyBean(v.current),v.current=null;return}const $e={setInnerRenderer:(Mt,Gt)=>{C(Mt),z(Gt)},setChildCount:Mt=>F(Mt),addOrRemoveCssClass:(Mt,Gt)=>P(Xt=>Xt.setClass(Mt,Gt)),setContractedDisplayed:Mt=>le(Gt=>Gt.setClass("ag-hidden",!Mt)),setExpandedDisplayed:Mt=>j(Gt=>Gt.setClass("ag-hidden",!Mt)),setCheckboxVisible:Mt=>ae(Gt=>Gt.setClass("ag-invisible",!Mt))},ut=n.getInstance("groupCellRendererCtrl");ut&&(v.current=i.createBean(ut),v.current.init($e,r.current,c.current,s.current,f.current,Lq,t))},[]),fe=Q.useMemo(()=>`ag-cell-wrapper ${L.toString()}`,[L]),ue=Q.useMemo(()=>`ag-group-expanded ${H.toString()}`,[H]),Ee=Q.useMemo(()=>`ag-group-contracted ${q.toString()}`,[q]),We=Q.useMemo(()=>`ag-group-checkbox ${ce.toString()}`,[ce]),rt=w&&w.componentFromFramework,tt=rt?w.componentClass:void 0,Ye=w==null&&N!=null,qe=wf(N,!0);return kn.createElement("span",{className:fe,ref:pe,...t.colDef?{}:{role:(ft=v.current)==null?void 0:ft.getCellAriaRole()}},kn.createElement("span",{className:ue,ref:s}),kn.createElement("span",{className:Ee,ref:f}),kn.createElement("span",{className:We,ref:c}),kn.createElement("span",{className:"ag-group-value",ref:o},Ye&&kn.createElement(kn.Fragment,null,qe),rt&&kn.createElement(tt,{...w.params})),kn.createElement("span",{className:"ag-group-child-count"},M))}),uH=Lq,q3=Q.createContext({setMethods:()=>{}}),F_e=t=>{const{initialProps:e,addUpdateCallback:n,CustomComponentClass:i,setMethods:r}=t,[o,c]=Q.useState(e);return Q.useEffect(()=>{n(s=>c(s))},[]),kn.createElement(q3.Provider,{value:{setMethods:r}},kn.createElement(i,{...o}))},L_e=Q.memo(F_e),O_e=0;function hH(){return`agPortalKey_${++O_e}`}var Oq=class{constructor(t,e,n,i){this.portal=null,this.oldPortal=null,this.reactComponent=t,this.portalManager=e,this.componentType=n,this.suppressFallbackMethods=!!i,this.statelessComponent=this.isStateless(this.reactComponent),this.key=hH(),this.portalKey=hH(),this.instanceCreated=this.isStatelessComponent()?Zo.resolve(!1):new Zo(r=>{this.resolveInstanceCreated=r})}getGui(){return this.eParentElement}getRootElement(){return this.eParentElement.firstChild}destroy(){this.componentInstance&&typeof this.componentInstance.destroy=="function"&&this.componentInstance.destroy();const t=this.portal;t&&this.portalManager.destroyPortal(t)}createParentElement(t){const e=this.portalManager.getComponentWrappingElement(),n=document.createElement(e||"div");return n.classList.add("ag-react-container"),t.reactContainer=n,n}addParentContainerStyleAndClasses(){this.componentInstance&&(this.componentInstance.getReactContainerStyle&&this.componentInstance.getReactContainerStyle()&&(Tn('Since v31.1 "getReactContainerStyle" is deprecated. Apply styling directly to ".ag-react-container" if needed.'),Object.assign(this.eParentElement.style,this.componentInstance.getReactContainerStyle())),this.componentInstance.getReactContainerClasses&&this.componentInstance.getReactContainerClasses()&&(Tn('Since v31.1 "getReactContainerClasses" is deprecated. Apply styling directly to ".ag-react-container" if needed.'),this.componentInstance.getReactContainerClasses().forEach(e=>this.eParentElement.classList.add(e))))}statelessComponentRendered(){return this.eParentElement.childElementCount>0||this.eParentElement.childNodes.length>0}getFrameworkComponentInstance(){return this.componentInstance}isStatelessComponent(){return this.statelessComponent}getReactComponentName(){return this.reactComponent.name}getMemoType(){return this.hasSymbol()?Symbol.for("react.memo"):60115}hasSymbol(){return typeof Symbol=="function"&&Symbol.for}isStateless(t){return typeof t=="function"&&!(t.prototype&&t.prototype.isReactComponent)||typeof t=="object"&&t.$$typeof===this.getMemoType()}hasMethod(t){const e=this.getFrameworkComponentInstance();return!!e&&e[t]!=null||this.fallbackMethodAvailable(t)}callMethod(t,e){const n=this.getFrameworkComponentInstance();if(this.isStatelessComponent())return this.fallbackMethod(t,e&&e[0]?e[0]:{});if(!n){setTimeout(()=>this.callMethod(t,e));return}const i=n[t];if(i)return i.apply(n,e);if(this.fallbackMethodAvailable(t))return this.fallbackMethod(t,e&&e[0]?e[0]:{})}addMethod(t,e){this[t]=e}init(t){return this.eParentElement=this.createParentElement(t),this.params=t,this.createOrUpdatePortal(t),new Zo(e=>this.createReactComponent(e))}createOrUpdatePortal(t){this.isStatelessComponent()||(this.ref=e=>{var n;this.componentInstance=e,this.addParentContainerStyleAndClasses(),(n=this.resolveInstanceCreated)==null||n.call(this,!0),this.resolveInstanceCreated=void 0},t.ref=this.ref),this.reactElement=this.createElement(this.reactComponent,{...t,key:this.key}),this.portal=rh.createPortal(this.reactElement,this.eParentElement,this.portalKey)}createElement(t,e){return Q.createElement(t,e)}createReactComponent(t){this.portalManager.mountReactPortal(this.portal,this,t)}rendered(){return this.isStatelessComponent()&&this.statelessComponentRendered()||!!(!this.isStatelessComponent()&&this.getFrameworkComponentInstance())}refreshComponent(t){this.oldPortal=this.portal,this.createOrUpdatePortal(t),this.portalManager.updateReactPortal(this.oldPortal,this.portal)}fallbackMethod(t,e){const n=this[`${t}Component`];if(!this.suppressFallbackMethods&&n)return n.bind(this)(e)}fallbackMethodAvailable(t){return this.suppressFallbackMethods?!1:!!this[`${t}Component`]}};function Z3(t,e,n){t.forEach(i=>{const r=e[i];r&&(n[i]=r)})}var um=class extends Oq{constructor(){super(...arguments),this.awaitUpdateCallback=new Zo(t=>{this.resolveUpdateCallback=t}),this.wrapperComponent=L_e}init(t){return this.sourceParams=t,super.init(this.getProps())}addMethod(){}getInstance(){return this.instanceCreated.then(()=>this.componentInstance)}getFrameworkComponentInstance(){return this}createElement(t,e){return super.createElement(this.wrapperComponent,{initialProps:e,CustomComponentClass:t,setMethods:n=>this.setMethods(n),addUpdateCallback:n=>{this.updateCallback=()=>(n(this.getProps()),new Zo(i=>{setTimeout(()=>{i()})})),this.resolveUpdateCallback()}})}setMethods(t){this.providedMethods=t,Z3(this.getOptionalMethods(),this.providedMethods,this)}getOptionalMethods(){return[]}getProps(){return{...this.sourceParams,key:this.key,ref:this.ref}}refreshProps(){return this.updateCallback?this.updateCallback():new Zo(t=>this.awaitUpdateCallback.then(()=>{this.updateCallback().then(()=>t())}))}},k_e=class extends um{refresh(t){return this.sourceParams=t,this.refreshProps(),!0}},N_e=class extends um{constructor(){super(...arguments),this.date=null,this.onDateChange=t=>this.updateDate(t)}getDate(){return this.date}setDate(t){this.date=t,this.refreshProps()}refresh(t){this.sourceParams=t,this.refreshProps()}getOptionalMethods(){return["afterGuiAttached","setInputPlaceholder","setInputAriaLabel","setDisabled"]}updateDate(t){this.setDate(t),this.sourceParams.onDateChanged()}getProps(){const t=super.getProps();return t.date=this.date,t.onDateChange=this.onDateChange,delete t.onDateChanged,t}},B_e=class extends um{constructor(){super(...arguments),this.model=null,this.onModelChange=t=>this.updateModel(t),this.onUiChange=()=>this.sourceParams.filterChangedCallback(),this.expectingNewMethods=!0}isFilterActive(){return this.model!=null}doesFilterPass(t){return this.providedMethods.doesFilterPass(t)}getModel(){return this.model}setModel(t){return this.expectingNewMethods=!0,this.model=t,this.refreshProps()}refresh(t){return this.sourceParams=t,this.refreshProps(),!0}getOptionalMethods(){return["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onAnyFilterChanged"]}setMethods(t){var e;this.expectingNewMethods===!1&&((e=this.providedMethods)==null?void 0:e.doesFilterPass)!==(t==null?void 0:t.doesFilterPass)&&setTimeout(()=>{this.sourceParams.filterChangedCallback()}),this.expectingNewMethods=!1,super.setMethods(t)}updateModel(t){this.setModel(t).then(()=>this.sourceParams.filterChangedCallback())}getProps(){const t=super.getProps();return t.model=this.model,t.onModelChange=this.onModelChange,t.onUiChange=this.onUiChange,delete t.filterChangedCallback,delete t.filterModifiedCallback,delete t.valueGetter,t}};function kq(t,e){t.parentFilterInstance(n=>{(n.setModel(e)||Zo.resolve()).then(()=>{t.filterParams.filterChangedCallback()})})}var z_e=class{constructor(t,e){this.floatingFilterParams=t,this.refreshProps=e,this.model=null,this.onModelChange=n=>this.updateModel(n)}getProps(){return{...this.floatingFilterParams,model:this.model,onModelChange:this.onModelChange}}onParentModelChanged(t){this.model=t,this.refreshProps()}refresh(t){this.floatingFilterParams=t,this.refreshProps()}setMethods(t){Z3(this.getOptionalMethods(),t,this)}getOptionalMethods(){return["afterGuiAttached"]}updateModel(t){this.model=t,this.refreshProps(),kq(this.floatingFilterParams,t)}},U_e=class extends um{constructor(){super(...arguments),this.model=null,this.onModelChange=t=>this.updateModel(t)}onParentModelChanged(t){this.model=t,this.refreshProps()}refresh(t){this.sourceParams=t,this.refreshProps()}getOptionalMethods(){return["afterGuiAttached"]}updateModel(t){this.model=t,this.refreshProps(),kq(this.sourceParams,t)}getProps(){const t=super.getProps();return t.model=this.model,t.onModelChange=this.onModelChange,t}},V_e=class extends um{refresh(t){this.sourceParams=t,this.refreshProps()}},G_e=class extends um{constructor(){super(...arguments),this.active=!1,this.expanded=!1,this.onActiveChange=t=>this.updateActive(t)}setActive(t){this.awaitSetActive(t)}setExpanded(t){this.expanded=t,this.refreshProps()}getOptionalMethods(){return["select","configureDefaults"]}awaitSetActive(t){return this.active=t,this.refreshProps()}updateActive(t){const e=this.awaitSetActive(t);t&&e.then(()=>this.sourceParams.onItemActivated())}getProps(){const t=super.getProps();return t.active=this.active,t.expanded=this.expanded,t.onActiveChange=this.onActiveChange,delete t.onItemActivated,t}},H_e=class extends um{refresh(t){this.sourceParams=t,this.refreshProps()}},W_e=class extends um{refresh(t){return this.sourceParams=t,this.refreshProps(),!0}},j_e=class extends um{constructor(){super(...arguments),this.onStateChange=t=>this.updateState(t)}refresh(t){return this.sourceParams=t,this.refreshProps(),!0}getState(){return this.state}updateState(t){this.state=t,this.refreshProps(),this.sourceParams.onStateUpdated()}getProps(){const t=super.getProps();return t.state=this.state,t.onStateChange=this.onStateChange,t}};function X3(){Tn("As of v32, using custom components with `reactiveCustomComponents = false` is deprecated.")}var $_e=1e3,q_e=class{constructor(t,e,n){this.destroyed=!1,this.portals=[],this.hasPendingPortalUpdate=!1,this.wrappingElement=e||"div",this.refresher=t,this.maxComponentCreationTimeMs=n||$_e}getPortals(){return this.portals}destroy(){this.destroyed=!0}destroyPortal(t){this.portals=this.portals.filter(e=>e!==t),this.batchUpdate()}getComponentWrappingElement(){return this.wrappingElement}mountReactPortal(t,e,n){this.portals=[...this.portals,t],this.waitForInstance(e,n),this.batchUpdate()}updateReactPortal(t,e){this.portals[this.portals.indexOf(t)]=e,this.batchUpdate()}batchUpdate(){this.hasPendingPortalUpdate||(setTimeout(()=>{this.destroyed||(this.refresher(),this.hasPendingPortalUpdate=!1)}),this.hasPendingPortalUpdate=!0)}waitForInstance(t,e,n=Date.now()){if(this.destroyed){e(null);return}if(t.rendered())e(t);else{if(Date.now()-n>=this.maxComponentCreationTimeMs&&!this.hasPendingPortalUpdate)return;window.setTimeout(()=>{this.waitForInstance(t,e,n)})}}},Z_e=t=>{const{ctrl:e}=t,n=e.isAlive(),{context:i}=Q.useContext(sc),r=n?e.getColId():void 0,[o,c]=Q.useState(),s=Q.useRef(null),f=Q.useRef(null),v=Q.useRef(null),w=Q.useRef(),C=Q.useRef();n&&!C.current&&(C.current=new US(()=>s.current));const M=Q.useCallback(L=>{var j;if(s.current=L,!s.current||!n)return;const P={setWidth:q=>{s.current&&(s.current.style.width=q)},addOrRemoveCssClass:(q,le)=>C.current.addOrRemoveCssClass(q,le),setAriaSort:q=>{s.current&&(q?eue(s.current,q):tue(s.current))},setUserCompDetails:q=>c(q),getUserCompInstance:()=>w.current||void 0};e.setComp(P,s.current,f.current,v.current);const H=e.getSelectAllGui();(j=f.current)==null||j.insertAdjacentElement("afterend",H)},[]);Q.useLayoutEffect(()=>HS(o,i,v.current,w),[o]),Q.useEffect(()=>{e.setDragSource(s.current)},[o]);const F=Q.useMemo(()=>!!((o==null?void 0:o.componentFromFramework)&&Mw(o.componentClass)),[o]),N=o&&o.componentFromFramework,z=o&&o.componentClass;return kn.createElement("div",{ref:M,className:"ag-header-cell","col-id":r,role:"columnheader"},kn.createElement("div",{ref:f,className:"ag-header-cell-resize",role:"presentation"}),kn.createElement("div",{ref:v,className:"ag-header-cell-comp-wrapper",role:"presentation"},N&&F&&kn.createElement(z,{...o.params}),N&&!F&&kn.createElement(z,{...o.params,ref:w})))},X_e=Q.memo(Z_e),K_e=t=>{const{context:e,gos:n}=Q.useContext(sc),[i,r]=Q.useState(()=>new Ku("ag-header-cell","ag-floating-filter")),[o,c]=Q.useState(()=>new Ku),[s,f]=Q.useState(()=>new Ku("ag-floating-filter-button","ag-hidden")),[v,w]=Q.useState("false"),[C,M]=Q.useState(),[,F]=Q.useState(1),N=Q.useRef(null),z=Q.useRef(null),L=Q.useRef(null),P=Q.useRef(null),H=Q.useRef(),j=Q.useRef(),q=qe=>{qe!=null&&H.current&&H.current(qe)},{ctrl:le}=t,ce=Q.useCallback(qe=>{if(N.current=qe,!N.current)return;j.current=new Zo(Me=>{H.current=Me});const ft={addOrRemoveCssClass:(Me,$e)=>r(ut=>ut.setClass(Me,$e)),addOrRemoveBodyCssClass:(Me,$e)=>c(ut=>ut.setClass(Me,$e)),setButtonWrapperDisplayed:Me=>{f($e=>$e.setClass("ag-hidden",!Me)),w(Me?"false":"true")},setWidth:Me=>{N.current&&(N.current.style.width=Me)},setCompDetails:Me=>M(Me),getFloatingFilterComp:()=>j.current?j.current:null,setMenuIcon:Me=>{var $e;return($e=P.current)==null?void 0:$e.appendChild(Me)}};le.setComp(ft,N.current,P.current,z.current)},[]);Q.useLayoutEffect(()=>HS(C,e,z.current,q),[C]);const ae=Q.useMemo(()=>i.toString(),[i]),pe=Q.useMemo(()=>o.toString(),[o]),fe=Q.useMemo(()=>s.toString(),[s]),ue=Q.useMemo(()=>!!(C&&C.componentFromFramework&&Mw(C.componentClass)),[C]),Ee=Q.useMemo(()=>n.get("reactiveCustomComponents"),[]),We=Q.useMemo(()=>{if(C)if(Ee){const qe=new z_e(C.params,()=>F(ft=>ft+1));return q(qe),qe}else C.componentFromFramework&&X3()},[C]),rt=We==null?void 0:We.getProps(),tt=C&&C.componentFromFramework,Ye=C&&C.componentClass;return kn.createElement("div",{ref:ce,className:ae,role:"gridcell"},kn.createElement("div",{ref:z,className:pe,role:"presentation"},tt&&!Ee&&kn.createElement(Ye,{...C.params,ref:ue?()=>{}:q}),tt&&Ee&&kn.createElement(q3.Provider,{value:{setMethods:qe=>We.setMethods(qe)}},kn.createElement(Ye,{...rt}))),kn.createElement("div",{ref:L,"aria-hidden":v,className:fe,role:"presentation"},kn.createElement("button",{ref:P,type:"button",className:"ag-button ag-floating-filter-button-button",tabIndex:-1})))},Y_e=Q.memo(K_e),J_e=t=>{const{context:e}=Q.useContext(sc),{ctrl:n}=t,[i,r]=Q.useState(()=>new Ku),[o,c]=Q.useState(()=>new Ku),[s,f]=Q.useState("false"),[v,w]=Q.useState(),[C,M]=Q.useState(),F=Q.useMemo(()=>n.getColId(),[]),N=Q.useRef(null),z=Q.useRef(null),L=Q.useRef(),P=Q.useCallback(ae=>{if(N.current=ae,!N.current)return;const pe={setWidth:fe=>{N.current&&(N.current.style.width=fe)},addOrRemoveCssClass:(fe,ue)=>r(Ee=>Ee.setClass(fe,ue)),setUserCompDetails:fe=>M(fe),setResizableDisplayed:fe=>{c(ue=>ue.setClass("ag-hidden",!fe)),f(fe?"false":"true")},setAriaExpanded:fe=>w(fe),getUserCompInstance:()=>L.current||void 0};n.setComp(pe,N.current,z.current)},[]);Q.useLayoutEffect(()=>HS(C,e,N.current),[C]),Q.useEffect(()=>{N.current&&n.setDragSource(N.current)},[C]);const H=Q.useMemo(()=>!!((C==null?void 0:C.componentFromFramework)&&Mw(C.componentClass)),[C]),j=Q.useMemo(()=>"ag-header-group-cell "+i.toString(),[i]),q=Q.useMemo(()=>"ag-header-cell-resize "+o.toString(),[o]),le=C&&C.componentFromFramework,ce=C&&C.componentClass;return kn.createElement("div",{ref:P,className:j,"col-id":F,role:"columnheader","aria-expanded":v},le&&H&&kn.createElement(ce,{...C.params}),le&&!H&&kn.createElement(ce,{...C.params,ref:L}),kn.createElement("div",{ref:z,"aria-hidden":s,className:q}))},Q_e=Q.memo(J_e),e0e=t=>{const{ctrl:e}=t,{topOffset:n,rowHeight:i}=Q.useMemo(()=>e.getTopAndHeight(),[]),r=e.getAriaRowIndex(),o=e.getHeaderRowClass(),[c,s]=Q.useState(()=>i+"px"),[f,v]=Q.useState(()=>n+"px"),w=Q.useRef(null),C=Q.useRef(null),[M,F]=Q.useState(()=>e.getHeaderCtrls()),N=Q.useRef(null),z=Q.useCallback(H=>{if(N.current=H,!H)return;const j={setHeight:q=>s(q),setTop:q=>v(q),setHeaderCtrls:(q,le,ce)=>{C.current=w.current,w.current=q;const ae=$3(C.current,q,le);ae!==C.current&&j3(ce,()=>F(ae))},setWidth:q=>{N.current&&(N.current.style.width=q)}};e.setComp(j,!1)},[]),L=Q.useMemo(()=>({height:c,top:f}),[c,f]),P=Q.useCallback(H=>{switch(e.getType()){case IL.COLUMN_GROUP:return kn.createElement(Q_e,{ctrl:H,key:H.getInstanceId()});case IL.FLOATING_FILTER:return kn.createElement(Y_e,{ctrl:H,key:H.getInstanceId()});default:return kn.createElement(X_e,{ctrl:H,key:H.getInstanceId()})}},[]);return kn.createElement("div",{ref:z,className:o,role:"row",style:L,"aria-rowindex":r},M.map(P))},t0e=Q.memo(e0e),n0e=t=>{const[e,n]=Q.useState(!0),[i,r]=Q.useState([]),{context:o}=Q.useContext(sc),c=Q.useRef(null),s=Q.useRef(null),f=Q.useRef(null),v=t.pinned==="left",w=t.pinned==="right",C=!v&&!w,M=Q.useCallback(z=>{if(c.current=z,!c.current){o.destroyBean(f.current),f.current=null;return}const L={setDisplayed:n,setCtrls:P=>r(P),setCenterWidth:P=>{s.current&&(s.current.style.width=P)},setViewportScrollLeft:P=>{c.current&&(c.current.scrollLeft=P)},setPinnedContainerWidth:P=>{c.current&&(c.current.style.width=P,c.current.style.minWidth=P,c.current.style.maxWidth=P)}};f.current=o.createBean(new Ide(t.pinned)),f.current.setComp(L,c.current)},[]),F=e?"":"ag-hidden",N=()=>i.map(z=>kn.createElement(t0e,{ctrl:z,key:z.getInstanceId()}));return kn.createElement(kn.Fragment,null,v&&kn.createElement("div",{ref:M,className:"ag-pinned-left-header "+F,"aria-hidden":!e,role:"rowgroup"},N()),w&&kn.createElement("div",{ref:M,className:"ag-pinned-right-header "+F,"aria-hidden":!e,role:"rowgroup"},N()),C&&kn.createElement("div",{ref:M,className:"ag-header-viewport "+F,role:"presentation"},kn.createElement("div",{ref:s,className:"ag-header-container",role:"rowgroup"},N())))},ID=Q.memo(n0e),i0e=()=>{const[t,e]=Q.useState(()=>new Ku),[n,i]=Q.useState(),{context:r}=Q.useContext(sc),o=Q.useRef(null),c=Q.useRef(null),s=Q.useCallback(w=>{if(o.current=w,!w){r.destroyBean(c.current),c.current=null;return}const C={addOrRemoveCssClass:(M,F)=>e(N=>N.setClass(M,F)),setHeightAndMinHeight:M=>i(M)};c.current=r.createBean(new gde),c.current.setComp(C,o.current,o.current)},[]),f=Q.useMemo(()=>"ag-header "+t.toString(),[t]),v=Q.useMemo(()=>({height:n,minHeight:n}),[n]);return kn.createElement("div",{ref:s,className:f,style:v,role:"presentation"},kn.createElement(ID,{pinned:"left"}),kn.createElement(ID,{pinned:null}),kn.createElement(ID,{pinned:"right"}))},r0e=Q.memo(i0e),s0e=(t,e)=>{Q.useEffect(()=>{const n=e.current;if(n){const i=n.parentElement;if(i){const r=document.createComment(t);return i.insertBefore(r,n),()=>{i.removeChild(r)}}}},[t])},Dy=s0e,o0e=class{constructor(t,e){this.cellEditorParams=t,this.refreshProps=e,this.instanceCreated=new Zo(n=>{this.resolveInstanceCreated=n}),this.onValueChange=n=>this.updateValue(n),this.value=t.value}getProps(){return{...this.cellEditorParams,initialValue:this.cellEditorParams.value,value:this.value,onValueChange:this.onValueChange}}getValue(){return this.value}refresh(t){this.cellEditorParams=t,this.refreshProps()}setMethods(t){Z3(this.getOptionalMethods(),t,this)}getInstance(){return this.instanceCreated.then(()=>this.componentInstance)}setRef(t){var e;this.componentInstance=t,(e=this.resolveInstanceCreated)==null||e.call(this),this.resolveInstanceCreated=void 0}getOptionalMethods(){return["isCancelBeforeStart","isCancelAfterEnd","focusIn","focusOut","afterGuiAttached"]}updateValue(t){this.value=t,this.refreshProps()}},a0e=t=>{const e=Q.useRef(t),n=Q.useRef(),i=Q.useRef(!1),r=Q.useRef(!1),[,o]=Q.useState(0);i.current&&(r.current=!0),Q.useEffect(()=>(i.current||(n.current=e.current(),i.current=!0),o(c=>c+1),()=>{r.current&&n.current&&n.current()}),[])},l0e=t=>{const[e,n]=Q.useState(),{context:i,popupService:r,localeService:o,gos:c,editService:s}=Q.useContext(sc);return a0e(()=>{const{editDetails:f,cellCtrl:v,eParentCell:w}=t,{compDetails:C}=f,M=c.get("stopEditingWhenCellsLoseFocus"),F=i.createBean(s.createPopupEditorWrapper(C.params)),N=F.getGui();if(t.jsChildComp){const q=t.jsChildComp.getGui();q&&N.appendChild(q)}const z={column:v.getColumn(),rowNode:v.getRowNode(),type:"popupCellEditor",eventSource:w,ePopup:N,position:f.popupPosition,keepWithinBounds:!0},L=r.positionPopupByComponent.bind(r,z),P=o.getLocaleTextFunc(),H=r.addPopup({modal:M,eChild:N,closeOnEsc:!0,closedCallback:()=>{v.onPopupEditorClosed()},anchorToElement:w,positionCallback:L,ariaLabel:P("ariaLabelCellEditor","Cell Editor")}),j=H?H.hideFunc:void 0;return n(F),t.jsChildComp&&t.jsChildComp.afterGuiAttached&&t.jsChildComp.afterGuiAttached(),()=>{j!=null&&j(),i.destroyBean(F)}}),kn.createElement(kn.Fragment,null,e&&t.wrappedContent&&rh.createPortal(t.wrappedContent,e.getGui()))},dH=Q.memo(l0e),c0e=(t,e,n,i,r,o)=>{const{context:c}=Q.useContext(sc),s=Q.useCallback(()=>{const f=r.current;if(!f)return;const v=f.getGui();v&&v.parentElement&&v.parentElement.removeChild(v),c.destroyBean(f),r.current=void 0},[]);Q.useEffect(()=>{const f=t!=null,v=t&&t.compDetails&&!t.compDetails.componentFromFramework,w=e&&n==null;if(!(f&&v&&!w)){s();return}const M=t.compDetails;if(r.current){const N=r.current,L=N.refresh!=null&&t.force==!1?N.refresh(M.params):!1;if(L===!0||L===void 0)return;s()}const F=M.newAgStackInstance();F!=null&&F.then(N=>{if(!N)return;const z=N.getGui();if(!z)return;(e?n:o.current).appendChild(z),r.current=N})},[t,e,i]),Q.useEffect(()=>s,[])},u0e=c0e,h0e=(t,e,n)=>{const{compProxy:i}=t;n(i);const r=i.getProps(),o=Mw(e);return kn.createElement(q3.Provider,{value:{setMethods:c=>i.setMethods(c)}},o&&kn.createElement(e,{...r}),!o&&kn.createElement(e,{...r,ref:c=>i.setRef(c)}))},fH=(t,e,n)=>{const i=t.compProxy;return kn.createElement(kn.Fragment,null,!i&&kn.createElement(e,{...t.compDetails.params,ref:n}),i&&h0e(t,e,n))},d0e=(t,e,n,i,r,o)=>{const c=t.compDetails,s=c.componentClass,f=c.componentFromFramework&&!t.popup,v=c.componentFromFramework&&t.popup,w=!c.componentFromFramework&&t.popup;return kn.createElement(kn.Fragment,null,f&&fH(t,s,e),v&&kn.createElement(dH,{editDetails:t,cellCtrl:r,eParentCell:i,wrappedContent:fH(t,s,n)}),w&&o&&kn.createElement(dH,{editDetails:t,cellCtrl:r,eParentCell:i,jsChildComp:o}))},f0e=(t,e,n,i,r,o,c)=>{const{compDetails:s,value:f}=t,v=!s,w=s&&s.componentFromFramework,C=s&&s.componentClass,M=f!=null&&f.toString?f.toString():f,F=()=>kn.createElement(kn.Fragment,null,v&&kn.createElement(kn.Fragment,null,M),w&&!o&&kn.createElement(C,{...s.params,key:e,ref:i}),w&&o&&kn.createElement(C,{...s.params,key:e}));return kn.createElement(kn.Fragment,null,r?kn.createElement("span",{role:"presentation",id:`cell-${n}`,className:"ag-cell-value",ref:c},F()):F())},p0e=t=>{const{context:e}=Q.useContext(sc),{cellCtrl:n,printLayout:i,editingRow:r}=t,o=n.getTabIndex(),c=n.getColumnIdSanitised(),s=n.getInstanceId(),[f,v]=Q.useState(()=>n.isCellRenderer()?void 0:{compDetails:void 0,value:n.getValueToDisplay(),force:!1}),[w,C]=Q.useState(),[M,F]=Q.useState(1),[N,z]=Q.useState(),[L,P]=Q.useState(!1),[H,j]=Q.useState(!1),[q,le]=Q.useState(!1),[ce,ae]=Q.useState(),pe=Q.useMemo(()=>n.isForceWrapper(),[n]),fe=Q.useMemo(()=>n.getCellAriaRole(),[n]),ue=Q.useRef(null),Ee=Q.useRef(null),We=Q.useRef(),rt=Q.useRef(),tt=Q.useRef(),Ye=Q.useRef([]),qe=Q.useRef(),[ft,Me]=Q.useState(0),$e=Q.useCallback(Kt=>{qe.current=Kt,Me(bt=>bt+1)},[]),ut=f!=null&&(L||q||H),Mt=pe||ut,Gt=Q.useCallback((Kt,bt)=>{rt.current=bt,bt&&bt.isCancelBeforeStart&&bt.isCancelBeforeStart()&&setTimeout(()=>{n.stopEditing(!0),n.focusCell(!0)})},[n]),Xt=Q.useCallback(Kt=>Gt(!0,Kt),[Gt]),Qe=Q.useCallback(Kt=>Gt(!1,Kt),[Gt]),Ge=Q.useRef();Ge.current||(Ge.current=new US(()=>ue.current)),u0e(f,Mt,qe.current,ft,We,ue);const He=Q.useRef();Q.useLayoutEffect(()=>{const Kt=He.current,bt=f;if(He.current=f,Kt==null||Kt.compDetails==null||bt==null||bt.compDetails==null)return;const Dt=Kt.compDetails,_e=bt.compDetails;if(Dt.componentClass!=_e.componentClass||Ee.current==null||Ee.current.refresh==null)return;Ee.current.refresh(_e.params)!=!0&&F(Ot=>Ot+1)},[f]),Q.useLayoutEffect(()=>{if(!(w&&!w.compDetails.componentFromFramework))return;const bt=w.compDetails,Dt=w.popup===!0,_e=bt.newAgStackInstance();return _e.then(At=>{if(!At)return;const Ot=At.getGui();if(Gt(Dt,At),!Dt){const tn=(pe?tt:ue).current;tn==null||tn.appendChild(Ot),At.afterGuiAttached&&At.afterGuiAttached()}ae(At)}),()=>{_e.then(At=>{const Ot=At.getGui();e.destroyBean(At),Gt(Dt,void 0),ae(void 0),Ot&&Ot.parentElement&&Ot.parentElement.removeChild(Ot)})}},[w]);const De=Q.useCallback(Kt=>{if(tt.current=Kt,!tt.current){Ye.current.forEach(Dt=>Dt()),Ye.current=[];return}const bt=Dt=>{var _e;if(Dt){const At=Dt.getGui();(_e=tt.current)==null||_e.insertAdjacentElement("afterbegin",At),Ye.current.push(()=>{e.destroyBean(Dt),w_(At)})}return Dt};if(L){const Dt=n.createSelectionCheckbox();bt(Dt)}q&&bt(n.createDndSource()),H&&bt(n.createRowDragComp())},[n,e,q,H,L]),kt=Q.useCallback(Kt=>{if(ue.current=Kt,!ue.current||!n)return;const bt={addOrRemoveCssClass:(_e,At)=>Ge.current.addOrRemoveCssClass(_e,At),setUserStyles:_e=>z(_e),getFocusableElement:()=>ue.current,setIncludeSelection:_e=>P(_e),setIncludeRowDrag:_e=>j(_e),setIncludeDndSource:_e=>le(_e),getCellEditor:()=>rt.current||null,getCellRenderer:()=>Ee.current?Ee.current:We.current,getParentOfValue:()=>qe.current?qe.current:tt.current?tt.current:ue.current,setRenderDetails:(_e,At,Ot)=>{v(tn=>(tn==null?void 0:tn.compDetails)!==_e||(tn==null?void 0:tn.value)!==At||(tn==null?void 0:tn.force)!==Ot?{value:At,compDetails:_e,force:Ot}:tn)},setEditDetails:(_e,At,Ot,tn)=>{if(_e){let xe;tn?xe=new o0e(_e.params,()=>F(Se=>Se+1)):_e.componentFromFramework&&X3(),C({compDetails:_e,popup:At,popupPosition:Ot,compProxy:xe}),At||v(void 0)}else C(xe=>{xe!=null&&xe.compProxy&&(rt.current=void 0)})}},Dt=tt.current||void 0;n.setComp(bt,ue.current,Dt,i,r)},[]),rn=Q.useMemo(()=>!!(f&&f.compDetails&&f.compDetails.componentFromFramework&&Mw(f.compDetails.componentClass)),[f]);Q.useLayoutEffect(()=>{var Kt;ue.current&&(Ge.current.addOrRemoveCssClass("ag-cell-value",!Mt),Ge.current.addOrRemoveCssClass("ag-cell-inline-editing",!!w&&!w.popup),Ge.current.addOrRemoveCssClass("ag-cell-popup-editing",!!w&&!!w.popup),Ge.current.addOrRemoveCssClass("ag-cell-not-inline-editing",!w||!!w.popup),(Kt=n.getRowCtrl())==null||Kt.setInlineEditingCss(!!w),n.shouldRestoreFocus()&&!n.isEditing()&&ue.current.focus({preventScroll:!0}))});const Re=()=>kn.createElement(kn.Fragment,null,f!=null&&f0e(f,M,s,Ee,Mt,rn,$e),w!=null&&d0e(w,Qe,Xt,ue.current,n,ce));return kn.createElement("div",{ref:kt,style:N,tabIndex:o,role:fe,"col-id":c},Mt?kn.createElement("div",{className:"ag-cell-wrapper",role:"presentation",ref:De},Re()):Re())},m0e=Q.memo(p0e),g0e=t=>{const{context:e,gos:n}=Q.useContext(sc),{rowCtrl:i,containerType:r}=t,o=i.getTabIndex(),c=Q.useRef(i.getDomOrder()),s=i.isFullWidth(),f=i.getRowNode().displayed,[v,w]=Q.useState(()=>f?i.getRowIndex():null),[C,M]=Q.useState(()=>i.getRowId()),[F,N]=Q.useState(()=>i.getBusinessKey()),[z,L]=Q.useState(()=>i.getRowStyles()),P=Q.useRef(null),H=Q.useRef(null),[j,q]=Q.useState(()=>null),[le,ce]=Q.useState(),[ae,pe]=Q.useState(()=>f?i.getInitialRowTop(r):void 0),[fe,ue]=Q.useState(()=>f?i.getInitialTransform(r):void 0),Ee=Q.useRef(null),We=Q.useRef(),rt=Q.useRef(!1),[tt,Ye]=Q.useState(0);Q.useEffect(()=>{var He;if(rt.current||!le||tt>10)return;const Ge=(He=Ee.current)==null?void 0:He.firstChild;Ge?(i.setupDetailRowAutoHeight(Ge),rt.current=!0):Ye(De=>De+1)},[le,tt]);const qe=Q.useRef();qe.current||(qe.current=new US(()=>Ee.current));const ft=Q.useCallback(Ge=>{if(Ee.current=Ge,!Ee.current){i.unsetComp(r);return}if(!i.isAlive())return;const He={setTop:pe,setTransform:ue,addOrRemoveCssClass:(De,kt)=>qe.current.addOrRemoveCssClass(De,kt),setDomOrder:De=>c.current=De,setRowIndex:w,setRowId:M,setRowBusinessKey:N,setUserStyles:L,setCellCtrls:(De,kt)=>{H.current=P.current,P.current=De;const rn=$3(H.current,De,c.current);rn!==H.current&&j3(kt,()=>q(rn))},showFullWidth:De=>ce(De),getFullWidthCellRenderer:()=>We.current,refreshFullWidth:De=>Gt.current?(ce(kt=>({...kt,params:De()})),!0):!We.current||!We.current.refresh?!1:We.current.refresh(De())};i.setComp(He,Ee.current,r)},[]);Q.useLayoutEffect(()=>HS(le,e,Ee.current,We),[le]);const Me=Q.useMemo(()=>{const Ge={top:ae,transform:fe};return Object.assign(Ge,z),Ge},[ae,fe,z]),$e=s&&le&&le.componentFromFramework,ut=!s&&j!=null,Mt=Q.useMemo(()=>!!((le==null?void 0:le.componentFromFramework)&&Mw(le.componentClass)),[le]),Gt=Q.useRef(!1);Q.useEffect(()=>{Gt.current=Mt&&!!le&&!!n.get("reactiveCustomComponents")},[Mt,le]);const Xt=()=>j==null?void 0:j.map(Ge=>kn.createElement(m0e,{cellCtrl:Ge,editingRow:i.isEditing(),printLayout:i.isPrintLayout(),key:Ge.getInstanceId()})),Qe=()=>{const Ge=le.componentClass;return kn.createElement(kn.Fragment,null,Mt&&kn.createElement(Ge,{...le.params}),!Mt&&kn.createElement(Ge,{...le.params,ref:We}))};return kn.createElement("div",{ref:ft,role:"row",style:Me,"row-index":v,"row-id":C,"row-business-key":F,tabIndex:o},ut&&Xt(),$e&&Qe())},v0e=Q.memo(g0e),y0e=t=>{const{context:e}=Q.useContext(sc),{name:n}=t,i=Q.useMemo(()=>sq(n),[n]),r=Q.useRef(null),o=Q.useRef(null),c=Q.useRef([]),s=Q.useRef([]),[f,v]=Q.useState(()=>[]),w=Q.useRef(!1),C=Q.useRef(),M=Q.useMemo(()=>Kh(i.viewport),[i]),F=Q.useMemo(()=>Kh(i.container),[i]),N=i.type==="center",z=N?r:o;Dy(" AG Row Container "+n+" ",z);const L=Q.useCallback(()=>N?r.current!=null&&o.current!=null:o.current!=null,[]),P=Q.useCallback(()=>N?r.current==null&&o.current==null:o.current==null,[]),H=Q.useCallback(()=>{if(P()&&(e.destroyBean(C.current),C.current=null),L()){const ce=pe=>{const fe=$3(s.current,c.current,w.current);fe!==s.current&&(s.current=fe,j3(pe,()=>v(fe)))},ae={setViewportHeight:pe=>{r.current&&(r.current.style.height=pe)},setRowCtrls:({rowCtrls:pe,useFlushSync:fe})=>{const ue=!!fe&&c.current.length>0&&pe.length>0;c.current=pe,ce(ue)},setDomOrder:pe=>{w.current!=pe&&(w.current=pe,ce(!1))},setContainerWidth:pe=>{o.current&&(o.current.style.width=pe)},setOffsetTop:pe=>{o.current&&(o.current.style.transform=`translateY(${pe})`)}};C.current=e.createBean(new Rfe(n)),C.current.setComp(ae,o.current,r.current)}},[L,P]),j=Q.useCallback(ce=>{o.current=ce,H()},[H]),q=Q.useCallback(ce=>{r.current=ce,H()},[H]),le=()=>kn.createElement("div",{className:F,ref:j,role:"rowgroup"},f.map(ce=>kn.createElement(v0e,{rowCtrl:ce,containerType:i.type,key:ce.getInstanceId()})));return kn.createElement(kn.Fragment,null,N?kn.createElement("div",{className:M,ref:q,role:"presentation"},le()):le())},_0e=Q.memo(y0e),x0e=()=>{const{context:t,resizeObserverService:e}=Q.useContext(sc),[n,i]=Q.useState(""),[r,o]=Q.useState(0),[c,s]=Q.useState(0),[f,v]=Q.useState("0px"),[w,C]=Q.useState("0px"),[M,F]=Q.useState("100%"),[N,z]=Q.useState("0px"),[L,P]=Q.useState("0px"),[H,j]=Q.useState("100%"),[q,le]=Q.useState(""),[ce,ae]=Q.useState(""),[pe,fe]=Q.useState(null),[ue,Ee]=Q.useState(""),[We,rt]=Q.useState(null),[tt,Ye]=Q.useState("ag-layout-normal"),qe=Q.useRef();qe.current||(qe.current=new US(()=>ft.current));const ft=Q.useRef(null),Me=Q.useRef(null),$e=Q.useRef(null),ut=Q.useRef(null),Mt=Q.useRef(null),Gt=Q.useRef(null),Xt=Q.useRef(null),Qe=Q.useRef([]),Ge=Q.useRef([]);Dy(" AG Grid Body ",ft),Dy(" AG Pinned Top ",Me),Dy(" AG Sticky Top ",$e),Dy(" AG Middle ",Gt),Dy(" AG Pinned Bottom ",Xt);const He=Q.useCallback(it=>{if(ft.current=it,!ft.current){t.destroyBeans(Qe.current),Ge.current.forEach(jt=>jt()),Qe.current=[],Ge.current=[];return}if(!t)return;const Le=(jt,Fn)=>{jt.appendChild(Fn),Ge.current.push(()=>jt.removeChild(Fn))},Pe=jt=>{const Fn=t.createBean(new jt);return Qe.current.push(Fn),Fn},vt=(jt,Fn,Bn)=>{Le(jt,document.createComment(Bn)),Le(jt,Pe(Fn).getGui())};vt(ft.current,Fde," AG Fake Horizontal Scroll "),vt(ft.current,Dde," AG Overlay Wrapper "),Mt.current&&vt(Mt.current,Lde," AG Fake Vertical Scroll ");const yt={setRowAnimationCssOnBodyViewport:i,setColumnCount:jt=>{ft.current&&Jce(ft.current,jt)},setRowCount:jt=>{ft.current&&Kce(ft.current,jt)},setTopHeight:o,setBottomHeight:s,setStickyTopHeight:v,setStickyTopTop:C,setStickyTopWidth:F,setTopDisplay:le,setBottomDisplay:ae,setColumnMovingCss:(jt,Fn)=>qe.current.addOrRemoveCssClass(jt,Fn),updateLayoutClasses:Ye,setAlwaysVerticalScrollClass:fe,setPinnedTopBottomOverflowY:Ee,setCellSelectableCss:(jt,Fn)=>rt(Fn?jt:null),setBodyViewportWidth:jt=>{Gt.current&&(Gt.current.style.width=jt)},registerBodyViewportResizeListener:jt=>{if(Gt.current){const Fn=e.observeResize(Gt.current,jt);Ge.current.push(()=>Fn())}},setStickyBottomHeight:z,setStickyBottomBottom:P,setStickyBottomWidth:j},nn=t.createBean(new zde);Qe.current.push(nn),nn.setComp(yt,ft.current,Gt.current,Me.current,Xt.current,$e.current,ut.current)},[]),De=Q.useMemo(()=>Kh("ag-root","ag-unselectable",tt),[tt]),kt=Q.useMemo(()=>Kh("ag-body-viewport",n,tt,pe,We),[n,tt,pe,We]),rn=Q.useMemo(()=>Kh("ag-body",tt),[tt]),Re=Q.useMemo(()=>Kh("ag-floating-top",We),[We]),Kt=Q.useMemo(()=>Kh("ag-sticky-top",We),[We]),bt=Q.useMemo(()=>Kh("ag-sticky-bottom",We),[We]),Dt=Q.useMemo(()=>Kh("ag-floating-bottom",We),[We]),_e=Q.useMemo(()=>({height:r,minHeight:r,display:q,overflowY:ue}),[r,q,ue]),At=Q.useMemo(()=>({height:f,top:w,width:M}),[f,w,M]),Ot=Q.useMemo(()=>({height:N,bottom:L,width:H}),[N,L,H]),tn=Q.useMemo(()=>({height:c,minHeight:c,display:ce,overflowY:ue}),[c,ce,ue]),xe=it=>kn.createElement(_0e,{name:it,key:`${it}-container`}),Se=({section:it,children:Le,className:Pe,style:vt})=>kn.createElement("div",{ref:it,className:Pe,role:"presentation",style:vt},Le.map(xe));return kn.createElement("div",{ref:He,className:De,role:"treegrid"},kn.createElement(r0e,null),Se({section:Me,className:Re,style:_e,children:["topLeft","topCenter","topRight","topFullWidth"]}),kn.createElement("div",{className:rn,ref:Mt,role:"presentation"},Se({section:Gt,className:kt,children:["left","center","right","fullWidth"]})),Se({section:$e,className:Kt,style:At,children:["stickyTopLeft","stickyTopCenter","stickyTopRight","stickyTopFullWidth"]}),Se({section:ut,className:bt,style:Ot,children:["stickyBottomLeft","stickyBottomCenter","stickyBottomRight","stickyBottomFullWidth"]}),Se({section:Xt,className:Dt,style:tn,children:["bottomLeft","bottomCenter","bottomRight","bottomFullWidth"]}))},w0e=Q.memo(x0e),C0e=(t,e)=>{const{children:n,eFocusableElement:i,onTabKeyDown:r,gridCtrl:o,forceFocusOutWhenTabGuardsAreEmpty:c}=t,{context:s}=Q.useContext(sc),f=Q.useRef(null),v=Q.useRef(null),w=Q.useRef(),C=L=>{const P=L==null?void 0:parseInt(L,10).toString();[f,v].forEach(H=>{var j,q;P===void 0?(j=H.current)==null||j.removeAttribute("tabindex"):(q=H.current)==null||q.setAttribute("tabindex",P)})};Q.useImperativeHandle(e,()=>({forceFocusOutOfContainer(L){var P;(P=w.current)==null||P.forceFocusOutOfContainer(L)}}));const M=Q.useCallback(()=>{if(!f.current&&!v.current){s.destroyBean(w.current),w.current=null;return}if(f.current&&v.current){const L={setTabIndex:C};w.current=s.createBean(new mq({comp:L,eTopGuard:f.current,eBottomGuard:v.current,eFocusableElement:i,onTabKeyDown:r,forceFocusOutWhenTabGuardsAreEmpty:c,focusInnerElement:P=>o.focusInnerElement(P)}))}},[]),F=Q.useCallback(L=>{f.current=L,M()},[M]),N=Q.useCallback(L=>{v.current=L,M()},[M]),z=L=>{const P=L==="top"?lR.TAB_GUARD_TOP:lR.TAB_GUARD_BOTTOM;return kn.createElement("div",{className:`${lR.TAB_GUARD} ${P}`,role:"presentation",ref:L==="top"?F:N})};return kn.createElement(kn.Fragment,null,z("top"),n,z("bottom"))},S0e=Q.forwardRef(C0e),b0e=Q.memo(S0e),E0e=({context:t})=>{const[e,n]=Q.useState(""),[i,r]=Q.useState(""),[o,c]=Q.useState(null),[s,f]=Q.useState(null),[v,w]=Q.useState(!1),[C,M]=Q.useState(),F=Q.useRef(null),N=Q.useRef(null),z=Q.useRef(),[L,P]=Q.useState(null),H=Q.useRef(()=>{}),j=Q.useRef(),q=Q.useRef([]),le=Q.useCallback(()=>{},[]),ce=Q.useMemo(()=>t.isDestroyed()?null:t.getBeans(),[t]);Dy(" AG Grid ",N);const ae=Q.useCallback(We=>{if(N.current=We,!N.current){t.destroyBean(F.current),F.current=null;return}if(t.isDestroyed())return;F.current=t.createBean(new lme);const rt=F.current;H.current=rt.focusInnerElement.bind(rt);const tt={destroyGridUi:()=>{},setRtlClass:n,forceFocusOutOfContainer:Ye=>{var qe,ft;if(!Ye&&((qe=j.current)!=null&&qe.isDisplayed())){j.current.forceFocusOutOfContainer(Ye);return}(ft=z.current)==null||ft.forceFocusOutOfContainer(Ye)},updateLayoutClasses:r,getFocusableContainers:()=>{var ft;const Ye=[],qe=(ft=N.current)==null?void 0:ft.querySelector(".ag-root");return qe&&Ye.push({getGui:()=>qe}),q.current.forEach(Me=>{Me.isDisplayed()&&Ye.push(Me)}),Ye},setCursor:c,setUserSelect:f};rt.setComp(tt,N.current,N.current),w(!0)},[]);Q.useEffect(()=>{if(!C||!ce||!F.current||!L||!N.current)return;const We=F.current,rt=[],{watermarkSelector:tt,paginationSelector:Ye,sideBarSelector:qe,statusBarSelector:ft,gridHeaderDropZonesSelector:Me}=We.getOptionalSelectors(),$e=[],ut=N.current;if(Me){const Gt=t.createBean(new Me.component),Xt=Gt.getGui();ut.insertAdjacentElement("afterbegin",Xt),$e.push(Xt),rt.push(Gt)}if(qe){const Gt=t.createBean(new qe.component),Xt=Gt.getGui(),Qe=L.querySelector(".ag-tab-guard-bottom");Qe&&(Qe.insertAdjacentElement("beforebegin",Xt),$e.push(Xt)),rt.push(Gt),q.current.push(Gt)}const Mt=Gt=>{const Xt=t.createBean(new Gt),Qe=Xt.getGui();return ut.insertAdjacentElement("beforeend",Qe),$e.push(Qe),rt.push(Xt),Xt};if(ft&&Mt(ft.component),Ye){const Gt=Mt(Ye.component);j.current=Gt,q.current.push(Gt)}return tt&&Mt(tt.component),()=>{t.destroyBeans(rt),$e.forEach(Gt=>{Gt.parentElement&&Gt.parentElement.removeChild(Gt)})}},[C,L,ce]);const pe=Q.useMemo(()=>Kh("ag-root-wrapper",e,i),[e,i]),fe=Q.useMemo(()=>Kh("ag-root-wrapper-body","ag-focus-managed",i),[i]),ue=Q.useMemo(()=>({userSelect:s??"",WebkitUserSelect:s??"",cursor:o??""}),[s,o]),Ee=Q.useCallback(We=>{z.current=We,M(We!==null)},[]);return kn.createElement("div",{ref:ae,className:pe,style:ue,role:"presentation"},kn.createElement("div",{className:fe,ref:P,role:"presentation"},v&&L&&ce&&kn.createElement(sc.Provider,{value:ce},kn.createElement(b0e,{ref:Ee,eFocusableElement:L,onTabKeyDown:le,gridCtrl:F.current,forceFocusOutWhenTabGuardsAreEmpty:!0},kn.createElement(w0e,null)))))},M0e=Q.memo(E0e),R0e=class extends wn{wireBeans(t){this.ctrlsService=t.ctrlsService}areHeaderCellsRendered(){return this.ctrlsService.getHeaderRowContainerCtrls().every(t=>t.getAllCtrls().every(e=>e.areCellsRendered()))}},Nq=t=>{var z;const e=Q.useRef(),n=Q.useRef(null),i=Q.useRef(null),r=Q.useRef([]),o=Q.useRef([]),c=Q.useRef(t),s=Q.useRef(),f=Q.useRef(!1),[v,w]=Q.useState(void 0),[,C]=Q.useState(0),M=Q.useCallback(L=>{if(n.current=L,!n.current){r.current.forEach(ue=>ue()),r.current.length=0;return}const P=t.modules||[];i.current||(i.current=new q_e(()=>C(ue=>ue+1),t.componentWrappingElement,t.maxComponentCreationTimeMs),r.current.push(()=>{var ue;(ue=i.current)==null||ue.destroy(),i.current=null}));const H=Vce(t.gridOptions,t),j=()=>{if(f.current){const ue=()=>{var We;return(We=s.current)!=null&&We.shouldQueueUpdates()?void 0:o.current.shift()};let Ee=ue();for(;Ee;)Ee(),Ee=ue()}},q=I_e()?new I0e(j):new Bq;s.current=q;const le=new R0e,ce={providedBeanInstances:{frameworkComponentWrapper:new A0e(i.current,H.reactiveCustomComponents??!0),renderStatusService:le},modules:P,frameworkOverrides:q},ae=ue=>{w(ue),ue.createBean(le),r.current.push(()=>{ue.destroy()}),ue.getBean("ctrlsService").whenReady(()=>{if(ue.isDestroyed())return;const We=e.current;We&&t.setGridApi&&t.setGridApi(We)})},pe=ue=>{ue.getBean("ctrlsService").whenReady(()=>{o.current.forEach(We=>We()),o.current.length=0,f.current=!0})},fe=new Oye;e.current=fe.create(n.current,H,ae,pe,ce)},[]),F=Q.useMemo(()=>({height:"100%",...t.containerStyle||{}}),[t.containerStyle]),N=Q.useCallback(L=>{var P;f.current&&!((P=s.current)!=null&&P.shouldQueueUpdates())?L():o.current.push(L)},[]);return Q.useEffect(()=>{const L=T0e(c.current,t);c.current=t,N(()=>{e.current&&Gce(L,e.current)})},[t]),kn.createElement("div",{style:F,className:t.className,ref:M},v&&!v.isDestroyed()?kn.createElement(M0e,{context:v}):null,((z=i.current)==null?void 0:z.getPortals())??null)};function T0e(t,e){const n={};return Object.keys(e).forEach(i=>{const r=e[i];t[i]!==r&&(n[i]=r)}),n}var A0e=class extends Hye{constructor(t,e){super(),this.parent=t,this.reactiveCustomComponents=e}createWrapper(t,e){if(this.reactiveCustomComponents){const r=(o=>{switch(o){case"filter":return B_e;case"floatingFilterComponent":return U_e;case"dateComponent":return N_e;case"loadingOverlayComponent":return V_e;case"noRowsOverlayComponent":return H_e;case"statusPanel":return W_e;case"toolPanel":return j_e;case"menuItem":return G_e;case"cellRenderer":return k_e}})(e.propertyName);if(r)return new r(t,this.parent,e)}else switch(e.propertyName){case"filter":case"floatingFilterComponent":case"dateComponent":case"loadingOverlayComponent":case"noRowsOverlayComponent":case"statusPanel":case"toolPanel":case"menuItem":case"cellRenderer":X3();break}const n=!e.cellRenderer&&e.propertyName!=="toolPanel";return new Oq(t,this.parent,e,n)}},P0e=Q.forwardRef((t,e)=>{const{ctrlsFactory:n,context:i,gos:r,resizeObserverService:o,rowModel:c}=Q.useContext(sc),[s,f]=Q.useState(()=>new Ku),[v,w]=Q.useState(()=>new Ku),[C,M]=Q.useState(),[F,N]=Q.useState(),z=Q.useRef(),L=Q.useRef(null),P=Q.useRef(),H=Q.useMemo(()=>xl.__getGridRegisteredModules(t.api.getGridId()),[t]),j=Q.useMemo(()=>s.toString()+" ag-details-row",[s]),q=Q.useMemo(()=>v.toString()+" ag-details-grid",[v]);e&&Q.useImperativeHandle(e,()=>({refresh(){var ae;return((ae=z.current)==null?void 0:ae.refresh())??!1}})),t.template&&Tn("detailCellRendererParams.template is not supported by AG Grid React. To change the template, provide a Custom Detail Cell Renderer. See https://ag-grid.com/react-data-grid/master-detail-custom-detail/");const le=Q.useCallback(ae=>{if(L.current=ae,!L.current){i.destroyBean(z.current),P.current&&P.current();return}const pe={addOrRemoveCssClass:(ue,Ee)=>f(We=>We.setClass(ue,Ee)),addOrRemoveDetailGridCssClass:(ue,Ee)=>w(We=>We.setClass(ue,Ee)),setDetailGrid:ue=>M(ue),setRowData:ue=>N(ue),getGui:()=>L.current},fe=n.getInstance("detailCellRenderer");if(fe&&(i.createBean(fe),fe.init(pe,t),z.current=fe,r.get("detailRowAutoHeight"))){const ue=()=>{if(L.current==null)return;const Ee=L.current.clientHeight;Ee!=null&&Ee>0&&setTimeout(()=>{t.node.setRowHeight(Ee),(c.getType()==="clientSide"||c.getType()==="serverSide")&&c.onRowHeightChanged()},0)};P.current=o.observeResize(L.current,ue),ue()}},[]),ce=Q.useCallback(ae=>{var pe;(pe=z.current)==null||pe.registerDetailWithMaster(ae)},[]);return kn.createElement("div",{className:j,ref:le},C&&kn.createElement(Nq,{className:q,...C,modules:H,rowData:F,setGridApi:ce}))}),Bq=class extends gq{constructor(){super("react"),this.frameworkComponents={agGroupCellRenderer:uH,agGroupRowRenderer:uH,agDetailCellRenderer:P0e},this.wrapIncoming=(t,e)=>e==="ensureVisible"?D_e(t):t(),this.renderingEngine="react"}frameworkComponent(t){return this.frameworkComponents[t]}isFrameworkComponent(t){if(!t)return!1;const e=t.prototype;return!(e&&"getGui"in e)}shouldQueueUpdates(){return!1}getLockOnRefreshError(){return" This error can also occur if using 'ReactDOM.render' instead of 'createRoot'. If so, please upgrade to 'createRoot'."}},I0e=class extends Bq{constructor(t){super(),this.processQueuedUpdates=t,this.queueUpdates=!1}getLockOnRefresh(){this.queueUpdates=!0}releaseLockOnRefresh(){this.queueUpdates=!1,this.processQueuedUpdates()}shouldQueueUpdates(){return this.queueUpdates}getLockOnRefreshError(){return""}},zq=class extends Q.Component{constructor(){super(...arguments),this.apiListeners=[],this.setGridApi=t=>{this.api=t,this.apiListeners.forEach(e=>e(t))}}registerApiListener(t){this.apiListeners.push(t)}componentWillUnmount(){this.apiListeners.length=0}render(){return kn.createElement(Nq,{...this.props,setGridApi:this.setGridApi})}};function D0e(){const t=lm(),{id:e}=F_(),{data:n,error:i,isLoading:r}=bf({queryKey:["subscriptions",{customerId:e}],queryFn:()=>nce(e),refetchInterval:30*1e3}),o=[{headerName:"Login",field:"login",flex:1},{headerName:"Password",field:"password",width:120},{headerName:"Status",field:"status",width:150,sort:"desc"},{headerName:"Expires",field:"expires",width:150},{headerName:"User-Agent",field:"userAgent",flex:1}];return re.jsx("div",{className:"ag-theme-quartz",style:{width:"100%",height:210,paddingLeft:20,paddingRight:20},children:re.jsx(zq,{className:"*:rounded-sm",rowData:n,columnDefs:o,onRowClicked:c=>{t(`/customers/${e}/subscriptions/${c.data.id}`)}})})}function co(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function F0e(t,e){const n=Q.createContext(e);function i(o){const{children:c,...s}=o,f=Q.useMemo(()=>s,Object.values(s));return re.jsx(n.Provider,{value:f,children:c})}function r(o){const c=Q.useContext(n);if(c)return c;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return i.displayName=t+"Provider",[i,r]}function WS(t,e=[]){let n=[];function i(o,c){const s=Q.createContext(c),f=n.length;n=[...n,c];function v(C){const{scope:M,children:F,...N}=C,z=(M==null?void 0:M[t][f])||s,L=Q.useMemo(()=>N,Object.values(N));return re.jsx(z.Provider,{value:L,children:F})}function w(C,M){const F=(M==null?void 0:M[t][f])||s,N=Q.useContext(F);if(N)return N;if(c!==void 0)return c;throw new Error(`\`${C}\` must be used within \`${o}\``)}return v.displayName=o+"Provider",[v,w]}const r=()=>{const o=n.map(c=>Q.createContext(c));return function(s){const f=(s==null?void 0:s[t])||o;return Q.useMemo(()=>({[`__scope${t}`]:{...s,[t]:f}}),[s,f])}};return r.scopeName=t,[i,L0e(r,...e)]}function L0e(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const c=i.reduce((s,{useScope:f,scopeName:v})=>{const C=f(o)[`__scope${v}`];return{...s,...C}},{});return Q.useMemo(()=>({[`__scope${e.scopeName}`]:c}),[c])}};return n.scopeName=e.scopeName,n}var ec=globalThis!=null&&globalThis.document?Q.useLayoutEffect:()=>{},O0e=Mj.useId||(()=>{}),k0e=0;function Px(t){const[e,n]=Q.useState(O0e());return ec(()=>{n(i=>i??String(k0e++))},[t]),e?`radix-${e}`:""}function em(t){const e=Q.useRef(t);return Q.useEffect(()=>{e.current=t}),Q.useMemo(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}function cT({prop:t,defaultProp:e,onChange:n=()=>{}}){const[i,r]=N0e({defaultProp:e,onChange:n}),o=t!==void 0,c=o?t:i,s=em(n),f=Q.useCallback(v=>{if(o){const C=typeof v=="function"?v(t):v;C!==t&&s(C)}else r(v)},[o,t,r,s]);return[c,f]}function N0e({defaultProp:t,onChange:e}){const n=Q.useState(t),[i]=n,r=Q.useRef(i),o=em(e);return Q.useEffect(()=>{r.current!==i&&(o(i),r.current=i)},[i,r,o]),n}function B0e(t,e=globalThis==null?void 0:globalThis.document){const n=em(t);Q.useEffect(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var z0e="DismissableLayer",OL="dismissableLayer.update",U0e="dismissableLayer.pointerDownOutside",V0e="dismissableLayer.focusOutside",pH,Uq=Q.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),K3=Q.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:c,onDismiss:s,...f}=t,v=Q.useContext(Uq),[w,C]=Q.useState(null),M=(w==null?void 0:w.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,F]=Q.useState({}),N=Ko(e,ae=>C(ae)),z=Array.from(v.layers),[L]=[...v.layersWithOutsidePointerEventsDisabled].slice(-1),P=z.indexOf(L),H=w?z.indexOf(w):-1,j=v.layersWithOutsidePointerEventsDisabled.size>0,q=H>=P,le=W0e(ae=>{const pe=ae.target,fe=[...v.branches].some(ue=>ue.contains(pe));!q||fe||(r==null||r(ae),c==null||c(ae),ae.defaultPrevented||s==null||s())},M),ce=j0e(ae=>{const pe=ae.target;[...v.branches].some(ue=>ue.contains(pe))||(o==null||o(ae),c==null||c(ae),ae.defaultPrevented||s==null||s())},M);return B0e(ae=>{H===v.layers.size-1&&(i==null||i(ae),!ae.defaultPrevented&&s&&(ae.preventDefault(),s()))},M),Q.useEffect(()=>{if(w)return n&&(v.layersWithOutsidePointerEventsDisabled.size===0&&(pH=M.body.style.pointerEvents,M.body.style.pointerEvents="none"),v.layersWithOutsidePointerEventsDisabled.add(w)),v.layers.add(w),mH(),()=>{n&&v.layersWithOutsidePointerEventsDisabled.size===1&&(M.body.style.pointerEvents=pH)}},[w,M,n,v]),Q.useEffect(()=>()=>{w&&(v.layers.delete(w),v.layersWithOutsidePointerEventsDisabled.delete(w),mH())},[w,v]),Q.useEffect(()=>{const ae=()=>F({});return document.addEventListener(OL,ae),()=>document.removeEventListener(OL,ae)},[]),re.jsx(Vs.div,{...f,ref:N,style:{pointerEvents:j?q?"auto":"none":void 0,...t.style},onFocusCapture:co(t.onFocusCapture,ce.onFocusCapture),onBlurCapture:co(t.onBlurCapture,ce.onBlurCapture),onPointerDownCapture:co(t.onPointerDownCapture,le.onPointerDownCapture)})});K3.displayName=z0e;var G0e="DismissableLayerBranch",H0e=Q.forwardRef((t,e)=>{const n=Q.useContext(Uq),i=Q.useRef(null),r=Ko(e,i);return Q.useEffect(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),re.jsx(Vs.div,{...t,ref:r})});H0e.displayName=G0e;function W0e(t,e=globalThis==null?void 0:globalThis.document){const n=em(t),i=Q.useRef(!1),r=Q.useRef(()=>{});return Q.useEffect(()=>{const o=s=>{if(s.target&&!i.current){let f=function(){Vq(U0e,n,v,{discrete:!0})};const v={originalEvent:s};s.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=f,e.addEventListener("click",r.current,{once:!0})):f()}else e.removeEventListener("click",r.current);i.current=!1},c=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(c),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function j0e(t,e=globalThis==null?void 0:globalThis.document){const n=em(t),i=Q.useRef(!1);return Q.useEffect(()=>{const r=o=>{o.target&&!i.current&&Vq(V0e,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function mH(){const t=new CustomEvent(OL);document.dispatchEvent(t)}function Vq(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?hoe(r,o):r.dispatchEvent(o)}var DD="focusScope.autoFocusOnMount",FD="focusScope.autoFocusOnUnmount",gH={bubbles:!1,cancelable:!0},$0e="FocusScope",Y3=Q.forwardRef((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...c}=t,[s,f]=Q.useState(null),v=em(r),w=em(o),C=Q.useRef(null),M=Ko(e,z=>f(z)),F=Q.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Q.useEffect(()=>{if(i){let z=function(j){if(F.paused||!s)return;const q=j.target;s.contains(q)?C.current=q:bg(C.current,{select:!0})},L=function(j){if(F.paused||!s)return;const q=j.relatedTarget;q!==null&&(s.contains(q)||bg(C.current,{select:!0}))},P=function(j){if(document.activeElement===document.body)for(const le of j)le.removedNodes.length>0&&bg(s)};document.addEventListener("focusin",z),document.addEventListener("focusout",L);const H=new MutationObserver(P);return s&&H.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",z),document.removeEventListener("focusout",L),H.disconnect()}}},[i,s,F.paused]),Q.useEffect(()=>{if(s){yH.add(F);const z=document.activeElement;if(!s.contains(z)){const P=new CustomEvent(DD,gH);s.addEventListener(DD,v),s.dispatchEvent(P),P.defaultPrevented||(q0e(J0e(Gq(s)),{select:!0}),document.activeElement===z&&bg(s))}return()=>{s.removeEventListener(DD,v),setTimeout(()=>{const P=new CustomEvent(FD,gH);s.addEventListener(FD,w),s.dispatchEvent(P),P.defaultPrevented||bg(z??document.body,{select:!0}),s.removeEventListener(FD,w),yH.remove(F)},0)}}},[s,v,w,F]);const N=Q.useCallback(z=>{if(!n&&!i||F.paused)return;const L=z.key==="Tab"&&!z.altKey&&!z.ctrlKey&&!z.metaKey,P=document.activeElement;if(L&&P){const H=z.currentTarget,[j,q]=Z0e(H);j&&q?!z.shiftKey&&P===q?(z.preventDefault(),n&&bg(j,{select:!0})):z.shiftKey&&P===j&&(z.preventDefault(),n&&bg(q,{select:!0})):P===H&&z.preventDefault()}},[n,i,F.paused]);return re.jsx(Vs.div,{tabIndex:-1,...c,ref:M,onKeyDown:N})});Y3.displayName=$0e;function q0e(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(bg(i,{select:e}),document.activeElement!==n)return}function Z0e(t){const e=Gq(t),n=vH(e,t),i=vH(e.reverse(),t);return[n,i]}function Gq(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function vH(t,e){for(const n of t)if(!X0e(n,{upTo:e}))return n}function X0e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function K0e(t){return t instanceof HTMLInputElement&&"select"in t}function bg(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&K0e(t)&&e&&t.select()}}var yH=Y0e();function Y0e(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=_H(t,e),t.unshift(e)},remove(e){var n;t=_H(t,e),(n=t[0])==null||n.resume()}}}function _H(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function J0e(t){return t.filter(e=>e.tagName!=="A")}var Q0e="Portal",J3=Q.forwardRef((t,e)=>{var s;const{container:n,...i}=t,[r,o]=Q.useState(!1);ec(()=>o(!0),[]);const c=n||r&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return c?VR.createPortal(re.jsx(Vs.div,{...i,ref:e}),c):null});J3.displayName=Q0e;function exe(t,e){return Q.useReducer((n,i)=>e[n][i]??n,t)}var jS=t=>{const{present:e,children:n}=t,i=txe(e),r=typeof n=="function"?n({present:i.isPresent}):Q.Children.only(n),o=Ko(i.ref,nxe(r));return typeof n=="function"||i.isPresent?Q.cloneElement(r,{ref:o}):null};jS.displayName="Presence";function txe(t){const[e,n]=Q.useState(),i=Q.useRef({}),r=Q.useRef(t),o=Q.useRef("none"),c=t?"mounted":"unmounted",[s,f]=exe(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Q.useEffect(()=>{const v=zE(i.current);o.current=s==="mounted"?v:"none"},[s]),ec(()=>{const v=i.current,w=r.current;if(w!==t){const M=o.current,F=zE(v);t?f("MOUNT"):F==="none"||(v==null?void 0:v.display)==="none"?f("UNMOUNT"):f(w&&M!==F?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,f]),ec(()=>{if(e){const v=C=>{const F=zE(i.current).includes(C.animationName);C.target===e&&F&&rh.flushSync(()=>f("ANIMATION_END"))},w=C=>{C.target===e&&(o.current=zE(i.current))};return e.addEventListener("animationstart",w),e.addEventListener("animationcancel",v),e.addEventListener("animationend",v),()=>{e.removeEventListener("animationstart",w),e.removeEventListener("animationcancel",v),e.removeEventListener("animationend",v)}}else f("ANIMATION_END")},[e,f]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:Q.useCallback(v=>{v&&(i.current=getComputedStyle(v)),n(v)},[])}}function zE(t){return(t==null?void 0:t.animationName)||"none"}function nxe(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var LD=0;function Hq(){Q.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??xH()),document.body.insertAdjacentElement("beforeend",t[1]??xH()),LD++,()=>{LD===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),LD--}},[])}function xH(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",t}var mf=function(){return mf=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},mf.apply(this,arguments)};function Wq(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function ixe(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}var hR="right-scroll-bar-position",dR="width-before-scroll-bar",rxe="with-scroll-bars-hidden",sxe="--removed-body-scroll-bar-size";function OD(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function oxe(t,e){var n=Q.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var axe=typeof window<"u"?Q.useLayoutEffect:Q.useEffect,wH=new WeakMap;function lxe(t,e){var n=oxe(null,function(i){return t.forEach(function(r){return OD(r,i)})});return axe(function(){var i=wH.get(n);if(i){var r=new Set(i),o=new Set(t),c=n.current;r.forEach(function(s){o.has(s)||OD(s,null)}),o.forEach(function(s){r.has(s)||OD(s,c)})}wH.set(n,t)},[t]),n}function cxe(t){return t}function uxe(t,e){e===void 0&&(e=cxe);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var c=e(o,i);return n.push(c),function(){n=n.filter(function(s){return s!==c})}},assignSyncMedium:function(o){for(i=!0;n.length;){var c=n;n=[],c.forEach(o)}n={push:function(s){return o(s)},filter:function(){return n}}},assignMedium:function(o){i=!0;var c=[];if(n.length){var s=n;n=[],s.forEach(o),c=n}var f=function(){var w=c;c=[],w.forEach(o)},v=function(){return Promise.resolve().then(f)};v(),n={push:function(w){c.push(w),v()},filter:function(w){return c=c.filter(w),n}}}};return r}function hxe(t){t===void 0&&(t={});var e=uxe(null);return e.options=mf({async:!0,ssr:!1},t),e}var jq=function(t){var e=t.sideCar,n=Wq(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return Q.createElement(i,mf({},n))};jq.isSideCarExport=!0;function dxe(t,e){return t.useMedium(e),jq}var $q=hxe(),kD=function(){},kA=Q.forwardRef(function(t,e){var n=Q.useRef(null),i=Q.useState({onScrollCapture:kD,onWheelCapture:kD,onTouchMoveCapture:kD}),r=i[0],o=i[1],c=t.forwardProps,s=t.children,f=t.className,v=t.removeScrollBar,w=t.enabled,C=t.shards,M=t.sideCar,F=t.noIsolation,N=t.inert,z=t.allowPinchZoom,L=t.as,P=L===void 0?"div":L,H=t.gapMode,j=Wq(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),q=M,le=lxe([n,e]),ce=mf(mf({},j),r);return Q.createElement(Q.Fragment,null,w&&Q.createElement(q,{sideCar:$q,removeScrollBar:v,shards:C,noIsolation:F,inert:N,setCallbacks:o,allowPinchZoom:!!z,lockRef:n,gapMode:H}),c?Q.cloneElement(Q.Children.only(s),mf(mf({},ce),{ref:le})):Q.createElement(P,mf({},ce,{className:f,ref:le}),s))});kA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};kA.classNames={fullWidth:dR,zeroRight:hR};var fxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function pxe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=fxe();return e&&t.setAttribute("nonce",e),t}function mxe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function gxe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var vxe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=pxe())&&(mxe(e,n),gxe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},yxe=function(){var t=vxe();return function(e,n){Q.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},qq=function(){var t=yxe(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},_xe={left:0,top:0,right:0,gap:0},ND=function(t){return parseInt(t||"",10)||0},xxe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[ND(n),ND(i),ND(r)]},wxe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return _xe;var e=xxe(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},Cxe=qq(),Ix="data-scroll-locked",Sxe=function(t,e,n,i){var r=t.left,o=t.top,c=t.right,s=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(rxe,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(s,"px ").concat(i,`;
  }
  body[`).concat(Ix,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(hR,` {
    right: `).concat(s,"px ").concat(i,`;
  }
  
  .`).concat(dR,` {
    margin-right: `).concat(s,"px ").concat(i,`;
  }
  
  .`).concat(hR," .").concat(hR,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(dR," .").concat(dR,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Ix,`] {
    `).concat(sxe,": ").concat(s,`px;
  }
`)},CH=function(){var t=parseInt(document.body.getAttribute(Ix)||"0",10);return isFinite(t)?t:0},bxe=function(){Q.useEffect(function(){return document.body.setAttribute(Ix,(CH()+1).toString()),function(){var t=CH()-1;t<=0?document.body.removeAttribute(Ix):document.body.setAttribute(Ix,t.toString())}},[])},Exe=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;bxe();var o=Q.useMemo(function(){return wxe(r)},[r]);return Q.createElement(Cxe,{styles:Sxe(o,!e,r,n?"":"!important")})},kL=!1;if(typeof window<"u")try{var UE=Object.defineProperty({},"passive",{get:function(){return kL=!0,!0}});window.addEventListener("test",UE,UE),window.removeEventListener("test",UE,UE)}catch{kL=!1}var R0=kL?{passive:!1}:!1,Mxe=function(t){return t.tagName==="TEXTAREA"},Zq=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Mxe(t)&&n[e]==="visible")},Rxe=function(t){return Zq(t,"overflowY")},Txe=function(t){return Zq(t,"overflowX")},SH=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=Xq(t,i);if(r){var o=Kq(t,i),c=o[1],s=o[2];if(c>s)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},Axe=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},Pxe=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},Xq=function(t,e){return t==="v"?Rxe(e):Txe(e)},Kq=function(t,e){return t==="v"?Axe(e):Pxe(e)},Ixe=function(t,e){return t==="h"&&e==="rtl"?-1:1},Dxe=function(t,e,n,i,r){var o=Ixe(t,window.getComputedStyle(e).direction),c=o*i,s=n.target,f=e.contains(s),v=!1,w=c>0,C=0,M=0;do{var F=Kq(t,s),N=F[0],z=F[1],L=F[2],P=z-L-o*N;(N||P)&&Xq(t,s)&&(C+=P,M+=N),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!f&&s!==document.body||f&&(e.contains(s)||e===s));return(w&&(Math.abs(C)<1||!r)||!w&&(Math.abs(M)<1||!r))&&(v=!0),v},VE=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},bH=function(t){return[t.deltaX,t.deltaY]},EH=function(t){return t&&"current"in t?t.current:t},Fxe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Lxe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Oxe=0,T0=[];function kxe(t){var e=Q.useRef([]),n=Q.useRef([0,0]),i=Q.useRef(),r=Q.useState(Oxe++)[0],o=Q.useState(qq)[0],c=Q.useRef(t);Q.useEffect(function(){c.current=t},[t]),Q.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var z=ixe([t.lockRef.current],(t.shards||[]).map(EH),!0).filter(Boolean);return z.forEach(function(L){return L.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),z.forEach(function(L){return L.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var s=Q.useCallback(function(z,L){if("touches"in z&&z.touches.length===2)return!c.current.allowPinchZoom;var P=VE(z),H=n.current,j="deltaX"in z?z.deltaX:H[0]-P[0],q="deltaY"in z?z.deltaY:H[1]-P[1],le,ce=z.target,ae=Math.abs(j)>Math.abs(q)?"h":"v";if("touches"in z&&ae==="h"&&ce.type==="range")return!1;var pe=SH(ae,ce);if(!pe)return!0;if(pe?le=ae:(le=ae==="v"?"h":"v",pe=SH(ae,ce)),!pe)return!1;if(!i.current&&"changedTouches"in z&&(j||q)&&(i.current=le),!le)return!0;var fe=i.current||le;return Dxe(fe,L,z,fe==="h"?j:q,!0)},[]),f=Q.useCallback(function(z){var L=z;if(!(!T0.length||T0[T0.length-1]!==o)){var P="deltaY"in L?bH(L):VE(L),H=e.current.filter(function(le){return le.name===L.type&&(le.target===L.target||L.target===le.shadowParent)&&Fxe(le.delta,P)})[0];if(H&&H.should){L.cancelable&&L.preventDefault();return}if(!H){var j=(c.current.shards||[]).map(EH).filter(Boolean).filter(function(le){return le.contains(L.target)}),q=j.length>0?s(L,j[0]):!c.current.noIsolation;q&&L.cancelable&&L.preventDefault()}}},[]),v=Q.useCallback(function(z,L,P,H){var j={name:z,delta:L,target:P,should:H,shadowParent:Nxe(P)};e.current.push(j),setTimeout(function(){e.current=e.current.filter(function(q){return q!==j})},1)},[]),w=Q.useCallback(function(z){n.current=VE(z),i.current=void 0},[]),C=Q.useCallback(function(z){v(z.type,bH(z),z.target,s(z,t.lockRef.current))},[]),M=Q.useCallback(function(z){v(z.type,VE(z),z.target,s(z,t.lockRef.current))},[]);Q.useEffect(function(){return T0.push(o),t.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:M}),document.addEventListener("wheel",f,R0),document.addEventListener("touchmove",f,R0),document.addEventListener("touchstart",w,R0),function(){T0=T0.filter(function(z){return z!==o}),document.removeEventListener("wheel",f,R0),document.removeEventListener("touchmove",f,R0),document.removeEventListener("touchstart",w,R0)}},[]);var F=t.removeScrollBar,N=t.inert;return Q.createElement(Q.Fragment,null,N?Q.createElement(o,{styles:Lxe(r)}):null,F?Q.createElement(Exe,{gapMode:t.gapMode}):null)}function Nxe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Bxe=dxe($q,kxe);var Q3=Q.forwardRef(function(t,e){return Q.createElement(kA,mf({},t,{ref:e,sideCar:Bxe}))});Q3.classNames=kA.classNames;var zxe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},A0=new WeakMap,GE=new WeakMap,HE={},BD=0,Yq=function(t){return t&&(t.host||Yq(t.parentNode))},Uxe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=Yq(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Vxe=function(t,e,n,i){var r=Uxe(e,Array.isArray(t)?t:[t]);HE[n]||(HE[n]=new WeakMap);var o=HE[n],c=[],s=new Set,f=new Set(r),v=function(C){!C||s.has(C)||(s.add(C),v(C.parentNode))};r.forEach(v);var w=function(C){!C||f.has(C)||Array.prototype.forEach.call(C.children,function(M){if(s.has(M))w(M);else try{var F=M.getAttribute(i),N=F!==null&&F!=="false",z=(A0.get(M)||0)+1,L=(o.get(M)||0)+1;A0.set(M,z),o.set(M,L),c.push(M),z===1&&N&&GE.set(M,!0),L===1&&M.setAttribute(n,"true"),N||M.setAttribute(i,"true")}catch(P){console.error("aria-hidden: cannot operate on ",M,P)}})};return w(e),s.clear(),BD++,function(){c.forEach(function(C){var M=A0.get(C)-1,F=o.get(C)-1;A0.set(C,M),o.set(C,F),M||(GE.has(C)||C.removeAttribute(i),GE.delete(C)),F||C.removeAttribute(n)}),BD--,BD||(A0=new WeakMap,A0=new WeakMap,GE=new WeakMap,HE={})}},Jq=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=zxe(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live]"))),Vxe(i,r,n,"aria-hidden")):function(){return null}},eB="Dialog",[Qq,YLe]=WS(eB),[Gxe,gd]=Qq(eB),eZ=t=>{const{__scopeDialog:e,children:n,open:i,defaultOpen:r,onOpenChange:o,modal:c=!0}=t,s=Q.useRef(null),f=Q.useRef(null),[v=!1,w]=cT({prop:i,defaultProp:r,onChange:o});return re.jsx(Gxe,{scope:e,triggerRef:s,contentRef:f,contentId:Px(),titleId:Px(),descriptionId:Px(),open:v,onOpenChange:w,onOpenToggle:Q.useCallback(()=>w(C=>!C),[w]),modal:c,children:n})};eZ.displayName=eB;var tZ="DialogTrigger",nZ=Q.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=gd(tZ,n),o=Ko(e,r.triggerRef);return re.jsx(Vs.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":iB(r.open),...i,ref:o,onClick:co(t.onClick,r.onOpenToggle)})});nZ.displayName=tZ;var tB="DialogPortal",[Hxe,iZ]=Qq(tB,{forceMount:void 0}),rZ=t=>{const{__scopeDialog:e,forceMount:n,children:i,container:r}=t,o=gd(tB,e);return re.jsx(Hxe,{scope:e,forceMount:n,children:Q.Children.map(i,c=>re.jsx(jS,{present:n||o.open,children:re.jsx(J3,{asChild:!0,container:r,children:c})}))})};rZ.displayName=tB;var uT="DialogOverlay",sZ=Q.forwardRef((t,e)=>{const n=iZ(uT,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=gd(uT,t.__scopeDialog);return o.modal?re.jsx(jS,{present:i||o.open,children:re.jsx(Wxe,{...r,ref:e})}):null});sZ.displayName=uT;var Wxe=Q.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=gd(uT,n);return re.jsx(Q3,{as:sv,allowPinchZoom:!0,shards:[r.contentRef],children:re.jsx(Vs.div,{"data-state":iB(r.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),C_="DialogContent",oZ=Q.forwardRef((t,e)=>{const n=iZ(C_,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=gd(C_,t.__scopeDialog);return re.jsx(jS,{present:i||o.open,children:o.modal?re.jsx(jxe,{...r,ref:e}):re.jsx($xe,{...r,ref:e})})});oZ.displayName=C_;var jxe=Q.forwardRef((t,e)=>{const n=gd(C_,t.__scopeDialog),i=Q.useRef(null),r=Ko(e,n.contentRef,i);return Q.useEffect(()=>{const o=i.current;if(o)return Jq(o)},[]),re.jsx(aZ,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:co(t.onCloseAutoFocus,o=>{var c;o.preventDefault(),(c=n.triggerRef.current)==null||c.focus()}),onPointerDownOutside:co(t.onPointerDownOutside,o=>{const c=o.detail.originalEvent,s=c.button===0&&c.ctrlKey===!0;(c.button===2||s)&&o.preventDefault()}),onFocusOutside:co(t.onFocusOutside,o=>o.preventDefault())})}),$xe=Q.forwardRef((t,e)=>{const n=gd(C_,t.__scopeDialog),i=Q.useRef(!1),r=Q.useRef(!1);return re.jsx(aZ,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var c,s;(c=t.onCloseAutoFocus)==null||c.call(t,o),o.defaultPrevented||(i.current||(s=n.triggerRef.current)==null||s.focus(),o.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:o=>{var f,v;(f=t.onInteractOutside)==null||f.call(t,o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const c=o.target;((v=n.triggerRef.current)==null?void 0:v.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),aZ=Q.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,...c}=t,s=gd(C_,n),f=Q.useRef(null),v=Ko(e,f);return Hq(),re.jsxs(re.Fragment,{children:[re.jsx(Y3,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:o,children:re.jsx(K3,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":iB(s.open),...c,ref:v,onDismiss:()=>s.onOpenChange(!1)})}),re.jsxs(re.Fragment,{children:[re.jsx(qxe,{titleId:s.titleId}),re.jsx(Xxe,{contentRef:f,descriptionId:s.descriptionId})]})]})}),nB="DialogTitle",lZ=Q.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=gd(nB,n);return re.jsx(Vs.h2,{id:r.titleId,...i,ref:e})});lZ.displayName=nB;var cZ="DialogDescription",uZ=Q.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=gd(cZ,n);return re.jsx(Vs.p,{id:r.descriptionId,...i,ref:e})});uZ.displayName=cZ;var hZ="DialogClose",dZ=Q.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=gd(hZ,n);return re.jsx(Vs.button,{type:"button",...i,ref:e,onClick:co(t.onClick,()=>r.onOpenChange(!1))})});dZ.displayName=hZ;function iB(t){return t?"open":"closed"}var fZ="DialogTitleWarning",[JLe,pZ]=F0e(fZ,{contentName:C_,titleName:nB,docsSlug:"dialog"}),qxe=({titleId:t})=>{const e=pZ(fZ),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return Q.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Zxe="DialogDescriptionWarning",Xxe=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${pZ(Zxe).contentName}}.`;return Q.useEffect(()=>{var o;const r=(o=t.current)==null?void 0:o.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},Kxe=eZ,Yxe=nZ,Jxe=rZ,mZ=sZ,gZ=oZ,vZ=lZ,yZ=uZ,_Z=dZ;const vd=Kxe,hm=Yxe,Qxe=Jxe,cd=_Z,xZ=Q.forwardRef(({className:t,...e},n)=>re.jsx(mZ,{ref:n,className:Ar("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));xZ.displayName=mZ.displayName;const sh=Q.forwardRef(({className:t,children:e,hideClose:n,...i},r)=>re.jsxs(Qxe,{children:[re.jsx(xZ,{}),re.jsxs(gZ,{ref:r,className:Ar("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-stone-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-stone-800 dark:bg-stone-950",t),...i,children:[e,re.jsxs(_Z,{className:Ar("absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-stone-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-stone-100 data-[state=open]:text-stone-500 dark:ring-offset-stone-950 dark:focus:ring-stone-300 dark:data-[state=open]:bg-stone-800 dark:data-[state=open]:text-stone-400",n&&"hidden"),children:[re.jsx(xoe,{className:"h-4 w-4"}),re.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));sh.displayName=gZ.displayName;const oh=({className:t,...e})=>re.jsx("div",{className:Ar("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});oh.displayName="DialogHeader";const ah=({className:t,...e})=>re.jsx("div",{className:Ar("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});ah.displayName="DialogFooter";const lh=Q.forwardRef(({className:t,...e},n)=>re.jsx(vZ,{ref:n,className:Ar("text-lg font-semibold leading-none tracking-tight",t),...e}));lh.displayName=vZ.displayName;const ch=Q.forwardRef(({className:t,...e},n)=>re.jsx(yZ,{ref:n,className:Ar("text-sm text-stone-500 dark:text-stone-400",t),...e}));ch.displayName=yZ.displayName;function MH(t,[e,n]){return Math.min(n,Math.max(e,t))}function ewe(t){const e=t+"CollectionProvider",[n,i]=WS(e),[r,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),c=F=>{const{scope:N,children:z}=F,L=kn.useRef(null),P=kn.useRef(new Map).current;return re.jsx(r,{scope:N,itemMap:P,collectionRef:L,children:z})};c.displayName=e;const s=t+"CollectionSlot",f=kn.forwardRef((F,N)=>{const{scope:z,children:L}=F,P=o(s,z),H=Ko(N,P.collectionRef);return re.jsx(sv,{ref:H,children:L})});f.displayName=s;const v=t+"CollectionItemSlot",w="data-radix-collection-item",C=kn.forwardRef((F,N)=>{const{scope:z,children:L,...P}=F,H=kn.useRef(null),j=Ko(N,H),q=o(v,z);return kn.useEffect(()=>(q.itemMap.set(H,{ref:H,...P}),()=>void q.itemMap.delete(H))),re.jsx(sv,{[w]:"",ref:j,children:L})});C.displayName=v;function M(F){const N=o(t+"CollectionConsumer",F);return kn.useCallback(()=>{const L=N.collectionRef.current;if(!L)return[];const P=Array.from(L.querySelectorAll(`[${w}]`));return Array.from(N.itemMap.values()).sort((q,le)=>P.indexOf(q.ref.current)-P.indexOf(le.ref.current))},[N.collectionRef,N.itemMap])}return[{Provider:c,Slot:f,ItemSlot:C},M,i]}var twe=Q.createContext(void 0);function nwe(t){const e=Q.useContext(twe);return t||e||"ltr"}const iwe=["top","right","bottom","left"],lv=Math.min,pu=Math.max,hT=Math.round,WE=Math.floor,cv=t=>({x:t,y:t}),rwe={left:"right",right:"left",bottom:"top",top:"bottom"},swe={start:"end",end:"start"};function NL(t,e,n){return pu(t,lv(e,n))}function tm(t,e){return typeof t=="function"?t(e):t}function nm(t){return t.split("-")[0]}function Rw(t){return t.split("-")[1]}function rB(t){return t==="x"?"y":"x"}function sB(t){return t==="y"?"height":"width"}function uv(t){return["top","bottom"].includes(nm(t))?"y":"x"}function oB(t){return rB(uv(t))}function owe(t,e,n){n===void 0&&(n=!1);const i=Rw(t),r=oB(t),o=sB(r);let c=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(c=dT(c)),[c,dT(c)]}function awe(t){const e=dT(t);return[BL(t),e,BL(e)]}function BL(t){return t.replace(/start|end/g,e=>swe[e])}function lwe(t,e,n){const i=["left","right"],r=["right","left"],o=["top","bottom"],c=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?o:c;default:return[]}}function cwe(t,e,n,i){const r=Rw(t);let o=lwe(nm(t),n==="start",i);return r&&(o=o.map(c=>c+"-"+r),e&&(o=o.concat(o.map(BL)))),o}function dT(t){return t.replace(/left|right|bottom|top/g,e=>rwe[e])}function uwe(t){return{top:0,right:0,bottom:0,left:0,...t}}function wZ(t){return typeof t!="number"?uwe(t):{top:t,right:t,bottom:t,left:t}}function fT(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function RH(t,e,n){let{reference:i,floating:r}=t;const o=uv(e),c=oB(e),s=sB(c),f=nm(e),v=o==="y",w=i.x+i.width/2-r.width/2,C=i.y+i.height/2-r.height/2,M=i[s]/2-r[s]/2;let F;switch(f){case"top":F={x:w,y:i.y-r.height};break;case"bottom":F={x:w,y:i.y+i.height};break;case"right":F={x:i.x+i.width,y:C};break;case"left":F={x:i.x-r.width,y:C};break;default:F={x:i.x,y:i.y}}switch(Rw(e)){case"start":F[c]-=M*(n&&v?-1:1);break;case"end":F[c]+=M*(n&&v?-1:1);break}return F}const hwe=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:o=[],platform:c}=n,s=o.filter(Boolean),f=await(c.isRTL==null?void 0:c.isRTL(e));let v=await c.getElementRects({reference:t,floating:e,strategy:r}),{x:w,y:C}=RH(v,i,f),M=i,F={},N=0;for(let z=0;z<s.length;z++){const{name:L,fn:P}=s[z],{x:H,y:j,data:q,reset:le}=await P({x:w,y:C,initialPlacement:i,placement:M,strategy:r,middlewareData:F,rects:v,platform:c,elements:{reference:t,floating:e}});w=H??w,C=j??C,F={...F,[L]:{...F[L],...q}},le&&N<=50&&(N++,typeof le=="object"&&(le.placement&&(M=le.placement),le.rects&&(v=le.rects===!0?await c.getElementRects({reference:t,floating:e,strategy:r}):le.rects),{x:w,y:C}=RH(v,M,f)),z=-1)}return{x:w,y:C,placement:M,strategy:r,middlewareData:F}};async function aS(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:o,rects:c,elements:s,strategy:f}=t,{boundary:v="clippingAncestors",rootBoundary:w="viewport",elementContext:C="floating",altBoundary:M=!1,padding:F=0}=tm(e,t),N=wZ(F),L=s[M?C==="floating"?"reference":"floating":C],P=fT(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(L)))==null||n?L:L.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:v,rootBoundary:w,strategy:f})),H=C==="floating"?{x:i,y:r,width:c.floating.width,height:c.floating.height}:c.reference,j=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),q=await(o.isElement==null?void 0:o.isElement(j))?await(o.getScale==null?void 0:o.getScale(j))||{x:1,y:1}:{x:1,y:1},le=fT(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:H,offsetParent:j,strategy:f}):H);return{top:(P.top-le.top+N.top)/q.y,bottom:(le.bottom-P.bottom+N.bottom)/q.y,left:(P.left-le.left+N.left)/q.x,right:(le.right-P.right+N.right)/q.x}}const dwe=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:o,platform:c,elements:s,middlewareData:f}=e,{element:v,padding:w=0}=tm(t,e)||{};if(v==null)return{};const C=wZ(w),M={x:n,y:i},F=oB(r),N=sB(F),z=await c.getDimensions(v),L=F==="y",P=L?"top":"left",H=L?"bottom":"right",j=L?"clientHeight":"clientWidth",q=o.reference[N]+o.reference[F]-M[F]-o.floating[N],le=M[F]-o.reference[F],ce=await(c.getOffsetParent==null?void 0:c.getOffsetParent(v));let ae=ce?ce[j]:0;(!ae||!await(c.isElement==null?void 0:c.isElement(ce)))&&(ae=s.floating[j]||o.floating[N]);const pe=q/2-le/2,fe=ae/2-z[N]/2-1,ue=lv(C[P],fe),Ee=lv(C[H],fe),We=ue,rt=ae-z[N]-Ee,tt=ae/2-z[N]/2+pe,Ye=NL(We,tt,rt),qe=!f.arrow&&Rw(r)!=null&&tt!==Ye&&o.reference[N]/2-(tt<We?ue:Ee)-z[N]/2<0,ft=qe?tt<We?tt-We:tt-rt:0;return{[F]:M[F]+ft,data:{[F]:Ye,centerOffset:tt-Ye-ft,...qe&&{alignmentOffset:ft}},reset:qe}}}),fwe=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:o,rects:c,initialPlacement:s,platform:f,elements:v}=e,{mainAxis:w=!0,crossAxis:C=!0,fallbackPlacements:M,fallbackStrategy:F="bestFit",fallbackAxisSideDirection:N="none",flipAlignment:z=!0,...L}=tm(t,e);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const P=nm(r),H=uv(s),j=nm(s)===s,q=await(f.isRTL==null?void 0:f.isRTL(v.floating)),le=M||(j||!z?[dT(s)]:awe(s)),ce=N!=="none";!M&&ce&&le.push(...cwe(s,z,N,q));const ae=[s,...le],pe=await aS(e,L),fe=[];let ue=((i=o.flip)==null?void 0:i.overflows)||[];if(w&&fe.push(pe[P]),C){const tt=owe(r,c,q);fe.push(pe[tt[0]],pe[tt[1]])}if(ue=[...ue,{placement:r,overflows:fe}],!fe.every(tt=>tt<=0)){var Ee,We;const tt=(((Ee=o.flip)==null?void 0:Ee.index)||0)+1,Ye=ae[tt];if(Ye)return{data:{index:tt,overflows:ue},reset:{placement:Ye}};let qe=(We=ue.filter(ft=>ft.overflows[0]<=0).sort((ft,Me)=>ft.overflows[1]-Me.overflows[1])[0])==null?void 0:We.placement;if(!qe)switch(F){case"bestFit":{var rt;const ft=(rt=ue.filter(Me=>{if(ce){const $e=uv(Me.placement);return $e===H||$e==="y"}return!0}).map(Me=>[Me.placement,Me.overflows.filter($e=>$e>0).reduce(($e,ut)=>$e+ut,0)]).sort((Me,$e)=>Me[1]-$e[1])[0])==null?void 0:rt[0];ft&&(qe=ft);break}case"initialPlacement":qe=s;break}if(r!==qe)return{reset:{placement:qe}}}return{}}}};function TH(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function AH(t){return iwe.some(e=>t[e]>=0)}const pwe=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=tm(t,e);switch(i){case"referenceHidden":{const o=await aS(e,{...r,elementContext:"reference"}),c=TH(o,n.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:AH(c)}}}case"escaped":{const o=await aS(e,{...r,altBoundary:!0}),c=TH(o,n.floating);return{data:{escapedOffsets:c,escaped:AH(c)}}}default:return{}}}}};async function mwe(t,e){const{placement:n,platform:i,elements:r}=t,o=await(i.isRTL==null?void 0:i.isRTL(r.floating)),c=nm(n),s=Rw(n),f=uv(n)==="y",v=["left","top"].includes(c)?-1:1,w=o&&f?-1:1,C=tm(e,t);let{mainAxis:M,crossAxis:F,alignmentAxis:N}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return s&&typeof N=="number"&&(F=s==="end"?N*-1:N),f?{x:F*w,y:M*v}:{x:M*v,y:F*w}}const gwe=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:o,placement:c,middlewareData:s}=e,f=await mwe(e,t);return c===((n=s.offset)==null?void 0:n.placement)&&(i=s.arrow)!=null&&i.alignmentOffset?{}:{x:r+f.x,y:o+f.y,data:{...f,placement:c}}}}},vwe=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:o=!0,crossAxis:c=!1,limiter:s={fn:L=>{let{x:P,y:H}=L;return{x:P,y:H}}},...f}=tm(t,e),v={x:n,y:i},w=await aS(e,f),C=uv(nm(r)),M=rB(C);let F=v[M],N=v[C];if(o){const L=M==="y"?"top":"left",P=M==="y"?"bottom":"right",H=F+w[L],j=F-w[P];F=NL(H,F,j)}if(c){const L=C==="y"?"top":"left",P=C==="y"?"bottom":"right",H=N+w[L],j=N-w[P];N=NL(H,N,j)}const z=s.fn({...e,[M]:F,[C]:N});return{...z,data:{x:z.x-n,y:z.y-i,enabled:{[M]:o,[C]:c}}}}}},ywe=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:o,middlewareData:c}=e,{offset:s=0,mainAxis:f=!0,crossAxis:v=!0}=tm(t,e),w={x:n,y:i},C=uv(r),M=rB(C);let F=w[M],N=w[C];const z=tm(s,e),L=typeof z=="number"?{mainAxis:z,crossAxis:0}:{mainAxis:0,crossAxis:0,...z};if(f){const j=M==="y"?"height":"width",q=o.reference[M]-o.floating[j]+L.mainAxis,le=o.reference[M]+o.reference[j]-L.mainAxis;F<q?F=q:F>le&&(F=le)}if(v){var P,H;const j=M==="y"?"width":"height",q=["top","left"].includes(nm(r)),le=o.reference[C]-o.floating[j]+(q&&((P=c.offset)==null?void 0:P[C])||0)+(q?0:L.crossAxis),ce=o.reference[C]+o.reference[j]+(q?0:((H=c.offset)==null?void 0:H[C])||0)-(q?L.crossAxis:0);N<le?N=le:N>ce&&(N=ce)}return{[M]:F,[C]:N}}}},_we=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:o,platform:c,elements:s}=e,{apply:f=()=>{},...v}=tm(t,e),w=await aS(e,v),C=nm(r),M=Rw(r),F=uv(r)==="y",{width:N,height:z}=o.floating;let L,P;C==="top"||C==="bottom"?(L=C,P=M===(await(c.isRTL==null?void 0:c.isRTL(s.floating))?"start":"end")?"left":"right"):(P=C,L=M==="end"?"top":"bottom");const H=z-w.top-w.bottom,j=N-w.left-w.right,q=lv(z-w[L],H),le=lv(N-w[P],j),ce=!e.middlewareData.shift;let ae=q,pe=le;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(pe=j),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(ae=H),ce&&!M){const ue=pu(w.left,0),Ee=pu(w.right,0),We=pu(w.top,0),rt=pu(w.bottom,0);F?pe=N-2*(ue!==0||Ee!==0?ue+Ee:pu(w.left,w.right)):ae=z-2*(We!==0||rt!==0?We+rt:pu(w.top,w.bottom))}await f({...e,availableWidth:pe,availableHeight:ae});const fe=await c.getDimensions(s.floating);return N!==fe.width||z!==fe.height?{reset:{rects:!0}}:{}}}};function NA(){return typeof window<"u"}function Tw(t){return CZ(t)?(t.nodeName||"").toLowerCase():"#document"}function _u(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Af(t){var e;return(e=(CZ(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function CZ(t){return NA()?t instanceof Node||t instanceof _u(t).Node:!1}function ud(t){return NA()?t instanceof Element||t instanceof _u(t).Element:!1}function Mf(t){return NA()?t instanceof HTMLElement||t instanceof _u(t).HTMLElement:!1}function PH(t){return!NA()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof _u(t).ShadowRoot}function $S(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=hd(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function xwe(t){return["table","td","th"].includes(Tw(t))}function BA(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function aB(t){const e=lB(),n=ud(t)?hd(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function wwe(t){let e=hv(t);for(;Mf(e)&&!sw(e);){if(aB(e))return e;if(BA(e))return null;e=hv(e)}return null}function lB(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function sw(t){return["html","body","#document"].includes(Tw(t))}function hd(t){return _u(t).getComputedStyle(t)}function zA(t){return ud(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function hv(t){if(Tw(t)==="html")return t;const e=t.assignedSlot||t.parentNode||PH(t)&&t.host||Af(t);return PH(e)?e.host:e}function SZ(t){const e=hv(t);return sw(e)?t.ownerDocument?t.ownerDocument.body:t.body:Mf(e)&&$S(e)?e:SZ(e)}function lS(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=SZ(t),o=r===((i=t.ownerDocument)==null?void 0:i.body),c=_u(r);if(o){const s=zL(c);return e.concat(c,c.visualViewport||[],$S(r)?r:[],s&&n?lS(s):[])}return e.concat(r,lS(r,[],n))}function zL(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function bZ(t){const e=hd(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=Mf(t),o=r?t.offsetWidth:n,c=r?t.offsetHeight:i,s=hT(n)!==o||hT(i)!==c;return s&&(n=o,i=c),{width:n,height:i,$:s}}function cB(t){return ud(t)?t:t.contextElement}function Dx(t){const e=cB(t);if(!Mf(e))return cv(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:o}=bZ(e);let c=(o?hT(n.width):n.width)/i,s=(o?hT(n.height):n.height)/r;return(!c||!Number.isFinite(c))&&(c=1),(!s||!Number.isFinite(s))&&(s=1),{x:c,y:s}}const Cwe=cv(0);function EZ(t){const e=_u(t);return!lB()||!e.visualViewport?Cwe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Swe(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==_u(t)?!1:e}function S_(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=cB(t);let c=cv(1);e&&(i?ud(i)&&(c=Dx(i)):c=Dx(t));const s=Swe(o,n,i)?EZ(o):cv(0);let f=(r.left+s.x)/c.x,v=(r.top+s.y)/c.y,w=r.width/c.x,C=r.height/c.y;if(o){const M=_u(o),F=i&&ud(i)?_u(i):i;let N=M,z=zL(N);for(;z&&i&&F!==N;){const L=Dx(z),P=z.getBoundingClientRect(),H=hd(z),j=P.left+(z.clientLeft+parseFloat(H.paddingLeft))*L.x,q=P.top+(z.clientTop+parseFloat(H.paddingTop))*L.y;f*=L.x,v*=L.y,w*=L.x,C*=L.y,f+=j,v+=q,N=_u(z),z=zL(N)}}return fT({width:w,height:C,x:f,y:v})}function bwe(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const o=r==="fixed",c=Af(i),s=e?BA(e.floating):!1;if(i===c||s&&o)return n;let f={scrollLeft:0,scrollTop:0},v=cv(1);const w=cv(0),C=Mf(i);if((C||!C&&!o)&&((Tw(i)!=="body"||$S(c))&&(f=zA(i)),Mf(i))){const M=S_(i);v=Dx(i),w.x=M.x+i.clientLeft,w.y=M.y+i.clientTop}return{width:n.width*v.x,height:n.height*v.y,x:n.x*v.x-f.scrollLeft*v.x+w.x,y:n.y*v.y-f.scrollTop*v.y+w.y}}function Ewe(t){return Array.from(t.getClientRects())}function UL(t,e){const n=zA(t).scrollLeft;return e?e.left+n:S_(Af(t)).left+n}function Mwe(t){const e=Af(t),n=zA(t),i=t.ownerDocument.body,r=pu(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),o=pu(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let c=-n.scrollLeft+UL(t);const s=-n.scrollTop;return hd(i).direction==="rtl"&&(c+=pu(e.clientWidth,i.clientWidth)-r),{width:r,height:o,x:c,y:s}}function Rwe(t,e){const n=_u(t),i=Af(t),r=n.visualViewport;let o=i.clientWidth,c=i.clientHeight,s=0,f=0;if(r){o=r.width,c=r.height;const v=lB();(!v||v&&e==="fixed")&&(s=r.offsetLeft,f=r.offsetTop)}return{width:o,height:c,x:s,y:f}}function Twe(t,e){const n=S_(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,o=Mf(t)?Dx(t):cv(1),c=t.clientWidth*o.x,s=t.clientHeight*o.y,f=r*o.x,v=i*o.y;return{width:c,height:s,x:f,y:v}}function IH(t,e,n){let i;if(e==="viewport")i=Rwe(t,n);else if(e==="document")i=Mwe(Af(t));else if(ud(e))i=Twe(e,n);else{const r=EZ(t);i={...e,x:e.x-r.x,y:e.y-r.y}}return fT(i)}function MZ(t,e){const n=hv(t);return n===e||!ud(n)||sw(n)?!1:hd(n).position==="fixed"||MZ(n,e)}function Awe(t,e){const n=e.get(t);if(n)return n;let i=lS(t,[],!1).filter(s=>ud(s)&&Tw(s)!=="body"),r=null;const o=hd(t).position==="fixed";let c=o?hv(t):t;for(;ud(c)&&!sw(c);){const s=hd(c),f=aB(c);!f&&s.position==="fixed"&&(r=null),(o?!f&&!r:!f&&s.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||$S(c)&&!f&&MZ(t,c))?i=i.filter(w=>w!==c):r=s,c=hv(c)}return e.set(t,i),i}function Pwe(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const c=[...n==="clippingAncestors"?BA(e)?[]:Awe(e,this._c):[].concat(n),i],s=c[0],f=c.reduce((v,w)=>{const C=IH(e,w,r);return v.top=pu(C.top,v.top),v.right=lv(C.right,v.right),v.bottom=lv(C.bottom,v.bottom),v.left=pu(C.left,v.left),v},IH(e,s,r));return{width:f.right-f.left,height:f.bottom-f.top,x:f.left,y:f.top}}function Iwe(t){const{width:e,height:n}=bZ(t);return{width:e,height:n}}function Dwe(t,e,n){const i=Mf(e),r=Af(e),o=n==="fixed",c=S_(t,!0,o,e);let s={scrollLeft:0,scrollTop:0};const f=cv(0);if(i||!i&&!o)if((Tw(e)!=="body"||$S(r))&&(s=zA(e)),i){const F=S_(e,!0,o,e);f.x=F.x+e.clientLeft,f.y=F.y+e.clientTop}else r&&(f.x=UL(r));let v=0,w=0;if(r&&!i&&!o){const F=r.getBoundingClientRect();w=F.top+s.scrollTop,v=F.left+s.scrollLeft-UL(r,F)}const C=c.left+s.scrollLeft-f.x-v,M=c.top+s.scrollTop-f.y-w;return{x:C,y:M,width:c.width,height:c.height}}function zD(t){return hd(t).position==="static"}function DH(t,e){if(!Mf(t)||hd(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Af(t)===n&&(n=n.ownerDocument.body),n}function RZ(t,e){const n=_u(t);if(BA(t))return n;if(!Mf(t)){let r=hv(t);for(;r&&!sw(r);){if(ud(r)&&!zD(r))return r;r=hv(r)}return n}let i=DH(t,e);for(;i&&xwe(i)&&zD(i);)i=DH(i,e);return i&&sw(i)&&zD(i)&&!aB(i)?n:i||wwe(t)||n}const Fwe=async function(t){const e=this.getOffsetParent||RZ,n=this.getDimensions,i=await n(t.floating);return{reference:Dwe(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function Lwe(t){return hd(t).direction==="rtl"}const Owe={convertOffsetParentRelativeRectToViewportRelativeRect:bwe,getDocumentElement:Af,getClippingRect:Pwe,getOffsetParent:RZ,getElementRects:Fwe,getClientRects:Ewe,getDimensions:Iwe,getScale:Dx,isElement:ud,isRTL:Lwe};function kwe(t,e){let n=null,i;const r=Af(t);function o(){var s;clearTimeout(i),(s=n)==null||s.disconnect(),n=null}function c(s,f){s===void 0&&(s=!1),f===void 0&&(f=1),o();const{left:v,top:w,width:C,height:M}=t.getBoundingClientRect();if(s||e(),!C||!M)return;const F=WE(w),N=WE(r.clientWidth-(v+C)),z=WE(r.clientHeight-(w+M)),L=WE(v),H={rootMargin:-F+"px "+-N+"px "+-z+"px "+-L+"px",threshold:pu(0,lv(1,f))||1};let j=!0;function q(le){const ce=le[0].intersectionRatio;if(ce!==f){if(!j)return c();ce?c(!1,ce):i=setTimeout(()=>{c(!1,1e-7)},1e3)}j=!1}try{n=new IntersectionObserver(q,{...H,root:r.ownerDocument})}catch{n=new IntersectionObserver(q,H)}n.observe(t)}return c(!0),o}function Nwe(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:f=!1}=i,v=cB(t),w=r||o?[...v?lS(v):[],...lS(e)]:[];w.forEach(P=>{r&&P.addEventListener("scroll",n,{passive:!0}),o&&P.addEventListener("resize",n)});const C=v&&s?kwe(v,n):null;let M=-1,F=null;c&&(F=new ResizeObserver(P=>{let[H]=P;H&&H.target===v&&F&&(F.unobserve(e),cancelAnimationFrame(M),M=requestAnimationFrame(()=>{var j;(j=F)==null||j.observe(e)})),n()}),v&&!f&&F.observe(v),F.observe(e));let N,z=f?S_(t):null;f&&L();function L(){const P=S_(t);z&&(P.x!==z.x||P.y!==z.y||P.width!==z.width||P.height!==z.height)&&n(),z=P,N=requestAnimationFrame(L)}return n(),()=>{var P;w.forEach(H=>{r&&H.removeEventListener("scroll",n),o&&H.removeEventListener("resize",n)}),C==null||C(),(P=F)==null||P.disconnect(),F=null,f&&cancelAnimationFrame(N)}}const Bwe=gwe,zwe=vwe,Uwe=fwe,Vwe=_we,Gwe=pwe,FH=dwe,Hwe=ywe,Wwe=(t,e,n)=>{const i=new Map,r={platform:Owe,...n},o={...r.platform,_c:i};return hwe(t,e,{...r,platform:o})};var fR=typeof document<"u"?Q.useLayoutEffect:Q.useEffect;function pT(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!pT(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const o=r[i];if(!(o==="_owner"&&t.$$typeof)&&!pT(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function TZ(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function LH(t,e){const n=TZ(t);return Math.round(e*n)/n}function UD(t){const e=Q.useRef(t);return fR(()=>{e.current=t}),e}function jwe(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:o,floating:c}={},transform:s=!0,whileElementsMounted:f,open:v}=t,[w,C]=Q.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[M,F]=Q.useState(i);pT(M,i)||F(i);const[N,z]=Q.useState(null),[L,P]=Q.useState(null),H=Q.useCallback(Me=>{Me!==ce.current&&(ce.current=Me,z(Me))},[]),j=Q.useCallback(Me=>{Me!==ae.current&&(ae.current=Me,P(Me))},[]),q=o||N,le=c||L,ce=Q.useRef(null),ae=Q.useRef(null),pe=Q.useRef(w),fe=f!=null,ue=UD(f),Ee=UD(r),We=UD(v),rt=Q.useCallback(()=>{if(!ce.current||!ae.current)return;const Me={placement:e,strategy:n,middleware:M};Ee.current&&(Me.platform=Ee.current),Wwe(ce.current,ae.current,Me).then($e=>{const ut={...$e,isPositioned:We.current!==!1};tt.current&&!pT(pe.current,ut)&&(pe.current=ut,rh.flushSync(()=>{C(ut)}))})},[M,e,n,Ee,We]);fR(()=>{v===!1&&pe.current.isPositioned&&(pe.current.isPositioned=!1,C(Me=>({...Me,isPositioned:!1})))},[v]);const tt=Q.useRef(!1);fR(()=>(tt.current=!0,()=>{tt.current=!1}),[]),fR(()=>{if(q&&(ce.current=q),le&&(ae.current=le),q&&le){if(ue.current)return ue.current(q,le,rt);rt()}},[q,le,rt,ue,fe]);const Ye=Q.useMemo(()=>({reference:ce,floating:ae,setReference:H,setFloating:j}),[H,j]),qe=Q.useMemo(()=>({reference:q,floating:le}),[q,le]),ft=Q.useMemo(()=>{const Me={position:n,left:0,top:0};if(!qe.floating)return Me;const $e=LH(qe.floating,w.x),ut=LH(qe.floating,w.y);return s?{...Me,transform:"translate("+$e+"px, "+ut+"px)",...TZ(qe.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:$e,top:ut}},[n,s,qe.floating,w.x,w.y]);return Q.useMemo(()=>({...w,update:rt,refs:Ye,elements:qe,floatingStyles:ft}),[w,rt,Ye,qe,ft])}const $we=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?FH({element:i.current,padding:r}).fn(n):{}:i?FH({element:i,padding:r}).fn(n):{}}}},qwe=(t,e)=>({...Bwe(t),options:[t,e]}),Zwe=(t,e)=>({...zwe(t),options:[t,e]}),Xwe=(t,e)=>({...Hwe(t),options:[t,e]}),Kwe=(t,e)=>({...Uwe(t),options:[t,e]}),Ywe=(t,e)=>({...Vwe(t),options:[t,e]}),Jwe=(t,e)=>({...Gwe(t),options:[t,e]}),Qwe=(t,e)=>({...$we(t),options:[t,e]});var eCe="Arrow",AZ=Q.forwardRef((t,e)=>{const{children:n,width:i=10,height:r=5,...o}=t;return re.jsx(Vs.svg,{...o,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:re.jsx("polygon",{points:"0,0 30,0 15,10"})})});AZ.displayName=eCe;var tCe=AZ;function PZ(t){const[e,n]=Q.useState(void 0);return ec(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const o=r[0];let c,s;if("borderBoxSize"in o){const f=o.borderBoxSize,v=Array.isArray(f)?f[0]:f;c=v.inlineSize,s=v.blockSize}else c=t.offsetWidth,s=t.offsetHeight;n({width:c,height:s})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}var uB="Popper",[IZ,DZ]=WS(uB),[nCe,FZ]=IZ(uB),LZ=t=>{const{__scopePopper:e,children:n}=t,[i,r]=Q.useState(null);return re.jsx(nCe,{scope:e,anchor:i,onAnchorChange:r,children:n})};LZ.displayName=uB;var OZ="PopperAnchor",kZ=Q.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,o=FZ(OZ,n),c=Q.useRef(null),s=Ko(e,c);return Q.useEffect(()=>{o.onAnchorChange((i==null?void 0:i.current)||c.current)}),i?null:re.jsx(Vs.div,{...r,ref:s})});kZ.displayName=OZ;var hB="PopperContent",[iCe,rCe]=IZ(hB),NZ=Q.forwardRef((t,e)=>{var De,kt,rn,Re,Kt,bt;const{__scopePopper:n,side:i="bottom",sideOffset:r=0,align:o="center",alignOffset:c=0,arrowPadding:s=0,avoidCollisions:f=!0,collisionBoundary:v=[],collisionPadding:w=0,sticky:C="partial",hideWhenDetached:M=!1,updatePositionStrategy:F="optimized",onPlaced:N,...z}=t,L=FZ(hB,n),[P,H]=Q.useState(null),j=Ko(e,Dt=>H(Dt)),[q,le]=Q.useState(null),ce=PZ(q),ae=(ce==null?void 0:ce.width)??0,pe=(ce==null?void 0:ce.height)??0,fe=i+(o!=="center"?"-"+o:""),ue=typeof w=="number"?w:{top:0,right:0,bottom:0,left:0,...w},Ee=Array.isArray(v)?v:[v],We=Ee.length>0,rt={padding:ue,boundary:Ee.filter(oCe),altBoundary:We},{refs:tt,floatingStyles:Ye,placement:qe,isPositioned:ft,middlewareData:Me}=jwe({strategy:"fixed",placement:fe,whileElementsMounted:(...Dt)=>Nwe(...Dt,{animationFrame:F==="always"}),elements:{reference:L.anchor},middleware:[qwe({mainAxis:r+pe,alignmentAxis:c}),f&&Zwe({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?Xwe():void 0,...rt}),f&&Kwe({...rt}),Ywe({...rt,apply:({elements:Dt,rects:_e,availableWidth:At,availableHeight:Ot})=>{const{width:tn,height:xe}=_e.reference,Se=Dt.floating.style;Se.setProperty("--radix-popper-available-width",`${At}px`),Se.setProperty("--radix-popper-available-height",`${Ot}px`),Se.setProperty("--radix-popper-anchor-width",`${tn}px`),Se.setProperty("--radix-popper-anchor-height",`${xe}px`)}}),q&&Qwe({element:q,padding:s}),aCe({arrowWidth:ae,arrowHeight:pe}),M&&Jwe({strategy:"referenceHidden",...rt})]}),[$e,ut]=UZ(qe),Mt=em(N);ec(()=>{ft&&(Mt==null||Mt())},[ft,Mt]);const Gt=(De=Me.arrow)==null?void 0:De.x,Xt=(kt=Me.arrow)==null?void 0:kt.y,Qe=((rn=Me.arrow)==null?void 0:rn.centerOffset)!==0,[Ge,He]=Q.useState();return ec(()=>{P&&He(window.getComputedStyle(P).zIndex)},[P]),re.jsx("div",{ref:tt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ye,transform:ft?Ye.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ge,"--radix-popper-transform-origin":[(Re=Me.transformOrigin)==null?void 0:Re.x,(Kt=Me.transformOrigin)==null?void 0:Kt.y].join(" "),...((bt=Me.hide)==null?void 0:bt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:re.jsx(iCe,{scope:n,placedSide:$e,onArrowChange:le,arrowX:Gt,arrowY:Xt,shouldHideArrow:Qe,children:re.jsx(Vs.div,{"data-side":$e,"data-align":ut,...z,ref:j,style:{...z.style,animation:ft?void 0:"none"}})})})});NZ.displayName=hB;var BZ="PopperArrow",sCe={top:"bottom",right:"left",bottom:"top",left:"right"},zZ=Q.forwardRef(function(e,n){const{__scopePopper:i,...r}=e,o=rCe(BZ,i),c=sCe[o.placedSide];return re.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[c]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:re.jsx(tCe,{...r,ref:n,style:{...r.style,display:"block"}})})});zZ.displayName=BZ;function oCe(t){return t!==null}var aCe=t=>({name:"transformOrigin",options:t,fn(e){var L,P,H;const{placement:n,rects:i,middlewareData:r}=e,c=((L=r.arrow)==null?void 0:L.centerOffset)!==0,s=c?0:t.arrowWidth,f=c?0:t.arrowHeight,[v,w]=UZ(n),C={start:"0%",center:"50%",end:"100%"}[w],M=(((P=r.arrow)==null?void 0:P.x)??0)+s/2,F=(((H=r.arrow)==null?void 0:H.y)??0)+f/2;let N="",z="";return v==="bottom"?(N=c?C:`${M}px`,z=`${-f}px`):v==="top"?(N=c?C:`${M}px`,z=`${i.floating.height+f}px`):v==="right"?(N=`${-f}px`,z=c?C:`${F}px`):v==="left"&&(N=`${i.floating.width+f}px`,z=c?C:`${F}px`),{data:{x:N,y:z}}}});function UZ(t){const[e,n="center"]=t.split("-");return[e,n]}var lCe=LZ,cCe=kZ,uCe=NZ,hCe=zZ;function VZ(t){const e=Q.useRef({value:t,previous:t});return Q.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var dCe="VisuallyHidden",GZ=Q.forwardRef((t,e)=>re.jsx(Vs.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));GZ.displayName=dCe;var fCe=[" ","Enter","ArrowUp","ArrowDown"],pCe=[" ","Enter"],qS="Select",[UA,VA,mCe]=ewe(qS),[Aw,QLe]=WS(qS,[mCe,DZ]),GA=DZ(),[gCe,Cv]=Aw(qS),[vCe,yCe]=Aw(qS),HZ=t=>{const{__scopeSelect:e,children:n,open:i,defaultOpen:r,onOpenChange:o,value:c,defaultValue:s,onValueChange:f,dir:v,name:w,autoComplete:C,disabled:M,required:F}=t,N=GA(e),[z,L]=Q.useState(null),[P,H]=Q.useState(null),[j,q]=Q.useState(!1),le=nwe(v),[ce=!1,ae]=cT({prop:i,defaultProp:r,onChange:o}),[pe,fe]=cT({prop:c,defaultProp:s,onChange:f}),ue=Q.useRef(null),Ee=z?!!z.closest("form"):!0,[We,rt]=Q.useState(new Set),tt=Array.from(We).map(Ye=>Ye.props.value).join(";");return re.jsx(lCe,{...N,children:re.jsxs(gCe,{required:F,scope:e,trigger:z,onTriggerChange:L,valueNode:P,onValueNodeChange:H,valueNodeHasChildren:j,onValueNodeHasChildrenChange:q,contentId:Px(),value:pe,onValueChange:fe,open:ce,onOpenChange:ae,dir:le,triggerPointerDownPosRef:ue,disabled:M,children:[re.jsx(UA.Provider,{scope:e,children:re.jsx(vCe,{scope:t.__scopeSelect,onNativeOptionAdd:Q.useCallback(Ye=>{rt(qe=>new Set(qe).add(Ye))},[]),onNativeOptionRemove:Q.useCallback(Ye=>{rt(qe=>{const ft=new Set(qe);return ft.delete(Ye),ft})},[]),children:n})}),Ee?re.jsxs(pX,{"aria-hidden":!0,required:F,tabIndex:-1,name:w,autoComplete:C,value:pe,onChange:Ye=>fe(Ye.target.value),disabled:M,children:[pe===void 0?re.jsx("option",{value:""}):null,Array.from(We)]},tt):null]})})};HZ.displayName=qS;var WZ="SelectTrigger",jZ=Q.forwardRef((t,e)=>{const{__scopeSelect:n,disabled:i=!1,...r}=t,o=GA(n),c=Cv(WZ,n),s=c.disabled||i,f=Ko(e,c.onTriggerChange),v=VA(n),[w,C,M]=mX(N=>{const z=v().filter(H=>!H.disabled),L=z.find(H=>H.value===c.value),P=gX(z,N,L);P!==void 0&&c.onValueChange(P.value)}),F=()=>{s||(c.onOpenChange(!0),M())};return re.jsx(cCe,{asChild:!0,...o,children:re.jsx(Vs.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":fX(c.value)?"":void 0,...r,ref:f,onClick:co(r.onClick,N=>{N.currentTarget.focus()}),onPointerDown:co(r.onPointerDown,N=>{const z=N.target;z.hasPointerCapture(N.pointerId)&&z.releasePointerCapture(N.pointerId),N.button===0&&N.ctrlKey===!1&&(F(),c.triggerPointerDownPosRef.current={x:Math.round(N.pageX),y:Math.round(N.pageY)},N.preventDefault())}),onKeyDown:co(r.onKeyDown,N=>{const z=w.current!=="";!(N.ctrlKey||N.altKey||N.metaKey)&&N.key.length===1&&C(N.key),!(z&&N.key===" ")&&fCe.includes(N.key)&&(F(),N.preventDefault())})})})});jZ.displayName=WZ;var $Z="SelectValue",qZ=Q.forwardRef((t,e)=>{const{__scopeSelect:n,className:i,style:r,children:o,placeholder:c="",...s}=t,f=Cv($Z,n),{onValueNodeHasChildrenChange:v}=f,w=o!==void 0,C=Ko(e,f.onValueNodeChange);return ec(()=>{v(w)},[v,w]),re.jsx(Vs.span,{...s,ref:C,style:{pointerEvents:"none"},children:fX(f.value)?re.jsx(re.Fragment,{children:c}):o})});qZ.displayName=$Z;var _Ce="SelectIcon",ZZ=Q.forwardRef((t,e)=>{const{__scopeSelect:n,children:i,...r}=t;return re.jsx(Vs.span,{"aria-hidden":!0,...r,ref:e,children:i||"▼"})});ZZ.displayName=_Ce;var xCe="SelectPortal",XZ=t=>re.jsx(J3,{asChild:!0,...t});XZ.displayName=xCe;var b_="SelectContent",KZ=Q.forwardRef((t,e)=>{const n=Cv(b_,t.__scopeSelect),[i,r]=Q.useState();if(ec(()=>{r(new DocumentFragment)},[]),!n.open){const o=i;return o?rh.createPortal(re.jsx(YZ,{scope:t.__scopeSelect,children:re.jsx(UA.Slot,{scope:t.__scopeSelect,children:re.jsx("div",{children:t.children})})}),o):null}return re.jsx(JZ,{...t,ref:e})});KZ.displayName=b_;var Pp=10,[YZ,Sv]=Aw(b_),wCe="SelectContentImpl",JZ=Q.forwardRef((t,e)=>{const{__scopeSelect:n,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:o,onPointerDownOutside:c,side:s,sideOffset:f,align:v,alignOffset:w,arrowPadding:C,collisionBoundary:M,collisionPadding:F,sticky:N,hideWhenDetached:z,avoidCollisions:L,...P}=t,H=Cv(b_,n),[j,q]=Q.useState(null),[le,ce]=Q.useState(null),ae=Ko(e,De=>q(De)),[pe,fe]=Q.useState(null),[ue,Ee]=Q.useState(null),We=VA(n),[rt,tt]=Q.useState(!1),Ye=Q.useRef(!1);Q.useEffect(()=>{if(j)return Jq(j)},[j]),Hq();const qe=Q.useCallback(De=>{const[kt,...rn]=We().map(bt=>bt.ref.current),[Re]=rn.slice(-1),Kt=document.activeElement;for(const bt of De)if(bt===Kt||(bt==null||bt.scrollIntoView({block:"nearest"}),bt===kt&&le&&(le.scrollTop=0),bt===Re&&le&&(le.scrollTop=le.scrollHeight),bt==null||bt.focus(),document.activeElement!==Kt))return},[We,le]),ft=Q.useCallback(()=>qe([pe,j]),[qe,pe,j]);Q.useEffect(()=>{rt&&ft()},[rt,ft]);const{onOpenChange:Me,triggerPointerDownPosRef:$e}=H;Q.useEffect(()=>{if(j){let De={x:0,y:0};const kt=Re=>{var Kt,bt;De={x:Math.abs(Math.round(Re.pageX)-(((Kt=$e.current)==null?void 0:Kt.x)??0)),y:Math.abs(Math.round(Re.pageY)-(((bt=$e.current)==null?void 0:bt.y)??0))}},rn=Re=>{De.x<=10&&De.y<=10?Re.preventDefault():j.contains(Re.target)||Me(!1),document.removeEventListener("pointermove",kt),$e.current=null};return $e.current!==null&&(document.addEventListener("pointermove",kt),document.addEventListener("pointerup",rn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",kt),document.removeEventListener("pointerup",rn,{capture:!0})}}},[j,Me,$e]),Q.useEffect(()=>{const De=()=>Me(!1);return window.addEventListener("blur",De),window.addEventListener("resize",De),()=>{window.removeEventListener("blur",De),window.removeEventListener("resize",De)}},[Me]);const[ut,Mt]=mX(De=>{const kt=We().filter(Kt=>!Kt.disabled),rn=kt.find(Kt=>Kt.ref.current===document.activeElement),Re=gX(kt,De,rn);Re&&setTimeout(()=>Re.ref.current.focus())}),Gt=Q.useCallback((De,kt,rn)=>{const Re=!Ye.current&&!rn;(H.value!==void 0&&H.value===kt||Re)&&(fe(De),Re&&(Ye.current=!0))},[H.value]),Xt=Q.useCallback(()=>j==null?void 0:j.focus(),[j]),Qe=Q.useCallback((De,kt,rn)=>{const Re=!Ye.current&&!rn;(H.value!==void 0&&H.value===kt||Re)&&Ee(De)},[H.value]),Ge=i==="popper"?VL:QZ,He=Ge===VL?{side:s,sideOffset:f,align:v,alignOffset:w,arrowPadding:C,collisionBoundary:M,collisionPadding:F,sticky:N,hideWhenDetached:z,avoidCollisions:L}:{};return re.jsx(YZ,{scope:n,content:j,viewport:le,onViewportChange:ce,itemRefCallback:Gt,selectedItem:pe,onItemLeave:Xt,itemTextRefCallback:Qe,focusSelectedItem:ft,selectedItemText:ue,position:i,isPositioned:rt,searchRef:ut,children:re.jsx(Q3,{as:sv,allowPinchZoom:!0,children:re.jsx(Y3,{asChild:!0,trapped:H.open,onMountAutoFocus:De=>{De.preventDefault()},onUnmountAutoFocus:co(r,De=>{var kt;(kt=H.trigger)==null||kt.focus({preventScroll:!0}),De.preventDefault()}),children:re.jsx(K3,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:c,onFocusOutside:De=>De.preventDefault(),onDismiss:()=>H.onOpenChange(!1),children:re.jsx(Ge,{role:"listbox",id:H.contentId,"data-state":H.open?"open":"closed",dir:H.dir,onContextMenu:De=>De.preventDefault(),...P,...He,onPlaced:()=>tt(!0),ref:ae,style:{display:"flex",flexDirection:"column",outline:"none",...P.style},onKeyDown:co(P.onKeyDown,De=>{const kt=De.ctrlKey||De.altKey||De.metaKey;if(De.key==="Tab"&&De.preventDefault(),!kt&&De.key.length===1&&Mt(De.key),["ArrowUp","ArrowDown","Home","End"].includes(De.key)){let Re=We().filter(Kt=>!Kt.disabled).map(Kt=>Kt.ref.current);if(["ArrowUp","End"].includes(De.key)&&(Re=Re.slice().reverse()),["ArrowUp","ArrowDown"].includes(De.key)){const Kt=De.target,bt=Re.indexOf(Kt);Re=Re.slice(bt+1)}setTimeout(()=>qe(Re)),De.preventDefault()}})})})})})})});JZ.displayName=wCe;var CCe="SelectItemAlignedPosition",QZ=Q.forwardRef((t,e)=>{const{__scopeSelect:n,onPlaced:i,...r}=t,o=Cv(b_,n),c=Sv(b_,n),[s,f]=Q.useState(null),[v,w]=Q.useState(null),C=Ko(e,ae=>w(ae)),M=VA(n),F=Q.useRef(!1),N=Q.useRef(!0),{viewport:z,selectedItem:L,selectedItemText:P,focusSelectedItem:H}=c,j=Q.useCallback(()=>{if(o.trigger&&o.valueNode&&s&&v&&z&&L&&P){const ae=o.trigger.getBoundingClientRect(),pe=v.getBoundingClientRect(),fe=o.valueNode.getBoundingClientRect(),ue=P.getBoundingClientRect();if(o.dir!=="rtl"){const Kt=ue.left-pe.left,bt=fe.left-Kt,Dt=ae.left-bt,_e=ae.width+Dt,At=Math.max(_e,pe.width),Ot=window.innerWidth-Pp,tn=MH(bt,[Pp,Ot-At]);s.style.minWidth=_e+"px",s.style.left=tn+"px"}else{const Kt=pe.right-ue.right,bt=window.innerWidth-fe.right-Kt,Dt=window.innerWidth-ae.right-bt,_e=ae.width+Dt,At=Math.max(_e,pe.width),Ot=window.innerWidth-Pp,tn=MH(bt,[Pp,Ot-At]);s.style.minWidth=_e+"px",s.style.right=tn+"px"}const Ee=M(),We=window.innerHeight-Pp*2,rt=z.scrollHeight,tt=window.getComputedStyle(v),Ye=parseInt(tt.borderTopWidth,10),qe=parseInt(tt.paddingTop,10),ft=parseInt(tt.borderBottomWidth,10),Me=parseInt(tt.paddingBottom,10),$e=Ye+qe+rt+Me+ft,ut=Math.min(L.offsetHeight*5,$e),Mt=window.getComputedStyle(z),Gt=parseInt(Mt.paddingTop,10),Xt=parseInt(Mt.paddingBottom,10),Qe=ae.top+ae.height/2-Pp,Ge=We-Qe,He=L.offsetHeight/2,De=L.offsetTop+He,kt=Ye+qe+De,rn=$e-kt;if(kt<=Qe){const Kt=L===Ee[Ee.length-1].ref.current;s.style.bottom="0px";const bt=v.clientHeight-z.offsetTop-z.offsetHeight,Dt=Math.max(Ge,He+(Kt?Xt:0)+bt+ft),_e=kt+Dt;s.style.height=_e+"px"}else{const Kt=L===Ee[0].ref.current;s.style.top="0px";const Dt=Math.max(Qe,Ye+z.offsetTop+(Kt?Gt:0)+He)+rn;s.style.height=Dt+"px",z.scrollTop=kt-Qe+z.offsetTop}s.style.margin=`${Pp}px 0`,s.style.minHeight=ut+"px",s.style.maxHeight=We+"px",i==null||i(),requestAnimationFrame(()=>F.current=!0)}},[M,o.trigger,o.valueNode,s,v,z,L,P,o.dir,i]);ec(()=>j(),[j]);const[q,le]=Q.useState();ec(()=>{v&&le(window.getComputedStyle(v).zIndex)},[v]);const ce=Q.useCallback(ae=>{ae&&N.current===!0&&(j(),H==null||H(),N.current=!1)},[j,H]);return re.jsx(bCe,{scope:n,contentWrapper:s,shouldExpandOnScrollRef:F,onScrollButtonChange:ce,children:re.jsx("div",{ref:f,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:q},children:re.jsx(Vs.div,{...r,ref:C,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});QZ.displayName=CCe;var SCe="SelectPopperPosition",VL=Q.forwardRef((t,e)=>{const{__scopeSelect:n,align:i="start",collisionPadding:r=Pp,...o}=t,c=GA(n);return re.jsx(uCe,{...c,...o,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});VL.displayName=SCe;var[bCe,dB]=Aw(b_,{}),GL="SelectViewport",eX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,nonce:i,...r}=t,o=Sv(GL,n),c=dB(GL,n),s=Ko(e,o.onViewportChange),f=Q.useRef(0);return re.jsxs(re.Fragment,{children:[re.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),re.jsx(UA.Slot,{scope:n,children:re.jsx(Vs.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:s,style:{position:"relative",flex:1,overflow:"auto",...r.style},onScroll:co(r.onScroll,v=>{const w=v.currentTarget,{contentWrapper:C,shouldExpandOnScrollRef:M}=c;if(M!=null&&M.current&&C){const F=Math.abs(f.current-w.scrollTop);if(F>0){const N=window.innerHeight-Pp*2,z=parseFloat(C.style.minHeight),L=parseFloat(C.style.height),P=Math.max(z,L);if(P<N){const H=P+F,j=Math.min(N,H),q=H-j;C.style.height=j+"px",C.style.bottom==="0px"&&(w.scrollTop=q>0?q:0,C.style.justifyContent="flex-end")}}}f.current=w.scrollTop})})})]})});eX.displayName=GL;var tX="SelectGroup",[ECe,MCe]=Aw(tX),RCe=Q.forwardRef((t,e)=>{const{__scopeSelect:n,...i}=t,r=Px();return re.jsx(ECe,{scope:n,id:r,children:re.jsx(Vs.div,{role:"group","aria-labelledby":r,...i,ref:e})})});RCe.displayName=tX;var nX="SelectLabel",iX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,...i}=t,r=MCe(nX,n);return re.jsx(Vs.div,{id:r.id,...i,ref:e})});iX.displayName=nX;var mT="SelectItem",[TCe,rX]=Aw(mT),sX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,value:i,disabled:r=!1,textValue:o,...c}=t,s=Cv(mT,n),f=Sv(mT,n),v=s.value===i,[w,C]=Q.useState(o??""),[M,F]=Q.useState(!1),N=Ko(e,P=>{var H;return(H=f.itemRefCallback)==null?void 0:H.call(f,P,i,r)}),z=Px(),L=()=>{r||(s.onValueChange(i),s.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return re.jsx(TCe,{scope:n,value:i,disabled:r,textId:z,isSelected:v,onItemTextChange:Q.useCallback(P=>{C(H=>H||((P==null?void 0:P.textContent)??"").trim())},[]),children:re.jsx(UA.ItemSlot,{scope:n,value:i,disabled:r,textValue:w,children:re.jsx(Vs.div,{role:"option","aria-labelledby":z,"data-highlighted":M?"":void 0,"aria-selected":v&&M,"data-state":v?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...c,ref:N,onFocus:co(c.onFocus,()=>F(!0)),onBlur:co(c.onBlur,()=>F(!1)),onPointerUp:co(c.onPointerUp,L),onPointerMove:co(c.onPointerMove,P=>{var H;r?(H=f.onItemLeave)==null||H.call(f):P.currentTarget.focus({preventScroll:!0})}),onPointerLeave:co(c.onPointerLeave,P=>{var H;P.currentTarget===document.activeElement&&((H=f.onItemLeave)==null||H.call(f))}),onKeyDown:co(c.onKeyDown,P=>{var j;((j=f.searchRef)==null?void 0:j.current)!==""&&P.key===" "||(pCe.includes(P.key)&&L(),P.key===" "&&P.preventDefault())})})})})});sX.displayName=mT;var a1="SelectItemText",oX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,className:i,style:r,...o}=t,c=Cv(a1,n),s=Sv(a1,n),f=rX(a1,n),v=yCe(a1,n),[w,C]=Q.useState(null),M=Ko(e,P=>C(P),f.onItemTextChange,P=>{var H;return(H=s.itemTextRefCallback)==null?void 0:H.call(s,P,f.value,f.disabled)}),F=w==null?void 0:w.textContent,N=Q.useMemo(()=>re.jsx("option",{value:f.value,disabled:f.disabled,children:F},f.value),[f.disabled,f.value,F]),{onNativeOptionAdd:z,onNativeOptionRemove:L}=v;return ec(()=>(z(N),()=>L(N)),[z,L,N]),re.jsxs(re.Fragment,{children:[re.jsx(Vs.span,{id:f.textId,...o,ref:M}),f.isSelected&&c.valueNode&&!c.valueNodeHasChildren?rh.createPortal(o.children,c.valueNode):null]})});oX.displayName=a1;var aX="SelectItemIndicator",lX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,...i}=t;return rX(aX,n).isSelected?re.jsx(Vs.span,{"aria-hidden":!0,...i,ref:e}):null});lX.displayName=aX;var HL="SelectScrollUpButton",cX=Q.forwardRef((t,e)=>{const n=Sv(HL,t.__scopeSelect),i=dB(HL,t.__scopeSelect),[r,o]=Q.useState(!1),c=Ko(e,i.onScrollButtonChange);return ec(()=>{if(n.viewport&&n.isPositioned){let s=function(){const v=f.scrollTop>0;o(v)};const f=n.viewport;return s(),f.addEventListener("scroll",s),()=>f.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),r?re.jsx(hX,{...t,ref:c,onAutoScroll:()=>{const{viewport:s,selectedItem:f}=n;s&&f&&(s.scrollTop=s.scrollTop-f.offsetHeight)}}):null});cX.displayName=HL;var WL="SelectScrollDownButton",uX=Q.forwardRef((t,e)=>{const n=Sv(WL,t.__scopeSelect),i=dB(WL,t.__scopeSelect),[r,o]=Q.useState(!1),c=Ko(e,i.onScrollButtonChange);return ec(()=>{if(n.viewport&&n.isPositioned){let s=function(){const v=f.scrollHeight-f.clientHeight,w=Math.ceil(f.scrollTop)<v;o(w)};const f=n.viewport;return s(),f.addEventListener("scroll",s),()=>f.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),r?re.jsx(hX,{...t,ref:c,onAutoScroll:()=>{const{viewport:s,selectedItem:f}=n;s&&f&&(s.scrollTop=s.scrollTop+f.offsetHeight)}}):null});uX.displayName=WL;var hX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,onAutoScroll:i,...r}=t,o=Sv("SelectScrollButton",n),c=Q.useRef(null),s=VA(n),f=Q.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return Q.useEffect(()=>()=>f(),[f]),ec(()=>{var w;const v=s().find(C=>C.ref.current===document.activeElement);(w=v==null?void 0:v.ref.current)==null||w.scrollIntoView({block:"nearest"})},[s]),re.jsx(Vs.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:co(r.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(i,50))}),onPointerMove:co(r.onPointerMove,()=>{var v;(v=o.onItemLeave)==null||v.call(o),c.current===null&&(c.current=window.setInterval(i,50))}),onPointerLeave:co(r.onPointerLeave,()=>{f()})})}),ACe="SelectSeparator",dX=Q.forwardRef((t,e)=>{const{__scopeSelect:n,...i}=t;return re.jsx(Vs.div,{"aria-hidden":!0,...i,ref:e})});dX.displayName=ACe;var jL="SelectArrow",PCe=Q.forwardRef((t,e)=>{const{__scopeSelect:n,...i}=t,r=GA(n),o=Cv(jL,n),c=Sv(jL,n);return o.open&&c.position==="popper"?re.jsx(hCe,{...r,...i,ref:e}):null});PCe.displayName=jL;function fX(t){return t===""||t===void 0}var pX=Q.forwardRef((t,e)=>{const{value:n,...i}=t,r=Q.useRef(null),o=Ko(e,r),c=VZ(n);return Q.useEffect(()=>{const s=r.current,f=window.HTMLSelectElement.prototype,w=Object.getOwnPropertyDescriptor(f,"value").set;if(c!==n&&w){const C=new Event("change",{bubbles:!0});w.call(s,n),s.dispatchEvent(C)}},[c,n]),re.jsx(GZ,{asChild:!0,children:re.jsx("select",{...i,ref:o,defaultValue:n})})});pX.displayName="BubbleSelect";function mX(t){const e=em(t),n=Q.useRef(""),i=Q.useRef(0),r=Q.useCallback(c=>{const s=n.current+c;e(s),function f(v){n.current=v,window.clearTimeout(i.current),v!==""&&(i.current=window.setTimeout(()=>f(""),1e3))}(s)},[e]),o=Q.useCallback(()=>{n.current="",window.clearTimeout(i.current)},[]);return Q.useEffect(()=>()=>window.clearTimeout(i.current),[]),[n,r,o]}function gX(t,e,n){const r=e.length>1&&Array.from(e).every(v=>v===e[0])?e[0]:e,o=n?t.indexOf(n):-1;let c=ICe(t,Math.max(o,0));r.length===1&&(c=c.filter(v=>v!==n));const f=c.find(v=>v.textValue.toLowerCase().startsWith(r.toLowerCase()));return f!==n?f:void 0}function ICe(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var DCe=HZ,vX=jZ,FCe=qZ,LCe=ZZ,OCe=XZ,yX=KZ,kCe=eX,_X=iX,xX=sX,NCe=oX,BCe=lX,wX=cX,CX=uX,SX=dX;const Qg=DCe,ev=FCe,Gp=Q.forwardRef(({className:t,children:e,...n},i)=>re.jsxs(vX,{ref:i,className:Ar("flex h-10 w-full items-center justify-between rounded-md border border-stone-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-stone-500 focus:outline-none focus:ring-2 focus:ring-stone-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-stone-800 dark:bg-stone-950 dark:ring-offset-stone-950 dark:placeholder:text-stone-400 dark:focus:ring-stone-300",t),...n,children:[e,re.jsx(LCe,{asChild:!0,children:re.jsx(t$,{className:"h-4 w-4 opacity-50"})})]}));Gp.displayName=vX.displayName;const bX=Q.forwardRef(({className:t,...e},n)=>re.jsx(wX,{ref:n,className:Ar("flex cursor-default items-center justify-center py-1",t),...e,children:re.jsx(yoe,{className:"h-4 w-4"})}));bX.displayName=wX.displayName;const EX=Q.forwardRef(({className:t,...e},n)=>re.jsx(CX,{ref:n,className:Ar("flex cursor-default items-center justify-center py-1",t),...e,children:re.jsx(t$,{className:"h-4 w-4"})}));EX.displayName=CX.displayName;const Hp=Q.forwardRef(({className:t,children:e,position:n="popper",...i},r)=>re.jsx(OCe,{children:re.jsxs(yX,{ref:r,className:Ar("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-stone-200 bg-white text-stone-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-stone-800 dark:bg-stone-950 dark:text-stone-50",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[re.jsx(bX,{}),re.jsx(kCe,{className:Ar("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),re.jsx(EX,{})]})}));Hp.displayName=yX.displayName;const zCe=Q.forwardRef(({className:t,...e},n)=>re.jsx(_X,{ref:n,className:Ar("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));zCe.displayName=_X.displayName;const qs=Q.forwardRef(({className:t,children:e,...n},i)=>re.jsxs(xX,{ref:i,className:Ar("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-stone-100 focus:text-stone-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-stone-800 dark:focus:text-stone-50",t),...n,children:[re.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:re.jsx(BCe,{children:re.jsx(e$,{className:"h-4 w-4"})})}),re.jsx(NCe,{children:e})]}));qs.displayName=xX.displayName;const UCe=Q.forwardRef(({className:t,...e},n)=>re.jsx(SX,{ref:n,className:Ar("-mx-1 my-1 h-px bg-stone-100 dark:bg-stone-800",t),...e}));UCe.displayName=SX.displayName;function MX(t){return pd({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"},child:[]}]})(t)}const ZS="https://mywayrtkapi.cyrusbowman.com";async function VCe(){return console.log("fetchSubscriptions"),Wr.get(ZS+"/subscriptions",{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(t){return t.data})}async function RX(t){return console.log("fetchSubscription",t),Wr.get(ZS+"/subscriptions/"+t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}async function GCe(t){return console.log("genCredentials",t),Wr.get(ZS+"/subscriptions/credentials",{params:t,headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}async function HCe(t){return console.log("createSubscription",t),Wr.post(ZS+"/subscriptions",t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}async function WCe(t,e){return console.log("editSubscription",t,e),Wr.patch(`${ZS}/subscriptions/${t}`,e,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(n){return n.data})}const TX=Pa(!1),jCe=["Starfire 7500","Starfire 7000","Starfire 6000","Starfire 3000","Topcon AGI-4","NovAtel SMART6","NovAtel SMART7","Trimble AgGPS 252","Trimble AgGPS 262","Trimble AG-372","Trimble NAV-900","Case IH AFS 262","Case IH AFS 372","Case IH AFS 392","Case IH Vector Pro","New Holland 262","New Holland 372","New Holland PLM CYGNUS-A","Ag Leader GPS 6500","Ag Leader GPS 7500","Ag Leader GeoSteer","Ag Leader ParaDyme","Raven 700S"];function $Ce({onSave:t}){var Mt,Gt,Xt,Qe;const[e,n]=Ha(TX),{id:i}=F_(),r=O_(),o=Yp({mutationFn:Ge=>HCe({...Ge,customerId:i}),onSuccess:()=>{n(!1),r.invalidateQueries({queryKey:["customers"]}),r.invalidateQueries({queryKey:["subscriptions",{customerId:i}]})},onError:Ge=>{var He,De,kt,rn;((De=(He=Ge==null?void 0:Ge.response)==null?void 0:He.data)==null?void 0:De.error)=="Not authorized to add subscription to this customer."||((rn=(kt=Ge==null?void 0:Ge.response)==null?void 0:kt.data)==null?void 0:rn.error)=="Login is not unique"&&r.invalidateQueries({queryKey:["generateLogin",i,pe]})}}),[c,s]=Q.useState(!1),[f,v]=Q.useState(),[w,C]=Q.useState(new Date().toISOString().split("T")[0]),[M,F]=Q.useState(""),[N,z]=Q.useState(),[L,P]=Q.useState(""),[H,j]=Q.useState("AUTO"),[q,le]=Q.useState(!1),[ce,ae]=Q.useState(null),[pe,fe]=Q.useState(f),[ue,Ee]=Q.useState(!1),We=Ge=>{if(Ge||le(!1),z(Ge),Ge)if(w&&M||w){const He=new Date(w);He.setUTCMonth(He.getUTCMonth()+Ge),F(He.toISOString().split("T")[0])}else{const He=new Date(M);He.setUTCMonth(He.getUTCMonth()-Ge),C(He.toISOString().split("T")[0])}},rt=Ge=>{const He=Ge.target.value;if(C(He),N){const De=new Date(He);De.setUTCMonth(De.getUTCMonth()+N),F(De.toISOString().split("T")[0])}else M<He&&F("")},tt=Ge=>{const He=Ge.target.value;if(He||le(!1),F(He),N){const De=new Date(He);De.setUTCMonth(De.getUTCMonth()-N),C(De.toISOString().split("T")[0])}else He<w&&C("")};Q.useEffect(()=>{Ee(!0);const Ge=setTimeout(()=>{fe(f),Ee(!1)},1e3);return()=>{clearTimeout(Ge),r.cancelQueries({queryKey:["generateLogin",i,pe],exact:!0})}},[f]);const Ye=c?{login:pe,customerId:i}:{customerId:i},{data:qe,error:ft,isLoading:Me}=bf({queryKey:["generateLogin",i,Ye],queryFn:()=>GCe(Ye),enabled:!!pe&&pe.length>2&&pe.length<13||!c,retry:(Ge,He)=>He.status===400?!1:Ge<3});let $e=null;((Gt=(Mt=ft==null?void 0:ft.response)==null?void 0:Mt.data)==null?void 0:Gt.error)=="Login is not unique"?$e="Login is already taken.":((Qe=(Xt=ft==null?void 0:ft.response)==null?void 0:Xt.data)==null?void 0:Qe.error)=="Login does not match required parameters."?$e="Login must be between 3 and 12 characters and contain only letters and numbers.":pe&&pe.length<3&&($e="Login must be 3 characters or longer.");const ut=c?f||"":(qe==null?void 0:qe.login)||"";return re.jsxs(sh,{className:"sm:max-w-xl",children:[re.jsxs(oh,{children:[re.jsx(lh,{children:"Add Subscription"}),re.jsx(ch,{children:"Create a new subscription."})]}),re.jsxs("div",{className:"grid grid-cols-2 gap-2 gap-x-6",children:[re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"login",readOnly:Me&&!c,className:"text-slate-700",children:"Login"}),re.jsxs("div",{className:"relative flex items-center mt-1",children:[re.jsx(qr,{className:$e||(f==null?void 0:f.length)<3?"border-red-500":"",type:"text",id:"login",maxLength:"12",minLength:"3",pattern:"[a-z0-9]*",value:ut,onChange:Ge=>{s(!0);const He=Ge.target.value.replace(/[^A-Za-z0-9]/g,"").toLowerCase();v(He)}}),(Me||ue)&&re.jsx(ov,{className:"absolute right-3 h-4 w-4 animate-spin"})]}),$e&&re.jsx("div",{className:"text-red-500 text-xs mt-1 p-1",children:$e})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"password",className:"text-slate-700",children:"Password"}),re.jsxs("div",{className:"relative flex items-center",children:[re.jsx(qr,{disabled:!0,readOnly:!0,type:"text",id:"password",className:"mt-1",value:(qe==null?void 0:qe.password)||""}),(Me||ue)&&re.jsx(ov,{className:"absolute right-3 h-4 w-4 animate-spin"})]})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"start-date",className:"text-slate-700",children:"Start Date"}),re.jsx(qr,{type:"date",id:"start-date",className:"mt-1",value:w,onChange:rt})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"term",className:"text-slate-700",children:"Term"}),re.jsxs(Qg,{value:N,onValueChange:We,children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:12,children:"1 year"}),re.jsx(qs,{value:6,children:"6 months"}),re.jsx(qs,{value:3,children:"3 months"}),re.jsx(qs,{value:null,children:"---"})]})]})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"end-date",className:"text-slate-700",children:"End Date"}),re.jsx(qr,{type:"date",id:"end-date",className:"mt-1",value:M,onChange:tt})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"auto-renew",className:"text-slate-700",children:"Auto Renew"}),re.jsx("div",{className:"flex",children:re.jsx(qr,{type:"checkbox",id:"auto-renew",className:"mt-3 size-5",checked:q,disabled:!N||!M,onChange:()=>le(!q)})})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"equipmentName",className:"text-slate-700",children:"Equipment Name"}),re.jsx(qr,{type:"text",id:"equipmentName",className:"mt-1",value:L,onChange:Ge=>P(Ge.target.value)})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"rtkSource",className:"text-slate-700",children:"Recommended RTK Source"}),re.jsxs(Qg,{value:H,onValueChange:j,children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:"AUTO",children:"Auto-Select"}),re.jsx(qs,{value:"MSM5",children:"Closest MSM5 Base"}),re.jsx(qs,{value:"RTCM",children:"Closest RTCM 3.0 Base"}),re.jsx(qs,{value:"CMR",children:"Closest CMR Base"}),re.jsx(qs,{value:"JD",children:"Closest NCT Base"})]})]})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"gnssReceiver",className:"text-slate-700",children:"GNSS Receiver"}),re.jsxs(Qg,{value:ce,onValueChange:ae,children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:null,children:"Auto-Detect"}),jCe.map(Ge=>re.jsx(qs,{value:Ge,children:Ge},Ge))]})]})]})]}),re.jsxs(ah,{className:"sm:justify-end *:w-32",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",children:"Close"})}),re.jsx(No,{type:"button",onClick:()=>o.mutate({customerId:i,login:ut,password:qe==null?void 0:qe.password,term:N,startDate:w,endDate:M,equipmentName:L,rtkSource:H,autoRenew:q}),children:"Save"})]})]})}function qCe(){const[t,e]=Ha(TX);return re.jsxs(vd,{open:t,onOpenChange:e,children:[re.jsx(hm,{asChild:!0,children:re.jsxs("div",{className:"flex items-center cursor-pointer hover:text-stone-600",children:[re.jsx(MX,{}),re.jsx("span",{className:"ml-2 text-sm",children:"add subscription"})]})}),t&&re.jsx($Ce,{})]})}const ZCe=[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}],fB=kn.forwardRef(({className:t,...e},n)=>re.jsxs(Qg,{className:t,...e,ref:n,children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsx(Hp,{children:ZCe.map(i=>re.jsx(qs,{value:i.value,children:i.label},i.value))})]}));fB.displayName="SelectState";const AX=Pa(!1);function XCe({onSave:t}){const e=xv(AX),{id:n}=F_(),i=O_(),{data:r,error:o,isLoading:c}=bf({queryKey:["customers",n],queryFn:()=>d3(n)}),s=Yp({mutationFn:C=>rce({...C}),onSuccess:()=>{e(!1),i.invalidateQueries({queryKey:["customers",n],exact:!0},{throwOnError:!0})}}),[f,v]=Q.useState(r),w=C=>{const{name:M,id:F,value:N}=C.target,z=M||F;v(L=>({...L,[z]:N}))};return re.jsxs(sh,{className:"sm:max-w-xl",children:[re.jsxs(oh,{children:[re.jsx(lh,{children:"Edit Customer"}),re.jsx(ch,{children:"Update customer details and save your changes."})]}),re.jsxs("div",{className:"grid grid-cols-2 gap-2 gap-x-6",children:[re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"name",className:"text-slate-700",children:"Company Name"}),re.jsx(qr,{className:"mt-1",type:"text",id:"name",value:f.name,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"firstName",className:"text-slate-700",children:"First Name"}),re.jsx(qr,{type:"text",id:"firstName",className:"mt-1",value:f.firstName,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"lastName",className:"text-slate-700",children:"Last Name"}),re.jsx(qr,{type:"text",id:"lastName",className:"mt-1",value:f.lastName,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"workPhone",className:"text-slate-700",children:"Work Phone"}),re.jsx(qr,{type:"text",id:"workPhone",className:"mt-1",value:f.workPhone,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"mobilePhone",className:"text-slate-700",children:"Mobile Phone"}),re.jsx(qr,{type:"text",id:"mobilePhone",className:"mt-1",value:f.mobilePhone,onChange:w})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"address",className:"text-slate-700",children:"Address"}),re.jsx(qr,{type:"text",id:"address",className:"mt-1",value:f.address,onChange:w}),re.jsx(qr,{type:"text",id:"address2",className:"mt-1",value:f.address2,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"city",className:"text-slate-700",children:"City"}),re.jsx(qr,{type:"text",id:"city",className:"mt-1",value:f.city,onChange:w})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"state",className:"text-slate-700",children:"State"}),re.jsx(fB,{title:"Select a state...",id:"state",className:"mt-1",value:f.state,onValueChange:C=>w({target:{id:"state",value:C}})})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"zip",className:"text-slate-700",children:"Zip Code"}),re.jsx(qr,{type:"text",id:"zip",className:"mt-1",value:f.zip,onChange:w})]})]}),re.jsxs(ah,{className:"sm:justify-end *:w-32",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",children:"Close"})}),re.jsx(No,{type:"button",disabled:s.isPending,onClick:()=>s.mutate(f),children:s.isPending?re.jsx(ov,{className:"animate-spin mr-2"}):"Save"})]})]})}function KCe({children:t}){const[e,n]=Ha(AX);return re.jsxs(vd,{open:e,onOpenChange:n,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),e&&re.jsx(XCe,{})]})}function YCe(){const{id:t}=F_(),{data:e,error:n,isLoading:i,isPending:r}=bf({queryKey:["customers",t],queryFn:()=>d3(t)}),o=lm();return i?re.jsx("div",{className:"w-screen h-screen bg-stone-100 p-4",children:"Loading..."}):re.jsxs("div",{className:"w-screen h-screen bg-stone-100 p-4 overflow-y-auto",children:[re.jsx(QN,{className:"mb-4",children:re.jsxs(e3,{children:[re.jsx(Rx,{children:re.jsx(jR,{className:"cursor-pointer",onClick:()=>o("/customers"),children:"Customers"})}),re.jsx($R,{}),re.jsx(Rx,{children:re.jsxs(t3,{children:[e.firstName," ",e.lastName]})})]})}),re.jsxs(g_,{className:"max-w-md",children:[re.jsx(v_,{children:re.jsx(y_,{children:"Customer Information"})}),re.jsxs(vw,{className:"pb-4",children:[e.name&&re.jsx(Io,{title:"Company",children:e.name}),re.jsxs(Io,{title:"Name",children:[e.firstName," ",e.lastName]}),e.email&&re.jsx(Io,{title:"Email",children:e.email}),e.workPhone&&e.mobilePhone?re.jsxs(re.Fragment,{children:[re.jsx(Io,{title:"Work Phone",children:e.workPhone}),re.jsx(Io,{title:"Mobile Phone",children:e.mobilePhone})]}):re.jsx(Io,{title:"Phone",children:e.mobilePhone||e.workPhone}),re.jsxs(Io,{title:"Address",children:[re.jsx("div",{className:"text-right",children:e.address}),e.address2&&re.jsx("div",{className:"text-right",children:e.address2}),(e.city||e.state||e.zip)&&re.jsx("div",{className:"text-right",children:`${e.city||""}, ${e.state} ${e.zip}`})]}),re.jsx("div",{className:"flex justify-end mt-4 text-blue-500 cursor-pointer hover:text-blue-800",children:re.jsx(KCe,{children:"Edit"})})]})]}),re.jsxs(g_,{className:"max-w-full h-72 mt-4",children:[re.jsx(v_,{children:re.jsxs("div",{className:"flex items-middle justify-between",children:[re.jsx(y_,{children:"Subscriptions"}),re.jsx(qCe,{})]})}),re.jsx(D0e,{data:e})]})]})}const PX=Pa(!1);function JCe({onSave:t}){const e=xv(PX),{id:n}=F_(),i=O_(),{data:r,error:o,isLoading:c}=bf({queryKey:["subscriptions",n],queryFn:()=>RX(n)}),s=Yp({mutationFn:N=>WCe(n,{...N}),onSuccess:()=>{e(!1),i.invalidateQueries({queryKey:["subscriptions",n],exact:!0},{throwOnError:!0})}}),[f,v]=Q.useState(r),[w,C]=Q.useState(r);console.log("formData",f),console.log("originalData",w),Q.useEffect(()=>{v(r),C(r)},[r]);const M=N=>{const{name:z,id:L,value:P,type:H,checked:j}=N.target,q=z||L;v(le=>({...le,[q]:H==="checkbox"?j:P}))},F=()=>{const N=Object.keys(f).reduce((z,L)=>(f[L]!==w[L]&&(z[L]=f[L]),z),{});Object.keys(N).length>0?(console.log("Changes",N),s.mutate(N)):(console.log("No changes made"),e(!1))};return re.jsxs(sh,{className:"sm:max-w-xl",children:[re.jsxs(oh,{children:[re.jsx(lh,{children:"Edit Subscription"}),re.jsx(ch,{children:"Update subscription details and save your changes.."})]}),re.jsxs("div",{className:"grid grid-cols-2 gap-2 gap-x-6",children:[re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"login",className:"text-slate-700",children:"Login"}),re.jsx("div",{className:"relative flex items-center mt-1",children:re.jsx(qr,{type:"text",id:"login",readOnly:!0,disabled:!0,value:f.login})})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"password",className:"text-slate-700",children:"Password"}),re.jsx("div",{className:"relative flex items-center",children:re.jsx(qr,{disabled:!0,readOnly:!0,type:"text",id:"password",className:"mt-1",value:f.password})})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"startDate",className:"text-slate-700",children:"Start Date"}),re.jsx(qr,{type:"date",id:"startDate",className:"mt-1",value:f.startDate||"",onChange:M})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"endDate",className:"text-slate-700",children:"End Date"}),re.jsx(qr,{type:"date",id:"endDate",className:"mt-1",value:f.endDate||"",onChange:M})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"term",className:"text-slate-700",children:"Term"}),re.jsxs(Qg,{value:f.term,onValueChange:N=>M({target:{id:"term",value:N}}),children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:12,children:"1 year"}),re.jsx(qs,{value:6,children:"6 months"}),re.jsx(qs,{value:3,children:"3 months"})]})]})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"autoRenew",className:"text-slate-700",children:"Auto Renew"}),re.jsx("div",{className:"flex",children:re.jsx(qr,{type:"checkbox",id:"autoRenew",className:"mt-3 size-5",checked:f.autoRenew,onChange:M})})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"equipmentName",className:"text-slate-700",children:"Equipment Name"}),re.jsx(qr,{type:"text",id:"equipmentName",className:"mt-1",value:f.equipmentName,onChange:M})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"rtkSource",className:"text-slate-700",children:"Recommended RTK Source"}),re.jsxs(Qg,{value:f.rtkSource,onValueChange:N=>M({target:{id:"rtkSource",value:N}}),children:[re.jsx(Gp,{className:"mt-1",children:f.rtkSource&&["AUTO","MSM5","RTCM","CMR","JD"].includes(f.rtkSource)?re.jsx(ev,{}):f.rtkSource}),re.jsxs(Hp,{children:[re.jsx(qs,{value:"AUTO",children:"Auto-Select"}),re.jsx(qs,{value:"MSM5",children:"Closest MSM5 Base"}),re.jsx(qs,{value:"RTCM",children:"Closest RTCM 3.0 Base"}),re.jsx(qs,{value:"CMR",children:"Closest CMR Base"}),re.jsx(qs,{value:"JD",children:"Closest NCT Base"})]})]})]})]}),re.jsxs(ah,{className:"sm:justify-end *:w-32",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",children:"Close"})}),re.jsx(No,{type:"button",onClick:F,children:"Save"})]})]})}function QCe({children:t}){const[e,n]=Ha(PX);return re.jsxs(vd,{open:e,onOpenChange:n,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),e&&re.jsx(JCe,{})]})}const e1e="https://mywayrtkapi.cyrusbowman.com";async function t1e(t){return console.log("activateModem",t),Wr.post(`${e1e}/modems/activate`,t,{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(e){return e.data})}const IX=Pa(!1);function n1e({onSave:t}){const e=xv(IX),{id:n}=F_(),i=O_(),r=Yp({mutationFn:v=>t1e({...v,subId:n}),onSuccess:()=>{e(!1)},onMutate:async v=>{await i.cancelQueries(["subscriptions",n]);const w=i.getQueryData(["subscriptions",n]);return i.setQueryData(["subscriptions",n],C=>({...C,modemSIM:"Updating..."})),{previousData:w}},onError:(v,w,C)=>{i.setQueryData(["subscriptions",n],C.previousData)},onSettled:()=>{i.invalidateQueries(["subscriptions",n])}}),[o,c]=Q.useState({}),s=v=>{const{name:w,id:C,value:M,type:F,checked:N}=v.target,z=w||C;c(L=>({...L,[z]:F==="checkbox"?N:M}))},f=()=>{r.mutate(o)};return re.jsxs(sh,{className:"sm:max-w-xl",children:[re.jsxs(oh,{children:[re.jsx(lh,{children:"Activate Modem"}),re.jsxs(ch,{children:["Request a cell activation from MyWayRTK, this can take up to 24 hrs to complete.",re.jsx("br",{}),"If you need to purchase a modem, you can ",re.jsx("a",{href:"https://www.isssupport.com/mywayrtk-shop",target:"_blank",className:"underline",children:"click here"})," to access the store."]})]}),re.jsxs("div",{className:"grid grid-cols-2 gap-2 gap-x-6",children:[re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"dataPlan",className:"text-slate-700",children:"Data Plan"}),re.jsxs(Qg,{value:o.dataPlan,onValueChange:v=>s({target:{id:"dataPlan",value:v}}),children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:"RTK 9",children:"RTK 9"}),re.jsx(qs,{value:"RTK 12",children:"RTK 12"}),re.jsx(qs,{value:"RTK DATA 9",children:"RTK DATA 9"}),re.jsx(qs,{value:"RTK DATA 12",children:"RTK DATA 12"})]})]})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"carrier",className:"text-slate-700",children:"Carrier"}),re.jsxs(Qg,{value:o.carrier,onValueChange:v=>s({target:{id:"carrier",value:v}}),children:[re.jsx(Gp,{className:"mt-1",children:re.jsx(ev,{})}),re.jsxs(Hp,{children:[re.jsx(qs,{value:"verizon",children:"Verizon"}),re.jsx(qs,{value:"att",children:"AT&T"})]})]})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"IMEI",className:"text-slate-700",children:"IMEI"}),re.jsx(qr,{type:"text",id:"IMEI",className:"mt-1",value:o.imei,onChange:s})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"SIM",className:"text-slate-700",children:"SIM"}),re.jsx(qr,{type:"text",id:"SIM",className:"mt-1",value:o.sim,onChange:s})]})]}),re.jsxs(ah,{className:"sm:justify-end *:w-32",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",children:"Cancel"})}),re.jsx(No,{type:"button",onClick:f,disabled:r.isPending,children:r.isPending?re.jsx(ov,{className:"animate-spin"}):"Request"})]})]})}function i1e({children:t}){const[e,n]=Ha(IX);return re.jsxs(vd,{open:e,onOpenChange:n,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),e&&re.jsx(n1e,{})]})}var DX={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(nN,function(){var n=1e3,i=6e4,r=36e5,o="millisecond",c="second",s="minute",f="hour",v="day",w="week",C="month",M="quarter",F="year",N="date",z="Invalid Date",L=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,P=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,H={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(tt){var Ye=["th","st","nd","rd"],qe=tt%100;return"["+tt+(Ye[(qe-20)%10]||Ye[qe]||Ye[0])+"]"}},j=function(tt,Ye,qe){var ft=String(tt);return!ft||ft.length>=Ye?tt:""+Array(Ye+1-ft.length).join(qe)+tt},q={s:j,z:function(tt){var Ye=-tt.utcOffset(),qe=Math.abs(Ye),ft=Math.floor(qe/60),Me=qe%60;return(Ye<=0?"+":"-")+j(ft,2,"0")+":"+j(Me,2,"0")},m:function tt(Ye,qe){if(Ye.date()<qe.date())return-tt(qe,Ye);var ft=12*(qe.year()-Ye.year())+(qe.month()-Ye.month()),Me=Ye.clone().add(ft,C),$e=qe-Me<0,ut=Ye.clone().add(ft+($e?-1:1),C);return+(-(ft+(qe-Me)/($e?Me-ut:ut-Me))||0)},a:function(tt){return tt<0?Math.ceil(tt)||0:Math.floor(tt)},p:function(tt){return{M:C,y:F,w,d:v,D:N,h:f,m:s,s:c,ms:o,Q:M}[tt]||String(tt||"").toLowerCase().replace(/s$/,"")},u:function(tt){return tt===void 0}},le="en",ce={};ce[le]=H;var ae="$isDayjsObject",pe=function(tt){return tt instanceof We||!(!tt||!tt[ae])},fe=function tt(Ye,qe,ft){var Me;if(!Ye)return le;if(typeof Ye=="string"){var $e=Ye.toLowerCase();ce[$e]&&(Me=$e),qe&&(ce[$e]=qe,Me=$e);var ut=Ye.split("-");if(!Me&&ut.length>1)return tt(ut[0])}else{var Mt=Ye.name;ce[Mt]=Ye,Me=Mt}return!ft&&Me&&(le=Me),Me||!ft&&le},ue=function(tt,Ye){if(pe(tt))return tt.clone();var qe=typeof Ye=="object"?Ye:{};return qe.date=tt,qe.args=arguments,new We(qe)},Ee=q;Ee.l=fe,Ee.i=pe,Ee.w=function(tt,Ye){return ue(tt,{locale:Ye.$L,utc:Ye.$u,x:Ye.$x,$offset:Ye.$offset})};var We=function(){function tt(qe){this.$L=fe(qe.locale,null,!0),this.parse(qe),this.$x=this.$x||qe.x||{},this[ae]=!0}var Ye=tt.prototype;return Ye.parse=function(qe){this.$d=function(ft){var Me=ft.date,$e=ft.utc;if(Me===null)return new Date(NaN);if(Ee.u(Me))return new Date;if(Me instanceof Date)return new Date(Me);if(typeof Me=="string"&&!/Z$/i.test(Me)){var ut=Me.match(L);if(ut){var Mt=ut[2]-1||0,Gt=(ut[7]||"0").substring(0,3);return $e?new Date(Date.UTC(ut[1],Mt,ut[3]||1,ut[4]||0,ut[5]||0,ut[6]||0,Gt)):new Date(ut[1],Mt,ut[3]||1,ut[4]||0,ut[5]||0,ut[6]||0,Gt)}}return new Date(Me)}(qe),this.init()},Ye.init=function(){var qe=this.$d;this.$y=qe.getFullYear(),this.$M=qe.getMonth(),this.$D=qe.getDate(),this.$W=qe.getDay(),this.$H=qe.getHours(),this.$m=qe.getMinutes(),this.$s=qe.getSeconds(),this.$ms=qe.getMilliseconds()},Ye.$utils=function(){return Ee},Ye.isValid=function(){return this.$d.toString()!==z},Ye.isSame=function(qe,ft){var Me=ue(qe);return this.startOf(ft)<=Me&&Me<=this.endOf(ft)},Ye.isAfter=function(qe,ft){return ue(qe)<this.startOf(ft)},Ye.isBefore=function(qe,ft){return this.endOf(ft)<ue(qe)},Ye.$g=function(qe,ft,Me){return Ee.u(qe)?this[ft]:this.set(Me,qe)},Ye.unix=function(){return Math.floor(this.valueOf()/1e3)},Ye.valueOf=function(){return this.$d.getTime()},Ye.startOf=function(qe,ft){var Me=this,$e=!!Ee.u(ft)||ft,ut=Ee.p(qe),Mt=function(rn,Re){var Kt=Ee.w(Me.$u?Date.UTC(Me.$y,Re,rn):new Date(Me.$y,Re,rn),Me);return $e?Kt:Kt.endOf(v)},Gt=function(rn,Re){return Ee.w(Me.toDate()[rn].apply(Me.toDate("s"),($e?[0,0,0,0]:[23,59,59,999]).slice(Re)),Me)},Xt=this.$W,Qe=this.$M,Ge=this.$D,He="set"+(this.$u?"UTC":"");switch(ut){case F:return $e?Mt(1,0):Mt(31,11);case C:return $e?Mt(1,Qe):Mt(0,Qe+1);case w:var De=this.$locale().weekStart||0,kt=(Xt<De?Xt+7:Xt)-De;return Mt($e?Ge-kt:Ge+(6-kt),Qe);case v:case N:return Gt(He+"Hours",0);case f:return Gt(He+"Minutes",1);case s:return Gt(He+"Seconds",2);case c:return Gt(He+"Milliseconds",3);default:return this.clone()}},Ye.endOf=function(qe){return this.startOf(qe,!1)},Ye.$set=function(qe,ft){var Me,$e=Ee.p(qe),ut="set"+(this.$u?"UTC":""),Mt=(Me={},Me[v]=ut+"Date",Me[N]=ut+"Date",Me[C]=ut+"Month",Me[F]=ut+"FullYear",Me[f]=ut+"Hours",Me[s]=ut+"Minutes",Me[c]=ut+"Seconds",Me[o]=ut+"Milliseconds",Me)[$e],Gt=$e===v?this.$D+(ft-this.$W):ft;if($e===C||$e===F){var Xt=this.clone().set(N,1);Xt.$d[Mt](Gt),Xt.init(),this.$d=Xt.set(N,Math.min(this.$D,Xt.daysInMonth())).$d}else Mt&&this.$d[Mt](Gt);return this.init(),this},Ye.set=function(qe,ft){return this.clone().$set(qe,ft)},Ye.get=function(qe){return this[Ee.p(qe)]()},Ye.add=function(qe,ft){var Me,$e=this;qe=Number(qe);var ut=Ee.p(ft),Mt=function(Qe){var Ge=ue($e);return Ee.w(Ge.date(Ge.date()+Math.round(Qe*qe)),$e)};if(ut===C)return this.set(C,this.$M+qe);if(ut===F)return this.set(F,this.$y+qe);if(ut===v)return Mt(1);if(ut===w)return Mt(7);var Gt=(Me={},Me[s]=i,Me[f]=r,Me[c]=n,Me)[ut]||1,Xt=this.$d.getTime()+qe*Gt;return Ee.w(Xt,this)},Ye.subtract=function(qe,ft){return this.add(-1*qe,ft)},Ye.format=function(qe){var ft=this,Me=this.$locale();if(!this.isValid())return Me.invalidDate||z;var $e=qe||"YYYY-MM-DDTHH:mm:ssZ",ut=Ee.z(this),Mt=this.$H,Gt=this.$m,Xt=this.$M,Qe=Me.weekdays,Ge=Me.months,He=Me.meridiem,De=function(Re,Kt,bt,Dt){return Re&&(Re[Kt]||Re(ft,$e))||bt[Kt].slice(0,Dt)},kt=function(Re){return Ee.s(Mt%12||12,Re,"0")},rn=He||function(Re,Kt,bt){var Dt=Re<12?"AM":"PM";return bt?Dt.toLowerCase():Dt};return $e.replace(P,function(Re,Kt){return Kt||function(bt){switch(bt){case"YY":return String(ft.$y).slice(-2);case"YYYY":return Ee.s(ft.$y,4,"0");case"M":return Xt+1;case"MM":return Ee.s(Xt+1,2,"0");case"MMM":return De(Me.monthsShort,Xt,Ge,3);case"MMMM":return De(Ge,Xt);case"D":return ft.$D;case"DD":return Ee.s(ft.$D,2,"0");case"d":return String(ft.$W);case"dd":return De(Me.weekdaysMin,ft.$W,Qe,2);case"ddd":return De(Me.weekdaysShort,ft.$W,Qe,3);case"dddd":return Qe[ft.$W];case"H":return String(Mt);case"HH":return Ee.s(Mt,2,"0");case"h":return kt(1);case"hh":return kt(2);case"a":return rn(Mt,Gt,!0);case"A":return rn(Mt,Gt,!1);case"m":return String(Gt);case"mm":return Ee.s(Gt,2,"0");case"s":return String(ft.$s);case"ss":return Ee.s(ft.$s,2,"0");case"SSS":return Ee.s(ft.$ms,3,"0");case"Z":return ut}return null}(Re)||ut.replace(":","")})},Ye.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Ye.diff=function(qe,ft,Me){var $e,ut=this,Mt=Ee.p(ft),Gt=ue(qe),Xt=(Gt.utcOffset()-this.utcOffset())*i,Qe=this-Gt,Ge=function(){return Ee.m(ut,Gt)};switch(Mt){case F:$e=Ge()/12;break;case C:$e=Ge();break;case M:$e=Ge()/3;break;case w:$e=(Qe-Xt)/6048e5;break;case v:$e=(Qe-Xt)/864e5;break;case f:$e=Qe/r;break;case s:$e=Qe/i;break;case c:$e=Qe/n;break;default:$e=Qe}return Me?$e:Ee.a($e)},Ye.daysInMonth=function(){return this.endOf(C).$D},Ye.$locale=function(){return ce[this.$L]},Ye.locale=function(qe,ft){if(!qe)return this.$L;var Me=this.clone(),$e=fe(qe,ft,!0);return $e&&(Me.$L=$e),Me},Ye.clone=function(){return Ee.w(this.$d,this)},Ye.toDate=function(){return new Date(this.valueOf())},Ye.toJSON=function(){return this.isValid()?this.toISOString():null},Ye.toISOString=function(){return this.$d.toISOString()},Ye.toString=function(){return this.$d.toUTCString()},tt}(),rt=We.prototype;return ue.prototype=rt,[["$ms",o],["$s",c],["$m",s],["$H",f],["$W",v],["$M",C],["$y",F],["$D",N]].forEach(function(tt){rt[tt[1]]=function(Ye){return this.$g(Ye,tt[0],tt[1])}}),ue.extend=function(tt,Ye){return tt.$i||(tt(Ye,We,ue),tt.$i=!0),ue},ue.locale=fe,ue.isDayjs=pe,ue.unix=function(tt){return ue(1e3*tt)},ue.en=ce[le],ue.Ls=ce,ue.p={},ue})})(DX);var r1e=DX.exports;const gT=pv(r1e),s1e="modulepreload",o1e=function(t){return"/"+t},OH={},vT=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.all(n.map(s=>{if(s=o1e(s),s in OH)return;OH[s]=!0;const f=s.endsWith(".css"),v=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${v}`))return;const w=document.createElement("link");if(w.rel=f?"stylesheet":s1e,f||(w.as="script",w.crossOrigin=""),w.href=s,c&&w.setAttribute("nonce",c),document.head.appendChild(w),f)return new Promise((C,M)=>{w.addEventListener("load",C),w.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${s}`)))})}))}return r.then(()=>e()).catch(o=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o})},a1e=Object.assign({"/src/assets/react.svg":()=>vT(()=>import("./react-ByBZldV5.js"),[]),"/src/assets/tractor.svg":()=>vT(()=>import("./tractor-CB1beALP.js"),[])}),l1e=({name:t,...e})=>{const n=kn.lazy(async()=>{const i=a1e[`/src/assets/${t}.svg`];if(!i)return new Promise(()=>{});const r=await i();return{default:o=>re.jsx("img",{src:r.default,alt:t,...o})}});return re.jsx(Q.Suspense,{fallback:re.jsx(ov,{className:"animate-spin"}),children:re.jsx(n,{...e})})};function c1e({data:t}){const{login:e,password:n,lastOnline:i,startDate:r,endDate:o,autoRenew:c,userAgent:s}=t;return re.jsxs(g_,{className:"max-w-md mb-6",children:[re.jsx(v_,{children:re.jsx(y_,{children:"Subscription Information"})}),re.jsxs(vw,{className:"pb-4",children:[re.jsx(Io,{title:"Login",children:e}),re.jsx(Io,{title:"Password",children:n}),r&&re.jsx(Io,{title:"Start Date",children:gT(r,"YYYY-MM-DD").format("M/D/YYYY")}),re.jsx(Io,{title:c?"Renewal Date":"Expiration Date",children:o?gT(o,"YYYY-MM-DD").format("M/D/YYYY"):"Never Expires"}),re.jsx(Io,{title:"Last Online",children:i}),s?re.jsx(Io,{title:"User-Agent",children:s}):null,re.jsx(Io,{title:"Recommended RTK Source",children:"Auto-Select"}),re.jsx("div",{className:"flex justify-end mt-4 text-blue-500 cursor-pointer hover:text-blue-800",children:re.jsx(QCe,{children:"Edit"})})]})]})}function u1e({data:t}){const{equipmentName:e,login:n}=t;return re.jsxs(g_,{className:"max-w-md mb-6 ",children:[re.jsx(v_,{children:re.jsx(y_,{children:"Equipment"})}),re.jsxs(vw,{className:"pb-4",children:[re.jsx(Io,{title:"Name",children:e||n}),re.jsx(Io,{title:"Map Icon",className:"items-center mt-4",children:re.jsx(l1e,{name:"tractor",className:"w-8 h-8"})})]})]})}function h1e({data:t}){const{userAgent:e,modemSIM:n=null,modemIMEI:i=null,modemCarrier:r=null,modemDataPlan:o=null,modemActivated:c=null}=t;return re.jsxs(g_,{className:"mb-6",children:[re.jsx(v_,{children:re.jsx(y_,{children:"Hardware"})}),re.jsxs(vw,{className:"pb-4",children:[re.jsx(Io,{title:"GNSS Receiver",children:"Auto-Detect"}),re.jsx(Io,{title:"Cellular Modem",className:"items-center mt-4",children:n?c?null:re.jsx("span",{children:"Activation Request Sent"}):re.jsx("div",{className:"cursor-pointer border-stone-300 bg-stone-50 border rounded-sm px-2 p py-0.5 text-xs hover:bg-stone-100",children:re.jsx(i1e,{children:"add / activate"})})}),n&&c?re.jsxs(re.Fragment,{children:[re.jsx(Io,{title:"Carrier",className:"items-center mt-4 pl-4 capitalize",children:r}),re.jsx(Io,{title:"IMEI",className:"items-center mt-4 pl-4",children:i}),re.jsx(Io,{title:"SIM",className:"items-center mt-4 pl-4",children:n}),re.jsx(Io,{title:"Data Plan",className:"items-center mt-4 pl-4",children:o})]}):null]})]})}function d1e({data:t}){return re.jsxs(g_,{className:"mb-6",children:[re.jsx(v_,{children:re.jsx(y_,{children:"Connection Status"})}),re.jsx(vw,{className:"pb-6",children:re.jsx("div",{className:"text-stone-500",children:"Never Connected"})})]})}function f1e(){const{id:t,customerId:e}=F_();console.log("customerId",e);const{data:n,isLoading:i}=bf({queryKey:["customers",e],queryFn:()=>d3(e)}),{data:r,isLoading:o}=bf({queryKey:["subscriptions",t],queryFn:()=>RX(t),refetchInterval:10*1e3}),c=lm();return o||i?re.jsx("div",{className:"w-screen h-screen bg-stone-100 p-4",children:"Loading..."}):re.jsxs("div",{className:"w-screen h-screen bg-stone-100 p-4 overflow-y-auto",children:[re.jsx(QN,{className:"mb-4",children:re.jsxs(e3,{children:[re.jsx(Rx,{children:re.jsx(jR,{className:"cursor-pointer",onClick:()=>c("/customers"),children:"Customers"})}),re.jsx($R,{}),re.jsx(Rx,{children:re.jsxs(jR,{className:"cursor-pointer",onClick:()=>c(`/customers/${e}`),children:[n.firstName," ",n.lastName]})}),re.jsx($R,{}),re.jsx(Rx,{children:re.jsxs(t3,{children:[r.login,r.online&&re.jsx("span",{className:"text-green-500 ml-3",children:"(currently connected)"})]})})]})}),re.jsxs("div",{className:"flex flex-wrap md:flex-row flex-col p-4",children:[re.jsxs("div",{className:"w-full md:w-1/2 max-w-md",children:[re.jsx(c1e,{data:r}),re.jsx(u1e,{data:r})]}),re.jsxs("div",{className:"w-full md:w-1/2 md:pl-4",children:[re.jsx(h1e,{data:r}),re.jsx(d1e,{data:r})]})]})]})}var pB="Checkbox",[p1e,eOe]=WS(pB),[m1e,g1e]=p1e(pB),FX=Q.forwardRef((t,e)=>{const{__scopeCheckbox:n,name:i,checked:r,defaultChecked:o,required:c,disabled:s,value:f="on",onCheckedChange:v,...w}=t,[C,M]=Q.useState(null),F=Ko(e,j=>M(j)),N=Q.useRef(!1),z=C?!!C.closest("form"):!0,[L=!1,P]=cT({prop:r,defaultProp:o,onChange:v}),H=Q.useRef(L);return Q.useEffect(()=>{const j=C==null?void 0:C.form;if(j){const q=()=>P(H.current);return j.addEventListener("reset",q),()=>j.removeEventListener("reset",q)}},[C,P]),re.jsxs(m1e,{scope:n,state:L,disabled:s,children:[re.jsx(Vs.button,{type:"button",role:"checkbox","aria-checked":o_(L)?"mixed":L,"aria-required":c,"data-state":kX(L),"data-disabled":s?"":void 0,disabled:s,value:f,...w,ref:F,onKeyDown:co(t.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:co(t.onClick,j=>{P(q=>o_(q)?!0:!q),z&&(N.current=j.isPropagationStopped(),N.current||j.stopPropagation())})}),z&&re.jsx(v1e,{control:C,bubbles:!N.current,name:i,value:f,checked:L,required:c,disabled:s,style:{transform:"translateX(-100%)"}})]})});FX.displayName=pB;var LX="CheckboxIndicator",OX=Q.forwardRef((t,e)=>{const{__scopeCheckbox:n,forceMount:i,...r}=t,o=g1e(LX,n);return re.jsx(jS,{present:i||o_(o.state)||o.state===!0,children:re.jsx(Vs.span,{"data-state":kX(o.state),"data-disabled":o.disabled?"":void 0,...r,ref:e,style:{pointerEvents:"none",...t.style}})})});OX.displayName=LX;var v1e=t=>{const{control:e,checked:n,bubbles:i=!0,...r}=t,o=Q.useRef(null),c=VZ(n),s=PZ(e);return Q.useEffect(()=>{const f=o.current,v=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(v,"checked").set;if(c!==n&&C){const M=new Event("click",{bubbles:i});f.indeterminate=o_(n),C.call(f,o_(n)?!1:n),f.dispatchEvent(M)}},[c,n,i]),re.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o_(n)?!1:n,...r,tabIndex:-1,ref:o,style:{...t.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function o_(t){return t==="indeterminate"}function kX(t){return o_(t)?"indeterminate":t?"checked":"unchecked"}var NX=FX,y1e=OX;const BX=Q.forwardRef(({className:t,...e},n)=>re.jsx(NX,{ref:n,className:Ar("peer h-4 w-4 shrink-0 rounded-sm border border-stone-200 border-stone-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-stone-900 data-[state=checked]:text-stone-50 dark:border-stone-800 dark:border-stone-50 dark:ring-offset-stone-950 dark:focus-visible:ring-stone-300 dark:data-[state=checked]:bg-stone-50 dark:data-[state=checked]:text-stone-900",t),...e,children:re.jsx(y1e,{className:Ar("flex items-center justify-center text-current"),children:re.jsx(e$,{className:"h-4 w-4"})})}));BX.displayName=NX.displayName;function mB(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM11 15V17H13V15H11ZM11 7V13H13V7H11Z"},child:[]}]})(t)}const zX=Pa(!1),_1e=_v();function x1e(t){_1e.set(zX,t)}function w1e({children:t}){const[e,n]=Ha(zX);return re.jsxs(vd,{open:e,onOpenChange:n,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),re.jsxs(sh,{className:"sm:max-w-md",children:[re.jsxs(oh,{children:[re.jsx("div",{className:"flex justify-center mb-2 mt-2",children:re.jsx(mB,{size:100,fill:"#FBE6E5",stroke:"#000",style:{stroke:"#000",strokeWidth:.2}})}),re.jsx(lh,{className:"text-center",children:"Oops!"}),re.jsxs(ch,{className:"text-center pt-3 pb-3",children:["Looks like we’re having trouble connecting.",re.jsx("br",{}),"Please check your internet connection and try again.",re.jsx("br",{}),"If the problem persists, contact support."]})]}),re.jsx(ah,{className:"sm:justify-center *:w-32",children:re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",children:"Continue"})})})]})]})}var $L={exports:{}},qL={exports:{}},ZL={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function n(r){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(r)}function i(r){var o=typeof r=="string"||r instanceof String;if(!o){var c=n(r);throw r===null?c="null":c==="object"&&(c=r.constructor.name),new TypeError("Expected a string but received a ".concat(c))}}t.exports=e.default,t.exports.default=e.default})(ZL,ZL.exports);var ti=ZL.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o),o=Date.parse(o),isNaN(o)?null:new Date(o)}t.exports=e.default,t.exports.default=e.default})(qL,qL.exports);var gB=qL.exports,XL={exports:{}},Pw={},vo={};Object.defineProperty(vo,"__esModule",{value:!0});vo.farsiLocales=vo.englishLocales=vo.dotDecimal=vo.decimal=vo.commaDecimal=vo.bengaliLocales=vo.arabicLocales=vo.alphanumeric=vo.alpha=void 0;var Gc=vo.alpha={"en-US":/^[A-Z]+$/i,"az-AZ":/^[A-VXYZÇƏĞİıÖŞÜ]+$/i,"bg-BG":/^[А-Я]+$/i,"cs-CZ":/^[A-ZÁČĎÉĚÍŇÓŘŠŤÚŮÝŽ]+$/i,"da-DK":/^[A-ZÆØÅ]+$/i,"de-DE":/^[A-ZÄÖÜß]+$/i,"el-GR":/^[Α-ώ]+$/i,"es-ES":/^[A-ZÁÉÍÑÓÚÜ]+$/i,"fa-IR":/^[ابپتثجچحخدذرزژسشصضطظعغفقکگلمنوهی]+$/i,"fi-FI":/^[A-ZÅÄÖ]+$/i,"fr-FR":/^[A-ZÀÂÆÇÉÈÊËÏÎÔŒÙÛÜŸ]+$/i,"it-IT":/^[A-ZÀÉÈÌÎÓÒÙ]+$/i,"ja-JP":/^[ぁ-んァ-ヶｦ-ﾟ一-龠ー・。、]+$/i,"nb-NO":/^[A-ZÆØÅ]+$/i,"nl-NL":/^[A-ZÁÉËÏÓÖÜÚ]+$/i,"nn-NO":/^[A-ZÆØÅ]+$/i,"hu-HU":/^[A-ZÁÉÍÓÖŐÚÜŰ]+$/i,"pl-PL":/^[A-ZĄĆĘŚŁŃÓŻŹ]+$/i,"pt-PT":/^[A-ZÃÁÀÂÄÇÉÊËÍÏÕÓÔÖÚÜ]+$/i,"ru-RU":/^[А-ЯЁ]+$/i,"kk-KZ":/^[А-ЯЁ\u04D8\u04B0\u0406\u04A2\u0492\u04AE\u049A\u04E8\u04BA]+$/i,"sl-SI":/^[A-ZČĆĐŠŽ]+$/i,"sk-SK":/^[A-ZÁČĎÉÍŇÓŠŤÚÝŽĹŔĽÄÔ]+$/i,"sr-RS@latin":/^[A-ZČĆŽŠĐ]+$/i,"sr-RS":/^[А-ЯЂЈЉЊЋЏ]+$/i,"sv-SE":/^[A-ZÅÄÖ]+$/i,"th-TH":/^[ก-๐\s]+$/i,"tr-TR":/^[A-ZÇĞİıÖŞÜ]+$/i,"uk-UA":/^[А-ЩЬЮЯЄIЇҐі]+$/i,"vi-VN":/^[A-ZÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴĐÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ]+$/i,"ko-KR":/^[ㄱ-ㅎㅏ-ㅣ가-힣]*$/,"ku-IQ":/^[ئابپتجچحخدرڕزژسشعغفڤقکگلڵمنوۆھەیێيطؤثآإأكضصةظذ]+$/i,ar:/^[ءآأؤإئابةتثجحخدذرزسشصضطظعغفقكلمنهوىيًٌٍَُِّْٰ]+$/,he:/^[א-ת]+$/,fa:/^['آاءأؤئبپتثجچحخدذرزژسشصضطظعغفقکگلمنوهةی']+$/i,bn:/^['ঀঁংঃঅআইঈউঊঋঌএঐওঔকখগঘঙচছজঝঞটঠডঢণতথদধনপফবভমযরলশষসহ়ঽািীুূৃৄেৈোৌ্ৎৗড়ঢ়য়ৠৡৢৣৰৱ৲৳৴৵৶৷৸৹৺৻']+$/,eo:/^[ABCĈD-GĜHĤIJĴK-PRSŜTUŬVZ]+$/i,"hi-IN":/^[\u0900-\u0961]+[\u0972-\u097F]*$/i,"si-LK":/^[\u0D80-\u0DFF]+$/},Hc=vo.alphanumeric={"en-US":/^[0-9A-Z]+$/i,"az-AZ":/^[0-9A-VXYZÇƏĞİıÖŞÜ]+$/i,"bg-BG":/^[0-9А-Я]+$/i,"cs-CZ":/^[0-9A-ZÁČĎÉĚÍŇÓŘŠŤÚŮÝŽ]+$/i,"da-DK":/^[0-9A-ZÆØÅ]+$/i,"de-DE":/^[0-9A-ZÄÖÜß]+$/i,"el-GR":/^[0-9Α-ω]+$/i,"es-ES":/^[0-9A-ZÁÉÍÑÓÚÜ]+$/i,"fi-FI":/^[0-9A-ZÅÄÖ]+$/i,"fr-FR":/^[0-9A-ZÀÂÆÇÉÈÊËÏÎÔŒÙÛÜŸ]+$/i,"it-IT":/^[0-9A-ZÀÉÈÌÎÓÒÙ]+$/i,"ja-JP":/^[0-9０-９ぁ-んァ-ヶｦ-ﾟ一-龠ー・。、]+$/i,"hu-HU":/^[0-9A-ZÁÉÍÓÖŐÚÜŰ]+$/i,"nb-NO":/^[0-9A-ZÆØÅ]+$/i,"nl-NL":/^[0-9A-ZÁÉËÏÓÖÜÚ]+$/i,"nn-NO":/^[0-9A-ZÆØÅ]+$/i,"pl-PL":/^[0-9A-ZĄĆĘŚŁŃÓŻŹ]+$/i,"pt-PT":/^[0-9A-ZÃÁÀÂÄÇÉÊËÍÏÕÓÔÖÚÜ]+$/i,"ru-RU":/^[0-9А-ЯЁ]+$/i,"kk-KZ":/^[0-9А-ЯЁ\u04D8\u04B0\u0406\u04A2\u0492\u04AE\u049A\u04E8\u04BA]+$/i,"sl-SI":/^[0-9A-ZČĆĐŠŽ]+$/i,"sk-SK":/^[0-9A-ZÁČĎÉÍŇÓŠŤÚÝŽĹŔĽÄÔ]+$/i,"sr-RS@latin":/^[0-9A-ZČĆŽŠĐ]+$/i,"sr-RS":/^[0-9А-ЯЂЈЉЊЋЏ]+$/i,"sv-SE":/^[0-9A-ZÅÄÖ]+$/i,"th-TH":/^[ก-๙\s]+$/i,"tr-TR":/^[0-9A-ZÇĞİıÖŞÜ]+$/i,"uk-UA":/^[0-9А-ЩЬЮЯЄIЇҐі]+$/i,"ko-KR":/^[0-9ㄱ-ㅎㅏ-ㅣ가-힣]*$/,"ku-IQ":/^[٠١٢٣٤٥٦٧٨٩0-9ئابپتجچحخدرڕزژسشعغفڤقکگلڵمنوۆھەیێيطؤثآإأكضصةظذ]+$/i,"vi-VN":/^[0-9A-ZÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴĐÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ]+$/i,ar:/^[٠١٢٣٤٥٦٧٨٩0-9ءآأؤإئابةتثجحخدذرزسشصضطظعغفقكلمنهوىيًٌٍَُِّْٰ]+$/,he:/^[0-9א-ת]+$/,fa:/^['0-9آاءأؤئبپتثجچحخدذرزژسشصضطظعغفقکگلمنوهةی۱۲۳۴۵۶۷۸۹۰']+$/i,bn:/^['ঀঁংঃঅআইঈউঊঋঌএঐওঔকখগঘঙচছজঝঞটঠডঢণতথদধনপফবভমযরলশষসহ়ঽািীুূৃৄেৈোৌ্ৎৗড়ঢ়য়ৠৡৢৣ০১২৩৪৫৬৭৮৯ৰৱ৲৳৴৵৶৷৸৹৺৻']+$/,eo:/^[0-9ABCĈD-GĜHĤIJĴK-PRSŜTUŬVZ]+$/i,"hi-IN":/^[\u0900-\u0963]+[\u0966-\u097F]*$/i,"si-LK":/^[0-9\u0D80-\u0DFF]+$/},tc=vo.decimal={"en-US":".",ar:"٫"},kH=vo.englishLocales=["AU","GB","HK","IN","NZ","ZA","ZM"];for(var jE,VD=0;VD<kH.length;VD++)jE="en-".concat(kH[VD]),Gc[jE]=Gc["en-US"],Hc[jE]=Hc["en-US"],tc[jE]=tc["en-US"];var NH=vo.arabicLocales=["AE","BH","DZ","EG","IQ","JO","KW","LB","LY","MA","QM","QA","SA","SD","SY","TN","YE"];for(var $E,GD=0;GD<NH.length;GD++)$E="ar-".concat(NH[GD]),Gc[$E]=Gc.ar,Hc[$E]=Hc.ar,tc[$E]=tc.ar;var BH=vo.farsiLocales=["IR","AF"];for(var HD,WD=0;WD<BH.length;WD++)HD="fa-".concat(BH[WD]),Hc[HD]=Hc.fa,tc[HD]=tc.ar;var zH=vo.bengaliLocales=["BD","IN"];for(var qE,jD=0;jD<zH.length;jD++)qE="bn-".concat(zH[jD]),Gc[qE]=Gc.bn,Hc[qE]=Hc.bn,tc[qE]=tc["en-US"];var UH=vo.dotDecimal=["ar-EG","ar-LB","ar-LY"],VH=vo.commaDecimal=["bg-BG","cs-CZ","da-DK","de-DE","el-GR","en-ZM","eo","es-ES","fr-CA","fr-FR","id-ID","it-IT","ku-IQ","hi-IN","hu-HU","nb-NO","nn-NO","nl-NL","pl-PL","pt-PT","ru-RU","kk-KZ","si-LK","sl-SI","sr-RS@latin","sr-RS","sv-SE","tr-TR","uk-UA","vi-VN"];for(var $D=0;$D<UH.length;$D++)tc[UH[$D]]=tc["en-US"];for(var qD=0;qD<VH.length;qD++)tc[VH[qD]]=",";Gc["fr-CA"]=Gc["fr-FR"];Hc["fr-CA"]=Hc["fr-FR"];Gc["pt-BR"]=Gc["pt-PT"];Hc["pt-BR"]=Hc["pt-PT"];tc["pt-BR"]=tc["pt-PT"];Gc["pl-Pl"]=Gc["pl-PL"];Hc["pl-Pl"]=Hc["pl-PL"];tc["pl-Pl"]=tc["pl-PL"];Gc["fa-AF"]=Gc.fa;Object.defineProperty(Pw,"__esModule",{value:!0});Pw.default=b1e;Pw.locales=void 0;var C1e=S1e(ti),UX=vo;function S1e(t){return t&&t.__esModule?t:{default:t}}function b1e(t,e){(0,C1e.default)(t),e=e||{};var n=new RegExp("^(?:[-+])?(?:[0-9]+)?(?:\\".concat(e.locale?UX.decimal[e.locale]:".","[0-9]*)?(?:[eE][\\+\\-]?(?:[0-9]+))?$"));if(t===""||t==="."||t===","||t==="-"||t==="+")return!1;var i=parseFloat(t.replace(",","."));return n.test(t)&&(!e.hasOwnProperty("min")||i>=e.min)&&(!e.hasOwnProperty("max")||i<=e.max)&&(!e.hasOwnProperty("lt")||i<e.lt)&&(!e.hasOwnProperty("gt")||i>e.gt)}Pw.locales=Object.keys(UX.decimal);(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(Pw);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o)?parseFloat(o):NaN}t.exports=e.default,t.exports.default=e.default})(XL,XL.exports);var VX=XL.exports,KL={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){return(0,n.default)(o),parseInt(o,c||10)}t.exports=e.default,t.exports.default=e.default})(KL,KL.exports);var E1e=KL.exports,YL={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){return(0,n.default)(o),c?o==="1"||/^true$/i.test(o):o!=="0"&&!/^false$/i.test(o)&&o!==""}t.exports=e.default,t.exports.default=e.default})(YL,YL.exports);var M1e=YL.exports,JL={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){return(0,n.default)(o),o===c}t.exports=e.default,t.exports.default=e.default})(JL,JL.exports);var R1e=JL.exports,QL={exports:{}},eO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function n(r){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(r)}function i(r){return n(r)==="object"&&r!==null?typeof r.toString=="function"?r=r.toString():r="[object Object]":(r===null||typeof r>"u"||isNaN(r)&&!r.length)&&(r=""),String(r)}t.exports=e.default,t.exports.default=e.default})(eO,eO.exports);var GX=eO.exports,tO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;function n(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;for(var o in r)typeof i[o]>"u"&&(i[o]=r[o]);return i}t.exports=e.default,t.exports.default=e.default})(tO,tO.exports);var oc=tO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=o(ti),i=o(GX),r=o(oc);function o(f){return f&&f.__esModule?f:{default:f}}var c={ignoreCase:!1,minOccurrences:1};function s(f,v,w){return(0,n.default)(f),w=(0,r.default)(w,c),w.ignoreCase?f.toLowerCase().split((0,i.default)(v).toLowerCase()).length>w.minOccurrences:f.split((0,i.default)(v)).length>w.minOccurrences}t.exports=e.default,t.exports.default=e.default})(QL,QL.exports);var T1e=QL.exports,nO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c,s){return(0,n.default)(o),Object.prototype.toString.call(c)!=="[object RegExp]"&&(c=new RegExp(c,s)),!!o.match(c)}t.exports=e.default,t.exports.default=e.default})(nO,nO.exports);var A1e=nO.exports,iO={exports:{}},rO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}function r(c){"@babel/helpers - typeof";return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},r(c)}function o(c,s){(0,n.default)(c);var f,v;r(s)==="object"?(f=s.min||0,v=s.max):(f=arguments[1],v=arguments[2]);var w=encodeURI(c).split(/%..|./).length-1;return w>=f&&(typeof v>"u"||w<=v)}t.exports=e.default,t.exports.default=e.default})(rO,rO.exports);var HX=rO.exports,sO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=r(oc);function r(s){return s&&s.__esModule?s:{default:s}}var o={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function c(s,f){(0,n.default)(s),f=(0,i.default)(f,o),f.allow_trailing_dot&&s[s.length-1]==="."&&(s=s.substring(0,s.length-1)),f.allow_wildcard===!0&&s.indexOf("*.")===0&&(s=s.substring(2));var v=s.split("."),w=v[v.length-1];return f.require_tld&&(v.length<2||!f.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(w)||/\s/.test(w))||!f.allow_numeric_tld&&/^\d+$/.test(w)?!1:v.every(function(C){return!(C.length>63&&!f.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(C)||/[\uff01-\uff5e]/.test(C)||/^-|-$/.test(C)||!f.allow_underscores&&/_/.test(C))})}t.exports=e.default,t.exports.default=e.default})(sO,sO.exports);var vB=sO.exports,oO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=v;var n=i(ti);function i(w){return w&&w.__esModule?w:{default:w}}var r="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",o="(".concat(r,"[.]){3}").concat(r),c=new RegExp("^".concat(o,"$")),s="(?:[0-9a-fA-F]{1,4})",f=new RegExp("^("+"(?:".concat(s,":){7}(?:").concat(s,"|:)|")+"(?:".concat(s,":){6}(?:").concat(o,"|:").concat(s,"|:)|")+"(?:".concat(s,":){5}(?::").concat(o,"|(:").concat(s,"){1,2}|:)|")+"(?:".concat(s,":){4}(?:(:").concat(s,"){0,1}:").concat(o,"|(:").concat(s,"){1,3}|:)|")+"(?:".concat(s,":){3}(?:(:").concat(s,"){0,2}:").concat(o,"|(:").concat(s,"){1,4}|:)|")+"(?:".concat(s,":){2}(?:(:").concat(s,"){0,3}:").concat(o,"|(:").concat(s,"){1,5}|:)|")+"(?:".concat(s,":){1}(?:(:").concat(s,"){0,4}:").concat(o,"|(:").concat(s,"){1,6}|:)|")+"(?::((?::".concat(s,"){0,5}:").concat(o,"|(?::").concat(s,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");function v(w){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(0,n.default)(w),C=String(C),C?C==="4"?c.test(w):C==="6"?f.test(w):!1:v(w,4)||v(w,6)}t.exports=e.default,t.exports.default=e.default})(oO,oO.exports);var HA=oO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=P;var n=s(ti),i=s(HX),r=s(vB),o=s(HA),c=s(oc);function s(H){return H&&H.__esModule?H:{default:H}}var f={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},v=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,w=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,C=/^[a-z\d]+$/,M=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,F=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,N=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,z=254;function L(H){var j=H.replace(/^"(.+)"$/,"$1");if(!j.trim())return!1;var q=/[\.";<>]/.test(j);if(q){if(j===H)return!1;var le=j.split('"').length===j.split('\\"').length;if(!le)return!1}return!0}function P(H,j){if((0,n.default)(H),j=(0,c.default)(j,f),j.require_display_name||j.allow_display_name){var q=H.match(v);if(q){var le=q[1];if(H=H.replace(le,"").replace(/(^<|>$)/g,""),le.endsWith(" ")&&(le=le.slice(0,-1)),!L(le))return!1}else if(j.require_display_name)return!1}if(!j.ignore_max_length&&H.length>z)return!1;var ce=H.split("@"),ae=ce.pop(),pe=ae.toLowerCase();if(j.host_blacklist.includes(pe)||j.host_whitelist.length>0&&!j.host_whitelist.includes(pe))return!1;var fe=ce.join("@");if(j.domain_specific_validation&&(pe==="gmail.com"||pe==="googlemail.com")){fe=fe.toLowerCase();var ue=fe.split("+")[0];if(!(0,i.default)(ue.replace(/\./g,""),{min:6,max:30}))return!1;for(var Ee=ue.split("."),We=0;We<Ee.length;We++)if(!C.test(Ee[We]))return!1}if(j.ignore_max_length===!1&&(!(0,i.default)(fe,{max:64})||!(0,i.default)(ae,{max:254})))return!1;if(!(0,r.default)(ae,{require_tld:j.require_tld,ignore_max_length:j.ignore_max_length,allow_underscores:j.allow_underscores})){if(!j.allow_ip_domain)return!1;if(!(0,o.default)(ae)){if(!ae.startsWith("[")||!ae.endsWith("]"))return!1;var rt=ae.slice(1,-1);if(rt.length===0||!(0,o.default)(rt))return!1}}if(fe[0]==='"')return fe=fe.slice(1,fe.length-1),j.allow_utf8_local_part?N.test(fe):M.test(fe);for(var tt=j.allow_utf8_local_part?F:w,Ye=fe.split("."),qe=0;qe<Ye.length;qe++)if(!tt.test(Ye[qe]))return!1;return!(j.blacklisted_chars&&fe.search(new RegExp("[".concat(j.blacklisted_chars,"]+"),"g"))!==-1)}t.exports=e.default,t.exports.default=e.default})(iO,iO.exports);var WX=iO.exports,aO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=P;var n=c(ti),i=c(vB),r=c(HA),o=c(oc);function c(H){return H&&H.__esModule?H:{default:H}}function s(H,j){return M(H)||C(H,j)||v(H,j)||f()}function f(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v(H,j){if(H){if(typeof H=="string")return w(H,j);var q=Object.prototype.toString.call(H).slice(8,-1);if(q==="Object"&&H.constructor&&(q=H.constructor.name),q==="Map"||q==="Set")return Array.from(H);if(q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q))return w(H,j)}}function w(H,j){(j==null||j>H.length)&&(j=H.length);for(var q=0,le=new Array(j);q<j;q++)le[q]=H[q];return le}function C(H,j){var q=H==null?null:typeof Symbol<"u"&&H[Symbol.iterator]||H["@@iterator"];if(q!=null){var le,ce,ae,pe,fe=[],ue=!0,Ee=!1;try{if(ae=(q=q.call(H)).next,j!==0)for(;!(ue=(le=ae.call(q)).done)&&(fe.push(le.value),fe.length!==j);ue=!0);}catch(We){Ee=!0,ce=We}finally{try{if(!ue&&q.return!=null&&(pe=q.return(),Object(pe)!==pe))return}finally{if(Ee)throw ce}}return fe}}function M(H){if(Array.isArray(H))return H}var F={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},N=/^\[([^\]]+)\](?::([0-9]+))?$/;function z(H){return Object.prototype.toString.call(H)==="[object RegExp]"}function L(H,j){for(var q=0;q<j.length;q++){var le=j[q];if(H===le||z(le)&&le.test(H))return!0}return!1}function P(H,j){if((0,n.default)(H),!H||/[\s<>]/.test(H)||H.indexOf("mailto:")===0||(j=(0,o.default)(j,F),j.validate_length&&H.length>=2083)||!j.allow_fragments&&H.includes("#")||!j.allow_query_components&&(H.includes("?")||H.includes("&")))return!1;var q,le,ce,ae,pe,fe,ue,Ee;if(ue=H.split("#"),H=ue.shift(),ue=H.split("?"),H=ue.shift(),ue=H.split("://"),ue.length>1){if(q=ue.shift().toLowerCase(),j.require_valid_protocol&&j.protocols.indexOf(q)===-1)return!1}else{if(j.require_protocol)return!1;if(H.slice(0,2)==="//"){if(!j.allow_protocol_relative_urls)return!1;ue[0]=H.slice(2)}}if(H=ue.join("://"),H==="")return!1;if(ue=H.split("/"),H=ue.shift(),H===""&&!j.require_host)return!0;if(ue=H.split("@"),ue.length>1){if(j.disallow_auth||ue[0]===""||(le=ue.shift(),le.indexOf(":")>=0&&le.split(":").length>2))return!1;var We=le.split(":"),rt=s(We,2),tt=rt[0],Ye=rt[1];if(tt===""&&Ye==="")return!1}ae=ue.join("@"),fe=null,Ee=null;var qe=ae.match(N);if(qe?(ce="",Ee=qe[1],fe=qe[2]||null):(ue=ae.split(":"),ce=ue.shift(),ue.length&&(fe=ue.join(":"))),fe!==null&&fe.length>0){if(pe=parseInt(fe,10),!/^[0-9]+$/.test(fe)||pe<=0||pe>65535)return!1}else if(j.require_port)return!1;return j.host_whitelist?L(ce,j.host_whitelist):ce===""&&!j.require_host?!0:!(!(0,r.default)(ce)&&!(0,i.default)(ce,j)&&(!Ee||!(0,r.default)(Ee,6))||(ce=ce||Ee,j.host_blacklist&&L(ce,j.host_blacklist)))}t.exports=e.default,t.exports.default=e.default})(aO,aO.exports);var P1e=aO.exports,lO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=w;var n=i(ti);function i(C){return C&&C.__esModule?C:{default:C}}var r=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){4}([0-9a-fA-F]{2})$/,o=/^([0-9a-fA-F]){12}$/,c=/^([0-9a-fA-F]{4}\.){2}([0-9a-fA-F]{4})$/,s=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){6}([0-9a-fA-F]{2})$/,f=/^([0-9a-fA-F]){16}$/,v=/^([0-9a-fA-F]{4}\.){3}([0-9a-fA-F]{4})$/;function w(C,M){return(0,n.default)(C),M!=null&&M.eui&&(M.eui=String(M.eui)),M!=null&&M.no_colons||M!=null&&M.no_separators?M.eui==="48"?o.test(C):M.eui==="64"?f.test(C):o.test(C)||f.test(C):(M==null?void 0:M.eui)==="48"?r.test(C)||c.test(C):(M==null?void 0:M.eui)==="64"?s.test(C)||v.test(C):w(C,{eui:"48"})||w(C,{eui:"64"})}t.exports=e.default,t.exports.default=e.default})(lO,lO.exports);var I1e=lO.exports,cO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=f;var n=r(ti),i=r(HA);function r(v){return v&&v.__esModule?v:{default:v}}var o=/^\d{1,3}$/,c=32,s=128;function f(v){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";(0,n.default)(v);var C=v.split("/");if(C.length!==2||!o.test(C[1])||C[1].length>1&&C[1].startsWith("0"))return!1;var M=(0,i.default)(C[0],w);if(!M)return!1;var F=null;switch(String(w)){case"4":F=c;break;case"6":F=s;break;default:F=(0,i.default)(C[0],"6")?s:c}return C[1]<=F&&C[1]>=0}t.exports=e.default,t.exports.default=e.default})(cO,cO.exports);var D1e=cO.exports,uO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=N;var n=i(oc);function i(z){return z&&z.__esModule?z:{default:z}}function r(z,L){return s(z)||c(z,L)||v(z,L)||o()}function o(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c(z,L){var P=z==null?null:typeof Symbol<"u"&&z[Symbol.iterator]||z["@@iterator"];if(P!=null){var H,j,q,le,ce=[],ae=!0,pe=!1;try{if(q=(P=P.call(z)).next,L!==0)for(;!(ae=(H=q.call(P)).done)&&(ce.push(H.value),ce.length!==L);ae=!0);}catch(fe){pe=!0,j=fe}finally{try{if(!ae&&P.return!=null&&(le=P.return(),Object(le)!==le))return}finally{if(pe)throw j}}return ce}}function s(z){if(Array.isArray(z))return z}function f(z,L){var P=typeof Symbol<"u"&&z[Symbol.iterator]||z["@@iterator"];if(!P){if(Array.isArray(z)||(P=v(z))||L){P&&(z=P);var H=0,j=function(){};return{s:j,n:function(){return H>=z.length?{done:!0}:{done:!1,value:z[H++]}},e:function(pe){throw pe},f:j}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var q=!0,le=!1,ce;return{s:function(){P=P.call(z)},n:function(){var pe=P.next();return q=pe.done,pe},e:function(pe){le=!0,ce=pe},f:function(){try{!q&&P.return!=null&&P.return()}finally{if(le)throw ce}}}}function v(z,L){if(z){if(typeof z=="string")return w(z,L);var P=Object.prototype.toString.call(z).slice(8,-1);if(P==="Object"&&z.constructor&&(P=z.constructor.name),P==="Map"||P==="Set")return Array.from(z);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return w(z,L)}}function w(z,L){(L==null||L>z.length)&&(L=z.length);for(var P=0,H=new Array(L);P<L;P++)H[P]=z[P];return H}var C={format:"YYYY/MM/DD",delimiters:["/","-"],strictMode:!1};function M(z){return/(^(y{4}|y{2})[.\/-](m{1,2})[.\/-](d{1,2})$)|(^(m{1,2})[.\/-](d{1,2})[.\/-]((y{4}|y{2})$))|(^(d{1,2})[.\/-](m{1,2})[.\/-]((y{4}|y{2})$))/gi.test(z)}function F(z,L){for(var P=[],H=Math.min(z.length,L.length),j=0;j<H;j++)P.push([z[j],L[j]]);return P}function N(z,L){if(typeof L=="string"?L=(0,n.default)({format:L},C):L=(0,n.default)(L,C),typeof z=="string"&&M(L.format)){var P=L.delimiters.find(function(Ye){return L.format.indexOf(Ye)!==-1}),H=L.strictMode?P:L.delimiters.find(function(Ye){return z.indexOf(Ye)!==-1}),j=F(z.split(H),L.format.toLowerCase().split(P)),q={},le=f(j),ce;try{for(le.s();!(ce=le.n()).done;){var ae=r(ce.value,2),pe=ae[0],fe=ae[1];if(pe.length!==fe.length)return!1;q[fe.charAt(0)]=pe}}catch(Ye){le.e(Ye)}finally{le.f()}var ue=q.y;if(ue.startsWith("-"))return!1;if(q.y.length===2){var Ee=parseInt(q.y,10);if(isNaN(Ee))return!1;var We=new Date().getFullYear()%100;Ee<We?ue="20".concat(q.y):ue="19".concat(q.y)}var rt=q.m;q.m.length===1&&(rt="0".concat(q.m));var tt=q.d;return q.d.length===1&&(tt="0".concat(q.d)),new Date("".concat(ue,"-").concat(rt,"-").concat(tt,"T00:00:00.000Z")).getUTCDate()===+q.d}return L.strictMode?!1:Object.prototype.toString.call(z)==="[object Date]"&&isFinite(z)}t.exports=e.default,t.exports.default=e.default})(uO,uO.exports);var jX=uO.exports,hO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=i(oc);function i(s){return s&&s.__esModule?s:{default:s}}var r={hourFormat:"hour24",mode:"default"},o={hour24:{default:/^([01]?[0-9]|2[0-3]):([0-5][0-9])$/,withSeconds:/^([01]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/},hour12:{default:/^(0?[1-9]|1[0-2]):([0-5][0-9]) (A|P)M$/,withSeconds:/^(0?[1-9]|1[0-2]):([0-5][0-9]):([0-5][0-9]) (A|P)M$/}};function c(s,f){return f=(0,n.default)(f,r),typeof s!="string"?!1:o[f.hourFormat][f.mode].test(s)}t.exports=e.default,t.exports.default=e.default})(hO,hO.exports);var F1e=hO.exports,dO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=i(ti);function i(f){return f&&f.__esModule?f:{default:f}}var r={loose:!1},o=["true","false","1","0"],c=[].concat(o,["yes","no"]);function s(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r;return(0,n.default)(f),v.loose?c.includes(f.toLowerCase()):o.includes(f)}t.exports=e.default,t.exports.default=e.default})(dO,dO.exports);var L1e=dO.exports,fO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=H;var n=i(ti);function i(j){return j&&j.__esModule?j:{default:j}}var r="([A-Za-z]{3}(-[A-Za-z]{3}){0,2})",o="(([a-zA-Z]{2,3}(-".concat(r,")?)|([a-zA-Z]{5,8}))"),c="([A-Za-z]{4})",s="([A-Za-z]{2}|\\d{3})",f="([A-Za-z0-9]{5,8}|(\\d[A-Z-a-z0-9]{3}))",v="(\\d|[A-W]|[Y-Z]|[a-w]|[y-z])",w="(".concat(v,"(-[A-Za-z0-9]{2,8})+)"),C="(x(-[A-Za-z0-9]{1,8})+)",M="((en-GB-oed)|(i-ami)|(i-bnn)|(i-default)|(i-enochian)|(i-hak)|(i-klingon)|(i-lux)|(i-mingo)|(i-navajo)|(i-pwn)|(i-tao)|(i-tay)|(i-tsu)|(sgn-BE-FR)|(sgn-BE-NL)|(sgn-CH-DE))",F="((art-lojban)|(cel-gaulish)|(no-bok)|(no-nyn)|(zh-guoyu)|(zh-hakka)|(zh-min)|(zh-min-nan)|(zh-xiang))",N="(".concat(M,"|").concat(F,")"),z="(-|_)",L="".concat(o,"(").concat(z).concat(c,")?(").concat(z).concat(s,")?(").concat(z).concat(f,")*(").concat(z).concat(w,")*(").concat(z).concat(C,")?"),P=new RegExp("(^".concat(C,"$)|(^").concat(N,"$)|(^").concat(L,"$)"));function H(j){return(0,n.default)(j),P.test(j)}t.exports=e.default,t.exports.default=e.default})(fO,fO.exports);var O1e=fO.exports,pO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^(?!(1[3-9])|(20)|(3[3-9])|(4[0-9])|(5[0-9])|(60)|(7[3-9])|(8[1-9])|(9[0-2])|(9[3-9]))[0-9]{9}$/;function o(c){if((0,n.default)(c),!r.test(c))return!1;for(var s=0,f=0;f<c.length;f++)f%3===0?s+=c[f]*3:f%3===1?s+=c[f]*7:s+=c[f]*1;return s%10===0}t.exports=e.default,t.exports.default=e.default})(pO,pO.exports);var k1e=pO.exports,XS={};Object.defineProperty(XS,"__esModule",{value:!0});XS.default=z1e;XS.locales=void 0;var N1e=B1e(ti),mO=vo;function B1e(t){return t&&t.__esModule?t:{default:t}}function z1e(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,N1e.default)(t);var i=t,r=n.ignore;if(r)if(r instanceof RegExp)i=i.replace(r,"");else if(typeof r=="string")i=i.replace(new RegExp("[".concat(r.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in mO.alpha)return mO.alpha[e].test(i);throw new Error("Invalid locale '".concat(e,"'"))}XS.locales=Object.keys(mO.alpha);var KS={};Object.defineProperty(KS,"__esModule",{value:!0});KS.default=G1e;KS.locales=void 0;var U1e=V1e(ti),gO=vo;function V1e(t){return t&&t.__esModule?t:{default:t}}function G1e(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,U1e.default)(t);var i=t,r=n.ignore;if(r)if(r instanceof RegExp)i=i.replace(r,"");else if(typeof r=="string")i=i.replace(new RegExp("[".concat(r.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in gO.alphanumeric)return gO.alphanumeric[e].test(i);throw new Error("Invalid locale '".concat(e,"'"))}KS.locales=Object.keys(gO.alphanumeric);var vO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=vo;function r(s){return s&&s.__esModule?s:{default:s}}var o=/^[0-9]+$/;function c(s,f){return(0,n.default)(s),f&&f.no_symbols?o.test(s):new RegExp("^[+-]?([0-9]*[".concat((f||{}).locale?i.decimal[f.locale]:".","])?[0-9]+$")).test(s)}t.exports=e.default,t.exports.default=e.default})(vO,vO.exports);var H1e=vO.exports,yO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r={AM:/^[A-Z]{2}\d{7}$/,AR:/^[A-Z]{3}\d{6}$/,AT:/^[A-Z]\d{7}$/,AU:/^[A-Z]\d{7}$/,AZ:/^[A-Z]{1}\d{8}$/,BE:/^[A-Z]{2}\d{6}$/,BG:/^\d{9}$/,BR:/^[A-Z]{2}\d{6}$/,BY:/^[A-Z]{2}\d{7}$/,CA:/^[A-Z]{2}\d{6}$/,CH:/^[A-Z]\d{7}$/,CN:/^G\d{8}$|^E(?![IO])[A-Z0-9]\d{7}$/,CY:/^[A-Z](\d{6}|\d{8})$/,CZ:/^\d{8}$/,DE:/^[CFGHJKLMNPRTVWXYZ0-9]{9}$/,DK:/^\d{9}$/,DZ:/^\d{9}$/,EE:/^([A-Z]\d{7}|[A-Z]{2}\d{7})$/,ES:/^[A-Z0-9]{2}([A-Z0-9]?)\d{6}$/,FI:/^[A-Z]{2}\d{7}$/,FR:/^\d{2}[A-Z]{2}\d{5}$/,GB:/^\d{9}$/,GR:/^[A-Z]{2}\d{7}$/,HR:/^\d{9}$/,HU:/^[A-Z]{2}(\d{6}|\d{7})$/,IE:/^[A-Z0-9]{2}\d{7}$/,IN:/^[A-Z]{1}-?\d{7}$/,ID:/^[A-C]\d{7}$/,IR:/^[A-Z]\d{8}$/,IS:/^(A)\d{7}$/,IT:/^[A-Z0-9]{2}\d{7}$/,JM:/^[Aa]\d{7}$/,JP:/^[A-Z]{2}\d{7}$/,KR:/^[MS]\d{8}$/,KZ:/^[a-zA-Z]\d{7}$/,LI:/^[a-zA-Z]\d{5}$/,LT:/^[A-Z0-9]{8}$/,LU:/^[A-Z0-9]{8}$/,LV:/^[A-Z0-9]{2}\d{7}$/,LY:/^[A-Z0-9]{8}$/,MT:/^\d{7}$/,MZ:/^([A-Z]{2}\d{7})|(\d{2}[A-Z]{2}\d{5})$/,MY:/^[AHK]\d{8}$/,MX:/^\d{10,11}$/,NL:/^[A-Z]{2}[A-Z0-9]{6}\d$/,NZ:/^([Ll]([Aa]|[Dd]|[Ff]|[Hh])|[Ee]([Aa]|[Pp])|[Nn])\d{6}$/,PH:/^([A-Z](\d{6}|\d{7}[A-Z]))|([A-Z]{2}(\d{6}|\d{7}))$/,PK:/^[A-Z]{2}\d{7}$/,PL:/^[A-Z]{2}\d{7}$/,PT:/^[A-Z]\d{6}$/,RO:/^\d{8,9}$/,RU:/^\d{9}$/,SE:/^\d{8}$/,SL:/^(P)[A-Z]\d{7}$/,SK:/^[0-9A-Z]\d{7}$/,TH:/^[A-Z]{1,2}\d{6,7}$/,TR:/^[A-Z]\d{8}$/,UA:/^[A-Z]{2}\d{6}$/,US:/^\d{9}$/,ZA:/^[TAMD]\d{8}$/};function o(c,s){(0,n.default)(c);var f=c.replace(/\s/g,"").toUpperCase();return s.toUpperCase()in r&&r[s].test(f)}t.exports=e.default,t.exports.default=e.default})(yO,yO.exports);var W1e=yO.exports,_O={exports:{}},xO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=i(ti);function i(s){return s&&s.__esModule?s:{default:s}}var r=/^(?:[-+]?(?:0|[1-9][0-9]*))$/,o=/^[-+]?[0-9]+$/;function c(s,f){(0,n.default)(s),f=f||{};var v=f.allow_leading_zeroes===!1?r:o,w=!f.hasOwnProperty("min")||s>=f.min,C=!f.hasOwnProperty("max")||s<=f.max,M=!f.hasOwnProperty("lt")||s<f.lt,F=!f.hasOwnProperty("gt")||s>f.gt;return v.test(s)&&w&&C&&M&&F}t.exports=e.default,t.exports.default=e.default})(xO,xO.exports);var yB=xO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(yB);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o,{allow_leading_zeroes:!1,min:0,max:65535})}t.exports=e.default,t.exports.default=e.default})(_O,_O.exports);var j1e=_O.exports,wO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o),o===o.toLowerCase()}t.exports=e.default,t.exports.default=e.default})(wO,wO.exports);var $1e=wO.exports,CO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o),o===o.toUpperCase()}t.exports=e.default,t.exports.default=e.default})(CO,CO.exports);var q1e=CO.exports,SO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=i(ti);function i(s){return s&&s.__esModule?s:{default:s}}var r=/^[0-9]{15}$/,o=/^\d{2}-\d{6}-\d{6}-\d{1}$/;function c(s,f){(0,n.default)(s),f=f||{};var v=r;if(f.allow_hyphens&&(v=o),!v.test(s))return!1;s=s.replace(/-/g,"");for(var w=0,C=2,M=14,F=0;F<M;F++){var N=s.substring(M-F-1,M-F),z=parseInt(N,10)*C;z>=10?w+=z%10+1:w+=z,C===1?C+=1:C-=1}var L=(10-w%10)%10;return L===parseInt(s.substring(14,15),10)}t.exports=e.default,t.exports.default=e.default})(SO,SO.exports);var Z1e=SO.exports,bO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[\x00-\x7F]+$/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(bO,bO.exports);var X1e=bO.exports,Iw={};Object.defineProperty(Iw,"__esModule",{value:!0});Iw.default=Q1e;Iw.fullWidth=void 0;var K1e=Y1e(ti);function Y1e(t){return t&&t.__esModule?t:{default:t}}var J1e=Iw.fullWidth=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;function Q1e(t){return(0,K1e.default)(t),J1e.test(t)}var Dw={};Object.defineProperty(Dw,"__esModule",{value:!0});Dw.default=iSe;Dw.halfWidth=void 0;var eSe=tSe(ti);function tSe(t){return t&&t.__esModule?t:{default:t}}var nSe=Dw.halfWidth=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;function iSe(t){return(0,eSe.default)(t),nSe.test(t)}var EO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=o(ti),i=Iw,r=Dw;function o(s){return s&&s.__esModule?s:{default:s}}function c(s){return(0,n.default)(s),i.fullWidth.test(s)&&r.halfWidth.test(s)}t.exports=e.default,t.exports.default=e.default})(EO,EO.exports);var rSe=EO.exports,MO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/[^\x00-\x7F]/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(MO,MO.exports);var sSe=MO.exports,RO={exports:{}},TO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;function n(i,r){var o=i.join("");return new RegExp(o,r)}t.exports=e.default,t.exports.default=e.default})(TO,TO.exports);var oSe=TO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=r(oSe);function r(s){return s&&s.__esModule?s:{default:s}}var o=(0,i.default)(["^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)","(?:-((?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*))","?(?:\\+([0-9a-z-]+(?:\\.[0-9a-z-]+)*))?$"],"i");function c(s){return(0,n.default)(s),o.test(s)}t.exports=e.default,t.exports.default=e.default})(RO,RO.exports);var aSe=RO.exports,AO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/[\uD800-\uDBFF][\uDC00-\uDFFF]/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(AO,AO.exports);var lSe=AO.exports,PO={exports:{}},IO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(r,o){return r.some(function(c){return o===c})};e.default=n,t.exports=e.default,t.exports.default=e.default})(IO,IO.exports);var cSe=IO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=w;var n=c(oc),i=c(ti),r=c(cSe),o=vo;function c(C){return C&&C.__esModule?C:{default:C}}function s(C){var M=new RegExp("^[-+]?([0-9]+)?(\\".concat(o.decimal[C.locale],"[0-9]{").concat(C.decimal_digits,"})").concat(C.force_decimal?"":"?","$"));return M}var f={force_decimal:!1,decimal_digits:"1,",locale:"en-US"},v=["","-","+"];function w(C,M){if((0,i.default)(C),M=(0,n.default)(M,f),M.locale in o.decimal)return!(0,r.default)(v,C.replace(/ /g,""))&&s(M).test(C);throw new Error("Invalid locale '".concat(M.locale,"'"))}t.exports=e.default,t.exports.default=e.default})(PO,PO.exports);var uSe=PO.exports,DO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^(0x|0h)?[0-9A-F]+$/i;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(DO,DO.exports);var $X=DO.exports,FO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^(0o)?[0-7]+$/i;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(FO,FO.exports);var hSe=FO.exports,LO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(ti),i=r(VX);function r(c){return c&&c.__esModule?c:{default:c}}function o(c,s){return(0,n.default)(c),(0,i.default)(c)%parseInt(s,10)===0}t.exports=e.default,t.exports.default=e.default})(LO,LO.exports);var dSe=LO.exports,OO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^#?([0-9A-F]{3}|[0-9A-F]{4}|[0-9A-F]{6}|[0-9A-F]{8})$/i;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(OO,OO.exports);var fSe=OO.exports,kO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=f;var n=i(ti);function i(v){return v&&v.__esModule?v:{default:v}}var r=/^rgb\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){2}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\)$/,o=/^rgba\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)$/,c=/^rgb\((([0-9]%|[1-9][0-9]%|100%),){2}([0-9]%|[1-9][0-9]%|100%)\)$/,s=/^rgba\((([0-9]%|[1-9][0-9]%|100%),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)$/;function f(v){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(0,n.default)(v),w?r.test(v)||o.test(v)||c.test(v)||s.test(v):r.test(v)||o.test(v)}t.exports=e.default,t.exports.default=e.default})(kO,kO.exports);var pSe=kO.exports,NO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=i(ti);function i(s){return s&&s.__esModule?s:{default:s}}var r=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(,(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}(,((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?))?\)$/i,o=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(\s(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}\s?(\/\s((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?)\s?)?\)$/i;function c(s){(0,n.default)(s);var f=s.replace(/\s+/g," ").replace(/\s?(hsla?\(|\)|,)\s?/ig,"$1");return f.indexOf(",")!==-1?r.test(f):o.test(f)}t.exports=e.default,t.exports.default=e.default})(NO,NO.exports);var mSe=NO.exports,BO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[A-Z]{2}[0-9A-Z]{3}\d{2}\d{5}$/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(BO,BO.exports);var gSe=BO.exports,YS={};Object.defineProperty(YS,"__esModule",{value:!0});YS.default=CSe;YS.locales=void 0;var vSe=ySe(ti);function ySe(t){return t&&t.__esModule?t:{default:t}}var yT={AD:/^(AD[0-9]{2})\d{8}[A-Z0-9]{12}$/,AE:/^(AE[0-9]{2})\d{3}\d{16}$/,AL:/^(AL[0-9]{2})\d{8}[A-Z0-9]{16}$/,AT:/^(AT[0-9]{2})\d{16}$/,AZ:/^(AZ[0-9]{2})[A-Z0-9]{4}\d{20}$/,BA:/^(BA[0-9]{2})\d{16}$/,BE:/^(BE[0-9]{2})\d{12}$/,BG:/^(BG[0-9]{2})[A-Z]{4}\d{6}[A-Z0-9]{8}$/,BH:/^(BH[0-9]{2})[A-Z]{4}[A-Z0-9]{14}$/,BR:/^(BR[0-9]{2})\d{23}[A-Z]{1}[A-Z0-9]{1}$/,BY:/^(BY[0-9]{2})[A-Z0-9]{4}\d{20}$/,CH:/^(CH[0-9]{2})\d{5}[A-Z0-9]{12}$/,CR:/^(CR[0-9]{2})\d{18}$/,CY:/^(CY[0-9]{2})\d{8}[A-Z0-9]{16}$/,CZ:/^(CZ[0-9]{2})\d{20}$/,DE:/^(DE[0-9]{2})\d{18}$/,DK:/^(DK[0-9]{2})\d{14}$/,DO:/^(DO[0-9]{2})[A-Z]{4}\d{20}$/,DZ:/^(DZ\d{24})$/,EE:/^(EE[0-9]{2})\d{16}$/,EG:/^(EG[0-9]{2})\d{25}$/,ES:/^(ES[0-9]{2})\d{20}$/,FI:/^(FI[0-9]{2})\d{14}$/,FO:/^(FO[0-9]{2})\d{14}$/,FR:/^(FR[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,GB:/^(GB[0-9]{2})[A-Z]{4}\d{14}$/,GE:/^(GE[0-9]{2})[A-Z0-9]{2}\d{16}$/,GI:/^(GI[0-9]{2})[A-Z]{4}[A-Z0-9]{15}$/,GL:/^(GL[0-9]{2})\d{14}$/,GR:/^(GR[0-9]{2})\d{7}[A-Z0-9]{16}$/,GT:/^(GT[0-9]{2})[A-Z0-9]{4}[A-Z0-9]{20}$/,HR:/^(HR[0-9]{2})\d{17}$/,HU:/^(HU[0-9]{2})\d{24}$/,IE:/^(IE[0-9]{2})[A-Z0-9]{4}\d{14}$/,IL:/^(IL[0-9]{2})\d{19}$/,IQ:/^(IQ[0-9]{2})[A-Z]{4}\d{15}$/,IR:/^(IR[0-9]{2})0\d{2}0\d{18}$/,IS:/^(IS[0-9]{2})\d{22}$/,IT:/^(IT[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,JO:/^(JO[0-9]{2})[A-Z]{4}\d{22}$/,KW:/^(KW[0-9]{2})[A-Z]{4}[A-Z0-9]{22}$/,KZ:/^(KZ[0-9]{2})\d{3}[A-Z0-9]{13}$/,LB:/^(LB[0-9]{2})\d{4}[A-Z0-9]{20}$/,LC:/^(LC[0-9]{2})[A-Z]{4}[A-Z0-9]{24}$/,LI:/^(LI[0-9]{2})\d{5}[A-Z0-9]{12}$/,LT:/^(LT[0-9]{2})\d{16}$/,LU:/^(LU[0-9]{2})\d{3}[A-Z0-9]{13}$/,LV:/^(LV[0-9]{2})[A-Z]{4}[A-Z0-9]{13}$/,MA:/^(MA[0-9]{26})$/,MC:/^(MC[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,MD:/^(MD[0-9]{2})[A-Z0-9]{20}$/,ME:/^(ME[0-9]{2})\d{18}$/,MK:/^(MK[0-9]{2})\d{3}[A-Z0-9]{10}\d{2}$/,MR:/^(MR[0-9]{2})\d{23}$/,MT:/^(MT[0-9]{2})[A-Z]{4}\d{5}[A-Z0-9]{18}$/,MU:/^(MU[0-9]{2})[A-Z]{4}\d{19}[A-Z]{3}$/,MZ:/^(MZ[0-9]{2})\d{21}$/,NL:/^(NL[0-9]{2})[A-Z]{4}\d{10}$/,NO:/^(NO[0-9]{2})\d{11}$/,PK:/^(PK[0-9]{2})[A-Z0-9]{4}\d{16}$/,PL:/^(PL[0-9]{2})\d{24}$/,PS:/^(PS[0-9]{2})[A-Z0-9]{4}\d{21}$/,PT:/^(PT[0-9]{2})\d{21}$/,QA:/^(QA[0-9]{2})[A-Z]{4}[A-Z0-9]{21}$/,RO:/^(RO[0-9]{2})[A-Z]{4}[A-Z0-9]{16}$/,RS:/^(RS[0-9]{2})\d{18}$/,SA:/^(SA[0-9]{2})\d{2}[A-Z0-9]{18}$/,SC:/^(SC[0-9]{2})[A-Z]{4}\d{20}[A-Z]{3}$/,SE:/^(SE[0-9]{2})\d{20}$/,SI:/^(SI[0-9]{2})\d{15}$/,SK:/^(SK[0-9]{2})\d{20}$/,SM:/^(SM[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,SV:/^(SV[0-9]{2})[A-Z0-9]{4}\d{20}$/,TL:/^(TL[0-9]{2})\d{19}$/,TN:/^(TN[0-9]{2})\d{20}$/,TR:/^(TR[0-9]{2})\d{5}[A-Z0-9]{17}$/,UA:/^(UA[0-9]{2})\d{6}[A-Z0-9]{19}$/,VA:/^(VA[0-9]{2})\d{18}$/,VG:/^(VG[0-9]{2})[A-Z0-9]{4}\d{16}$/,XK:/^(XK[0-9]{2})\d{16}$/};function _Se(t){var e=t.filter(function(n){return!(n in yT)});return!(e.length>0)}function xSe(t,e){var n=t.replace(/[\s\-]+/gi,"").toUpperCase(),i=n.slice(0,2).toUpperCase(),r=i in yT;if(e.whitelist){if(!_Se(e.whitelist))return!1;var o=e.whitelist.includes(i);if(!o)return!1}if(e.blacklist){var c=e.blacklist.includes(i);if(c)return!1}return r&&yT[i].test(n)}function wSe(t){var e=t.replace(/[^A-Z0-9]+/gi,"").toUpperCase(),n=e.slice(4)+e.slice(0,4),i=n.replace(/[A-Z]/g,function(o){return o.charCodeAt(0)-55}),r=i.match(/\d{1,7}/g).reduce(function(o,c){return Number(o+c)%97},"");return r===1}function CSe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,vSe.default)(t),xSe(t,e)&&wSe(t)}YS.locales=Object.keys(yT);var zO={exports:{}},Fw={};Object.defineProperty(Fw,"__esModule",{value:!0});Fw.CountryCodes=void 0;Fw.default=ESe;var SSe=bSe(ti);function bSe(t){return t&&t.__esModule?t:{default:t}}var qX=new Set(["AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UM","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]);function ESe(t){return(0,SSe.default)(t),qX.has(t.toUpperCase())}Fw.CountryCodes=qX;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=Fw;function r(s){return s&&s.__esModule?s:{default:s}}var o=/^[A-Za-z]{6}[A-Za-z0-9]{2}([A-Za-z0-9]{3})?$/;function c(s){(0,n.default)(s);var f=s.slice(4,6).toUpperCase();return!i.CountryCodes.has(f)&&f!=="XK"?!1:o.test(s)}t.exports=e.default,t.exports.default=e.default})(zO,zO.exports);var MSe=zO.exports,UO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[a-f0-9]{32}$/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(UO,UO.exports);var RSe=UO.exports,VO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r={md5:32,md4:32,sha1:40,sha256:64,sha384:96,sha512:128,ripemd128:32,ripemd160:40,tiger128:32,tiger160:40,tiger192:48,crc32:8,crc32b:8};function o(c,s){(0,n.default)(c);var f=new RegExp("^[a-fA-F0-9]{".concat(r[s],"}$"));return f.test(c)}t.exports=e.default,t.exports.default=e.default})(VO,VO.exports);var TSe=VO.exports,GO={exports:{}},HO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=f;var n=r(ti),i=r(oc);function r(v){return v&&v.__esModule?v:{default:v}}var o=/[^A-Z0-9+\/=]/i,c=/^[A-Z0-9_\-]*$/i,s={urlSafe:!1};function f(v,w){(0,n.default)(v),w=(0,i.default)(w,s);var C=v.length;if(w.urlSafe)return c.test(v);if(C%4!==0||o.test(v))return!1;var M=v.indexOf("=");return M===-1||M===C-1||M===C-2&&v[C-1]==="="}t.exports=e.default,t.exports.default=e.default})(HO,HO.exports);var ZX=HO.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(ti),i=r(ZX);function r(c){return c&&c.__esModule?c:{default:c}}function o(c){(0,n.default)(c);var s=c.split("."),f=s.length;return f!==3?!1:s.reduce(function(v,w){return v&&(0,i.default)(w,{urlSafe:!0})},!0)}t.exports=e.default,t.exports.default=e.default})(GO,GO.exports);var ASe=GO.exports,WO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=r(ti),i=r(oc);function r(f){return f&&f.__esModule?f:{default:f}}function o(f){"@babel/helpers - typeof";return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},o(f)}var c={allow_primitives:!1};function s(f,v){(0,n.default)(f);try{v=(0,i.default)(v,c);var w=[];v.allow_primitives&&(w=[null,!1,!0]);var C=JSON.parse(f);return w.includes(C)||!!C&&o(C)==="object"}catch{}return!1}t.exports=e.default,t.exports.default=e.default})(WO,WO.exports);var PSe=WO.exports,jO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=r(oc);function r(s){return s&&s.__esModule?s:{default:s}}var o={ignore_whitespace:!1};function c(s,f){return(0,n.default)(s),f=(0,i.default)(f,o),(f.ignore_whitespace?s.trim().length:s.length)===0}t.exports=e.default,t.exports.default=e.default})(jO,jO.exports);var ISe=jO.exports,$O={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}function r(c){"@babel/helpers - typeof";return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},r(c)}function o(c,s){(0,n.default)(c);var f,v;r(s)==="object"?(f=s.min||0,v=s.max):(f=arguments[1]||0,v=arguments[2]);var w=c.match(/(\uFE0F|\uFE0E)/g)||[],C=c.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],M=c.length-w.length-C.length;return M>=f&&(typeof v>"u"||M<=v)}t.exports=e.default,t.exports.default=e.default})($O,$O.exports);var DSe=$O.exports,qO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r={1:/^[0-9A-F]{8}-[0-9A-F]{4}-1[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,2:/^[0-9A-F]{8}-[0-9A-F]{4}-2[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,7:/^[0-9A-F]{8}-[0-9A-F]{4}-7[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function o(c,s){(0,n.default)(c);var f=r[[void 0,null].includes(s)?"all":s];return!!f&&f.test(c)}t.exports=e.default,t.exports.default=e.default})(qO,qO.exports);var FSe=qO.exports,ZO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(ti),i=r($X);function r(c){return c&&c.__esModule?c:{default:c}}function o(c){return(0,n.default)(c),(0,i.default)(c)&&c.length===24}t.exports=e.default,t.exports.default=e.default})(ZO,ZO.exports);var LSe=ZO.exports,XO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(gB);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){var s=(c==null?void 0:c.comparisonDate)||c||Date().toString(),f=(0,n.default)(s),v=(0,n.default)(o);return!!(v&&f&&v>f)}t.exports=e.default,t.exports.default=e.default})(XO,XO.exports);var OSe=XO.exports,KO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(ti),i=r(gB);function r(c){return c&&c.__esModule?c:{default:c}}function o(c){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:String(new Date);(0,n.default)(c);var f=(0,i.default)(s),v=(0,i.default)(c);return!!(v&&f&&v<f)}t.exports=e.default,t.exports.default=e.default})(KO,KO.exports);var kSe=KO.exports,YO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=r(GX);function r(s){return s&&s.__esModule?s:{default:s}}function o(s){"@babel/helpers - typeof";return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(s)}function c(s,f){(0,n.default)(s);var v;if(Object.prototype.toString.call(f)==="[object Array]"){var w=[];for(v in f)({}).hasOwnProperty.call(f,v)&&(w[v]=(0,i.default)(f[v]));return w.indexOf(s)>=0}else{if(o(f)==="object")return f.hasOwnProperty(s);if(f&&typeof f.indexOf=="function")return f.indexOf(s)>=0}return!1}t.exports=e.default,t.exports.default=e.default})(YO,YO.exports);var NSe=YO.exports,JO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){(0,n.default)(o);for(var c=o.replace(/[- ]+/g,""),s=0,f,v,w,C=c.length-1;C>=0;C--)f=c.substring(C,C+1),v=parseInt(f,10),w?(v*=2,v>=10?s+=v%10+1:s+=v):s+=v,w=!w;return!!(s%10===0&&c)}t.exports=e.default,t.exports.default=e.default})(JO,JO.exports);var XX=JO.exports,QO={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=r(ti),i=r(XX);function r(f){return f&&f.__esModule?f:{default:f}}var o={amex:/^3[47][0-9]{13}$/,dinersclub:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9][0-9])[0-9]{12,15}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/,mastercard:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/,unionpay:/^(6[27][0-9]{14}|^(81[0-9]{14,17}))$/,visa:/^(?:4[0-9]{12})(?:[0-9]{3,6})?$/},c=function(){var f=[];for(var v in o)o.hasOwnProperty(v)&&f.push(o[v]);return f}();function s(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,n.default)(f);var w=v.provider,C=f.replace(/[- ]+/g,"");if(w&&w.toLowerCase()in o){if(!o[w.toLowerCase()].test(C))return!1}else{if(w&&!(w.toLowerCase()in o))throw new Error("".concat(w," is not a valid credit card provider."));if(!c.some(function(M){return M.test(C)}))return!1}return(0,i.default)(f)}t.exports=e.default,t.exports.default=e.default})(QO,QO.exports);var BSe=QO.exports,ek={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=r(ti),i=r(yB);function r(s){return s&&s.__esModule?s:{default:s}}var o={PL:function(f){(0,n.default)(f);var v={1:1,2:3,3:7,4:9,5:1,6:3,7:7,8:9,9:1,10:3,11:0};if(f!=null&&f.length===11&&(0,i.default)(f,{allow_leading_zeroes:!0})){var w=f.split("").slice(0,-1),C=w.reduce(function(N,z,L){return N+Number(z)*v[L+1]},0),M=C%10,F=Number(f.charAt(f.length-1));if(M===0&&F===0||F===10-M)return!0}return!1},ES:function(f){(0,n.default)(f);var v=/^[0-9X-Z][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$/,w={X:0,Y:1,Z:2},C=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"],M=f.trim().toUpperCase();if(!v.test(M))return!1;var F=M.slice(0,-1).replace(/[X,Y,Z]/g,function(N){return w[N]});return M.endsWith(C[F%23])},FI:function(f){if((0,n.default)(f),f.length!==11||!f.match(/^\d{6}[\-A\+]\d{3}[0-9ABCDEFHJKLMNPRSTUVWXY]{1}$/))return!1;var v="0123456789ABCDEFHJKLMNPRSTUVWXY",w=parseInt(f.slice(0,6),10)*1e3+parseInt(f.slice(7,10),10),C=w%31,M=v[C];return M===f.slice(10,11)},IN:function(f){var v=/^[1-9]\d{3}\s?\d{4}\s?\d{4}$/,w=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],C=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],M=f.trim();if(!v.test(M))return!1;var F=0,N=M.replace(/\s/g,"").split("").map(Number).reverse();return N.forEach(function(z,L){F=w[F][C[L%8][z]]}),F===0},IR:function(f){if(!f.match(/^\d{10}$/)||(f="0000".concat(f).slice(f.length-6),parseInt(f.slice(3,9),10)===0))return!1;for(var v=parseInt(f.slice(9,10),10),w=0,C=0;C<9;C++)w+=parseInt(f.slice(C,C+1),10)*(10-C);return w%=11,w<2&&v===w||w>=2&&v===11-w},IT:function(f){return f.length!==9||f==="CA00000AA"?!1:f.search(/C[A-Z]\d{5}[A-Z]{2}/i)>-1},NO:function(f){var v=f.trim();if(isNaN(Number(v))||v.length!==11||v==="00000000000")return!1;var w=v.split("").map(Number),C=(11-(3*w[0]+7*w[1]+6*w[2]+1*w[3]+8*w[4]+9*w[5]+4*w[6]+5*w[7]+2*w[8])%11)%11,M=(11-(5*w[0]+4*w[1]+3*w[2]+2*w[3]+7*w[4]+6*w[5]+5*w[6]+4*w[7]+3*w[8]+2*C)%11)%11;return!(C!==w[9]||M!==w[10])},TH:function(f){if(!f.match(/^[1-8]\d{12}$/))return!1;for(var v=0,w=0;w<12;w++)v+=parseInt(f[w],10)*(13-w);return f[12]===((11-v%11)%10).toString()},LK:function(f){var v=/^[1-9]\d{8}[vx]$/i,w=/^[1-9]\d{11}$/i;return f.length===10&&v.test(f)?!0:!!(f.length===12&&w.test(f))},"he-IL":function(f){var v=/^\d{9}$/,w=f.trim();if(!v.test(w))return!1;for(var C=w,M=0,F,N=0;N<C.length;N++)F=Number(C[N])*(N%2+1),M+=F>9?F-9:F;return M%10===0},"ar-LY":function(f){var v=/^(1|2)\d{11}$/,w=f.trim();return!!v.test(w)},"ar-TN":function(f){var v=/^\d{8}$/,w=f.trim();return!!v.test(w)},"zh-CN":function(f){var v=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","71","81","82","91"],w=["7","9","10","5","8","4","2","1","6","3","7","9","10","5","8","4","2"],C=["1","0","X","9","8","7","6","5","4","3","2"],M=function(q){return v.includes(q)},F=function(q){var le=parseInt(q.substring(0,4),10),ce=parseInt(q.substring(4,6),10),ae=parseInt(q.substring(6),10),pe=new Date(le,ce-1,ae);return pe>new Date?!1:pe.getFullYear()===le&&pe.getMonth()===ce-1&&pe.getDate()===ae},N=function(q){for(var le=q.substring(0,17),ce=0,ae=0;ae<17;ae++)ce+=parseInt(le.charAt(ae),10)*parseInt(w[ae],10);var pe=ce%11;return C[pe]},z=function(q){return N(q)===q.charAt(17).toUpperCase()},L=function(q){var le=/^[1-9]\d{7}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}$/.test(q);if(!le)return!1;var ce=q.substring(0,2);if(le=M(ce),!le)return!1;var ae="19".concat(q.substring(6,12));return le=F(ae),!!le},P=function(q){var le=/^[1-9]\d{5}[1-9]\d{3}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}(\d|x|X)$/.test(q);if(!le)return!1;var ce=q.substring(0,2);if(le=M(ce),!le)return!1;var ae=q.substring(6,14);return le=F(ae),le?z(q):!1},H=function(q){var le=/^\d{15}|(\d{17}(\d|x|X))$/.test(q);return le?q.length===15?L(q):P(q):!1};return H(f)},"zh-HK":function(f){f=f.trim();var v=/^[A-Z]{1,2}[0-9]{6}((\([0-9A]\))|(\[[0-9A]\])|([0-9A]))$/,w=/^[0-9]$/;if(f=f.toUpperCase(),!v.test(f))return!1;f=f.replace(/\[|\]|\(|\)/g,""),f.length===8&&(f="3".concat(f));for(var C=0,M=0;M<=7;M++){var F=void 0;w.test(f[M])?F=f[M]:F=(f[M].charCodeAt(0)-55)%11,C+=F*(9-M)}C%=11;var N;return C===0?N="0":C===1?N="A":N=String(11-C),N===f[f.length-1]},"zh-TW":function(f){var v={A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:34,J:18,K:19,L:20,M:21,N:22,O:35,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,W:32,X:30,Y:31,Z:33},w=f.trim().toUpperCase();return/^[A-Z][0-9]{9}$/.test(w)?Array.from(w).reduce(function(C,M,F){if(F===0){var N=v[M];return N%10*9+Math.floor(N/10)}return F===9?(10-C%10-Number(M))%10===0:C+Number(M)*(9-F)},0):!1}};function c(s,f){if((0,n.default)(s),f in o)return o[f](s);if(f==="any"){for(var v in o)if(o.hasOwnProperty(v)){var w=o[v];if(w(s))return!0}return!1}throw new Error("Invalid locale '".concat(f,"'"))}t.exports=e.default,t.exports.default=e.default})(ek,ek.exports);var zSe=ek.exports,tk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=v;var n=i(ti);function i(w){return w&&w.__esModule?w:{default:w}}var r=8,o=14,c=/^(\d{8}|\d{13}|\d{14})$/;function s(w,C){return w===r||w===o?C%2===0?3:1:C%2===0?1:3}function f(w){var C=w.slice(0,-1).split("").map(function(F,N){return Number(F)*s(w.length,N)}).reduce(function(F,N){return F+N},0),M=10-C%10;return M<10?M:0}function v(w){(0,n.default)(w);var C=Number(w.slice(-1));return c.test(w)&&C===f(w)}t.exports=e.default,t.exports.default=e.default})(tk,tk.exports);var USe=tk.exports,nk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[A-Z]{2}[0-9A-Z]{9}[0-9]$/;function o(c){if((0,n.default)(c),!r.test(c))return!1;for(var s=!0,f=0,v=c.length-2;v>=0;v--)if(c[v]>="A"&&c[v]<="Z")for(var w=c[v].charCodeAt(0)-55,C=w%10,M=Math.trunc(w/10),F=0,N=[C,M];F<N.length;F++){var z=N[F];s?z>=5?f+=1+(z-5)*2:f+=z*2:f+=z,s=!s}else{var L=c[v].charCodeAt(0)-48;s?L>=5?f+=1+(L-5)*2:f+=L*2:f+=L,s=!s}var P=Math.trunc((f+9)/10)*10-f;return+c[c.length-1]===P}t.exports=e.default,t.exports.default=e.default})(nk,nk.exports);var VSe=nk.exports,ik={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=i(ti);function i(f){return f&&f.__esModule?f:{default:f}}var r=/^(?:[0-9]{9}X|[0-9]{10})$/,o=/^(?:[0-9]{13})$/,c=[1,3];function s(f,v){(0,n.default)(f);var w=String((v==null?void 0:v.version)||v);if(!(v!=null&&v.version||v))return s(f,{version:10})||s(f,{version:13});var C=f.replace(/[\s-]+/g,""),M=0;if(w==="10"){if(!r.test(C))return!1;for(var F=0;F<w-1;F++)M+=(F+1)*C.charAt(F);if(C.charAt(9)==="X"?M+=10*10:M+=10*C.charAt(9),M%11===0)return!0}else if(w==="13"){if(!o.test(C))return!1;for(var N=0;N<12;N++)M+=c[N%2]*C.charAt(N);if(C.charAt(12)-(10-M%10)%10===0)return!0}return!1}t.exports=e.default,t.exports.default=e.default})(ik,ik.exports);var GSe=ik.exports,rk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r="^\\d{4}-?\\d{3}[\\dX]$";function o(c){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,n.default)(c);var f=r;if(f=s.require_hyphen?f.replace("?",""):f,f=s.case_sensitive?new RegExp(f):new RegExp(f,"i"),!f.test(c))return!1;for(var v=c.replace("-","").toUpperCase(),w=0,C=0;C<v.length;C++){var M=v[C];w+=(M==="X"?10:+M)*(8-C)}return w%11===0}t.exports=e.default,t.exports.default=e.default})(rk,rk.exports);var HSe=rk.exports,sk={exports:{}},V_={};Object.defineProperty(V_,"__esModule",{value:!0});V_.iso7064Check=WSe;V_.luhnCheck=jSe;V_.reverseMultiplyAndSum=$Se;V_.verhoeffCheck=qSe;function WSe(t){for(var e=10,n=0;n<t.length-1;n++)e=(parseInt(t[n],10)+e)%10===0?10*2%11:(parseInt(t[n],10)+e)%10*2%11;return e=e===1?0:11-e,e===parseInt(t[10],10)}function jSe(t){for(var e=0,n=!1,i=t.length-1;i>=0;i--){if(n){var r=parseInt(t[i],10)*2;r>9?e+=r.toString().split("").map(function(o){return parseInt(o,10)}).reduce(function(o,c){return o+c},0):e+=r}else e+=parseInt(t[i],10);n=!n}return e%10===0}function $Se(t,e){for(var n=0,i=0;i<t.length;i++)n+=t[i]*(e-i);return n}function qSe(t){for(var e=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],n=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],i=t.split("").reverse().join(""),r=0,o=0;o<i.length;o++)r=e[r][n[o%8][parseInt(i[o],10)]];return r===0}(function(t,e){function n(xe){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Se){return typeof Se}:function(Se){return Se&&typeof Symbol=="function"&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se},n(xe)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=tn;var i=f(ti),r=s(V_),o=f(jX);function c(xe){if(typeof WeakMap!="function")return null;var Se=new WeakMap,it=new WeakMap;return(c=function(Pe){return Pe?it:Se})(xe)}function s(xe,Se){if(xe&&xe.__esModule)return xe;if(xe===null||n(xe)!="object"&&typeof xe!="function")return{default:xe};var it=c(Se);if(it&&it.has(xe))return it.get(xe);var Le={__proto__:null},Pe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var vt in xe)if(vt!=="default"&&{}.hasOwnProperty.call(xe,vt)){var yt=Pe?Object.getOwnPropertyDescriptor(xe,vt):null;yt&&(yt.get||yt.set)?Object.defineProperty(Le,vt,yt):Le[vt]=xe[vt]}return Le.default=xe,it&&it.set(xe,Le),Le}function f(xe){return xe&&xe.__esModule?xe:{default:xe}}function v(xe){return F(xe)||M(xe)||C(xe)||w()}function w(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C(xe,Se){if(xe){if(typeof xe=="string")return N(xe,Se);var it=Object.prototype.toString.call(xe).slice(8,-1);if(it==="Object"&&xe.constructor&&(it=xe.constructor.name),it==="Map"||it==="Set")return Array.from(xe);if(it==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(it))return N(xe,Se)}}function M(xe){if(typeof Symbol<"u"&&xe[Symbol.iterator]!=null||xe["@@iterator"]!=null)return Array.from(xe)}function F(xe){if(Array.isArray(xe))return N(xe)}function N(xe,Se){(Se==null||Se>xe.length)&&(Se=xe.length);for(var it=0,Le=new Array(Se);it<Se;it++)Le[it]=xe[it];return Le}function z(xe){var Se=xe.slice(0,2),it=parseInt(xe.slice(2,4),10);it>40?(it-=40,Se="20".concat(Se)):it>20?(it-=20,Se="18".concat(Se)):Se="19".concat(Se),it<10&&(it="0".concat(it));var Le="".concat(Se,"/").concat(it,"/").concat(xe.slice(4,6));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1;for(var Pe=xe.split("").map(function(jt){return parseInt(jt,10)}),vt=[2,4,8,5,10,9,7,3,6],yt=0,nn=0;nn<vt.length;nn++)yt+=Pe[nn]*vt[nn];return yt=yt%11===10?0:yt%11,yt===Pe[9]}function L(xe){var Se=xe.split(""),it=Se.filter(function(Pe,vt){return vt%2}).map(function(Pe){return Number(Pe)*2}).join("").split(""),Le=Se.filter(function(Pe,vt){return!(vt%2)}).concat(it).map(function(Pe){return Number(Pe)}).reduce(function(Pe,vt){return Pe+vt});return Le%10===0}function P(xe){xe=xe.replace(/\W/,"");var Se=parseInt(xe.slice(0,2),10);if(xe.length===10)Se<54?Se="20".concat(Se):Se="19".concat(Se);else{if(xe.slice(6)==="000")return!1;if(Se<54)Se="19".concat(Se);else return!1}Se.length===3&&(Se=[Se.slice(0,2),"0",Se.slice(2)].join(""));var it=parseInt(xe.slice(2,4),10);if(it>50&&(it-=50),it>20){if(parseInt(Se,10)<2004)return!1;it-=20}it<10&&(it="0".concat(it));var Le="".concat(Se,"/").concat(it,"/").concat(xe.slice(4,6));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1;if(xe.length===10&&parseInt(xe,10)%11!==0){var Pe=parseInt(xe.slice(0,9),10)%11;if(parseInt(Se,10)<1986&&Pe===10){if(parseInt(xe.slice(9),10)!==0)return!1}else return!1}return!0}function H(xe){return r.luhnCheck(xe)}function j(xe){for(var Se=xe.split("").map(function(jt){return parseInt(jt,10)}),it=[],Le=0;Le<Se.length-1;Le++){it.push("");for(var Pe=0;Pe<Se.length-1;Pe++)Se[Le]===Se[Pe]&&(it[Le]+=Pe)}if(it=it.filter(function(jt){return jt.length>1}),it.length!==2&&it.length!==3)return!1;if(it[0].length===3){for(var vt=it[0].split("").map(function(jt){return parseInt(jt,10)}),yt=0,nn=0;nn<vt.length-1;nn++)vt[nn]+1===vt[nn+1]&&(yt+=1);if(yt===2)return!1}return r.iso7064Check(xe)}function q(xe){xe=xe.replace(/\W/,"");var Se=parseInt(xe.slice(4,6),10),it=xe.slice(6,7);switch(it){case"0":case"1":case"2":case"3":Se="19".concat(Se);break;case"4":case"9":Se<37?Se="20".concat(Se):Se="19".concat(Se);break;default:if(Se<37)Se="20".concat(Se);else if(Se>58)Se="18".concat(Se);else return!1;break}Se.length===3&&(Se=[Se.slice(0,2),"0",Se.slice(2)].join(""));var Le="".concat(Se,"/").concat(xe.slice(2,4),"/").concat(xe.slice(0,2));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1;for(var Pe=xe.split("").map(function(jt){return parseInt(jt,10)}),vt=0,yt=4,nn=0;nn<9;nn++)vt+=Pe[nn]*yt,yt-=1,yt===1&&(yt=7);return vt%=11,vt===1?!1:vt===0?Pe[9]===0:Pe[9]===11-vt}function le(xe){for(var Se=xe.slice(0,8).split("").map(function(vt){return parseInt(vt,10)}),it=0,Le=1;Le<Se.length;Le+=2)it+=Se[Le];for(var Pe=0;Pe<Se.length;Pe+=2)Se[Pe]<2?it+=1-Se[Pe]:(it+=2*(Se[Pe]-2)+5,Se[Pe]>4&&(it+=2));return String.fromCharCode(it%26+65)===xe.charAt(8)}function ce(xe){for(var Se=xe.split("").map(function(Pe){return parseInt(Pe,10)}),it=0,Le=0;Le<8;Le++)it+=Se[Le]*Math.pow(2,8-Le);return it%11%10===Se[8]}function ae(xe){var Se=r.reverseMultiplyAndSum(xe.split("").slice(0,7).map(function(it){return parseInt(it,10)}),8);return xe.length===9&&xe[8]!=="W"&&(Se+=(xe[8].charCodeAt(0)-64)*9),Se%=23,Se===0?xe[7].toUpperCase()==="W":xe[7].toUpperCase()===String.fromCharCode(64+Se)}var pe={andover:["10","12"],atlanta:["60","67"],austin:["50","53"],brookhaven:["01","02","03","04","05","06","11","13","14","16","21","22","23","25","34","51","52","54","55","56","57","58","59","65"],cincinnati:["30","32","35","36","37","38","61"],fresno:["15","24"],internet:["20","26","27","45","46","47"],kansas:["40","44"],memphis:["94","95"],ogden:["80","90"],philadelphia:["33","39","41","42","43","46","48","62","63","64","66","68","71","72","73","74","75","76","77","81","82","83","84","85","86","87","88","91","92","93","98","99"],sba:["31"]};function fe(){var xe=[];for(var Se in pe)pe.hasOwnProperty(Se)&&xe.push.apply(xe,v(pe[Se]));return xe}function ue(xe){return fe().indexOf(xe.slice(0,2))!==-1}function Ee(xe){for(var Se=0,it=xe.split(""),Le=parseInt(it.pop(),10),Pe=0;Pe<it.length;Pe++)Se+=it[9-Pe]*(2+Pe%6);var vt=11-Se%11;return vt===11?vt=0:vt===10&&(vt=9),Le===vt}function We(xe){var Se=xe.toUpperCase().split("");if(isNaN(parseInt(Se[0],10))&&Se.length>1){var it=0;switch(Se[0]){case"Y":it=1;break;case"Z":it=2;break}Se.splice(0,1,it)}else for(;Se.length<9;)Se.unshift(0);var Le=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"];Se=Se.join("");var Pe=parseInt(Se.slice(0,8),10)%23;return Se[8]===Le[Pe]}function rt(xe){var Se=xe.slice(1,3),it=xe.slice(0,1);switch(it){case"1":case"2":Se="18".concat(Se);break;case"3":case"4":Se="19".concat(Se);break;default:Se="20".concat(Se);break}var Le="".concat(Se,"/").concat(xe.slice(3,5),"/").concat(xe.slice(5,7));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1;for(var Pe=xe.split("").map(function(Fn){return parseInt(Fn,10)}),vt=0,yt=1,nn=0;nn<10;nn++)vt+=Pe[nn]*yt,yt+=1,yt===10&&(yt=1);if(vt%11===10){vt=0,yt=3;for(var jt=0;jt<10;jt++)vt+=Pe[jt]*yt,yt+=1,yt===10&&(yt=1);if(vt%11===10)return Pe[10]===0}return vt%11===Pe[10]}function tt(xe){var Se=xe.slice(4,6),it=xe.slice(6,7);switch(it){case"+":Se="18".concat(Se);break;case"-":Se="19".concat(Se);break;default:Se="20".concat(Se);break}var Le="".concat(Se,"/").concat(xe.slice(2,4),"/").concat(xe.slice(0,2));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1;var Pe=parseInt(xe.slice(0,6)+xe.slice(7,10),10)%31;if(Pe<10)return Pe===parseInt(xe.slice(10),10);Pe-=10;var vt=["A","B","C","D","E","F","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y"];return vt[Pe]===xe.slice(10)}function Ye(xe){if(xe.slice(2,4)!=="00"||xe.slice(4,6)!=="00"){var Se="".concat(xe.slice(0,2),"/").concat(xe.slice(2,4),"/").concat(xe.slice(4,6));if(!(0,o.default)(Se,"YY/MM/DD"))return!1}var it=97-parseInt(xe.slice(0,9),10)%97,Le=parseInt(xe.slice(9,11),10);return!(it!==Le&&(it=97-parseInt("2".concat(xe.slice(0,9)),10)%97,it!==Le))}function qe(xe){xe=xe.replace(/\s/g,"");var Se=parseInt(xe.slice(0,10),10)%511,it=parseInt(xe.slice(10,13),10);return Se===it}function ft(xe){var Se="".concat(xe.slice(0,4),"/").concat(xe.slice(4,6),"/").concat(xe.slice(6,8));return!(0,o.default)(Se,"YYYY/MM/DD")||!r.luhnCheck(xe.slice(0,12))?!1:r.verhoeffCheck("".concat(xe.slice(0,11)).concat(xe[12]))}function Me(xe){return r.iso7064Check(xe)}function $e(xe){for(var Se=xe.split("").map(function(Pe){return parseInt(Pe,10)}),it=8,Le=1;Le<9;Le++)it+=Se[Le]*(Le+1);return it%11===Se[9]}function ut(xe){for(var Se=!1,it=!1,Le=0;Le<3;Le++)if(!Se&&/[AEIOU]/.test(xe[Le]))Se=!0;else if(!it&&Se&&xe[Le]==="X")it=!0;else if(Le>0&&(Se&&!it&&!/[AEIOU]/.test(xe[Le])||it&&!/X/.test(xe[Le])))return!1;return!0}function Mt(xe){var Se=xe.toUpperCase().split("");if(!ut(Se.slice(0,3))||!ut(Se.slice(3,6)))return!1;for(var it=[6,7,9,10,12,13,14],Le={L:"0",M:"1",N:"2",P:"3",Q:"4",R:"5",S:"6",T:"7",U:"8",V:"9"},Pe=0,vt=it;Pe<vt.length;Pe++){var yt=vt[Pe];Se[yt]in Le&&Se.splice(yt,1,Le[Se[yt]])}var nn={A:"01",B:"02",C:"03",D:"04",E:"05",H:"06",L:"07",M:"08",P:"09",R:"10",S:"11",T:"12"},jt=nn[Se[8]],Fn=parseInt(Se[9]+Se[10],10);Fn>40&&(Fn-=40),Fn<10&&(Fn="0".concat(Fn));var Bn="".concat(Se[6]).concat(Se[7],"/").concat(jt,"/").concat(Fn);if(!(0,o.default)(Bn,"YY/MM/DD"))return!1;for(var Zn=0,Li=1;Li<Se.length-1;Li+=2){var zn=parseInt(Se[Li],10);isNaN(zn)&&(zn=Se[Li].charCodeAt(0)-65),Zn+=zn}for(var oi={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23,0:1,1:0},gi=0;gi<Se.length-1;gi+=2){var Ti=0;if(Se[gi]in oi)Ti=oi[Se[gi]];else{var pi=parseInt(Se[gi],10);Ti=2*pi+1,pi>4&&(Ti+=2)}Zn+=Ti}return String.fromCharCode(65+Zn%26)===Se[15]}function Gt(xe){xe=xe.replace(/\W/,"");var Se=xe.slice(0,2);if(Se!=="32"){var it=xe.slice(2,4);if(it!=="00"){var Le=xe.slice(4,6);switch(xe[6]){case"0":Le="18".concat(Le);break;case"1":Le="19".concat(Le);break;default:Le="20".concat(Le);break}var Pe="".concat(Le,"/").concat(xe.slice(2,4),"/").concat(Se);if(!(0,o.default)(Pe,"YYYY/MM/DD"))return!1}for(var vt=1101,yt=[1,6,3,7,9,10,5,8,4,2],nn=0;nn<xe.length-1;nn++)vt-=parseInt(xe[nn],10)*yt[nn];return parseInt(xe[10],10)===vt%11}return!0}function Xt(xe){if(xe.length!==9){for(var Se=xe.toUpperCase().split("");Se.length<8;)Se.unshift(0);switch(xe[7]){case"A":case"P":if(parseInt(Se[6],10)===0)return!1;break;default:{var it=parseInt(Se.join("").slice(0,5),10);if(it>32e3)return!1;var Le=parseInt(Se.join("").slice(5,7),10);if(it===Le)return!1}}}return!0}function Qe(xe){return r.reverseMultiplyAndSum(xe.split("").slice(0,8).map(function(Se){return parseInt(Se,10)}),9)%11===parseInt(xe[8],10)}function Ge(xe){if(xe.length===10){for(var Se=[6,5,7,2,3,4,5,6,7],it=0,Le=0;Le<Se.length;Le++)it+=parseInt(xe[Le],10)*Se[Le];return it%=11,it===10?!1:it===parseInt(xe[9],10)}var Pe=xe.slice(0,2),vt=parseInt(xe.slice(2,4),10);vt>80?(Pe="18".concat(Pe),vt-=80):vt>60?(Pe="22".concat(Pe),vt-=60):vt>40?(Pe="21".concat(Pe),vt-=40):vt>20?(Pe="20".concat(Pe),vt-=20):Pe="19".concat(Pe),vt<10&&(vt="0".concat(vt));var yt="".concat(Pe,"/").concat(vt,"/").concat(xe.slice(4,6));if(!(0,o.default)(yt,"YYYY/MM/DD"))return!1;for(var nn=0,jt=1,Fn=0;Fn<xe.length-1;Fn++)nn+=parseInt(xe[Fn],10)*jt%10,jt+=2,jt>10?jt=1:jt===5&&(jt+=2);return nn=10-nn%10,nn===parseInt(xe[10],10)}function He(xe){if(xe.length===11){var Se,it;if(Se=0,xe==="11111111111"||xe==="22222222222"||xe==="33333333333"||xe==="44444444444"||xe==="55555555555"||xe==="66666666666"||xe==="77777777777"||xe==="88888888888"||xe==="99999999999"||xe==="00000000000")return!1;for(var Le=1;Le<=9;Le++)Se+=parseInt(xe.substring(Le-1,Le),10)*(11-Le);if(it=Se*10%11,it===10&&(it=0),it!==parseInt(xe.substring(9,10),10))return!1;Se=0;for(var Pe=1;Pe<=10;Pe++)Se+=parseInt(xe.substring(Pe-1,Pe),10)*(12-Pe);return it=Se*10%11,it===10&&(it=0),it===parseInt(xe.substring(10,11),10)}if(xe==="00000000000000"||xe==="11111111111111"||xe==="22222222222222"||xe==="33333333333333"||xe==="44444444444444"||xe==="55555555555555"||xe==="66666666666666"||xe==="77777777777777"||xe==="88888888888888"||xe==="99999999999999")return!1;for(var vt=xe.length-2,yt=xe.substring(0,vt),nn=xe.substring(vt),jt=0,Fn=vt-7,Bn=vt;Bn>=1;Bn--)jt+=yt.charAt(vt-Bn)*Fn,Fn-=1,Fn<2&&(Fn=9);var Zn=jt%11<2?0:11-jt%11;if(Zn!==parseInt(nn.charAt(0),10))return!1;vt+=1,yt=xe.substring(0,vt),jt=0,Fn=vt-7;for(var Li=vt;Li>=1;Li--)jt+=yt.charAt(vt-Li)*Fn,Fn-=1,Fn<2&&(Fn=9);return Zn=jt%11<2?0:11-jt%11,Zn===parseInt(nn.charAt(1),10)}function De(xe){var Se=11-r.reverseMultiplyAndSum(xe.split("").slice(0,8).map(function(it){return parseInt(it,10)}),9)%11;return Se>9?parseInt(xe[8],10)===0:Se===parseInt(xe[8],10)}function kt(xe){if(xe.slice(0,4)!=="9000"){var Se=xe.slice(1,3);switch(xe[0]){case"1":case"2":Se="19".concat(Se);break;case"3":case"4":Se="18".concat(Se);break;case"5":case"6":Se="20".concat(Se);break}var it="".concat(Se,"/").concat(xe.slice(3,5),"/").concat(xe.slice(5,7));if(it.length===8){if(!(0,o.default)(it,"YY/MM/DD"))return!1}else if(!(0,o.default)(it,"YYYY/MM/DD"))return!1;for(var Le=xe.split("").map(function(nn){return parseInt(nn,10)}),Pe=[2,7,9,1,4,6,3,5,8,2,7,9],vt=0,yt=0;yt<Pe.length;yt++)vt+=Le[yt]*Pe[yt];return vt%11===10?Le[12]===1:Le[12]===vt%11}return!0}function rn(xe){if(xe.length===9){if(xe=xe.replace(/\W/,""),xe.slice(6)==="000")return!1;var Se=parseInt(xe.slice(0,2),10);if(Se>53)return!1;Se<10?Se="190".concat(Se):Se="19".concat(Se);var it=parseInt(xe.slice(2,4),10);it>50&&(it-=50),it<10&&(it="0".concat(it));var Le="".concat(Se,"/").concat(it,"/").concat(xe.slice(4,6));if(!(0,o.default)(Le,"YYYY/MM/DD"))return!1}return!0}function Re(xe){var Se=11-r.reverseMultiplyAndSum(xe.split("").slice(0,7).map(function(it){return parseInt(it,10)}),8)%11;return Se===10?parseInt(xe[7],10)===0:Se===parseInt(xe[7],10)}function Kt(xe){var Se=xe.slice(0);xe.length>11&&(Se=Se.slice(2));var it="",Le=Se.slice(2,4),Pe=parseInt(Se.slice(4,6),10);if(xe.length>11)it=xe.slice(0,4);else if(it=xe.slice(0,2),xe.length===11&&Pe<60){var vt=new Date().getFullYear().toString(),yt=parseInt(vt.slice(0,2),10);if(vt=parseInt(vt,10),xe[6]==="-")parseInt("".concat(yt).concat(it),10)>vt?it="".concat(yt-1).concat(it):it="".concat(yt).concat(it);else if(it="".concat(yt-1).concat(it),vt-parseInt(it,10)<100)return!1}Pe>60&&(Pe-=60),Pe<10&&(Pe="0".concat(Pe));var nn="".concat(it,"/").concat(Le,"/").concat(Pe);if(nn.length===8){if(!(0,o.default)(nn,"YY/MM/DD"))return!1}else if(!(0,o.default)(nn,"YYYY/MM/DD"))return!1;return r.luhnCheck(xe.replace(/\W/,""))}function bt(xe){for(var Se=xe.split("").map(function(vt){return parseInt(vt,10)}),it=[-1,5,7,9,4,6,10,5,7],Le=0,Pe=0;Pe<it.length;Pe++)Le+=Se[Pe]*it[Pe];return Le%11===10?Se[9]===0:Se[9]===Le%11}var Dt={"bg-BG":/^\d{10}$/,"cs-CZ":/^\d{6}\/{0,1}\d{3,4}$/,"de-AT":/^\d{9}$/,"de-DE":/^[1-9]\d{10}$/,"dk-DK":/^\d{6}-{0,1}\d{4}$/,"el-CY":/^[09]\d{7}[A-Z]$/,"el-GR":/^([0-4]|[7-9])\d{8}$/,"en-CA":/^\d{9}$/,"en-GB":/^\d{10}$|^(?!GB|NK|TN|ZZ)(?![DFIQUV])[A-Z](?![DFIQUVO])[A-Z]\d{6}[ABCD ]$/i,"en-IE":/^\d{7}[A-W][A-IW]{0,1}$/i,"en-US":/^\d{2}[- ]{0,1}\d{7}$/,"es-AR":/(20|23|24|27|30|33|34)[0-9]{8}[0-9]/,"es-ES":/^(\d{0,8}|[XYZKLM]\d{7})[A-HJ-NP-TV-Z]$/i,"et-EE":/^[1-6]\d{6}(00[1-9]|0[1-9][0-9]|[1-6][0-9]{2}|70[0-9]|710)\d$/,"fi-FI":/^\d{6}[-+A]\d{3}[0-9A-FHJ-NPR-Y]$/i,"fr-BE":/^\d{11}$/,"fr-FR":/^[0-3]\d{12}$|^[0-3]\d\s\d{2}(\s\d{3}){3}$/,"fr-LU":/^\d{13}$/,"hr-HR":/^\d{11}$/,"hu-HU":/^8\d{9}$/,"it-IT":/^[A-Z]{6}[L-NP-V0-9]{2}[A-EHLMPRST][L-NP-V0-9]{2}[A-ILMZ][L-NP-V0-9]{3}[A-Z]$/i,"lv-LV":/^\d{6}-{0,1}\d{5}$/,"mt-MT":/^\d{3,7}[APMGLHBZ]$|^([1-8])\1\d{7}$/i,"nl-NL":/^\d{9}$/,"pl-PL":/^\d{10,11}$/,"pt-BR":/(?:^\d{11}$)|(?:^\d{14}$)/,"pt-PT":/^\d{9}$/,"ro-RO":/^\d{13}$/,"sk-SK":/^\d{6}\/{0,1}\d{3,4}$/,"sl-SI":/^[1-9]\d{7}$/,"sv-SE":/^(\d{6}[-+]{0,1}\d{4}|(18|19|20)\d{6}[-+]{0,1}\d{4})$/,"uk-UA":/^\d{10}$/};Dt["lb-LU"]=Dt["fr-LU"],Dt["lt-LT"]=Dt["et-EE"],Dt["nl-BE"]=Dt["fr-BE"],Dt["fr-CA"]=Dt["en-CA"];var _e={"bg-BG":z,"cs-CZ":P,"de-AT":H,"de-DE":j,"dk-DK":q,"el-CY":le,"el-GR":ce,"en-CA":L,"en-IE":ae,"en-US":ue,"es-AR":Ee,"es-ES":We,"et-EE":rt,"fi-FI":tt,"fr-BE":Ye,"fr-FR":qe,"fr-LU":ft,"hr-HR":Me,"hu-HU":$e,"it-IT":Mt,"lv-LV":Gt,"mt-MT":Xt,"nl-NL":Qe,"pl-PL":Ge,"pt-BR":He,"pt-PT":De,"ro-RO":kt,"sk-SK":rn,"sl-SI":Re,"sv-SE":Kt,"uk-UA":bt};_e["lb-LU"]=_e["fr-LU"],_e["lt-LT"]=_e["et-EE"],_e["nl-BE"]=_e["fr-BE"],_e["fr-CA"]=_e["en-CA"];var At=/[-\\\/!@#$%\^&\*\(\)\+\=\[\]]+/g,Ot={"de-AT":At,"de-DE":/[\/\\]/g,"fr-BE":At};Ot["nl-BE"]=Ot["fr-BE"];function tn(xe){var Se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US";(0,i.default)(xe);var it=xe.slice(0);if(Se in Dt)return Se in Ot&&(it=it.replace(Ot[Se],"")),Dt[Se].test(it)?Se in _e?_e[Se](it):!0:!1;throw new Error("Invalid locale '".concat(Se,"'"))}t.exports=e.default,t.exports.default=e.default})(sk,sk.exports);var ZSe=sk.exports,JS={};Object.defineProperty(JS,"__esModule",{value:!0});JS.default=YSe;JS.locales=void 0;var XSe=KSe(ti);function KSe(t){return t&&t.__esModule?t:{default:t}}var yo={"am-AM":/^(\+?374|0)(33|4[134]|55|77|88|9[13-689])\d{6}$/,"ar-AE":/^((\+?971)|0)?5[024568]\d{7}$/,"ar-BH":/^(\+?973)?(3|6)\d{7}$/,"ar-DZ":/^(\+?213|0)(5|6|7)\d{8}$/,"ar-LB":/^(\+?961)?((3|81)\d{6}|7\d{7})$/,"ar-EG":/^((\+?20)|0)?1[0125]\d{8}$/,"ar-IQ":/^(\+?964|0)?7[0-9]\d{8}$/,"ar-JO":/^(\+?962|0)?7[789]\d{7}$/,"ar-KW":/^(\+?965)([569]\d{7}|41\d{6})$/,"ar-LY":/^((\+?218)|0)?(9[1-6]\d{7}|[1-8]\d{7,9})$/,"ar-MA":/^(?:(?:\+|00)212|0)[5-7]\d{8}$/,"ar-OM":/^((\+|00)968)?(9[1-9])\d{6}$/,"ar-PS":/^(\+?970|0)5[6|9](\d{7})$/,"ar-SA":/^(!?(\+?966)|0)?5\d{8}$/,"ar-SD":/^((\+?249)|0)?(9[012369]|1[012])\d{7}$/,"ar-SY":/^(!?(\+?963)|0)?9\d{8}$/,"ar-TN":/^(\+?216)?[2459]\d{7}$/,"az-AZ":/^(\+994|0)(10|5[015]|7[07]|99)\d{7}$/,"bs-BA":/^((((\+|00)3876)|06))((([0-3]|[5-6])\d{6})|(4\d{7}))$/,"be-BY":/^(\+?375)?(24|25|29|33|44)\d{7}$/,"bg-BG":/^(\+?359|0)?8[789]\d{7}$/,"bn-BD":/^(\+?880|0)1[13456789][0-9]{8}$/,"ca-AD":/^(\+376)?[346]\d{5}$/,"cs-CZ":/^(\+?420)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"da-DK":/^(\+?45)?\s?\d{2}\s?\d{2}\s?\d{2}\s?\d{2}$/,"de-DE":/^((\+49|0)1)(5[0-25-9]\d|6([23]|0\d?)|7([0-57-9]|6\d))\d{7,9}$/,"de-AT":/^(\+43|0)\d{1,4}\d{3,12}$/,"de-CH":/^(\+41|0)([1-9])\d{1,9}$/,"de-LU":/^(\+352)?((6\d1)\d{6})$/,"dv-MV":/^(\+?960)?(7[2-9]|9[1-9])\d{5}$/,"el-GR":/^(\+?30|0)?6(8[5-9]|9(?![26])[0-9])\d{7}$/,"el-CY":/^(\+?357?)?(9(9|6)\d{6})$/,"en-AI":/^(\+?1|0)264(?:2(35|92)|4(?:6[1-2]|76|97)|5(?:3[6-9]|8[1-4])|7(?:2(4|9)|72))\d{4}$/,"en-AU":/^(\+?61|0)4\d{8}$/,"en-AG":/^(?:\+1|1)268(?:464|7(?:1[3-9]|[28]\d|3[0246]|64|7[0-689]))\d{4}$/,"en-BM":/^(\+?1)?441(((3|7)\d{6}$)|(5[0-3][0-9]\d{4}$)|(59\d{5}$))/,"en-BS":/^(\+?1[-\s]?|0)?\(?242\)?[-\s]?\d{3}[-\s]?\d{4}$/,"en-GB":/^(\+?44|0)7\d{9}$/,"en-GG":/^(\+?44|0)1481\d{6}$/,"en-GH":/^(\+233|0)(20|50|24|54|27|57|26|56|23|28|55|59)\d{7}$/,"en-GY":/^(\+592|0)6\d{6}$/,"en-HK":/^(\+?852[-\s]?)?[456789]\d{3}[-\s]?\d{4}$/,"en-MO":/^(\+?853[-\s]?)?[6]\d{3}[-\s]?\d{4}$/,"en-IE":/^(\+?353|0)8[356789]\d{7}$/,"en-IN":/^(\+?91|0)?[6789]\d{9}$/,"en-JM":/^(\+?876)?\d{7}$/,"en-KE":/^(\+?254|0)(7|1)\d{8}$/,"fr-CF":/^(\+?236| ?)(70|75|77|72|21|22)\d{6}$/,"en-SS":/^(\+?211|0)(9[1257])\d{7}$/,"en-KI":/^((\+686|686)?)?( )?((6|7)(2|3|8)[0-9]{6})$/,"en-KN":/^(?:\+1|1)869(?:46\d|48[89]|55[6-8]|66\d|76[02-7])\d{4}$/,"en-LS":/^(\+?266)(22|28|57|58|59|27|52)\d{6}$/,"en-MT":/^(\+?356|0)?(99|79|77|21|27|22|25)[0-9]{6}$/,"en-MU":/^(\+?230|0)?\d{8}$/,"en-MW":/^(\+?265|0)(((77|88|31|99|98|21)\d{7})|(((111)|1)\d{6})|(32000\d{4}))$/,"en-NA":/^(\+?264|0)(6|8)\d{7}$/,"en-NG":/^(\+?234|0)?[789]\d{9}$/,"en-NZ":/^(\+?64|0)[28]\d{7,9}$/,"en-PG":/^(\+?675|0)?(7\d|8[18])\d{6}$/,"en-PK":/^((00|\+)?92|0)3[0-6]\d{8}$/,"en-PH":/^(09|\+639)\d{9}$/,"en-RW":/^(\+?250|0)?[7]\d{8}$/,"en-SG":/^(\+65)?[3689]\d{7}$/,"en-SL":/^(\+?232|0)\d{8}$/,"en-TZ":/^(\+?255|0)?[67]\d{8}$/,"en-UG":/^(\+?256|0)?[7]\d{8}$/,"en-US":/^((\+1|1)?( |-)?)?(\([2-9][0-9]{2}\)|[2-9][0-9]{2})( |-)?([2-9][0-9]{2}( |-)?[0-9]{4})$/,"en-ZA":/^(\+?27|0)\d{9}$/,"en-ZM":/^(\+?26)?09[567]\d{7}$/,"en-ZW":/^(\+263)[0-9]{9}$/,"en-BW":/^(\+?267)?(7[1-8]{1})\d{6}$/,"es-AR":/^\+?549(11|[2368]\d)\d{8}$/,"es-BO":/^(\+?591)?(6|7)\d{7}$/,"es-CO":/^(\+?57)?3(0(0|1|2|4|5)|1\d|2[0-4]|5(0|1))\d{7}$/,"es-CL":/^(\+?56|0)[2-9]\d{1}\d{7}$/,"es-CR":/^(\+506)?[2-8]\d{7}$/,"es-CU":/^(\+53|0053)?5\d{7}$/,"es-DO":/^(\+?1)?8[024]9\d{7}$/,"es-HN":/^(\+?504)?[9|8|3|2]\d{7}$/,"es-EC":/^(\+?593|0)([2-7]|9[2-9])\d{7}$/,"es-ES":/^(\+?34)?[6|7]\d{8}$/,"es-PE":/^(\+?51)?9\d{8}$/,"es-MX":/^(\+?52)?(1|01)?\d{10,11}$/,"es-NI":/^(\+?505)\d{7,8}$/,"es-PA":/^(\+?507)\d{7,8}$/,"es-PY":/^(\+?595|0)9[9876]\d{7}$/,"es-SV":/^(\+?503)?[67]\d{7}$/,"es-UY":/^(\+598|0)9[1-9][\d]{6}$/,"es-VE":/^(\+?58)?(2|4)\d{9}$/,"et-EE":/^(\+?372)?\s?(5|8[1-4])\s?([0-9]\s?){6,7}$/,"fa-IR":/^(\+?98[\-\s]?|0)9[0-39]\d[\-\s]?\d{3}[\-\s]?\d{4}$/,"fi-FI":/^(\+?358|0)\s?(4[0-6]|50)\s?(\d\s?){4,8}$/,"fj-FJ":/^(\+?679)?\s?\d{3}\s?\d{4}$/,"fo-FO":/^(\+?298)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"fr-BF":/^(\+226|0)[67]\d{7}$/,"fr-BJ":/^(\+229)\d{8}$/,"fr-CD":/^(\+?243|0)?(8|9)\d{8}$/,"fr-CM":/^(\+?237)6[0-9]{8}$/,"fr-FR":/^(\+?33|0)[67]\d{8}$/,"fr-GF":/^(\+?594|0|00594)[67]\d{8}$/,"fr-GP":/^(\+?590|0|00590)[67]\d{8}$/,"fr-MQ":/^(\+?596|0|00596)[67]\d{8}$/,"fr-PF":/^(\+?689)?8[789]\d{6}$/,"fr-RE":/^(\+?262|0|00262)[67]\d{8}$/,"fr-WF":/^(\+681)?\d{6}$/,"he-IL":/^(\+972|0)([23489]|5[012345689]|77)[1-9]\d{6}$/,"hu-HU":/^(\+?36|06)(20|30|31|50|70)\d{7}$/,"id-ID":/^(\+?62|0)8(1[123456789]|2[1238]|3[1238]|5[12356789]|7[78]|9[56789]|8[123456789])([\s?|\d]{5,11})$/,"ir-IR":/^(\+98|0)?9\d{9}$/,"it-IT":/^(\+?39)?\s?3\d{2} ?\d{6,7}$/,"it-SM":/^((\+378)|(0549)|(\+390549)|(\+3780549))?6\d{5,9}$/,"ja-JP":/^(\+81[ \-]?(\(0\))?|0)[6789]0[ \-]?\d{4}[ \-]?\d{4}$/,"ka-GE":/^(\+?995)?(79\d{7}|5\d{8})$/,"kk-KZ":/^(\+?7|8)?7\d{9}$/,"kl-GL":/^(\+?299)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"ko-KR":/^((\+?82)[ \-]?)?0?1([0|1|6|7|8|9]{1})[ \-]?\d{3,4}[ \-]?\d{4}$/,"ky-KG":/^(\+?7\s?\+?7|0)\s?\d{2}\s?\d{3}\s?\d{4}$/,"lt-LT":/^(\+370|8)\d{8}$/,"lv-LV":/^(\+?371)2\d{7}$/,"mg-MG":/^((\+?261|0)(2|3)\d)?\d{7}$/,"mn-MN":/^(\+|00|011)?976(77|81|88|91|94|95|96|99)\d{6}$/,"my-MM":/^(\+?959|09|9)(2[5-7]|3[1-2]|4[0-5]|6[6-9]|7[5-9]|9[6-9])[0-9]{7}$/,"ms-MY":/^(\+?60|0)1(([0145](-|\s)?\d{7,8})|([236-9](-|\s)?\d{7}))$/,"mz-MZ":/^(\+?258)?8[234567]\d{7}$/,"nb-NO":/^(\+?47)?[49]\d{7}$/,"ne-NP":/^(\+?977)?9[78]\d{8}$/,"nl-BE":/^(\+?32|0)4\d{8}$/,"nl-NL":/^(((\+|00)?31\(0\))|((\+|00)?31)|0)6{1}\d{8}$/,"nl-AW":/^(\+)?297(56|59|64|73|74|99)\d{5}$/,"nn-NO":/^(\+?47)?[49]\d{7}$/,"pl-PL":/^(\+?48)? ?([5-8]\d|45) ?\d{3} ?\d{2} ?\d{2}$/,"pt-BR":/^((\+?55\ ?[1-9]{2}\ ?)|(\+?55\ ?\([1-9]{2}\)\ ?)|(0[1-9]{2}\ ?)|(\([1-9]{2}\)\ ?)|([1-9]{2}\ ?))((\d{4}\-?\d{4})|(9[1-9]{1}\d{3}\-?\d{4}))$/,"pt-PT":/^(\+?351)?9[1236]\d{7}$/,"pt-AO":/^(\+244)\d{9}$/,"ro-MD":/^(\+?373|0)((6(0|1|2|6|7|8|9))|(7(6|7|8|9)))\d{6}$/,"ro-RO":/^(\+?40|0)\s?7\d{2}(\/|\s|\.|-)?\d{3}(\s|\.|-)?\d{3}$/,"ru-RU":/^(\+?7|8)?9\d{9}$/,"si-LK":/^(?:0|94|\+94)?(7(0|1|2|4|5|6|7|8)( |-)?)\d{7}$/,"sl-SI":/^(\+386\s?|0)(\d{1}\s?\d{3}\s?\d{2}\s?\d{2}|\d{2}\s?\d{3}\s?\d{3})$/,"sk-SK":/^(\+?421)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"so-SO":/^(\+?252|0)((6[0-9])\d{7}|(7[1-9])\d{7})$/,"sq-AL":/^(\+355|0)6[789]\d{6}$/,"sr-RS":/^(\+3816|06)[- \d]{5,9}$/,"sv-SE":/^(\+?46|0)[\s\-]?7[\s\-]?[02369]([\s\-]?\d){7}$/,"tg-TJ":/^(\+?992)?[5][5]\d{7}$/,"th-TH":/^(\+66|66|0)\d{9}$/,"tr-TR":/^(\+?90|0)?5\d{9}$/,"tk-TM":/^(\+993|993|8)\d{8}$/,"uk-UA":/^(\+?38|8)?0\d{9}$/,"uz-UZ":/^(\+?998)?(6[125-79]|7[1-69]|88|9\d)\d{7}$/,"vi-VN":/^((\+?84)|0)((3([2-9]))|(5([25689]))|(7([0|6-9]))|(8([1-9]))|(9([0-9])))([0-9]{7})$/,"zh-CN":/^((\+|00)86)?(1[3-9]|9[28])\d{9}$/,"zh-TW":/^(\+?886\-?|0)?9\d{8}$/,"dz-BT":/^(\+?975|0)?(17|16|77|02)\d{6}$/,"ar-YE":/^(((\+|00)9677|0?7)[0137]\d{7}|((\+|00)967|0)[1-7]\d{6})$/,"ar-EH":/^(\+?212|0)[\s\-]?(5288|5289)[\s\-]?\d{5}$/,"fa-AF":/^(\+93|0)?(2{1}[0-8]{1}|[3-5]{1}[0-4]{1})(\d{7})$/};yo["en-CA"]=yo["en-US"];yo["fr-CA"]=yo["en-CA"];yo["fr-BE"]=yo["nl-BE"];yo["zh-HK"]=yo["en-HK"];yo["zh-MO"]=yo["en-MO"];yo["ga-IE"]=yo["en-IE"];yo["fr-CH"]=yo["de-CH"];yo["it-CH"]=yo["fr-CH"];function YSe(t,e,n){if((0,XSe.default)(t),n&&n.strictMode&&!t.startsWith("+"))return!1;if(Array.isArray(e))return e.some(function(o){if(yo.hasOwnProperty(o)){var c=yo[o];if(c.test(t))return!0}return!1});if(e in yo)return yo[e].test(t);if(!e||e==="any"){for(var i in yo)if(yo.hasOwnProperty(i)){var r=yo[i];if(r.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}JS.locales=Object.keys(yo);var ok={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^(0x)[0-9a-f]{40}$/i;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(ok,ok.exports);var JSe=ok.exports,ak={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=r(oc),i=r(ti);function r(f){return f&&f.__esModule?f:{default:f}}function o(f){var v="\\d{".concat(f.digits_after_decimal[0],"}");f.digits_after_decimal.forEach(function(H,j){j!==0&&(v="".concat(v,"|\\d{").concat(H,"}"))});var w="(".concat(f.symbol.replace(/\W/,function(H){return"\\".concat(H)}),")").concat(f.require_symbol?"":"?"),C="-?",M="[1-9]\\d*",F="[1-9]\\d{0,2}(\\".concat(f.thousands_separator,"\\d{3})*"),N=["0",M,F],z="(".concat(N.join("|"),")?"),L="(\\".concat(f.decimal_separator,"(").concat(v,"))").concat(f.require_decimal?"":"?"),P=z+(f.allow_decimal||f.require_decimal?L:"");return f.allow_negatives&&!f.parens_for_negatives&&(f.negative_sign_after_digits?P+=C:f.negative_sign_before_digits&&(P=C+P)),f.allow_negative_sign_placeholder?P="( (?!\\-))?".concat(P):f.allow_space_after_symbol?P=" ?".concat(P):f.allow_space_after_digits&&(P+="( (?!$))?"),f.symbol_after_digits?P+=w:P=w+P,f.allow_negatives&&(f.parens_for_negatives?P="(\\(".concat(P,"\\)|").concat(P,")"):f.negative_sign_before_digits||f.negative_sign_after_digits||(P=C+P)),new RegExp("^(?!-? )(?=.*\\d)".concat(P,"$"))}var c={symbol:"$",require_symbol:!1,allow_space_after_symbol:!1,symbol_after_digits:!1,allow_negatives:!0,parens_for_negatives:!1,negative_sign_before_digits:!1,negative_sign_after_digits:!1,allow_negative_sign_placeholder:!1,thousands_separator:",",decimal_separator:".",allow_decimal:!0,require_decimal:!1,digits_after_decimal:[2],allow_space_after_digits:!1};function s(f,v){return(0,i.default)(f),v=(0,n.default)(v,c),o(v).test(f)}t.exports=e.default,t.exports.default=e.default})(ak,ak.exports);var QSe=ak.exports,lk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var n=i(ti);function i(s){return s&&s.__esModule?s:{default:s}}var r=/^(bc1)[a-z0-9]{25,39}$/,o=/^(1|3)[A-HJ-NP-Za-km-z1-9]{25,39}$/;function c(s){return(0,n.default)(s),r.test(s)||o.test(s)}t.exports=e.default,t.exports.default=e.default})(lk,lk.exports);var ebe=lk.exports,QS={};Object.defineProperty(QS,"__esModule",{value:!0});QS.isFreightContainerID=void 0;QS.isISO6346=KX;var tbe=nbe(ti);function nbe(t){return t&&t.__esModule?t:{default:t}}var ibe=/^[A-Z]{3}(U[0-9]{7})|([J,Z][0-9]{6,7})$/,rbe=/^[0-9]$/;function KX(t){if((0,tbe.default)(t),t=t.toUpperCase(),!ibe.test(t))return!1;if(t.length===11){for(var e=0,n=0;n<t.length-1;n++)if(rbe.test(t[n]))e+=t[n]*Math.pow(2,n);else{var i=void 0,r=t.charCodeAt(n)-55;r<11?i=r:r>=11&&r<=20?i=12+r%11:r>=21&&r<=30?i=23+r%21:i=34+r%31,e+=i*Math.pow(2,n)}var o=e%11;return Number(t[t.length-1])===o}return!0}QS.isFreightContainerID=KX;var ck={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=new Set(["aa","ab","ae","af","ak","am","an","ar","as","av","ay","az","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","dv","dz","ee","el","en","eo","es","et","eu","fa","ff","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","iu","ja","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lu","lv","mg","mh","mi","mk","ml","mn","mr","ms","mt","my","na","nb","nd","ne","ng","nl","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sc","sd","se","sg","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zu"]);function o(c){return(0,n.default)(c),r.has(c)}t.exports=e.default,t.exports.default=e.default})(ck,ck.exports);var sbe=ck.exports,uk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=i(ti);function i(f){return f&&f.__esModule?f:{default:f}}var r=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,o=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,c=function(v){var w=v.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(w){var C=Number(w[1]),M=Number(w[2]);return C%4===0&&C%100!==0||C%400===0?M<=366:M<=365}var F=v.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),N=F[1],z=F[2],L=F[3],P=z&&"0".concat(z).slice(-2),H=L&&"0".concat(L).slice(-2),j=new Date("".concat(N,"-").concat(P||"01","-").concat(H||"01"));return z&&L?j.getUTCFullYear()===N&&j.getUTCMonth()+1===z&&j.getUTCDate()===L:!0};function s(f){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,n.default)(f);var w=v.strictSeparator?o.test(f):r.test(f);return w&&v.strict?c(f):w}t.exports=e.default,t.exports.default=e.default})(uk,uk.exports);var obe=uk.exports,hk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=P;var n=i(ti);function i(H){return H&&H.__esModule?H:{default:H}}var r=/[0-9]{4}/,o=/(0[1-9]|1[0-2])/,c=/([12]\d|0[1-9]|3[01])/,s=/([01][0-9]|2[0-3])/,f=/[0-5][0-9]/,v=/([0-5][0-9]|60)/,w=/(\.[0-9]+)?/,C=new RegExp("[-+]".concat(s.source,":").concat(f.source)),M=new RegExp("([zZ]|".concat(C.source,")")),F=new RegExp("".concat(s.source,":").concat(f.source,":").concat(v.source).concat(w.source)),N=new RegExp("".concat(r.source,"-").concat(o.source,"-").concat(c.source)),z=new RegExp("".concat(F.source).concat(M.source)),L=new RegExp("^".concat(N.source,"[ tT]").concat(z.source,"$"));function P(H){return(0,n.default)(H),L.test(H)}t.exports=e.default,t.exports.default=e.default})(hk,hk.exports);var abe=hk.exports,dk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=new Set(["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","KHM","CMR","CAN","CPV","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MKD","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWZ","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]);function o(c){return(0,n.default)(c),r.has(c.toUpperCase())}t.exports=e.default,t.exports.default=e.default})(dk,dk.exports);var lbe=dk.exports,eb={};Object.defineProperty(eb,"__esModule",{value:!0});eb.CurrencyCodes=void 0;eb.default=hbe;var cbe=ube(ti);function ube(t){return t&&t.__esModule?t:{default:t}}var YX=new Set(["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BOV","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHE","CHF","CHW","CLF","CLP","CNY","COP","COU","CRC","CUC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLE","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","USN","UYI","UYU","UYW","UZS","VES","VND","VUV","WST","XAF","XAG","XAU","XBA","XBB","XBC","XBD","XCD","XDR","XOF","XPD","XPF","XPT","XSU","XTS","XUA","XXX","YER","ZAR","ZMW","ZWL"]);function hbe(t){return(0,cbe.default)(t),YX.has(t.toUpperCase())}eb.CurrencyCodes=YX;var fk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=f;var n=r(ti),i=r(oc);function r(v){return v&&v.__esModule?v:{default:v}}var o=/^[A-Z2-7]+=*$/,c=/^[A-HJKMNP-TV-Z0-9]+$/,s={crockford:!1};function f(v,w){if((0,n.default)(v),w=(0,i.default)(w,s),w.crockford)return c.test(v);var C=v.length;return!!(C%8===0&&o.test(v))}t.exports=e.default,t.exports.default=e.default})(fk,fk.exports);var dbe=fk.exports,pk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[A-HJ-NP-Za-km-z1-9]*$/;function o(c){return(0,n.default)(c),!!r.test(c)}t.exports=e.default,t.exports.default=e.default})(pk,pk.exports);var fbe=pk.exports,mk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=i(ti);function i(f){return f&&f.__esModule?f:{default:f}}var r=/^[a-z]+\/[a-z0-9\-\+\._]+$/i,o=/^[a-z\-]+=[a-z0-9\-]+$/i,c=/^[a-z0-9!\$&'\(\)\*\+,;=\-\._~:@\/\?%\s]*$/i;function s(f){(0,n.default)(f);var v=f.split(",");if(v.length<2)return!1;var w=v.shift().trim().split(";"),C=w.shift();if(C.slice(0,5)!=="data:")return!1;var M=C.slice(5);if(M!==""&&!r.test(M))return!1;for(var F=0;F<w.length;F++)if(!(F===w.length-1&&w[F].toLowerCase()==="base64")&&!o.test(w[F]))return!1;for(var N=0;N<v.length;N++)if(!c.test(v[N]))return!1;return!0}t.exports=e.default,t.exports.default=e.default})(mk,mk.exports);var pbe=mk.exports,gk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/(?:^magnet:\?|[^?&]&)xt(?:\.1)?=urn:(?:(?:aich|bitprint|btih|ed2k|ed2khash|kzhash|md5|sha1|tree:tiger):[a-z0-9]{32}(?:[a-z0-9]{8})?|btmh:1220[a-z0-9]{64})(?:$|&)/i;function o(c){return(0,n.default)(c),c.indexOf("magnet:?")!==0?!1:r.test(c)}t.exports=e.default,t.exports.default=e.default})(gk,gk.exports);var mbe=gk.exports,vk={exports:{}},yk={exports:{}},_k={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){if((0,n.default)(o),c){var s=new RegExp("[".concat(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+$"),"g");return o.replace(s,"")}for(var f=o.length-1;/\s/.test(o.charAt(f));)f-=1;return o.slice(0,f+1)}t.exports=e.default,t.exports.default=e.default})(_k,_k.exports);var JX=_k.exports,xk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){(0,n.default)(o);var s=c?new RegExp("^[".concat(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+"),"g"):/^\s+/g;return o.replace(s,"")}t.exports=e.default,t.exports.default=e.default})(xk,xk.exports);var QX=xk.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(JX),i=r(QX);function r(c){return c&&c.__esModule?c:{default:c}}function o(c,s){return(0,n.default)((0,i.default)(c,s),s)}t.exports=e.default,t.exports.default=e.default})(yk,yk.exports);var eK=yk.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=N;var n=o(eK),i=o(WX),r=o(ti);function o(z){return z&&z.__esModule?z:{default:z}}function c(z,L){return v(z)||f(z,L)||C(z,L)||s()}function s(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(z,L){var P=z==null?null:typeof Symbol<"u"&&z[Symbol.iterator]||z["@@iterator"];if(P!=null){var H,j,q,le,ce=[],ae=!0,pe=!1;try{if(q=(P=P.call(z)).next,L!==0)for(;!(ae=(H=q.call(P)).done)&&(ce.push(H.value),ce.length!==L);ae=!0);}catch(fe){pe=!0,j=fe}finally{try{if(!ae&&P.return!=null&&(le=P.return(),Object(le)!==le))return}finally{if(pe)throw j}}return ce}}function v(z){if(Array.isArray(z))return z}function w(z,L){var P=typeof Symbol<"u"&&z[Symbol.iterator]||z["@@iterator"];if(!P){if(Array.isArray(z)||(P=C(z))||L){P&&(z=P);var H=0,j=function(){};return{s:j,n:function(){return H>=z.length?{done:!0}:{done:!1,value:z[H++]}},e:function(pe){throw pe},f:j}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var q=!0,le=!1,ce;return{s:function(){P=P.call(z)},n:function(){var pe=P.next();return q=pe.done,pe},e:function(pe){le=!0,ce=pe},f:function(){try{!q&&P.return!=null&&P.return()}finally{if(le)throw ce}}}}function C(z,L){if(z){if(typeof z=="string")return M(z,L);var P=Object.prototype.toString.call(z).slice(8,-1);if(P==="Object"&&z.constructor&&(P=z.constructor.name),P==="Map"||P==="Set")return Array.from(z);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return M(z,L)}}function M(z,L){(L==null||L>z.length)&&(L=z.length);for(var P=0,H=new Array(L);P<L;P++)H[P]=z[P];return H}function F(z){var L=new Set(["subject","body","cc","bcc"]),P={cc:"",bcc:""},H=!1,j=z.split("&");if(j.length>4)return!1;var q=w(j),le;try{for(q.s();!(le=q.n()).done;){var ce=le.value,ae=ce.split("="),pe=c(ae,2),fe=pe[0],ue=pe[1];if(fe&&!L.has(fe)){H=!0;break}ue&&(fe==="cc"||fe==="bcc")&&(P[fe]=ue),fe&&L.delete(fe)}}catch(Ee){q.e(Ee)}finally{q.f()}return H?!1:P}function N(z,L){if((0,r.default)(z),z.indexOf("mailto:")!==0)return!1;var P=z.replace("mailto:","").split("?"),H=c(P,2),j=H[0],q=H[1],le=q===void 0?"":q;if(!j&&!le)return!0;var ce=F(le);return ce?"".concat(j,",").concat(ce.cc,",").concat(ce.bcc).split(",").every(function(ae){return ae=(0,n.default)(ae," "),ae?(0,i.default)(ae,L):!0}):!1}t.exports=e.default,t.exports.default=e.default})(vk,vk.exports);var gbe=vk.exports,wk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=i(ti);function i(f){return f&&f.__esModule?f:{default:f}}var r=/^(application|audio|font|image|message|model|multipart|text|video)\/[a-zA-Z0-9\.\-\+_]{1,100}$/i,o=/^text\/[a-zA-Z0-9\.\-\+]{1,100};\s?charset=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?$/i,c=/^multipart\/[a-zA-Z0-9\.\-\+]{1,100}(;\s?(boundary|charset)=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?){0,2}$/i;function s(f){return(0,n.default)(f),r.test(f)||o.test(f)||c.test(f)}t.exports=e.default,t.exports.default=e.default})(wk,wk.exports);var vbe=wk.exports,Ck={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=w;var n=r(ti),i=r(oc);function r(C){return C&&C.__esModule?C:{default:C}}var o=/^\(?[+-]?(90(\.0+)?|[1-8]?\d(\.\d+)?)$/,c=/^\s?[+-]?(180(\.0+)?|1[0-7]\d(\.\d+)?|\d{1,2}(\.\d+)?)\)?$/,s=/^(([1-8]?\d)\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|90\D+0\D+0)\D+[NSns]?$/i,f=/^\s*([1-7]?\d{1,2}\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|180\D+0\D+0)\D+[EWew]?$/i,v={checkDMS:!1};function w(C,M){if((0,n.default)(C),M=(0,i.default)(M,v),!C.includes(","))return!1;var F=C.split(",");return F[0].startsWith("(")&&!F[1].endsWith(")")||F[1].endsWith(")")&&!F[0].startsWith("(")?!1:M.checkDMS?s.test(F[0])&&f.test(F[1]):o.test(F[0])&&c.test(F[1])}t.exports=e.default,t.exports.default=e.default})(Ck,Ck.exports);var ybe=Ck.exports,tb={};Object.defineProperty(tb,"__esModule",{value:!0});tb.default=wbe;tb.locales=void 0;var _be=xbe(ti);function xbe(t){return t&&t.__esModule?t:{default:t}}var GH=/^\d{3}$/,lu=/^\d{4}$/,Ul=/^\d{5}$/,ZD=/^\d{6}$/,Y0={AD:/^AD\d{3}$/,AT:lu,AU:lu,AZ:/^AZ\d{4}$/,BA:/^([7-8]\d{4}$)/,BE:lu,BG:lu,BR:/^\d{5}-\d{3}$/,BY:/^2[1-4]\d{4}$/,CA:/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][\s\-]?\d[ABCEGHJ-NPRSTV-Z]\d$/i,CH:lu,CN:/^(0[1-7]|1[012356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[1-5]|8[1345]|9[09])\d{4}$/,CZ:/^\d{3}\s?\d{2}$/,DE:Ul,DK:lu,DO:Ul,DZ:Ul,EE:Ul,ES:/^(5[0-2]{1}|[0-4]{1}\d{1})\d{3}$/,FI:Ul,FR:/^\d{2}\s?\d{3}$/,GB:/^(gir\s?0aa|[a-z]{1,2}\d[\da-z]?\s?(\d[a-z]{2})?)$/i,GR:/^\d{3}\s?\d{2}$/,HR:/^([1-5]\d{4}$)/,HT:/^HT\d{4}$/,HU:lu,ID:Ul,IE:/^(?!.*(?:o))[A-Za-z]\d[\dw]\s\w{4}$/i,IL:/^(\d{5}|\d{7})$/,IN:/^((?!10|29|35|54|55|65|66|86|87|88|89)[1-9][0-9]{5})$/,IR:/^(?!(\d)\1{3})[13-9]{4}[1346-9][013-9]{5}$/,IS:GH,IT:Ul,JP:/^\d{3}\-\d{4}$/,KE:Ul,KR:/^(\d{5}|\d{6})$/,LI:/^(948[5-9]|949[0-7])$/,LT:/^LT\-\d{5}$/,LU:lu,LV:/^LV\-\d{4}$/,LK:Ul,MG:GH,MX:Ul,MT:/^[A-Za-z]{3}\s{0,1}\d{4}$/,MY:Ul,NL:/^[1-9]\d{3}\s?(?!sa|sd|ss)[a-z]{2}$/i,NO:lu,NP:/^(10|21|22|32|33|34|44|45|56|57)\d{3}$|^(977)$/i,NZ:lu,PL:/^\d{2}\-\d{3}$/,PR:/^00[679]\d{2}([ -]\d{4})?$/,PT:/^\d{4}\-\d{3}?$/,RO:ZD,RU:ZD,SA:Ul,SE:/^[1-9]\d{2}\s?\d{2}$/,SG:ZD,SI:lu,SK:/^\d{3}\s?\d{2}$/,TH:Ul,TN:lu,TW:/^\d{3}(\d{2})?$/,UA:Ul,US:/^\d{5}(-\d{4})?$/,ZA:lu,ZM:Ul};tb.locales=Object.keys(Y0);function wbe(t,e){if((0,_be.default)(t),e in Y0)return Y0[e].test(t);if(e==="any"){for(var n in Y0)if(Y0.hasOwnProperty(n)){var i=Y0[n];if(i.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}var Sk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o),o.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")}t.exports=e.default,t.exports.default=e.default})(Sk,Sk.exports);var Cbe=Sk.exports,bk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o){return(0,n.default)(o),o.replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`").replace(/&amp;/g,"&")}t.exports=e.default,t.exports.default=e.default})(bk,bk.exports);var Sbe=bk.exports,Ek={exports:{}},Mk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){return(0,n.default)(o),o.replace(new RegExp("[".concat(c,"]+"),"g"),"")}t.exports=e.default,t.exports.default=e.default})(Mk,Mk.exports);var tK=Mk.exports;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=r(ti),i=r(tK);function r(c){return c&&c.__esModule?c:{default:c}}function o(c,s){(0,n.default)(c);var f=s?"\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F":"\\x00-\\x1F\\x7F";return(0,i.default)(c,f)}t.exports=e.default,t.exports.default=e.default})(Ek,Ek.exports);var bbe=Ek.exports,Rk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){return(0,n.default)(o),o.replace(new RegExp("[^".concat(c,"]+"),"g"),"")}t.exports=e.default,t.exports.default=e.default})(Rk,Rk.exports);var Ebe=Rk.exports,Tk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=i(ti);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,c){(0,n.default)(o);for(var s=o.length-1;s>=0;s--)if(c.indexOf(o[s])===-1)return!1;return!0}t.exports=e.default,t.exports.default=e.default})(Tk,Tk.exports);var Mbe=Tk.exports,Ak={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=w;var n=i(oc);function i(C){return C&&C.__esModule?C:{default:C}}var r={all_lowercase:!0,gmail_lowercase:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0,gmail_convert_googlemaildotcom:!0,outlookdotcom_lowercase:!0,outlookdotcom_remove_subaddress:!0,yahoo_lowercase:!0,yahoo_remove_subaddress:!0,yandex_lowercase:!0,icloud_lowercase:!0,icloud_remove_subaddress:!0},o=["icloud.com","me.com"],c=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"],s=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"],f=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function v(C){return C.length>1?C:""}function w(C,M){M=(0,n.default)(M,r);var F=C.split("@"),N=F.pop(),z=F.join("@"),L=[z,N];if(L[1]=L[1].toLowerCase(),L[1]==="gmail.com"||L[1]==="googlemail.com"){if(M.gmail_remove_subaddress&&(L[0]=L[0].split("+")[0]),M.gmail_remove_dots&&(L[0]=L[0].replace(/\.+/g,v)),!L[0].length)return!1;(M.all_lowercase||M.gmail_lowercase)&&(L[0]=L[0].toLowerCase()),L[1]=M.gmail_convert_googlemaildotcom?"gmail.com":L[1]}else if(o.indexOf(L[1])>=0){if(M.icloud_remove_subaddress&&(L[0]=L[0].split("+")[0]),!L[0].length)return!1;(M.all_lowercase||M.icloud_lowercase)&&(L[0]=L[0].toLowerCase())}else if(c.indexOf(L[1])>=0){if(M.outlookdotcom_remove_subaddress&&(L[0]=L[0].split("+")[0]),!L[0].length)return!1;(M.all_lowercase||M.outlookdotcom_lowercase)&&(L[0]=L[0].toLowerCase())}else if(s.indexOf(L[1])>=0){if(M.yahoo_remove_subaddress){var P=L[0].split("-");L[0]=P.length>1?P.slice(0,-1).join("-"):P[0]}if(!L[0].length)return!1;(M.all_lowercase||M.yahoo_lowercase)&&(L[0]=L[0].toLowerCase())}else f.indexOf(L[1])>=0?((M.all_lowercase||M.yandex_lowercase)&&(L[0]=L[0].toLowerCase()),L[1]="yandex.ru"):M.all_lowercase&&(L[0]=L[0].toLowerCase());return L.join("@")}t.exports=e.default,t.exports.default=e.default})(Ak,Ak.exports);var Rbe=Ak.exports,Pk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r=/^[^\s-_](?!.*?[-_]{2,})[a-z0-9-\\][^\s]*[^-_\s]$/;function o(c){return(0,n.default)(c),r.test(c)}t.exports=e.default,t.exports.default=e.default})(Pk,Pk.exports);var Tbe=Pk.exports,Ik={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=i(ti);function i(c){return c&&c.__esModule?c:{default:c}}var r={"cs-CZ":function(s){return/^(([ABCDEFHIJKLMNPRSTUVXYZ]|[0-9])-?){5,8}$/.test(s)},"de-DE":function(s){return/^((A|AA|AB|AC|AE|AH|AK|AM|AN|AÖ|AP|AS|AT|AU|AW|AZ|B|BA|BB|BC|BE|BF|BH|BI|BK|BL|BM|BN|BO|BÖ|BS|BT|BZ|C|CA|CB|CE|CO|CR|CW|D|DA|DD|DE|DH|DI|DL|DM|DN|DO|DU|DW|DZ|E|EA|EB|ED|EE|EF|EG|EH|EI|EL|EM|EN|ER|ES|EU|EW|F|FB|FD|FF|FG|FI|FL|FN|FO|FR|FS|FT|FÜ|FW|FZ|G|GA|GC|GD|GE|GF|GG|GI|GK|GL|GM|GN|GÖ|GP|GR|GS|GT|GÜ|GV|GW|GZ|H|HA|HB|HC|HD|HE|HF|HG|HH|HI|HK|HL|HM|HN|HO|HP|HR|HS|HU|HV|HX|HY|HZ|IK|IL|IN|IZ|J|JE|JL|K|KA|KB|KC|KE|KF|KG|KH|KI|KK|KL|KM|KN|KO|KR|KS|KT|KU|KW|KY|L|LA|LB|LC|LD|LF|LG|LH|LI|LL|LM|LN|LÖ|LP|LR|LU|M|MA|MB|MC|MD|ME|MG|MH|MI|MK|ML|MM|MN|MO|MQ|MR|MS|MÜ|MW|MY|MZ|N|NB|ND|NE|NF|NH|NI|NK|NM|NÖ|NP|NR|NT|NU|NW|NY|NZ|OA|OB|OC|OD|OE|OF|OG|OH|OK|OL|OP|OS|OZ|P|PA|PB|PE|PF|PI|PL|PM|PN|PR|PS|PW|PZ|R|RA|RC|RD|RE|RG|RH|RI|RL|RM|RN|RO|RP|RS|RT|RU|RV|RW|RZ|S|SB|SC|SE|SG|SI|SK|SL|SM|SN|SO|SP|SR|ST|SU|SW|SY|SZ|TE|TF|TG|TO|TP|TR|TS|TT|TÜ|ÜB|UE|UH|UL|UM|UN|V|VB|VG|VK|VR|VS|W|WA|WB|WE|WF|WI|WK|WL|WM|WN|WO|WR|WS|WT|WÜ|WW|WZ|Z|ZE|ZI|ZP|ZR|ZW|ZZ)[- ]?[A-Z]{1,2}[- ]?\d{1,4}|(ABG|ABI|AIB|AIC|ALF|ALZ|ANA|ANG|ANK|APD|ARN|ART|ASL|ASZ|AUR|AZE|BAD|BAR|BBG|BCH|BED|BER|BGD|BGL|BID|BIN|BIR|BIT|BIW|BKS|BLB|BLK|BNA|BOG|BOH|BOR|BOT|BRA|BRB|BRG|BRK|BRL|BRV|BSB|BSK|BTF|BÜD|BUL|BÜR|BÜS|BÜZ|CAS|CHA|CLP|CLZ|COC|COE|CUX|DAH|DAN|DAU|DBR|DEG|DEL|DGF|DIL|DIN|DIZ|DKB|DLG|DON|DUD|DÜW|EBE|EBN|EBS|ECK|EIC|EIL|EIN|EIS|EMD|EMS|ERB|ERH|ERK|ERZ|ESB|ESW|FDB|FDS|FEU|FFB|FKB|FLÖ|FOR|FRG|FRI|FRW|FTL|FÜS|GAN|GAP|GDB|GEL|GEO|GER|GHA|GHC|GLA|GMN|GNT|GOA|GOH|GRA|GRH|GRI|GRM|GRZ|GTH|GUB|GUN|GVM|HAB|HAL|HAM|HAS|HBN|HBS|HCH|HDH|HDL|HEB|HEF|HEI|HER|HET|HGN|HGW|HHM|HIG|HIP|HMÜ|HOG|HOH|HOL|HOM|HOR|HÖS|HOT|HRO|HSK|HST|HVL|HWI|IGB|ILL|JÜL|KEH|KEL|KEM|KIB|KLE|KLZ|KÖN|KÖT|KÖZ|KRU|KÜN|KUS|KYF|LAN|LAU|LBS|LBZ|LDK|LDS|LEO|LER|LEV|LIB|LIF|LIP|LÖB|LOS|LRO|LSZ|LÜN|LUP|LWL|MAB|MAI|MAK|MAL|MED|MEG|MEI|MEK|MEL|MER|MET|MGH|MGN|MHL|MIL|MKK|MOD|MOL|MON|MOS|MSE|MSH|MSP|MST|MTK|MTL|MÜB|MÜR|MYK|MZG|NAB|NAI|NAU|NDH|NEA|NEB|NEC|NEN|NES|NEW|NMB|NMS|NOH|NOL|NOM|NOR|NVP|NWM|OAL|OBB|OBG|OCH|OHA|ÖHR|OHV|OHZ|OPR|OSL|OVI|OVL|OVP|PAF|PAN|PAR|PCH|PEG|PIR|PLÖ|PRÜ|QFT|QLB|RDG|REG|REH|REI|RID|RIE|ROD|ROF|ROK|ROL|ROS|ROT|ROW|RSL|RÜD|RÜG|SAB|SAD|SAN|SAW|SBG|SBK|SCZ|SDH|SDL|SDT|SEB|SEE|SEF|SEL|SFB|SFT|SGH|SHA|SHG|SHK|SHL|SIG|SIM|SLE|SLF|SLK|SLN|SLS|SLÜ|SLZ|SMÜ|SOB|SOG|SOK|SÖM|SON|SPB|SPN|SRB|SRO|STA|STB|STD|STE|STL|SUL|SÜW|SWA|SZB|TBB|TDO|TET|TIR|TÖL|TUT|UEM|UER|UFF|USI|VAI|VEC|VER|VIB|VIE|VIT|VOH|WAF|WAK|WAN|WAR|WAT|WBS|WDA|WEL|WEN|WER|WES|WHV|WIL|WIS|WIT|WIZ|WLG|WMS|WND|WOB|WOH|WOL|WOR|WOS|WRN|WSF|WST|WSW|WTL|WTM|WUG|WÜM|WUN|WUR|WZL|ZEL|ZIG)[- ]?(([A-Z][- ]?\d{1,4})|([A-Z]{2}[- ]?\d{1,3})))[- ]?(E|H)?$/.test(s)},"de-LI":function(s){return/^FL[- ]?\d{1,5}[UZ]?$/.test(s)},"en-IN":function(s){return/^[A-Z]{2}[ -]?[0-9]{1,2}(?:[ -]?[A-Z])(?:[ -]?[A-Z]*)?[ -]?[0-9]{4}$/.test(s)},"es-AR":function(s){return/^(([A-Z]{2} ?[0-9]{3} ?[A-Z]{2})|([A-Z]{3} ?[0-9]{3}))$/.test(s)},"fi-FI":function(s){return/^(?=.{4,7})(([A-Z]{1,3}|[0-9]{1,3})[\s-]?([A-Z]{1,3}|[0-9]{1,5}))$/.test(s)},"hu-HU":function(s){return/^((((?!AAA)(([A-NPRSTVZWXY]{1})([A-PR-Z]{1})([A-HJ-NPR-Z]))|(A[ABC]I)|A[ABC]O|A[A-W]Q|BPI|BPO|UCO|UDO|XAO)-(?!000)\d{3})|(M\d{6})|((CK|DT|CD|HC|H[ABEFIKLMNPRSTVX]|MA|OT|R[A-Z]) \d{2}-\d{2})|(CD \d{3}-\d{3})|(C-(C|X) \d{4})|(X-(A|B|C) \d{4})|(([EPVZ]-\d{5}))|(S A[A-Z]{2} \d{2})|(SP \d{2}-\d{2}))$/.test(s)},"pt-BR":function(s){return/^[A-Z]{3}[ -]?[0-9][A-Z][0-9]{2}|[A-Z]{3}[ -]?[0-9]{4}$/.test(s)},"pt-PT":function(s){return/^([A-Z]{2}|[0-9]{2})[ -·]?([A-Z]{2}|[0-9]{2})[ -·]?([A-Z]{2}|[0-9]{2})$/.test(s)},"sq-AL":function(s){return/^[A-Z]{2}[- ]?((\d{3}[- ]?(([A-Z]{2})|T))|(R[- ]?\d{3}))$/.test(s)},"sv-SE":function(s){return/^[A-HJ-PR-UW-Z]{3} ?[\d]{2}[A-HJ-PR-UW-Z1-9]$|(^[A-ZÅÄÖ ]{2,7}$)/.test(s.trim())},"en-PK":function(s){return/(^[A-Z]{2}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]{3}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]{4}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]((\s|-){0,1})[0-9]{4}((\s|-)[0-9]{2}){0,1}$)/.test(s.trim())}};function o(c,s){if((0,n.default)(c),s in r)return r[s](c);if(s==="any"){for(var f in r){var v=r[f];if(v(c))return!0}return!1}throw new Error("Invalid locale '".concat(s,"'"))}t.exports=e.default,t.exports.default=e.default})(Ik,Ik.exports);var Abe=Ik.exports,Dk={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=F;var n=r(oc),i=r(ti);function r(N){return N&&N.__esModule?N:{default:N}}var o=/^[A-Z]$/,c=/^[a-z]$/,s=/^[0-9]$/,f=/^[-#!$@£%^&*()_+|~=`{}\[\]:";'<>?,.\/\\ ]$/,v={minLength:8,minLowercase:1,minUppercase:1,minNumbers:1,minSymbols:1,returnScore:!1,pointsPerUnique:1,pointsPerRepeat:.5,pointsForContainingLower:10,pointsForContainingUpper:10,pointsForContainingNumber:10,pointsForContainingSymbol:10};function w(N){var z={};return Array.from(N).forEach(function(L){var P=z[L];P?z[L]+=1:z[L]=1}),z}function C(N){var z=w(N),L={length:N.length,uniqueChars:Object.keys(z).length,uppercaseCount:0,lowercaseCount:0,numberCount:0,symbolCount:0};return Object.keys(z).forEach(function(P){o.test(P)?L.uppercaseCount+=z[P]:c.test(P)?L.lowercaseCount+=z[P]:s.test(P)?L.numberCount+=z[P]:f.test(P)&&(L.symbolCount+=z[P])}),L}function M(N,z){var L=0;return L+=N.uniqueChars*z.pointsPerUnique,L+=(N.length-N.uniqueChars)*z.pointsPerRepeat,N.lowercaseCount>0&&(L+=z.pointsForContainingLower),N.uppercaseCount>0&&(L+=z.pointsForContainingUpper),N.numberCount>0&&(L+=z.pointsForContainingNumber),N.symbolCount>0&&(L+=z.pointsForContainingSymbol),L}function F(N){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;(0,i.default)(N);var L=C(N);return z=(0,n.default)(z||{},v),z.returnScore?M(L,z):L.length>=z.minLength&&L.lowercaseCount>=z.minLowercase&&L.uppercaseCount>=z.minUppercase&&L.numberCount>=z.minNumbers&&L.symbolCount>=z.minSymbols}t.exports=e.default,t.exports.default=e.default})(Dk,Dk.exports);var Pbe=Dk.exports,nb={};function Fk(t){"@babel/helpers - typeof";return Fk=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fk(t)}Object.defineProperty(nb,"__esModule",{value:!0});nb.default=Nbe;nb.vatMatchers=void 0;var HH=Fbe(ti),Ibe=Dbe(V_);function nK(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(nK=function(r){return r?n:e})(t)}function Dbe(t,e){if(t&&t.__esModule)return t;if(t===null||Fk(t)!="object"&&typeof t!="function")return{default:t};var n=nK(e);if(n&&n.has(t))return n.get(t);var i={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&{}.hasOwnProperty.call(t,o)){var c=r?Object.getOwnPropertyDescriptor(t,o):null;c&&(c.get||c.set)?Object.defineProperty(i,o,c):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}function Fbe(t){return t&&t.__esModule?t:{default:t}}var Lbe=function(e){var n=e.match(/^(AU)?(\d{11})$/);if(!n)return!1;var i=[10,1,3,5,7,9,11,13,15,17,19];e=e.replace(/^AU/,"");for(var r=(parseInt(e.slice(0,1),10)-1).toString()+e.slice(1),o=0,c=0;c<11;c++)o+=i[c]*r.charAt(c);return o!==0&&o%89===0},Obe=function(e){var n=function(r){var o=r.pop(),c=[5,4,3,2,7,6,5,4],s=(11-r.reduce(function(f,v,w){return f+v*c[w]},0)%11)%11;return o===s};return/^(CHE[- ]?)?(\d{9}|(\d{3}\.\d{3}\.\d{3})|(\d{3} \d{3} \d{3})) ?(TVA|MWST|IVA)?$/.test(e)&&n(e.match(/\d/g).map(function(i){return+i}))},kbe=function(e){var n=e.match(/^(PT)?(\d{9})$/);if(!n)return!1;var i=n[2],r=11-Ibe.reverseMultiplyAndSum(i.split("").slice(0,8).map(function(o){return parseInt(o,10)}),9)%11;return r>9?parseInt(i[8],10)===0:r===parseInt(i[8],10)},WH=nb.vatMatchers={AT:function(e){return/^(AT)?U\d{8}$/.test(e)},BE:function(e){return/^(BE)?\d{10}$/.test(e)},BG:function(e){return/^(BG)?\d{9,10}$/.test(e)},HR:function(e){return/^(HR)?\d{11}$/.test(e)},CY:function(e){return/^(CY)?\w{9}$/.test(e)},CZ:function(e){return/^(CZ)?\d{8,10}$/.test(e)},DK:function(e){return/^(DK)?\d{8}$/.test(e)},EE:function(e){return/^(EE)?\d{9}$/.test(e)},FI:function(e){return/^(FI)?\d{8}$/.test(e)},FR:function(e){return/^(FR)?\w{2}\d{9}$/.test(e)},DE:function(e){return/^(DE)?\d{9}$/.test(e)},EL:function(e){return/^(EL)?\d{9}$/.test(e)},HU:function(e){return/^(HU)?\d{8}$/.test(e)},IE:function(e){return/^(IE)?\d{7}\w{1}(W)?$/.test(e)},IT:function(e){return/^(IT)?\d{11}$/.test(e)},LV:function(e){return/^(LV)?\d{11}$/.test(e)},LT:function(e){return/^(LT)?\d{9,12}$/.test(e)},LU:function(e){return/^(LU)?\d{8}$/.test(e)},MT:function(e){return/^(MT)?\d{8}$/.test(e)},NL:function(e){return/^(NL)?\d{9}B\d{2}$/.test(e)},PL:function(e){return/^(PL)?(\d{10}|(\d{3}-\d{3}-\d{2}-\d{2})|(\d{3}-\d{2}-\d{2}-\d{3}))$/.test(e)},PT:kbe,RO:function(e){return/^(RO)?\d{2,10}$/.test(e)},SK:function(e){return/^(SK)?\d{10}$/.test(e)},SI:function(e){return/^(SI)?\d{8}$/.test(e)},ES:function(e){return/^(ES)?\w\d{7}[A-Z]$/.test(e)},SE:function(e){return/^(SE)?\d{12}$/.test(e)},AL:function(e){return/^(AL)?\w{9}[A-Z]$/.test(e)},MK:function(e){return/^(MK)?\d{13}$/.test(e)},AU:Lbe,BY:function(e){return/^(УНП )?\d{9}$/.test(e)},CA:function(e){return/^(CA)?\d{9}$/.test(e)},IS:function(e){return/^(IS)?\d{5,6}$/.test(e)},IN:function(e){return/^(IN)?\d{15}$/.test(e)},ID:function(e){return/^(ID)?(\d{15}|(\d{2}.\d{3}.\d{3}.\d{1}-\d{3}.\d{3}))$/.test(e)},IL:function(e){return/^(IL)?\d{9}$/.test(e)},KZ:function(e){return/^(KZ)?\d{12}$/.test(e)},NZ:function(e){return/^(NZ)?\d{9}$/.test(e)},NG:function(e){return/^(NG)?(\d{12}|(\d{8}-\d{4}))$/.test(e)},NO:function(e){return/^(NO)?\d{9}MVA$/.test(e)},PH:function(e){return/^(PH)?(\d{12}|\d{3} \d{3} \d{3} \d{3})$/.test(e)},RU:function(e){return/^(RU)?(\d{10}|\d{12})$/.test(e)},SM:function(e){return/^(SM)?\d{5}$/.test(e)},SA:function(e){return/^(SA)?\d{15}$/.test(e)},RS:function(e){return/^(RS)?\d{9}$/.test(e)},CH:Obe,TR:function(e){return/^(TR)?\d{10}$/.test(e)},UA:function(e){return/^(UA)?\d{12}$/.test(e)},GB:function(e){return/^GB((\d{3} \d{4} ([0-8][0-9]|9[0-6]))|(\d{9} \d{3})|(((GD[0-4])|(HA[5-9]))[0-9]{2}))$/.test(e)},UZ:function(e){return/^(UZ)?\d{9}$/.test(e)},AR:function(e){return/^(AR)?\d{11}$/.test(e)},BO:function(e){return/^(BO)?\d{7}$/.test(e)},BR:function(e){return/^(BR)?((\d{2}.\d{3}.\d{3}\/\d{4}-\d{2})|(\d{3}.\d{3}.\d{3}-\d{2}))$/.test(e)},CL:function(e){return/^(CL)?\d{8}-\d{1}$/.test(e)},CO:function(e){return/^(CO)?\d{10}$/.test(e)},CR:function(e){return/^(CR)?\d{9,12}$/.test(e)},EC:function(e){return/^(EC)?\d{13}$/.test(e)},SV:function(e){return/^(SV)?\d{4}-\d{6}-\d{3}-\d{1}$/.test(e)},GT:function(e){return/^(GT)?\d{7}-\d{1}$/.test(e)},HN:function(e){return/^(HN)?$/.test(e)},MX:function(e){return/^(MX)?\w{3,4}\d{6}\w{3}$/.test(e)},NI:function(e){return/^(NI)?\d{3}-\d{6}-\d{4}\w{1}$/.test(e)},PA:function(e){return/^(PA)?$/.test(e)},PY:function(e){return/^(PY)?\d{6,8}-\d{1}$/.test(e)},PE:function(e){return/^(PE)?\d{11}$/.test(e)},DO:function(e){return/^(DO)?(\d{11}|(\d{3}-\d{7}-\d{1})|[1,4,5]{1}\d{8}|([1,4,5]{1})-\d{2}-\d{5}-\d{1})$/.test(e)},UY:function(e){return/^(UY)?\d{12}$/.test(e)},VE:function(e){return/^(VE)?[J,G,V,E]{1}-(\d{9}|(\d{8}-\d{1}))$/.test(e)}};function Nbe(t,e){if((0,HH.default)(t),(0,HH.default)(e),e in WH)return WH[e](t);throw new Error("Invalid country code: '".concat(e,"'"))}(function(t,e){function n(Dn){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Xn){return typeof Xn}:function(Xn){return Xn&&typeof Symbol=="function"&&Xn.constructor===Symbol&&Xn!==Symbol.prototype?"symbol":typeof Xn},n(Dn)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=ht(gB),r=ht(VX),o=ht(E1e),c=ht(M1e),s=ht(R1e),f=ht(T1e),v=ht(A1e),w=ht(WX),C=ht(P1e),M=ht(I1e),F=ht(HA),N=ht(D1e),z=ht(vB),L=ht(jX),P=ht(F1e),H=ht(L1e),j=ht(O1e),q=ht(k1e),le=$t(XS),ce=$t(KS),ae=ht(H1e),pe=ht(W1e),fe=ht(j1e),ue=ht($1e),Ee=ht(q1e),We=ht(Z1e),rt=ht(X1e),tt=ht(Iw),Ye=ht(Dw),qe=ht(rSe),ft=ht(sSe),Me=ht(aSe),$e=ht(lSe),ut=ht(yB),Mt=$t(Pw),Gt=ht(uSe),Xt=ht($X),Qe=ht(hSe),Ge=ht(dSe),He=ht(fSe),De=ht(pSe),kt=ht(mSe),rn=ht(gSe),Re=$t(YS),Kt=ht(MSe),bt=ht(RSe),Dt=ht(TSe),_e=ht(ASe),At=ht(PSe),Ot=ht(ISe),tn=ht(DSe),xe=ht(HX),Se=ht(FSe),it=ht(LSe),Le=ht(OSe),Pe=ht(kSe),vt=ht(NSe),yt=ht(XX),nn=ht(BSe),jt=ht(zSe),Fn=ht(USe),Bn=ht(VSe),Zn=ht(GSe),Li=ht(HSe),zn=ht(ZSe),oi=$t(JS),gi=ht(JSe),Ti=ht(QSe),pi=ht(ebe),Ji=QS,er=ht(sbe),vi=ht(obe),Wt=ht(abe),ui=ht(Fw),vn=ht(lbe),Ln=ht(eb),mi=ht(dbe),hi=ht(fbe),Xi=ht(ZX),cs=ht(pbe),Ft=ht(mbe),we=ht(gbe),Ie=ht(vbe),je=ht(ybe),pt=$t(tb),nt=ht(QX),wt=ht(JX),zt=ht(eK),St=ht(Cbe),Bt=ht(Sbe),Zt=ht(bbe),Yt=ht(Ebe),fn=ht(tK),In=ht(Mbe),Gn=ht(Rbe),Ci=ht(Tbe),Ri=ht(Abe),Mi=ht(Pbe),Be=ht(nb);function Pt(Dn){if(typeof WeakMap!="function")return null;var Xn=new WeakMap,Yn=new WeakMap;return(Pt=function(Wi){return Wi?Yn:Xn})(Dn)}function $t(Dn,Xn){if(Dn&&Dn.__esModule)return Dn;if(Dn===null||n(Dn)!="object"&&typeof Dn!="function")return{default:Dn};var Yn=Pt(Xn);if(Yn&&Yn.has(Dn))return Yn.get(Dn);var Si={__proto__:null},Wi=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var di in Dn)if(di!=="default"&&{}.hasOwnProperty.call(Dn,di)){var or=Wi?Object.getOwnPropertyDescriptor(Dn,di):null;or&&(or.get||or.set)?Object.defineProperty(Si,di,or):Si[di]=Dn[di]}return Si.default=Dn,Yn&&Yn.set(Dn,Si),Si}function ht(Dn){return Dn&&Dn.__esModule?Dn:{default:Dn}}var Lt="13.12.0",An={version:Lt,toDate:i.default,toFloat:r.default,toInt:o.default,toBoolean:c.default,equals:s.default,contains:f.default,matches:v.default,isEmail:w.default,isURL:C.default,isMACAddress:M.default,isIP:F.default,isIPRange:N.default,isFQDN:z.default,isBoolean:H.default,isIBAN:Re.default,isBIC:Kt.default,isAbaRouting:q.default,isAlpha:le.default,isAlphaLocales:le.locales,isAlphanumeric:ce.default,isAlphanumericLocales:ce.locales,isNumeric:ae.default,isPassportNumber:pe.default,isPort:fe.default,isLowercase:ue.default,isUppercase:Ee.default,isAscii:rt.default,isFullWidth:tt.default,isHalfWidth:Ye.default,isVariableWidth:qe.default,isMultibyte:ft.default,isSemVer:Me.default,isSurrogatePair:$e.default,isInt:ut.default,isIMEI:We.default,isFloat:Mt.default,isFloatLocales:Mt.locales,isDecimal:Gt.default,isHexadecimal:Xt.default,isOctal:Qe.default,isDivisibleBy:Ge.default,isHexColor:He.default,isRgbColor:De.default,isHSL:kt.default,isISRC:rn.default,isMD5:bt.default,isHash:Dt.default,isJWT:_e.default,isJSON:At.default,isEmpty:Ot.default,isLength:tn.default,isLocale:j.default,isByteLength:xe.default,isUUID:Se.default,isMongoId:it.default,isAfter:Le.default,isBefore:Pe.default,isIn:vt.default,isLuhnNumber:yt.default,isCreditCard:nn.default,isIdentityCard:jt.default,isEAN:Fn.default,isISIN:Bn.default,isISBN:Zn.default,isISSN:Li.default,isMobilePhone:oi.default,isMobilePhoneLocales:oi.locales,isPostalCode:pt.default,isPostalCodeLocales:pt.locales,isEthereumAddress:gi.default,isCurrency:Ti.default,isBtcAddress:pi.default,isISO6346:Ji.isISO6346,isFreightContainerID:Ji.isFreightContainerID,isISO6391:er.default,isISO8601:vi.default,isRFC3339:Wt.default,isISO31661Alpha2:ui.default,isISO31661Alpha3:vn.default,isISO4217:Ln.default,isBase32:mi.default,isBase58:hi.default,isBase64:Xi.default,isDataURI:cs.default,isMagnetURI:Ft.default,isMailtoURI:we.default,isMimeType:Ie.default,isLatLong:je.default,ltrim:nt.default,rtrim:wt.default,trim:zt.default,escape:St.default,unescape:Bt.default,stripLow:Zt.default,whitelist:Yt.default,blacklist:fn.default,isWhitelisted:In.default,normalizeEmail:Gn.default,toString,isSlug:Ci.default,isStrongPassword:Mi.default,isTaxID:zn.default,isDate:L.default,isTime:P.default,isLicensePlate:Ri.default,isVAT:Be.default,ibanLocales:Re.locales};e.default=An,t.exports=e.default,t.exports.default=e.default})($L,$L.exports);var Bbe=$L.exports;const iK=pv(Bbe);function rK(t){return pd({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 5.511c.561 0 1.119.354 1.544 1.062l5.912 9.854c.851 1.415.194 2.573-1.456 2.573h-12c-1.65 0-2.307-1.159-1.456-2.573l5.912-9.854c.425-.708.983-1.062 1.544-1.062m0-2c-1.296 0-2.482.74-3.259 2.031l-5.912 9.856c-.786 1.309-.872 2.705-.235 3.83s1.879 1.772 3.406 1.772h12c1.527 0 2.77-.646 3.406-1.771s.551-2.521-.235-3.83l-5.912-9.854c-.777-1.294-1.963-2.034-3.259-2.034z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"16",r:"1.3"},child:[]},{tag:"path",attr:{d:"M13.5 10c0-.83-.671-1.5-1.5-1.5s-1.5.67-1.5 1.5c0 .199.041.389.111.562.554 1.376 1.389 3.438 1.389 3.438l1.391-3.438c.068-.173.109-.363.109-.562z"},child:[]}]})(t)}const zbe="https://mywayrtkapi.cyrusbowman.com";async function Ube(t){return console.log("forgotPassword",t),Wr.post(zbe+"/passwordRecovery",t).then(function(e){return e.data})}var Vbe=Object.defineProperty,Gbe=Object.defineProperties,Hbe=Object.getOwnPropertyDescriptors,_T=Object.getOwnPropertySymbols,sK=Object.prototype.hasOwnProperty,oK=Object.prototype.propertyIsEnumerable,jH=(t,e,n)=>e in t?Vbe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wbe=(t,e)=>{for(var n in e||(e={}))sK.call(e,n)&&jH(t,n,e[n]);if(_T)for(var n of _T(e))oK.call(e,n)&&jH(t,n,e[n]);return t},jbe=(t,e)=>Gbe(t,Hbe(e)),$be=(t,e)=>{var n={};for(var i in t)sK.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&_T)for(var i of _T(t))e.indexOf(i)<0&&oK.call(t,i)&&(n[i]=t[i]);return n};function qbe(t){let e=setTimeout(t,0),n=setTimeout(t,10),i=setTimeout(t,50);return[e,n,i]}function Zbe(t){let e=Q.useRef();return Q.useEffect(()=>{e.current=t}),e.current}var Xbe=18,aK=40,Kbe=`${aK}px`,Ybe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function Jbe({containerRef:t,inputRef:e,pushPasswordManagerStrategy:n,isFocused:i}){let[r,o]=Q.useState(!1),[c,s]=Q.useState(!1),[f,v]=Q.useState(!1),w=Q.useMemo(()=>n==="none"?!1:(n==="increase-width"||n==="experimental-no-flickering")&&r&&c,[r,c,n]),C=Q.useCallback(()=>{let M=t.current,F=e.current;if(!M||!F||f||n==="none")return;let N=M,z=N.getBoundingClientRect().left+N.offsetWidth,L=N.getBoundingClientRect().top+N.offsetHeight/2,P=z-Xbe,H=L;document.querySelectorAll(Ybe).length===0&&document.elementFromPoint(P,H)===M||(o(!0),v(!0))},[t,e,f,n]);return Q.useEffect(()=>{let M=t.current;if(!M||n==="none")return;function F(){let z=window.innerWidth-M.getBoundingClientRect().right;s(z>=aK)}F();let N=setInterval(F,1e3);return()=>{clearInterval(N)}},[t,n]),Q.useEffect(()=>{let M=i||document.activeElement===e.current;if(n==="none"||!M)return;let F=setTimeout(C,0),N=setTimeout(C,2e3),z=setTimeout(C,5e3),L=setTimeout(()=>{v(!0)},6e3);return()=>{clearTimeout(F),clearTimeout(N),clearTimeout(z),clearTimeout(L)}},[e,i,n,C]),{hasPWMBadge:r,willPushPWMBadge:w,PWM_BADGE_SPACE_WIDTH:Kbe}}var lK=Q.createContext({}),cK=Q.forwardRef((t,e)=>{var n=t,{value:i,onChange:r,maxLength:o,textAlign:c="left",pattern:s,placeholder:f,inputMode:v="numeric",onComplete:w,pushPasswordManagerStrategy:C="increase-width",pasteTransformer:M,containerClassName:F,noScriptCSSFallback:N=Qbe,render:z,children:L}=n,P=$be(n,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),H,j,q,le,ce;let[ae,pe]=Q.useState(typeof P.defaultValue=="string"?P.defaultValue:""),fe=i??ae,ue=Zbe(fe),Ee=Q.useCallback(_e=>{r==null||r(_e),pe(_e)},[r]),We=Q.useMemo(()=>s?typeof s=="string"?new RegExp(s):s:null,[s]),rt=Q.useRef(null),tt=Q.useRef(null),Ye=Q.useRef({value:fe,onChange:Ee,isIOS:typeof window<"u"&&((j=(H=window==null?void 0:window.CSS)==null?void 0:H.supports)==null?void 0:j.call(H,"-webkit-touch-callout","none"))}),qe=Q.useRef({prev:[(q=rt.current)==null?void 0:q.selectionStart,(le=rt.current)==null?void 0:le.selectionEnd,(ce=rt.current)==null?void 0:ce.selectionDirection]});Q.useImperativeHandle(e,()=>rt.current,[]),Q.useEffect(()=>{let _e=rt.current,At=tt.current;if(!_e||!At)return;Ye.current.value!==_e.value&&Ye.current.onChange(_e.value),qe.current.prev=[_e.selectionStart,_e.selectionEnd,_e.selectionDirection];function Ot(){if(document.activeElement!==_e){Gt(null),Qe(null);return}let Se=_e.selectionStart,it=_e.selectionEnd,Le=_e.selectionDirection,Pe=_e.maxLength,vt=_e.value,yt=qe.current.prev,nn=-1,jt=-1,Fn;if(vt.length!==0&&Se!==null&&it!==null){let zn=Se===it,oi=Se===vt.length&&vt.length<Pe;if(zn&&!oi){let gi=Se;if(gi===0)nn=0,jt=1,Fn="forward";else if(gi===Pe)nn=gi-1,jt=gi,Fn="backward";else if(Pe>1&&vt.length>1){let Ti=0;if(yt[0]!==null&&yt[1]!==null){Fn=gi<yt[1]?"backward":"forward";let pi=yt[0]===yt[1]&&yt[0]<Pe;Fn==="backward"&&!pi&&(Ti=-1)}nn=Ti+gi,jt=Ti+gi+1}}nn!==-1&&jt!==-1&&nn!==jt&&rt.current.setSelectionRange(nn,jt,Fn)}let Bn=nn!==-1?nn:Se,Zn=jt!==-1?jt:it,Li=Fn??Le;Gt(Bn),Qe(Zn),qe.current.prev=[Bn,Zn,Li]}if(document.addEventListener("selectionchange",Ot,{capture:!0}),Ot(),document.activeElement===_e&&ut(!0),!document.getElementById("input-otp-style")){let Se=document.createElement("style");if(Se.id="input-otp-style",document.head.appendChild(Se),Se.sheet){let it="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";zC(Se.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),zC(Se.sheet,`[data-input-otp]:autofill { ${it} }`),zC(Se.sheet,`[data-input-otp]:-webkit-autofill { ${it} }`),zC(Se.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),zC(Se.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let tn=()=>{At&&At.style.setProperty("--root-height",`${_e.clientHeight}px`)};tn();let xe=new ResizeObserver(tn);return xe.observe(_e),()=>{document.removeEventListener("selectionchange",Ot,{capture:!0}),xe.disconnect()}},[]);let[ft,Me]=Q.useState(!1),[$e,ut]=Q.useState(!1),[Mt,Gt]=Q.useState(null),[Xt,Qe]=Q.useState(null);Q.useEffect(()=>{qbe(()=>{var _e,At,Ot,tn;(_e=rt.current)==null||_e.dispatchEvent(new Event("input"));let xe=(At=rt.current)==null?void 0:At.selectionStart,Se=(Ot=rt.current)==null?void 0:Ot.selectionEnd,it=(tn=rt.current)==null?void 0:tn.selectionDirection;xe!==null&&Se!==null&&(Gt(xe),Qe(Se),qe.current.prev=[xe,Se,it])})},[fe,$e]),Q.useEffect(()=>{ue!==void 0&&fe!==ue&&ue.length<o&&fe.length===o&&(w==null||w(fe))},[o,w,ue,fe]);let Ge=Jbe({containerRef:tt,inputRef:rt,pushPasswordManagerStrategy:C,isFocused:$e}),He=Q.useCallback(_e=>{let At=_e.currentTarget.value.slice(0,o);if(At.length>0&&We&&!We.test(At)){_e.preventDefault();return}typeof ue=="string"&&At.length<ue.length&&document.dispatchEvent(new Event("selectionchange")),Ee(At)},[o,Ee,ue,We]),De=Q.useCallback(()=>{var _e;if(rt.current){let At=Math.min(rt.current.value.length,o-1),Ot=rt.current.value.length;(_e=rt.current)==null||_e.setSelectionRange(At,Ot),Gt(At),Qe(Ot)}ut(!0)},[o]),kt=Q.useCallback(_e=>{var At,Ot;let tn=rt.current;if(!M&&(!Ye.current.isIOS||!_e.clipboardData||!tn))return;let xe=_e.clipboardData.getData("text/plain"),Se=M?M(xe):xe;console.log({_content:xe,content:Se}),_e.preventDefault();let it=(At=rt.current)==null?void 0:At.selectionStart,Le=(Ot=rt.current)==null?void 0:Ot.selectionEnd,Pe=(it!==Le?fe.slice(0,it)+Se+fe.slice(Le):fe.slice(0,it)+Se+fe.slice(it)).slice(0,o);if(Pe.length>0&&We&&!We.test(Pe))return;tn.value=Pe,Ee(Pe);let vt=Math.min(Pe.length,o-1),yt=Pe.length;tn.setSelectionRange(vt,yt),Gt(vt),Qe(yt)},[o,Ee,We,fe]),rn=Q.useMemo(()=>({position:"relative",cursor:P.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[P.disabled]),Re=Q.useMemo(()=>({position:"absolute",inset:0,width:Ge.willPushPWMBadge?`calc(100% + ${Ge.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:Ge.willPushPWMBadge?`inset(0 ${Ge.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:c,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[Ge.PWM_BADGE_SPACE_WIDTH,Ge.willPushPWMBadge,c]),Kt=Q.useMemo(()=>Q.createElement("input",jbe(Wbe({autoComplete:P.autoComplete||"one-time-code"},P),{"data-input-otp":!0,"data-input-otp-placeholder-shown":fe.length===0||void 0,"data-input-otp-mss":Mt,"data-input-otp-mse":Xt,inputMode:v,pattern:We==null?void 0:We.source,"aria-placeholder":f,style:Re,maxLength:o,value:fe,ref:rt,onPaste:_e=>{var At;kt(_e),(At=P.onPaste)==null||At.call(P,_e)},onChange:He,onMouseOver:_e=>{var At;Me(!0),(At=P.onMouseOver)==null||At.call(P,_e)},onMouseLeave:_e=>{var At;Me(!1),(At=P.onMouseLeave)==null||At.call(P,_e)},onFocus:_e=>{var At;De(),(At=P.onFocus)==null||At.call(P,_e)},onBlur:_e=>{var At;ut(!1),(At=P.onBlur)==null||At.call(P,_e)}})),[He,De,kt,v,Re,o,Xt,Mt,P,We==null?void 0:We.source,fe]),bt=Q.useMemo(()=>({slots:Array.from({length:o}).map((_e,At)=>{var Ot;let tn=$e&&Mt!==null&&Xt!==null&&(Mt===Xt&&At===Mt||At>=Mt&&At<Xt),xe=fe[At]!==void 0?fe[At]:null,Se=fe[0]!==void 0?null:(Ot=f==null?void 0:f[At])!=null?Ot:null;return{char:xe,placeholderChar:Se,isActive:tn,hasFakeCaret:tn&&xe===null}}),isFocused:$e,isHovering:!P.disabled&&ft}),[$e,ft,o,Xt,Mt,P.disabled,fe]),Dt=Q.useMemo(()=>z?z(bt):Q.createElement(lK.Provider,{value:bt},L),[L,bt,z]);return Q.createElement(Q.Fragment,null,N!==null&&Q.createElement("noscript",null,Q.createElement("style",null,N)),Q.createElement("div",{ref:tt,"data-input-otp-container":!0,style:rn,className:F},Dt,Q.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Kt)))});cK.displayName="Input";function zC(t,e){try{t.insertRule(e)}catch{console.error("input-otp could not insert CSS rule:",e)}}var Qbe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const uK=Q.forwardRef(({className:t,containerClassName:e,onFirstCompletion:n,onChange:i,...r},o)=>{const[c,s]=Q.useState(!1),f=v=>{i==null||i(v),!c&&v.length===r.maxLength&&(n==null||n(v),s(!0))};return re.jsx(cK,{ref:o,containerClassName:Ar("flex items-center gap-2 has-[:disabled]:opacity-50",e),className:Ar("disabled:cursor-not-allowed",t),onChange:f,...r})});uK.displayName="InputOTP";const Lk=Q.forwardRef(({className:t,...e},n)=>re.jsx("div",{ref:n,className:Ar("flex items-center",t),...e}));Lk.displayName="InputOTPGroup";const Ty=Q.forwardRef(({index:t,className:e,...n},i)=>{const r=Q.useContext(lK),{char:o,hasFakeCaret:c,isActive:s}=r.slots[t];return re.jsxs("div",{ref:i,className:Ar("relative flex h-10 w-10 items-center justify-center border-y border-r border-stone-200 text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md dark:border-stone-800",s&&"z-10 ring-2 ring-stone-950 ring-offset-white dark:ring-stone-300 dark:ring-offset-stone-950",e),...n,children:[o,c&&re.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:re.jsx("div",{className:"h-4 w-px animate-caret-blink bg-stone-950 duration-1000 dark:bg-stone-50"})})]})});Ty.displayName="InputOTPSlot";const hK=Q.forwardRef(({...t},e)=>re.jsx("div",{ref:e,role:"separator",...t,children:re.jsx(_oe,{})}));hK.displayName="InputOTPSeparator";function eEe(t){return pd({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 7h3"},child:[]},{tag:"path",attr:{d:"M3 11h2"},child:[]},{tag:"path",attr:{d:"M9.02 8.801l-.6 6a2 2 0 0 0 1.99 2.199h7.98a2 2 0 0 0 1.99 -1.801l.6 -6a2 2 0 0 0 -1.99 -2.199h-7.98a2 2 0 0 0 -1.99 1.801z"},child:[]},{tag:"path",attr:{d:"M9.8 7.5l2.982 3.28a3 3 0 0 0 4.238 .202l3.28 -2.982"},child:[]}]})(t)}function tEe(t){return pd({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M228.9 79.9L51.8 403.1C40.6 423.3 55.5 448 78.9 448h354.3c23.3 0 38.2-24.7 27.1-44.9L283.1 79.9c-11.7-21.2-42.5-21.2-54.2 0zM273.6 214L270 336h-28l-3.6-122h35.2zM256 402.4c-10.7 0-19.1-8.1-19.1-18.4s8.4-18.4 19.1-18.4 19.1 8.1 19.1 18.4-8.4 18.4-19.1 18.4z"},child:[]}]})(t)}const _B="https://mywayrtkapi.cyrusbowman.com",Ok=_v();async function nEe({otp:t,email:e}){e&&Ok.set(cS,e);const n=Ok.get(cS);return console.log("validateOTP",n,t),Wr.post(_B+"/token/otp",{email:n,otp:t},{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(i){return console.log(i.data),uo.token=i.data.token,uo.refreshToken=i.data.refreshToken,localStorage.setItem("refreshToken",uo.refreshToken),console.log("Set Refresh Token to:",uo.refreshToken),i.data})}async function iEe(t){const e=Ok.get(cS);return console.log("sendOTP",e),Wr.post(_B+"/token/verify",{email:e}).then(function(n){console.log(n.data)})}async function rEe(t){const e=await q9(t+"myway");return console.log("resetPassword",e),Wr.post(_B+"/token/resetPassword",{password:e},{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(n){console.log(n.data)})}const dK=Pa(!1),sEe=_v();function fK(t){sEe.set(dK,t)}function oEe(){const[t,e]=Q.useState(""),[n,i]=Q.useState(""),r=Yp({mutationFn:async()=>rEe(t),onSuccess:o=>{fK(!1)},onError:(o,{auto:c})=>{throw console.log("error",o),o}});return re.jsxs(sh,{className:"sm:max-w-md",children:[re.jsxs(oh,{children:[re.jsx("div",{className:"flex justify-center",children:re.jsx("img",{src:CA,className:"logo",alt:"MyWay RTK"})}),re.jsx(lh,{className:"text-center text-xl",children:"Update Your Password"}),re.jsx(ch,{className:"text-center pt-3 pb-3"})]}),re.jsx(gr,{htmlFor:"123password",children:"New Password"}),re.jsx("div",{className:"flex justify-center",children:re.jsx(qr,{id:"123password",name:"password",type:"password",value:t,required:!0,onChange:o=>{e(o.target.value)},className:"relative block w-full appearance-none rounded-b-md border border-input bg-background px-3 py-2 text-foreground placeholder-muted-foreground focus:z-10 focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"})}),re.jsx(gr,{htmlFor:"confirmPassword",children:"Confirm Password"}),re.jsx("div",{className:"flex justify-center",children:re.jsx(qr,{id:"confirmPassword",name:"confirmPassword",type:"password",value:n,required:!0,onChange:o=>{i(o.target.value)},className:"relative block w-full appearance-none rounded-b-md border border-input bg-background px-3 py-2 text-foreground placeholder-muted-foreground focus:z-10 focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"})}),re.jsxs(gr,{className:Ar("text-orange-600 flex items-center",!n&&"invisible",t==n&&"invisible"),children:[re.jsx(rK,{className:"mr-2 size-6"}),"Passwords do not match."]}),re.jsxs(ah,{className:"mt-6 just",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",className:"mr-2",children:"Cancel"})}),re.jsx(No,{type:"button",className:"w-24",onClick:r.mutate,disabled:!t||!n||t!=n,children:"Save"})]})]})}function aEe(){const[t,e]=Ha(dK);return re.jsx(vd,{open:t,onOpenChange:e,children:t&&re.jsx(oEe,{})})}const pK=Pa(!1),lEe=_v();function mK(t){lEe.set(pK,t)}function cEe({children:t}){const[e,n]=Cse(),i=mw(),[r,o]=Ha(pK),c=lm(),[s,f]=Q.useState(""),[v,w]=Q.useState(null),C=Yp({mutationFn:async({otp:N,email:z=null})=>nEe({otp:N||s,email:z}),onSuccess:N=>{o(!1),c("/customers"),fK(!0)},onError:(N,{auto:z})=>{var L;if(console.log("auto",z),((L=N==null?void 0:N.response)==null?void 0:L.status)==401&&!z)console.log("Wrong key!"),w(401);else throw console.log("error",N),N}}),M=Yp({mutationFn:async()=>(w(null),await new Promise(N=>setTimeout(N,500)),iEe())}),F=Q.useRef(!1);return Q.useEffect(()=>{if(!F.current&&i.pathname=="/verify"){const N=e.get("code"),z=e.get("email");console.log("pathname",i.pathname),o(!0),n({}),N&&z&&C.mutate({otp:N,email:z})}F.current=!0},[]),re.jsxs(vd,{open:r||i.pathname=="/verify",onOpenChange:o,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),re.jsxs(sh,{className:"sm:max-w-md",hideClose:i.pathname=="/verify",children:[re.jsxs(oh,{children:[re.jsx(lh,{className:"text-center text-xl",children:"Verification Required"}),re.jsx(ch,{className:"text-center",children:"A verification email has been sent to your inbox. Please click the link or enter the code provided to verify your account."}),re.jsx("div",{className:"flex justify-center",children:re.jsx(eEe,{className:"mt-6",size:120,stroke:"#000",style:{stroke:"#000",strokeWidth:1}})})]}),re.jsx("div",{className:"flex justify-center",children:re.jsxs(uK,{maxLength:6,onChange:N=>{console.log(N),f(N)},onFirstCompletion:N=>C.mutate({otp:N,auto:!0}),children:[re.jsxs(Lk,{children:[re.jsx(Ty,{index:0}),re.jsx(Ty,{index:1}),re.jsx(Ty,{index:2})]}),re.jsx(hK,{}),re.jsxs(Lk,{children:[re.jsx(Ty,{index:3}),re.jsx(Ty,{index:4}),re.jsx(Ty,{index:5})]})]})}),re.jsxs("div",{className:Ar("flex bg-yellow-100 p-4 rounded align-middle",!v&&"hidden"),children:[re.jsx(tEe,{className:"size-16 mr-4"}),re.jsx("div",{className:"text-sm",children:"Hmm, that code doesn't seem right. Double-check and give it another go! If you are having trouble, you can request a new code."})]}),re.jsxs(ah,{className:"mt-8 just",children:[re.jsx(No,{type:"button",variant:"secondary",className:"mr-2",onClick:M.mutate,disabled:M.isPending,children:"Send A New Code"}),re.jsx(No,{type:"button",disabled:s.length!=6,className:"w-24",onClick:C.mutate,children:"Verify"})]})]})]})}const gK=Pa(!1),vK=Pa(""),yK=Pa(""),XD=_v();function KD(t,e,n){XD.set(vK,e||"Something went wrong. Please try again later or contact support if it continues."),XD.set(yK,n||"Oops!"),XD.set(gK,t)}function uEe({children:t}){const e=YR(vK),n=YR(yK),[i,r]=Ha(gK);return re.jsxs(vd,{open:i,onOpenChange:r,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),re.jsxs(sh,{className:"sm:max-w-md",children:[re.jsxs(oh,{children:[re.jsx("div",{className:"flex justify-center mb-2 mt-2",children:re.jsx(mB,{size:100,fill:"#FBE6E5",stroke:"#000",style:{stroke:"#000",strokeWidth:.2}})}),re.jsx(lh,{className:"text-center",children:n}),re.jsx(ch,{className:"text-center pt-3 pb-3",children:e.split(`
`).map((o,c)=>re.jsxs("span",{children:[o,re.jsx("br",{})]},c))})]}),re.jsx(ah,{className:"sm:justify-center *:w-32",children:re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",children:"Continue"})})})]})]})}const _K=Pa(!1),hEe=_v();function xB(t){hEe.set(_K,t)}function dEe({initialEmail:t}){const[e,n]=Q.useState(t),[i,r]=Q.useState(!0),o=xv(cS),c=Yp({mutationFn:async()=>iK.isEmail(e)?Ube({username:e}):(r(!1),!1),onSuccess:s=>{console.log("data",s),o(s.email),mK(!0),xB(!1)},onError:s=>{if(s.response&&s.response.status===404)return KD(!0,"We couldn't find an account with that email address. Please check and try again.","Uh-oh!");if(s.response&&s.response.status===429)return KD(!0,".","Uh-oh!");console.log("error",s),KD(!0)}});return re.jsxs(sh,{className:"sm:max-w-sm",children:[re.jsxs(oh,{children:[re.jsx("div",{className:"flex justify-center",children:re.jsx("img",{src:CA,className:"logo",alt:"MyWay RTK"})}),re.jsx(lh,{className:"text-center text-xl",children:"Forgot password?"}),re.jsx(ch,{className:"pt-3 pb-3 text-black",children:"Don't worry! Fill in your email and we'll send you a code to reset your password."})]}),re.jsx(gr,{htmlFor:"forgotPWemail",children:"Email Address"}),re.jsx("div",{className:"flex justify-center",children:re.jsx(qr,{id:"forgotPWemail",name:"email",value:e,placeholder:"e.g. johndoe@gmail.com",required:!0,onChange:s=>{i||r(!0),n(s.target.value)},className:"relative block w-full appearance-none rounded-b-md border border-input bg-background px-3 py-2 text-foreground placeholder-muted-foreground focus:z-10 focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"})}),re.jsxs(gr,{className:Ar("text-orange-600 flex items-center",i&&"hidden"),children:[re.jsx(rK,{className:"mr-2 size-6"}),"Please enter a valid email."]}),re.jsxs(ah,{className:"mt-6 just",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",className:"mr-2",children:"Back to Login"})}),re.jsx(No,{type:"button",className:"w-24",onClick:c.mutate,disabled:!i||c.isPending,children:c.isPending?re.jsx(ov,{className:"animate-spin"}):"Send Email"})]})]})}function fEe(){const[t,e]=Ha(_K),n=YR(CK);return re.jsx(vd,{open:t,onOpenChange:e,children:t&&re.jsx(dEe,{initialEmail:iK.isEmail(n)?n:""})})}const xK=Pa(!1),pEe=_v();function mEe(t){pEe.set(xK,t)}function gEe({children:t}){const[e,n]=Ha(xK);return re.jsxs(vd,{open:e,onOpenChange:n,children:[re.jsx(hm,{children:re.jsx(re.Fragment,{children:t})}),re.jsxs(sh,{className:"sm:max-w-md",children:[re.jsxs(oh,{children:[re.jsx("div",{className:"flex justify-center mb-2 mt-2",children:re.jsx(mB,{size:100,fill:"#FBE6E5",stroke:"#000",style:{stroke:"#000",strokeWidth:.2}})}),re.jsx(lh,{className:"text-center",children:"Uh-oh!"}),re.jsxs(ch,{className:"text-center pt-3 pb-3",children:["That email or password doesn’t seem right.",re.jsx("br",{}),"Give it another try!"]})]}),re.jsxs(ah,{className:"sm:justify-center *:w-40",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",className:"mr-2",onClick:()=>xB(!0),children:"Forgot Password"})}),re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",children:"Try Again"})})]})]})]})}var wK={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://mywayrtkapi.cyrusbowman.com"};const CK=Pa(wK.VITE_LOGIN_USER||""),vEe=Pa(wK.VITE_LOGIN_PASSWORD||""),cS=Pa("");function YD(){const t=lm(),[e,n]=Ha(CK),[i,r]=Ha(vEe),o=xv(cS),[c,s]=Q.useState(!1);return re.jsx("div",{className:"flex min-h-[100dvh] w-full items-center justify-center bg-background px-4 py-12 sm:px-6 lg:px-8",children:re.jsxs("div",{className:"mx-auto w-full max-w-md space-y-8",children:[re.jsxs("div",{children:[re.jsx("img",{src:CA,alt:"MyWayRTK",className:"mx-auto h-24 w-auto"}),re.jsx("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-foreground",children:"Sign in to your account"})]}),re.jsxs("form",{className:"mt-8 space-y-6",onSubmit:f=>{f.preventDefault()},children:[re.jsxs("div",{className:"-space-y-px rounded-md shadow-sm",children:[re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"email",className:"sr-only",children:"Email address or username"}),re.jsx(qr,{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"relative block w-full appearance-none rounded-t-md border border-input bg-background px-3 py-2 text-foreground placeholder-muted-foreground focus:z-10 focus:border-primary focus:outline-none focus:ring-primary sm:text-sm",placeholder:"Email address or username",value:e,onChange:f=>n(f.target.value)})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"password",className:"sr-only",children:"Password"}),re.jsx(qr,{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full appearance-none rounded-b-md border border-input bg-background px-3 py-2 text-foreground placeholder-muted-foreground focus:z-10 focus:border-primary focus:outline-none focus:ring-primary sm:text-sm",placeholder:"Password",value:i,onChange:f=>r(f.target.value)})]})]}),re.jsxs("div",{className:"flex items-center justify-between",children:[re.jsxs("div",{className:"flex items-center",children:[re.jsx(BX,{id:"remember-me",name:"remember-me"}),re.jsx(gr,{htmlFor:"remember-me",className:"ml-2 block text-sm text-muted-foreground",children:"Remember me"})]}),re.jsx("div",{className:"text-sm",children:re.jsx("span",{href:"#",className:"font-medium text-primary hover:text-primary/80 cursor-pointer",onClick:()=>xB(!0),children:"Forgot your password?"})})]}),re.jsxs("div",{children:[re.jsx(No,{type:"submit",className:"group relative flex w-full justify-center",disabled:c,onClick:async()=>{var f,v;s(!0);try{await ece(e.trim(),i),t("/customers")}catch(w){if(w.message=="Network Error")x1e(!0);else if(w.status==401)mEe(!0);else if(w.status==403)o((v=(f=w.response)==null?void 0:f.data)==null?void 0:v.email),mK(!0);else throw w}s(!1)},children:c?re.jsx(ov,{className:"animate-spin mr-2"}):"Sign in"}),re.jsx(w1e,{}),re.jsx(gEe,{}),re.jsx(cEe,{}),re.jsx(fEe,{})]})]})]})})}const SK=Pa(!1);function yEe({onSave:t}){const e=xv(SK),n=O_(),i=Yp({mutationFn:s=>ice({...s}),onSuccess:()=>{e(!1),n.invalidateQueries({queryKey:["customers"]})}}),[r,o]=Q.useState({name:"",firstName:"",lastName:"",workPhone:"",mobilePhone:"",address:"",address2:"",city:"",state:"",zip:""}),c=s=>{const{name:f,id:v,value:w}=s.target,C=f||v;o(M=>({...M,[C]:w}))};return re.jsxs(sh,{className:"sm:max-w-xl",children:[re.jsxs(oh,{children:[re.jsx(lh,{children:"Add Customer"}),re.jsx(ch,{children:"Create a new customer."})]}),re.jsxs("div",{className:"grid grid-cols-2 gap-2 gap-x-6",children:[re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"name",className:"text-slate-700",children:"Company Name"}),re.jsx(qr,{className:"mt-1",type:"text",id:"name",value:r.name,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"firstName",className:"text-slate-700",children:"First Name"}),re.jsx(qr,{type:"text",id:"firstName",className:"mt-1",value:r.firstName,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"lastName",className:"text-slate-700",children:"Last Name"}),re.jsx(qr,{type:"text",id:"lastName",className:"mt-1",value:r.lastName,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"workPhone",className:"text-slate-700",children:"Work Phone"}),re.jsx(qr,{type:"text",id:"workPhone",className:"mt-1",value:r.workPhone,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"mobilePhone",className:"text-slate-700",children:"Mobile Phone"}),re.jsx(qr,{type:"text",id:"mobilePhone",className:"mt-1",value:r.mobilePhone,onChange:c})]}),re.jsxs("div",{className:"col-span-2",children:[re.jsx(gr,{htmlFor:"address",className:"text-slate-700",children:"Address"}),re.jsx(qr,{type:"text",id:"address",className:"mt-1",value:r.address,onChange:c}),re.jsx(qr,{type:"text",id:"address2",className:"mt-1",value:r.address2,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"city",className:"text-slate-700",children:"City"}),re.jsx(qr,{type:"text",id:"city",className:"mt-1",value:r.city,onChange:c})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"state",className:"text-slate-700",children:"State"}),re.jsx(fB,{title:"Select a state...",id:"state",className:"mt-1",value:r.state,onValueChange:s=>c({target:{id:"state",value:s}})})]}),re.jsxs("div",{children:[re.jsx(gr,{htmlFor:"zip",className:"text-slate-700",children:"Zip Code"}),re.jsx(qr,{type:"text",id:"zip",className:"mt-1",value:r.zip,onChange:c})]})]}),re.jsxs(ah,{className:"sm:justify-end *:w-32",children:[re.jsx(cd,{asChild:!0,children:re.jsx(No,{type:"button",variant:"secondary",children:"Close"})}),re.jsx(No,{type:"button",disabled:i.isPending,onClick:()=>i.mutate(r),children:i.isPending?re.jsx(ov,{className:"animate-spin mr-2"}):"Save"})]})]})}function _Ee(){const[t,e]=Ha(SK);return re.jsxs(vd,{open:t,onOpenChange:e,children:[re.jsx(hm,{asChild:!0,children:re.jsxs("div",{className:"flex items-center cursor-pointer hover:text-stone-600",children:[re.jsx(MX,{}),re.jsx("span",{className:"ml-2 text-sm",children:"add customer"})]})}),t&&re.jsx(yEe,{})]})}const xEe=Pa({});function wEe(){const{data:t,error:e,isLoading:n}=bf({queryKey:["customers"],queryFn:tce,refetchInterval:6e4}),[i,r]=Ha(xEe),o=lm(),[c,s]=Q.useState([{headerName:"Name",children:[{field:"name",headerName:"Company",filter:!0},{field:"firstName",headerName:"First",filter:!0},{field:"lastName",headerName:"Last",filter:!0}]},{headerName:"Subscriptions",children:[{field:"subscriptionsOnline",headerName:"Online",flex:1,sort:"desc"},{field:"subscriptionsActive",headerName:"Active",columnGroupShow:"open",flex:1},{field:"subscriptionsExpired",headerName:"Expired",columnGroupShow:"open",flex:1},{field:"subscriptionsExpiringSoon",headerName:"Expiring Soon",columnGroupShow:"open",flex:1}]}]);return re.jsxs("div",{className:"w-screen h-screen  bg-[#FBFBFB] flex flex-col",children:[re.jsxs("div",{className:"flex items-middle justify-between p-2 px-4",children:[re.jsx("div",{className:"text-black text-xl font-bold",children:"Customers"}),re.jsx(_Ee,{})]}),re.jsx("div",{className:"flex-grow",children:re.jsx("div",{className:"ag-theme-quartz",style:{width:"100%",height:"100%"},children:re.jsx(zq,{style:{width:"100%",height:"100%"},rowData:t,columnDefs:c,onRowClicked:f=>{o(`/customers/${f.data.id}`)},onFirstDataRendered:f=>{},onGridPreDestroyed:f=>{r(f.api.getState())},gridOptions:{initialState:(({focusedCell:f,...v})=>v)(i),enableCellTextSelection:!0}})})})]})}const bK=Q.createContext(null);function CEe(){var t;const e=(t=Q.useContext(bK))===null||t===void 0?void 0:t.maps,n=Q.useContext(Lw);return Q.useMemo(()=>({...e,current:n==null?void 0:n.map}),[e,n])}function SEe(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===o}function qu(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!qu(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!qu(t[r],e[r]))return!1;return!0}return!1}function bEe(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function $H(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();qu(n,i)||e.setProjection(n)}function qH(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function ZH(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const EEe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function XH(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const o=e[i.ref];if(o){r=r||Object.assign({},i),delete r.ref;for(const c of EEe)c in o&&(r[c]=o[c])}return r||i});return{...t,layers:n}}var KH={};const YH={version:8,sources:{},layers:[]},JH={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},JD={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},QH={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},MEe=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],REe=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ow{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const o=this.props[QH[r.type]];o?o(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const o=this.props[JH[r.type]];o&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),o(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const o=this.props[JD[r.type]];o&&o(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),o=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=ow.savedMaps.pop();if(!i)return null;const r=i.map,o=r.getContainer();for(n.className=o.className;o.childNodes.length>0;)n.appendChild(o.childNodes[0]);r._container=n;const c=r._resizeObserver;c&&(c.disconnect(),c.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:s}=e;return s&&(s.bounds?r.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):i._updateViewState(s,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=YH}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||TEe()||null,container:e,style:XH(i)},o=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),n.gl){const w=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=w,n.gl)}const c=new this._MapClass(r);o.padding&&c.setPadding(o.padding),n.cursor&&(c.getCanvas().style.cursor=n.cursor),this._createShadowTransform(c);const s=c._render;c._render=w=>{this._inRender=!0,s.call(c,w),this._inRender=!1};const f=c._renderTaskQueue.run;c._renderTaskQueue.run=w=>{f.call(c._renderTaskQueue,w),this._onBeforeRepaint()},c.on("render",()=>this._onAfterRepaint());const v=c.fire;c.fire=this._fireEvent.bind(this,v),c.on("resize",()=>{this._renderTransform.resize(c.transform.width,c.transform.height)}),c.on("styledata",()=>{this._updateStyleComponents(this.props,{}),$H(c.transform,this._renderTransform)}),c.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const w in JH)c.on(w,this._onPointerEvent);for(const w in JD)c.on(w,this._onCameraEvent);for(const w in QH)c.on(w,this._onEvent);this._map=c}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),ow.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=bEe(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:o,pitch:c,bearing:s}=r,f=i.isMoving();f&&(r.cameraElevationReference="sea");const v=ZH(r,{...qH(i.transform),...e});if(f&&(r.cameraElevationReference="ground"),v&&n){const w=this._deferredEvents;w.move=!0,w.zoom||(w.zoom=o!==r.zoom),w.rotate||(w.rotate=s!==r.bearing),w.pitch||(w.pitch=c!==r.pitch)}return f||ZH(i.transform,e),v}_updateSettings(e,n){const i=this._map;let r=!1;for(const o of MEe)if(o in e&&!qu(e[o],n[o])){r=!0;const c=i[`set${o[0].toUpperCase()}${o.slice(1)}`];c==null||c.call(i,e[o])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=YH,styleDiffing:r=!0}=e,o={diff:r};return"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(XH(i),o),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!qu(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!qu(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!qu(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const o=this._map;let c=!1;for(const s of REe){const f=(i=e[s])!==null&&i!==void 0?i:!0,v=(r=n[s])!==null&&r!==void 0?r:!0;qu(f,v)||(c=!0,f?o[s].enable(f):o[s].disable())}return c}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const o=e.type,c=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,s=this._queryRenderedFeatures(e.point),f=s.length>0;!f&&c&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=s,f&&!c&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,o=r.transform,c=typeof n=="string"?n:n.type;return c==="move"&&this._updateViewState(this.props,!1),c in JD&&(typeof n=="object"&&(n.viewState=qH(o)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=o,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{$H(this._renderTransform,n),e.transform=n}}}ow.savedMaps=[];function TEe(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||KH.MapboxAccessToken}catch{}try{t=t||KH.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const AEe=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function PEe(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const o=e.project(i);return e.transform=r,o},unproject:i=>{const r=e.transform;e.transform=t.transform;const o=e.unproject(i);return e.transform=r,o},queryTerrainElevation:(i,r)=>{const o=e.transform;e.transform=t.transform;const c=e.queryTerrainElevation(i,r);return e.transform=o,c},queryRenderedFeatures:(i,r)=>{const o=e.transform;e.transform=t.transform;const c=e.queryRenderedFeatures(i,r);return e.transform=o,c}};for(const i of IEe(e))!(i in n)&&!AEe.includes(i)&&(n[i]=e[i].bind(e));return n}function IEe(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const DEe=typeof document<"u"?Q.useLayoutEffect:Q.useEffect,FEe=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function LEe(t,e){for(const i of FEe)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const Lw=Q.createContext(null);function EK(t,e,n){const i=Q.useContext(bK),[r,o]=Q.useState(null),c=Q.useRef(),{current:s}=Q.useRef({mapLib:null,map:null});Q.useEffect(()=>{const w=t.mapLib;let C=!0,M;return Promise.resolve(w||n).then(F=>{if(!C)return;if(!F)throw new Error("Invalid mapLib");const N="Map"in F?F:F.default;if(!N.Map)throw new Error("Invalid mapLib");if(LEe(N,t),!N.supported||N.supported(t))t.reuseMaps&&(M=ow.reuse(t,c.current)),M||(M=new ow(N.Map,t,c.current)),s.map=PEe(M),s.mapLib=N,o(M),i==null||i.onMapMount(s.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(F=>{const{onError:N}=t;N?N({type:"error",target:null,originalEvent:null,error:F}):console.error(F)}),()=>{C=!1,M&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?M.recycle():M.destroy())}},[]),DEe(()=>{r&&r.setProps(t)}),Q.useImperativeHandle(e,()=>s.map,[r]);const f=Q.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),v={height:"100%"};return Q.createElement("div",{id:t.id,ref:c,style:f},r&&Q.createElement(Lw.Provider,{value:s},Q.createElement("div",{"mapboxgl-children":"",style:v},t.children)))}const OEe=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function G_(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!OEe.test(i)?n[i]=`${r}px`:n[i]=r}}function kEe(t,e){const{map:n,mapLib:i}=Q.useContext(Lw),r=Q.useRef({props:t});r.current.props=t;const o=Q.useMemo(()=>{let z=!1;Q.Children.forEach(t.children,H=>{H&&(z=!0)});const L={...t,element:z?document.createElement("div"):null},P=new i.Marker(L);return P.setLngLat([t.longitude,t.latitude]),P.getElement().addEventListener("click",H=>{var j,q;(q=(j=r.current.props).onClick)===null||q===void 0||q.call(j,{type:"click",target:P,originalEvent:H})}),P.on("dragstart",H=>{var j,q;const le=H;le.lngLat=o.getLngLat(),(q=(j=r.current.props).onDragStart)===null||q===void 0||q.call(j,le)}),P.on("drag",H=>{var j,q;const le=H;le.lngLat=o.getLngLat(),(q=(j=r.current.props).onDrag)===null||q===void 0||q.call(j,le)}),P.on("dragend",H=>{var j,q;const le=H;le.lngLat=o.getLngLat(),(q=(j=r.current.props).onDragEnd)===null||q===void 0||q.call(j,le)}),P},[]);Q.useEffect(()=>(o.addTo(n.getMap()),()=>{o.remove()}),[]);const{longitude:c,latitude:s,offset:f,style:v,draggable:w=!1,popup:C=null,rotation:M=0,rotationAlignment:F="auto",pitchAlignment:N="auto"}=t;return Q.useEffect(()=>{G_(o.getElement(),v)},[v]),Q.useImperativeHandle(e,()=>o,[]),(o.getLngLat().lng!==c||o.getLngLat().lat!==s)&&o.setLngLat([c,s]),f&&!SEe(o.getOffset(),f)&&o.setOffset(f),o.isDraggable()!==w&&o.setDraggable(w),o.getRotation()!==M&&o.setRotation(M),o.getRotationAlignment()!==F&&o.setRotationAlignment(F),o.getPitchAlignment()!==N&&o.setPitchAlignment(N),o.getPopup()!==C&&o.setPopup(C),rh.createPortal(t.children,o.getElement())}Q.memo(Q.forwardRef(kEe));function e6(t){return new Set(t?t.trim().split(/\s+/):[])}function NEe(t,e){const{map:n,mapLib:i}=Q.useContext(Lw),r=Q.useMemo(()=>document.createElement("div"),[]),o=Q.useRef({props:t});o.current.props=t;const c=Q.useMemo(()=>{const s={...t},f=new i.Popup(s);return f.setLngLat([t.longitude,t.latitude]),f.once("open",v=>{var w,C;(C=(w=o.current.props).onOpen)===null||C===void 0||C.call(w,v)}),f},[]);if(Q.useEffect(()=>{const s=f=>{var v,w;(w=(v=o.current.props).onClose)===null||w===void 0||w.call(v,f)};return c.on("close",s),c.setDOMContent(r).addTo(n.getMap()),()=>{c.off("close",s),c.isOpen()&&c.remove()}},[]),Q.useEffect(()=>{G_(c.getElement(),t.style)},[t.style]),Q.useImperativeHandle(e,()=>c,[]),c.isOpen()&&((c.getLngLat().lng!==t.longitude||c.getLngLat().lat!==t.latitude)&&c.setLngLat([t.longitude,t.latitude]),t.offset&&!qu(c.options.offset,t.offset)&&c.setOffset(t.offset),(c.options.anchor!==t.anchor||c.options.maxWidth!==t.maxWidth)&&(c.options.anchor=t.anchor,c.setMaxWidth(t.maxWidth)),c.options.className!==t.className)){const s=e6(c.options.className),f=e6(t.className);for(const v of s)f.has(v)||c.removeClassName(v);for(const v of f)s.has(v)||c.addClassName(v);c.options.className=t.className}return rh.createPortal(t.children,r)}const BEe=Q.memo(Q.forwardRef(NEe));function ib(t,e,n,i){const r=Q.useContext(Lw),o=Q.useMemo(()=>t(r),[]);return Q.useEffect(()=>{const c=e,s=typeof e=="function"&&typeof n=="function"?e:null,f=typeof e=="function"?e:null,{map:v}=r;return v.hasControl(o)||(v.addControl(o,c==null?void 0:c.position),s&&s(r)),()=>{f&&f(r),v.hasControl(o)&&v.removeControl(o)}},[]),o}function zEe(t){const e=ib(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Q.useEffect(()=>{G_(e._container,t.style)},[t.style]),null}Q.memo(zEe);function UEe(t){const e=ib(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Q.useEffect(()=>{G_(e._controlContainer,t.style)},[t.style]),null}Q.memo(UEe);function VEe(t,e){const n=Q.useRef({props:t}),i=ib(({mapLib:r})=>{const o=new r.GeolocateControl(t),c=o._setupUI;return o._setupUI=s=>{o._container.hasChildNodes()||c(s)},o.on("geolocate",s=>{var f,v;(v=(f=n.current.props).onGeolocate)===null||v===void 0||v.call(f,s)}),o.on("error",s=>{var f,v;(v=(f=n.current.props).onError)===null||v===void 0||v.call(f,s)}),o.on("outofmaxbounds",s=>{var f,v;(v=(f=n.current.props).onOutOfMaxBounds)===null||v===void 0||v.call(f,s)}),o.on("trackuserlocationstart",s=>{var f,v;(v=(f=n.current.props).onTrackUserLocationStart)===null||v===void 0||v.call(f,s)}),o.on("trackuserlocationend",s=>{var f,v;(v=(f=n.current.props).onTrackUserLocationEnd)===null||v===void 0||v.call(f,s)}),o},{position:t.position});return n.current.props=t,Q.useImperativeHandle(e,()=>i,[]),Q.useEffect(()=>{G_(i._container,t.style)},[t.style]),null}Q.memo(Q.forwardRef(VEe));function GEe(t){const e=ib(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Q.useEffect(()=>{G_(e._container,t.style)},[t.style]),null}Q.memo(GEe);function HEe(t){const e=ib(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),n=Q.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),Q.useEffect(()=>{G_(e._container,r)},[r]),null}Q.memo(HEe);function t6(t,e){if(!t)throw new Error(e)}function WEe(t,e,n,i){if(t6(n.id===i.id,"layer id changed"),t6(n.type===i.type,"layer type changed"),n.type==="custom"||i.type==="custom")return;const{layout:r={},paint:o={},filter:c,minzoom:s,maxzoom:f,beforeId:v}=n;if(v!==i.beforeId&&t.moveLayer(e,v),r!==i.layout){const w=i.layout||{};for(const C in r)qu(r[C],w[C])||t.setLayoutProperty(e,C,r[C]);for(const C in w)r.hasOwnProperty(C)||t.setLayoutProperty(e,C,void 0)}if(o!==i.paint){const w=i.paint||{};for(const C in o)qu(o[C],w[C])||t.setPaintProperty(e,C,o[C]);for(const C in w)o.hasOwnProperty(C)||t.setPaintProperty(e,C,void 0)}qu(c,i.filter)||t.setFilter(e,c),(s!==i.minzoom||f!==i.maxzoom)&&t.setLayerZoomRange(e,s,f)}function jEe(t,e,n){if(t.style&&t.style._loaded&&(!("source"in n)||t.getSource(n.source))){const i={...n,id:e};delete i.beforeId,t.addLayer(i,n.beforeId)}}let $Ee=0;function qEe(t){const e=Q.useContext(Lw).map.getMap(),n=Q.useRef(t),[,i]=Q.useState(0),r=Q.useMemo(()=>t.id||`jsx-layer-${$Ee++}`,[]);if(Q.useEffect(()=>{if(e){const c=()=>i(s=>s+1);return e.on("styledata",c),c(),()=>{e.off("styledata",c),e.style&&e.style._loaded&&e.getLayer(r)&&e.removeLayer(r)}}},[e]),e&&e.style&&e.getLayer(r))try{WEe(e,r,t,n.current)}catch(c){console.warn(c)}else jEe(e,r,t);return n.current=t,null}const ZEe=vT(()=>import("./maplibre-gl-DUD6cCg-.js").then(t=>t.m),[]),XEe=Q.forwardRef(function(e,n){return EK(e,n,ZEe)}),MK=BEe;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const rb="170",KEe={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},YEe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},RK=0,kk=1,TK=2,JEe=3,AK=0,WA=1,M1=2,qh=3,im=0,Jl=1,gf=2,Wp=0,a_=1,Nk=2,Bk=3,zk=4,PK=5,Ig=100,IK=101,DK=102,FK=103,LK=104,OK=200,kK=201,NK=202,BK=203,xT=204,wT=205,zK=206,UK=207,VK=208,GK=209,HK=210,WK=211,jK=212,$K=213,qK=214,CT=0,ST=1,bT=2,E_=3,ET=4,MT=5,RT=6,TT=7,sb=0,ZK=1,XK=2,Cf=0,KK=1,YK=2,JK=3,wB=4,QK=5,eY=6,tY=7,Uk="attached",nY="detached",jA=300,rm=301,dv=302,uS=303,hS=304,Ow=306,dS=1e3,Yu=1001,fS=1002,el=1003,CB=1004,QEe=1004,mx=1005,eMe=1005,Ma=1006,R1=1007,tMe=1007,vf=1008,nMe=1008,dd=1009,SB=1010,bB=1011,aw=1012,$A=1013,sm=1014,kc=1015,kw=1016,qA=1017,ZA=1018,M_=1020,EB=35902,MB=1021,RB=1022,wl=1023,TB=1024,AB=1025,l_=1026,R_=1027,XA=1028,ob=1029,PB=1030,KA=1031,iMe=1032,YA=1033,T1=33776,A1=33777,P1=33778,I1=33779,AT=35840,PT=35841,IT=35842,DT=35843,FT=36196,LT=37492,OT=37496,kT=37808,NT=37809,BT=37810,zT=37811,UT=37812,VT=37813,GT=37814,HT=37815,WT=37816,jT=37817,$T=37818,qT=37819,ZT=37820,XT=37821,D1=36492,KT=36494,YT=36495,IB=36283,JT=36284,QT=36285,eA=36286,iY=2200,rY=2201,sY=2202,pS=2300,tA=2301,pR=2302,Uy=2400,Vy=2401,mS=2402,JA=2500,DB=2501,rMe=0,sMe=1,oMe=2,oY=3200,aY=3201,aMe=3202,lMe=3203,bv=0,lY=1,Lp="",$l="srgb",H_="srgb-linear",ab="linear",Ns="srgb",cMe=0,Ay=7680,uMe=7681,hMe=7682,dMe=7683,fMe=34055,pMe=34056,mMe=5386,gMe=512,vMe=513,yMe=514,_Me=515,xMe=516,wMe=517,CMe=518,Vk=519,cY=512,uY=513,hY=514,FB=515,dY=516,fY=517,pY=518,mY=519,gS=35044,SMe=35048,bMe=35040,EMe=35045,MMe=35049,RMe=35041,TMe=35046,AMe=35050,PMe=35042,IMe="100",Gk="300 es",yf=2e3,vS=2001;class Pf{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let o=0,c=r.length;o<c;o++)r[o].call(this,e);e.target=null}}}const pl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let n6=1234567;const c_=Math.PI/180,lw=180/Math.PI;function xu(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(pl[t&255]+pl[t>>8&255]+pl[t>>16&255]+pl[t>>24&255]+"-"+pl[e&255]+pl[e>>8&255]+"-"+pl[e>>16&15|64]+pl[e>>24&255]+"-"+pl[n&63|128]+pl[n>>8&255]+"-"+pl[n>>16&255]+pl[n>>24&255]+pl[i&255]+pl[i>>8&255]+pl[i>>16&255]+pl[i>>24&255]).toLowerCase()}function Xo(t,e,n){return Math.max(e,Math.min(n,t))}function LB(t,e){return(t%e+e)%e}function DMe(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)}function FMe(t,e,n){return t!==e?(n-t)/(e-t):0}function F1(t,e,n){return(1-n)*t+n*e}function LMe(t,e,n,i){return F1(t,e,1-Math.exp(-n*i))}function OMe(t,e=1){return e-Math.abs(LB(t,e*2)-e)}function kMe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function NMe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function BMe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function zMe(t,e){return t+Math.random()*(e-t)}function UMe(t){return t*(.5-Math.random())}function VMe(t){t!==void 0&&(n6=t);let e=n6+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function GMe(t){return t*c_}function HMe(t){return t*lw}function WMe(t){return(t&t-1)===0&&t!==0}function jMe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function $Me(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function qMe(t,e,n,i,r){const o=Math.cos,c=Math.sin,s=o(n/2),f=c(n/2),v=o((e+i)/2),w=c((e+i)/2),C=o((e-i)/2),M=c((e-i)/2),F=o((i-e)/2),N=c((i-e)/2);switch(r){case"XYX":t.set(s*w,f*C,f*M,s*v);break;case"YZY":t.set(f*M,s*w,f*C,s*v);break;case"ZXZ":t.set(f*C,f*M,s*w,s*v);break;case"XZX":t.set(s*w,f*N,f*F,s*v);break;case"YXY":t.set(f*F,s*w,f*N,s*v);break;case"ZYZ":t.set(f*N,f*F,s*w,s*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Zl(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Fr(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const ZMe={DEG2RAD:c_,RAD2DEG:lw,generateUUID:xu,clamp:Xo,euclideanModulo:LB,mapLinear:DMe,inverseLerp:FMe,lerp:F1,damp:LMe,pingpong:OMe,smoothstep:kMe,smootherstep:NMe,randInt:BMe,randFloat:zMe,randFloatSpread:UMe,seededRandom:VMe,degToRad:GMe,radToDeg:HMe,isPowerOfTwo:WMe,ceilPowerOfTwo:jMe,floorPowerOfTwo:$Me,setQuaternionFromProperEuler:qMe,normalize:Fr,denormalize:Zl};class Cn{constructor(e=0,n=0){Cn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6],this.y=r[1]*n+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Xo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),r=Math.sin(n),o=this.x-e.x,c=this.y-e.y;return this.x=o*i-c*r+e.x,this.y=o*r+c*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class dr{constructor(e,n,i,r,o,c,s,f,v){dr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,r,o,c,s,f,v)}set(e,n,i,r,o,c,s,f,v){const w=this.elements;return w[0]=e,w[1]=r,w[2]=s,w[3]=n,w[4]=o,w[5]=f,w[6]=i,w[7]=c,w[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,o=this.elements,c=i[0],s=i[3],f=i[6],v=i[1],w=i[4],C=i[7],M=i[2],F=i[5],N=i[8],z=r[0],L=r[3],P=r[6],H=r[1],j=r[4],q=r[7],le=r[2],ce=r[5],ae=r[8];return o[0]=c*z+s*H+f*le,o[3]=c*L+s*j+f*ce,o[6]=c*P+s*q+f*ae,o[1]=v*z+w*H+C*le,o[4]=v*L+w*j+C*ce,o[7]=v*P+w*q+C*ae,o[2]=M*z+F*H+N*le,o[5]=M*L+F*j+N*ce,o[8]=M*P+F*q+N*ae,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],v=e[7],w=e[8];return n*c*w-n*s*v-i*o*w+i*s*f+r*o*v-r*c*f}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],v=e[7],w=e[8],C=w*c-s*v,M=s*f-w*o,F=v*o-c*f,N=n*C+i*M+r*F;if(N===0)return this.set(0,0,0,0,0,0,0,0,0);const z=1/N;return e[0]=C*z,e[1]=(r*v-w*i)*z,e[2]=(s*i-r*c)*z,e[3]=M*z,e[4]=(w*n-r*f)*z,e[5]=(r*o-s*n)*z,e[6]=F*z,e[7]=(i*f-v*n)*z,e[8]=(c*n-i*o)*z,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,r,o,c,s){const f=Math.cos(o),v=Math.sin(o);return this.set(i*f,i*v,-i*(f*c+v*s)+c+e,-r*v,r*f,-r*(-v*c+f*s)+s+n,0,0,1),this}scale(e,n){return this.premultiply(QD.makeScale(e,n)),this}rotate(e){return this.premultiply(QD.makeRotation(-e)),this}translate(e,n){return this.premultiply(QD.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<9;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const QD=new dr;function gY(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const XMe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function gx(t,e){return new XMe[t](e)}function yS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function vY(){const t=yS("canvas");return t.style.display="block",t}const i6={};function l1(t){t in i6||(i6[t]=!0,console.warn(t))}function KMe(t,e,n){return new Promise(function(i,r){function o(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(o,n);break;default:i()}}setTimeout(o,n)})}function YMe(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function JMe(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const ls={enabled:!0,workingColorSpace:H_,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===Ns&&(t.r=jp(t.r),t.g=jp(t.g),t.b=jp(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Ns&&(t.r=Fx(t.r),t.g=Fx(t.g),t.b=Fx(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Lp?ab:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function jp(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Fx(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const r6=[.64,.33,.3,.6,.15,.06],s6=[.2126,.7152,.0722],o6=[.3127,.329],a6=new dr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),l6=new dr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ls.define({[H_]:{primaries:r6,whitePoint:o6,transfer:ab,toXYZ:a6,fromXYZ:l6,luminanceCoefficients:s6,workingColorSpaceConfig:{unpackColorSpace:$l},outputColorSpaceConfig:{drawingBufferColorSpace:$l}},[$l]:{primaries:r6,whitePoint:o6,transfer:Ns,toXYZ:a6,fromXYZ:l6,luminanceCoefficients:s6,outputColorSpaceConfig:{drawingBufferColorSpace:$l}}});let P0;class yY{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{P0===void 0&&(P0=yS("canvas")),P0.width=e.width,P0.height=e.height;const i=P0.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=P0}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=yS("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),o=r.data;for(let c=0;c<o.length;c++)o[c]=jp(o[c]/255)*255;return i.putImageData(r,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(jp(n[i]/255)*255):n[i]=jp(n[i]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let QMe=0;class Gy{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:QMe++}),this.uuid=xu(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let c=0,s=r.length;c<s;c++)r[c].isDataTexture?o.push(e2(r[c].image)):o.push(e2(r[c]))}else o=e2(r);i.url=o}return n||(e.images[this.uuid]=i),i}}function e2(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?yY.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let eRe=0;class Oo extends Pf{constructor(e=Oo.DEFAULT_IMAGE,n=Oo.DEFAULT_MAPPING,i=Yu,r=Yu,o=Ma,c=vf,s=wl,f=dd,v=Oo.DEFAULT_ANISOTROPY,w=Lp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:eRe++}),this.uuid=xu(),this.name="",this.source=new Gy(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=o,this.minFilter=c,this.anisotropy=v,this.format=s,this.internalFormat=null,this.type=f,this.offset=new Cn(0,0),this.repeat=new Cn(1,1),this.center=new Cn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=w,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==jA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case dS:e.x=e.x-Math.floor(e.x);break;case Yu:e.x=e.x<0?0:1;break;case fS:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case dS:e.y=e.y-Math.floor(e.y);break;case Yu:e.y=e.y<0?0:1;break;case fS:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Oo.DEFAULT_IMAGE=null;Oo.DEFAULT_MAPPING=jA;Oo.DEFAULT_ANISOTROPY=1;class xs{constructor(e=0,n=0,i=0,r=1){xs.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,o=this.w,c=e.elements;return this.x=c[0]*n+c[4]*i+c[8]*r+c[12]*o,this.y=c[1]*n+c[5]*i+c[9]*r+c[13]*o,this.z=c[2]*n+c[6]*i+c[10]*r+c[14]*o,this.w=c[3]*n+c[7]*i+c[11]*r+c[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,r,o;const f=e.elements,v=f[0],w=f[4],C=f[8],M=f[1],F=f[5],N=f[9],z=f[2],L=f[6],P=f[10];if(Math.abs(w-M)<.01&&Math.abs(C-z)<.01&&Math.abs(N-L)<.01){if(Math.abs(w+M)<.1&&Math.abs(C+z)<.1&&Math.abs(N+L)<.1&&Math.abs(v+F+P-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const j=(v+1)/2,q=(F+1)/2,le=(P+1)/2,ce=(w+M)/4,ae=(C+z)/4,pe=(N+L)/4;return j>q&&j>le?j<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(j),r=ce/i,o=ae/i):q>le?q<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(q),i=ce/r,o=pe/r):le<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(le),i=ae/o,r=pe/o),this.set(i,r,o,n),this}let H=Math.sqrt((L-N)*(L-N)+(C-z)*(C-z)+(M-w)*(M-w));return Math.abs(H)<.001&&(H=1),this.x=(L-N)/H,this.y=(C-z)/H,this.z=(M-w)/H,this.w=Math.acos((v+F+P-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _Y extends Pf{constructor(e=1,n=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new xs(0,0,e,n),this.scissorTest=!1,this.viewport=new xs(0,0,e,n);const r={width:e,height:n,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ma,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const o=new Oo(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);o.flipY=!1,o.generateMipmaps=i.generateMipmaps,o.internalFormat=i.internalFormat,this.textures=[];const c=i.count;for(let s=0;s<c;s++)this.textures[s]=o.clone(),this.textures[s].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let r=0,o=this.textures.length;r<o;r++)this.textures[r].image.width=e,this.textures[r].image.height=n,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new Gy(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fd extends _Y{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class QA extends Oo{constructor(e=null,n=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=el,this.minFilter=el,this.wrapR=Yu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class tRe extends fd{constructor(e=1,n=1,i=1,r={}){super(e,n,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new QA(null,e,n,i),this.texture.isRenderTargetTexture=!0}}class OB extends Oo{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=el,this.minFilter=el,this.wrapR=Yu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class nRe extends fd{constructor(e=1,n=1,i=1,r={}){super(e,n,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new OB(null,e,n,i),this.texture.isRenderTargetTexture=!0}}class Cl{constructor(e=0,n=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}static slerpFlat(e,n,i,r,o,c,s){let f=i[r+0],v=i[r+1],w=i[r+2],C=i[r+3];const M=o[c+0],F=o[c+1],N=o[c+2],z=o[c+3];if(s===0){e[n+0]=f,e[n+1]=v,e[n+2]=w,e[n+3]=C;return}if(s===1){e[n+0]=M,e[n+1]=F,e[n+2]=N,e[n+3]=z;return}if(C!==z||f!==M||v!==F||w!==N){let L=1-s;const P=f*M+v*F+w*N+C*z,H=P>=0?1:-1,j=1-P*P;if(j>Number.EPSILON){const le=Math.sqrt(j),ce=Math.atan2(le,P*H);L=Math.sin(L*ce)/le,s=Math.sin(s*ce)/le}const q=s*H;if(f=f*L+M*q,v=v*L+F*q,w=w*L+N*q,C=C*L+z*q,L===1-s){const le=1/Math.sqrt(f*f+v*v+w*w+C*C);f*=le,v*=le,w*=le,C*=le}}e[n]=f,e[n+1]=v,e[n+2]=w,e[n+3]=C}static multiplyQuaternionsFlat(e,n,i,r,o,c){const s=i[r],f=i[r+1],v=i[r+2],w=i[r+3],C=o[c],M=o[c+1],F=o[c+2],N=o[c+3];return e[n]=s*N+w*C+f*F-v*M,e[n+1]=f*N+w*M+v*C-s*F,e[n+2]=v*N+w*F+s*M-f*C,e[n+3]=w*N-s*C-f*M-v*F,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,r){return this._x=e,this._y=n,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const i=e._x,r=e._y,o=e._z,c=e._order,s=Math.cos,f=Math.sin,v=s(i/2),w=s(r/2),C=s(o/2),M=f(i/2),F=f(r/2),N=f(o/2);switch(c){case"XYZ":this._x=M*w*C+v*F*N,this._y=v*F*C-M*w*N,this._z=v*w*N+M*F*C,this._w=v*w*C-M*F*N;break;case"YXZ":this._x=M*w*C+v*F*N,this._y=v*F*C-M*w*N,this._z=v*w*N-M*F*C,this._w=v*w*C+M*F*N;break;case"ZXY":this._x=M*w*C-v*F*N,this._y=v*F*C+M*w*N,this._z=v*w*N+M*F*C,this._w=v*w*C-M*F*N;break;case"ZYX":this._x=M*w*C-v*F*N,this._y=v*F*C+M*w*N,this._z=v*w*N-M*F*C,this._w=v*w*C+M*F*N;break;case"YZX":this._x=M*w*C+v*F*N,this._y=v*F*C+M*w*N,this._z=v*w*N-M*F*C,this._w=v*w*C-M*F*N;break;case"XZY":this._x=M*w*C-v*F*N,this._y=v*F*C-M*w*N,this._z=v*w*N+M*F*C,this._w=v*w*C+M*F*N;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],r=n[4],o=n[8],c=n[1],s=n[5],f=n[9],v=n[2],w=n[6],C=n[10],M=i+s+C;if(M>0){const F=.5/Math.sqrt(M+1);this._w=.25/F,this._x=(w-f)*F,this._y=(o-v)*F,this._z=(c-r)*F}else if(i>s&&i>C){const F=2*Math.sqrt(1+i-s-C);this._w=(w-f)/F,this._x=.25*F,this._y=(r+c)/F,this._z=(o+v)/F}else if(s>C){const F=2*Math.sqrt(1+s-i-C);this._w=(o-v)/F,this._x=(r+c)/F,this._y=.25*F,this._z=(f+w)/F}else{const F=2*Math.sqrt(1+C-i-s);this._w=(c-r)/F,this._x=(o+v)/F,this._y=(f+w)/F,this._z=.25*F}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Xo(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,n/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,r=e._y,o=e._z,c=e._w,s=n._x,f=n._y,v=n._z,w=n._w;return this._x=i*w+c*s+r*v-o*f,this._y=r*w+c*f+o*s-i*v,this._z=o*w+c*v+i*f-r*s,this._w=c*w-i*s-r*f-o*v,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const i=this._x,r=this._y,o=this._z,c=this._w;let s=c*e._w+i*e._x+r*e._y+o*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=c,this._x=i,this._y=r,this._z=o,this;const f=1-s*s;if(f<=Number.EPSILON){const F=1-n;return this._w=F*c+n*this._w,this._x=F*i+n*this._x,this._y=F*r+n*this._y,this._z=F*o+n*this._z,this.normalize(),this}const v=Math.sqrt(f),w=Math.atan2(v,s),C=Math.sin((1-n)*w)/v,M=Math.sin(n*w)/v;return this._w=c*C+this._w*M,this._x=i*C+this._x*M,this._y=r*C+this._y*M,this._z=o*C+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),o=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),o*Math.sin(n),o*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class gt{constructor(e=0,n=0,i=0){gt.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(c6.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(c6.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*n+o[3]*i+o[6]*r,this.y=o[1]*n+o[4]*i+o[7]*r,this.z=o[2]*n+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,o=e.elements,c=1/(o[3]*n+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*n+o[4]*i+o[8]*r+o[12])*c,this.y=(o[1]*n+o[5]*i+o[9]*r+o[13])*c,this.z=(o[2]*n+o[6]*i+o[10]*r+o[14])*c,this}applyQuaternion(e){const n=this.x,i=this.y,r=this.z,o=e.x,c=e.y,s=e.z,f=e.w,v=2*(c*r-s*i),w=2*(s*n-o*r),C=2*(o*i-c*n);return this.x=n+f*v+c*C-s*w,this.y=i+f*w+s*v-o*C,this.z=r+f*C+o*w-c*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*n+o[4]*i+o[8]*r,this.y=o[1]*n+o[5]*i+o[9]*r,this.z=o[2]*n+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,r=e.y,o=e.z,c=n.x,s=n.y,f=n.z;return this.x=r*f-o*s,this.y=o*c-i*f,this.z=i*s-r*c,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return t2.copy(this).projectOnVector(e),this.sub(t2)}reflect(e){return this.sub(t2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Xo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return n*n+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const r=Math.sin(n)*e;return this.x=r*Math.sin(i),this.y=Math.cos(n)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=r,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,i=Math.sqrt(1-n*n);return this.x=i*Math.cos(e),this.y=n,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const t2=new gt,c6=new Cl;class Ql{constructor(e=new gt(1/0,1/0,1/0),n=new gt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(Hh.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(Hh.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=Hh.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const o=i.getAttribute("position");if(n===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let c=0,s=o.count;c<s;c++)e.isMesh===!0?e.getVertexPosition(c,Hh):Hh.fromBufferAttribute(o,c),Hh.applyMatrix4(e.matrixWorld),this.expandByPoint(Hh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ZE.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),ZE.copy(i.boundingBox)),ZE.applyMatrix4(e.matrixWorld),this.union(ZE)}const r=e.children;for(let o=0,c=r.length;o<c;o++)this.expandByObject(r[o],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Hh),Hh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(UC),XE.subVectors(this.max,UC),I0.subVectors(e.a,UC),D0.subVectors(e.b,UC),F0.subVectors(e.c,UC),gg.subVectors(D0,I0),vg.subVectors(F0,D0),dy.subVectors(I0,F0);let n=[0,-gg.z,gg.y,0,-vg.z,vg.y,0,-dy.z,dy.y,gg.z,0,-gg.x,vg.z,0,-vg.x,dy.z,0,-dy.x,-gg.y,gg.x,0,-vg.y,vg.x,0,-dy.y,dy.x,0];return!n2(n,I0,D0,F0,XE)||(n=[1,0,0,0,1,0,0,0,1],!n2(n,I0,D0,F0,XE))?!1:(KE.crossVectors(gg,vg),n=[KE.x,KE.y,KE.z],n2(n,I0,D0,F0,XE))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Hh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Hh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(wp[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),wp[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),wp[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),wp[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),wp[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),wp[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),wp[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),wp[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(wp),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const wp=[new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt],Hh=new gt,ZE=new Ql,I0=new gt,D0=new gt,F0=new gt,gg=new gt,vg=new gt,dy=new gt,UC=new gt,XE=new gt,KE=new gt,fy=new gt;function n2(t,e,n,i,r){for(let o=0,c=t.length-3;o<=c;o+=3){fy.fromArray(t,o);const s=r.x*Math.abs(fy.x)+r.y*Math.abs(fy.y)+r.z*Math.abs(fy.z),f=e.dot(fy),v=n.dot(fy),w=i.dot(fy);if(Math.max(-Math.max(f,v,w),Math.min(f,v,w))>s)return!1}return!0}const iRe=new Ql,VC=new gt,i2=new gt;class Sl{constructor(e=new gt,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):iRe.setFromPoints(e).getCenter(i);let r=0;for(let o=0,c=e.length;o<c;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;VC.subVectors(e,this.center);const n=VC.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),r=(i-this.radius)*.5;this.center.addScaledVector(VC,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(i2.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(VC.copy(e.center).add(i2)),this.expandByPoint(VC.copy(e.center).sub(i2))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Cp=new gt,r2=new gt,YE=new gt,yg=new gt,s2=new gt,JE=new gt,o2=new gt;class Nw{constructor(e=new gt,n=new gt(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Cp)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Cp.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Cp.copy(this.origin).addScaledVector(this.direction,n),Cp.distanceToSquared(e))}distanceSqToSegment(e,n,i,r){r2.copy(e).add(n).multiplyScalar(.5),YE.copy(n).sub(e).normalize(),yg.copy(this.origin).sub(r2);const o=e.distanceTo(n)*.5,c=-this.direction.dot(YE),s=yg.dot(this.direction),f=-yg.dot(YE),v=yg.lengthSq(),w=Math.abs(1-c*c);let C,M,F,N;if(w>0)if(C=c*f-s,M=c*s-f,N=o*w,C>=0)if(M>=-N)if(M<=N){const z=1/w;C*=z,M*=z,F=C*(C+c*M+2*s)+M*(c*C+M+2*f)+v}else M=o,C=Math.max(0,-(c*M+s)),F=-C*C+M*(M+2*f)+v;else M=-o,C=Math.max(0,-(c*M+s)),F=-C*C+M*(M+2*f)+v;else M<=-N?(C=Math.max(0,-(-c*o+s)),M=C>0?-o:Math.min(Math.max(-o,-f),o),F=-C*C+M*(M+2*f)+v):M<=N?(C=0,M=Math.min(Math.max(-o,-f),o),F=M*(M+2*f)+v):(C=Math.max(0,-(c*o+s)),M=C>0?o:Math.min(Math.max(-o,-f),o),F=-C*C+M*(M+2*f)+v);else M=c>0?-o:o,C=Math.max(0,-(c*M+s)),F=-C*C+M*(M+2*f)+v;return i&&i.copy(this.origin).addScaledVector(this.direction,C),r&&r.copy(r2).addScaledVector(YE,M),F}intersectSphere(e,n){Cp.subVectors(e.center,this.origin);const i=Cp.dot(this.direction),r=Cp.dot(Cp)-i*i,o=e.radius*e.radius;if(r>o)return null;const c=Math.sqrt(o-r),s=i-c,f=i+c;return f<0?null:s<0?this.at(f,n):this.at(s,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,r,o,c,s,f;const v=1/this.direction.x,w=1/this.direction.y,C=1/this.direction.z,M=this.origin;return v>=0?(i=(e.min.x-M.x)*v,r=(e.max.x-M.x)*v):(i=(e.max.x-M.x)*v,r=(e.min.x-M.x)*v),w>=0?(o=(e.min.y-M.y)*w,c=(e.max.y-M.y)*w):(o=(e.max.y-M.y)*w,c=(e.min.y-M.y)*w),i>c||o>r||((o>i||isNaN(i))&&(i=o),(c<r||isNaN(r))&&(r=c),C>=0?(s=(e.min.z-M.z)*C,f=(e.max.z-M.z)*C):(s=(e.max.z-M.z)*C,f=(e.min.z-M.z)*C),i>f||s>r)||((s>i||i!==i)&&(i=s),(f<r||r!==r)&&(r=f),r<0)?null:this.at(i>=0?i:r,n)}intersectsBox(e){return this.intersectBox(e,Cp)!==null}intersectTriangle(e,n,i,r,o){s2.subVectors(n,e),JE.subVectors(i,e),o2.crossVectors(s2,JE);let c=this.direction.dot(o2),s;if(c>0){if(r)return null;s=1}else if(c<0)s=-1,c=-c;else return null;yg.subVectors(this.origin,e);const f=s*this.direction.dot(JE.crossVectors(yg,JE));if(f<0)return null;const v=s*this.direction.dot(s2.cross(yg));if(v<0||f+v>c)return null;const w=-s*yg.dot(o2);return w<0?null:this.at(w/c,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Hi{constructor(e,n,i,r,o,c,s,f,v,w,C,M,F,N,z,L){Hi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,r,o,c,s,f,v,w,C,M,F,N,z,L)}set(e,n,i,r,o,c,s,f,v,w,C,M,F,N,z,L){const P=this.elements;return P[0]=e,P[4]=n,P[8]=i,P[12]=r,P[1]=o,P[5]=c,P[9]=s,P[13]=f,P[2]=v,P[6]=w,P[10]=C,P[14]=M,P[3]=F,P[7]=N,P[11]=z,P[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Hi().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,i=e.elements,r=1/L0.setFromMatrixColumn(e,0).length(),o=1/L0.setFromMatrixColumn(e,1).length(),c=1/L0.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[7]=0,n[8]=i[8]*c,n[9]=i[9]*c,n[10]=i[10]*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,r=e.y,o=e.z,c=Math.cos(i),s=Math.sin(i),f=Math.cos(r),v=Math.sin(r),w=Math.cos(o),C=Math.sin(o);if(e.order==="XYZ"){const M=c*w,F=c*C,N=s*w,z=s*C;n[0]=f*w,n[4]=-f*C,n[8]=v,n[1]=F+N*v,n[5]=M-z*v,n[9]=-s*f,n[2]=z-M*v,n[6]=N+F*v,n[10]=c*f}else if(e.order==="YXZ"){const M=f*w,F=f*C,N=v*w,z=v*C;n[0]=M+z*s,n[4]=N*s-F,n[8]=c*v,n[1]=c*C,n[5]=c*w,n[9]=-s,n[2]=F*s-N,n[6]=z+M*s,n[10]=c*f}else if(e.order==="ZXY"){const M=f*w,F=f*C,N=v*w,z=v*C;n[0]=M-z*s,n[4]=-c*C,n[8]=N+F*s,n[1]=F+N*s,n[5]=c*w,n[9]=z-M*s,n[2]=-c*v,n[6]=s,n[10]=c*f}else if(e.order==="ZYX"){const M=c*w,F=c*C,N=s*w,z=s*C;n[0]=f*w,n[4]=N*v-F,n[8]=M*v+z,n[1]=f*C,n[5]=z*v+M,n[9]=F*v-N,n[2]=-v,n[6]=s*f,n[10]=c*f}else if(e.order==="YZX"){const M=c*f,F=c*v,N=s*f,z=s*v;n[0]=f*w,n[4]=z-M*C,n[8]=N*C+F,n[1]=C,n[5]=c*w,n[9]=-s*w,n[2]=-v*w,n[6]=F*C+N,n[10]=M-z*C}else if(e.order==="XZY"){const M=c*f,F=c*v,N=s*f,z=s*v;n[0]=f*w,n[4]=-C,n[8]=v*w,n[1]=M*C+z,n[5]=c*w,n[9]=F*C-N,n[2]=N*C-F,n[6]=s*w,n[10]=z*C+M}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(rRe,e,sRe)}lookAt(e,n,i){const r=this.elements;return cu.subVectors(e,n),cu.lengthSq()===0&&(cu.z=1),cu.normalize(),_g.crossVectors(i,cu),_g.lengthSq()===0&&(Math.abs(i.z)===1?cu.x+=1e-4:cu.z+=1e-4,cu.normalize(),_g.crossVectors(i,cu)),_g.normalize(),QE.crossVectors(cu,_g),r[0]=_g.x,r[4]=QE.x,r[8]=cu.x,r[1]=_g.y,r[5]=QE.y,r[9]=cu.y,r[2]=_g.z,r[6]=QE.z,r[10]=cu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,o=this.elements,c=i[0],s=i[4],f=i[8],v=i[12],w=i[1],C=i[5],M=i[9],F=i[13],N=i[2],z=i[6],L=i[10],P=i[14],H=i[3],j=i[7],q=i[11],le=i[15],ce=r[0],ae=r[4],pe=r[8],fe=r[12],ue=r[1],Ee=r[5],We=r[9],rt=r[13],tt=r[2],Ye=r[6],qe=r[10],ft=r[14],Me=r[3],$e=r[7],ut=r[11],Mt=r[15];return o[0]=c*ce+s*ue+f*tt+v*Me,o[4]=c*ae+s*Ee+f*Ye+v*$e,o[8]=c*pe+s*We+f*qe+v*ut,o[12]=c*fe+s*rt+f*ft+v*Mt,o[1]=w*ce+C*ue+M*tt+F*Me,o[5]=w*ae+C*Ee+M*Ye+F*$e,o[9]=w*pe+C*We+M*qe+F*ut,o[13]=w*fe+C*rt+M*ft+F*Mt,o[2]=N*ce+z*ue+L*tt+P*Me,o[6]=N*ae+z*Ee+L*Ye+P*$e,o[10]=N*pe+z*We+L*qe+P*ut,o[14]=N*fe+z*rt+L*ft+P*Mt,o[3]=H*ce+j*ue+q*tt+le*Me,o[7]=H*ae+j*Ee+q*Ye+le*$e,o[11]=H*pe+j*We+q*qe+le*ut,o[15]=H*fe+j*rt+q*ft+le*Mt,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],r=e[8],o=e[12],c=e[1],s=e[5],f=e[9],v=e[13],w=e[2],C=e[6],M=e[10],F=e[14],N=e[3],z=e[7],L=e[11],P=e[15];return N*(+o*f*C-r*v*C-o*s*M+i*v*M+r*s*F-i*f*F)+z*(+n*f*F-n*v*M+o*c*M-r*c*F+r*v*w-o*f*w)+L*(+n*v*C-n*s*F-o*c*C+i*c*F+o*s*w-i*v*w)+P*(-r*s*w-n*f*C+n*s*M+r*c*C-i*c*M+i*f*w)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=n,r[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],v=e[7],w=e[8],C=e[9],M=e[10],F=e[11],N=e[12],z=e[13],L=e[14],P=e[15],H=C*L*v-z*M*v+z*f*F-s*L*F-C*f*P+s*M*P,j=N*M*v-w*L*v-N*f*F+c*L*F+w*f*P-c*M*P,q=w*z*v-N*C*v+N*s*F-c*z*F-w*s*P+c*C*P,le=N*C*f-w*z*f-N*s*M+c*z*M+w*s*L-c*C*L,ce=n*H+i*j+r*q+o*le;if(ce===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ae=1/ce;return e[0]=H*ae,e[1]=(z*M*o-C*L*o-z*r*F+i*L*F+C*r*P-i*M*P)*ae,e[2]=(s*L*o-z*f*o+z*r*v-i*L*v-s*r*P+i*f*P)*ae,e[3]=(C*f*o-s*M*o-C*r*v+i*M*v+s*r*F-i*f*F)*ae,e[4]=j*ae,e[5]=(w*L*o-N*M*o+N*r*F-n*L*F-w*r*P+n*M*P)*ae,e[6]=(N*f*o-c*L*o-N*r*v+n*L*v+c*r*P-n*f*P)*ae,e[7]=(c*M*o-w*f*o+w*r*v-n*M*v-c*r*F+n*f*F)*ae,e[8]=q*ae,e[9]=(N*C*o-w*z*o-N*i*F+n*z*F+w*i*P-n*C*P)*ae,e[10]=(c*z*o-N*s*o+N*i*v-n*z*v-c*i*P+n*s*P)*ae,e[11]=(w*s*o-c*C*o-w*i*v+n*C*v+c*i*F-n*s*F)*ae,e[12]=le*ae,e[13]=(w*z*r-N*C*r+N*i*M-n*z*M-w*i*L+n*C*L)*ae,e[14]=(N*s*r-c*z*r-N*i*f+n*z*f+c*i*L-n*s*L)*ae,e[15]=(c*C*r-w*s*r+w*i*f-n*C*f-c*i*M+n*s*M)*ae,this}scale(e){const n=this.elements,i=e.x,r=e.y,o=e.z;return n[0]*=i,n[4]*=r,n[8]*=o,n[1]*=i,n[5]*=r,n[9]*=o,n[2]*=i,n[6]*=r,n[10]*=o,n[3]*=i,n[7]*=r,n[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,r))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),r=Math.sin(n),o=1-i,c=e.x,s=e.y,f=e.z,v=o*c,w=o*s;return this.set(v*c+i,v*s-r*f,v*f+r*s,0,v*s+r*f,w*s+i,w*f-r*c,0,v*f-r*s,w*f+r*c,o*f*f+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,r,o,c){return this.set(1,i,o,0,e,1,c,0,n,r,1,0,0,0,0,1),this}compose(e,n,i){const r=this.elements,o=n._x,c=n._y,s=n._z,f=n._w,v=o+o,w=c+c,C=s+s,M=o*v,F=o*w,N=o*C,z=c*w,L=c*C,P=s*C,H=f*v,j=f*w,q=f*C,le=i.x,ce=i.y,ae=i.z;return r[0]=(1-(z+P))*le,r[1]=(F+q)*le,r[2]=(N-j)*le,r[3]=0,r[4]=(F-q)*ce,r[5]=(1-(M+P))*ce,r[6]=(L+H)*ce,r[7]=0,r[8]=(N+j)*ae,r[9]=(L-H)*ae,r[10]=(1-(M+z))*ae,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,n,i){const r=this.elements;let o=L0.set(r[0],r[1],r[2]).length();const c=L0.set(r[4],r[5],r[6]).length(),s=L0.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Wh.copy(this);const v=1/o,w=1/c,C=1/s;return Wh.elements[0]*=v,Wh.elements[1]*=v,Wh.elements[2]*=v,Wh.elements[4]*=w,Wh.elements[5]*=w,Wh.elements[6]*=w,Wh.elements[8]*=C,Wh.elements[9]*=C,Wh.elements[10]*=C,n.setFromRotationMatrix(Wh),i.x=o,i.y=c,i.z=s,this}makePerspective(e,n,i,r,o,c,s=yf){const f=this.elements,v=2*o/(n-e),w=2*o/(i-r),C=(n+e)/(n-e),M=(i+r)/(i-r);let F,N;if(s===yf)F=-(c+o)/(c-o),N=-2*c*o/(c-o);else if(s===vS)F=-c/(c-o),N=-c*o/(c-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return f[0]=v,f[4]=0,f[8]=C,f[12]=0,f[1]=0,f[5]=w,f[9]=M,f[13]=0,f[2]=0,f[6]=0,f[10]=F,f[14]=N,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(e,n,i,r,o,c,s=yf){const f=this.elements,v=1/(n-e),w=1/(i-r),C=1/(c-o),M=(n+e)*v,F=(i+r)*w;let N,z;if(s===yf)N=(c+o)*C,z=-2*C;else if(s===vS)N=o*C,z=-1*C;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return f[0]=2*v,f[4]=0,f[8]=0,f[12]=-M,f[1]=0,f[5]=2*w,f[9]=0,f[13]=-F,f[2]=0,f[6]=0,f[10]=z,f[14]=-N,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const L0=new gt,Wh=new Hi,rRe=new gt(0,0,0),sRe=new gt(1,1,1),_g=new gt,QE=new gt,cu=new gt,u6=new Hi,h6=new Cl;class nc{constructor(e=0,n=0,i=0,r=nc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,r=this._order){return this._x=e,this._y=n,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const r=e.elements,o=r[0],c=r[4],s=r[8],f=r[1],v=r[5],w=r[9],C=r[2],M=r[6],F=r[10];switch(n){case"XYZ":this._y=Math.asin(Xo(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-w,F),this._z=Math.atan2(-c,o)):(this._x=Math.atan2(M,v),this._z=0);break;case"YXZ":this._x=Math.asin(-Xo(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(s,F),this._z=Math.atan2(f,v)):(this._y=Math.atan2(-C,o),this._z=0);break;case"ZXY":this._x=Math.asin(Xo(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-C,F),this._z=Math.atan2(-c,v)):(this._y=0,this._z=Math.atan2(f,o));break;case"ZYX":this._y=Math.asin(-Xo(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(M,F),this._z=Math.atan2(f,o)):(this._x=0,this._z=Math.atan2(-c,v));break;case"YZX":this._z=Math.asin(Xo(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-w,v),this._y=Math.atan2(-C,o)):(this._x=0,this._y=Math.atan2(s,F));break;case"XZY":this._z=Math.asin(-Xo(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(M,v),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-w,F),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return u6.makeRotationFromQuaternion(e),this.setFromRotationMatrix(u6,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return h6.setFromEuler(this),this.setFromQuaternion(h6,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}nc.DEFAULT_ORDER="XYZ";class u_{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let oRe=0;const d6=new gt,O0=new Cl,Sp=new Hi,eM=new gt,GC=new gt,aRe=new gt,lRe=new Cl,f6=new gt(1,0,0),p6=new gt(0,1,0),m6=new gt(0,0,1),g6={type:"added"},cRe={type:"removed"},k0={type:"childadded",child:null},a2={type:"childremoved",child:null};class Cs extends Pf{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:oRe++}),this.uuid=xu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cs.DEFAULT_UP.clone();const e=new gt,n=new nc,i=new Cl,r=new gt(1,1,1);function o(){i.setFromEuler(n,!1)}function c(){n.setFromQuaternion(i,void 0,!1)}n._onChange(o),i._onChange(c),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Hi},normalMatrix:{value:new dr}}),this.matrix=new Hi,this.matrixWorld=new Hi,this.matrixAutoUpdate=Cs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new u_,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return O0.setFromAxisAngle(e,n),this.quaternion.multiply(O0),this}rotateOnWorldAxis(e,n){return O0.setFromAxisAngle(e,n),this.quaternion.premultiply(O0),this}rotateX(e){return this.rotateOnAxis(f6,e)}rotateY(e){return this.rotateOnAxis(p6,e)}rotateZ(e){return this.rotateOnAxis(m6,e)}translateOnAxis(e,n){return d6.copy(e).applyQuaternion(this.quaternion),this.position.add(d6.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(f6,e)}translateY(e){return this.translateOnAxis(p6,e)}translateZ(e){return this.translateOnAxis(m6,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Sp.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?eM.copy(e):eM.set(e,n,i);const r=this.parent;this.updateWorldMatrix(!0,!1),GC.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sp.lookAt(GC,eM,this.up):Sp.lookAt(eM,GC,this.up),this.quaternion.setFromRotationMatrix(Sp),r&&(Sp.extractRotation(r.matrixWorld),O0.setFromRotationMatrix(Sp),this.quaternion.premultiply(O0.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(g6),k0.child=e,this.dispatchEvent(k0),k0.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(cRe),a2.child=e,this.dispatchEvent(a2),a2.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Sp.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Sp.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sp),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(g6),k0.child=e,this.dispatchEvent(k0),k0.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,r=this.children.length;i<r;i++){const c=this.children[i].getObjectByProperty(e,n);if(c!==void 0)return c}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);const r=this.children;for(let o=0,c=r.length;o<c;o++)r[o].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(GC,e,aRe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(GC,lRe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const r=this.children;for(let o=0,c=r.length;o<c;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(s=>({boxInitialized:s.boxInitialized,boxMin:s.box.min.toArray(),boxMax:s.box.max.toArray(),sphereInitialized:s.sphereInitialized,sphereRadius:s.sphere.radius,sphereCenter:s.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function o(s,f){return s[f.uuid]===void 0&&(s[f.uuid]=f.toJSON(e)),f.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const f=s.shapes;if(Array.isArray(f))for(let v=0,w=f.length;v<w;v++){const C=f[v];o(e.shapes,C)}else o(e.shapes,f)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let f=0,v=this.material.length;f<v;f++)s.push(o(e.materials,this.material[f]));r.material=s}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let s=0;s<this.animations.length;s++){const f=this.animations[s];r.animations.push(o(e.animations,f))}}if(n){const s=c(e.geometries),f=c(e.materials),v=c(e.textures),w=c(e.images),C=c(e.shapes),M=c(e.skeletons),F=c(e.animations),N=c(e.nodes);s.length>0&&(i.geometries=s),f.length>0&&(i.materials=f),v.length>0&&(i.textures=v),w.length>0&&(i.images=w),C.length>0&&(i.shapes=C),M.length>0&&(i.skeletons=M),F.length>0&&(i.animations=F),N.length>0&&(i.nodes=N)}return i.object=r,i;function c(s){const f=[];for(const v in s){const w=s[v];delete w.metadata,f.push(w)}return f}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Cs.DEFAULT_UP=new gt(0,1,0);Cs.DEFAULT_MATRIX_AUTO_UPDATE=!0;Cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const jh=new gt,bp=new gt,l2=new gt,Ep=new gt,N0=new gt,B0=new gt,v6=new gt,c2=new gt,u2=new gt,h2=new gt,d2=new xs,f2=new xs,p2=new xs;class Fc{constructor(e=new gt,n=new gt,i=new gt){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,r){r.subVectors(i,n),jh.subVectors(e,n),r.cross(jh);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,n,i,r,o){jh.subVectors(r,n),bp.subVectors(i,n),l2.subVectors(e,n);const c=jh.dot(jh),s=jh.dot(bp),f=jh.dot(l2),v=bp.dot(bp),w=bp.dot(l2),C=c*v-s*s;if(C===0)return o.set(0,0,0),null;const M=1/C,F=(v*f-s*w)*M,N=(c*w-s*f)*M;return o.set(1-F-N,N,F)}static containsPoint(e,n,i,r){return this.getBarycoord(e,n,i,r,Ep)===null?!1:Ep.x>=0&&Ep.y>=0&&Ep.x+Ep.y<=1}static getInterpolation(e,n,i,r,o,c,s,f){return this.getBarycoord(e,n,i,r,Ep)===null?(f.x=0,f.y=0,"z"in f&&(f.z=0),"w"in f&&(f.w=0),null):(f.setScalar(0),f.addScaledVector(o,Ep.x),f.addScaledVector(c,Ep.y),f.addScaledVector(s,Ep.z),f)}static getInterpolatedAttribute(e,n,i,r,o,c){return d2.setScalar(0),f2.setScalar(0),p2.setScalar(0),d2.fromBufferAttribute(e,n),f2.fromBufferAttribute(e,i),p2.fromBufferAttribute(e,r),c.setScalar(0),c.addScaledVector(d2,o.x),c.addScaledVector(f2,o.y),c.addScaledVector(p2,o.z),c}static isFrontFacing(e,n,i,r){return jh.subVectors(i,n),bp.subVectors(e,n),jh.cross(bp).dot(r)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,r){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,n,i,r){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return jh.subVectors(this.c,this.b),bp.subVectors(this.a,this.b),jh.cross(bp).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Fc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Fc.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,i,r,o){return Fc.getInterpolation(e,this.a,this.b,this.c,n,i,r,o)}containsPoint(e){return Fc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Fc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,r=this.b,o=this.c;let c,s;N0.subVectors(r,i),B0.subVectors(o,i),c2.subVectors(e,i);const f=N0.dot(c2),v=B0.dot(c2);if(f<=0&&v<=0)return n.copy(i);u2.subVectors(e,r);const w=N0.dot(u2),C=B0.dot(u2);if(w>=0&&C<=w)return n.copy(r);const M=f*C-w*v;if(M<=0&&f>=0&&w<=0)return c=f/(f-w),n.copy(i).addScaledVector(N0,c);h2.subVectors(e,o);const F=N0.dot(h2),N=B0.dot(h2);if(N>=0&&F<=N)return n.copy(o);const z=F*v-f*N;if(z<=0&&v>=0&&N<=0)return s=v/(v-N),n.copy(i).addScaledVector(B0,s);const L=w*N-F*C;if(L<=0&&C-w>=0&&F-N>=0)return v6.subVectors(o,r),s=(C-w)/(C-w+(F-N)),n.copy(r).addScaledVector(v6,s);const P=1/(L+z+M);return c=z*P,s=M*P,n.copy(i).addScaledVector(N0,c).addScaledVector(B0,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const xY={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xg={h:0,s:0,l:0},tM={h:0,s:0,l:0};function m2(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class bi{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=$l){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ls.toWorkingColorSpace(this,n),this}setRGB(e,n,i,r=ls.workingColorSpace){return this.r=e,this.g=n,this.b=i,ls.toWorkingColorSpace(this,r),this}setHSL(e,n,i,r=ls.workingColorSpace){if(e=LB(e,1),n=Xo(n,0,1),i=Xo(i,0,1),n===0)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+n):i+n-i*n,c=2*i-o;this.r=m2(c,o,e+1/3),this.g=m2(c,o,e),this.b=m2(c,o,e-1/3)}return ls.toWorkingColorSpace(this,r),this}setStyle(e,n=$l){function i(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const c=r[1],s=r[2];switch(c){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,n);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,n);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],c=o.length;if(c===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,n);if(c===6)return this.setHex(parseInt(o,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=$l){const i=xY[e.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=jp(e.r),this.g=jp(e.g),this.b=jp(e.b),this}copyLinearToSRGB(e){return this.r=Fx(e.r),this.g=Fx(e.g),this.b=Fx(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=$l){return ls.fromWorkingColorSpace(ml.copy(this),e),Math.round(Xo(ml.r*255,0,255))*65536+Math.round(Xo(ml.g*255,0,255))*256+Math.round(Xo(ml.b*255,0,255))}getHexString(e=$l){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=ls.workingColorSpace){ls.fromWorkingColorSpace(ml.copy(this),n);const i=ml.r,r=ml.g,o=ml.b,c=Math.max(i,r,o),s=Math.min(i,r,o);let f,v;const w=(s+c)/2;if(s===c)f=0,v=0;else{const C=c-s;switch(v=w<=.5?C/(c+s):C/(2-c-s),c){case i:f=(r-o)/C+(r<o?6:0);break;case r:f=(o-i)/C+2;break;case o:f=(i-r)/C+4;break}f/=6}return e.h=f,e.s=v,e.l=w,e}getRGB(e,n=ls.workingColorSpace){return ls.fromWorkingColorSpace(ml.copy(this),n),e.r=ml.r,e.g=ml.g,e.b=ml.b,e}getStyle(e=$l){ls.fromWorkingColorSpace(ml.copy(this),e);const n=ml.r,i=ml.g,r=ml.b;return e!==$l?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,n,i){return this.getHSL(xg),this.setHSL(xg.h+e,xg.s+n,xg.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(xg),e.getHSL(tM);const i=F1(xg.h,tM.h,n),r=F1(xg.s,tM.s,n),o=F1(xg.l,tM.l,n);return this.setHSL(i,r,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,r=this.b,o=e.elements;return this.r=o[0]*n+o[3]*i+o[6]*r,this.g=o[1]*n+o[4]*i+o[7]*r,this.b=o[2]*n+o[5]*i+o[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ml=new bi;bi.NAMES=xY;let uRe=0;class nl extends Pf{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:uRe++}),this.uuid=xu(),this.name="",this.blending=a_,this.side=im,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=xT,this.blendDst=wT,this.blendEquation=Ig,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bi(0,0,0),this.blendAlpha=0,this.depthFunc=E_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Vk,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ay,this.stencilZFail=Ay,this.stencilZPass=Ay,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==a_&&(i.blending=this.blending),this.side!==im&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==xT&&(i.blendSrc=this.blendSrc),this.blendDst!==wT&&(i.blendDst=this.blendDst),this.blendEquation!==Ig&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==E_&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Vk&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ay&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Ay&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Ay&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(o){const c=[];for(const s in o){const f=o[s];delete f.metadata,c.push(f)}return c}if(n){const o=r(e.textures),c=r(e.images);o.length>0&&(i.textures=o),c.length>0&&(i.images=c)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const r=n.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=n[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ev extends nl{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nc,this.combine=sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Op=hRe();function hRe(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let f=0;f<256;++f){const v=f-127;v<-27?(i[f]=0,i[f|256]=32768,r[f]=24,r[f|256]=24):v<-14?(i[f]=1024>>-v-14,i[f|256]=1024>>-v-14|32768,r[f]=-v-1,r[f|256]=-v-1):v<=15?(i[f]=v+15<<10,i[f|256]=v+15<<10|32768,r[f]=13,r[f|256]=13):v<128?(i[f]=31744,i[f|256]=64512,r[f]=24,r[f|256]=24):(i[f]=31744,i[f|256]=64512,r[f]=13,r[f|256]=13)}const o=new Uint32Array(2048),c=new Uint32Array(64),s=new Uint32Array(64);for(let f=1;f<1024;++f){let v=f<<13,w=0;for(;!(v&8388608);)v<<=1,w-=8388608;v&=-8388609,w+=947912704,o[f]=v|w}for(let f=1024;f<2048;++f)o[f]=939524096+(f-1024<<13);for(let f=1;f<31;++f)c[f]=f<<23;c[31]=1199570944,c[32]=2147483648;for(let f=33;f<63;++f)c[f]=2147483648+(f-32<<23);c[63]=3347054592;for(let f=1;f<64;++f)f!==32&&(s[f]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:o,exponentTable:c,offsetTable:s}}function Tc(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Xo(t,-65504,65504),Op.floatView[0]=t;const e=Op.uint32View[0],n=e>>23&511;return Op.baseTable[n]+((e&8388607)>>Op.shiftTable[n])}function c1(t){const e=t>>10;return Op.uint32View[0]=Op.mantissaTable[Op.offsetTable[e]+(t&1023)]+Op.exponentTable[e],Op.floatView[0]}const dRe={toHalfFloat:Tc,fromHalfFloat:c1},ma=new gt,nM=new Cn;class ns{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=gS,this.updateRanges=[],this.gpuType=kc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=n.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)nM.fromBufferAttribute(this,n),nM.applyMatrix3(e),this.setXY(n,nM.x,nM.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)ma.fromBufferAttribute(this,n),ma.applyMatrix3(e),this.setXYZ(n,ma.x,ma.y,ma.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)ma.fromBufferAttribute(this,n),ma.applyMatrix4(e),this.setXYZ(n,ma.x,ma.y,ma.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)ma.fromBufferAttribute(this,n),ma.applyNormalMatrix(e),this.setXYZ(n,ma.x,ma.y,ma.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)ma.fromBufferAttribute(this,n),ma.transformDirection(e),this.setXYZ(n,ma.x,ma.y,ma.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=Zl(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=Fr(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Zl(n,this.array)),n}setX(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Zl(n,this.array)),n}setY(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Zl(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Zl(n,this.array)),n}setW(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,n,i,r,o){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array),o=Fr(o,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==gS&&(e.usage=this.usage),e}}class fRe extends ns{constructor(e,n,i){super(new Int8Array(e),n,i)}}class pRe extends ns{constructor(e,n,i){super(new Uint8Array(e),n,i)}}class mRe extends ns{constructor(e,n,i){super(new Uint8ClampedArray(e),n,i)}}class gRe extends ns{constructor(e,n,i){super(new Int16Array(e),n,i)}}class kB extends ns{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class vRe extends ns{constructor(e,n,i){super(new Int32Array(e),n,i)}}class NB extends ns{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class yRe extends ns{constructor(e,n,i){super(new Uint16Array(e),n,i),this.isFloat16BufferAttribute=!0}getX(e){let n=c1(this.array[e*this.itemSize]);return this.normalized&&(n=Zl(n,this.array)),n}setX(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize]=Tc(n),this}getY(e){let n=c1(this.array[e*this.itemSize+1]);return this.normalized&&(n=Zl(n,this.array)),n}setY(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+1]=Tc(n),this}getZ(e){let n=c1(this.array[e*this.itemSize+2]);return this.normalized&&(n=Zl(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+2]=Tc(n),this}getW(e){let n=c1(this.array[e*this.itemSize+3]);return this.normalized&&(n=Zl(n,this.array)),n}setW(e,n){return this.normalized&&(n=Fr(n,this.array)),this.array[e*this.itemSize+3]=Tc(n),this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array)),this.array[e+0]=Tc(n),this.array[e+1]=Tc(i),this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array)),this.array[e+0]=Tc(n),this.array[e+1]=Tc(i),this.array[e+2]=Tc(r),this}setXYZW(e,n,i,r,o){return e*=this.itemSize,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array),o=Fr(o,this.array)),this.array[e+0]=Tc(n),this.array[e+1]=Tc(i),this.array[e+2]=Tc(r),this.array[e+3]=Tc(o),this}}class Ni extends ns{constructor(e,n,i){super(new Float32Array(e),n,i)}}let _Re=0;const Gu=new Hi,g2=new Cs,z0=new gt,uu=new Ql,HC=new Ql,Ba=new gt;class Cr extends Pf{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_Re++}),this.uuid=xu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gY(e)?NB:kB)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new dr().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Gu.makeRotationFromQuaternion(e),this.applyMatrix4(Gu),this}rotateX(e){return Gu.makeRotationX(e),this.applyMatrix4(Gu),this}rotateY(e){return Gu.makeRotationY(e),this.applyMatrix4(Gu),this}rotateZ(e){return Gu.makeRotationZ(e),this.applyMatrix4(Gu),this}translate(e,n,i){return Gu.makeTranslation(e,n,i),this.applyMatrix4(Gu),this}scale(e,n,i){return Gu.makeScale(e,n,i),this.applyMatrix4(Gu),this}lookAt(e){return g2.lookAt(e),g2.updateMatrix(),this.applyMatrix4(g2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(z0).negate(),this.translate(z0.x,z0.y,z0.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const i=[];for(let r=0,o=e.length;r<o;r++){const c=e[r];i.push(c.x,c.y,c.z||0)}this.setAttribute("position",new Ni(i,3))}else{for(let i=0,r=n.count;i<r;i++){const o=e[i];n.setXYZ(i,o.x,o.y,o.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ql);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new gt(-1/0,-1/0,-1/0),new gt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,r=n.length;i<r;i++){const o=n[i];uu.setFromBufferAttribute(o),this.morphTargetsRelative?(Ba.addVectors(this.boundingBox.min,uu.min),this.boundingBox.expandByPoint(Ba),Ba.addVectors(this.boundingBox.max,uu.max),this.boundingBox.expandByPoint(Ba)):(this.boundingBox.expandByPoint(uu.min),this.boundingBox.expandByPoint(uu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sl);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new gt,1/0);return}if(e){const i=this.boundingSphere.center;if(uu.setFromBufferAttribute(e),n)for(let o=0,c=n.length;o<c;o++){const s=n[o];HC.setFromBufferAttribute(s),this.morphTargetsRelative?(Ba.addVectors(uu.min,HC.min),uu.expandByPoint(Ba),Ba.addVectors(uu.max,HC.max),uu.expandByPoint(Ba)):(uu.expandByPoint(HC.min),uu.expandByPoint(HC.max))}uu.getCenter(i);let r=0;for(let o=0,c=e.count;o<c;o++)Ba.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(Ba));if(n)for(let o=0,c=n.length;o<c;o++){const s=n[o],f=this.morphTargetsRelative;for(let v=0,w=s.count;v<w;v++)Ba.fromBufferAttribute(s,v),f&&(z0.fromBufferAttribute(e,v),Ba.add(z0)),r=Math.max(r,i.distanceToSquared(Ba))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=n.position,r=n.normal,o=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ns(new Float32Array(4*i.count),4));const c=this.getAttribute("tangent"),s=[],f=[];for(let pe=0;pe<i.count;pe++)s[pe]=new gt,f[pe]=new gt;const v=new gt,w=new gt,C=new gt,M=new Cn,F=new Cn,N=new Cn,z=new gt,L=new gt;function P(pe,fe,ue){v.fromBufferAttribute(i,pe),w.fromBufferAttribute(i,fe),C.fromBufferAttribute(i,ue),M.fromBufferAttribute(o,pe),F.fromBufferAttribute(o,fe),N.fromBufferAttribute(o,ue),w.sub(v),C.sub(v),F.sub(M),N.sub(M);const Ee=1/(F.x*N.y-N.x*F.y);isFinite(Ee)&&(z.copy(w).multiplyScalar(N.y).addScaledVector(C,-F.y).multiplyScalar(Ee),L.copy(C).multiplyScalar(F.x).addScaledVector(w,-N.x).multiplyScalar(Ee),s[pe].add(z),s[fe].add(z),s[ue].add(z),f[pe].add(L),f[fe].add(L),f[ue].add(L))}let H=this.groups;H.length===0&&(H=[{start:0,count:e.count}]);for(let pe=0,fe=H.length;pe<fe;++pe){const ue=H[pe],Ee=ue.start,We=ue.count;for(let rt=Ee,tt=Ee+We;rt<tt;rt+=3)P(e.getX(rt+0),e.getX(rt+1),e.getX(rt+2))}const j=new gt,q=new gt,le=new gt,ce=new gt;function ae(pe){le.fromBufferAttribute(r,pe),ce.copy(le);const fe=s[pe];j.copy(fe),j.sub(le.multiplyScalar(le.dot(fe))).normalize(),q.crossVectors(ce,fe);const Ee=q.dot(f[pe])<0?-1:1;c.setXYZW(pe,j.x,j.y,j.z,Ee)}for(let pe=0,fe=H.length;pe<fe;++pe){const ue=H[pe],Ee=ue.start,We=ue.count;for(let rt=Ee,tt=Ee+We;rt<tt;rt+=3)ae(e.getX(rt+0)),ae(e.getX(rt+1)),ae(e.getX(rt+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ns(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let M=0,F=i.count;M<F;M++)i.setXYZ(M,0,0,0);const r=new gt,o=new gt,c=new gt,s=new gt,f=new gt,v=new gt,w=new gt,C=new gt;if(e)for(let M=0,F=e.count;M<F;M+=3){const N=e.getX(M+0),z=e.getX(M+1),L=e.getX(M+2);r.fromBufferAttribute(n,N),o.fromBufferAttribute(n,z),c.fromBufferAttribute(n,L),w.subVectors(c,o),C.subVectors(r,o),w.cross(C),s.fromBufferAttribute(i,N),f.fromBufferAttribute(i,z),v.fromBufferAttribute(i,L),s.add(w),f.add(w),v.add(w),i.setXYZ(N,s.x,s.y,s.z),i.setXYZ(z,f.x,f.y,f.z),i.setXYZ(L,v.x,v.y,v.z)}else for(let M=0,F=n.count;M<F;M+=3)r.fromBufferAttribute(n,M+0),o.fromBufferAttribute(n,M+1),c.fromBufferAttribute(n,M+2),w.subVectors(c,o),C.subVectors(r,o),w.cross(C),i.setXYZ(M+0,w.x,w.y,w.z),i.setXYZ(M+1,w.x,w.y,w.z),i.setXYZ(M+2,w.x,w.y,w.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)Ba.fromBufferAttribute(e,n),Ba.normalize(),e.setXYZ(n,Ba.x,Ba.y,Ba.z)}toNonIndexed(){function e(s,f){const v=s.array,w=s.itemSize,C=s.normalized,M=new v.constructor(f.length*w);let F=0,N=0;for(let z=0,L=f.length;z<L;z++){s.isInterleavedBufferAttribute?F=f[z]*s.data.stride+s.offset:F=f[z]*w;for(let P=0;P<w;P++)M[N++]=v[F++]}return new ns(M,w,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Cr,i=this.index.array,r=this.attributes;for(const s in r){const f=r[s],v=e(f,i);n.setAttribute(s,v)}const o=this.morphAttributes;for(const s in o){const f=[],v=o[s];for(let w=0,C=v.length;w<C;w++){const M=v[w],F=e(M,i);f.push(F)}n.morphAttributes[s]=f}n.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let s=0,f=c.length;s<f;s++){const v=c[s];n.addGroup(v.start,v.count,v.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const f=this.parameters;for(const v in f)f[v]!==void 0&&(e[v]=f[v]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const f in i){const v=i[f];e.data.attributes[f]=v.toJSON(e.data)}const r={};let o=!1;for(const f in this.morphAttributes){const v=this.morphAttributes[f],w=[];for(let C=0,M=v.length;C<M;C++){const F=v[C];w.push(F.toJSON(e.data))}w.length>0&&(r[f]=w,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(n));const r=e.attributes;for(const v in r){const w=r[v];this.setAttribute(v,w.clone(n))}const o=e.morphAttributes;for(const v in o){const w=[],C=o[v];for(let M=0,F=C.length;M<F;M++)w.push(C[M].clone(n));this.morphAttributes[v]=w}this.morphTargetsRelative=e.morphTargetsRelative;const c=e.groups;for(let v=0,w=c.length;v<w;v++){const C=c[v];this.addGroup(C.start,C.count,C.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const f=e.boundingSphere;return f!==null&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const y6=new Hi,py=new Nw,iM=new Sl,_6=new gt,rM=new gt,sM=new gt,oM=new gt,v2=new gt,aM=new gt,x6=new gt,lM=new gt;class va extends Cs{constructor(e=new Cr,n=new Ev){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}getVertexPosition(e,n){const i=this.geometry,r=i.attributes.position,o=i.morphAttributes.position,c=i.morphTargetsRelative;n.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(o&&s){aM.set(0,0,0);for(let f=0,v=o.length;f<v;f++){const w=s[f],C=o[f];w!==0&&(v2.fromBufferAttribute(C,e),c?aM.addScaledVector(v2,w):aM.addScaledVector(v2.sub(n),w))}n.add(aM)}return n}raycast(e,n){const i=this.geometry,r=this.material,o=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),iM.copy(i.boundingSphere),iM.applyMatrix4(o),py.copy(e.ray).recast(e.near),!(iM.containsPoint(py.origin)===!1&&(py.intersectSphere(iM,_6)===null||py.origin.distanceToSquared(_6)>(e.far-e.near)**2))&&(y6.copy(o).invert(),py.copy(e.ray).applyMatrix4(y6),!(i.boundingBox!==null&&py.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,py)))}_computeIntersections(e,n,i){let r;const o=this.geometry,c=this.material,s=o.index,f=o.attributes.position,v=o.attributes.uv,w=o.attributes.uv1,C=o.attributes.normal,M=o.groups,F=o.drawRange;if(s!==null)if(Array.isArray(c))for(let N=0,z=M.length;N<z;N++){const L=M[N],P=c[L.materialIndex],H=Math.max(L.start,F.start),j=Math.min(s.count,Math.min(L.start+L.count,F.start+F.count));for(let q=H,le=j;q<le;q+=3){const ce=s.getX(q),ae=s.getX(q+1),pe=s.getX(q+2);r=cM(this,P,e,i,v,w,C,ce,ae,pe),r&&(r.faceIndex=Math.floor(q/3),r.face.materialIndex=L.materialIndex,n.push(r))}}else{const N=Math.max(0,F.start),z=Math.min(s.count,F.start+F.count);for(let L=N,P=z;L<P;L+=3){const H=s.getX(L),j=s.getX(L+1),q=s.getX(L+2);r=cM(this,c,e,i,v,w,C,H,j,q),r&&(r.faceIndex=Math.floor(L/3),n.push(r))}}else if(f!==void 0)if(Array.isArray(c))for(let N=0,z=M.length;N<z;N++){const L=M[N],P=c[L.materialIndex],H=Math.max(L.start,F.start),j=Math.min(f.count,Math.min(L.start+L.count,F.start+F.count));for(let q=H,le=j;q<le;q+=3){const ce=q,ae=q+1,pe=q+2;r=cM(this,P,e,i,v,w,C,ce,ae,pe),r&&(r.faceIndex=Math.floor(q/3),r.face.materialIndex=L.materialIndex,n.push(r))}}else{const N=Math.max(0,F.start),z=Math.min(f.count,F.start+F.count);for(let L=N,P=z;L<P;L+=3){const H=L,j=L+1,q=L+2;r=cM(this,c,e,i,v,w,C,H,j,q),r&&(r.faceIndex=Math.floor(L/3),n.push(r))}}}}function xRe(t,e,n,i,r,o,c,s){let f;if(e.side===Jl?f=i.intersectTriangle(c,o,r,!0,s):f=i.intersectTriangle(r,o,c,e.side===im,s),f===null)return null;lM.copy(s),lM.applyMatrix4(t.matrixWorld);const v=n.ray.origin.distanceTo(lM);return v<n.near||v>n.far?null:{distance:v,point:lM.clone(),object:t}}function cM(t,e,n,i,r,o,c,s,f,v){t.getVertexPosition(s,rM),t.getVertexPosition(f,sM),t.getVertexPosition(v,oM);const w=xRe(t,e,n,i,rM,sM,oM,x6);if(w){const C=new gt;Fc.getBarycoord(x6,rM,sM,oM,C),r&&(w.uv=Fc.getInterpolatedAttribute(r,s,f,v,C,new Cn)),o&&(w.uv1=Fc.getInterpolatedAttribute(o,s,f,v,C,new Cn)),c&&(w.normal=Fc.getInterpolatedAttribute(c,s,f,v,C,new gt),w.normal.dot(i.direction)>0&&w.normal.multiplyScalar(-1));const M={a:s,b:f,c:v,normal:new gt,materialIndex:0};Fc.getNormal(rM,sM,oM,M.normal),w.face=M,w.barycoord=C}return w}class W_ extends Cr{constructor(e=1,n=1,i=1,r=1,o=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:c};const s=this;r=Math.floor(r),o=Math.floor(o),c=Math.floor(c);const f=[],v=[],w=[],C=[];let M=0,F=0;N("z","y","x",-1,-1,i,n,e,c,o,0),N("z","y","x",1,-1,i,n,-e,c,o,1),N("x","z","y",1,1,e,i,n,r,c,2),N("x","z","y",1,-1,e,i,-n,r,c,3),N("x","y","z",1,-1,e,n,i,r,o,4),N("x","y","z",-1,-1,e,n,-i,r,o,5),this.setIndex(f),this.setAttribute("position",new Ni(v,3)),this.setAttribute("normal",new Ni(w,3)),this.setAttribute("uv",new Ni(C,2));function N(z,L,P,H,j,q,le,ce,ae,pe,fe){const ue=q/ae,Ee=le/pe,We=q/2,rt=le/2,tt=ce/2,Ye=ae+1,qe=pe+1;let ft=0,Me=0;const $e=new gt;for(let ut=0;ut<qe;ut++){const Mt=ut*Ee-rt;for(let Gt=0;Gt<Ye;Gt++){const Xt=Gt*ue-We;$e[z]=Xt*H,$e[L]=Mt*j,$e[P]=tt,v.push($e.x,$e.y,$e.z),$e[z]=0,$e[L]=0,$e[P]=ce>0?1:-1,w.push($e.x,$e.y,$e.z),C.push(Gt/ae),C.push(1-ut/pe),ft+=1}}for(let ut=0;ut<pe;ut++)for(let Mt=0;Mt<ae;Mt++){const Gt=M+Mt+Ye*ut,Xt=M+Mt+Ye*(ut+1),Qe=M+(Mt+1)+Ye*(ut+1),Ge=M+(Mt+1)+Ye*ut;f.push(Gt,Xt,Ge),f.push(Xt,Qe,Ge),Me+=6}s.addGroup(F,Me,fe),F+=Me,M+=ft}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new W_(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cw(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Gl(t){const e={};for(let n=0;n<t.length;n++){const i=cw(t[n]);for(const r in i)e[r]=i[r]}return e}function wRe(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function wY(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ls.workingColorSpace}const CY={clone:cw,merge:Gl};var CRe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,SRe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ih extends nl{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=CRe,this.fragmentShader=SRe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cw(e.uniforms),this.uniformsGroups=wRe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const r in this.uniforms){const c=this.uniforms[r].value;c&&c.isTexture?n.uniforms[r]={type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?n.uniforms[r]={type:"c",value:c.getHex()}:c&&c.isVector2?n.uniforms[r]={type:"v2",value:c.toArray()}:c&&c.isVector3?n.uniforms[r]={type:"v3",value:c.toArray()}:c&&c.isVector4?n.uniforms[r]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?n.uniforms[r]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?n.uniforms[r]={type:"m4",value:c.toArray()}:n.uniforms[r]={value:c}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class lb extends Cs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Hi,this.projectionMatrix=new Hi,this.projectionMatrixInverse=new Hi,this.coordinateSystem=yf}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const wg=new gt,w6=new Cn,C6=new Cn;class Ua extends lb{constructor(e=50,n=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=lw*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(c_*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return lw*2*Math.atan(Math.tan(c_*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,i){wg.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(wg.x,wg.y).multiplyScalar(-e/wg.z),wg.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(wg.x,wg.y).multiplyScalar(-e/wg.z)}getViewSize(e,n){return this.getViewBounds(e,w6,C6),n.subVectors(C6,w6)}setViewOffset(e,n,i,r,o,c){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(c_*.5*this.fov)/this.zoom,i=2*n,r=this.aspect*i,o=-.5*r;const c=this.view;if(this.view!==null&&this.view.enabled){const f=c.fullWidth,v=c.fullHeight;o+=c.offsetX*r/f,n-=c.offsetY*i/v,r*=c.width/f,i*=c.height/v}const s=this.filmOffset;s!==0&&(o+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,n,n-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const U0=-90,V0=1;class SY extends Cs{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ua(U0,V0,e,n);r.layers=this.layers,this.add(r);const o=new Ua(U0,V0,e,n);o.layers=this.layers,this.add(o);const c=new Ua(U0,V0,e,n);c.layers=this.layers,this.add(c);const s=new Ua(U0,V0,e,n);s.layers=this.layers,this.add(s);const f=new Ua(U0,V0,e,n);f.layers=this.layers,this.add(f);const v=new Ua(U0,V0,e,n);v.layers=this.layers,this.add(v)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,r,o,c,s,f]=n;for(const v of n)this.remove(v);if(e===yf)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),c.up.set(0,0,1),c.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),f.up.set(0,1,0),f.lookAt(0,0,-1);else if(e===vS)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),c.up.set(0,0,-1),c.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),f.up.set(0,-1,0),f.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const v of n)this.add(v),v.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,c,s,f,v,w]=this.children,C=e.getRenderTarget(),M=e.getActiveCubeFace(),F=e.getActiveMipmapLevel(),N=e.xr.enabled;e.xr.enabled=!1;const z=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(n,o),e.setRenderTarget(i,1,r),e.render(n,c),e.setRenderTarget(i,2,r),e.render(n,s),e.setRenderTarget(i,3,r),e.render(n,f),e.setRenderTarget(i,4,r),e.render(n,v),i.texture.generateMipmaps=z,e.setRenderTarget(i,5,r),e.render(n,w),e.setRenderTarget(C,M,F),e.xr.enabled=N,i.texture.needsPMREMUpdate=!0}}class cb extends Oo{constructor(e,n,i,r,o,c,s,f,v,w){e=e!==void 0?e:[],n=n!==void 0?n:rm,super(e,n,i,r,o,c,s,f,v,w),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class bY extends fd{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new cb(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ma}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new W_(5,5,5),o=new ih({name:"CubemapFromEquirect",uniforms:cw(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Jl,blending:Wp});o.uniforms.tEquirect.value=n;const c=new va(r,o),s=n.minFilter;return n.minFilter===vf&&(n.minFilter=Ma),new SY(1,10,this).update(e,c),n.minFilter=s,c.geometry.dispose(),c.material.dispose(),this}clear(e,n,i,r){const o=e.getRenderTarget();for(let c=0;c<6;c++)e.setRenderTarget(this,c),e.clear(n,i,r);e.setRenderTarget(o)}}const y2=new gt,bRe=new gt,ERe=new dr;class Tg{constructor(e=new gt(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,r){return this.normal.set(e,n,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const r=y2.subVectors(i,n).cross(bRe.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(y2),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:n.copy(e.start).addScaledVector(i,o)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||ERe.getNormalMatrix(e),r=this.coplanarPoint(y2).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const my=new Sl,uM=new gt;class ub{constructor(e=new Tg,n=new Tg,i=new Tg,r=new Tg,o=new Tg,c=new Tg){this.planes=[e,n,i,r,o,c]}set(e,n,i,r,o,c){const s=this.planes;return s[0].copy(e),s[1].copy(n),s[2].copy(i),s[3].copy(r),s[4].copy(o),s[5].copy(c),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=yf){const i=this.planes,r=e.elements,o=r[0],c=r[1],s=r[2],f=r[3],v=r[4],w=r[5],C=r[6],M=r[7],F=r[8],N=r[9],z=r[10],L=r[11],P=r[12],H=r[13],j=r[14],q=r[15];if(i[0].setComponents(f-o,M-v,L-F,q-P).normalize(),i[1].setComponents(f+o,M+v,L+F,q+P).normalize(),i[2].setComponents(f+c,M+w,L+N,q+H).normalize(),i[3].setComponents(f-c,M-w,L-N,q-H).normalize(),i[4].setComponents(f-s,M-C,L-z,q-j).normalize(),n===yf)i[5].setComponents(f+s,M+C,L+z,q+j).normalize();else if(n===vS)i[5].setComponents(s,C,z,j).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),my.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),my.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(my)}intersectsSprite(e){return my.center.set(0,0,0),my.radius=.7071067811865476,my.applyMatrix4(e.matrixWorld),this.intersectsSphere(my)}intersectsSphere(e){const n=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(n[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const r=n[i];if(uM.x=r.normal.x>0?e.max.x:e.min.x,uM.y=r.normal.y>0?e.max.y:e.min.y,uM.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(uM)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function EY(){let t=null,e=!1,n=null,i=null;function r(o,c){n(o,c),i=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){n=o},setContext:function(o){t=o}}}function MRe(t){const e=new WeakMap;function n(s,f){const v=s.array,w=s.usage,C=v.byteLength,M=t.createBuffer();t.bindBuffer(f,M),t.bufferData(f,v,w),s.onUploadCallback();let F;if(v instanceof Float32Array)F=t.FLOAT;else if(v instanceof Uint16Array)s.isFloat16BufferAttribute?F=t.HALF_FLOAT:F=t.UNSIGNED_SHORT;else if(v instanceof Int16Array)F=t.SHORT;else if(v instanceof Uint32Array)F=t.UNSIGNED_INT;else if(v instanceof Int32Array)F=t.INT;else if(v instanceof Int8Array)F=t.BYTE;else if(v instanceof Uint8Array)F=t.UNSIGNED_BYTE;else if(v instanceof Uint8ClampedArray)F=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+v);return{buffer:M,type:F,bytesPerElement:v.BYTES_PER_ELEMENT,version:s.version,size:C}}function i(s,f,v){const w=f.array,C=f.updateRanges;if(t.bindBuffer(v,s),C.length===0)t.bufferSubData(v,0,w);else{C.sort((F,N)=>F.start-N.start);let M=0;for(let F=1;F<C.length;F++){const N=C[M],z=C[F];z.start<=N.start+N.count+1?N.count=Math.max(N.count,z.start+z.count-N.start):(++M,C[M]=z)}C.length=M+1;for(let F=0,N=C.length;F<N;F++){const z=C[F];t.bufferSubData(v,z.start*w.BYTES_PER_ELEMENT,w,z.start,z.count)}f.clearUpdateRanges()}f.onUploadCallback()}function r(s){return s.isInterleavedBufferAttribute&&(s=s.data),e.get(s)}function o(s){s.isInterleavedBufferAttribute&&(s=s.data);const f=e.get(s);f&&(t.deleteBuffer(f.buffer),e.delete(s))}function c(s,f){if(s.isInterleavedBufferAttribute&&(s=s.data),s.isGLBufferAttribute){const w=e.get(s);(!w||w.version<s.version)&&e.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version});return}const v=e.get(s);if(v===void 0)e.set(s,n(s,f));else if(v.version<s.version){if(v.size!==s.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(v.buffer,s,f),v.version=s.version}}return{get:r,remove:o,update:c}}class Bw extends Cr{constructor(e=1,n=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:r};const o=e/2,c=n/2,s=Math.floor(i),f=Math.floor(r),v=s+1,w=f+1,C=e/s,M=n/f,F=[],N=[],z=[],L=[];for(let P=0;P<w;P++){const H=P*M-c;for(let j=0;j<v;j++){const q=j*C-o;N.push(q,-H,0),z.push(0,0,1),L.push(j/s),L.push(1-P/f)}}for(let P=0;P<f;P++)for(let H=0;H<s;H++){const j=H+v*P,q=H+v*(P+1),le=H+1+v*(P+1),ce=H+1+v*P;F.push(j,q,ce),F.push(q,le,ce)}this.setIndex(F),this.setAttribute("position",new Ni(N,3)),this.setAttribute("normal",new Ni(z,3)),this.setAttribute("uv",new Ni(L,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bw(e.width,e.height,e.widthSegments,e.heightSegments)}}var RRe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TRe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ARe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,PRe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,IRe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,DRe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,FRe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,LRe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ORe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,kRe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,NRe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,BRe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,zRe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,URe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,VRe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,GRe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,HRe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,WRe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,jRe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,$Re=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,qRe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ZRe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,XRe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,KRe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,YRe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,JRe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,QRe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,eTe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,tTe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,nTe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,iTe="gl_FragColor = linearToOutputTexel( gl_FragColor );",rTe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,sTe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,oTe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,aTe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,lTe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,cTe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,uTe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,hTe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,dTe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fTe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,pTe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,mTe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,gTe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,vTe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,yTe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,_Te=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xTe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,wTe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,CTe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,STe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,bTe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,ETe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,MTe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,RTe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,TTe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,ATe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,PTe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ITe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,DTe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,FTe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,LTe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,OTe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,kTe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,NTe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,BTe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,zTe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,UTe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,VTe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,GTe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,HTe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,WTe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,jTe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$Te=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,qTe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ZTe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,XTe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,KTe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,YTe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,JTe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,QTe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,eAe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,tAe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,nAe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,iAe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,rAe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,sAe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oAe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,aAe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,lAe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,cAe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,uAe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,hAe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,dAe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,fAe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,pAe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,mAe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,gAe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,vAe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,yAe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,_Ae=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,xAe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,wAe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,CAe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,SAe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bAe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,EAe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const MAe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,RAe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,AAe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,IAe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,DAe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,FAe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,LAe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,OAe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,kAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,NAe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,BAe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zAe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UAe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,VAe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GAe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HAe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WAe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,jAe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$Ae=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,qAe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ZAe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XAe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,KAe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,YAe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JAe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,QAe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ePe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,tPe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,nPe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,iPe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,rPe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sPe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,kr={alphahash_fragment:RRe,alphahash_pars_fragment:TRe,alphamap_fragment:ARe,alphamap_pars_fragment:PRe,alphatest_fragment:IRe,alphatest_pars_fragment:DRe,aomap_fragment:FRe,aomap_pars_fragment:LRe,batching_pars_vertex:ORe,batching_vertex:kRe,begin_vertex:NRe,beginnormal_vertex:BRe,bsdfs:zRe,iridescence_fragment:URe,bumpmap_pars_fragment:VRe,clipping_planes_fragment:GRe,clipping_planes_pars_fragment:HRe,clipping_planes_pars_vertex:WRe,clipping_planes_vertex:jRe,color_fragment:$Re,color_pars_fragment:qRe,color_pars_vertex:ZRe,color_vertex:XRe,common:KRe,cube_uv_reflection_fragment:YRe,defaultnormal_vertex:JRe,displacementmap_pars_vertex:QRe,displacementmap_vertex:eTe,emissivemap_fragment:tTe,emissivemap_pars_fragment:nTe,colorspace_fragment:iTe,colorspace_pars_fragment:rTe,envmap_fragment:sTe,envmap_common_pars_fragment:oTe,envmap_pars_fragment:aTe,envmap_pars_vertex:lTe,envmap_physical_pars_fragment:_Te,envmap_vertex:cTe,fog_vertex:uTe,fog_pars_vertex:hTe,fog_fragment:dTe,fog_pars_fragment:fTe,gradientmap_pars_fragment:pTe,lightmap_pars_fragment:mTe,lights_lambert_fragment:gTe,lights_lambert_pars_fragment:vTe,lights_pars_begin:yTe,lights_toon_fragment:xTe,lights_toon_pars_fragment:wTe,lights_phong_fragment:CTe,lights_phong_pars_fragment:STe,lights_physical_fragment:bTe,lights_physical_pars_fragment:ETe,lights_fragment_begin:MTe,lights_fragment_maps:RTe,lights_fragment_end:TTe,logdepthbuf_fragment:ATe,logdepthbuf_pars_fragment:PTe,logdepthbuf_pars_vertex:ITe,logdepthbuf_vertex:DTe,map_fragment:FTe,map_pars_fragment:LTe,map_particle_fragment:OTe,map_particle_pars_fragment:kTe,metalnessmap_fragment:NTe,metalnessmap_pars_fragment:BTe,morphinstance_vertex:zTe,morphcolor_vertex:UTe,morphnormal_vertex:VTe,morphtarget_pars_vertex:GTe,morphtarget_vertex:HTe,normal_fragment_begin:WTe,normal_fragment_maps:jTe,normal_pars_fragment:$Te,normal_pars_vertex:qTe,normal_vertex:ZTe,normalmap_pars_fragment:XTe,clearcoat_normal_fragment_begin:KTe,clearcoat_normal_fragment_maps:YTe,clearcoat_pars_fragment:JTe,iridescence_pars_fragment:QTe,opaque_fragment:eAe,packing:tAe,premultiplied_alpha_fragment:nAe,project_vertex:iAe,dithering_fragment:rAe,dithering_pars_fragment:sAe,roughnessmap_fragment:oAe,roughnessmap_pars_fragment:aAe,shadowmap_pars_fragment:lAe,shadowmap_pars_vertex:cAe,shadowmap_vertex:uAe,shadowmask_pars_fragment:hAe,skinbase_vertex:dAe,skinning_pars_vertex:fAe,skinning_vertex:pAe,skinnormal_vertex:mAe,specularmap_fragment:gAe,specularmap_pars_fragment:vAe,tonemapping_fragment:yAe,tonemapping_pars_fragment:_Ae,transmission_fragment:xAe,transmission_pars_fragment:wAe,uv_pars_fragment:CAe,uv_pars_vertex:SAe,uv_vertex:bAe,worldpos_vertex:EAe,background_vert:MAe,background_frag:RAe,backgroundCube_vert:TAe,backgroundCube_frag:AAe,cube_vert:PAe,cube_frag:IAe,depth_vert:DAe,depth_frag:FAe,distanceRGBA_vert:LAe,distanceRGBA_frag:OAe,equirect_vert:kAe,equirect_frag:NAe,linedashed_vert:BAe,linedashed_frag:zAe,meshbasic_vert:UAe,meshbasic_frag:VAe,meshlambert_vert:GAe,meshlambert_frag:HAe,meshmatcap_vert:WAe,meshmatcap_frag:jAe,meshnormal_vert:$Ae,meshnormal_frag:qAe,meshphong_vert:ZAe,meshphong_frag:XAe,meshphysical_vert:KAe,meshphysical_frag:YAe,meshtoon_vert:JAe,meshtoon_frag:QAe,points_vert:ePe,points_frag:tPe,shadow_vert:nPe,shadow_frag:iPe,sprite_vert:rPe,sprite_frag:sPe},wi={common:{diffuse:{value:new bi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new dr},alphaMap:{value:null},alphaMapTransform:{value:new dr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new dr}},envmap:{envMap:{value:null},envMapRotation:{value:new dr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new dr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new dr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new dr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new dr},normalScale:{value:new Cn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new dr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new dr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new dr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new dr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new dr},alphaTest:{value:0},uvTransform:{value:new dr}},sprite:{diffuse:{value:new bi(16777215)},opacity:{value:1},center:{value:new Cn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new dr},alphaMap:{value:null},alphaMapTransform:{value:new dr},alphaTest:{value:0}}},ed={basic:{uniforms:Gl([wi.common,wi.specularmap,wi.envmap,wi.aomap,wi.lightmap,wi.fog]),vertexShader:kr.meshbasic_vert,fragmentShader:kr.meshbasic_frag},lambert:{uniforms:Gl([wi.common,wi.specularmap,wi.envmap,wi.aomap,wi.lightmap,wi.emissivemap,wi.bumpmap,wi.normalmap,wi.displacementmap,wi.fog,wi.lights,{emissive:{value:new bi(0)}}]),vertexShader:kr.meshlambert_vert,fragmentShader:kr.meshlambert_frag},phong:{uniforms:Gl([wi.common,wi.specularmap,wi.envmap,wi.aomap,wi.lightmap,wi.emissivemap,wi.bumpmap,wi.normalmap,wi.displacementmap,wi.fog,wi.lights,{emissive:{value:new bi(0)},specular:{value:new bi(1118481)},shininess:{value:30}}]),vertexShader:kr.meshphong_vert,fragmentShader:kr.meshphong_frag},standard:{uniforms:Gl([wi.common,wi.envmap,wi.aomap,wi.lightmap,wi.emissivemap,wi.bumpmap,wi.normalmap,wi.displacementmap,wi.roughnessmap,wi.metalnessmap,wi.fog,wi.lights,{emissive:{value:new bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:kr.meshphysical_vert,fragmentShader:kr.meshphysical_frag},toon:{uniforms:Gl([wi.common,wi.aomap,wi.lightmap,wi.emissivemap,wi.bumpmap,wi.normalmap,wi.displacementmap,wi.gradientmap,wi.fog,wi.lights,{emissive:{value:new bi(0)}}]),vertexShader:kr.meshtoon_vert,fragmentShader:kr.meshtoon_frag},matcap:{uniforms:Gl([wi.common,wi.bumpmap,wi.normalmap,wi.displacementmap,wi.fog,{matcap:{value:null}}]),vertexShader:kr.meshmatcap_vert,fragmentShader:kr.meshmatcap_frag},points:{uniforms:Gl([wi.points,wi.fog]),vertexShader:kr.points_vert,fragmentShader:kr.points_frag},dashed:{uniforms:Gl([wi.common,wi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:kr.linedashed_vert,fragmentShader:kr.linedashed_frag},depth:{uniforms:Gl([wi.common,wi.displacementmap]),vertexShader:kr.depth_vert,fragmentShader:kr.depth_frag},normal:{uniforms:Gl([wi.common,wi.bumpmap,wi.normalmap,wi.displacementmap,{opacity:{value:1}}]),vertexShader:kr.meshnormal_vert,fragmentShader:kr.meshnormal_frag},sprite:{uniforms:Gl([wi.sprite,wi.fog]),vertexShader:kr.sprite_vert,fragmentShader:kr.sprite_frag},background:{uniforms:{uvTransform:{value:new dr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:kr.background_vert,fragmentShader:kr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new dr}},vertexShader:kr.backgroundCube_vert,fragmentShader:kr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:kr.cube_vert,fragmentShader:kr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:kr.equirect_vert,fragmentShader:kr.equirect_frag},distanceRGBA:{uniforms:Gl([wi.common,wi.displacementmap,{referencePosition:{value:new gt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:kr.distanceRGBA_vert,fragmentShader:kr.distanceRGBA_frag},shadow:{uniforms:Gl([wi.lights,wi.fog,{color:{value:new bi(0)},opacity:{value:1}}]),vertexShader:kr.shadow_vert,fragmentShader:kr.shadow_frag}};ed.physical={uniforms:Gl([ed.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new dr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new dr},clearcoatNormalScale:{value:new Cn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new dr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new dr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new dr},sheen:{value:0},sheenColor:{value:new bi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new dr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new dr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new dr},transmissionSamplerSize:{value:new Cn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new dr},attenuationDistance:{value:0},attenuationColor:{value:new bi(0)},specularColor:{value:new bi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new dr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new dr},anisotropyVector:{value:new Cn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new dr}}]),vertexShader:kr.meshphysical_vert,fragmentShader:kr.meshphysical_frag};const hM={r:0,b:0,g:0},gy=new nc,oPe=new Hi;function aPe(t,e,n,i,r,o,c){const s=new bi(0);let f=o===!0?0:1,v,w,C=null,M=0,F=null;function N(H){let j=H.isScene===!0?H.background:null;return j&&j.isTexture&&(j=(H.backgroundBlurriness>0?n:e).get(j)),j}function z(H){let j=!1;const q=N(H);q===null?P(s,f):q&&q.isColor&&(P(q,1),j=!0);const le=t.xr.getEnvironmentBlendMode();le==="additive"?i.buffers.color.setClear(0,0,0,1,c):le==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,c),(t.autoClear||j)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function L(H,j){const q=N(j);q&&(q.isCubeTexture||q.mapping===Ow)?(w===void 0&&(w=new va(new W_(1,1,1),new ih({name:"BackgroundCubeMaterial",uniforms:cw(ed.backgroundCube.uniforms),vertexShader:ed.backgroundCube.vertexShader,fragmentShader:ed.backgroundCube.fragmentShader,side:Jl,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),w.geometry.deleteAttribute("uv"),w.onBeforeRender=function(le,ce,ae){this.matrixWorld.copyPosition(ae.matrixWorld)},Object.defineProperty(w.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(w)),gy.copy(j.backgroundRotation),gy.x*=-1,gy.y*=-1,gy.z*=-1,q.isCubeTexture&&q.isRenderTargetTexture===!1&&(gy.y*=-1,gy.z*=-1),w.material.uniforms.envMap.value=q,w.material.uniforms.flipEnvMap.value=q.isCubeTexture&&q.isRenderTargetTexture===!1?-1:1,w.material.uniforms.backgroundBlurriness.value=j.backgroundBlurriness,w.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,w.material.uniforms.backgroundRotation.value.setFromMatrix4(oPe.makeRotationFromEuler(gy)),w.material.toneMapped=ls.getTransfer(q.colorSpace)!==Ns,(C!==q||M!==q.version||F!==t.toneMapping)&&(w.material.needsUpdate=!0,C=q,M=q.version,F=t.toneMapping),w.layers.enableAll(),H.unshift(w,w.geometry,w.material,0,0,null)):q&&q.isTexture&&(v===void 0&&(v=new va(new Bw(2,2),new ih({name:"BackgroundMaterial",uniforms:cw(ed.background.uniforms),vertexShader:ed.background.vertexShader,fragmentShader:ed.background.fragmentShader,side:im,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),Object.defineProperty(v.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(v)),v.material.uniforms.t2D.value=q,v.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,v.material.toneMapped=ls.getTransfer(q.colorSpace)!==Ns,q.matrixAutoUpdate===!0&&q.updateMatrix(),v.material.uniforms.uvTransform.value.copy(q.matrix),(C!==q||M!==q.version||F!==t.toneMapping)&&(v.material.needsUpdate=!0,C=q,M=q.version,F=t.toneMapping),v.layers.enableAll(),H.unshift(v,v.geometry,v.material,0,0,null))}function P(H,j){H.getRGB(hM,wY(t)),i.buffers.color.setClear(hM.r,hM.g,hM.b,j,c)}return{getClearColor:function(){return s},setClearColor:function(H,j=1){s.set(H),f=j,P(s,f)},getClearAlpha:function(){return f},setClearAlpha:function(H){f=H,P(s,f)},render:z,addToRenderList:L}}function lPe(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=M(null);let o=r,c=!1;function s(ue,Ee,We,rt,tt){let Ye=!1;const qe=C(rt,We,Ee);o!==qe&&(o=qe,v(o.object)),Ye=F(ue,rt,We,tt),Ye&&N(ue,rt,We,tt),tt!==null&&e.update(tt,t.ELEMENT_ARRAY_BUFFER),(Ye||c)&&(c=!1,q(ue,Ee,We,rt),tt!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(tt).buffer))}function f(){return t.createVertexArray()}function v(ue){return t.bindVertexArray(ue)}function w(ue){return t.deleteVertexArray(ue)}function C(ue,Ee,We){const rt=We.wireframe===!0;let tt=i[ue.id];tt===void 0&&(tt={},i[ue.id]=tt);let Ye=tt[Ee.id];Ye===void 0&&(Ye={},tt[Ee.id]=Ye);let qe=Ye[rt];return qe===void 0&&(qe=M(f()),Ye[rt]=qe),qe}function M(ue){const Ee=[],We=[],rt=[];for(let tt=0;tt<n;tt++)Ee[tt]=0,We[tt]=0,rt[tt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ee,enabledAttributes:We,attributeDivisors:rt,object:ue,attributes:{},index:null}}function F(ue,Ee,We,rt){const tt=o.attributes,Ye=Ee.attributes;let qe=0;const ft=We.getAttributes();for(const Me in ft)if(ft[Me].location>=0){const ut=tt[Me];let Mt=Ye[Me];if(Mt===void 0&&(Me==="instanceMatrix"&&ue.instanceMatrix&&(Mt=ue.instanceMatrix),Me==="instanceColor"&&ue.instanceColor&&(Mt=ue.instanceColor)),ut===void 0||ut.attribute!==Mt||Mt&&ut.data!==Mt.data)return!0;qe++}return o.attributesNum!==qe||o.index!==rt}function N(ue,Ee,We,rt){const tt={},Ye=Ee.attributes;let qe=0;const ft=We.getAttributes();for(const Me in ft)if(ft[Me].location>=0){let ut=Ye[Me];ut===void 0&&(Me==="instanceMatrix"&&ue.instanceMatrix&&(ut=ue.instanceMatrix),Me==="instanceColor"&&ue.instanceColor&&(ut=ue.instanceColor));const Mt={};Mt.attribute=ut,ut&&ut.data&&(Mt.data=ut.data),tt[Me]=Mt,qe++}o.attributes=tt,o.attributesNum=qe,o.index=rt}function z(){const ue=o.newAttributes;for(let Ee=0,We=ue.length;Ee<We;Ee++)ue[Ee]=0}function L(ue){P(ue,0)}function P(ue,Ee){const We=o.newAttributes,rt=o.enabledAttributes,tt=o.attributeDivisors;We[ue]=1,rt[ue]===0&&(t.enableVertexAttribArray(ue),rt[ue]=1),tt[ue]!==Ee&&(t.vertexAttribDivisor(ue,Ee),tt[ue]=Ee)}function H(){const ue=o.newAttributes,Ee=o.enabledAttributes;for(let We=0,rt=Ee.length;We<rt;We++)Ee[We]!==ue[We]&&(t.disableVertexAttribArray(We),Ee[We]=0)}function j(ue,Ee,We,rt,tt,Ye,qe){qe===!0?t.vertexAttribIPointer(ue,Ee,We,tt,Ye):t.vertexAttribPointer(ue,Ee,We,rt,tt,Ye)}function q(ue,Ee,We,rt){z();const tt=rt.attributes,Ye=We.getAttributes(),qe=Ee.defaultAttributeValues;for(const ft in Ye){const Me=Ye[ft];if(Me.location>=0){let $e=tt[ft];if($e===void 0&&(ft==="instanceMatrix"&&ue.instanceMatrix&&($e=ue.instanceMatrix),ft==="instanceColor"&&ue.instanceColor&&($e=ue.instanceColor)),$e!==void 0){const ut=$e.normalized,Mt=$e.itemSize,Gt=e.get($e);if(Gt===void 0)continue;const Xt=Gt.buffer,Qe=Gt.type,Ge=Gt.bytesPerElement,He=Qe===t.INT||Qe===t.UNSIGNED_INT||$e.gpuType===$A;if($e.isInterleavedBufferAttribute){const De=$e.data,kt=De.stride,rn=$e.offset;if(De.isInstancedInterleavedBuffer){for(let Re=0;Re<Me.locationSize;Re++)P(Me.location+Re,De.meshPerAttribute);ue.isInstancedMesh!==!0&&rt._maxInstanceCount===void 0&&(rt._maxInstanceCount=De.meshPerAttribute*De.count)}else for(let Re=0;Re<Me.locationSize;Re++)L(Me.location+Re);t.bindBuffer(t.ARRAY_BUFFER,Xt);for(let Re=0;Re<Me.locationSize;Re++)j(Me.location+Re,Mt/Me.locationSize,Qe,ut,kt*Ge,(rn+Mt/Me.locationSize*Re)*Ge,He)}else{if($e.isInstancedBufferAttribute){for(let De=0;De<Me.locationSize;De++)P(Me.location+De,$e.meshPerAttribute);ue.isInstancedMesh!==!0&&rt._maxInstanceCount===void 0&&(rt._maxInstanceCount=$e.meshPerAttribute*$e.count)}else for(let De=0;De<Me.locationSize;De++)L(Me.location+De);t.bindBuffer(t.ARRAY_BUFFER,Xt);for(let De=0;De<Me.locationSize;De++)j(Me.location+De,Mt/Me.locationSize,Qe,ut,Mt*Ge,Mt/Me.locationSize*De*Ge,He)}}else if(qe!==void 0){const ut=qe[ft];if(ut!==void 0)switch(ut.length){case 2:t.vertexAttrib2fv(Me.location,ut);break;case 3:t.vertexAttrib3fv(Me.location,ut);break;case 4:t.vertexAttrib4fv(Me.location,ut);break;default:t.vertexAttrib1fv(Me.location,ut)}}}}H()}function le(){pe();for(const ue in i){const Ee=i[ue];for(const We in Ee){const rt=Ee[We];for(const tt in rt)w(rt[tt].object),delete rt[tt];delete Ee[We]}delete i[ue]}}function ce(ue){if(i[ue.id]===void 0)return;const Ee=i[ue.id];for(const We in Ee){const rt=Ee[We];for(const tt in rt)w(rt[tt].object),delete rt[tt];delete Ee[We]}delete i[ue.id]}function ae(ue){for(const Ee in i){const We=i[Ee];if(We[ue.id]===void 0)continue;const rt=We[ue.id];for(const tt in rt)w(rt[tt].object),delete rt[tt];delete We[ue.id]}}function pe(){fe(),c=!0,o!==r&&(o=r,v(o.object))}function fe(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:s,reset:pe,resetDefaultState:fe,dispose:le,releaseStatesOfGeometry:ce,releaseStatesOfProgram:ae,initAttributes:z,enableAttribute:L,disableUnusedAttributes:H}}function cPe(t,e,n){let i;function r(v){i=v}function o(v,w){t.drawArrays(i,v,w),n.update(w,i,1)}function c(v,w,C){C!==0&&(t.drawArraysInstanced(i,v,w,C),n.update(w,i,C))}function s(v,w,C){if(C===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,v,0,w,0,C);let F=0;for(let N=0;N<C;N++)F+=w[N];n.update(F,i,1)}function f(v,w,C,M){if(C===0)return;const F=e.get("WEBGL_multi_draw");if(F===null)for(let N=0;N<v.length;N++)c(v[N],w[N],M[N]);else{F.multiDrawArraysInstancedWEBGL(i,v,0,w,0,M,0,C);let N=0;for(let z=0;z<C;z++)N+=w[z]*M[z];n.update(N,i,1)}}this.setMode=r,this.render=o,this.renderInstances=c,this.renderMultiDraw=s,this.renderMultiDrawInstances=f}function uPe(t,e,n,i){let r;function o(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const ae=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(ae.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function c(ae){return!(ae!==wl&&i.convert(ae)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function s(ae){const pe=ae===kw&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(ae!==dd&&i.convert(ae)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&ae!==kc&&!pe)}function f(ae){if(ae==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";ae="mediump"}return ae==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let v=n.precision!==void 0?n.precision:"highp";const w=f(v);w!==v&&(console.warn("THREE.WebGLRenderer:",v,"not supported, using",w,"instead."),v=w);const C=n.logarithmicDepthBuffer===!0,M=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),F=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),N=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),z=t.getParameter(t.MAX_TEXTURE_SIZE),L=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),P=t.getParameter(t.MAX_VERTEX_ATTRIBS),H=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),j=t.getParameter(t.MAX_VARYING_VECTORS),q=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),le=N>0,ce=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:f,textureFormatReadable:c,textureTypeReadable:s,precision:v,logarithmicDepthBuffer:C,reverseDepthBuffer:M,maxTextures:F,maxVertexTextures:N,maxTextureSize:z,maxCubemapSize:L,maxAttributes:P,maxVertexUniforms:H,maxVaryings:j,maxFragmentUniforms:q,vertexTextures:le,maxSamples:ce}}function hPe(t){const e=this;let n=null,i=0,r=!1,o=!1;const c=new Tg,s=new dr,f={value:null,needsUpdate:!1};this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(C,M){const F=C.length!==0||M||i!==0||r;return r=M,i=C.length,F},this.beginShadows=function(){o=!0,w(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(C,M){n=w(C,M,0)},this.setState=function(C,M,F){const N=C.clippingPlanes,z=C.clipIntersection,L=C.clipShadows,P=t.get(C);if(!r||N===null||N.length===0||o&&!L)o?w(null):v();else{const H=o?0:i,j=H*4;let q=P.clippingState||null;f.value=q,q=w(N,M,j,F);for(let le=0;le!==j;++le)q[le]=n[le];P.clippingState=q,this.numIntersection=z?this.numPlanes:0,this.numPlanes+=H}};function v(){f.value!==n&&(f.value=n,f.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function w(C,M,F,N){const z=C!==null?C.length:0;let L=null;if(z!==0){if(L=f.value,N!==!0||L===null){const P=F+z*4,H=M.matrixWorldInverse;s.getNormalMatrix(H),(L===null||L.length<P)&&(L=new Float32Array(P));for(let j=0,q=F;j!==z;++j,q+=4)c.copy(C[j]).applyMatrix4(H,s),c.normal.toArray(L,q),L[q+3]=c.constant}f.value=L,f.needsUpdate=!0}return e.numPlanes=z,e.numIntersection=0,L}}function dPe(t){let e=new WeakMap;function n(c,s){return s===uS?c.mapping=rm:s===hS&&(c.mapping=dv),c}function i(c){if(c&&c.isTexture){const s=c.mapping;if(s===uS||s===hS)if(e.has(c)){const f=e.get(c).texture;return n(f,c.mapping)}else{const f=c.image;if(f&&f.height>0){const v=new bY(f.height);return v.fromEquirectangularTexture(t,c),e.set(c,v),c.addEventListener("dispose",r),n(v.texture,c.mapping)}else return null}}return c}function r(c){const s=c.target;s.removeEventListener("dispose",r);const f=e.get(s);f!==void 0&&(e.delete(s),f.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}class hb extends lb{constructor(e=-1,n=1,i=1,r=-1,o=.1,c=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=r,this.near=o,this.far=c,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,r,o,c){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,c=i+e,s=r+n,f=r-n;if(this.view!==null&&this.view.enabled){const v=(this.right-this.left)/this.view.fullWidth/this.zoom,w=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=v*this.view.offsetX,c=o+v*this.view.width,s-=w*this.view.offsetY,f=s-w*this.view.height}this.projectionMatrix.makeOrthographic(o,c,s,f,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const vx=4,S6=[.125,.215,.35,.446,.526,.582],Fy=20,_2=new hb,b6=new bi;let x2=null,w2=0,C2=0,S2=!1;const Py=(1+Math.sqrt(5))/2,G0=1/Py,E6=[new gt(-Py,G0,0),new gt(Py,G0,0),new gt(-G0,0,Py),new gt(G0,0,Py),new gt(0,Py,-G0),new gt(0,Py,G0),new gt(-1,1,-1),new gt(1,1,-1),new gt(-1,1,1),new gt(1,1,1)];class Hk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,r=100){x2=this._renderer.getRenderTarget(),w2=this._renderer.getActiveCubeFace(),C2=this._renderer.getActiveMipmapLevel(),S2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),n>0&&this._blur(o,0,0,n),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=T6(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=R6(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(x2,w2,C2),this._renderer.xr.enabled=S2,e.scissorTest=!1,dM(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===rm||e.mapping===dv?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),x2=this._renderer.getRenderTarget(),w2=this._renderer.getActiveCubeFace(),C2=this._renderer.getActiveMipmapLevel(),S2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:Ma,minFilter:Ma,generateMipmaps:!1,type:kw,format:wl,colorSpace:H_,depthBuffer:!1},r=M6(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=M6(e,n,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=fPe(o)),this._blurMaterial=pPe(o,e,n)}return r}_compileMaterial(e){const n=new va(this._lodPlanes[0],e);this._renderer.compile(n,_2)}_sceneToCubeUV(e,n,i,r){const s=new Ua(90,1,n,i),f=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],w=this._renderer,C=w.autoClear,M=w.toneMapping;w.getClearColor(b6),w.toneMapping=Cf,w.autoClear=!1;const F=new Ev({name:"PMREM.Background",side:Jl,depthWrite:!1,depthTest:!1}),N=new va(new W_,F);let z=!1;const L=e.background;L?L.isColor&&(F.color.copy(L),e.background=null,z=!0):(F.color.copy(b6),z=!0);for(let P=0;P<6;P++){const H=P%3;H===0?(s.up.set(0,f[P],0),s.lookAt(v[P],0,0)):H===1?(s.up.set(0,0,f[P]),s.lookAt(0,v[P],0)):(s.up.set(0,f[P],0),s.lookAt(0,0,v[P]));const j=this._cubeSize;dM(r,H*j,P>2?j:0,j,j),w.setRenderTarget(r),z&&w.render(N,s),w.render(e,s)}N.geometry.dispose(),N.material.dispose(),w.toneMapping=M,w.autoClear=C,e.background=L}_textureToCubeUV(e,n){const i=this._renderer,r=e.mapping===rm||e.mapping===dv;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=T6()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=R6());const o=r?this._cubemapMaterial:this._equirectMaterial,c=new va(this._lodPlanes[0],o),s=o.uniforms;s.envMap.value=e;const f=this._cubeSize;dM(n,0,0,3*f,2*f),i.setRenderTarget(n),i.render(c,_2)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;const r=this._lodPlanes.length;for(let o=1;o<r;o++){const c=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),s=E6[(r-o-1)%E6.length];this._blur(e,o-1,o,c,s)}n.autoClear=i}_blur(e,n,i,r,o){const c=this._pingPongRenderTarget;this._halfBlur(e,c,n,i,r,"latitudinal",o),this._halfBlur(c,e,i,i,r,"longitudinal",o)}_halfBlur(e,n,i,r,o,c,s){const f=this._renderer,v=this._blurMaterial;c!=="latitudinal"&&c!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const w=3,C=new va(this._lodPlanes[r],v),M=v.uniforms,F=this._sizeLods[i]-1,N=isFinite(o)?Math.PI/(2*F):2*Math.PI/(2*Fy-1),z=o/N,L=isFinite(o)?1+Math.floor(w*z):Fy;L>Fy&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${L} samples when the maximum is set to ${Fy}`);const P=[];let H=0;for(let ae=0;ae<Fy;++ae){const pe=ae/z,fe=Math.exp(-pe*pe/2);P.push(fe),ae===0?H+=fe:ae<L&&(H+=2*fe)}for(let ae=0;ae<P.length;ae++)P[ae]=P[ae]/H;M.envMap.value=e.texture,M.samples.value=L,M.weights.value=P,M.latitudinal.value=c==="latitudinal",s&&(M.poleAxis.value=s);const{_lodMax:j}=this;M.dTheta.value=N,M.mipInt.value=j-i;const q=this._sizeLods[r],le=3*q*(r>j-vx?r-j+vx:0),ce=4*(this._cubeSize-q);dM(n,le,ce,3*q,2*q),f.setRenderTarget(n),f.render(C,_2)}}function fPe(t){const e=[],n=[],i=[];let r=t;const o=t-vx+1+S6.length;for(let c=0;c<o;c++){const s=Math.pow(2,r);n.push(s);let f=1/s;c>t-vx?f=S6[c-t+vx-1]:c===0&&(f=0),i.push(f);const v=1/(s-2),w=-v,C=1+v,M=[w,w,C,w,C,C,w,w,C,C,w,C],F=6,N=6,z=3,L=2,P=1,H=new Float32Array(z*N*F),j=new Float32Array(L*N*F),q=new Float32Array(P*N*F);for(let ce=0;ce<F;ce++){const ae=ce%3*2/3-1,pe=ce>2?0:-1,fe=[ae,pe,0,ae+2/3,pe,0,ae+2/3,pe+1,0,ae,pe,0,ae+2/3,pe+1,0,ae,pe+1,0];H.set(fe,z*N*ce),j.set(M,L*N*ce);const ue=[ce,ce,ce,ce,ce,ce];q.set(ue,P*N*ce)}const le=new Cr;le.setAttribute("position",new ns(H,z)),le.setAttribute("uv",new ns(j,L)),le.setAttribute("faceIndex",new ns(q,P)),e.push(le),r>vx&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function M6(t,e,n){const i=new fd(t,e,n);return i.texture.mapping=Ow,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function dM(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function pPe(t,e,n){const i=new Float32Array(Fy),r=new gt(0,1,0);return new ih({name:"SphericalGaussianBlur",defines:{n:Fy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:BB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Wp,depthTest:!1,depthWrite:!1})}function R6(){return new ih({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:BB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Wp,depthTest:!1,depthWrite:!1})}function T6(){return new ih({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:BB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Wp,depthTest:!1,depthWrite:!1})}function BB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function mPe(t){let e=new WeakMap,n=null;function i(s){if(s&&s.isTexture){const f=s.mapping,v=f===uS||f===hS,w=f===rm||f===dv;if(v||w){let C=e.get(s);const M=C!==void 0?C.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==M)return n===null&&(n=new Hk(t)),C=v?n.fromEquirectangular(s,C):n.fromCubemap(s,C),C.texture.pmremVersion=s.pmremVersion,e.set(s,C),C.texture;if(C!==void 0)return C.texture;{const F=s.image;return v&&F&&F.height>0||w&&F&&r(F)?(n===null&&(n=new Hk(t)),C=v?n.fromEquirectangular(s):n.fromCubemap(s),C.texture.pmremVersion=s.pmremVersion,e.set(s,C),s.addEventListener("dispose",o),C.texture):null}}}return s}function r(s){let f=0;const v=6;for(let w=0;w<v;w++)s[w]!==void 0&&f++;return f===v}function o(s){const f=s.target;f.removeEventListener("dispose",o);const v=e.get(f);v!==void 0&&(e.delete(f),v.dispose())}function c(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:c}}function gPe(t){const e={};function n(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return e[i]=r,r}return{has:function(i){return n(i)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(i){const r=n(i);return r===null&&l1("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function vPe(t,e,n,i){const r={},o=new WeakMap;function c(C){const M=C.target;M.index!==null&&e.remove(M.index);for(const N in M.attributes)e.remove(M.attributes[N]);for(const N in M.morphAttributes){const z=M.morphAttributes[N];for(let L=0,P=z.length;L<P;L++)e.remove(z[L])}M.removeEventListener("dispose",c),delete r[M.id];const F=o.get(M);F&&(e.remove(F),o.delete(M)),i.releaseStatesOfGeometry(M),M.isInstancedBufferGeometry===!0&&delete M._maxInstanceCount,n.memory.geometries--}function s(C,M){return r[M.id]===!0||(M.addEventListener("dispose",c),r[M.id]=!0,n.memory.geometries++),M}function f(C){const M=C.attributes;for(const N in M)e.update(M[N],t.ARRAY_BUFFER);const F=C.morphAttributes;for(const N in F){const z=F[N];for(let L=0,P=z.length;L<P;L++)e.update(z[L],t.ARRAY_BUFFER)}}function v(C){const M=[],F=C.index,N=C.attributes.position;let z=0;if(F!==null){const H=F.array;z=F.version;for(let j=0,q=H.length;j<q;j+=3){const le=H[j+0],ce=H[j+1],ae=H[j+2];M.push(le,ce,ce,ae,ae,le)}}else if(N!==void 0){const H=N.array;z=N.version;for(let j=0,q=H.length/3-1;j<q;j+=3){const le=j+0,ce=j+1,ae=j+2;M.push(le,ce,ce,ae,ae,le)}}else return;const L=new(gY(M)?NB:kB)(M,1);L.version=z;const P=o.get(C);P&&e.remove(P),o.set(C,L)}function w(C){const M=o.get(C);if(M){const F=C.index;F!==null&&M.version<F.version&&v(C)}else v(C);return o.get(C)}return{get:s,update:f,getWireframeAttribute:w}}function yPe(t,e,n){let i;function r(M){i=M}let o,c;function s(M){o=M.type,c=M.bytesPerElement}function f(M,F){t.drawElements(i,F,o,M*c),n.update(F,i,1)}function v(M,F,N){N!==0&&(t.drawElementsInstanced(i,F,o,M*c,N),n.update(F,i,N))}function w(M,F,N){if(N===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,F,0,o,M,0,N);let L=0;for(let P=0;P<N;P++)L+=F[P];n.update(L,i,1)}function C(M,F,N,z){if(N===0)return;const L=e.get("WEBGL_multi_draw");if(L===null)for(let P=0;P<M.length;P++)v(M[P]/c,F[P],z[P]);else{L.multiDrawElementsInstancedWEBGL(i,F,0,o,M,0,z,0,N);let P=0;for(let H=0;H<N;H++)P+=F[H]*z[H];n.update(P,i,1)}}this.setMode=r,this.setIndex=s,this.render=f,this.renderInstances=v,this.renderMultiDraw=w,this.renderMultiDrawInstances=C}function _Pe(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,c,s){switch(n.calls++,c){case t.TRIANGLES:n.triangles+=s*(o/3);break;case t.LINES:n.lines+=s*(o/2);break;case t.LINE_STRIP:n.lines+=s*(o-1);break;case t.LINE_LOOP:n.lines+=s*o;break;case t.POINTS:n.points+=s*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function r(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function xPe(t,e,n){const i=new WeakMap,r=new xs;function o(c,s,f){const v=c.morphTargetInfluences,w=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,C=w!==void 0?w.length:0;let M=i.get(s);if(M===void 0||M.count!==C){let fe=function(){ae.dispose(),i.delete(s),s.removeEventListener("dispose",fe)};M!==void 0&&M.texture.dispose();const F=s.morphAttributes.position!==void 0,N=s.morphAttributes.normal!==void 0,z=s.morphAttributes.color!==void 0,L=s.morphAttributes.position||[],P=s.morphAttributes.normal||[],H=s.morphAttributes.color||[];let j=0;F===!0&&(j=1),N===!0&&(j=2),z===!0&&(j=3);let q=s.attributes.position.count*j,le=1;q>e.maxTextureSize&&(le=Math.ceil(q/e.maxTextureSize),q=e.maxTextureSize);const ce=new Float32Array(q*le*4*C),ae=new QA(ce,q,le,C);ae.type=kc,ae.needsUpdate=!0;const pe=j*4;for(let ue=0;ue<C;ue++){const Ee=L[ue],We=P[ue],rt=H[ue],tt=q*le*4*ue;for(let Ye=0;Ye<Ee.count;Ye++){const qe=Ye*pe;F===!0&&(r.fromBufferAttribute(Ee,Ye),ce[tt+qe+0]=r.x,ce[tt+qe+1]=r.y,ce[tt+qe+2]=r.z,ce[tt+qe+3]=0),N===!0&&(r.fromBufferAttribute(We,Ye),ce[tt+qe+4]=r.x,ce[tt+qe+5]=r.y,ce[tt+qe+6]=r.z,ce[tt+qe+7]=0),z===!0&&(r.fromBufferAttribute(rt,Ye),ce[tt+qe+8]=r.x,ce[tt+qe+9]=r.y,ce[tt+qe+10]=r.z,ce[tt+qe+11]=rt.itemSize===4?r.w:1)}}M={count:C,texture:ae,size:new Cn(q,le)},i.set(s,M),s.addEventListener("dispose",fe)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)f.getUniforms().setValue(t,"morphTexture",c.morphTexture,n);else{let F=0;for(let z=0;z<v.length;z++)F+=v[z];const N=s.morphTargetsRelative?1:1-F;f.getUniforms().setValue(t,"morphTargetBaseInfluence",N),f.getUniforms().setValue(t,"morphTargetInfluences",v)}f.getUniforms().setValue(t,"morphTargetsTexture",M.texture,n),f.getUniforms().setValue(t,"morphTargetsTextureSize",M.size)}return{update:o}}function wPe(t,e,n,i){let r=new WeakMap;function o(f){const v=i.render.frame,w=f.geometry,C=e.get(f,w);if(r.get(C)!==v&&(e.update(C),r.set(C,v)),f.isInstancedMesh&&(f.hasEventListener("dispose",s)===!1&&f.addEventListener("dispose",s),r.get(f)!==v&&(n.update(f.instanceMatrix,t.ARRAY_BUFFER),f.instanceColor!==null&&n.update(f.instanceColor,t.ARRAY_BUFFER),r.set(f,v))),f.isSkinnedMesh){const M=f.skeleton;r.get(M)!==v&&(M.update(),r.set(M,v))}return C}function c(){r=new WeakMap}function s(f){const v=f.target;v.removeEventListener("dispose",s),n.remove(v.instanceMatrix),v.instanceColor!==null&&n.remove(v.instanceColor)}return{update:o,dispose:c}}class zB extends Oo{constructor(e,n,i,r,o,c,s,f,v,w=l_){if(w!==l_&&w!==R_)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&w===l_&&(i=sm),i===void 0&&w===R_&&(i=M_),super(null,r,o,c,s,f,w,i,v),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=s!==void 0?s:el,this.minFilter=f!==void 0?f:el,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const MY=new Oo,A6=new zB(1,1),RY=new QA,TY=new OB,AY=new cb,P6=[],I6=[],D6=new Float32Array(16),F6=new Float32Array(9),L6=new Float32Array(4);function zw(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let o=P6[r];if(o===void 0&&(o=new Float32Array(r),P6[r]=o),e!==0){i.toArray(o,0);for(let c=1,s=0;c!==e;++c)s+=n,t[c].toArray(o,s)}return o}function Ta(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Aa(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function eP(t,e){let n=I6[e];n===void 0&&(n=new Int32Array(e),I6[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function CPe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function SPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ta(n,e))return;t.uniform2fv(this.addr,e),Aa(n,e)}}function bPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ta(n,e))return;t.uniform3fv(this.addr,e),Aa(n,e)}}function EPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ta(n,e))return;t.uniform4fv(this.addr,e),Aa(n,e)}}function MPe(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ta(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Aa(n,e)}else{if(Ta(n,i))return;L6.set(i),t.uniformMatrix2fv(this.addr,!1,L6),Aa(n,i)}}function RPe(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ta(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Aa(n,e)}else{if(Ta(n,i))return;F6.set(i),t.uniformMatrix3fv(this.addr,!1,F6),Aa(n,i)}}function TPe(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ta(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Aa(n,e)}else{if(Ta(n,i))return;D6.set(i),t.uniformMatrix4fv(this.addr,!1,D6),Aa(n,i)}}function APe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function PPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ta(n,e))return;t.uniform2iv(this.addr,e),Aa(n,e)}}function IPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ta(n,e))return;t.uniform3iv(this.addr,e),Aa(n,e)}}function DPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ta(n,e))return;t.uniform4iv(this.addr,e),Aa(n,e)}}function FPe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function LPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ta(n,e))return;t.uniform2uiv(this.addr,e),Aa(n,e)}}function OPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ta(n,e))return;t.uniform3uiv(this.addr,e),Aa(n,e)}}function kPe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ta(n,e))return;t.uniform4uiv(this.addr,e),Aa(n,e)}}function NPe(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);let o;this.type===t.SAMPLER_2D_SHADOW?(A6.compareFunction=FB,o=A6):o=MY,n.setTexture2D(e||o,r)}function BPe(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||TY,r)}function zPe(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||AY,r)}function UPe(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||RY,r)}function VPe(t){switch(t){case 5126:return CPe;case 35664:return SPe;case 35665:return bPe;case 35666:return EPe;case 35674:return MPe;case 35675:return RPe;case 35676:return TPe;case 5124:case 35670:return APe;case 35667:case 35671:return PPe;case 35668:case 35672:return IPe;case 35669:case 35673:return DPe;case 5125:return FPe;case 36294:return LPe;case 36295:return OPe;case 36296:return kPe;case 35678:case 36198:case 36298:case 36306:case 35682:return NPe;case 35679:case 36299:case 36307:return BPe;case 35680:case 36300:case 36308:case 36293:return zPe;case 36289:case 36303:case 36311:case 36292:return UPe}}function GPe(t,e){t.uniform1fv(this.addr,e)}function HPe(t,e){const n=zw(e,this.size,2);t.uniform2fv(this.addr,n)}function WPe(t,e){const n=zw(e,this.size,3);t.uniform3fv(this.addr,n)}function jPe(t,e){const n=zw(e,this.size,4);t.uniform4fv(this.addr,n)}function $Pe(t,e){const n=zw(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function qPe(t,e){const n=zw(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function ZPe(t,e){const n=zw(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function XPe(t,e){t.uniform1iv(this.addr,e)}function KPe(t,e){t.uniform2iv(this.addr,e)}function YPe(t,e){t.uniform3iv(this.addr,e)}function JPe(t,e){t.uniform4iv(this.addr,e)}function QPe(t,e){t.uniform1uiv(this.addr,e)}function eIe(t,e){t.uniform2uiv(this.addr,e)}function tIe(t,e){t.uniform3uiv(this.addr,e)}function nIe(t,e){t.uniform4uiv(this.addr,e)}function iIe(t,e,n){const i=this.cache,r=e.length,o=eP(n,r);Ta(i,o)||(t.uniform1iv(this.addr,o),Aa(i,o));for(let c=0;c!==r;++c)n.setTexture2D(e[c]||MY,o[c])}function rIe(t,e,n){const i=this.cache,r=e.length,o=eP(n,r);Ta(i,o)||(t.uniform1iv(this.addr,o),Aa(i,o));for(let c=0;c!==r;++c)n.setTexture3D(e[c]||TY,o[c])}function sIe(t,e,n){const i=this.cache,r=e.length,o=eP(n,r);Ta(i,o)||(t.uniform1iv(this.addr,o),Aa(i,o));for(let c=0;c!==r;++c)n.setTextureCube(e[c]||AY,o[c])}function oIe(t,e,n){const i=this.cache,r=e.length,o=eP(n,r);Ta(i,o)||(t.uniform1iv(this.addr,o),Aa(i,o));for(let c=0;c!==r;++c)n.setTexture2DArray(e[c]||RY,o[c])}function aIe(t){switch(t){case 5126:return GPe;case 35664:return HPe;case 35665:return WPe;case 35666:return jPe;case 35674:return $Pe;case 35675:return qPe;case 35676:return ZPe;case 5124:case 35670:return XPe;case 35667:case 35671:return KPe;case 35668:case 35672:return YPe;case 35669:case 35673:return JPe;case 5125:return QPe;case 36294:return eIe;case 36295:return tIe;case 36296:return nIe;case 35678:case 36198:case 36298:case 36306:case 35682:return iIe;case 35679:case 36299:case 36307:return rIe;case 35680:case 36300:case 36308:case 36293:return sIe;case 36289:case 36303:case 36311:case 36292:return oIe}}class lIe{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.setValue=VPe(n.type)}}class cIe{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=aIe(n.type)}}class uIe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const r=this.seq;for(let o=0,c=r.length;o!==c;++o){const s=r[o];s.setValue(e,n[s.id],i)}}}const b2=/(\w+)(\])?(\[|\.)?/g;function O6(t,e){t.seq.push(e),t.map[e.id]=e}function hIe(t,e,n){const i=t.name,r=i.length;for(b2.lastIndex=0;;){const o=b2.exec(i),c=b2.lastIndex;let s=o[1];const f=o[2]==="]",v=o[3];if(f&&(s=s|0),v===void 0||v==="["&&c+2===r){O6(n,v===void 0?new lIe(s,t,e):new cIe(s,t,e));break}else{let C=n.map[s];C===void 0&&(C=new uIe(s),O6(n,C)),n=C}}}class mR{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const o=e.getActiveUniform(n,r),c=e.getUniformLocation(n,o.name);hIe(o,c,this)}}setValue(e,n,i,r){const o=this.map[n];o!==void 0&&o.setValue(e,i,r)}setOptional(e,n,i){const r=n[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,n,i,r){for(let o=0,c=n.length;o!==c;++o){const s=n[o],f=i[s.id];f.needsUpdate!==!1&&s.setValue(e,f.value,r)}}static seqWithValue(e,n){const i=[];for(let r=0,o=e.length;r!==o;++r){const c=e[r];c.id in n&&i.push(c)}return i}}function k6(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const dIe=37297;let fIe=0;function pIe(t,e){const n=t.split(`
`),i=[],r=Math.max(e-6,0),o=Math.min(e+6,n.length);for(let c=r;c<o;c++){const s=c+1;i.push(`${s===e?">":" "} ${s}: ${n[c]}`)}return i.join(`
`)}const N6=new dr;function mIe(t){ls._getMatrix(N6,ls.workingColorSpace,t);const e=`mat3( ${N6.elements.map(n=>n.toFixed(4))} )`;switch(ls.getTransfer(t)){case ab:return[e,"LinearTransferOETF"];case Ns:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function B6(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&r==="")return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const c=parseInt(o[1]);return n.toUpperCase()+`

`+r+`

`+pIe(t.getShaderSource(e),c)}else return r}function gIe(t,e){const n=mIe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function vIe(t,e){let n;switch(e){case KK:n="Linear";break;case YK:n="Reinhard";break;case JK:n="Cineon";break;case wB:n="ACESFilmic";break;case eY:n="AgX";break;case tY:n="Neutral";break;case QK:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const fM=new gt;function yIe(){ls.getLuminanceCoefficients(fM);const t=fM.x.toFixed(4),e=fM.y.toFixed(4),n=fM.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function _Ie(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(u1).join(`
`)}function xIe(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function wIe(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const o=t.getActiveAttrib(e,r),c=o.name;let s=1;o.type===t.FLOAT_MAT2&&(s=2),o.type===t.FLOAT_MAT3&&(s=3),o.type===t.FLOAT_MAT4&&(s=4),n[c]={type:o.type,location:t.getAttribLocation(e,c),locationSize:s}}return n}function u1(t){return t!==""}function z6(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function U6(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const CIe=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wk(t){return t.replace(CIe,bIe)}const SIe=new Map;function bIe(t,e){let n=kr[e];if(n===void 0){const i=SIe.get(e);if(i!==void 0)n=kr[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Wk(n)}const EIe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function V6(t){return t.replace(EIe,MIe)}function MIe(t,e,n,i){let r="";for(let o=parseInt(e);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function G6(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function RIe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===WA?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===M1?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===qh&&(e="SHADOWMAP_TYPE_VSM"),e}function TIe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case rm:case dv:e="ENVMAP_TYPE_CUBE";break;case Ow:e="ENVMAP_TYPE_CUBE_UV";break}return e}function AIe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case dv:e="ENVMAP_MODE_REFRACTION";break}return e}function PIe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case sb:e="ENVMAP_BLENDING_MULTIPLY";break;case ZK:e="ENVMAP_BLENDING_MIX";break;case XK:e="ENVMAP_BLENDING_ADD";break}return e}function IIe(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function DIe(t,e,n,i){const r=t.getContext(),o=n.defines;let c=n.vertexShader,s=n.fragmentShader;const f=RIe(n),v=TIe(n),w=AIe(n),C=PIe(n),M=IIe(n),F=_Ie(n),N=xIe(o),z=r.createProgram();let L,P,H=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(L=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N].filter(u1).join(`
`),L.length>0&&(L+=`
`),P=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N].filter(u1).join(`
`),P.length>0&&(P+=`
`)):(L=[G6(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+w:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+f:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(u1).join(`
`),P=[G6(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+v:"",n.envMap?"#define "+w:"",n.envMap?"#define "+C:"",M?"#define CUBEUV_TEXEL_WIDTH "+M.texelWidth:"",M?"#define CUBEUV_TEXEL_HEIGHT "+M.texelHeight:"",M?"#define CUBEUV_MAX_MIP "+M.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+f:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Cf?"#define TONE_MAPPING":"",n.toneMapping!==Cf?kr.tonemapping_pars_fragment:"",n.toneMapping!==Cf?vIe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",kr.colorspace_pars_fragment,gIe("linearToOutputTexel",n.outputColorSpace),yIe(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(u1).join(`
`)),c=Wk(c),c=z6(c,n),c=U6(c,n),s=Wk(s),s=z6(s,n),s=U6(s,n),c=V6(c),s=V6(s),n.isRawShaderMaterial!==!0&&(H=`#version 300 es
`,L=[F,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+L,P=["#define varying in",n.glslVersion===Gk?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Gk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+P);const j=H+L+c,q=H+P+s,le=k6(r,r.VERTEX_SHADER,j),ce=k6(r,r.FRAGMENT_SHADER,q);r.attachShader(z,le),r.attachShader(z,ce),n.index0AttributeName!==void 0?r.bindAttribLocation(z,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(z,0,"position"),r.linkProgram(z);function ae(Ee){if(t.debug.checkShaderErrors){const We=r.getProgramInfoLog(z).trim(),rt=r.getShaderInfoLog(le).trim(),tt=r.getShaderInfoLog(ce).trim();let Ye=!0,qe=!0;if(r.getProgramParameter(z,r.LINK_STATUS)===!1)if(Ye=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,z,le,ce);else{const ft=B6(r,le,"vertex"),Me=B6(r,ce,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(z,r.VALIDATE_STATUS)+`

Material Name: `+Ee.name+`
Material Type: `+Ee.type+`

Program Info Log: `+We+`
`+ft+`
`+Me)}else We!==""?console.warn("THREE.WebGLProgram: Program Info Log:",We):(rt===""||tt==="")&&(qe=!1);qe&&(Ee.diagnostics={runnable:Ye,programLog:We,vertexShader:{log:rt,prefix:L},fragmentShader:{log:tt,prefix:P}})}r.deleteShader(le),r.deleteShader(ce),pe=new mR(r,z),fe=wIe(r,z)}let pe;this.getUniforms=function(){return pe===void 0&&ae(this),pe};let fe;this.getAttributes=function(){return fe===void 0&&ae(this),fe};let ue=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ue===!1&&(ue=r.getProgramParameter(z,dIe)),ue},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(z),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=fIe++,this.cacheKey=e,this.usedTimes=1,this.program=z,this.vertexShader=le,this.fragmentShader=ce,this}let FIe=0;class LIe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(n),o=this._getShaderStage(i),c=this._getShaderCacheForMaterial(e);return c.has(r)===!1&&(c.add(r),r.usedTimes++),c.has(o)===!1&&(c.add(o),o.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new OIe(e),n.set(e,i)),i}}class OIe{constructor(e){this.id=FIe++,this.code=e,this.usedTimes=0}}function kIe(t,e,n,i,r,o,c){const s=new u_,f=new LIe,v=new Set,w=[],C=r.logarithmicDepthBuffer,M=r.vertexTextures;let F=r.precision;const N={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function z(fe){return v.add(fe),fe===0?"uv":`uv${fe}`}function L(fe,ue,Ee,We,rt){const tt=We.fog,Ye=rt.geometry,qe=fe.isMeshStandardMaterial?We.environment:null,ft=(fe.isMeshStandardMaterial?n:e).get(fe.envMap||qe),Me=ft&&ft.mapping===Ow?ft.image.height:null,$e=N[fe.type];fe.precision!==null&&(F=r.getMaxPrecision(fe.precision),F!==fe.precision&&console.warn("THREE.WebGLProgram.getParameters:",fe.precision,"not supported, using",F,"instead."));const ut=Ye.morphAttributes.position||Ye.morphAttributes.normal||Ye.morphAttributes.color,Mt=ut!==void 0?ut.length:0;let Gt=0;Ye.morphAttributes.position!==void 0&&(Gt=1),Ye.morphAttributes.normal!==void 0&&(Gt=2),Ye.morphAttributes.color!==void 0&&(Gt=3);let Xt,Qe,Ge,He;if($e){const we=ed[$e];Xt=we.vertexShader,Qe=we.fragmentShader}else Xt=fe.vertexShader,Qe=fe.fragmentShader,f.update(fe),Ge=f.getVertexShaderID(fe),He=f.getFragmentShaderID(fe);const De=t.getRenderTarget(),kt=t.state.buffers.depth.getReversed(),rn=rt.isInstancedMesh===!0,Re=rt.isBatchedMesh===!0,Kt=!!fe.map,bt=!!fe.matcap,Dt=!!ft,_e=!!fe.aoMap,At=!!fe.lightMap,Ot=!!fe.bumpMap,tn=!!fe.normalMap,xe=!!fe.displacementMap,Se=!!fe.emissiveMap,it=!!fe.metalnessMap,Le=!!fe.roughnessMap,Pe=fe.anisotropy>0,vt=fe.clearcoat>0,yt=fe.dispersion>0,nn=fe.iridescence>0,jt=fe.sheen>0,Fn=fe.transmission>0,Bn=Pe&&!!fe.anisotropyMap,Zn=vt&&!!fe.clearcoatMap,Li=vt&&!!fe.clearcoatNormalMap,zn=vt&&!!fe.clearcoatRoughnessMap,oi=nn&&!!fe.iridescenceMap,gi=nn&&!!fe.iridescenceThicknessMap,Ti=jt&&!!fe.sheenColorMap,pi=jt&&!!fe.sheenRoughnessMap,Ji=!!fe.specularMap,er=!!fe.specularColorMap,vi=!!fe.specularIntensityMap,Wt=Fn&&!!fe.transmissionMap,ui=Fn&&!!fe.thicknessMap,vn=!!fe.gradientMap,Ln=!!fe.alphaMap,mi=fe.alphaTest>0,hi=!!fe.alphaHash,Xi=!!fe.extensions;let cs=Cf;fe.toneMapped&&(De===null||De.isXRRenderTarget===!0)&&(cs=t.toneMapping);const Ft={shaderID:$e,shaderType:fe.type,shaderName:fe.name,vertexShader:Xt,fragmentShader:Qe,defines:fe.defines,customVertexShaderID:Ge,customFragmentShaderID:He,isRawShaderMaterial:fe.isRawShaderMaterial===!0,glslVersion:fe.glslVersion,precision:F,batching:Re,batchingColor:Re&&rt._colorsTexture!==null,instancing:rn,instancingColor:rn&&rt.instanceColor!==null,instancingMorph:rn&&rt.morphTexture!==null,supportsVertexTextures:M,outputColorSpace:De===null?t.outputColorSpace:De.isXRRenderTarget===!0?De.texture.colorSpace:H_,alphaToCoverage:!!fe.alphaToCoverage,map:Kt,matcap:bt,envMap:Dt,envMapMode:Dt&&ft.mapping,envMapCubeUVHeight:Me,aoMap:_e,lightMap:At,bumpMap:Ot,normalMap:tn,displacementMap:M&&xe,emissiveMap:Se,normalMapObjectSpace:tn&&fe.normalMapType===lY,normalMapTangentSpace:tn&&fe.normalMapType===bv,metalnessMap:it,roughnessMap:Le,anisotropy:Pe,anisotropyMap:Bn,clearcoat:vt,clearcoatMap:Zn,clearcoatNormalMap:Li,clearcoatRoughnessMap:zn,dispersion:yt,iridescence:nn,iridescenceMap:oi,iridescenceThicknessMap:gi,sheen:jt,sheenColorMap:Ti,sheenRoughnessMap:pi,specularMap:Ji,specularColorMap:er,specularIntensityMap:vi,transmission:Fn,transmissionMap:Wt,thicknessMap:ui,gradientMap:vn,opaque:fe.transparent===!1&&fe.blending===a_&&fe.alphaToCoverage===!1,alphaMap:Ln,alphaTest:mi,alphaHash:hi,combine:fe.combine,mapUv:Kt&&z(fe.map.channel),aoMapUv:_e&&z(fe.aoMap.channel),lightMapUv:At&&z(fe.lightMap.channel),bumpMapUv:Ot&&z(fe.bumpMap.channel),normalMapUv:tn&&z(fe.normalMap.channel),displacementMapUv:xe&&z(fe.displacementMap.channel),emissiveMapUv:Se&&z(fe.emissiveMap.channel),metalnessMapUv:it&&z(fe.metalnessMap.channel),roughnessMapUv:Le&&z(fe.roughnessMap.channel),anisotropyMapUv:Bn&&z(fe.anisotropyMap.channel),clearcoatMapUv:Zn&&z(fe.clearcoatMap.channel),clearcoatNormalMapUv:Li&&z(fe.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:zn&&z(fe.clearcoatRoughnessMap.channel),iridescenceMapUv:oi&&z(fe.iridescenceMap.channel),iridescenceThicknessMapUv:gi&&z(fe.iridescenceThicknessMap.channel),sheenColorMapUv:Ti&&z(fe.sheenColorMap.channel),sheenRoughnessMapUv:pi&&z(fe.sheenRoughnessMap.channel),specularMapUv:Ji&&z(fe.specularMap.channel),specularColorMapUv:er&&z(fe.specularColorMap.channel),specularIntensityMapUv:vi&&z(fe.specularIntensityMap.channel),transmissionMapUv:Wt&&z(fe.transmissionMap.channel),thicknessMapUv:ui&&z(fe.thicknessMap.channel),alphaMapUv:Ln&&z(fe.alphaMap.channel),vertexTangents:!!Ye.attributes.tangent&&(tn||Pe),vertexColors:fe.vertexColors,vertexAlphas:fe.vertexColors===!0&&!!Ye.attributes.color&&Ye.attributes.color.itemSize===4,pointsUvs:rt.isPoints===!0&&!!Ye.attributes.uv&&(Kt||Ln),fog:!!tt,useFog:fe.fog===!0,fogExp2:!!tt&&tt.isFogExp2,flatShading:fe.flatShading===!0,sizeAttenuation:fe.sizeAttenuation===!0,logarithmicDepthBuffer:C,reverseDepthBuffer:kt,skinning:rt.isSkinnedMesh===!0,morphTargets:Ye.morphAttributes.position!==void 0,morphNormals:Ye.morphAttributes.normal!==void 0,morphColors:Ye.morphAttributes.color!==void 0,morphTargetsCount:Mt,morphTextureStride:Gt,numDirLights:ue.directional.length,numPointLights:ue.point.length,numSpotLights:ue.spot.length,numSpotLightMaps:ue.spotLightMap.length,numRectAreaLights:ue.rectArea.length,numHemiLights:ue.hemi.length,numDirLightShadows:ue.directionalShadowMap.length,numPointLightShadows:ue.pointShadowMap.length,numSpotLightShadows:ue.spotShadowMap.length,numSpotLightShadowsWithMaps:ue.numSpotLightShadowsWithMaps,numLightProbes:ue.numLightProbes,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,dithering:fe.dithering,shadowMapEnabled:t.shadowMap.enabled&&Ee.length>0,shadowMapType:t.shadowMap.type,toneMapping:cs,decodeVideoTexture:Kt&&fe.map.isVideoTexture===!0&&ls.getTransfer(fe.map.colorSpace)===Ns,decodeVideoTextureEmissive:Se&&fe.emissiveMap.isVideoTexture===!0&&ls.getTransfer(fe.emissiveMap.colorSpace)===Ns,premultipliedAlpha:fe.premultipliedAlpha,doubleSided:fe.side===gf,flipSided:fe.side===Jl,useDepthPacking:fe.depthPacking>=0,depthPacking:fe.depthPacking||0,index0AttributeName:fe.index0AttributeName,extensionClipCullDistance:Xi&&fe.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Xi&&fe.extensions.multiDraw===!0||Re)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:fe.customProgramCacheKey()};return Ft.vertexUv1s=v.has(1),Ft.vertexUv2s=v.has(2),Ft.vertexUv3s=v.has(3),v.clear(),Ft}function P(fe){const ue=[];if(fe.shaderID?ue.push(fe.shaderID):(ue.push(fe.customVertexShaderID),ue.push(fe.customFragmentShaderID)),fe.defines!==void 0)for(const Ee in fe.defines)ue.push(Ee),ue.push(fe.defines[Ee]);return fe.isRawShaderMaterial===!1&&(H(ue,fe),j(ue,fe),ue.push(t.outputColorSpace)),ue.push(fe.customProgramCacheKey),ue.join()}function H(fe,ue){fe.push(ue.precision),fe.push(ue.outputColorSpace),fe.push(ue.envMapMode),fe.push(ue.envMapCubeUVHeight),fe.push(ue.mapUv),fe.push(ue.alphaMapUv),fe.push(ue.lightMapUv),fe.push(ue.aoMapUv),fe.push(ue.bumpMapUv),fe.push(ue.normalMapUv),fe.push(ue.displacementMapUv),fe.push(ue.emissiveMapUv),fe.push(ue.metalnessMapUv),fe.push(ue.roughnessMapUv),fe.push(ue.anisotropyMapUv),fe.push(ue.clearcoatMapUv),fe.push(ue.clearcoatNormalMapUv),fe.push(ue.clearcoatRoughnessMapUv),fe.push(ue.iridescenceMapUv),fe.push(ue.iridescenceThicknessMapUv),fe.push(ue.sheenColorMapUv),fe.push(ue.sheenRoughnessMapUv),fe.push(ue.specularMapUv),fe.push(ue.specularColorMapUv),fe.push(ue.specularIntensityMapUv),fe.push(ue.transmissionMapUv),fe.push(ue.thicknessMapUv),fe.push(ue.combine),fe.push(ue.fogExp2),fe.push(ue.sizeAttenuation),fe.push(ue.morphTargetsCount),fe.push(ue.morphAttributeCount),fe.push(ue.numDirLights),fe.push(ue.numPointLights),fe.push(ue.numSpotLights),fe.push(ue.numSpotLightMaps),fe.push(ue.numHemiLights),fe.push(ue.numRectAreaLights),fe.push(ue.numDirLightShadows),fe.push(ue.numPointLightShadows),fe.push(ue.numSpotLightShadows),fe.push(ue.numSpotLightShadowsWithMaps),fe.push(ue.numLightProbes),fe.push(ue.shadowMapType),fe.push(ue.toneMapping),fe.push(ue.numClippingPlanes),fe.push(ue.numClipIntersection),fe.push(ue.depthPacking)}function j(fe,ue){s.disableAll(),ue.supportsVertexTextures&&s.enable(0),ue.instancing&&s.enable(1),ue.instancingColor&&s.enable(2),ue.instancingMorph&&s.enable(3),ue.matcap&&s.enable(4),ue.envMap&&s.enable(5),ue.normalMapObjectSpace&&s.enable(6),ue.normalMapTangentSpace&&s.enable(7),ue.clearcoat&&s.enable(8),ue.iridescence&&s.enable(9),ue.alphaTest&&s.enable(10),ue.vertexColors&&s.enable(11),ue.vertexAlphas&&s.enable(12),ue.vertexUv1s&&s.enable(13),ue.vertexUv2s&&s.enable(14),ue.vertexUv3s&&s.enable(15),ue.vertexTangents&&s.enable(16),ue.anisotropy&&s.enable(17),ue.alphaHash&&s.enable(18),ue.batching&&s.enable(19),ue.dispersion&&s.enable(20),ue.batchingColor&&s.enable(21),fe.push(s.mask),s.disableAll(),ue.fog&&s.enable(0),ue.useFog&&s.enable(1),ue.flatShading&&s.enable(2),ue.logarithmicDepthBuffer&&s.enable(3),ue.reverseDepthBuffer&&s.enable(4),ue.skinning&&s.enable(5),ue.morphTargets&&s.enable(6),ue.morphNormals&&s.enable(7),ue.morphColors&&s.enable(8),ue.premultipliedAlpha&&s.enable(9),ue.shadowMapEnabled&&s.enable(10),ue.doubleSided&&s.enable(11),ue.flipSided&&s.enable(12),ue.useDepthPacking&&s.enable(13),ue.dithering&&s.enable(14),ue.transmission&&s.enable(15),ue.sheen&&s.enable(16),ue.opaque&&s.enable(17),ue.pointsUvs&&s.enable(18),ue.decodeVideoTexture&&s.enable(19),ue.decodeVideoTextureEmissive&&s.enable(20),ue.alphaToCoverage&&s.enable(21),fe.push(s.mask)}function q(fe){const ue=N[fe.type];let Ee;if(ue){const We=ed[ue];Ee=CY.clone(We.uniforms)}else Ee=fe.uniforms;return Ee}function le(fe,ue){let Ee;for(let We=0,rt=w.length;We<rt;We++){const tt=w[We];if(tt.cacheKey===ue){Ee=tt,++Ee.usedTimes;break}}return Ee===void 0&&(Ee=new DIe(t,ue,fe,o),w.push(Ee)),Ee}function ce(fe){if(--fe.usedTimes===0){const ue=w.indexOf(fe);w[ue]=w[w.length-1],w.pop(),fe.destroy()}}function ae(fe){f.remove(fe)}function pe(){f.dispose()}return{getParameters:L,getProgramCacheKey:P,getUniforms:q,acquireProgram:le,releaseProgram:ce,releaseShaderCache:ae,programs:w,dispose:pe}}function NIe(){let t=new WeakMap;function e(c){return t.has(c)}function n(c){let s=t.get(c);return s===void 0&&(s={},t.set(c,s)),s}function i(c){t.delete(c)}function r(c,s,f){t.get(c)[s]=f}function o(){t=new WeakMap}return{has:e,get:n,remove:i,update:r,dispose:o}}function BIe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function H6(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function W6(){const t=[];let e=0;const n=[],i=[],r=[];function o(){e=0,n.length=0,i.length=0,r.length=0}function c(C,M,F,N,z,L){let P=t[e];return P===void 0?(P={id:C.id,object:C,geometry:M,material:F,groupOrder:N,renderOrder:C.renderOrder,z,group:L},t[e]=P):(P.id=C.id,P.object=C,P.geometry=M,P.material=F,P.groupOrder=N,P.renderOrder=C.renderOrder,P.z=z,P.group=L),e++,P}function s(C,M,F,N,z,L){const P=c(C,M,F,N,z,L);F.transmission>0?i.push(P):F.transparent===!0?r.push(P):n.push(P)}function f(C,M,F,N,z,L){const P=c(C,M,F,N,z,L);F.transmission>0?i.unshift(P):F.transparent===!0?r.unshift(P):n.unshift(P)}function v(C,M){n.length>1&&n.sort(C||BIe),i.length>1&&i.sort(M||H6),r.length>1&&r.sort(M||H6)}function w(){for(let C=e,M=t.length;C<M;C++){const F=t[C];if(F.id===null)break;F.id=null,F.object=null,F.geometry=null,F.material=null,F.group=null}}return{opaque:n,transmissive:i,transparent:r,init:o,push:s,unshift:f,finish:w,sort:v}}function zIe(){let t=new WeakMap;function e(i,r){const o=t.get(i);let c;return o===void 0?(c=new W6,t.set(i,[c])):r>=o.length?(c=new W6,o.push(c)):c=o[r],c}function n(){t=new WeakMap}return{get:e,dispose:n}}function UIe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new gt,color:new bi};break;case"SpotLight":n={position:new gt,direction:new gt,color:new bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new gt,color:new bi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new gt,skyColor:new bi,groundColor:new bi};break;case"RectAreaLight":n={color:new bi,position:new gt,halfWidth:new gt,halfHeight:new gt};break}return t[e.id]=n,n}}}function VIe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cn};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let GIe=0;function HIe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function WIe(t){const e=new UIe,n=VIe(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let v=0;v<9;v++)i.probe.push(new gt);const r=new gt,o=new Hi,c=new Hi;function s(v){let w=0,C=0,M=0;for(let fe=0;fe<9;fe++)i.probe[fe].set(0,0,0);let F=0,N=0,z=0,L=0,P=0,H=0,j=0,q=0,le=0,ce=0,ae=0;v.sort(HIe);for(let fe=0,ue=v.length;fe<ue;fe++){const Ee=v[fe],We=Ee.color,rt=Ee.intensity,tt=Ee.distance,Ye=Ee.shadow&&Ee.shadow.map?Ee.shadow.map.texture:null;if(Ee.isAmbientLight)w+=We.r*rt,C+=We.g*rt,M+=We.b*rt;else if(Ee.isLightProbe){for(let qe=0;qe<9;qe++)i.probe[qe].addScaledVector(Ee.sh.coefficients[qe],rt);ae++}else if(Ee.isDirectionalLight){const qe=e.get(Ee);if(qe.color.copy(Ee.color).multiplyScalar(Ee.intensity),Ee.castShadow){const ft=Ee.shadow,Me=n.get(Ee);Me.shadowIntensity=ft.intensity,Me.shadowBias=ft.bias,Me.shadowNormalBias=ft.normalBias,Me.shadowRadius=ft.radius,Me.shadowMapSize=ft.mapSize,i.directionalShadow[F]=Me,i.directionalShadowMap[F]=Ye,i.directionalShadowMatrix[F]=Ee.shadow.matrix,H++}i.directional[F]=qe,F++}else if(Ee.isSpotLight){const qe=e.get(Ee);qe.position.setFromMatrixPosition(Ee.matrixWorld),qe.color.copy(We).multiplyScalar(rt),qe.distance=tt,qe.coneCos=Math.cos(Ee.angle),qe.penumbraCos=Math.cos(Ee.angle*(1-Ee.penumbra)),qe.decay=Ee.decay,i.spot[z]=qe;const ft=Ee.shadow;if(Ee.map&&(i.spotLightMap[le]=Ee.map,le++,ft.updateMatrices(Ee),Ee.castShadow&&ce++),i.spotLightMatrix[z]=ft.matrix,Ee.castShadow){const Me=n.get(Ee);Me.shadowIntensity=ft.intensity,Me.shadowBias=ft.bias,Me.shadowNormalBias=ft.normalBias,Me.shadowRadius=ft.radius,Me.shadowMapSize=ft.mapSize,i.spotShadow[z]=Me,i.spotShadowMap[z]=Ye,q++}z++}else if(Ee.isRectAreaLight){const qe=e.get(Ee);qe.color.copy(We).multiplyScalar(rt),qe.halfWidth.set(Ee.width*.5,0,0),qe.halfHeight.set(0,Ee.height*.5,0),i.rectArea[L]=qe,L++}else if(Ee.isPointLight){const qe=e.get(Ee);if(qe.color.copy(Ee.color).multiplyScalar(Ee.intensity),qe.distance=Ee.distance,qe.decay=Ee.decay,Ee.castShadow){const ft=Ee.shadow,Me=n.get(Ee);Me.shadowIntensity=ft.intensity,Me.shadowBias=ft.bias,Me.shadowNormalBias=ft.normalBias,Me.shadowRadius=ft.radius,Me.shadowMapSize=ft.mapSize,Me.shadowCameraNear=ft.camera.near,Me.shadowCameraFar=ft.camera.far,i.pointShadow[N]=Me,i.pointShadowMap[N]=Ye,i.pointShadowMatrix[N]=Ee.shadow.matrix,j++}i.point[N]=qe,N++}else if(Ee.isHemisphereLight){const qe=e.get(Ee);qe.skyColor.copy(Ee.color).multiplyScalar(rt),qe.groundColor.copy(Ee.groundColor).multiplyScalar(rt),i.hemi[P]=qe,P++}}L>0&&(t.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=wi.LTC_FLOAT_1,i.rectAreaLTC2=wi.LTC_FLOAT_2):(i.rectAreaLTC1=wi.LTC_HALF_1,i.rectAreaLTC2=wi.LTC_HALF_2)),i.ambient[0]=w,i.ambient[1]=C,i.ambient[2]=M;const pe=i.hash;(pe.directionalLength!==F||pe.pointLength!==N||pe.spotLength!==z||pe.rectAreaLength!==L||pe.hemiLength!==P||pe.numDirectionalShadows!==H||pe.numPointShadows!==j||pe.numSpotShadows!==q||pe.numSpotMaps!==le||pe.numLightProbes!==ae)&&(i.directional.length=F,i.spot.length=z,i.rectArea.length=L,i.point.length=N,i.hemi.length=P,i.directionalShadow.length=H,i.directionalShadowMap.length=H,i.pointShadow.length=j,i.pointShadowMap.length=j,i.spotShadow.length=q,i.spotShadowMap.length=q,i.directionalShadowMatrix.length=H,i.pointShadowMatrix.length=j,i.spotLightMatrix.length=q+le-ce,i.spotLightMap.length=le,i.numSpotLightShadowsWithMaps=ce,i.numLightProbes=ae,pe.directionalLength=F,pe.pointLength=N,pe.spotLength=z,pe.rectAreaLength=L,pe.hemiLength=P,pe.numDirectionalShadows=H,pe.numPointShadows=j,pe.numSpotShadows=q,pe.numSpotMaps=le,pe.numLightProbes=ae,i.version=GIe++)}function f(v,w){let C=0,M=0,F=0,N=0,z=0;const L=w.matrixWorldInverse;for(let P=0,H=v.length;P<H;P++){const j=v[P];if(j.isDirectionalLight){const q=i.directional[C];q.direction.setFromMatrixPosition(j.matrixWorld),r.setFromMatrixPosition(j.target.matrixWorld),q.direction.sub(r),q.direction.transformDirection(L),C++}else if(j.isSpotLight){const q=i.spot[F];q.position.setFromMatrixPosition(j.matrixWorld),q.position.applyMatrix4(L),q.direction.setFromMatrixPosition(j.matrixWorld),r.setFromMatrixPosition(j.target.matrixWorld),q.direction.sub(r),q.direction.transformDirection(L),F++}else if(j.isRectAreaLight){const q=i.rectArea[N];q.position.setFromMatrixPosition(j.matrixWorld),q.position.applyMatrix4(L),c.identity(),o.copy(j.matrixWorld),o.premultiply(L),c.extractRotation(o),q.halfWidth.set(j.width*.5,0,0),q.halfHeight.set(0,j.height*.5,0),q.halfWidth.applyMatrix4(c),q.halfHeight.applyMatrix4(c),N++}else if(j.isPointLight){const q=i.point[M];q.position.setFromMatrixPosition(j.matrixWorld),q.position.applyMatrix4(L),M++}else if(j.isHemisphereLight){const q=i.hemi[z];q.direction.setFromMatrixPosition(j.matrixWorld),q.direction.transformDirection(L),z++}}}return{setup:s,setupView:f,state:i}}function j6(t){const e=new WIe(t),n=[],i=[];function r(w){v.camera=w,n.length=0,i.length=0}function o(w){n.push(w)}function c(w){i.push(w)}function s(){e.setup(n)}function f(w){e.setupView(n,w)}const v={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:v,setupLights:s,setupLightsView:f,pushLight:o,pushShadow:c}}function jIe(t){let e=new WeakMap;function n(r,o=0){const c=e.get(r);let s;return c===void 0?(s=new j6(t),e.set(r,[s])):o>=c.length?(s=new j6(t),c.push(s)):s=c[o],s}function i(){e=new WeakMap}return{get:n,dispose:i}}class UB extends nl{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=oY,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class VB extends nl{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const $Ie=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,qIe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ZIe(t,e,n){let i=new ub;const r=new Cn,o=new Cn,c=new xs,s=new UB({depthPacking:aY}),f=new VB,v={},w=n.maxTextureSize,C={[im]:Jl,[Jl]:im,[gf]:gf},M=new ih({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Cn},radius:{value:4}},vertexShader:$Ie,fragmentShader:qIe}),F=M.clone();F.defines.HORIZONTAL_PASS=1;const N=new Cr;N.setAttribute("position",new ns(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const z=new va(N,M),L=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=WA;let P=this.type;this.render=function(ce,ae,pe){if(L.enabled===!1||L.autoUpdate===!1&&L.needsUpdate===!1||ce.length===0)return;const fe=t.getRenderTarget(),ue=t.getActiveCubeFace(),Ee=t.getActiveMipmapLevel(),We=t.state;We.setBlending(Wp),We.buffers.color.setClear(1,1,1,1),We.buffers.depth.setTest(!0),We.setScissorTest(!1);const rt=P!==qh&&this.type===qh,tt=P===qh&&this.type!==qh;for(let Ye=0,qe=ce.length;Ye<qe;Ye++){const ft=ce[Ye],Me=ft.shadow;if(Me===void 0){console.warn("THREE.WebGLShadowMap:",ft,"has no shadow.");continue}if(Me.autoUpdate===!1&&Me.needsUpdate===!1)continue;r.copy(Me.mapSize);const $e=Me.getFrameExtents();if(r.multiply($e),o.copy(Me.mapSize),(r.x>w||r.y>w)&&(r.x>w&&(o.x=Math.floor(w/$e.x),r.x=o.x*$e.x,Me.mapSize.x=o.x),r.y>w&&(o.y=Math.floor(w/$e.y),r.y=o.y*$e.y,Me.mapSize.y=o.y)),Me.map===null||rt===!0||tt===!0){const Mt=this.type!==qh?{minFilter:el,magFilter:el}:{};Me.map!==null&&Me.map.dispose(),Me.map=new fd(r.x,r.y,Mt),Me.map.texture.name=ft.name+".shadowMap",Me.camera.updateProjectionMatrix()}t.setRenderTarget(Me.map),t.clear();const ut=Me.getViewportCount();for(let Mt=0;Mt<ut;Mt++){const Gt=Me.getViewport(Mt);c.set(o.x*Gt.x,o.y*Gt.y,o.x*Gt.z,o.y*Gt.w),We.viewport(c),Me.updateMatrices(ft,Mt),i=Me.getFrustum(),q(ae,pe,Me.camera,ft,this.type)}Me.isPointLightShadow!==!0&&this.type===qh&&H(Me,pe),Me.needsUpdate=!1}P=this.type,L.needsUpdate=!1,t.setRenderTarget(fe,ue,Ee)};function H(ce,ae){const pe=e.update(z);M.defines.VSM_SAMPLES!==ce.blurSamples&&(M.defines.VSM_SAMPLES=ce.blurSamples,F.defines.VSM_SAMPLES=ce.blurSamples,M.needsUpdate=!0,F.needsUpdate=!0),ce.mapPass===null&&(ce.mapPass=new fd(r.x,r.y)),M.uniforms.shadow_pass.value=ce.map.texture,M.uniforms.resolution.value=ce.mapSize,M.uniforms.radius.value=ce.radius,t.setRenderTarget(ce.mapPass),t.clear(),t.renderBufferDirect(ae,null,pe,M,z,null),F.uniforms.shadow_pass.value=ce.mapPass.texture,F.uniforms.resolution.value=ce.mapSize,F.uniforms.radius.value=ce.radius,t.setRenderTarget(ce.map),t.clear(),t.renderBufferDirect(ae,null,pe,F,z,null)}function j(ce,ae,pe,fe){let ue=null;const Ee=pe.isPointLight===!0?ce.customDistanceMaterial:ce.customDepthMaterial;if(Ee!==void 0)ue=Ee;else if(ue=pe.isPointLight===!0?f:s,t.localClippingEnabled&&ae.clipShadows===!0&&Array.isArray(ae.clippingPlanes)&&ae.clippingPlanes.length!==0||ae.displacementMap&&ae.displacementScale!==0||ae.alphaMap&&ae.alphaTest>0||ae.map&&ae.alphaTest>0){const We=ue.uuid,rt=ae.uuid;let tt=v[We];tt===void 0&&(tt={},v[We]=tt);let Ye=tt[rt];Ye===void 0&&(Ye=ue.clone(),tt[rt]=Ye,ae.addEventListener("dispose",le)),ue=Ye}if(ue.visible=ae.visible,ue.wireframe=ae.wireframe,fe===qh?ue.side=ae.shadowSide!==null?ae.shadowSide:ae.side:ue.side=ae.shadowSide!==null?ae.shadowSide:C[ae.side],ue.alphaMap=ae.alphaMap,ue.alphaTest=ae.alphaTest,ue.map=ae.map,ue.clipShadows=ae.clipShadows,ue.clippingPlanes=ae.clippingPlanes,ue.clipIntersection=ae.clipIntersection,ue.displacementMap=ae.displacementMap,ue.displacementScale=ae.displacementScale,ue.displacementBias=ae.displacementBias,ue.wireframeLinewidth=ae.wireframeLinewidth,ue.linewidth=ae.linewidth,pe.isPointLight===!0&&ue.isMeshDistanceMaterial===!0){const We=t.properties.get(ue);We.light=pe}return ue}function q(ce,ae,pe,fe,ue){if(ce.visible===!1)return;if(ce.layers.test(ae.layers)&&(ce.isMesh||ce.isLine||ce.isPoints)&&(ce.castShadow||ce.receiveShadow&&ue===qh)&&(!ce.frustumCulled||i.intersectsObject(ce))){ce.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,ce.matrixWorld);const rt=e.update(ce),tt=ce.material;if(Array.isArray(tt)){const Ye=rt.groups;for(let qe=0,ft=Ye.length;qe<ft;qe++){const Me=Ye[qe],$e=tt[Me.materialIndex];if($e&&$e.visible){const ut=j(ce,$e,fe,ue);ce.onBeforeShadow(t,ce,ae,pe,rt,ut,Me),t.renderBufferDirect(pe,null,rt,ut,ce,Me),ce.onAfterShadow(t,ce,ae,pe,rt,ut,Me)}}}else if(tt.visible){const Ye=j(ce,tt,fe,ue);ce.onBeforeShadow(t,ce,ae,pe,rt,Ye,null),t.renderBufferDirect(pe,null,rt,Ye,ce,null),ce.onAfterShadow(t,ce,ae,pe,rt,Ye,null)}}const We=ce.children;for(let rt=0,tt=We.length;rt<tt;rt++)q(We[rt],ae,pe,fe,ue)}function le(ce){ce.target.removeEventListener("dispose",le);for(const pe in v){const fe=v[pe],ue=ce.target.uuid;ue in fe&&(fe[ue].dispose(),delete fe[ue])}}}const XIe={[CT]:ST,[bT]:RT,[ET]:TT,[E_]:MT,[ST]:CT,[RT]:bT,[TT]:ET,[MT]:E_};function KIe(t,e){function n(){let Wt=!1;const ui=new xs;let vn=null;const Ln=new xs(0,0,0,0);return{setMask:function(mi){vn!==mi&&!Wt&&(t.colorMask(mi,mi,mi,mi),vn=mi)},setLocked:function(mi){Wt=mi},setClear:function(mi,hi,Xi,cs,Ft){Ft===!0&&(mi*=cs,hi*=cs,Xi*=cs),ui.set(mi,hi,Xi,cs),Ln.equals(ui)===!1&&(t.clearColor(mi,hi,Xi,cs),Ln.copy(ui))},reset:function(){Wt=!1,vn=null,Ln.set(-1,0,0,0)}}}function i(){let Wt=!1,ui=!1,vn=null,Ln=null,mi=null;return{setReversed:function(hi){if(ui!==hi){const Xi=e.get("EXT_clip_control");ui?Xi.clipControlEXT(Xi.LOWER_LEFT_EXT,Xi.ZERO_TO_ONE_EXT):Xi.clipControlEXT(Xi.LOWER_LEFT_EXT,Xi.NEGATIVE_ONE_TO_ONE_EXT);const cs=mi;mi=null,this.setClear(cs)}ui=hi},getReversed:function(){return ui},setTest:function(hi){hi?De(t.DEPTH_TEST):kt(t.DEPTH_TEST)},setMask:function(hi){vn!==hi&&!Wt&&(t.depthMask(hi),vn=hi)},setFunc:function(hi){if(ui&&(hi=XIe[hi]),Ln!==hi){switch(hi){case CT:t.depthFunc(t.NEVER);break;case ST:t.depthFunc(t.ALWAYS);break;case bT:t.depthFunc(t.LESS);break;case E_:t.depthFunc(t.LEQUAL);break;case ET:t.depthFunc(t.EQUAL);break;case MT:t.depthFunc(t.GEQUAL);break;case RT:t.depthFunc(t.GREATER);break;case TT:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Ln=hi}},setLocked:function(hi){Wt=hi},setClear:function(hi){mi!==hi&&(ui&&(hi=1-hi),t.clearDepth(hi),mi=hi)},reset:function(){Wt=!1,vn=null,Ln=null,mi=null,ui=!1}}}function r(){let Wt=!1,ui=null,vn=null,Ln=null,mi=null,hi=null,Xi=null,cs=null,Ft=null;return{setTest:function(we){Wt||(we?De(t.STENCIL_TEST):kt(t.STENCIL_TEST))},setMask:function(we){ui!==we&&!Wt&&(t.stencilMask(we),ui=we)},setFunc:function(we,Ie,je){(vn!==we||Ln!==Ie||mi!==je)&&(t.stencilFunc(we,Ie,je),vn=we,Ln=Ie,mi=je)},setOp:function(we,Ie,je){(hi!==we||Xi!==Ie||cs!==je)&&(t.stencilOp(we,Ie,je),hi=we,Xi=Ie,cs=je)},setLocked:function(we){Wt=we},setClear:function(we){Ft!==we&&(t.clearStencil(we),Ft=we)},reset:function(){Wt=!1,ui=null,vn=null,Ln=null,mi=null,hi=null,Xi=null,cs=null,Ft=null}}}const o=new n,c=new i,s=new r,f=new WeakMap,v=new WeakMap;let w={},C={},M=new WeakMap,F=[],N=null,z=!1,L=null,P=null,H=null,j=null,q=null,le=null,ce=null,ae=new bi(0,0,0),pe=0,fe=!1,ue=null,Ee=null,We=null,rt=null,tt=null;const Ye=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let qe=!1,ft=0;const Me=t.getParameter(t.VERSION);Me.indexOf("WebGL")!==-1?(ft=parseFloat(/^WebGL (\d)/.exec(Me)[1]),qe=ft>=1):Me.indexOf("OpenGL ES")!==-1&&(ft=parseFloat(/^OpenGL ES (\d)/.exec(Me)[1]),qe=ft>=2);let $e=null,ut={};const Mt=t.getParameter(t.SCISSOR_BOX),Gt=t.getParameter(t.VIEWPORT),Xt=new xs().fromArray(Mt),Qe=new xs().fromArray(Gt);function Ge(Wt,ui,vn,Ln){const mi=new Uint8Array(4),hi=t.createTexture();t.bindTexture(Wt,hi),t.texParameteri(Wt,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Wt,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Xi=0;Xi<vn;Xi++)Wt===t.TEXTURE_3D||Wt===t.TEXTURE_2D_ARRAY?t.texImage3D(ui,0,t.RGBA,1,1,Ln,0,t.RGBA,t.UNSIGNED_BYTE,mi):t.texImage2D(ui+Xi,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,mi);return hi}const He={};He[t.TEXTURE_2D]=Ge(t.TEXTURE_2D,t.TEXTURE_2D,1),He[t.TEXTURE_CUBE_MAP]=Ge(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),He[t.TEXTURE_2D_ARRAY]=Ge(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),He[t.TEXTURE_3D]=Ge(t.TEXTURE_3D,t.TEXTURE_3D,1,1),o.setClear(0,0,0,1),c.setClear(1),s.setClear(0),De(t.DEPTH_TEST),c.setFunc(E_),Ot(!1),tn(kk),De(t.CULL_FACE),_e(Wp);function De(Wt){w[Wt]!==!0&&(t.enable(Wt),w[Wt]=!0)}function kt(Wt){w[Wt]!==!1&&(t.disable(Wt),w[Wt]=!1)}function rn(Wt,ui){return C[Wt]!==ui?(t.bindFramebuffer(Wt,ui),C[Wt]=ui,Wt===t.DRAW_FRAMEBUFFER&&(C[t.FRAMEBUFFER]=ui),Wt===t.FRAMEBUFFER&&(C[t.DRAW_FRAMEBUFFER]=ui),!0):!1}function Re(Wt,ui){let vn=F,Ln=!1;if(Wt){vn=M.get(ui),vn===void 0&&(vn=[],M.set(ui,vn));const mi=Wt.textures;if(vn.length!==mi.length||vn[0]!==t.COLOR_ATTACHMENT0){for(let hi=0,Xi=mi.length;hi<Xi;hi++)vn[hi]=t.COLOR_ATTACHMENT0+hi;vn.length=mi.length,Ln=!0}}else vn[0]!==t.BACK&&(vn[0]=t.BACK,Ln=!0);Ln&&t.drawBuffers(vn)}function Kt(Wt){return N!==Wt?(t.useProgram(Wt),N=Wt,!0):!1}const bt={[Ig]:t.FUNC_ADD,[IK]:t.FUNC_SUBTRACT,[DK]:t.FUNC_REVERSE_SUBTRACT};bt[FK]=t.MIN,bt[LK]=t.MAX;const Dt={[OK]:t.ZERO,[kK]:t.ONE,[NK]:t.SRC_COLOR,[xT]:t.SRC_ALPHA,[HK]:t.SRC_ALPHA_SATURATE,[VK]:t.DST_COLOR,[zK]:t.DST_ALPHA,[BK]:t.ONE_MINUS_SRC_COLOR,[wT]:t.ONE_MINUS_SRC_ALPHA,[GK]:t.ONE_MINUS_DST_COLOR,[UK]:t.ONE_MINUS_DST_ALPHA,[WK]:t.CONSTANT_COLOR,[jK]:t.ONE_MINUS_CONSTANT_COLOR,[$K]:t.CONSTANT_ALPHA,[qK]:t.ONE_MINUS_CONSTANT_ALPHA};function _e(Wt,ui,vn,Ln,mi,hi,Xi,cs,Ft,we){if(Wt===Wp){z===!0&&(kt(t.BLEND),z=!1);return}if(z===!1&&(De(t.BLEND),z=!0),Wt!==PK){if(Wt!==L||we!==fe){if((P!==Ig||q!==Ig)&&(t.blendEquation(t.FUNC_ADD),P=Ig,q=Ig),we)switch(Wt){case a_:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Nk:t.blendFunc(t.ONE,t.ONE);break;case Bk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case zk:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Wt);break}else switch(Wt){case a_:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Nk:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case Bk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case zk:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Wt);break}H=null,j=null,le=null,ce=null,ae.set(0,0,0),pe=0,L=Wt,fe=we}return}mi=mi||ui,hi=hi||vn,Xi=Xi||Ln,(ui!==P||mi!==q)&&(t.blendEquationSeparate(bt[ui],bt[mi]),P=ui,q=mi),(vn!==H||Ln!==j||hi!==le||Xi!==ce)&&(t.blendFuncSeparate(Dt[vn],Dt[Ln],Dt[hi],Dt[Xi]),H=vn,j=Ln,le=hi,ce=Xi),(cs.equals(ae)===!1||Ft!==pe)&&(t.blendColor(cs.r,cs.g,cs.b,Ft),ae.copy(cs),pe=Ft),L=Wt,fe=!1}function At(Wt,ui){Wt.side===gf?kt(t.CULL_FACE):De(t.CULL_FACE);let vn=Wt.side===Jl;ui&&(vn=!vn),Ot(vn),Wt.blending===a_&&Wt.transparent===!1?_e(Wp):_e(Wt.blending,Wt.blendEquation,Wt.blendSrc,Wt.blendDst,Wt.blendEquationAlpha,Wt.blendSrcAlpha,Wt.blendDstAlpha,Wt.blendColor,Wt.blendAlpha,Wt.premultipliedAlpha),c.setFunc(Wt.depthFunc),c.setTest(Wt.depthTest),c.setMask(Wt.depthWrite),o.setMask(Wt.colorWrite);const Ln=Wt.stencilWrite;s.setTest(Ln),Ln&&(s.setMask(Wt.stencilWriteMask),s.setFunc(Wt.stencilFunc,Wt.stencilRef,Wt.stencilFuncMask),s.setOp(Wt.stencilFail,Wt.stencilZFail,Wt.stencilZPass)),Se(Wt.polygonOffset,Wt.polygonOffsetFactor,Wt.polygonOffsetUnits),Wt.alphaToCoverage===!0?De(t.SAMPLE_ALPHA_TO_COVERAGE):kt(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ot(Wt){ue!==Wt&&(Wt?t.frontFace(t.CW):t.frontFace(t.CCW),ue=Wt)}function tn(Wt){Wt!==RK?(De(t.CULL_FACE),Wt!==Ee&&(Wt===kk?t.cullFace(t.BACK):Wt===TK?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):kt(t.CULL_FACE),Ee=Wt}function xe(Wt){Wt!==We&&(qe&&t.lineWidth(Wt),We=Wt)}function Se(Wt,ui,vn){Wt?(De(t.POLYGON_OFFSET_FILL),(rt!==ui||tt!==vn)&&(t.polygonOffset(ui,vn),rt=ui,tt=vn)):kt(t.POLYGON_OFFSET_FILL)}function it(Wt){Wt?De(t.SCISSOR_TEST):kt(t.SCISSOR_TEST)}function Le(Wt){Wt===void 0&&(Wt=t.TEXTURE0+Ye-1),$e!==Wt&&(t.activeTexture(Wt),$e=Wt)}function Pe(Wt,ui,vn){vn===void 0&&($e===null?vn=t.TEXTURE0+Ye-1:vn=$e);let Ln=ut[vn];Ln===void 0&&(Ln={type:void 0,texture:void 0},ut[vn]=Ln),(Ln.type!==Wt||Ln.texture!==ui)&&($e!==vn&&(t.activeTexture(vn),$e=vn),t.bindTexture(Wt,ui||He[Wt]),Ln.type=Wt,Ln.texture=ui)}function vt(){const Wt=ut[$e];Wt!==void 0&&Wt.type!==void 0&&(t.bindTexture(Wt.type,null),Wt.type=void 0,Wt.texture=void 0)}function yt(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function nn(){try{t.compressedTexImage3D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function jt(){try{t.texSubImage2D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function Fn(){try{t.texSubImage3D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function Bn(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function Zn(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function Li(){try{t.texStorage2D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function zn(){try{t.texStorage3D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function oi(){try{t.texImage2D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function gi(){try{t.texImage3D.apply(t,arguments)}catch(Wt){console.error("THREE.WebGLState:",Wt)}}function Ti(Wt){Xt.equals(Wt)===!1&&(t.scissor(Wt.x,Wt.y,Wt.z,Wt.w),Xt.copy(Wt))}function pi(Wt){Qe.equals(Wt)===!1&&(t.viewport(Wt.x,Wt.y,Wt.z,Wt.w),Qe.copy(Wt))}function Ji(Wt,ui){let vn=v.get(ui);vn===void 0&&(vn=new WeakMap,v.set(ui,vn));let Ln=vn.get(Wt);Ln===void 0&&(Ln=t.getUniformBlockIndex(ui,Wt.name),vn.set(Wt,Ln))}function er(Wt,ui){const Ln=v.get(ui).get(Wt);f.get(ui)!==Ln&&(t.uniformBlockBinding(ui,Ln,Wt.__bindingPointIndex),f.set(ui,Ln))}function vi(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),c.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),w={},$e=null,ut={},C={},M=new WeakMap,F=[],N=null,z=!1,L=null,P=null,H=null,j=null,q=null,le=null,ce=null,ae=new bi(0,0,0),pe=0,fe=!1,ue=null,Ee=null,We=null,rt=null,tt=null,Xt.set(0,0,t.canvas.width,t.canvas.height),Qe.set(0,0,t.canvas.width,t.canvas.height),o.reset(),c.reset(),s.reset()}return{buffers:{color:o,depth:c,stencil:s},enable:De,disable:kt,bindFramebuffer:rn,drawBuffers:Re,useProgram:Kt,setBlending:_e,setMaterial:At,setFlipSided:Ot,setCullFace:tn,setLineWidth:xe,setPolygonOffset:Se,setScissorTest:it,activeTexture:Le,bindTexture:Pe,unbindTexture:vt,compressedTexImage2D:yt,compressedTexImage3D:nn,texImage2D:oi,texImage3D:gi,updateUBOMapping:Ji,uniformBlockBinding:er,texStorage2D:Li,texStorage3D:zn,texSubImage2D:jt,texSubImage3D:Fn,compressedTexSubImage2D:Bn,compressedTexSubImage3D:Zn,scissor:Ti,viewport:pi,reset:vi}}function YIe(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function JIe(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function QIe(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function jk(t,e,n,i){const r=eDe(i);switch(n){case MB:return t*e;case TB:return t*e;case AB:return t*e*2;case XA:return t*e/r.components*r.byteLength;case ob:return t*e/r.components*r.byteLength;case PB:return t*e*2/r.components*r.byteLength;case KA:return t*e*2/r.components*r.byteLength;case RB:return t*e*3/r.components*r.byteLength;case wl:return t*e*4/r.components*r.byteLength;case YA:return t*e*4/r.components*r.byteLength;case T1:case A1:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case P1:case I1:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case PT:case DT:return Math.max(t,16)*Math.max(e,8)/4;case AT:case IT:return Math.max(t,8)*Math.max(e,8)/2;case FT:case LT:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case OT:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case kT:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case NT:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case BT:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case zT:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case UT:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case VT:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case GT:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case HT:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case WT:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case jT:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case $T:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case qT:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case ZT:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case XT:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case D1:case KT:case YT:return Math.ceil(t/4)*Math.ceil(e/4)*16;case IB:case JT:return Math.ceil(t/4)*Math.ceil(e/4)*8;case QT:case eA:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function eDe(t){switch(t){case dd:case SB:return{byteLength:1,components:1};case aw:case bB:case kw:return{byteLength:2,components:1};case qA:case ZA:return{byteLength:2,components:4};case sm:case $A:case kc:return{byteLength:4,components:1};case EB:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}const tDe={contain:YIe,cover:JIe,fill:QIe,getByteLength:jk};function nDe(t,e,n,i,r,o,c){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),v=new Cn,w=new WeakMap;let C;const M=new WeakMap;let F=!1;try{F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function N(Le,Pe){return F?new OffscreenCanvas(Le,Pe):yS("canvas")}function z(Le,Pe,vt){let yt=1;const nn=it(Le);if((nn.width>vt||nn.height>vt)&&(yt=vt/Math.max(nn.width,nn.height)),yt<1)if(typeof HTMLImageElement<"u"&&Le instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Le instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Le instanceof ImageBitmap||typeof VideoFrame<"u"&&Le instanceof VideoFrame){const jt=Math.floor(yt*nn.width),Fn=Math.floor(yt*nn.height);C===void 0&&(C=N(jt,Fn));const Bn=Pe?N(jt,Fn):C;return Bn.width=jt,Bn.height=Fn,Bn.getContext("2d").drawImage(Le,0,0,jt,Fn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+nn.width+"x"+nn.height+") to ("+jt+"x"+Fn+")."),Bn}else return"data"in Le&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+nn.width+"x"+nn.height+")."),Le;return Le}function L(Le){return Le.generateMipmaps}function P(Le){t.generateMipmap(Le)}function H(Le){return Le.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:Le.isWebGL3DRenderTarget?t.TEXTURE_3D:Le.isWebGLArrayRenderTarget||Le.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function j(Le,Pe,vt,yt,nn=!1){if(Le!==null){if(t[Le]!==void 0)return t[Le];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Le+"'")}let jt=Pe;if(Pe===t.RED&&(vt===t.FLOAT&&(jt=t.R32F),vt===t.HALF_FLOAT&&(jt=t.R16F),vt===t.UNSIGNED_BYTE&&(jt=t.R8)),Pe===t.RED_INTEGER&&(vt===t.UNSIGNED_BYTE&&(jt=t.R8UI),vt===t.UNSIGNED_SHORT&&(jt=t.R16UI),vt===t.UNSIGNED_INT&&(jt=t.R32UI),vt===t.BYTE&&(jt=t.R8I),vt===t.SHORT&&(jt=t.R16I),vt===t.INT&&(jt=t.R32I)),Pe===t.RG&&(vt===t.FLOAT&&(jt=t.RG32F),vt===t.HALF_FLOAT&&(jt=t.RG16F),vt===t.UNSIGNED_BYTE&&(jt=t.RG8)),Pe===t.RG_INTEGER&&(vt===t.UNSIGNED_BYTE&&(jt=t.RG8UI),vt===t.UNSIGNED_SHORT&&(jt=t.RG16UI),vt===t.UNSIGNED_INT&&(jt=t.RG32UI),vt===t.BYTE&&(jt=t.RG8I),vt===t.SHORT&&(jt=t.RG16I),vt===t.INT&&(jt=t.RG32I)),Pe===t.RGB_INTEGER&&(vt===t.UNSIGNED_BYTE&&(jt=t.RGB8UI),vt===t.UNSIGNED_SHORT&&(jt=t.RGB16UI),vt===t.UNSIGNED_INT&&(jt=t.RGB32UI),vt===t.BYTE&&(jt=t.RGB8I),vt===t.SHORT&&(jt=t.RGB16I),vt===t.INT&&(jt=t.RGB32I)),Pe===t.RGBA_INTEGER&&(vt===t.UNSIGNED_BYTE&&(jt=t.RGBA8UI),vt===t.UNSIGNED_SHORT&&(jt=t.RGBA16UI),vt===t.UNSIGNED_INT&&(jt=t.RGBA32UI),vt===t.BYTE&&(jt=t.RGBA8I),vt===t.SHORT&&(jt=t.RGBA16I),vt===t.INT&&(jt=t.RGBA32I)),Pe===t.RGB&&vt===t.UNSIGNED_INT_5_9_9_9_REV&&(jt=t.RGB9_E5),Pe===t.RGBA){const Fn=nn?ab:ls.getTransfer(yt);vt===t.FLOAT&&(jt=t.RGBA32F),vt===t.HALF_FLOAT&&(jt=t.RGBA16F),vt===t.UNSIGNED_BYTE&&(jt=Fn===Ns?t.SRGB8_ALPHA8:t.RGBA8),vt===t.UNSIGNED_SHORT_4_4_4_4&&(jt=t.RGBA4),vt===t.UNSIGNED_SHORT_5_5_5_1&&(jt=t.RGB5_A1)}return(jt===t.R16F||jt===t.R32F||jt===t.RG16F||jt===t.RG32F||jt===t.RGBA16F||jt===t.RGBA32F)&&e.get("EXT_color_buffer_float"),jt}function q(Le,Pe){let vt;return Le?Pe===null||Pe===sm||Pe===M_?vt=t.DEPTH24_STENCIL8:Pe===kc?vt=t.DEPTH32F_STENCIL8:Pe===aw&&(vt=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Pe===null||Pe===sm||Pe===M_?vt=t.DEPTH_COMPONENT24:Pe===kc?vt=t.DEPTH_COMPONENT32F:Pe===aw&&(vt=t.DEPTH_COMPONENT16),vt}function le(Le,Pe){return L(Le)===!0||Le.isFramebufferTexture&&Le.minFilter!==el&&Le.minFilter!==Ma?Math.log2(Math.max(Pe.width,Pe.height))+1:Le.mipmaps!==void 0&&Le.mipmaps.length>0?Le.mipmaps.length:Le.isCompressedTexture&&Array.isArray(Le.image)?Pe.mipmaps.length:1}function ce(Le){const Pe=Le.target;Pe.removeEventListener("dispose",ce),pe(Pe),Pe.isVideoTexture&&w.delete(Pe)}function ae(Le){const Pe=Le.target;Pe.removeEventListener("dispose",ae),ue(Pe)}function pe(Le){const Pe=i.get(Le);if(Pe.__webglInit===void 0)return;const vt=Le.source,yt=M.get(vt);if(yt){const nn=yt[Pe.__cacheKey];nn.usedTimes--,nn.usedTimes===0&&fe(Le),Object.keys(yt).length===0&&M.delete(vt)}i.remove(Le)}function fe(Le){const Pe=i.get(Le);t.deleteTexture(Pe.__webglTexture);const vt=Le.source,yt=M.get(vt);delete yt[Pe.__cacheKey],c.memory.textures--}function ue(Le){const Pe=i.get(Le);if(Le.depthTexture&&(Le.depthTexture.dispose(),i.remove(Le.depthTexture)),Le.isWebGLCubeRenderTarget)for(let yt=0;yt<6;yt++){if(Array.isArray(Pe.__webglFramebuffer[yt]))for(let nn=0;nn<Pe.__webglFramebuffer[yt].length;nn++)t.deleteFramebuffer(Pe.__webglFramebuffer[yt][nn]);else t.deleteFramebuffer(Pe.__webglFramebuffer[yt]);Pe.__webglDepthbuffer&&t.deleteRenderbuffer(Pe.__webglDepthbuffer[yt])}else{if(Array.isArray(Pe.__webglFramebuffer))for(let yt=0;yt<Pe.__webglFramebuffer.length;yt++)t.deleteFramebuffer(Pe.__webglFramebuffer[yt]);else t.deleteFramebuffer(Pe.__webglFramebuffer);if(Pe.__webglDepthbuffer&&t.deleteRenderbuffer(Pe.__webglDepthbuffer),Pe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(Pe.__webglMultisampledFramebuffer),Pe.__webglColorRenderbuffer)for(let yt=0;yt<Pe.__webglColorRenderbuffer.length;yt++)Pe.__webglColorRenderbuffer[yt]&&t.deleteRenderbuffer(Pe.__webglColorRenderbuffer[yt]);Pe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(Pe.__webglDepthRenderbuffer)}const vt=Le.textures;for(let yt=0,nn=vt.length;yt<nn;yt++){const jt=i.get(vt[yt]);jt.__webglTexture&&(t.deleteTexture(jt.__webglTexture),c.memory.textures--),i.remove(vt[yt])}i.remove(Le)}let Ee=0;function We(){Ee=0}function rt(){const Le=Ee;return Le>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Le+" texture units while this GPU supports only "+r.maxTextures),Ee+=1,Le}function tt(Le){const Pe=[];return Pe.push(Le.wrapS),Pe.push(Le.wrapT),Pe.push(Le.wrapR||0),Pe.push(Le.magFilter),Pe.push(Le.minFilter),Pe.push(Le.anisotropy),Pe.push(Le.internalFormat),Pe.push(Le.format),Pe.push(Le.type),Pe.push(Le.generateMipmaps),Pe.push(Le.premultiplyAlpha),Pe.push(Le.flipY),Pe.push(Le.unpackAlignment),Pe.push(Le.colorSpace),Pe.join()}function Ye(Le,Pe){const vt=i.get(Le);if(Le.isVideoTexture&&xe(Le),Le.isRenderTargetTexture===!1&&Le.version>0&&vt.__version!==Le.version){const yt=Le.image;if(yt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(yt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Qe(vt,Le,Pe);return}}n.bindTexture(t.TEXTURE_2D,vt.__webglTexture,t.TEXTURE0+Pe)}function qe(Le,Pe){const vt=i.get(Le);if(Le.version>0&&vt.__version!==Le.version){Qe(vt,Le,Pe);return}n.bindTexture(t.TEXTURE_2D_ARRAY,vt.__webglTexture,t.TEXTURE0+Pe)}function ft(Le,Pe){const vt=i.get(Le);if(Le.version>0&&vt.__version!==Le.version){Qe(vt,Le,Pe);return}n.bindTexture(t.TEXTURE_3D,vt.__webglTexture,t.TEXTURE0+Pe)}function Me(Le,Pe){const vt=i.get(Le);if(Le.version>0&&vt.__version!==Le.version){Ge(vt,Le,Pe);return}n.bindTexture(t.TEXTURE_CUBE_MAP,vt.__webglTexture,t.TEXTURE0+Pe)}const $e={[dS]:t.REPEAT,[Yu]:t.CLAMP_TO_EDGE,[fS]:t.MIRRORED_REPEAT},ut={[el]:t.NEAREST,[CB]:t.NEAREST_MIPMAP_NEAREST,[mx]:t.NEAREST_MIPMAP_LINEAR,[Ma]:t.LINEAR,[R1]:t.LINEAR_MIPMAP_NEAREST,[vf]:t.LINEAR_MIPMAP_LINEAR},Mt={[cY]:t.NEVER,[mY]:t.ALWAYS,[uY]:t.LESS,[FB]:t.LEQUAL,[hY]:t.EQUAL,[pY]:t.GEQUAL,[dY]:t.GREATER,[fY]:t.NOTEQUAL};function Gt(Le,Pe){if(Pe.type===kc&&e.has("OES_texture_float_linear")===!1&&(Pe.magFilter===Ma||Pe.magFilter===R1||Pe.magFilter===mx||Pe.magFilter===vf||Pe.minFilter===Ma||Pe.minFilter===R1||Pe.minFilter===mx||Pe.minFilter===vf)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(Le,t.TEXTURE_WRAP_S,$e[Pe.wrapS]),t.texParameteri(Le,t.TEXTURE_WRAP_T,$e[Pe.wrapT]),(Le===t.TEXTURE_3D||Le===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Le,t.TEXTURE_WRAP_R,$e[Pe.wrapR]),t.texParameteri(Le,t.TEXTURE_MAG_FILTER,ut[Pe.magFilter]),t.texParameteri(Le,t.TEXTURE_MIN_FILTER,ut[Pe.minFilter]),Pe.compareFunction&&(t.texParameteri(Le,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Le,t.TEXTURE_COMPARE_FUNC,Mt[Pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Pe.magFilter===el||Pe.minFilter!==mx&&Pe.minFilter!==vf||Pe.type===kc&&e.has("OES_texture_float_linear")===!1)return;if(Pe.anisotropy>1||i.get(Pe).__currentAnisotropy){const vt=e.get("EXT_texture_filter_anisotropic");t.texParameterf(Le,vt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Pe.anisotropy,r.getMaxAnisotropy())),i.get(Pe).__currentAnisotropy=Pe.anisotropy}}}function Xt(Le,Pe){let vt=!1;Le.__webglInit===void 0&&(Le.__webglInit=!0,Pe.addEventListener("dispose",ce));const yt=Pe.source;let nn=M.get(yt);nn===void 0&&(nn={},M.set(yt,nn));const jt=tt(Pe);if(jt!==Le.__cacheKey){nn[jt]===void 0&&(nn[jt]={texture:t.createTexture(),usedTimes:0},c.memory.textures++,vt=!0),nn[jt].usedTimes++;const Fn=nn[Le.__cacheKey];Fn!==void 0&&(nn[Le.__cacheKey].usedTimes--,Fn.usedTimes===0&&fe(Pe)),Le.__cacheKey=jt,Le.__webglTexture=nn[jt].texture}return vt}function Qe(Le,Pe,vt){let yt=t.TEXTURE_2D;(Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)&&(yt=t.TEXTURE_2D_ARRAY),Pe.isData3DTexture&&(yt=t.TEXTURE_3D);const nn=Xt(Le,Pe),jt=Pe.source;n.bindTexture(yt,Le.__webglTexture,t.TEXTURE0+vt);const Fn=i.get(jt);if(jt.version!==Fn.__version||nn===!0){n.activeTexture(t.TEXTURE0+vt);const Bn=ls.getPrimaries(ls.workingColorSpace),Zn=Pe.colorSpace===Lp?null:ls.getPrimaries(Pe.colorSpace),Li=Pe.colorSpace===Lp||Bn===Zn?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Li);let zn=z(Pe.image,!1,r.maxTextureSize);zn=Se(Pe,zn);const oi=o.convert(Pe.format,Pe.colorSpace),gi=o.convert(Pe.type);let Ti=j(Pe.internalFormat,oi,gi,Pe.colorSpace,Pe.isVideoTexture);Gt(yt,Pe);let pi;const Ji=Pe.mipmaps,er=Pe.isVideoTexture!==!0,vi=Fn.__version===void 0||nn===!0,Wt=jt.dataReady,ui=le(Pe,zn);if(Pe.isDepthTexture)Ti=q(Pe.format===R_,Pe.type),vi&&(er?n.texStorage2D(t.TEXTURE_2D,1,Ti,zn.width,zn.height):n.texImage2D(t.TEXTURE_2D,0,Ti,zn.width,zn.height,0,oi,gi,null));else if(Pe.isDataTexture)if(Ji.length>0){er&&vi&&n.texStorage2D(t.TEXTURE_2D,ui,Ti,Ji[0].width,Ji[0].height);for(let vn=0,Ln=Ji.length;vn<Ln;vn++)pi=Ji[vn],er?Wt&&n.texSubImage2D(t.TEXTURE_2D,vn,0,0,pi.width,pi.height,oi,gi,pi.data):n.texImage2D(t.TEXTURE_2D,vn,Ti,pi.width,pi.height,0,oi,gi,pi.data);Pe.generateMipmaps=!1}else er?(vi&&n.texStorage2D(t.TEXTURE_2D,ui,Ti,zn.width,zn.height),Wt&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,zn.width,zn.height,oi,gi,zn.data)):n.texImage2D(t.TEXTURE_2D,0,Ti,zn.width,zn.height,0,oi,gi,zn.data);else if(Pe.isCompressedTexture)if(Pe.isCompressedArrayTexture){er&&vi&&n.texStorage3D(t.TEXTURE_2D_ARRAY,ui,Ti,Ji[0].width,Ji[0].height,zn.depth);for(let vn=0,Ln=Ji.length;vn<Ln;vn++)if(pi=Ji[vn],Pe.format!==wl)if(oi!==null)if(er){if(Wt)if(Pe.layerUpdates.size>0){const mi=jk(pi.width,pi.height,Pe.format,Pe.type);for(const hi of Pe.layerUpdates){const Xi=pi.data.subarray(hi*mi/pi.data.BYTES_PER_ELEMENT,(hi+1)*mi/pi.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,vn,0,0,hi,pi.width,pi.height,1,oi,Xi)}Pe.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,vn,0,0,0,pi.width,pi.height,zn.depth,oi,pi.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,vn,Ti,pi.width,pi.height,zn.depth,0,pi.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else er?Wt&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,vn,0,0,0,pi.width,pi.height,zn.depth,oi,gi,pi.data):n.texImage3D(t.TEXTURE_2D_ARRAY,vn,Ti,pi.width,pi.height,zn.depth,0,oi,gi,pi.data)}else{er&&vi&&n.texStorage2D(t.TEXTURE_2D,ui,Ti,Ji[0].width,Ji[0].height);for(let vn=0,Ln=Ji.length;vn<Ln;vn++)pi=Ji[vn],Pe.format!==wl?oi!==null?er?Wt&&n.compressedTexSubImage2D(t.TEXTURE_2D,vn,0,0,pi.width,pi.height,oi,pi.data):n.compressedTexImage2D(t.TEXTURE_2D,vn,Ti,pi.width,pi.height,0,pi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):er?Wt&&n.texSubImage2D(t.TEXTURE_2D,vn,0,0,pi.width,pi.height,oi,gi,pi.data):n.texImage2D(t.TEXTURE_2D,vn,Ti,pi.width,pi.height,0,oi,gi,pi.data)}else if(Pe.isDataArrayTexture)if(er){if(vi&&n.texStorage3D(t.TEXTURE_2D_ARRAY,ui,Ti,zn.width,zn.height,zn.depth),Wt)if(Pe.layerUpdates.size>0){const vn=jk(zn.width,zn.height,Pe.format,Pe.type);for(const Ln of Pe.layerUpdates){const mi=zn.data.subarray(Ln*vn/zn.data.BYTES_PER_ELEMENT,(Ln+1)*vn/zn.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Ln,zn.width,zn.height,1,oi,gi,mi)}Pe.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,zn.width,zn.height,zn.depth,oi,gi,zn.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ti,zn.width,zn.height,zn.depth,0,oi,gi,zn.data);else if(Pe.isData3DTexture)er?(vi&&n.texStorage3D(t.TEXTURE_3D,ui,Ti,zn.width,zn.height,zn.depth),Wt&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,zn.width,zn.height,zn.depth,oi,gi,zn.data)):n.texImage3D(t.TEXTURE_3D,0,Ti,zn.width,zn.height,zn.depth,0,oi,gi,zn.data);else if(Pe.isFramebufferTexture){if(vi)if(er)n.texStorage2D(t.TEXTURE_2D,ui,Ti,zn.width,zn.height);else{let vn=zn.width,Ln=zn.height;for(let mi=0;mi<ui;mi++)n.texImage2D(t.TEXTURE_2D,mi,Ti,vn,Ln,0,oi,gi,null),vn>>=1,Ln>>=1}}else if(Ji.length>0){if(er&&vi){const vn=it(Ji[0]);n.texStorage2D(t.TEXTURE_2D,ui,Ti,vn.width,vn.height)}for(let vn=0,Ln=Ji.length;vn<Ln;vn++)pi=Ji[vn],er?Wt&&n.texSubImage2D(t.TEXTURE_2D,vn,0,0,oi,gi,pi):n.texImage2D(t.TEXTURE_2D,vn,Ti,oi,gi,pi);Pe.generateMipmaps=!1}else if(er){if(vi){const vn=it(zn);n.texStorage2D(t.TEXTURE_2D,ui,Ti,vn.width,vn.height)}Wt&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,oi,gi,zn)}else n.texImage2D(t.TEXTURE_2D,0,Ti,oi,gi,zn);L(Pe)&&P(yt),Fn.__version=jt.version,Pe.onUpdate&&Pe.onUpdate(Pe)}Le.__version=Pe.version}function Ge(Le,Pe,vt){if(Pe.image.length!==6)return;const yt=Xt(Le,Pe),nn=Pe.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Le.__webglTexture,t.TEXTURE0+vt);const jt=i.get(nn);if(nn.version!==jt.__version||yt===!0){n.activeTexture(t.TEXTURE0+vt);const Fn=ls.getPrimaries(ls.workingColorSpace),Bn=Pe.colorSpace===Lp?null:ls.getPrimaries(Pe.colorSpace),Zn=Pe.colorSpace===Lp||Fn===Bn?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Zn);const Li=Pe.isCompressedTexture||Pe.image[0].isCompressedTexture,zn=Pe.image[0]&&Pe.image[0].isDataTexture,oi=[];for(let Ln=0;Ln<6;Ln++)!Li&&!zn?oi[Ln]=z(Pe.image[Ln],!0,r.maxCubemapSize):oi[Ln]=zn?Pe.image[Ln].image:Pe.image[Ln],oi[Ln]=Se(Pe,oi[Ln]);const gi=oi[0],Ti=o.convert(Pe.format,Pe.colorSpace),pi=o.convert(Pe.type),Ji=j(Pe.internalFormat,Ti,pi,Pe.colorSpace),er=Pe.isVideoTexture!==!0,vi=jt.__version===void 0||yt===!0,Wt=nn.dataReady;let ui=le(Pe,gi);Gt(t.TEXTURE_CUBE_MAP,Pe);let vn;if(Li){er&&vi&&n.texStorage2D(t.TEXTURE_CUBE_MAP,ui,Ji,gi.width,gi.height);for(let Ln=0;Ln<6;Ln++){vn=oi[Ln].mipmaps;for(let mi=0;mi<vn.length;mi++){const hi=vn[mi];Pe.format!==wl?Ti!==null?er?Wt&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi,0,0,hi.width,hi.height,Ti,hi.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi,Ji,hi.width,hi.height,0,hi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):er?Wt&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi,0,0,hi.width,hi.height,Ti,pi,hi.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi,Ji,hi.width,hi.height,0,Ti,pi,hi.data)}}}else{if(vn=Pe.mipmaps,er&&vi){vn.length>0&&ui++;const Ln=it(oi[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,ui,Ji,Ln.width,Ln.height)}for(let Ln=0;Ln<6;Ln++)if(zn){er?Wt&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,0,0,0,oi[Ln].width,oi[Ln].height,Ti,pi,oi[Ln].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,0,Ji,oi[Ln].width,oi[Ln].height,0,Ti,pi,oi[Ln].data);for(let mi=0;mi<vn.length;mi++){const Xi=vn[mi].image[Ln].image;er?Wt&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi+1,0,0,Xi.width,Xi.height,Ti,pi,Xi.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi+1,Ji,Xi.width,Xi.height,0,Ti,pi,Xi.data)}}else{er?Wt&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,0,0,0,Ti,pi,oi[Ln]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,0,Ji,Ti,pi,oi[Ln]);for(let mi=0;mi<vn.length;mi++){const hi=vn[mi];er?Wt&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi+1,0,0,Ti,pi,hi.image[Ln]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ln,mi+1,Ji,Ti,pi,hi.image[Ln])}}}L(Pe)&&P(t.TEXTURE_CUBE_MAP),jt.__version=nn.version,Pe.onUpdate&&Pe.onUpdate(Pe)}Le.__version=Pe.version}function He(Le,Pe,vt,yt,nn,jt){const Fn=o.convert(vt.format,vt.colorSpace),Bn=o.convert(vt.type),Zn=j(vt.internalFormat,Fn,Bn,vt.colorSpace),Li=i.get(Pe),zn=i.get(vt);if(zn.__renderTarget=Pe,!Li.__hasExternalTextures){const oi=Math.max(1,Pe.width>>jt),gi=Math.max(1,Pe.height>>jt);nn===t.TEXTURE_3D||nn===t.TEXTURE_2D_ARRAY?n.texImage3D(nn,jt,Zn,oi,gi,Pe.depth,0,Fn,Bn,null):n.texImage2D(nn,jt,Zn,oi,gi,0,Fn,Bn,null)}n.bindFramebuffer(t.FRAMEBUFFER,Le),tn(Pe)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,yt,nn,zn.__webglTexture,0,Ot(Pe)):(nn===t.TEXTURE_2D||nn>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&nn<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,yt,nn,zn.__webglTexture,jt),n.bindFramebuffer(t.FRAMEBUFFER,null)}function De(Le,Pe,vt){if(t.bindRenderbuffer(t.RENDERBUFFER,Le),Pe.depthBuffer){const yt=Pe.depthTexture,nn=yt&&yt.isDepthTexture?yt.type:null,jt=q(Pe.stencilBuffer,nn),Fn=Pe.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Bn=Ot(Pe);tn(Pe)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Bn,jt,Pe.width,Pe.height):vt?t.renderbufferStorageMultisample(t.RENDERBUFFER,Bn,jt,Pe.width,Pe.height):t.renderbufferStorage(t.RENDERBUFFER,jt,Pe.width,Pe.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Fn,t.RENDERBUFFER,Le)}else{const yt=Pe.textures;for(let nn=0;nn<yt.length;nn++){const jt=yt[nn],Fn=o.convert(jt.format,jt.colorSpace),Bn=o.convert(jt.type),Zn=j(jt.internalFormat,Fn,Bn,jt.colorSpace),Li=Ot(Pe);vt&&tn(Pe)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Li,Zn,Pe.width,Pe.height):tn(Pe)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Li,Zn,Pe.width,Pe.height):t.renderbufferStorage(t.RENDERBUFFER,Zn,Pe.width,Pe.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function kt(Le,Pe){if(Pe&&Pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Le),!(Pe.depthTexture&&Pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const yt=i.get(Pe.depthTexture);yt.__renderTarget=Pe,(!yt.__webglTexture||Pe.depthTexture.image.width!==Pe.width||Pe.depthTexture.image.height!==Pe.height)&&(Pe.depthTexture.image.width=Pe.width,Pe.depthTexture.image.height=Pe.height,Pe.depthTexture.needsUpdate=!0),Ye(Pe.depthTexture,0);const nn=yt.__webglTexture,jt=Ot(Pe);if(Pe.depthTexture.format===l_)tn(Pe)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,nn,0,jt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,nn,0);else if(Pe.depthTexture.format===R_)tn(Pe)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,nn,0,jt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,nn,0);else throw new Error("Unknown depthTexture format")}function rn(Le){const Pe=i.get(Le),vt=Le.isWebGLCubeRenderTarget===!0;if(Pe.__boundDepthTexture!==Le.depthTexture){const yt=Le.depthTexture;if(Pe.__depthDisposeCallback&&Pe.__depthDisposeCallback(),yt){const nn=()=>{delete Pe.__boundDepthTexture,delete Pe.__depthDisposeCallback,yt.removeEventListener("dispose",nn)};yt.addEventListener("dispose",nn),Pe.__depthDisposeCallback=nn}Pe.__boundDepthTexture=yt}if(Le.depthTexture&&!Pe.__autoAllocateDepthBuffer){if(vt)throw new Error("target.depthTexture not supported in Cube render targets");kt(Pe.__webglFramebuffer,Le)}else if(vt){Pe.__webglDepthbuffer=[];for(let yt=0;yt<6;yt++)if(n.bindFramebuffer(t.FRAMEBUFFER,Pe.__webglFramebuffer[yt]),Pe.__webglDepthbuffer[yt]===void 0)Pe.__webglDepthbuffer[yt]=t.createRenderbuffer(),De(Pe.__webglDepthbuffer[yt],Le,!1);else{const nn=Le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,jt=Pe.__webglDepthbuffer[yt];t.bindRenderbuffer(t.RENDERBUFFER,jt),t.framebufferRenderbuffer(t.FRAMEBUFFER,nn,t.RENDERBUFFER,jt)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,Pe.__webglFramebuffer),Pe.__webglDepthbuffer===void 0)Pe.__webglDepthbuffer=t.createRenderbuffer(),De(Pe.__webglDepthbuffer,Le,!1);else{const yt=Le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,nn=Pe.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,nn),t.framebufferRenderbuffer(t.FRAMEBUFFER,yt,t.RENDERBUFFER,nn)}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Re(Le,Pe,vt){const yt=i.get(Le);Pe!==void 0&&He(yt.__webglFramebuffer,Le,Le.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),vt!==void 0&&rn(Le)}function Kt(Le){const Pe=Le.texture,vt=i.get(Le),yt=i.get(Pe);Le.addEventListener("dispose",ae);const nn=Le.textures,jt=Le.isWebGLCubeRenderTarget===!0,Fn=nn.length>1;if(Fn||(yt.__webglTexture===void 0&&(yt.__webglTexture=t.createTexture()),yt.__version=Pe.version,c.memory.textures++),jt){vt.__webglFramebuffer=[];for(let Bn=0;Bn<6;Bn++)if(Pe.mipmaps&&Pe.mipmaps.length>0){vt.__webglFramebuffer[Bn]=[];for(let Zn=0;Zn<Pe.mipmaps.length;Zn++)vt.__webglFramebuffer[Bn][Zn]=t.createFramebuffer()}else vt.__webglFramebuffer[Bn]=t.createFramebuffer()}else{if(Pe.mipmaps&&Pe.mipmaps.length>0){vt.__webglFramebuffer=[];for(let Bn=0;Bn<Pe.mipmaps.length;Bn++)vt.__webglFramebuffer[Bn]=t.createFramebuffer()}else vt.__webglFramebuffer=t.createFramebuffer();if(Fn)for(let Bn=0,Zn=nn.length;Bn<Zn;Bn++){const Li=i.get(nn[Bn]);Li.__webglTexture===void 0&&(Li.__webglTexture=t.createTexture(),c.memory.textures++)}if(Le.samples>0&&tn(Le)===!1){vt.__webglMultisampledFramebuffer=t.createFramebuffer(),vt.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,vt.__webglMultisampledFramebuffer);for(let Bn=0;Bn<nn.length;Bn++){const Zn=nn[Bn];vt.__webglColorRenderbuffer[Bn]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,vt.__webglColorRenderbuffer[Bn]);const Li=o.convert(Zn.format,Zn.colorSpace),zn=o.convert(Zn.type),oi=j(Zn.internalFormat,Li,zn,Zn.colorSpace,Le.isXRRenderTarget===!0),gi=Ot(Le);t.renderbufferStorageMultisample(t.RENDERBUFFER,gi,oi,Le.width,Le.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Bn,t.RENDERBUFFER,vt.__webglColorRenderbuffer[Bn])}t.bindRenderbuffer(t.RENDERBUFFER,null),Le.depthBuffer&&(vt.__webglDepthRenderbuffer=t.createRenderbuffer(),De(vt.__webglDepthRenderbuffer,Le,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(jt){n.bindTexture(t.TEXTURE_CUBE_MAP,yt.__webglTexture),Gt(t.TEXTURE_CUBE_MAP,Pe);for(let Bn=0;Bn<6;Bn++)if(Pe.mipmaps&&Pe.mipmaps.length>0)for(let Zn=0;Zn<Pe.mipmaps.length;Zn++)He(vt.__webglFramebuffer[Bn][Zn],Le,Pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Bn,Zn);else He(vt.__webglFramebuffer[Bn],Le,Pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Bn,0);L(Pe)&&P(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Fn){for(let Bn=0,Zn=nn.length;Bn<Zn;Bn++){const Li=nn[Bn],zn=i.get(Li);n.bindTexture(t.TEXTURE_2D,zn.__webglTexture),Gt(t.TEXTURE_2D,Li),He(vt.__webglFramebuffer,Le,Li,t.COLOR_ATTACHMENT0+Bn,t.TEXTURE_2D,0),L(Li)&&P(t.TEXTURE_2D)}n.unbindTexture()}else{let Bn=t.TEXTURE_2D;if((Le.isWebGL3DRenderTarget||Le.isWebGLArrayRenderTarget)&&(Bn=Le.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Bn,yt.__webglTexture),Gt(Bn,Pe),Pe.mipmaps&&Pe.mipmaps.length>0)for(let Zn=0;Zn<Pe.mipmaps.length;Zn++)He(vt.__webglFramebuffer[Zn],Le,Pe,t.COLOR_ATTACHMENT0,Bn,Zn);else He(vt.__webglFramebuffer,Le,Pe,t.COLOR_ATTACHMENT0,Bn,0);L(Pe)&&P(Bn),n.unbindTexture()}Le.depthBuffer&&rn(Le)}function bt(Le){const Pe=Le.textures;for(let vt=0,yt=Pe.length;vt<yt;vt++){const nn=Pe[vt];if(L(nn)){const jt=H(Le),Fn=i.get(nn).__webglTexture;n.bindTexture(jt,Fn),P(jt),n.unbindTexture()}}}const Dt=[],_e=[];function At(Le){if(Le.samples>0){if(tn(Le)===!1){const Pe=Le.textures,vt=Le.width,yt=Le.height;let nn=t.COLOR_BUFFER_BIT;const jt=Le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Fn=i.get(Le),Bn=Pe.length>1;if(Bn)for(let Zn=0;Zn<Pe.length;Zn++)n.bindFramebuffer(t.FRAMEBUFFER,Fn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Zn,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Fn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Zn,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Fn.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Fn.__webglFramebuffer);for(let Zn=0;Zn<Pe.length;Zn++){if(Le.resolveDepthBuffer&&(Le.depthBuffer&&(nn|=t.DEPTH_BUFFER_BIT),Le.stencilBuffer&&Le.resolveStencilBuffer&&(nn|=t.STENCIL_BUFFER_BIT)),Bn){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Fn.__webglColorRenderbuffer[Zn]);const Li=i.get(Pe[Zn]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Li,0)}t.blitFramebuffer(0,0,vt,yt,0,0,vt,yt,nn,t.NEAREST),f===!0&&(Dt.length=0,_e.length=0,Dt.push(t.COLOR_ATTACHMENT0+Zn),Le.depthBuffer&&Le.resolveDepthBuffer===!1&&(Dt.push(jt),_e.push(jt),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,_e)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Dt))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Bn)for(let Zn=0;Zn<Pe.length;Zn++){n.bindFramebuffer(t.FRAMEBUFFER,Fn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Zn,t.RENDERBUFFER,Fn.__webglColorRenderbuffer[Zn]);const Li=i.get(Pe[Zn]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Fn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Zn,t.TEXTURE_2D,Li,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Fn.__webglMultisampledFramebuffer)}else if(Le.depthBuffer&&Le.resolveDepthBuffer===!1&&f){const Pe=Le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[Pe])}}}function Ot(Le){return Math.min(r.maxSamples,Le.samples)}function tn(Le){const Pe=i.get(Le);return Le.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Pe.__useRenderToTexture!==!1}function xe(Le){const Pe=c.render.frame;w.get(Le)!==Pe&&(w.set(Le,Pe),Le.update())}function Se(Le,Pe){const vt=Le.colorSpace,yt=Le.format,nn=Le.type;return Le.isCompressedTexture===!0||Le.isVideoTexture===!0||vt!==H_&&vt!==Lp&&(ls.getTransfer(vt)===Ns?(yt!==wl||nn!==dd)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",vt)),Pe}function it(Le){return typeof HTMLImageElement<"u"&&Le instanceof HTMLImageElement?(v.width=Le.naturalWidth||Le.width,v.height=Le.naturalHeight||Le.height):typeof VideoFrame<"u"&&Le instanceof VideoFrame?(v.width=Le.displayWidth,v.height=Le.displayHeight):(v.width=Le.width,v.height=Le.height),v}this.allocateTextureUnit=rt,this.resetTextureUnits=We,this.setTexture2D=Ye,this.setTexture2DArray=qe,this.setTexture3D=ft,this.setTextureCube=Me,this.rebindTextures=Re,this.setupRenderTarget=Kt,this.updateRenderTargetMipmap=bt,this.updateMultisampleRenderTarget=At,this.setupDepthRenderbuffer=rn,this.setupFrameBufferTexture=He,this.useMultisampledRTT=tn}function PY(t,e){function n(i,r=Lp){let o;const c=ls.getTransfer(r);if(i===dd)return t.UNSIGNED_BYTE;if(i===qA)return t.UNSIGNED_SHORT_4_4_4_4;if(i===ZA)return t.UNSIGNED_SHORT_5_5_5_1;if(i===EB)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===SB)return t.BYTE;if(i===bB)return t.SHORT;if(i===aw)return t.UNSIGNED_SHORT;if(i===$A)return t.INT;if(i===sm)return t.UNSIGNED_INT;if(i===kc)return t.FLOAT;if(i===kw)return t.HALF_FLOAT;if(i===MB)return t.ALPHA;if(i===RB)return t.RGB;if(i===wl)return t.RGBA;if(i===TB)return t.LUMINANCE;if(i===AB)return t.LUMINANCE_ALPHA;if(i===l_)return t.DEPTH_COMPONENT;if(i===R_)return t.DEPTH_STENCIL;if(i===XA)return t.RED;if(i===ob)return t.RED_INTEGER;if(i===PB)return t.RG;if(i===KA)return t.RG_INTEGER;if(i===YA)return t.RGBA_INTEGER;if(i===T1||i===A1||i===P1||i===I1)if(c===Ns)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(i===T1)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===A1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===P1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===I1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(i===T1)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===A1)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===P1)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===I1)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===AT||i===PT||i===IT||i===DT)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(i===AT)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===PT)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===IT)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===DT)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===FT||i===LT||i===OT)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(i===FT||i===LT)return c===Ns?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===OT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===kT||i===NT||i===BT||i===zT||i===UT||i===VT||i===GT||i===HT||i===WT||i===jT||i===$T||i===qT||i===ZT||i===XT)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(i===kT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===NT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===BT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===zT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===UT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===VT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===GT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===HT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===WT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===jT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===$T)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===qT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===ZT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===XT)return c===Ns?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===D1||i===KT||i===YT)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(i===D1)return c===Ns?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===KT)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===YT)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===IB||i===JT||i===QT||i===eA)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(i===D1)return o.COMPRESSED_RED_RGTC1_EXT;if(i===JT)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===QT)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===eA)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===M_?t.UNSIGNED_INT_24_8:t[i]!==void 0?t[i]:null}return{convert:n}}class IY extends Ua{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class yx extends Cs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const iDe={type:"move"};class E2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new yx,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new yx,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new gt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new gt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new yx,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new gt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new gt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let r=null,o=null,c=null;const s=this._targetRay,f=this._grip,v=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(v&&e.hand){c=!0;for(const z of e.hand.values()){const L=n.getJointPose(z,i),P=this._getHandJoint(v,z);L!==null&&(P.matrix.fromArray(L.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,P.jointRadius=L.radius),P.visible=L!==null}const w=v.joints["index-finger-tip"],C=v.joints["thumb-tip"],M=w.position.distanceTo(C.position),F=.02,N=.005;v.inputState.pinching&&M>F+N?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!v.inputState.pinching&&M<=F-N&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else f!==null&&e.gripSpace&&(o=n.getPose(e.gripSpace,i),o!==null&&(f.matrix.fromArray(o.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,o.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(o.linearVelocity)):f.hasLinearVelocity=!1,o.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(o.angularVelocity)):f.hasAngularVelocity=!1));s!==null&&(r=n.getPose(e.targetRaySpace,i),r===null&&o!==null&&(r=o),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(iDe)))}return s!==null&&(s.visible=r!==null),f!==null&&(f.visible=o!==null),v!==null&&(v.visible=c!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new yx;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}const rDe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,sDe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class oDe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,i){if(this.texture===null){const r=new Oo,o=e.properties.get(r);o.__webglTexture=n.texture,(n.depthNear!=i.depthNear||n.depthFar!=i.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,i=new ih({vertexShader:rDe,fragmentShader:sDe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new va(new Bw(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class aDe extends Pf{constructor(e,n){super();const i=this;let r=null,o=1,c=null,s="local-floor",f=1,v=null,w=null,C=null,M=null,F=null,N=null;const z=new oDe,L=n.getContextAttributes();let P=null,H=null;const j=[],q=[],le=new Cn;let ce=null;const ae=new Ua;ae.viewport=new xs;const pe=new Ua;pe.viewport=new xs;const fe=[ae,pe],ue=new IY;let Ee=null,We=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Qe){let Ge=j[Qe];return Ge===void 0&&(Ge=new E2,j[Qe]=Ge),Ge.getTargetRaySpace()},this.getControllerGrip=function(Qe){let Ge=j[Qe];return Ge===void 0&&(Ge=new E2,j[Qe]=Ge),Ge.getGripSpace()},this.getHand=function(Qe){let Ge=j[Qe];return Ge===void 0&&(Ge=new E2,j[Qe]=Ge),Ge.getHandSpace()};function rt(Qe){const Ge=q.indexOf(Qe.inputSource);if(Ge===-1)return;const He=j[Ge];He!==void 0&&(He.update(Qe.inputSource,Qe.frame,v||c),He.dispatchEvent({type:Qe.type,data:Qe.inputSource}))}function tt(){r.removeEventListener("select",rt),r.removeEventListener("selectstart",rt),r.removeEventListener("selectend",rt),r.removeEventListener("squeeze",rt),r.removeEventListener("squeezestart",rt),r.removeEventListener("squeezeend",rt),r.removeEventListener("end",tt),r.removeEventListener("inputsourceschange",Ye);for(let Qe=0;Qe<j.length;Qe++){const Ge=q[Qe];Ge!==null&&(q[Qe]=null,j[Qe].disconnect(Ge))}Ee=null,We=null,z.reset(),e.setRenderTarget(P),F=null,M=null,C=null,r=null,H=null,Xt.stop(),i.isPresenting=!1,e.setPixelRatio(ce),e.setSize(le.width,le.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Qe){o=Qe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Qe){s=Qe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return v||c},this.setReferenceSpace=function(Qe){v=Qe},this.getBaseLayer=function(){return M!==null?M:F},this.getBinding=function(){return C},this.getFrame=function(){return N},this.getSession=function(){return r},this.setSession=async function(Qe){if(r=Qe,r!==null){if(P=e.getRenderTarget(),r.addEventListener("select",rt),r.addEventListener("selectstart",rt),r.addEventListener("selectend",rt),r.addEventListener("squeeze",rt),r.addEventListener("squeezestart",rt),r.addEventListener("squeezeend",rt),r.addEventListener("end",tt),r.addEventListener("inputsourceschange",Ye),L.xrCompatible!==!0&&await n.makeXRCompatible(),ce=e.getPixelRatio(),e.getSize(le),r.renderState.layers===void 0){const Ge={antialias:L.antialias,alpha:!0,depth:L.depth,stencil:L.stencil,framebufferScaleFactor:o};F=new XRWebGLLayer(r,n,Ge),r.updateRenderState({baseLayer:F}),e.setPixelRatio(1),e.setSize(F.framebufferWidth,F.framebufferHeight,!1),H=new fd(F.framebufferWidth,F.framebufferHeight,{format:wl,type:dd,colorSpace:e.outputColorSpace,stencilBuffer:L.stencil})}else{let Ge=null,He=null,De=null;L.depth&&(De=L.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,Ge=L.stencil?R_:l_,He=L.stencil?M_:sm);const kt={colorFormat:n.RGBA8,depthFormat:De,scaleFactor:o};C=new XRWebGLBinding(r,n),M=C.createProjectionLayer(kt),r.updateRenderState({layers:[M]}),e.setPixelRatio(1),e.setSize(M.textureWidth,M.textureHeight,!1),H=new fd(M.textureWidth,M.textureHeight,{format:wl,type:dd,depthTexture:new zB(M.textureWidth,M.textureHeight,He,void 0,void 0,void 0,void 0,void 0,void 0,Ge),stencilBuffer:L.stencil,colorSpace:e.outputColorSpace,samples:L.antialias?4:0,resolveDepthBuffer:M.ignoreDepthValues===!1})}H.isXRRenderTarget=!0,this.setFoveation(f),v=null,c=await r.requestReferenceSpace(s),Xt.setContext(r),Xt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return z.getDepthTexture()};function Ye(Qe){for(let Ge=0;Ge<Qe.removed.length;Ge++){const He=Qe.removed[Ge],De=q.indexOf(He);De>=0&&(q[De]=null,j[De].disconnect(He))}for(let Ge=0;Ge<Qe.added.length;Ge++){const He=Qe.added[Ge];let De=q.indexOf(He);if(De===-1){for(let rn=0;rn<j.length;rn++)if(rn>=q.length){q.push(He),De=rn;break}else if(q[rn]===null){q[rn]=He,De=rn;break}if(De===-1)break}const kt=j[De];kt&&kt.connect(He)}}const qe=new gt,ft=new gt;function Me(Qe,Ge,He){qe.setFromMatrixPosition(Ge.matrixWorld),ft.setFromMatrixPosition(He.matrixWorld);const De=qe.distanceTo(ft),kt=Ge.projectionMatrix.elements,rn=He.projectionMatrix.elements,Re=kt[14]/(kt[10]-1),Kt=kt[14]/(kt[10]+1),bt=(kt[9]+1)/kt[5],Dt=(kt[9]-1)/kt[5],_e=(kt[8]-1)/kt[0],At=(rn[8]+1)/rn[0],Ot=Re*_e,tn=Re*At,xe=De/(-_e+At),Se=xe*-_e;if(Ge.matrixWorld.decompose(Qe.position,Qe.quaternion,Qe.scale),Qe.translateX(Se),Qe.translateZ(xe),Qe.matrixWorld.compose(Qe.position,Qe.quaternion,Qe.scale),Qe.matrixWorldInverse.copy(Qe.matrixWorld).invert(),kt[10]===-1)Qe.projectionMatrix.copy(Ge.projectionMatrix),Qe.projectionMatrixInverse.copy(Ge.projectionMatrixInverse);else{const it=Re+xe,Le=Kt+xe,Pe=Ot-Se,vt=tn+(De-Se),yt=bt*Kt/Le*it,nn=Dt*Kt/Le*it;Qe.projectionMatrix.makePerspective(Pe,vt,yt,nn,it,Le),Qe.projectionMatrixInverse.copy(Qe.projectionMatrix).invert()}}function $e(Qe,Ge){Ge===null?Qe.matrixWorld.copy(Qe.matrix):Qe.matrixWorld.multiplyMatrices(Ge.matrixWorld,Qe.matrix),Qe.matrixWorldInverse.copy(Qe.matrixWorld).invert()}this.updateCamera=function(Qe){if(r===null)return;let Ge=Qe.near,He=Qe.far;z.texture!==null&&(z.depthNear>0&&(Ge=z.depthNear),z.depthFar>0&&(He=z.depthFar)),ue.near=pe.near=ae.near=Ge,ue.far=pe.far=ae.far=He,(Ee!==ue.near||We!==ue.far)&&(r.updateRenderState({depthNear:ue.near,depthFar:ue.far}),Ee=ue.near,We=ue.far),ae.layers.mask=Qe.layers.mask|2,pe.layers.mask=Qe.layers.mask|4,ue.layers.mask=ae.layers.mask|pe.layers.mask;const De=Qe.parent,kt=ue.cameras;$e(ue,De);for(let rn=0;rn<kt.length;rn++)$e(kt[rn],De);kt.length===2?Me(ue,ae,pe):ue.projectionMatrix.copy(ae.projectionMatrix),ut(Qe,ue,De)};function ut(Qe,Ge,He){He===null?Qe.matrix.copy(Ge.matrixWorld):(Qe.matrix.copy(He.matrixWorld),Qe.matrix.invert(),Qe.matrix.multiply(Ge.matrixWorld)),Qe.matrix.decompose(Qe.position,Qe.quaternion,Qe.scale),Qe.updateMatrixWorld(!0),Qe.projectionMatrix.copy(Ge.projectionMatrix),Qe.projectionMatrixInverse.copy(Ge.projectionMatrixInverse),Qe.isPerspectiveCamera&&(Qe.fov=lw*2*Math.atan(1/Qe.projectionMatrix.elements[5]),Qe.zoom=1)}this.getCamera=function(){return ue},this.getFoveation=function(){if(!(M===null&&F===null))return f},this.setFoveation=function(Qe){f=Qe,M!==null&&(M.fixedFoveation=Qe),F!==null&&F.fixedFoveation!==void 0&&(F.fixedFoveation=Qe)},this.hasDepthSensing=function(){return z.texture!==null},this.getDepthSensingMesh=function(){return z.getMesh(ue)};let Mt=null;function Gt(Qe,Ge){if(w=Ge.getViewerPose(v||c),N=Ge,w!==null){const He=w.views;F!==null&&(e.setRenderTargetFramebuffer(H,F.framebuffer),e.setRenderTarget(H));let De=!1;He.length!==ue.cameras.length&&(ue.cameras.length=0,De=!0);for(let rn=0;rn<He.length;rn++){const Re=He[rn];let Kt=null;if(F!==null)Kt=F.getViewport(Re);else{const Dt=C.getViewSubImage(M,Re);Kt=Dt.viewport,rn===0&&(e.setRenderTargetTextures(H,Dt.colorTexture,M.ignoreDepthValues?void 0:Dt.depthStencilTexture),e.setRenderTarget(H))}let bt=fe[rn];bt===void 0&&(bt=new Ua,bt.layers.enable(rn),bt.viewport=new xs,fe[rn]=bt),bt.matrix.fromArray(Re.transform.matrix),bt.matrix.decompose(bt.position,bt.quaternion,bt.scale),bt.projectionMatrix.fromArray(Re.projectionMatrix),bt.projectionMatrixInverse.copy(bt.projectionMatrix).invert(),bt.viewport.set(Kt.x,Kt.y,Kt.width,Kt.height),rn===0&&(ue.matrix.copy(bt.matrix),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale)),De===!0&&ue.cameras.push(bt)}const kt=r.enabledFeatures;if(kt&&kt.includes("depth-sensing")){const rn=C.getDepthInformation(He[0]);rn&&rn.isValid&&rn.texture&&z.init(e,rn,r.renderState)}}for(let He=0;He<j.length;He++){const De=q[He],kt=j[He];De!==null&&kt!==void 0&&kt.update(De,Ge,v||c)}Mt&&Mt(Qe,Ge),Ge.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ge}),N=null}const Xt=new EY;Xt.setAnimationLoop(Gt),this.setAnimationLoop=function(Qe){Mt=Qe},this.dispose=function(){}}}const vy=new nc,lDe=new Hi;function cDe(t,e){function n(L,P){L.matrixAutoUpdate===!0&&L.updateMatrix(),P.value.copy(L.matrix)}function i(L,P){P.color.getRGB(L.fogColor.value,wY(t)),P.isFog?(L.fogNear.value=P.near,L.fogFar.value=P.far):P.isFogExp2&&(L.fogDensity.value=P.density)}function r(L,P,H,j,q){P.isMeshBasicMaterial||P.isMeshLambertMaterial?o(L,P):P.isMeshToonMaterial?(o(L,P),C(L,P)):P.isMeshPhongMaterial?(o(L,P),w(L,P)):P.isMeshStandardMaterial?(o(L,P),M(L,P),P.isMeshPhysicalMaterial&&F(L,P,q)):P.isMeshMatcapMaterial?(o(L,P),N(L,P)):P.isMeshDepthMaterial?o(L,P):P.isMeshDistanceMaterial?(o(L,P),z(L,P)):P.isMeshNormalMaterial?o(L,P):P.isLineBasicMaterial?(c(L,P),P.isLineDashedMaterial&&s(L,P)):P.isPointsMaterial?f(L,P,H,j):P.isSpriteMaterial?v(L,P):P.isShadowMaterial?(L.color.value.copy(P.color),L.opacity.value=P.opacity):P.isShaderMaterial&&(P.uniformsNeedUpdate=!1)}function o(L,P){L.opacity.value=P.opacity,P.color&&L.diffuse.value.copy(P.color),P.emissive&&L.emissive.value.copy(P.emissive).multiplyScalar(P.emissiveIntensity),P.map&&(L.map.value=P.map,n(P.map,L.mapTransform)),P.alphaMap&&(L.alphaMap.value=P.alphaMap,n(P.alphaMap,L.alphaMapTransform)),P.bumpMap&&(L.bumpMap.value=P.bumpMap,n(P.bumpMap,L.bumpMapTransform),L.bumpScale.value=P.bumpScale,P.side===Jl&&(L.bumpScale.value*=-1)),P.normalMap&&(L.normalMap.value=P.normalMap,n(P.normalMap,L.normalMapTransform),L.normalScale.value.copy(P.normalScale),P.side===Jl&&L.normalScale.value.negate()),P.displacementMap&&(L.displacementMap.value=P.displacementMap,n(P.displacementMap,L.displacementMapTransform),L.displacementScale.value=P.displacementScale,L.displacementBias.value=P.displacementBias),P.emissiveMap&&(L.emissiveMap.value=P.emissiveMap,n(P.emissiveMap,L.emissiveMapTransform)),P.specularMap&&(L.specularMap.value=P.specularMap,n(P.specularMap,L.specularMapTransform)),P.alphaTest>0&&(L.alphaTest.value=P.alphaTest);const H=e.get(P),j=H.envMap,q=H.envMapRotation;j&&(L.envMap.value=j,vy.copy(q),vy.x*=-1,vy.y*=-1,vy.z*=-1,j.isCubeTexture&&j.isRenderTargetTexture===!1&&(vy.y*=-1,vy.z*=-1),L.envMapRotation.value.setFromMatrix4(lDe.makeRotationFromEuler(vy)),L.flipEnvMap.value=j.isCubeTexture&&j.isRenderTargetTexture===!1?-1:1,L.reflectivity.value=P.reflectivity,L.ior.value=P.ior,L.refractionRatio.value=P.refractionRatio),P.lightMap&&(L.lightMap.value=P.lightMap,L.lightMapIntensity.value=P.lightMapIntensity,n(P.lightMap,L.lightMapTransform)),P.aoMap&&(L.aoMap.value=P.aoMap,L.aoMapIntensity.value=P.aoMapIntensity,n(P.aoMap,L.aoMapTransform))}function c(L,P){L.diffuse.value.copy(P.color),L.opacity.value=P.opacity,P.map&&(L.map.value=P.map,n(P.map,L.mapTransform))}function s(L,P){L.dashSize.value=P.dashSize,L.totalSize.value=P.dashSize+P.gapSize,L.scale.value=P.scale}function f(L,P,H,j){L.diffuse.value.copy(P.color),L.opacity.value=P.opacity,L.size.value=P.size*H,L.scale.value=j*.5,P.map&&(L.map.value=P.map,n(P.map,L.uvTransform)),P.alphaMap&&(L.alphaMap.value=P.alphaMap,n(P.alphaMap,L.alphaMapTransform)),P.alphaTest>0&&(L.alphaTest.value=P.alphaTest)}function v(L,P){L.diffuse.value.copy(P.color),L.opacity.value=P.opacity,L.rotation.value=P.rotation,P.map&&(L.map.value=P.map,n(P.map,L.mapTransform)),P.alphaMap&&(L.alphaMap.value=P.alphaMap,n(P.alphaMap,L.alphaMapTransform)),P.alphaTest>0&&(L.alphaTest.value=P.alphaTest)}function w(L,P){L.specular.value.copy(P.specular),L.shininess.value=Math.max(P.shininess,1e-4)}function C(L,P){P.gradientMap&&(L.gradientMap.value=P.gradientMap)}function M(L,P){L.metalness.value=P.metalness,P.metalnessMap&&(L.metalnessMap.value=P.metalnessMap,n(P.metalnessMap,L.metalnessMapTransform)),L.roughness.value=P.roughness,P.roughnessMap&&(L.roughnessMap.value=P.roughnessMap,n(P.roughnessMap,L.roughnessMapTransform)),P.envMap&&(L.envMapIntensity.value=P.envMapIntensity)}function F(L,P,H){L.ior.value=P.ior,P.sheen>0&&(L.sheenColor.value.copy(P.sheenColor).multiplyScalar(P.sheen),L.sheenRoughness.value=P.sheenRoughness,P.sheenColorMap&&(L.sheenColorMap.value=P.sheenColorMap,n(P.sheenColorMap,L.sheenColorMapTransform)),P.sheenRoughnessMap&&(L.sheenRoughnessMap.value=P.sheenRoughnessMap,n(P.sheenRoughnessMap,L.sheenRoughnessMapTransform))),P.clearcoat>0&&(L.clearcoat.value=P.clearcoat,L.clearcoatRoughness.value=P.clearcoatRoughness,P.clearcoatMap&&(L.clearcoatMap.value=P.clearcoatMap,n(P.clearcoatMap,L.clearcoatMapTransform)),P.clearcoatRoughnessMap&&(L.clearcoatRoughnessMap.value=P.clearcoatRoughnessMap,n(P.clearcoatRoughnessMap,L.clearcoatRoughnessMapTransform)),P.clearcoatNormalMap&&(L.clearcoatNormalMap.value=P.clearcoatNormalMap,n(P.clearcoatNormalMap,L.clearcoatNormalMapTransform),L.clearcoatNormalScale.value.copy(P.clearcoatNormalScale),P.side===Jl&&L.clearcoatNormalScale.value.negate())),P.dispersion>0&&(L.dispersion.value=P.dispersion),P.iridescence>0&&(L.iridescence.value=P.iridescence,L.iridescenceIOR.value=P.iridescenceIOR,L.iridescenceThicknessMinimum.value=P.iridescenceThicknessRange[0],L.iridescenceThicknessMaximum.value=P.iridescenceThicknessRange[1],P.iridescenceMap&&(L.iridescenceMap.value=P.iridescenceMap,n(P.iridescenceMap,L.iridescenceMapTransform)),P.iridescenceThicknessMap&&(L.iridescenceThicknessMap.value=P.iridescenceThicknessMap,n(P.iridescenceThicknessMap,L.iridescenceThicknessMapTransform))),P.transmission>0&&(L.transmission.value=P.transmission,L.transmissionSamplerMap.value=H.texture,L.transmissionSamplerSize.value.set(H.width,H.height),P.transmissionMap&&(L.transmissionMap.value=P.transmissionMap,n(P.transmissionMap,L.transmissionMapTransform)),L.thickness.value=P.thickness,P.thicknessMap&&(L.thicknessMap.value=P.thicknessMap,n(P.thicknessMap,L.thicknessMapTransform)),L.attenuationDistance.value=P.attenuationDistance,L.attenuationColor.value.copy(P.attenuationColor)),P.anisotropy>0&&(L.anisotropyVector.value.set(P.anisotropy*Math.cos(P.anisotropyRotation),P.anisotropy*Math.sin(P.anisotropyRotation)),P.anisotropyMap&&(L.anisotropyMap.value=P.anisotropyMap,n(P.anisotropyMap,L.anisotropyMapTransform))),L.specularIntensity.value=P.specularIntensity,L.specularColor.value.copy(P.specularColor),P.specularColorMap&&(L.specularColorMap.value=P.specularColorMap,n(P.specularColorMap,L.specularColorMapTransform)),P.specularIntensityMap&&(L.specularIntensityMap.value=P.specularIntensityMap,n(P.specularIntensityMap,L.specularIntensityMapTransform))}function N(L,P){P.matcap&&(L.matcap.value=P.matcap)}function z(L,P){const H=e.get(P).light;L.referencePosition.value.setFromMatrixPosition(H.matrixWorld),L.nearDistance.value=H.shadow.camera.near,L.farDistance.value=H.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function uDe(t,e,n,i){let r={},o={},c=[];const s=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function f(H,j){const q=j.program;i.uniformBlockBinding(H,q)}function v(H,j){let q=r[H.id];q===void 0&&(N(H),q=w(H),r[H.id]=q,H.addEventListener("dispose",L));const le=j.program;i.updateUBOMapping(H,le);const ce=e.render.frame;o[H.id]!==ce&&(M(H),o[H.id]=ce)}function w(H){const j=C();H.__bindingPointIndex=j;const q=t.createBuffer(),le=H.__size,ce=H.usage;return t.bindBuffer(t.UNIFORM_BUFFER,q),t.bufferData(t.UNIFORM_BUFFER,le,ce),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,j,q),q}function C(){for(let H=0;H<s;H++)if(c.indexOf(H)===-1)return c.push(H),H;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function M(H){const j=r[H.id],q=H.uniforms,le=H.__cache;t.bindBuffer(t.UNIFORM_BUFFER,j);for(let ce=0,ae=q.length;ce<ae;ce++){const pe=Array.isArray(q[ce])?q[ce]:[q[ce]];for(let fe=0,ue=pe.length;fe<ue;fe++){const Ee=pe[fe];if(F(Ee,ce,fe,le)===!0){const We=Ee.__offset,rt=Array.isArray(Ee.value)?Ee.value:[Ee.value];let tt=0;for(let Ye=0;Ye<rt.length;Ye++){const qe=rt[Ye],ft=z(qe);typeof qe=="number"||typeof qe=="boolean"?(Ee.__data[0]=qe,t.bufferSubData(t.UNIFORM_BUFFER,We+tt,Ee.__data)):qe.isMatrix3?(Ee.__data[0]=qe.elements[0],Ee.__data[1]=qe.elements[1],Ee.__data[2]=qe.elements[2],Ee.__data[3]=0,Ee.__data[4]=qe.elements[3],Ee.__data[5]=qe.elements[4],Ee.__data[6]=qe.elements[5],Ee.__data[7]=0,Ee.__data[8]=qe.elements[6],Ee.__data[9]=qe.elements[7],Ee.__data[10]=qe.elements[8],Ee.__data[11]=0):(qe.toArray(Ee.__data,tt),tt+=ft.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,We,Ee.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function F(H,j,q,le){const ce=H.value,ae=j+"_"+q;if(le[ae]===void 0)return typeof ce=="number"||typeof ce=="boolean"?le[ae]=ce:le[ae]=ce.clone(),!0;{const pe=le[ae];if(typeof ce=="number"||typeof ce=="boolean"){if(pe!==ce)return le[ae]=ce,!0}else if(pe.equals(ce)===!1)return pe.copy(ce),!0}return!1}function N(H){const j=H.uniforms;let q=0;const le=16;for(let ae=0,pe=j.length;ae<pe;ae++){const fe=Array.isArray(j[ae])?j[ae]:[j[ae]];for(let ue=0,Ee=fe.length;ue<Ee;ue++){const We=fe[ue],rt=Array.isArray(We.value)?We.value:[We.value];for(let tt=0,Ye=rt.length;tt<Ye;tt++){const qe=rt[tt],ft=z(qe),Me=q%le,$e=Me%ft.boundary,ut=Me+$e;q+=$e,ut!==0&&le-ut<ft.storage&&(q+=le-ut),We.__data=new Float32Array(ft.storage/Float32Array.BYTES_PER_ELEMENT),We.__offset=q,q+=ft.storage}}}const ce=q%le;return ce>0&&(q+=le-ce),H.__size=q,H.__cache={},this}function z(H){const j={boundary:0,storage:0};return typeof H=="number"||typeof H=="boolean"?(j.boundary=4,j.storage=4):H.isVector2?(j.boundary=8,j.storage=8):H.isVector3||H.isColor?(j.boundary=16,j.storage=12):H.isVector4?(j.boundary=16,j.storage=16):H.isMatrix3?(j.boundary=48,j.storage=48):H.isMatrix4?(j.boundary=64,j.storage=64):H.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",H),j}function L(H){const j=H.target;j.removeEventListener("dispose",L);const q=c.indexOf(j.__bindingPointIndex);c.splice(q,1),t.deleteBuffer(r[j.id]),delete r[j.id],delete o[j.id]}function P(){for(const H in r)t.deleteBuffer(r[H]);c=[],r={},o={}}return{bind:f,update:v,dispose:P}}class DY{constructor(e={}){const{canvas:n=vY(),context:i=null,depth:r=!0,stencil:o=!1,alpha:c=!1,antialias:s=!1,premultipliedAlpha:f=!0,preserveDrawingBuffer:v=!1,powerPreference:w="default",failIfMajorPerformanceCaveat:C=!1,reverseDepthBuffer:M=!1}=e;this.isWebGLRenderer=!0;let F;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");F=i.getContextAttributes().alpha}else F=c;const N=new Uint32Array(4),z=new Int32Array(4);let L=null,P=null;const H=[],j=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=$l,this.toneMapping=Cf,this.toneMappingExposure=1;const q=this;let le=!1,ce=0,ae=0,pe=null,fe=-1,ue=null;const Ee=new xs,We=new xs;let rt=null;const tt=new bi(0);let Ye=0,qe=n.width,ft=n.height,Me=1,$e=null,ut=null;const Mt=new xs(0,0,qe,ft),Gt=new xs(0,0,qe,ft);let Xt=!1;const Qe=new ub;let Ge=!1,He=!1;const De=new Hi,kt=new Hi,rn=new gt,Re=new xs,Kt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let bt=!1;function Dt(){return pe===null?Me:1}let _e=i;function At(Be,Pt){return n.getContext(Be,Pt)}try{const Be={alpha:!0,depth:r,stencil:o,antialias:s,premultipliedAlpha:f,preserveDrawingBuffer:v,powerPreference:w,failIfMajorPerformanceCaveat:C};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${rb}`),n.addEventListener("webglcontextlost",Ln,!1),n.addEventListener("webglcontextrestored",mi,!1),n.addEventListener("webglcontextcreationerror",hi,!1),_e===null){const Pt="webgl2";if(_e=At(Pt,Be),_e===null)throw At(Pt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Be){throw console.error("THREE.WebGLRenderer: "+Be.message),Be}let Ot,tn,xe,Se,it,Le,Pe,vt,yt,nn,jt,Fn,Bn,Zn,Li,zn,oi,gi,Ti,pi,Ji,er,vi,Wt;function ui(){Ot=new gPe(_e),Ot.init(),er=new PY(_e,Ot),tn=new uPe(_e,Ot,e,er),xe=new KIe(_e,Ot),tn.reverseDepthBuffer&&M&&xe.buffers.depth.setReversed(!0),Se=new _Pe(_e),it=new NIe,Le=new nDe(_e,Ot,xe,it,tn,er,Se),Pe=new dPe(q),vt=new mPe(q),yt=new MRe(_e),vi=new lPe(_e,yt),nn=new vPe(_e,yt,Se,vi),jt=new wPe(_e,nn,yt,Se),Ti=new xPe(_e,tn,Le),zn=new hPe(it),Fn=new kIe(q,Pe,vt,Ot,tn,vi,zn),Bn=new cDe(q,it),Zn=new zIe,Li=new jIe(Ot),gi=new aPe(q,Pe,vt,xe,jt,F,f),oi=new ZIe(q,jt,tn),Wt=new uDe(_e,Se,tn,xe),pi=new cPe(_e,Ot,Se),Ji=new yPe(_e,Ot,Se),Se.programs=Fn.programs,q.capabilities=tn,q.extensions=Ot,q.properties=it,q.renderLists=Zn,q.shadowMap=oi,q.state=xe,q.info=Se}ui();const vn=new aDe(q,_e);this.xr=vn,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const Be=Ot.get("WEBGL_lose_context");Be&&Be.loseContext()},this.forceContextRestore=function(){const Be=Ot.get("WEBGL_lose_context");Be&&Be.restoreContext()},this.getPixelRatio=function(){return Me},this.setPixelRatio=function(Be){Be!==void 0&&(Me=Be,this.setSize(qe,ft,!1))},this.getSize=function(Be){return Be.set(qe,ft)},this.setSize=function(Be,Pt,$t=!0){if(vn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}qe=Be,ft=Pt,n.width=Math.floor(Be*Me),n.height=Math.floor(Pt*Me),$t===!0&&(n.style.width=Be+"px",n.style.height=Pt+"px"),this.setViewport(0,0,Be,Pt)},this.getDrawingBufferSize=function(Be){return Be.set(qe*Me,ft*Me).floor()},this.setDrawingBufferSize=function(Be,Pt,$t){qe=Be,ft=Pt,Me=$t,n.width=Math.floor(Be*$t),n.height=Math.floor(Pt*$t),this.setViewport(0,0,Be,Pt)},this.getCurrentViewport=function(Be){return Be.copy(Ee)},this.getViewport=function(Be){return Be.copy(Mt)},this.setViewport=function(Be,Pt,$t,ht){Be.isVector4?Mt.set(Be.x,Be.y,Be.z,Be.w):Mt.set(Be,Pt,$t,ht),xe.viewport(Ee.copy(Mt).multiplyScalar(Me).round())},this.getScissor=function(Be){return Be.copy(Gt)},this.setScissor=function(Be,Pt,$t,ht){Be.isVector4?Gt.set(Be.x,Be.y,Be.z,Be.w):Gt.set(Be,Pt,$t,ht),xe.scissor(We.copy(Gt).multiplyScalar(Me).round())},this.getScissorTest=function(){return Xt},this.setScissorTest=function(Be){xe.setScissorTest(Xt=Be)},this.setOpaqueSort=function(Be){$e=Be},this.setTransparentSort=function(Be){ut=Be},this.getClearColor=function(Be){return Be.copy(gi.getClearColor())},this.setClearColor=function(){gi.setClearColor.apply(gi,arguments)},this.getClearAlpha=function(){return gi.getClearAlpha()},this.setClearAlpha=function(){gi.setClearAlpha.apply(gi,arguments)},this.clear=function(Be=!0,Pt=!0,$t=!0){let ht=0;if(Be){let Lt=!1;if(pe!==null){const An=pe.texture.format;Lt=An===YA||An===KA||An===ob}if(Lt){const An=pe.texture.type,Dn=An===dd||An===sm||An===aw||An===M_||An===qA||An===ZA,Xn=gi.getClearColor(),Yn=gi.getClearAlpha(),Si=Xn.r,Wi=Xn.g,di=Xn.b;Dn?(N[0]=Si,N[1]=Wi,N[2]=di,N[3]=Yn,_e.clearBufferuiv(_e.COLOR,0,N)):(z[0]=Si,z[1]=Wi,z[2]=di,z[3]=Yn,_e.clearBufferiv(_e.COLOR,0,z))}else ht|=_e.COLOR_BUFFER_BIT}Pt&&(ht|=_e.DEPTH_BUFFER_BIT),$t&&(ht|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(ht)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ln,!1),n.removeEventListener("webglcontextrestored",mi,!1),n.removeEventListener("webglcontextcreationerror",hi,!1),Zn.dispose(),Li.dispose(),it.dispose(),Pe.dispose(),vt.dispose(),jt.dispose(),vi.dispose(),Wt.dispose(),Fn.dispose(),vn.dispose(),vn.removeEventListener("sessionstart",pt),vn.removeEventListener("sessionend",nt),wt.stop()};function Ln(Be){Be.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),le=!0}function mi(){console.log("THREE.WebGLRenderer: Context Restored."),le=!1;const Be=Se.autoReset,Pt=oi.enabled,$t=oi.autoUpdate,ht=oi.needsUpdate,Lt=oi.type;ui(),Se.autoReset=Be,oi.enabled=Pt,oi.autoUpdate=$t,oi.needsUpdate=ht,oi.type=Lt}function hi(Be){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Be.statusMessage)}function Xi(Be){const Pt=Be.target;Pt.removeEventListener("dispose",Xi),cs(Pt)}function cs(Be){Ft(Be),it.remove(Be)}function Ft(Be){const Pt=it.get(Be).programs;Pt!==void 0&&(Pt.forEach(function($t){Fn.releaseProgram($t)}),Be.isShaderMaterial&&Fn.releaseShaderCache(Be))}this.renderBufferDirect=function(Be,Pt,$t,ht,Lt,An){Pt===null&&(Pt=Kt);const Dn=Lt.isMesh&&Lt.matrixWorld.determinant()<0,Xn=Ci(Be,Pt,$t,ht,Lt);xe.setMaterial(ht,Dn);let Yn=$t.index,Si=1;if(ht.wireframe===!0){if(Yn=nn.getWireframeAttribute($t),Yn===void 0)return;Si=2}const Wi=$t.drawRange,di=$t.attributes.position;let or=Wi.start*Si,Pr=(Wi.start+Wi.count)*Si;An!==null&&(or=Math.max(or,An.start*Si),Pr=Math.min(Pr,(An.start+An.count)*Si)),Yn!==null?(or=Math.max(or,0),Pr=Math.min(Pr,Yn.count)):di!=null&&(or=Math.max(or,0),Pr=Math.min(Pr,di.count));const ji=Pr-or;if(ji<0||ji===1/0)return;vi.setup(Lt,ht,Xn,$t,Yn);let vr,wr=pi;if(Yn!==null&&(vr=yt.get(Yn),wr=Ji,wr.setIndex(vr)),Lt.isMesh)ht.wireframe===!0?(xe.setLineWidth(ht.wireframeLinewidth*Dt()),wr.setMode(_e.LINES)):wr.setMode(_e.TRIANGLES);else if(Lt.isLine){let fi=ht.linewidth;fi===void 0&&(fi=1),xe.setLineWidth(fi*Dt()),Lt.isLineSegments?wr.setMode(_e.LINES):Lt.isLineLoop?wr.setMode(_e.LINE_LOOP):wr.setMode(_e.LINE_STRIP)}else Lt.isPoints?wr.setMode(_e.POINTS):Lt.isSprite&&wr.setMode(_e.TRIANGLES);if(Lt.isBatchedMesh)if(Lt._multiDrawInstances!==null)wr.renderMultiDrawInstances(Lt._multiDrawStarts,Lt._multiDrawCounts,Lt._multiDrawCount,Lt._multiDrawInstances);else if(Ot.get("WEBGL_multi_draw"))wr.renderMultiDraw(Lt._multiDrawStarts,Lt._multiDrawCounts,Lt._multiDrawCount);else{const fi=Lt._multiDrawStarts,fs=Lt._multiDrawCounts,tr=Lt._multiDrawCount,Ss=Yn?yt.get(Yn).bytesPerElement:1,is=it.get(ht).currentProgram.getUniforms();for(let rs=0;rs<tr;rs++)is.setValue(_e,"_gl_DrawID",rs),wr.render(fi[rs]/Ss,fs[rs])}else if(Lt.isInstancedMesh)wr.renderInstances(or,ji,Lt.count);else if($t.isInstancedBufferGeometry){const fi=$t._maxInstanceCount!==void 0?$t._maxInstanceCount:1/0,fs=Math.min($t.instanceCount,fi);wr.renderInstances(or,ji,fs)}else wr.render(or,ji)};function we(Be,Pt,$t){Be.transparent===!0&&Be.side===gf&&Be.forceSinglePass===!1?(Be.side=Jl,Be.needsUpdate=!0,fn(Be,Pt,$t),Be.side=im,Be.needsUpdate=!0,fn(Be,Pt,$t),Be.side=gf):fn(Be,Pt,$t)}this.compile=function(Be,Pt,$t=null){$t===null&&($t=Be),P=Li.get($t),P.init(Pt),j.push(P),$t.traverseVisible(function(Lt){Lt.isLight&&Lt.layers.test(Pt.layers)&&(P.pushLight(Lt),Lt.castShadow&&P.pushShadow(Lt))}),Be!==$t&&Be.traverseVisible(function(Lt){Lt.isLight&&Lt.layers.test(Pt.layers)&&(P.pushLight(Lt),Lt.castShadow&&P.pushShadow(Lt))}),P.setupLights();const ht=new Set;return Be.traverse(function(Lt){if(!(Lt.isMesh||Lt.isPoints||Lt.isLine||Lt.isSprite))return;const An=Lt.material;if(An)if(Array.isArray(An))for(let Dn=0;Dn<An.length;Dn++){const Xn=An[Dn];we(Xn,$t,Lt),ht.add(Xn)}else we(An,$t,Lt),ht.add(An)}),j.pop(),P=null,ht},this.compileAsync=function(Be,Pt,$t=null){const ht=this.compile(Be,Pt,$t);return new Promise(Lt=>{function An(){if(ht.forEach(function(Dn){it.get(Dn).currentProgram.isReady()&&ht.delete(Dn)}),ht.size===0){Lt(Be);return}setTimeout(An,10)}Ot.get("KHR_parallel_shader_compile")!==null?An():setTimeout(An,10)})};let Ie=null;function je(Be){Ie&&Ie(Be)}function pt(){wt.stop()}function nt(){wt.start()}const wt=new EY;wt.setAnimationLoop(je),typeof self<"u"&&wt.setContext(self),this.setAnimationLoop=function(Be){Ie=Be,vn.setAnimationLoop(Be),Be===null?wt.stop():wt.start()},vn.addEventListener("sessionstart",pt),vn.addEventListener("sessionend",nt),this.render=function(Be,Pt){if(Pt!==void 0&&Pt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(le===!0)return;if(Be.matrixWorldAutoUpdate===!0&&Be.updateMatrixWorld(),Pt.parent===null&&Pt.matrixWorldAutoUpdate===!0&&Pt.updateMatrixWorld(),vn.enabled===!0&&vn.isPresenting===!0&&(vn.cameraAutoUpdate===!0&&vn.updateCamera(Pt),Pt=vn.getCamera()),Be.isScene===!0&&Be.onBeforeRender(q,Be,Pt,pe),P=Li.get(Be,j.length),P.init(Pt),j.push(P),kt.multiplyMatrices(Pt.projectionMatrix,Pt.matrixWorldInverse),Qe.setFromProjectionMatrix(kt),He=this.localClippingEnabled,Ge=zn.init(this.clippingPlanes,He),L=Zn.get(Be,H.length),L.init(),H.push(L),vn.enabled===!0&&vn.isPresenting===!0){const An=q.xr.getDepthSensingMesh();An!==null&&zt(An,Pt,-1/0,q.sortObjects)}zt(Be,Pt,0,q.sortObjects),L.finish(),q.sortObjects===!0&&L.sort($e,ut),bt=vn.enabled===!1||vn.isPresenting===!1||vn.hasDepthSensing()===!1,bt&&gi.addToRenderList(L,Be),this.info.render.frame++,Ge===!0&&zn.beginShadows();const $t=P.state.shadowsArray;oi.render($t,Be,Pt),Ge===!0&&zn.endShadows(),this.info.autoReset===!0&&this.info.reset();const ht=L.opaque,Lt=L.transmissive;if(P.setupLights(),Pt.isArrayCamera){const An=Pt.cameras;if(Lt.length>0)for(let Dn=0,Xn=An.length;Dn<Xn;Dn++){const Yn=An[Dn];Bt(ht,Lt,Be,Yn)}bt&&gi.render(Be);for(let Dn=0,Xn=An.length;Dn<Xn;Dn++){const Yn=An[Dn];St(L,Be,Yn,Yn.viewport)}}else Lt.length>0&&Bt(ht,Lt,Be,Pt),bt&&gi.render(Be),St(L,Be,Pt);pe!==null&&(Le.updateMultisampleRenderTarget(pe),Le.updateRenderTargetMipmap(pe)),Be.isScene===!0&&Be.onAfterRender(q,Be,Pt),vi.resetDefaultState(),fe=-1,ue=null,j.pop(),j.length>0?(P=j[j.length-1],Ge===!0&&zn.setGlobalState(q.clippingPlanes,P.state.camera)):P=null,H.pop(),H.length>0?L=H[H.length-1]:L=null};function zt(Be,Pt,$t,ht){if(Be.visible===!1)return;if(Be.layers.test(Pt.layers)){if(Be.isGroup)$t=Be.renderOrder;else if(Be.isLOD)Be.autoUpdate===!0&&Be.update(Pt);else if(Be.isLight)P.pushLight(Be),Be.castShadow&&P.pushShadow(Be);else if(Be.isSprite){if(!Be.frustumCulled||Qe.intersectsSprite(Be)){ht&&Re.setFromMatrixPosition(Be.matrixWorld).applyMatrix4(kt);const Dn=jt.update(Be),Xn=Be.material;Xn.visible&&L.push(Be,Dn,Xn,$t,Re.z,null)}}else if((Be.isMesh||Be.isLine||Be.isPoints)&&(!Be.frustumCulled||Qe.intersectsObject(Be))){const Dn=jt.update(Be),Xn=Be.material;if(ht&&(Be.boundingSphere!==void 0?(Be.boundingSphere===null&&Be.computeBoundingSphere(),Re.copy(Be.boundingSphere.center)):(Dn.boundingSphere===null&&Dn.computeBoundingSphere(),Re.copy(Dn.boundingSphere.center)),Re.applyMatrix4(Be.matrixWorld).applyMatrix4(kt)),Array.isArray(Xn)){const Yn=Dn.groups;for(let Si=0,Wi=Yn.length;Si<Wi;Si++){const di=Yn[Si],or=Xn[di.materialIndex];or&&or.visible&&L.push(Be,Dn,or,$t,Re.z,di)}}else Xn.visible&&L.push(Be,Dn,Xn,$t,Re.z,null)}}const An=Be.children;for(let Dn=0,Xn=An.length;Dn<Xn;Dn++)zt(An[Dn],Pt,$t,ht)}function St(Be,Pt,$t,ht){const Lt=Be.opaque,An=Be.transmissive,Dn=Be.transparent;P.setupLightsView($t),Ge===!0&&zn.setGlobalState(q.clippingPlanes,$t),ht&&xe.viewport(Ee.copy(ht)),Lt.length>0&&Zt(Lt,Pt,$t),An.length>0&&Zt(An,Pt,$t),Dn.length>0&&Zt(Dn,Pt,$t),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function Bt(Be,Pt,$t,ht){if(($t.isScene===!0?$t.overrideMaterial:null)!==null)return;P.state.transmissionRenderTarget[ht.id]===void 0&&(P.state.transmissionRenderTarget[ht.id]=new fd(1,1,{generateMipmaps:!0,type:Ot.has("EXT_color_buffer_half_float")||Ot.has("EXT_color_buffer_float")?kw:dd,minFilter:vf,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ls.workingColorSpace}));const An=P.state.transmissionRenderTarget[ht.id],Dn=ht.viewport||Ee;An.setSize(Dn.z,Dn.w);const Xn=q.getRenderTarget();q.setRenderTarget(An),q.getClearColor(tt),Ye=q.getClearAlpha(),Ye<1&&q.setClearColor(16777215,.5),q.clear(),bt&&gi.render($t);const Yn=q.toneMapping;q.toneMapping=Cf;const Si=ht.viewport;if(ht.viewport!==void 0&&(ht.viewport=void 0),P.setupLightsView(ht),Ge===!0&&zn.setGlobalState(q.clippingPlanes,ht),Zt(Be,$t,ht),Le.updateMultisampleRenderTarget(An),Le.updateRenderTargetMipmap(An),Ot.has("WEBGL_multisampled_render_to_texture")===!1){let Wi=!1;for(let di=0,or=Pt.length;di<or;di++){const Pr=Pt[di],ji=Pr.object,vr=Pr.geometry,wr=Pr.material,fi=Pr.group;if(wr.side===gf&&ji.layers.test(ht.layers)){const fs=wr.side;wr.side=Jl,wr.needsUpdate=!0,Yt(ji,$t,ht,vr,wr,fi),wr.side=fs,wr.needsUpdate=!0,Wi=!0}}Wi===!0&&(Le.updateMultisampleRenderTarget(An),Le.updateRenderTargetMipmap(An))}q.setRenderTarget(Xn),q.setClearColor(tt,Ye),Si!==void 0&&(ht.viewport=Si),q.toneMapping=Yn}function Zt(Be,Pt,$t){const ht=Pt.isScene===!0?Pt.overrideMaterial:null;for(let Lt=0,An=Be.length;Lt<An;Lt++){const Dn=Be[Lt],Xn=Dn.object,Yn=Dn.geometry,Si=ht===null?Dn.material:ht,Wi=Dn.group;Xn.layers.test($t.layers)&&Yt(Xn,Pt,$t,Yn,Si,Wi)}}function Yt(Be,Pt,$t,ht,Lt,An){Be.onBeforeRender(q,Pt,$t,ht,Lt,An),Be.modelViewMatrix.multiplyMatrices($t.matrixWorldInverse,Be.matrixWorld),Be.normalMatrix.getNormalMatrix(Be.modelViewMatrix),Lt.onBeforeRender(q,Pt,$t,ht,Be,An),Lt.transparent===!0&&Lt.side===gf&&Lt.forceSinglePass===!1?(Lt.side=Jl,Lt.needsUpdate=!0,q.renderBufferDirect($t,Pt,ht,Lt,Be,An),Lt.side=im,Lt.needsUpdate=!0,q.renderBufferDirect($t,Pt,ht,Lt,Be,An),Lt.side=gf):q.renderBufferDirect($t,Pt,ht,Lt,Be,An),Be.onAfterRender(q,Pt,$t,ht,Lt,An)}function fn(Be,Pt,$t){Pt.isScene!==!0&&(Pt=Kt);const ht=it.get(Be),Lt=P.state.lights,An=P.state.shadowsArray,Dn=Lt.state.version,Xn=Fn.getParameters(Be,Lt.state,An,Pt,$t),Yn=Fn.getProgramCacheKey(Xn);let Si=ht.programs;ht.environment=Be.isMeshStandardMaterial?Pt.environment:null,ht.fog=Pt.fog,ht.envMap=(Be.isMeshStandardMaterial?vt:Pe).get(Be.envMap||ht.environment),ht.envMapRotation=ht.environment!==null&&Be.envMap===null?Pt.environmentRotation:Be.envMapRotation,Si===void 0&&(Be.addEventListener("dispose",Xi),Si=new Map,ht.programs=Si);let Wi=Si.get(Yn);if(Wi!==void 0){if(ht.currentProgram===Wi&&ht.lightsStateVersion===Dn)return Gn(Be,Xn),Wi}else Xn.uniforms=Fn.getUniforms(Be),Be.onBeforeCompile(Xn,q),Wi=Fn.acquireProgram(Xn,Yn),Si.set(Yn,Wi),ht.uniforms=Xn.uniforms;const di=ht.uniforms;return(!Be.isShaderMaterial&&!Be.isRawShaderMaterial||Be.clipping===!0)&&(di.clippingPlanes=zn.uniform),Gn(Be,Xn),ht.needsLights=Mi(Be),ht.lightsStateVersion=Dn,ht.needsLights&&(di.ambientLightColor.value=Lt.state.ambient,di.lightProbe.value=Lt.state.probe,di.directionalLights.value=Lt.state.directional,di.directionalLightShadows.value=Lt.state.directionalShadow,di.spotLights.value=Lt.state.spot,di.spotLightShadows.value=Lt.state.spotShadow,di.rectAreaLights.value=Lt.state.rectArea,di.ltc_1.value=Lt.state.rectAreaLTC1,di.ltc_2.value=Lt.state.rectAreaLTC2,di.pointLights.value=Lt.state.point,di.pointLightShadows.value=Lt.state.pointShadow,di.hemisphereLights.value=Lt.state.hemi,di.directionalShadowMap.value=Lt.state.directionalShadowMap,di.directionalShadowMatrix.value=Lt.state.directionalShadowMatrix,di.spotShadowMap.value=Lt.state.spotShadowMap,di.spotLightMatrix.value=Lt.state.spotLightMatrix,di.spotLightMap.value=Lt.state.spotLightMap,di.pointShadowMap.value=Lt.state.pointShadowMap,di.pointShadowMatrix.value=Lt.state.pointShadowMatrix),ht.currentProgram=Wi,ht.uniformsList=null,Wi}function In(Be){if(Be.uniformsList===null){const Pt=Be.currentProgram.getUniforms();Be.uniformsList=mR.seqWithValue(Pt.seq,Be.uniforms)}return Be.uniformsList}function Gn(Be,Pt){const $t=it.get(Be);$t.outputColorSpace=Pt.outputColorSpace,$t.batching=Pt.batching,$t.batchingColor=Pt.batchingColor,$t.instancing=Pt.instancing,$t.instancingColor=Pt.instancingColor,$t.instancingMorph=Pt.instancingMorph,$t.skinning=Pt.skinning,$t.morphTargets=Pt.morphTargets,$t.morphNormals=Pt.morphNormals,$t.morphColors=Pt.morphColors,$t.morphTargetsCount=Pt.morphTargetsCount,$t.numClippingPlanes=Pt.numClippingPlanes,$t.numIntersection=Pt.numClipIntersection,$t.vertexAlphas=Pt.vertexAlphas,$t.vertexTangents=Pt.vertexTangents,$t.toneMapping=Pt.toneMapping}function Ci(Be,Pt,$t,ht,Lt){Pt.isScene!==!0&&(Pt=Kt),Le.resetTextureUnits();const An=Pt.fog,Dn=ht.isMeshStandardMaterial?Pt.environment:null,Xn=pe===null?q.outputColorSpace:pe.isXRRenderTarget===!0?pe.texture.colorSpace:H_,Yn=(ht.isMeshStandardMaterial?vt:Pe).get(ht.envMap||Dn),Si=ht.vertexColors===!0&&!!$t.attributes.color&&$t.attributes.color.itemSize===4,Wi=!!$t.attributes.tangent&&(!!ht.normalMap||ht.anisotropy>0),di=!!$t.morphAttributes.position,or=!!$t.morphAttributes.normal,Pr=!!$t.morphAttributes.color;let ji=Cf;ht.toneMapped&&(pe===null||pe.isXRRenderTarget===!0)&&(ji=q.toneMapping);const vr=$t.morphAttributes.position||$t.morphAttributes.normal||$t.morphAttributes.color,wr=vr!==void 0?vr.length:0,fi=it.get(ht),fs=P.state.lights;if(Ge===!0&&(He===!0||Be!==ue)){const Zr=Be===ue&&ht.id===fe;zn.setState(ht,Be,Zr)}let tr=!1;ht.version===fi.__version?(fi.needsLights&&fi.lightsStateVersion!==fs.state.version||fi.outputColorSpace!==Xn||Lt.isBatchedMesh&&fi.batching===!1||!Lt.isBatchedMesh&&fi.batching===!0||Lt.isBatchedMesh&&fi.batchingColor===!0&&Lt.colorTexture===null||Lt.isBatchedMesh&&fi.batchingColor===!1&&Lt.colorTexture!==null||Lt.isInstancedMesh&&fi.instancing===!1||!Lt.isInstancedMesh&&fi.instancing===!0||Lt.isSkinnedMesh&&fi.skinning===!1||!Lt.isSkinnedMesh&&fi.skinning===!0||Lt.isInstancedMesh&&fi.instancingColor===!0&&Lt.instanceColor===null||Lt.isInstancedMesh&&fi.instancingColor===!1&&Lt.instanceColor!==null||Lt.isInstancedMesh&&fi.instancingMorph===!0&&Lt.morphTexture===null||Lt.isInstancedMesh&&fi.instancingMorph===!1&&Lt.morphTexture!==null||fi.envMap!==Yn||ht.fog===!0&&fi.fog!==An||fi.numClippingPlanes!==void 0&&(fi.numClippingPlanes!==zn.numPlanes||fi.numIntersection!==zn.numIntersection)||fi.vertexAlphas!==Si||fi.vertexTangents!==Wi||fi.morphTargets!==di||fi.morphNormals!==or||fi.morphColors!==Pr||fi.toneMapping!==ji||fi.morphTargetsCount!==wr)&&(tr=!0):(tr=!0,fi.__version=ht.version);let Ss=fi.currentProgram;tr===!0&&(Ss=fn(ht,Pt,Lt));let is=!1,rs=!1,Yo=!1;const Qr=Ss.getUniforms(),Jo=fi.uniforms;if(xe.useProgram(Ss.program)&&(is=!0,rs=!0,Yo=!0),ht.id!==fe&&(fe=ht.id,rs=!0),is||ue!==Be){xe.buffers.depth.getReversed()?(De.copy(Be.projectionMatrix),YMe(De),JMe(De),Qr.setValue(_e,"projectionMatrix",De)):Qr.setValue(_e,"projectionMatrix",Be.projectionMatrix),Qr.setValue(_e,"viewMatrix",Be.matrixWorldInverse);const Wa=Qr.map.cameraPosition;Wa!==void 0&&Wa.setValue(_e,rn.setFromMatrixPosition(Be.matrixWorld)),tn.logarithmicDepthBuffer&&Qr.setValue(_e,"logDepthBufFC",2/(Math.log(Be.far+1)/Math.LN2)),(ht.isMeshPhongMaterial||ht.isMeshToonMaterial||ht.isMeshLambertMaterial||ht.isMeshBasicMaterial||ht.isMeshStandardMaterial||ht.isShaderMaterial)&&Qr.setValue(_e,"isOrthographic",Be.isOrthographicCamera===!0),ue!==Be&&(ue=Be,rs=!0,Yo=!0)}if(Lt.isSkinnedMesh){Qr.setOptional(_e,Lt,"bindMatrix"),Qr.setOptional(_e,Lt,"bindMatrixInverse");const Zr=Lt.skeleton;Zr&&(Zr.boneTexture===null&&Zr.computeBoneTexture(),Qr.setValue(_e,"boneTexture",Zr.boneTexture,Le))}Lt.isBatchedMesh&&(Qr.setOptional(_e,Lt,"batchingTexture"),Qr.setValue(_e,"batchingTexture",Lt._matricesTexture,Le),Qr.setOptional(_e,Lt,"batchingIdTexture"),Qr.setValue(_e,"batchingIdTexture",Lt._indirectTexture,Le),Qr.setOptional(_e,Lt,"batchingColorTexture"),Lt._colorsTexture!==null&&Qr.setValue(_e,"batchingColorTexture",Lt._colorsTexture,Le));const cc=$t.morphAttributes;if((cc.position!==void 0||cc.normal!==void 0||cc.color!==void 0)&&Ti.update(Lt,$t,Ss),(rs||fi.receiveShadow!==Lt.receiveShadow)&&(fi.receiveShadow=Lt.receiveShadow,Qr.setValue(_e,"receiveShadow",Lt.receiveShadow)),ht.isMeshGouraudMaterial&&ht.envMap!==null&&(Jo.envMap.value=Yn,Jo.flipEnvMap.value=Yn.isCubeTexture&&Yn.isRenderTargetTexture===!1?-1:1),ht.isMeshStandardMaterial&&ht.envMap===null&&Pt.environment!==null&&(Jo.envMapIntensity.value=Pt.environmentIntensity),rs&&(Qr.setValue(_e,"toneMappingExposure",q.toneMappingExposure),fi.needsLights&&Ri(Jo,Yo),An&&ht.fog===!0&&Bn.refreshFogUniforms(Jo,An),Bn.refreshMaterialUniforms(Jo,ht,Me,ft,P.state.transmissionRenderTarget[Be.id]),mR.upload(_e,In(fi),Jo,Le)),ht.isShaderMaterial&&ht.uniformsNeedUpdate===!0&&(mR.upload(_e,In(fi),Jo,Le),ht.uniformsNeedUpdate=!1),ht.isSpriteMaterial&&Qr.setValue(_e,"center",Lt.center),Qr.setValue(_e,"modelViewMatrix",Lt.modelViewMatrix),Qr.setValue(_e,"normalMatrix",Lt.normalMatrix),Qr.setValue(_e,"modelMatrix",Lt.matrixWorld),ht.isShaderMaterial||ht.isRawShaderMaterial){const Zr=ht.uniformsGroups;for(let Wa=0,El=Zr.length;Wa<El;Wa++){const dm=Zr[Wa];Wt.update(dm,Ss),Wt.bind(dm,Ss)}}return Ss}function Ri(Be,Pt){Be.ambientLightColor.needsUpdate=Pt,Be.lightProbe.needsUpdate=Pt,Be.directionalLights.needsUpdate=Pt,Be.directionalLightShadows.needsUpdate=Pt,Be.pointLights.needsUpdate=Pt,Be.pointLightShadows.needsUpdate=Pt,Be.spotLights.needsUpdate=Pt,Be.spotLightShadows.needsUpdate=Pt,Be.rectAreaLights.needsUpdate=Pt,Be.hemisphereLights.needsUpdate=Pt}function Mi(Be){return Be.isMeshLambertMaterial||Be.isMeshToonMaterial||Be.isMeshPhongMaterial||Be.isMeshStandardMaterial||Be.isShadowMaterial||Be.isShaderMaterial&&Be.lights===!0}this.getActiveCubeFace=function(){return ce},this.getActiveMipmapLevel=function(){return ae},this.getRenderTarget=function(){return pe},this.setRenderTargetTextures=function(Be,Pt,$t){it.get(Be.texture).__webglTexture=Pt,it.get(Be.depthTexture).__webglTexture=$t;const ht=it.get(Be);ht.__hasExternalTextures=!0,ht.__autoAllocateDepthBuffer=$t===void 0,ht.__autoAllocateDepthBuffer||Ot.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ht.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Be,Pt){const $t=it.get(Be);$t.__webglFramebuffer=Pt,$t.__useDefaultFramebuffer=Pt===void 0},this.setRenderTarget=function(Be,Pt=0,$t=0){pe=Be,ce=Pt,ae=$t;let ht=!0,Lt=null,An=!1,Dn=!1;if(Be){const Yn=it.get(Be);if(Yn.__useDefaultFramebuffer!==void 0)xe.bindFramebuffer(_e.FRAMEBUFFER,null),ht=!1;else if(Yn.__webglFramebuffer===void 0)Le.setupRenderTarget(Be);else if(Yn.__hasExternalTextures)Le.rebindTextures(Be,it.get(Be.texture).__webglTexture,it.get(Be.depthTexture).__webglTexture);else if(Be.depthBuffer){const di=Be.depthTexture;if(Yn.__boundDepthTexture!==di){if(di!==null&&it.has(di)&&(Be.width!==di.image.width||Be.height!==di.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Le.setupDepthRenderbuffer(Be)}}const Si=Be.texture;(Si.isData3DTexture||Si.isDataArrayTexture||Si.isCompressedArrayTexture)&&(Dn=!0);const Wi=it.get(Be).__webglFramebuffer;Be.isWebGLCubeRenderTarget?(Array.isArray(Wi[Pt])?Lt=Wi[Pt][$t]:Lt=Wi[Pt],An=!0):Be.samples>0&&Le.useMultisampledRTT(Be)===!1?Lt=it.get(Be).__webglMultisampledFramebuffer:Array.isArray(Wi)?Lt=Wi[$t]:Lt=Wi,Ee.copy(Be.viewport),We.copy(Be.scissor),rt=Be.scissorTest}else Ee.copy(Mt).multiplyScalar(Me).floor(),We.copy(Gt).multiplyScalar(Me).floor(),rt=Xt;if(xe.bindFramebuffer(_e.FRAMEBUFFER,Lt)&&ht&&xe.drawBuffers(Be,Lt),xe.viewport(Ee),xe.scissor(We),xe.setScissorTest(rt),An){const Yn=it.get(Be.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,Yn.__webglTexture,$t)}else if(Dn){const Yn=it.get(Be.texture),Si=Pt||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,Yn.__webglTexture,$t||0,Si)}fe=-1},this.readRenderTargetPixels=function(Be,Pt,$t,ht,Lt,An,Dn){if(!(Be&&Be.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Xn=it.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&Dn!==void 0&&(Xn=Xn[Dn]),Xn){xe.bindFramebuffer(_e.FRAMEBUFFER,Xn);try{const Yn=Be.texture,Si=Yn.format,Wi=Yn.type;if(!tn.textureFormatReadable(Si)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!tn.textureTypeReadable(Wi)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Pt>=0&&Pt<=Be.width-ht&&$t>=0&&$t<=Be.height-Lt&&_e.readPixels(Pt,$t,ht,Lt,er.convert(Si),er.convert(Wi),An)}finally{const Yn=pe!==null?it.get(pe).__webglFramebuffer:null;xe.bindFramebuffer(_e.FRAMEBUFFER,Yn)}}},this.readRenderTargetPixelsAsync=async function(Be,Pt,$t,ht,Lt,An,Dn){if(!(Be&&Be.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Xn=it.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&Dn!==void 0&&(Xn=Xn[Dn]),Xn){const Yn=Be.texture,Si=Yn.format,Wi=Yn.type;if(!tn.textureFormatReadable(Si))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!tn.textureTypeReadable(Wi))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Pt>=0&&Pt<=Be.width-ht&&$t>=0&&$t<=Be.height-Lt){xe.bindFramebuffer(_e.FRAMEBUFFER,Xn);const di=_e.createBuffer();_e.bindBuffer(_e.PIXEL_PACK_BUFFER,di),_e.bufferData(_e.PIXEL_PACK_BUFFER,An.byteLength,_e.STREAM_READ),_e.readPixels(Pt,$t,ht,Lt,er.convert(Si),er.convert(Wi),0);const or=pe!==null?it.get(pe).__webglFramebuffer:null;xe.bindFramebuffer(_e.FRAMEBUFFER,or);const Pr=_e.fenceSync(_e.SYNC_GPU_COMMANDS_COMPLETE,0);return _e.flush(),await KMe(_e,Pr,4),_e.bindBuffer(_e.PIXEL_PACK_BUFFER,di),_e.getBufferSubData(_e.PIXEL_PACK_BUFFER,0,An),_e.deleteBuffer(di),_e.deleteSync(Pr),An}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Be,Pt=null,$t=0){Be.isTexture!==!0&&(l1("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Pt=arguments[0]||null,Be=arguments[1]);const ht=Math.pow(2,-$t),Lt=Math.floor(Be.image.width*ht),An=Math.floor(Be.image.height*ht),Dn=Pt!==null?Pt.x:0,Xn=Pt!==null?Pt.y:0;Le.setTexture2D(Be,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,$t,0,0,Dn,Xn,Lt,An),xe.unbindTexture()},this.copyTextureToTexture=function(Be,Pt,$t=null,ht=null,Lt=0){Be.isTexture!==!0&&(l1("WebGLRenderer: copyTextureToTexture function signature has changed."),ht=arguments[0]||null,Be=arguments[1],Pt=arguments[2],Lt=arguments[3]||0,$t=null);let An,Dn,Xn,Yn,Si,Wi,di,or,Pr;const ji=Be.isCompressedTexture?Be.mipmaps[Lt]:Be.image;$t!==null?(An=$t.max.x-$t.min.x,Dn=$t.max.y-$t.min.y,Xn=$t.isBox3?$t.max.z-$t.min.z:1,Yn=$t.min.x,Si=$t.min.y,Wi=$t.isBox3?$t.min.z:0):(An=ji.width,Dn=ji.height,Xn=ji.depth||1,Yn=0,Si=0,Wi=0),ht!==null?(di=ht.x,or=ht.y,Pr=ht.z):(di=0,or=0,Pr=0);const vr=er.convert(Pt.format),wr=er.convert(Pt.type);let fi;Pt.isData3DTexture?(Le.setTexture3D(Pt,0),fi=_e.TEXTURE_3D):Pt.isDataArrayTexture||Pt.isCompressedArrayTexture?(Le.setTexture2DArray(Pt,0),fi=_e.TEXTURE_2D_ARRAY):(Le.setTexture2D(Pt,0),fi=_e.TEXTURE_2D),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,Pt.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pt.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,Pt.unpackAlignment);const fs=_e.getParameter(_e.UNPACK_ROW_LENGTH),tr=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),Ss=_e.getParameter(_e.UNPACK_SKIP_PIXELS),is=_e.getParameter(_e.UNPACK_SKIP_ROWS),rs=_e.getParameter(_e.UNPACK_SKIP_IMAGES);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,ji.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,ji.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,Yn),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,Si),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,Wi);const Yo=Be.isDataArrayTexture||Be.isData3DTexture,Qr=Pt.isDataArrayTexture||Pt.isData3DTexture;if(Be.isRenderTargetTexture||Be.isDepthTexture){const Jo=it.get(Be),cc=it.get(Pt),Zr=it.get(Jo.__renderTarget),Wa=it.get(cc.__renderTarget);xe.bindFramebuffer(_e.READ_FRAMEBUFFER,Zr.__webglFramebuffer),xe.bindFramebuffer(_e.DRAW_FRAMEBUFFER,Wa.__webglFramebuffer);for(let El=0;El<Xn;El++)Yo&&_e.framebufferTextureLayer(_e.READ_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,it.get(Be).__webglTexture,Lt,Wi+El),Be.isDepthTexture?(Qr&&_e.framebufferTextureLayer(_e.DRAW_FRAMEBUFFER,_e.COLOR_ATTACHMENT0,it.get(Pt).__webglTexture,Lt,Pr+El),_e.blitFramebuffer(Yn,Si,An,Dn,di,or,An,Dn,_e.DEPTH_BUFFER_BIT,_e.NEAREST)):Qr?_e.copyTexSubImage3D(fi,Lt,di,or,Pr+El,Yn,Si,An,Dn):_e.copyTexSubImage2D(fi,Lt,di,or,Pr+El,Yn,Si,An,Dn);xe.bindFramebuffer(_e.READ_FRAMEBUFFER,null),xe.bindFramebuffer(_e.DRAW_FRAMEBUFFER,null)}else Qr?Be.isDataTexture||Be.isData3DTexture?_e.texSubImage3D(fi,Lt,di,or,Pr,An,Dn,Xn,vr,wr,ji.data):Pt.isCompressedArrayTexture?_e.compressedTexSubImage3D(fi,Lt,di,or,Pr,An,Dn,Xn,vr,ji.data):_e.texSubImage3D(fi,Lt,di,or,Pr,An,Dn,Xn,vr,wr,ji):Be.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,Lt,di,or,An,Dn,vr,wr,ji.data):Be.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,Lt,di,or,ji.width,ji.height,vr,ji.data):_e.texSubImage2D(_e.TEXTURE_2D,Lt,di,or,An,Dn,vr,wr,ji);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,fs),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,tr),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,Ss),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,is),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,rs),Lt===0&&Pt.generateMipmaps&&_e.generateMipmap(fi),xe.unbindTexture()},this.copyTextureToTexture3D=function(Be,Pt,$t=null,ht=null,Lt=0){return Be.isTexture!==!0&&(l1("WebGLRenderer: copyTextureToTexture3D function signature has changed."),$t=arguments[0]||null,ht=arguments[1]||null,Be=arguments[2],Pt=arguments[3],Lt=arguments[4]||0),l1('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Be,Pt,$t,ht,Lt)},this.initRenderTarget=function(Be){it.get(Be).__webglFramebuffer===void 0&&Le.setupRenderTarget(Be)},this.initTexture=function(Be){Be.isCubeTexture?Le.setTextureCube(Be,0):Be.isData3DTexture?Le.setTexture3D(Be,0):Be.isDataArrayTexture||Be.isCompressedArrayTexture?Le.setTexture2DArray(Be,0):Le.setTexture2D(Be,0),xe.unbindTexture()},this.resetState=function(){ce=0,ae=0,pe=null,xe.reset(),vi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return yf}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorspace=ls._getDrawingBufferColorSpace(e),n.unpackColorSpace=ls._getUnpackColorSpace()}}class tP{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new bi(e),this.density=n}clone(){return new tP(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class nP{constructor(e,n=1,i=1e3){this.isFog=!0,this.name="",this.color=new bi(e),this.near=n,this.far=i}clone(){return new nP(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class _S extends Cs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new nc,this.environmentIntensity=1,this.environmentRotation=new nc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class iP{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=gS,this.updateRanges=[],this.version=0,this.uuid=xu()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=n.array[i+r];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Vl=new gt;class T_{constructor(e,n,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)Vl.fromBufferAttribute(this,n),Vl.applyMatrix4(e),this.setXYZ(n,Vl.x,Vl.y,Vl.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Vl.fromBufferAttribute(this,n),Vl.applyNormalMatrix(e),this.setXYZ(n,Vl.x,Vl.y,Vl.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Vl.fromBufferAttribute(this,n),Vl.transformDirection(e),this.setXYZ(n,Vl.x,Vl.y,Vl.z);return this}getComponent(e,n){let i=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(i=Zl(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=Fr(i,this.array)),this.data.array[e*this.data.stride+this.offset+n]=i,this}setX(e,n){return this.normalized&&(n=Fr(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=Fr(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=Fr(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=Fr(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=Zl(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=Zl(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=Zl(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=Zl(n,this.array)),n}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,n,i,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(n=Fr(n,this.array),i=Fr(i,this.array),r=Fr(r,this.array),o=Fr(o,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)n.push(this.data.array[r+o])}return new ns(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new T_(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)n.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class GB extends nl{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new bi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let H0;const WC=new gt,W0=new gt,j0=new gt,$0=new Cn,jC=new Cn,FY=new Hi,pM=new gt,$C=new gt,mM=new gt,$6=new Cn,M2=new Cn,q6=new Cn;class LY extends Cs{constructor(e=new GB){if(super(),this.isSprite=!0,this.type="Sprite",H0===void 0){H0=new Cr;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new iP(n,5);H0.setIndex([0,1,2,0,2,3]),H0.setAttribute("position",new T_(i,3,0,!1)),H0.setAttribute("uv",new T_(i,2,3,!1))}this.geometry=H0,this.material=e,this.center=new Cn(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),W0.setFromMatrixScale(this.matrixWorld),FY.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),j0.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&W0.multiplyScalar(-j0.z);const i=this.material.rotation;let r,o;i!==0&&(o=Math.cos(i),r=Math.sin(i));const c=this.center;gM(pM.set(-.5,-.5,0),j0,c,W0,r,o),gM($C.set(.5,-.5,0),j0,c,W0,r,o),gM(mM.set(.5,.5,0),j0,c,W0,r,o),$6.set(0,0),M2.set(1,0),q6.set(1,1);let s=e.ray.intersectTriangle(pM,$C,mM,!1,WC);if(s===null&&(gM($C.set(-.5,.5,0),j0,c,W0,r,o),M2.set(0,1),s=e.ray.intersectTriangle(pM,mM,$C,!1,WC),s===null))return;const f=e.ray.origin.distanceTo(WC);f<e.near||f>e.far||n.push({distance:f,point:WC.clone(),uv:Fc.getInterpolation(WC,pM,$C,mM,$6,M2,q6,new Cn),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function gM(t,e,n,i,r,o){$0.subVectors(t,n).addScalar(.5).multiply(i),r!==void 0?(jC.x=o*$0.x-r*$0.y,jC.y=r*$0.x+o*$0.y):jC.copy($0),t.copy(e),t.x+=jC.x,t.y+=jC.y,t.applyMatrix4(FY)}const vM=new gt,Z6=new gt;class OY extends Cs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,i=0){n=Math.abs(n);const r=this.levels;let o;for(o=0;o<r.length&&!(n<r[o].distance);o++);return r.splice(o,0,{distance:n,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const n=this.levels;for(let i=0;i<n.length;i++)if(n[i].distance===e){const r=n.splice(i,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let i,r;for(i=1,r=n.length;i<r;i++){let o=n[i].distance;if(n[i].object.visible&&(o-=o*n[i].hysteresis),e<o)break}return n[i-1].object}return null}raycast(e,n){if(this.levels.length>0){vM.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(vM);this.getObjectForDistance(r).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){vM.setFromMatrixPosition(e.matrixWorld),Z6.setFromMatrixPosition(this.matrixWorld);const i=vM.distanceTo(Z6)/e.zoom;n[0].object.visible=!0;let r,o;for(r=1,o=n.length;r<o;r++){let c=n[r].distance;if(n[r].object.visible&&(c-=c*n[r].hysteresis),i>=c)n[r-1].object.visible=!1,n[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<o;r++)n[r].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const i=this.levels;for(let r=0,o=i.length;r<o;r++){const c=i[r];n.object.levels.push({object:c.object.uuid,distance:c.distance,hysteresis:c.hysteresis})}return n}}const X6=new gt,K6=new xs,Y6=new xs,hDe=new gt,J6=new Hi,yM=new gt,R2=new Sl,Q6=new Hi,T2=new Nw;class kY extends va{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Uk,this.bindMatrix=new Hi,this.bindMatrixInverse=new Hi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ql),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,yM),this.boundingBox.expandByPoint(yM)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sl),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,yM),this.boundingSphere.expandByPoint(yM)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),R2.copy(this.boundingSphere),R2.applyMatrix4(r),e.ray.intersectsSphere(R2)!==!1&&(Q6.copy(r).invert(),T2.copy(e.ray).applyMatrix4(Q6),!(this.boundingBox!==null&&T2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,T2)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new xs,n=this.geometry.attributes.skinWeight;for(let i=0,r=n.count;i<r;i++){e.fromBufferAttribute(n,i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Uk?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===nY?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const i=this.skeleton,r=this.geometry;K6.fromBufferAttribute(r.attributes.skinIndex,e),Y6.fromBufferAttribute(r.attributes.skinWeight,e),X6.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let o=0;o<4;o++){const c=Y6.getComponent(o);if(c!==0){const s=K6.getComponent(o);J6.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),n.addScaledVector(hDe.copy(X6).applyMatrix4(J6),c)}}return n.applyMatrix4(this.bindMatrixInverse)}}class HB extends Cs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sf extends Oo{constructor(e=null,n=1,i=1,r,o,c,s,f,v=el,w=el,C,M){super(null,c,s,f,v,w,r,o,C,M),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const eW=new Hi,dDe=new Hi;class rP{constructor(e=[],n=[]){this.uuid=xu(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Hi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const i=new Hi;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let o=0,c=e.length;o<c;o++){const s=e[o]?e[o].matrixWorld:dDe;eW.multiplyMatrices(s,n[o]),eW.toArray(i,o*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new rP(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const i=new Sf(n,e,e,wl,kc);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){const r=this.bones[n];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const o=e.bones[i];let c=n[o];c===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),c=new HB),this.bones.push(c),this.boneInverses.push(new Hi().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let r=0,o=n.length;r<o;r++){const c=n[r];e.bones.push(c.uuid);const s=i[r];e.boneInverses.push(s.toArray())}return e}}class uw extends ns{constructor(e,n,i,r=1){super(e,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const q0=new Hi,tW=new Hi,_M=[],nW=new Ql,fDe=new Hi,qC=new va,ZC=new Sl;class NY extends va{constructor(e,n,i){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new uw(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,fDe)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new Ql),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,q0),nW.copy(e.boundingBox).applyMatrix4(q0),this.boundingBox.union(nW)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sl),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,q0),ZC.copy(e.boundingSphere).applyMatrix4(q0),this.boundingSphere.union(ZC)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const i=n.morphTargetInfluences,r=this.morphTexture.source.data.data,o=i.length+1,c=e*o+1;for(let s=0;s<i.length;s++)i[s]=r[c+s]}raycast(e,n){const i=this.matrixWorld,r=this.count;if(qC.geometry=this.geometry,qC.material=this.material,qC.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ZC.copy(this.boundingSphere),ZC.applyMatrix4(i),e.ray.intersectsSphere(ZC)!==!1))for(let o=0;o<r;o++){this.getMatrixAt(o,q0),tW.multiplyMatrices(i,q0),qC.matrixWorld=tW,qC.raycast(e,_M);for(let c=0,s=_M.length;c<s;c++){const f=_M[c];f.instanceId=o,f.object=this,n.push(f)}_M.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new uw(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const i=n.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new Sf(new Float32Array(r*this.count),r,this.count,XA,kc));const o=this.morphTexture.source.data.data;let c=0;for(let v=0;v<i.length;v++)c+=i[v];const s=this.geometry.morphTargetsRelative?1:1-c,f=r*e;o[f]=s,o.set(i,f+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function A2(t,e){return t-e}function pDe(t,e){return t.z-e.z}function mDe(t,e){return e.z-t.z}class gDe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,n,i,r){const o=this.pool,c=this.list;this.index>=o.length&&o.push({start:-1,count:-1,z:-1,index:-1});const s=o[this.index];c.push(s),this.index++,s.start=e,s.count=n,s.z=i,s.index=r}reset(){this.list.length=0,this.index=0}}const Rc=new Hi,vDe=new bi(1,1,1),P2=new ub,xM=new Ql,yy=new Sl,XC=new gt,iW=new gt,yDe=new gt,I2=new gDe,gl=new va,wM=[];function _De(t,e,n=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let o=0;o<r;o++)for(let c=0;c<i;c++)e.setComponent(o+n,c,t.getComponent(o,c))}else e.array.set(t.array,n*i);e.needsUpdate=!0}function _y(t,e){if(t.constructor!==e.constructor){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++)e[i]=t[i]}else{const n=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,n))}}class BY extends va{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,n,i=n*2,r){super(new Cr,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=n,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4),i=new Sf(n,e,e,wl,kc);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Uint32Array(e*e),i=new Sf(n,e,e,ob,sm);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Float32Array(e*e*4).fill(1),i=new Sf(n,e,e,wl,kc);i.colorSpace=ls.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const n=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const c=e.getAttribute(o),{array:s,itemSize:f,normalized:v}=c,w=new s.constructor(i*f),C=new ns(w,f,v);n.setAttribute(o,C)}if(e.getIndex()!==null){const o=i>65535?new Uint32Array(r):new Uint16Array(r);n.setIndex(new ns(o,1))}this._geometryInitialized=!0}}_validateGeometry(e){const n=this.geometry;if(!!e.getIndex()!=!!n.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in n.attributes){if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=e.getAttribute(i),o=n.getAttribute(i);if(r.itemSize!==o.itemSize||r.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ql);const e=this.boundingBox,n=this._instanceInfo;e.makeEmpty();for(let i=0,r=n.length;i<r;i++){if(n[i].active===!1)continue;const o=n[i].geometryIndex;this.getMatrixAt(i,Rc),this.getBoundingBoxAt(o,xM).applyMatrix4(Rc),e.union(xM)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sl);const e=this.boundingSphere,n=this._instanceInfo;e.makeEmpty();for(let i=0,r=n.length;i<r;i++){if(n[i].active===!1)continue;const o=n[i].geometryIndex;this.getMatrixAt(i,Rc),this.getBoundingSphereAt(o,yy).applyMatrix4(Rc),e.union(yy)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(A2),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=i):(r=this._instanceInfo.length,this._instanceInfo.push(i));const o=this._matricesTexture;Rc.identity().toArray(o.image.data,r*16),o.needsUpdate=!0;const c=this._colorsTexture;return c&&(vDe.toArray(c.image.data,r*4),c.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,n=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},o=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=n===-1?e.getAttribute("position").count:n;const c=e.getIndex();if(c!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=i===-1?c.count:i),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let f;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(A2),f=this._availableGeometryIds.shift(),o[f]=r):(f=this._geometryCount,this._geometryCount++,o.push(r)),this.setGeometryAt(f,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,f}setGeometryAt(e,n){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(n);const i=this.geometry,r=i.getIndex()!==null,o=i.getIndex(),c=n.getIndex(),s=this._geometryInfo[e];if(r&&c.count>s.reservedIndexCount||n.attributes.position.count>s.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const f=s.vertexStart,v=s.reservedVertexCount;s.vertexCount=n.getAttribute("position").count;for(const w in i.attributes){const C=n.getAttribute(w),M=i.getAttribute(w);_De(C,M,f);const F=C.itemSize;for(let N=C.count,z=v;N<z;N++){const L=f+N;for(let P=0;P<F;P++)M.setComponent(L,P,0)}M.needsUpdate=!0,M.addUpdateRange(f*F,v*F)}if(r){const w=s.indexStart,C=s.reservedIndexCount;s.indexCount=n.getIndex().count;for(let M=0;M<c.count;M++)o.setX(w+M,f+c.getX(M));for(let M=c.count,F=C;M<F;M++)o.setX(w+M,f);o.needsUpdate=!0,o.addUpdateRange(w,s.reservedIndexCount)}return s.start=r?s.indexStart:s.vertexStart,s.count=r?s.indexCount:s.vertexCount,s.boundingBox=null,n.boundingBox!==null&&(s.boundingBox=n.boundingBox.clone()),s.boundingSphere=null,n.boundingSphere!==null&&(s.boundingSphere=n.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const n=this._geometryInfo;if(e>=n.length||n[e].active===!1)return this;const i=this._instanceInfo;for(let r=0,o=i.length;r<o;r++)i[r].geometryIndex===e&&this.deleteInstance(r);return n[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){const n=this._instanceInfo;return e>=n.length||n[e].active===!1?this:(n[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}optimize(){let e=0,n=0;const i=this._geometryInfo,r=i.map((c,s)=>s).sort((c,s)=>i[c].vertexStart-i[s].vertexStart),o=this.geometry;for(let c=0,s=i.length;c<s;c++){const f=r[c],v=i[f];if(v.active!==!1){if(o.index!==null){if(v.indexStart!==n){const{indexStart:w,vertexStart:C,reservedIndexCount:M}=v,F=o.index,N=F.array,z=e-C;for(let L=w;L<w+M;L++)N[L]=N[L]+z;F.array.copyWithin(n,w,w+M),F.addUpdateRange(n,M),v.indexStart=n}n+=v.reservedIndexCount}if(v.vertexStart!==e){const{vertexStart:w,reservedVertexCount:C}=v,M=o.attributes;for(const F in M){const N=M[F],{array:z,itemSize:L}=N;z.copyWithin(e*L,w*L,(w+C)*L),N.addUpdateRange(e*L,C*L)}v.vertexStart=e}e+=v.reservedVertexCount,v.start=o.index?v.indexStart:v.vertexStart,this._nextIndexStart=o.index?v.indexStart+v.reservedIndexCount:0,this._nextVertexStart=v.vertexStart+v.reservedVertexCount}}return this}getBoundingBoxAt(e,n){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const o=new Ql,c=i.index,s=i.attributes.position;for(let f=r.start,v=r.start+r.count;f<v;f++){let w=f;c&&(w=c.getX(w)),o.expandByPoint(XC.fromBufferAttribute(s,w))}r.boundingBox=o}return n.copy(r.boundingBox),n}getBoundingSphereAt(e,n){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const o=new Sl;this.getBoundingBoxAt(e,xM),xM.getCenter(o.center);const c=i.index,s=i.attributes.position;let f=0;for(let v=r.start,w=r.start+r.count;v<w;v++){let C=v;c&&(C=c.getX(C)),XC.fromBufferAttribute(s,C),f=Math.max(f,o.center.distanceToSquared(XC))}o.radius=Math.sqrt(f),r.boundingSphere=o}return n.copy(r.boundingSphere),n}setMatrixAt(e,n){const i=this._instanceInfo,r=this._matricesTexture,o=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?this:(n.toArray(o,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,n){const i=this._instanceInfo,r=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?null:n.fromArray(r,e*16)}setColorAt(e,n){this._colorsTexture===null&&this._initColorsTexture();const i=this._colorsTexture,r=this._colorsTexture.image.data,o=this._instanceInfo;return e>=o.length||o[e].active===!1?this:(n.toArray(r,e*4),i.needsUpdate=!0,this)}getColorAt(e,n){const i=this._colorsTexture.image.data,r=this._instanceInfo;return e>=r.length||r[e].active===!1?null:n.fromArray(i,e*4)}setVisibleAt(e,n){const i=this._instanceInfo;return e>=i.length||i[e].active===!1||i[e].visible===n?this:(i[e].visible=n,this._visibilityChanged=!0,this)}getVisibleAt(e){const n=this._instanceInfo;return e>=n.length||n[e].active===!1?!1:n[e].visible}setGeometryIdAt(e,n){const i=this._instanceInfo,r=this._geometryInfo;return e>=i.length||i[e].active===!1||n>=r.length||r[n].active===!1?null:(i[e].geometryIndex=n,this)}getGeometryIdAt(e){const n=this._instanceInfo;return e>=n.length||n[e].active===!1?-1:n[e].geometryIndex}getGeometryRangeAt(e,n={}){if(e<0||e>=this._geometryCount)return null;const i=this._geometryInfo[e];return n.vertexStart=i.vertexStart,n.vertexCount=i.vertexCount,n.reservedVertexCount=i.reservedVertexCount,n.indexStart=i.indexStart,n.indexCount=i.indexCount,n.reservedIndexCount=i.reservedIndexCount,n.start=i.start,n.count=i.count,n}setInstanceCount(e){const n=this._availableInstanceIds,i=this._instanceInfo;for(n.sort(A2);n[n.length-1]===i.length;)i.pop(),n.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),o=new Int32Array(e);_y(this._multiDrawCounts,r),_y(this._multiDrawStarts,o),this._multiDrawCounts=r,this._multiDrawStarts=o,this._maxInstanceCount=e;const c=this._indirectTexture,s=this._matricesTexture,f=this._colorsTexture;c.dispose(),this._initIndirectTexture(),_y(c.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),_y(s.image.data,this._matricesTexture.image.data),f&&(f.dispose(),this._initColorsTexture(),_y(f.image.data,this._colorsTexture.image.data))}setGeometrySize(e,n){const i=[...this._geometryInfo].filter(s=>s.active);if(Math.max(...i.map(s=>s.vertexStart+s.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${n}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(f=>f.indexStart+f.reservedIndexCount))>n)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${n}. Cannot shrink further.`);const o=this.geometry;o.dispose(),this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Cr,this._initializeGeometry(o));const c=this.geometry;o.index&&_y(o.index.array,c.index.array);for(const s in o.attributes)_y(o.attributes[s].array,c.attributes[s].array)}raycast(e,n){const i=this._instanceInfo,r=this._geometryInfo,o=this.matrixWorld,c=this.geometry;gl.material=this.material,gl.geometry.index=c.index,gl.geometry.attributes=c.attributes,gl.geometry.boundingBox===null&&(gl.geometry.boundingBox=new Ql),gl.geometry.boundingSphere===null&&(gl.geometry.boundingSphere=new Sl);for(let s=0,f=i.length;s<f;s++){if(!i[s].visible||!i[s].active)continue;const v=i[s].geometryIndex,w=r[v];gl.geometry.setDrawRange(w.start,w.count),this.getMatrixAt(s,gl.matrixWorld).premultiply(o),this.getBoundingBoxAt(v,gl.geometry.boundingBox),this.getBoundingSphereAt(v,gl.geometry.boundingSphere),gl.raycast(e,wM);for(let C=0,M=wM.length;C<M;C++){const F=wM[C];F.object=this,F.batchId=s,n.push(F)}wM.length=0}gl.material=null,gl.geometry.index=null,gl.geometry.attributes={},gl.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(n=>({...n,boundingBox:n.boundingBox!==null?n.boundingBox.clone():null,boundingSphere:n.boundingSphere!==null?n.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(n=>({...n})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,n,i,r,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const c=r.getIndex(),s=c===null?1:c.array.BYTES_PER_ELEMENT,f=this._instanceInfo,v=this._multiDrawStarts,w=this._multiDrawCounts,C=this._geometryInfo,M=this.perObjectFrustumCulled,F=this._indirectTexture,N=F.image.data;M&&(Rc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),P2.setFromProjectionMatrix(Rc,e.coordinateSystem));let z=0;if(this.sortObjects){Rc.copy(this.matrixWorld).invert(),XC.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Rc),iW.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Rc);for(let H=0,j=f.length;H<j;H++)if(f[H].visible&&f[H].active){const q=f[H].geometryIndex;this.getMatrixAt(H,Rc),this.getBoundingSphereAt(q,yy).applyMatrix4(Rc);let le=!1;if(M&&(le=!P2.intersectsSphere(yy)),!le){const ce=C[q],ae=yDe.subVectors(yy.center,XC).dot(iW);I2.push(ce.start,ce.count,ae,H)}}const L=I2.list,P=this.customSort;P===null?L.sort(o.transparent?mDe:pDe):P.call(this,L,i);for(let H=0,j=L.length;H<j;H++){const q=L[H];v[z]=q.start*s,w[z]=q.count,N[z]=q.index,z++}I2.reset()}else for(let L=0,P=f.length;L<P;L++)if(f[L].visible&&f[L].active){const H=f[L].geometryIndex;let j=!1;if(M&&(this.getMatrixAt(L,Rc),this.getBoundingSphereAt(H,yy).applyMatrix4(Rc),j=!P2.intersectsSphere(yy)),!j){const q=C[H];v[z]=q.start*s,w[z]=q.count,N[z]=L,z++}}F.needsUpdate=!0,this._multiDrawCount=z,this._visibilityChanged=!1}onBeforeShadow(e,n,i,r,o,c){this.onBeforeRender(e,null,r,o,c)}}class ac extends nl{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new bi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const nA=new gt,iA=new gt,rW=new Hi,KC=new Nw,CM=new Sl,D2=new gt,sW=new gt;class fv extends Cs{constructor(e=new Cr,n=new ac){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[0];for(let r=1,o=n.count;r<o;r++)nA.fromBufferAttribute(n,r-1),iA.fromBufferAttribute(n,r),i[r]=i[r-1],i[r]+=nA.distanceTo(iA);e.setAttribute("lineDistance",new Ni(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),CM.copy(i.boundingSphere),CM.applyMatrix4(r),CM.radius+=o,e.ray.intersectsSphere(CM)===!1)return;rW.copy(r).invert(),KC.copy(e.ray).applyMatrix4(rW);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=s*s,v=this.isLineSegments?2:1,w=i.index,M=i.attributes.position;if(w!==null){const F=Math.max(0,c.start),N=Math.min(w.count,c.start+c.count);for(let z=F,L=N-1;z<L;z+=v){const P=w.getX(z),H=w.getX(z+1),j=SM(this,e,KC,f,P,H);j&&n.push(j)}if(this.isLineLoop){const z=w.getX(N-1),L=w.getX(F),P=SM(this,e,KC,f,z,L);P&&n.push(P)}}else{const F=Math.max(0,c.start),N=Math.min(M.count,c.start+c.count);for(let z=F,L=N-1;z<L;z+=v){const P=SM(this,e,KC,f,z,z+1);P&&n.push(P)}if(this.isLineLoop){const z=SM(this,e,KC,f,N-1,F);z&&n.push(z)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}}function SM(t,e,n,i,r,o){const c=t.geometry.attributes.position;if(nA.fromBufferAttribute(c,r),iA.fromBufferAttribute(c,o),n.distanceSqToSegment(nA,iA,D2,sW)>i)return;D2.applyMatrix4(t.matrixWorld);const f=e.ray.origin.distanceTo(D2);if(!(f<e.near||f>e.far))return{distance:f,point:sW.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:t}}const oW=new gt,aW=new gt;class If extends fv{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[];for(let r=0,o=n.count;r<o;r+=2)oW.fromBufferAttribute(n,r),aW.fromBufferAttribute(n,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+oW.distanceTo(aW);e.setAttribute("lineDistance",new Ni(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class zY extends fv{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class WB extends nl{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new bi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const lW=new Hi,$k=new Nw,bM=new Sl,EM=new gt;class UY extends Cs{constructor(e=new Cr,n=new WB){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),bM.copy(i.boundingSphere),bM.applyMatrix4(r),bM.radius+=o,e.ray.intersectsSphere(bM)===!1)return;lW.copy(r).invert(),$k.copy(e.ray).applyMatrix4(lW);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=s*s,v=i.index,C=i.attributes.position;if(v!==null){const M=Math.max(0,c.start),F=Math.min(v.count,c.start+c.count);for(let N=M,z=F;N<z;N++){const L=v.getX(N);EM.fromBufferAttribute(C,L),cW(EM,L,f,r,e,n,this)}}else{const M=Math.max(0,c.start),F=Math.min(C.count,c.start+c.count);for(let N=M,z=F;N<z;N++)EM.fromBufferAttribute(C,N),cW(EM,N,f,r,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}}function cW(t,e,n,i,r,o,c){const s=$k.distanceSqToPoint(t);if(s<n){const f=new gt;$k.closestPointToPoint(t,f),f.applyMatrix4(i);const v=r.ray.origin.distanceTo(f);if(v<r.near||v>r.far)return;o.push({distance:v,distanceToRay:Math.sqrt(s),point:f,index:e,face:null,faceIndex:null,barycoord:null,object:c})}}class xDe extends Oo{constructor(e,n,i,r,o,c,s,f,v){super(e,n,i,r,o,c,s,f,v),this.isVideoTexture=!0,this.minFilter=c!==void 0?c:Ma,this.magFilter=o!==void 0?o:Ma,this.generateMipmaps=!1;const w=this;function C(){w.needsUpdate=!0,e.requestVideoFrameCallback(C)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(C)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class wDe extends Oo{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=el,this.minFilter=el,this.generateMipmaps=!1,this.needsUpdate=!0}}class sP extends Oo{constructor(e,n,i,r,o,c,s,f,v,w,C,M){super(null,c,s,f,v,w,r,o,C,M),this.isCompressedTexture=!0,this.image={width:n,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class CDe extends sP{constructor(e,n,i,r,o,c){super(e,n,i,o,c),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Yu,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class SDe extends sP{constructor(e,n,i){super(void 0,e[0].width,e[0].height,n,i,rm),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class bDe extends Oo{constructor(e,n,i,r,o,c,s,f,v){super(e,n,i,r,o,c,s,f,v),this.isCanvasTexture=!0,this.needsUpdate=!0}}class yd{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,r=this.getPoint(0),o=0;n.push(0);for(let c=1;c<=e;c++)i=this.getPoint(c/e),o+=i.distanceTo(r),n.push(o),r=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const i=this.getLengths();let r=0;const o=i.length;let c;n?c=n:c=e*i[o-1];let s=0,f=o-1,v;for(;s<=f;)if(r=Math.floor(s+(f-s)/2),v=i[r]-c,v<0)s=r+1;else if(v>0)f=r-1;else{f=r;break}if(r=f,i[r]===c)return r/(o-1);const w=i[r],M=i[r+1]-w,F=(c-w)/M;return(r+F)/(o-1)}getTangent(e,n){let r=e-1e-4,o=e+1e-4;r<0&&(r=0),o>1&&(o=1);const c=this.getPoint(r),s=this.getPoint(o),f=n||(c.isVector2?new Cn:new gt);return f.copy(s).sub(c).normalize(),f}getTangentAt(e,n){const i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){const i=new gt,r=[],o=[],c=[],s=new gt,f=new Hi;for(let F=0;F<=e;F++){const N=F/e;r[F]=this.getTangentAt(N,new gt)}o[0]=new gt,c[0]=new gt;let v=Number.MAX_VALUE;const w=Math.abs(r[0].x),C=Math.abs(r[0].y),M=Math.abs(r[0].z);w<=v&&(v=w,i.set(1,0,0)),C<=v&&(v=C,i.set(0,1,0)),M<=v&&i.set(0,0,1),s.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],s),c[0].crossVectors(r[0],o[0]);for(let F=1;F<=e;F++){if(o[F]=o[F-1].clone(),c[F]=c[F-1].clone(),s.crossVectors(r[F-1],r[F]),s.length()>Number.EPSILON){s.normalize();const N=Math.acos(Xo(r[F-1].dot(r[F]),-1,1));o[F].applyMatrix4(f.makeRotationAxis(s,N))}c[F].crossVectors(r[F],o[F])}if(n===!0){let F=Math.acos(Xo(o[0].dot(o[e]),-1,1));F/=e,r[0].dot(s.crossVectors(o[0],o[e]))>0&&(F=-F);for(let N=1;N<=e;N++)o[N].applyMatrix4(f.makeRotationAxis(r[N],F*N)),c[N].crossVectors(r[N],o[N])}return{tangents:r,normals:o,binormals:c}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class oP extends yd{constructor(e=0,n=0,i=1,r=1,o=0,c=Math.PI*2,s=!1,f=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=i,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=c,this.aClockwise=s,this.aRotation=f}getPoint(e,n=new Cn){const i=n,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const c=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(c?o=0:o=r),this.aClockwise===!0&&!c&&(o===r?o=-r:o=o-r);const s=this.aStartAngle+e*o;let f=this.aX+this.xRadius*Math.cos(s),v=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const w=Math.cos(this.aRotation),C=Math.sin(this.aRotation),M=f-this.aX,F=v-this.aY;f=M*w-F*C+this.aX,v=M*C+F*w+this.aY}return i.set(f,v)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class VY extends oP{constructor(e,n,i,r,o,c){super(e,n,i,i,r,o,c),this.isArcCurve=!0,this.type="ArcCurve"}}function jB(){let t=0,e=0,n=0,i=0;function r(o,c,s,f){t=o,e=s,n=-3*o+3*c-2*s-f,i=2*o-2*c+s+f}return{initCatmullRom:function(o,c,s,f,v){r(c,s,v*(s-o),v*(f-c))},initNonuniformCatmullRom:function(o,c,s,f,v,w,C){let M=(c-o)/v-(s-o)/(v+w)+(s-c)/w,F=(s-c)/w-(f-c)/(w+C)+(f-s)/C;M*=w,F*=w,r(c,s,M,F)},calc:function(o){const c=o*o,s=c*o;return t+e*o+n*c+i*s}}}const MM=new gt,F2=new jB,L2=new jB,O2=new jB;class GY extends yd{constructor(e=[],n=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=i,this.tension=r}getPoint(e,n=new gt){const i=n,r=this.points,o=r.length,c=(o-(this.closed?0:1))*e;let s=Math.floor(c),f=c-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:f===0&&s===o-1&&(s=o-2,f=1);let v,w;this.closed||s>0?v=r[(s-1)%o]:(MM.subVectors(r[0],r[1]).add(r[0]),v=MM);const C=r[s%o],M=r[(s+1)%o];if(this.closed||s+2<o?w=r[(s+2)%o]:(MM.subVectors(r[o-1],r[o-2]).add(r[o-1]),w=MM),this.curveType==="centripetal"||this.curveType==="chordal"){const F=this.curveType==="chordal"?.5:.25;let N=Math.pow(v.distanceToSquared(C),F),z=Math.pow(C.distanceToSquared(M),F),L=Math.pow(M.distanceToSquared(w),F);z<1e-4&&(z=1),N<1e-4&&(N=z),L<1e-4&&(L=z),F2.initNonuniformCatmullRom(v.x,C.x,M.x,w.x,N,z,L),L2.initNonuniformCatmullRom(v.y,C.y,M.y,w.y,N,z,L),O2.initNonuniformCatmullRom(v.z,C.z,M.z,w.z,N,z,L)}else this.curveType==="catmullrom"&&(F2.initCatmullRom(v.x,C.x,M.x,w.x,this.tension),L2.initCatmullRom(v.y,C.y,M.y,w.y,this.tension),O2.initCatmullRom(v.z,C.z,M.z,w.z,this.tension));return i.set(F2.calc(f),L2.calc(f),O2.calc(f)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const r=this.points[n];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(new gt().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function uW(t,e,n,i,r){const o=(i-e)*.5,c=(r-n)*.5,s=t*t,f=t*s;return(2*n-2*i+o+c)*f+(-3*n+3*i-2*o-c)*s+o*t+n}function EDe(t,e){const n=1-t;return n*n*e}function MDe(t,e){return 2*(1-t)*t*e}function RDe(t,e){return t*t*e}function L1(t,e,n,i){return EDe(t,e)+MDe(t,n)+RDe(t,i)}function TDe(t,e){const n=1-t;return n*n*n*e}function ADe(t,e){const n=1-t;return 3*n*n*t*e}function PDe(t,e){return 3*(1-t)*t*t*e}function IDe(t,e){return t*t*t*e}function O1(t,e,n,i,r){return TDe(t,e)+ADe(t,n)+PDe(t,i)+IDe(t,r)}class $B extends yd{constructor(e=new Cn,n=new Cn,i=new Cn,r=new Cn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=i,this.v3=r}getPoint(e,n=new Cn){const i=n,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(O1(e,r.x,o.x,c.x,s.x),O1(e,r.y,o.y,c.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class HY extends yd{constructor(e=new gt,n=new gt,i=new gt,r=new gt){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=i,this.v3=r}getPoint(e,n=new gt){const i=n,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(O1(e,r.x,o.x,c.x,s.x),O1(e,r.y,o.y,c.y,s.y),O1(e,r.z,o.z,c.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class qB extends yd{constructor(e=new Cn,n=new Cn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new Cn){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new Cn){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class WY extends yd{constructor(e=new gt,n=new gt){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new gt){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new gt){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ZB extends yd{constructor(e=new Cn,n=new Cn,i=new Cn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new Cn){const i=n,r=this.v0,o=this.v1,c=this.v2;return i.set(L1(e,r.x,o.x,c.x),L1(e,r.y,o.y,c.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XB extends yd{constructor(e=new gt,n=new gt,i=new gt){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new gt){const i=n,r=this.v0,o=this.v1,c=this.v2;return i.set(L1(e,r.x,o.x,c.x),L1(e,r.y,o.y,c.y),L1(e,r.z,o.z,c.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class KB extends yd{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new Cn){const i=n,r=this.points,o=(r.length-1)*e,c=Math.floor(o),s=o-c,f=r[c===0?c:c-1],v=r[c],w=r[c>r.length-2?r.length-1:c+1],C=r[c>r.length-3?r.length-1:c+2];return i.set(uW(s,f.x,v.x,w.x,C.x),uW(s,f.y,v.y,w.y,C.y)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const r=this.points[n];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(new Cn().fromArray(r))}return this}}var rA=Object.freeze({__proto__:null,ArcCurve:VY,CatmullRomCurve3:GY,CubicBezierCurve:$B,CubicBezierCurve3:HY,EllipseCurve:oP,LineCurve:qB,LineCurve3:WY,QuadraticBezierCurve:ZB,QuadraticBezierCurve3:XB,SplineCurve:KB});class jY extends yd{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(n)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new rA[i](n,e))}return this}getPoint(e,n){const i=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=i){const c=r[o]-i,s=this.curves[o],f=s.getLength(),v=f===0?0:1-c/f;return s.getPointAt(v,n)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let i=0,r=this.curves.length;i<r;i++)n+=this.curves[i].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let i;for(let r=0,o=this.curves;r<o.length;r++){const c=o[r],s=c.isEllipseCurve?e*2:c.isLineCurve||c.isLineCurve3?1:c.isSplineCurve?e*c.points.length:e,f=c.getPoints(s);for(let v=0;v<f.length;v++){const w=f[v];i&&i.equals(w)||(n.push(w),i=w)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const r=e.curves[n];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,i=this.curves.length;n<i;n++){const r=this.curves[n];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const r=e.curves[n];this.curves.push(new rA[r.type]().fromJSON(r))}return this}}class tv extends jY{constructor(e){super(),this.type="Path",this.currentPoint=new Cn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,i=e.length;n<i;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const i=new qB(this.currentPoint.clone(),new Cn(e,n));return this.curves.push(i),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,i,r){const o=new ZB(this.currentPoint.clone(),new Cn(e,n),new Cn(i,r));return this.curves.push(o),this.currentPoint.set(i,r),this}bezierCurveTo(e,n,i,r,o,c){const s=new $B(this.currentPoint.clone(),new Cn(e,n),new Cn(i,r),new Cn(o,c));return this.curves.push(s),this.currentPoint.set(o,c),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),i=new KB(n);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,i,r,o,c){const s=this.currentPoint.x,f=this.currentPoint.y;return this.absarc(e+s,n+f,i,r,o,c),this}absarc(e,n,i,r,o,c){return this.absellipse(e,n,i,i,r,o,c),this}ellipse(e,n,i,r,o,c,s,f){const v=this.currentPoint.x,w=this.currentPoint.y;return this.absellipse(e+v,n+w,i,r,o,c,s,f),this}absellipse(e,n,i,r,o,c,s,f){const v=new oP(e,n,i,r,o,c,s,f);if(this.curves.length>0){const C=v.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(v);const w=v.getPoint(1);return this.currentPoint.copy(w),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class db extends Cr{constructor(e=[new Cn(0,-.5),new Cn(.5,0),new Cn(0,.5)],n=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:r},n=Math.floor(n),r=Xo(r,0,Math.PI*2);const o=[],c=[],s=[],f=[],v=[],w=1/n,C=new gt,M=new Cn,F=new gt,N=new gt,z=new gt;let L=0,P=0;for(let H=0;H<=e.length-1;H++)switch(H){case 0:L=e[H+1].x-e[H].x,P=e[H+1].y-e[H].y,F.x=P*1,F.y=-L,F.z=P*0,z.copy(F),F.normalize(),f.push(F.x,F.y,F.z);break;case e.length-1:f.push(z.x,z.y,z.z);break;default:L=e[H+1].x-e[H].x,P=e[H+1].y-e[H].y,F.x=P*1,F.y=-L,F.z=P*0,N.copy(F),F.x+=z.x,F.y+=z.y,F.z+=z.z,F.normalize(),f.push(F.x,F.y,F.z),z.copy(N)}for(let H=0;H<=n;H++){const j=i+H*w*r,q=Math.sin(j),le=Math.cos(j);for(let ce=0;ce<=e.length-1;ce++){C.x=e[ce].x*q,C.y=e[ce].y,C.z=e[ce].x*le,c.push(C.x,C.y,C.z),M.x=H/n,M.y=ce/(e.length-1),s.push(M.x,M.y);const ae=f[3*ce+0]*q,pe=f[3*ce+1],fe=f[3*ce+0]*le;v.push(ae,pe,fe)}}for(let H=0;H<n;H++)for(let j=0;j<e.length-1;j++){const q=j+H*e.length,le=q,ce=q+e.length,ae=q+e.length+1,pe=q+1;o.push(le,ce,pe),o.push(ae,pe,ce)}this.setIndex(o),this.setAttribute("position",new Ni(c,3)),this.setAttribute("uv",new Ni(s,2)),this.setAttribute("normal",new Ni(v,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new db(e.points,e.segments,e.phiStart,e.phiLength)}}class aP extends db{constructor(e=1,n=1,i=4,r=8){const o=new tv;o.absarc(0,-n/2,e,Math.PI*1.5,0),o.absarc(0,n/2,e,0,Math.PI*.5),super(o.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:n,capSegments:i,radialSegments:r}}static fromJSON(e){return new aP(e.radius,e.length,e.capSegments,e.radialSegments)}}class fb extends Cr{constructor(e=1,n=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:r},n=Math.max(3,n);const o=[],c=[],s=[],f=[],v=new gt,w=new Cn;c.push(0,0,0),s.push(0,0,1),f.push(.5,.5);for(let C=0,M=3;C<=n;C++,M+=3){const F=i+C/n*r;v.x=e*Math.cos(F),v.y=e*Math.sin(F),c.push(v.x,v.y,v.z),s.push(0,0,1),w.x=(c[M]/e+1)/2,w.y=(c[M+1]/e+1)/2,f.push(w.x,w.y)}for(let C=1;C<=n;C++)o.push(C,C+1,0);this.setIndex(o),this.setAttribute("position",new Ni(c,3)),this.setAttribute("normal",new Ni(s,3)),this.setAttribute("uv",new Ni(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fb(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Uw extends Cr{constructor(e=1,n=1,i=1,r=32,o=1,c=!1,s=0,f=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:i,radialSegments:r,heightSegments:o,openEnded:c,thetaStart:s,thetaLength:f};const v=this;r=Math.floor(r),o=Math.floor(o);const w=[],C=[],M=[],F=[];let N=0;const z=[],L=i/2;let P=0;H(),c===!1&&(e>0&&j(!0),n>0&&j(!1)),this.setIndex(w),this.setAttribute("position",new Ni(C,3)),this.setAttribute("normal",new Ni(M,3)),this.setAttribute("uv",new Ni(F,2));function H(){const q=new gt,le=new gt;let ce=0;const ae=(n-e)/i;for(let pe=0;pe<=o;pe++){const fe=[],ue=pe/o,Ee=ue*(n-e)+e;for(let We=0;We<=r;We++){const rt=We/r,tt=rt*f+s,Ye=Math.sin(tt),qe=Math.cos(tt);le.x=Ee*Ye,le.y=-ue*i+L,le.z=Ee*qe,C.push(le.x,le.y,le.z),q.set(Ye,ae,qe).normalize(),M.push(q.x,q.y,q.z),F.push(rt,1-ue),fe.push(N++)}z.push(fe)}for(let pe=0;pe<r;pe++)for(let fe=0;fe<o;fe++){const ue=z[fe][pe],Ee=z[fe+1][pe],We=z[fe+1][pe+1],rt=z[fe][pe+1];(e>0||fe!==0)&&(w.push(ue,Ee,rt),ce+=3),(n>0||fe!==o-1)&&(w.push(Ee,We,rt),ce+=3)}v.addGroup(P,ce,0),P+=ce}function j(q){const le=N,ce=new Cn,ae=new gt;let pe=0;const fe=q===!0?e:n,ue=q===!0?1:-1;for(let We=1;We<=r;We++)C.push(0,L*ue,0),M.push(0,ue,0),F.push(.5,.5),N++;const Ee=N;for(let We=0;We<=r;We++){const tt=We/r*f+s,Ye=Math.cos(tt),qe=Math.sin(tt);ae.x=fe*qe,ae.y=L*ue,ae.z=fe*Ye,C.push(ae.x,ae.y,ae.z),M.push(0,ue,0),ce.x=Ye*.5+.5,ce.y=qe*.5*ue+.5,F.push(ce.x,ce.y),N++}for(let We=0;We<r;We++){const rt=le+We,tt=Ee+We;q===!0?w.push(tt,tt+1,rt):w.push(tt+1,tt,rt),pe+=3}v.addGroup(P,pe,q===!0?1:2),P+=pe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Uw(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class lP extends Uw{constructor(e=1,n=1,i=32,r=1,o=!1,c=0,s=Math.PI*2){super(0,e,n,i,r,o,c,s),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:c,thetaLength:s}}static fromJSON(e){return new lP(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Mv extends Cr{constructor(e=[],n=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:i,detail:r};const o=[],c=[];s(r),v(i),w(),this.setAttribute("position",new Ni(o,3)),this.setAttribute("normal",new Ni(o.slice(),3)),this.setAttribute("uv",new Ni(c,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function s(H){const j=new gt,q=new gt,le=new gt;for(let ce=0;ce<n.length;ce+=3)F(n[ce+0],j),F(n[ce+1],q),F(n[ce+2],le),f(j,q,le,H)}function f(H,j,q,le){const ce=le+1,ae=[];for(let pe=0;pe<=ce;pe++){ae[pe]=[];const fe=H.clone().lerp(q,pe/ce),ue=j.clone().lerp(q,pe/ce),Ee=ce-pe;for(let We=0;We<=Ee;We++)We===0&&pe===ce?ae[pe][We]=fe:ae[pe][We]=fe.clone().lerp(ue,We/Ee)}for(let pe=0;pe<ce;pe++)for(let fe=0;fe<2*(ce-pe)-1;fe++){const ue=Math.floor(fe/2);fe%2===0?(M(ae[pe][ue+1]),M(ae[pe+1][ue]),M(ae[pe][ue])):(M(ae[pe][ue+1]),M(ae[pe+1][ue+1]),M(ae[pe+1][ue]))}}function v(H){const j=new gt;for(let q=0;q<o.length;q+=3)j.x=o[q+0],j.y=o[q+1],j.z=o[q+2],j.normalize().multiplyScalar(H),o[q+0]=j.x,o[q+1]=j.y,o[q+2]=j.z}function w(){const H=new gt;for(let j=0;j<o.length;j+=3){H.x=o[j+0],H.y=o[j+1],H.z=o[j+2];const q=L(H)/2/Math.PI+.5,le=P(H)/Math.PI+.5;c.push(q,1-le)}N(),C()}function C(){for(let H=0;H<c.length;H+=6){const j=c[H+0],q=c[H+2],le=c[H+4],ce=Math.max(j,q,le),ae=Math.min(j,q,le);ce>.9&&ae<.1&&(j<.2&&(c[H+0]+=1),q<.2&&(c[H+2]+=1),le<.2&&(c[H+4]+=1))}}function M(H){o.push(H.x,H.y,H.z)}function F(H,j){const q=H*3;j.x=e[q+0],j.y=e[q+1],j.z=e[q+2]}function N(){const H=new gt,j=new gt,q=new gt,le=new gt,ce=new Cn,ae=new Cn,pe=new Cn;for(let fe=0,ue=0;fe<o.length;fe+=9,ue+=6){H.set(o[fe+0],o[fe+1],o[fe+2]),j.set(o[fe+3],o[fe+4],o[fe+5]),q.set(o[fe+6],o[fe+7],o[fe+8]),ce.set(c[ue+0],c[ue+1]),ae.set(c[ue+2],c[ue+3]),pe.set(c[ue+4],c[ue+5]),le.copy(H).add(j).add(q).divideScalar(3);const Ee=L(le);z(ce,ue+0,H,Ee),z(ae,ue+2,j,Ee),z(pe,ue+4,q,Ee)}}function z(H,j,q,le){le<0&&H.x===1&&(c[j]=H.x-1),q.x===0&&q.z===0&&(c[j]=le/2/Math.PI+.5)}function L(H){return Math.atan2(H.z,-H.x)}function P(H){return Math.atan2(-H.y,Math.sqrt(H.x*H.x+H.z*H.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mv(e.vertices,e.indices,e.radius,e.details)}}class cP extends Mv{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,r=1/i,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],c=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,c,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new cP(e.radius,e.detail)}}const RM=new gt,TM=new gt,k2=new gt,AM=new Fc;class YB extends Cr{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const r=Math.pow(10,4),o=Math.cos(c_*n),c=e.getIndex(),s=e.getAttribute("position"),f=c?c.count:s.count,v=[0,0,0],w=["a","b","c"],C=new Array(3),M={},F=[];for(let N=0;N<f;N+=3){c?(v[0]=c.getX(N),v[1]=c.getX(N+1),v[2]=c.getX(N+2)):(v[0]=N,v[1]=N+1,v[2]=N+2);const{a:z,b:L,c:P}=AM;if(z.fromBufferAttribute(s,v[0]),L.fromBufferAttribute(s,v[1]),P.fromBufferAttribute(s,v[2]),AM.getNormal(k2),C[0]=`${Math.round(z.x*r)},${Math.round(z.y*r)},${Math.round(z.z*r)}`,C[1]=`${Math.round(L.x*r)},${Math.round(L.y*r)},${Math.round(L.z*r)}`,C[2]=`${Math.round(P.x*r)},${Math.round(P.y*r)},${Math.round(P.z*r)}`,!(C[0]===C[1]||C[1]===C[2]||C[2]===C[0]))for(let H=0;H<3;H++){const j=(H+1)%3,q=C[H],le=C[j],ce=AM[w[H]],ae=AM[w[j]],pe=`${q}_${le}`,fe=`${le}_${q}`;fe in M&&M[fe]?(k2.dot(M[fe].normal)<=o&&(F.push(ce.x,ce.y,ce.z),F.push(ae.x,ae.y,ae.z)),M[fe]=null):pe in M||(M[pe]={index0:v[H],index1:v[j],normal:k2.clone()})}}for(const N in M)if(M[N]){const{index0:z,index1:L}=M[N];RM.fromBufferAttribute(s,z),TM.fromBufferAttribute(s,L),F.push(RM.x,RM.y,RM.z),F.push(TM.x,TM.y,TM.z)}this.setAttribute("position",new Ni(F,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class nv extends tv{constructor(e){super(e),this.uuid=xu(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let i=0,r=this.holes.length;i<r;i++)n[i]=this.holes[i].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const r=e.holes[n];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,i=this.holes.length;n<i;n++){const r=this.holes[n];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const r=e.holes[n];this.holes.push(new tv().fromJSON(r))}return this}}const DDe={triangulate:function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let o=$Y(t,0,r,n,!0);const c=[];if(!o||o.next===o.prev)return c;let s,f,v,w,C,M,F;if(i&&(o=NDe(t,e,o,n)),t.length>80*n){s=v=t[0],f=w=t[1];for(let N=n;N<r;N+=n)C=t[N],M=t[N+1],C<s&&(s=C),M<f&&(f=M),C>v&&(v=C),M>w&&(w=M);F=Math.max(v-s,w-f),F=F!==0?32767/F:0}return xS(o,c,n,s,f,F,0),c}};function $Y(t,e,n,i,r){let o,c;if(r===ZDe(t,e,n,i)>0)for(o=e;o<n;o+=i)c=hW(o,t[o],t[o+1],c);else for(o=n-i;o>=e;o-=i)c=hW(o,t[o],t[o+1],c);return c&&uP(c,c.next)&&(CS(c),c=c.next),c}function A_(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(uP(n,n.next)||Fo(n.prev,n,n.next)===0)){if(CS(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function xS(t,e,n,i,r,o,c){if(!t)return;!c&&o&&GDe(t,i,r,o);let s=t,f,v;for(;t.prev!==t.next;){if(f=t.prev,v=t.next,o?LDe(t,i,r,o):FDe(t)){e.push(f.i/n|0),e.push(t.i/n|0),e.push(v.i/n|0),CS(t),t=v.next,s=v.next;continue}if(t=v,t===s){c?c===1?(t=ODe(A_(t),e,n),xS(t,e,n,i,r,o,2)):c===2&&kDe(t,e,n,i,r,o):xS(A_(t),e,n,i,r,o,1);break}}}function FDe(t){const e=t.prev,n=t,i=t.next;if(Fo(e,n,i)>=0)return!1;const r=e.x,o=n.x,c=i.x,s=e.y,f=n.y,v=i.y,w=r<o?r<c?r:c:o<c?o:c,C=s<f?s<v?s:v:f<v?f:v,M=r>o?r>c?r:c:o>c?o:c,F=s>f?s>v?s:v:f>v?f:v;let N=i.next;for(;N!==e;){if(N.x>=w&&N.x<=M&&N.y>=C&&N.y<=F&&_x(r,s,o,f,c,v,N.x,N.y)&&Fo(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function LDe(t,e,n,i){const r=t.prev,o=t,c=t.next;if(Fo(r,o,c)>=0)return!1;const s=r.x,f=o.x,v=c.x,w=r.y,C=o.y,M=c.y,F=s<f?s<v?s:v:f<v?f:v,N=w<C?w<M?w:M:C<M?C:M,z=s>f?s>v?s:v:f>v?f:v,L=w>C?w>M?w:M:C>M?C:M,P=qk(F,N,e,n,i),H=qk(z,L,e,n,i);let j=t.prevZ,q=t.nextZ;for(;j&&j.z>=P&&q&&q.z<=H;){if(j.x>=F&&j.x<=z&&j.y>=N&&j.y<=L&&j!==r&&j!==c&&_x(s,w,f,C,v,M,j.x,j.y)&&Fo(j.prev,j,j.next)>=0||(j=j.prevZ,q.x>=F&&q.x<=z&&q.y>=N&&q.y<=L&&q!==r&&q!==c&&_x(s,w,f,C,v,M,q.x,q.y)&&Fo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;j&&j.z>=P;){if(j.x>=F&&j.x<=z&&j.y>=N&&j.y<=L&&j!==r&&j!==c&&_x(s,w,f,C,v,M,j.x,j.y)&&Fo(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;q&&q.z<=H;){if(q.x>=F&&q.x<=z&&q.y>=N&&q.y<=L&&q!==r&&q!==c&&_x(s,w,f,C,v,M,q.x,q.y)&&Fo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function ODe(t,e,n){let i=t;do{const r=i.prev,o=i.next.next;!uP(r,o)&&qY(r,i,i.next,o)&&wS(r,o)&&wS(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),CS(i),CS(i.next),i=t=o),i=i.next}while(i!==t);return A_(i)}function kDe(t,e,n,i,r,o){let c=t;do{let s=c.next.next;for(;s!==c.prev;){if(c.i!==s.i&&jDe(c,s)){let f=ZY(c,s);c=A_(c,c.next),f=A_(f,f.next),xS(c,e,n,i,r,o,0),xS(f,e,n,i,r,o,0);return}s=s.next}c=c.next}while(c!==t)}function NDe(t,e,n,i){const r=[];let o,c,s,f,v;for(o=0,c=e.length;o<c;o++)s=e[o]*i,f=o<c-1?e[o+1]*i:t.length,v=$Y(t,s,f,i,!1),v===v.next&&(v.steiner=!0),r.push(WDe(v));for(r.sort(BDe),o=0;o<r.length;o++)n=zDe(r[o],n);return n}function BDe(t,e){return t.x-e.x}function zDe(t,e){const n=UDe(t,e);if(!n)return e;const i=ZY(n,t);return A_(i,i.next),A_(n,n.next)}function UDe(t,e){let n=e,i=-1/0,r;const o=t.x,c=t.y;do{if(c<=n.y&&c>=n.next.y&&n.next.y!==n.y){const M=n.x+(c-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(M<=o&&M>i&&(i=M,r=n.x<n.next.x?n:n.next,M===o))return r}n=n.next}while(n!==e);if(!r)return null;const s=r,f=r.x,v=r.y;let w=1/0,C;n=r;do o>=n.x&&n.x>=f&&o!==n.x&&_x(c<v?o:i,c,f,v,c<v?i:o,c,n.x,n.y)&&(C=Math.abs(c-n.y)/(o-n.x),wS(n,t)&&(C<w||C===w&&(n.x>r.x||n.x===r.x&&VDe(r,n)))&&(r=n,w=C)),n=n.next;while(n!==s);return r}function VDe(t,e){return Fo(t.prev,t,e.prev)<0&&Fo(e.next,t,t.next)<0}function GDe(t,e,n,i){let r=t;do r.z===0&&(r.z=qk(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,HDe(r)}function HDe(t){let e,n,i,r,o,c,s,f,v=1;do{for(n=t,t=null,o=null,c=0;n;){for(c++,i=n,s=0,e=0;e<v&&(s++,i=i.nextZ,!!i);e++);for(f=v;s>0||f>0&&i;)s!==0&&(f===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,v*=2}while(c>1);return t}function qk(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function WDe(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function _x(t,e,n,i,r,o,c,s){return(r-c)*(e-s)>=(t-c)*(o-s)&&(t-c)*(i-s)>=(n-c)*(e-s)&&(n-c)*(o-s)>=(r-c)*(i-s)}function jDe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!$De(t,e)&&(wS(t,e)&&wS(e,t)&&qDe(t,e)&&(Fo(t.prev,t,e.prev)||Fo(t,e.prev,e))||uP(t,e)&&Fo(t.prev,t,t.next)>0&&Fo(e.prev,e,e.next)>0)}function Fo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function uP(t,e){return t.x===e.x&&t.y===e.y}function qY(t,e,n,i){const r=IM(Fo(t,e,n)),o=IM(Fo(t,e,i)),c=IM(Fo(n,i,t)),s=IM(Fo(n,i,e));return!!(r!==o&&c!==s||r===0&&PM(t,n,e)||o===0&&PM(t,i,e)||c===0&&PM(n,t,i)||s===0&&PM(n,e,i))}function PM(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function IM(t){return t>0?1:t<0?-1:0}function $De(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&qY(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function wS(t,e){return Fo(t.prev,t,t.next)<0?Fo(t,e,t.next)>=0&&Fo(t,t.prev,e)>=0:Fo(t,e,t.prev)<0||Fo(t,t.next,e)<0}function qDe(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,o=(t.y+e.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function ZY(t,e){const n=new Zk(t.i,t.x,t.y),i=new Zk(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function hW(t,e,n,i){const r=new Zk(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function CS(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zk(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ZDe(t,e,n,i){let r=0;for(let o=e,c=n-i;o<n;o+=i)r+=(t[c]-t[o])*(t[o+1]+t[c+1]),c=o;return r}class od{static area(e){const n=e.length;let i=0;for(let r=n-1,o=0;o<n;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return i*.5}static isClockWise(e){return od.area(e)<0}static triangulateShape(e,n){const i=[],r=[],o=[];dW(e),fW(i,e);let c=e.length;n.forEach(dW);for(let f=0;f<n.length;f++)r.push(c),c+=n[f].length,fW(i,n[f]);const s=DDe.triangulate(i,r);for(let f=0;f<s.length;f+=3)o.push(s.slice(f,f+3));return o}}function dW(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function fW(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class hP extends Cr{constructor(e=new nv([new Cn(.5,.5),new Cn(-.5,.5),new Cn(-.5,-.5),new Cn(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const i=this,r=[],o=[];for(let s=0,f=e.length;s<f;s++){const v=e[s];c(v)}this.setAttribute("position",new Ni(r,3)),this.setAttribute("uv",new Ni(o,2)),this.computeVertexNormals();function c(s){const f=[],v=n.curveSegments!==void 0?n.curveSegments:12,w=n.steps!==void 0?n.steps:1,C=n.depth!==void 0?n.depth:1;let M=n.bevelEnabled!==void 0?n.bevelEnabled:!0,F=n.bevelThickness!==void 0?n.bevelThickness:.2,N=n.bevelSize!==void 0?n.bevelSize:F-.1,z=n.bevelOffset!==void 0?n.bevelOffset:0,L=n.bevelSegments!==void 0?n.bevelSegments:3;const P=n.extrudePath,H=n.UVGenerator!==void 0?n.UVGenerator:XDe;let j,q=!1,le,ce,ae,pe;P&&(j=P.getSpacedPoints(w),q=!0,M=!1,le=P.computeFrenetFrames(w,!1),ce=new gt,ae=new gt,pe=new gt),M||(L=0,F=0,N=0,z=0);const fe=s.extractPoints(v);let ue=fe.shape;const Ee=fe.holes;if(!od.isClockWise(ue)){ue=ue.reverse();for(let bt=0,Dt=Ee.length;bt<Dt;bt++){const _e=Ee[bt];od.isClockWise(_e)&&(Ee[bt]=_e.reverse())}}const rt=od.triangulateShape(ue,Ee),tt=ue;for(let bt=0,Dt=Ee.length;bt<Dt;bt++){const _e=Ee[bt];ue=ue.concat(_e)}function Ye(bt,Dt,_e){return Dt||console.error("THREE.ExtrudeGeometry: vec does not exist"),bt.clone().addScaledVector(Dt,_e)}const qe=ue.length,ft=rt.length;function Me(bt,Dt,_e){let At,Ot,tn;const xe=bt.x-Dt.x,Se=bt.y-Dt.y,it=_e.x-bt.x,Le=_e.y-bt.y,Pe=xe*xe+Se*Se,vt=xe*Le-Se*it;if(Math.abs(vt)>Number.EPSILON){const yt=Math.sqrt(Pe),nn=Math.sqrt(it*it+Le*Le),jt=Dt.x-Se/yt,Fn=Dt.y+xe/yt,Bn=_e.x-Le/nn,Zn=_e.y+it/nn,Li=((Bn-jt)*Le-(Zn-Fn)*it)/(xe*Le-Se*it);At=jt+xe*Li-bt.x,Ot=Fn+Se*Li-bt.y;const zn=At*At+Ot*Ot;if(zn<=2)return new Cn(At,Ot);tn=Math.sqrt(zn/2)}else{let yt=!1;xe>Number.EPSILON?it>Number.EPSILON&&(yt=!0):xe<-Number.EPSILON?it<-Number.EPSILON&&(yt=!0):Math.sign(Se)===Math.sign(Le)&&(yt=!0),yt?(At=-Se,Ot=xe,tn=Math.sqrt(Pe)):(At=xe,Ot=Se,tn=Math.sqrt(Pe/2))}return new Cn(At/tn,Ot/tn)}const $e=[];for(let bt=0,Dt=tt.length,_e=Dt-1,At=bt+1;bt<Dt;bt++,_e++,At++)_e===Dt&&(_e=0),At===Dt&&(At=0),$e[bt]=Me(tt[bt],tt[_e],tt[At]);const ut=[];let Mt,Gt=$e.concat();for(let bt=0,Dt=Ee.length;bt<Dt;bt++){const _e=Ee[bt];Mt=[];for(let At=0,Ot=_e.length,tn=Ot-1,xe=At+1;At<Ot;At++,tn++,xe++)tn===Ot&&(tn=0),xe===Ot&&(xe=0),Mt[At]=Me(_e[At],_e[tn],_e[xe]);ut.push(Mt),Gt=Gt.concat(Mt)}for(let bt=0;bt<L;bt++){const Dt=bt/L,_e=F*Math.cos(Dt*Math.PI/2),At=N*Math.sin(Dt*Math.PI/2)+z;for(let Ot=0,tn=tt.length;Ot<tn;Ot++){const xe=Ye(tt[Ot],$e[Ot],At);De(xe.x,xe.y,-_e)}for(let Ot=0,tn=Ee.length;Ot<tn;Ot++){const xe=Ee[Ot];Mt=ut[Ot];for(let Se=0,it=xe.length;Se<it;Se++){const Le=Ye(xe[Se],Mt[Se],At);De(Le.x,Le.y,-_e)}}}const Xt=N+z;for(let bt=0;bt<qe;bt++){const Dt=M?Ye(ue[bt],Gt[bt],Xt):ue[bt];q?(ae.copy(le.normals[0]).multiplyScalar(Dt.x),ce.copy(le.binormals[0]).multiplyScalar(Dt.y),pe.copy(j[0]).add(ae).add(ce),De(pe.x,pe.y,pe.z)):De(Dt.x,Dt.y,0)}for(let bt=1;bt<=w;bt++)for(let Dt=0;Dt<qe;Dt++){const _e=M?Ye(ue[Dt],Gt[Dt],Xt):ue[Dt];q?(ae.copy(le.normals[bt]).multiplyScalar(_e.x),ce.copy(le.binormals[bt]).multiplyScalar(_e.y),pe.copy(j[bt]).add(ae).add(ce),De(pe.x,pe.y,pe.z)):De(_e.x,_e.y,C/w*bt)}for(let bt=L-1;bt>=0;bt--){const Dt=bt/L,_e=F*Math.cos(Dt*Math.PI/2),At=N*Math.sin(Dt*Math.PI/2)+z;for(let Ot=0,tn=tt.length;Ot<tn;Ot++){const xe=Ye(tt[Ot],$e[Ot],At);De(xe.x,xe.y,C+_e)}for(let Ot=0,tn=Ee.length;Ot<tn;Ot++){const xe=Ee[Ot];Mt=ut[Ot];for(let Se=0,it=xe.length;Se<it;Se++){const Le=Ye(xe[Se],Mt[Se],At);q?De(Le.x,Le.y+j[w-1].y,j[w-1].x+_e):De(Le.x,Le.y,C+_e)}}}Qe(),Ge();function Qe(){const bt=r.length/3;if(M){let Dt=0,_e=qe*Dt;for(let At=0;At<ft;At++){const Ot=rt[At];kt(Ot[2]+_e,Ot[1]+_e,Ot[0]+_e)}Dt=w+L*2,_e=qe*Dt;for(let At=0;At<ft;At++){const Ot=rt[At];kt(Ot[0]+_e,Ot[1]+_e,Ot[2]+_e)}}else{for(let Dt=0;Dt<ft;Dt++){const _e=rt[Dt];kt(_e[2],_e[1],_e[0])}for(let Dt=0;Dt<ft;Dt++){const _e=rt[Dt];kt(_e[0]+qe*w,_e[1]+qe*w,_e[2]+qe*w)}}i.addGroup(bt,r.length/3-bt,0)}function Ge(){const bt=r.length/3;let Dt=0;He(tt,Dt),Dt+=tt.length;for(let _e=0,At=Ee.length;_e<At;_e++){const Ot=Ee[_e];He(Ot,Dt),Dt+=Ot.length}i.addGroup(bt,r.length/3-bt,1)}function He(bt,Dt){let _e=bt.length;for(;--_e>=0;){const At=_e;let Ot=_e-1;Ot<0&&(Ot=bt.length-1);for(let tn=0,xe=w+L*2;tn<xe;tn++){const Se=qe*tn,it=qe*(tn+1),Le=Dt+At+Se,Pe=Dt+Ot+Se,vt=Dt+Ot+it,yt=Dt+At+it;rn(Le,Pe,vt,yt)}}}function De(bt,Dt,_e){f.push(bt),f.push(Dt),f.push(_e)}function kt(bt,Dt,_e){Re(bt),Re(Dt),Re(_e);const At=r.length/3,Ot=H.generateTopUV(i,r,At-3,At-2,At-1);Kt(Ot[0]),Kt(Ot[1]),Kt(Ot[2])}function rn(bt,Dt,_e,At){Re(bt),Re(Dt),Re(At),Re(Dt),Re(_e),Re(At);const Ot=r.length/3,tn=H.generateSideWallUV(i,r,Ot-6,Ot-3,Ot-2,Ot-1);Kt(tn[0]),Kt(tn[1]),Kt(tn[3]),Kt(tn[1]),Kt(tn[2]),Kt(tn[3])}function Re(bt){r.push(f[bt*3+0]),r.push(f[bt*3+1]),r.push(f[bt*3+2])}function Kt(bt){o.push(bt.x),o.push(bt.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,i=this.parameters.options;return KDe(n,i,e)}static fromJSON(e,n){const i=[];for(let o=0,c=e.shapes.length;o<c;o++){const s=n[e.shapes[o]];i.push(s)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new rA[r.type]().fromJSON(r)),new hP(i,e.options)}}const XDe={generateTopUV:function(t,e,n,i,r){const o=e[n*3],c=e[n*3+1],s=e[i*3],f=e[i*3+1],v=e[r*3],w=e[r*3+1];return[new Cn(o,c),new Cn(s,f),new Cn(v,w)]},generateSideWallUV:function(t,e,n,i,r,o){const c=e[n*3],s=e[n*3+1],f=e[n*3+2],v=e[i*3],w=e[i*3+1],C=e[i*3+2],M=e[r*3],F=e[r*3+1],N=e[r*3+2],z=e[o*3],L=e[o*3+1],P=e[o*3+2];return Math.abs(s-w)<Math.abs(c-v)?[new Cn(c,1-f),new Cn(v,1-C),new Cn(M,1-N),new Cn(z,1-P)]:[new Cn(s,1-f),new Cn(w,1-C),new Cn(F,1-N),new Cn(L,1-P)]}};function KDe(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const o=t[i];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class dP extends Mv{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,o,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new dP(e.radius,e.detail)}}class pb extends Mv{constructor(e=1,n=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new pb(e.radius,e.detail)}}class fP extends Cr{constructor(e=.5,n=1,i=32,r=1,o=0,c=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:i,phiSegments:r,thetaStart:o,thetaLength:c},i=Math.max(3,i),r=Math.max(1,r);const s=[],f=[],v=[],w=[];let C=e;const M=(n-e)/r,F=new gt,N=new Cn;for(let z=0;z<=r;z++){for(let L=0;L<=i;L++){const P=o+L/i*c;F.x=C*Math.cos(P),F.y=C*Math.sin(P),f.push(F.x,F.y,F.z),v.push(0,0,1),N.x=(F.x/n+1)/2,N.y=(F.y/n+1)/2,w.push(N.x,N.y)}C+=M}for(let z=0;z<r;z++){const L=z*(i+1);for(let P=0;P<i;P++){const H=P+L,j=H,q=H+i+1,le=H+i+2,ce=H+1;s.push(j,q,ce),s.push(q,le,ce)}}this.setIndex(s),this.setAttribute("position",new Ni(f,3)),this.setAttribute("normal",new Ni(v,3)),this.setAttribute("uv",new Ni(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fP(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class mb extends Cr{constructor(e=new nv([new Cn(0,.5),new Cn(-.5,-.5),new Cn(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const i=[],r=[],o=[],c=[];let s=0,f=0;if(Array.isArray(e)===!1)v(e);else for(let w=0;w<e.length;w++)v(e[w]),this.addGroup(s,f,w),s+=f,f=0;this.setIndex(i),this.setAttribute("position",new Ni(r,3)),this.setAttribute("normal",new Ni(o,3)),this.setAttribute("uv",new Ni(c,2));function v(w){const C=r.length/3,M=w.extractPoints(n);let F=M.shape;const N=M.holes;od.isClockWise(F)===!1&&(F=F.reverse());for(let L=0,P=N.length;L<P;L++){const H=N[L];od.isClockWise(H)===!0&&(N[L]=H.reverse())}const z=od.triangulateShape(F,N);for(let L=0,P=N.length;L<P;L++){const H=N[L];F=F.concat(H)}for(let L=0,P=F.length;L<P;L++){const H=F[L];r.push(H.x,H.y,0),o.push(0,0,1),c.push(H.x,H.y)}for(let L=0,P=z.length;L<P;L++){const H=z[L],j=H[0]+C,q=H[1]+C,le=H[2]+C;i.push(j,q,le),f+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return YDe(n,e)}static fromJSON(e,n){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const c=n[e.shapes[r]];i.push(c)}return new mb(i,e.curveSegments)}}function YDe(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}class gb extends Cr{constructor(e=1,n=32,i=16,r=0,o=Math.PI*2,c=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:i,phiStart:r,phiLength:o,thetaStart:c,thetaLength:s},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));const f=Math.min(c+s,Math.PI);let v=0;const w=[],C=new gt,M=new gt,F=[],N=[],z=[],L=[];for(let P=0;P<=i;P++){const H=[],j=P/i;let q=0;P===0&&c===0?q=.5/n:P===i&&f===Math.PI&&(q=-.5/n);for(let le=0;le<=n;le++){const ce=le/n;C.x=-e*Math.cos(r+ce*o)*Math.sin(c+j*s),C.y=e*Math.cos(c+j*s),C.z=e*Math.sin(r+ce*o)*Math.sin(c+j*s),N.push(C.x,C.y,C.z),M.copy(C).normalize(),z.push(M.x,M.y,M.z),L.push(ce+q,1-j),H.push(v++)}w.push(H)}for(let P=0;P<i;P++)for(let H=0;H<n;H++){const j=w[P][H+1],q=w[P][H],le=w[P+1][H],ce=w[P+1][H+1];(P!==0||c>0)&&F.push(j,q,ce),(P!==i-1||f<Math.PI)&&F.push(q,le,ce)}this.setIndex(F),this.setAttribute("position",new Ni(N,3)),this.setAttribute("normal",new Ni(z,3)),this.setAttribute("uv",new Ni(L,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gb(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class pP extends Mv{constructor(e=1,n=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new pP(e.radius,e.detail)}}class mP extends Cr{constructor(e=1,n=.4,i=12,r=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:i,tubularSegments:r,arc:o},i=Math.floor(i),r=Math.floor(r);const c=[],s=[],f=[],v=[],w=new gt,C=new gt,M=new gt;for(let F=0;F<=i;F++)for(let N=0;N<=r;N++){const z=N/r*o,L=F/i*Math.PI*2;C.x=(e+n*Math.cos(L))*Math.cos(z),C.y=(e+n*Math.cos(L))*Math.sin(z),C.z=n*Math.sin(L),s.push(C.x,C.y,C.z),w.x=e*Math.cos(z),w.y=e*Math.sin(z),M.subVectors(C,w).normalize(),f.push(M.x,M.y,M.z),v.push(N/r),v.push(F/i)}for(let F=1;F<=i;F++)for(let N=1;N<=r;N++){const z=(r+1)*F+N-1,L=(r+1)*(F-1)+N-1,P=(r+1)*(F-1)+N,H=(r+1)*F+N;c.push(z,L,H),c.push(L,P,H)}this.setIndex(c),this.setAttribute("position",new Ni(s,3)),this.setAttribute("normal",new Ni(f,3)),this.setAttribute("uv",new Ni(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mP(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class gP extends Cr{constructor(e=1,n=.4,i=64,r=8,o=2,c=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:i,radialSegments:r,p:o,q:c},i=Math.floor(i),r=Math.floor(r);const s=[],f=[],v=[],w=[],C=new gt,M=new gt,F=new gt,N=new gt,z=new gt,L=new gt,P=new gt;for(let j=0;j<=i;++j){const q=j/i*o*Math.PI*2;H(q,o,c,e,F),H(q+.01,o,c,e,N),L.subVectors(N,F),P.addVectors(N,F),z.crossVectors(L,P),P.crossVectors(z,L),z.normalize(),P.normalize();for(let le=0;le<=r;++le){const ce=le/r*Math.PI*2,ae=-n*Math.cos(ce),pe=n*Math.sin(ce);C.x=F.x+(ae*P.x+pe*z.x),C.y=F.y+(ae*P.y+pe*z.y),C.z=F.z+(ae*P.z+pe*z.z),f.push(C.x,C.y,C.z),M.subVectors(C,F).normalize(),v.push(M.x,M.y,M.z),w.push(j/i),w.push(le/r)}}for(let j=1;j<=i;j++)for(let q=1;q<=r;q++){const le=(r+1)*(j-1)+(q-1),ce=(r+1)*j+(q-1),ae=(r+1)*j+q,pe=(r+1)*(j-1)+q;s.push(le,ce,pe),s.push(ce,ae,pe)}this.setIndex(s),this.setAttribute("position",new Ni(f,3)),this.setAttribute("normal",new Ni(v,3)),this.setAttribute("uv",new Ni(w,2));function H(j,q,le,ce,ae){const pe=Math.cos(j),fe=Math.sin(j),ue=le/q*j,Ee=Math.cos(ue);ae.x=ce*(2+Ee)*.5*pe,ae.y=ce*(2+Ee)*fe*.5,ae.z=ce*Math.sin(ue)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gP(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class vP extends Cr{constructor(e=new XB(new gt(-1,-1,0),new gt(-1,1,0),new gt(1,1,0)),n=64,i=1,r=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:i,radialSegments:r,closed:o};const c=e.computeFrenetFrames(n,o);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const s=new gt,f=new gt,v=new Cn;let w=new gt;const C=[],M=[],F=[],N=[];z(),this.setIndex(N),this.setAttribute("position",new Ni(C,3)),this.setAttribute("normal",new Ni(M,3)),this.setAttribute("uv",new Ni(F,2));function z(){for(let j=0;j<n;j++)L(j);L(o===!1?n:0),H(),P()}function L(j){w=e.getPointAt(j/n,w);const q=c.normals[j],le=c.binormals[j];for(let ce=0;ce<=r;ce++){const ae=ce/r*Math.PI*2,pe=Math.sin(ae),fe=-Math.cos(ae);f.x=fe*q.x+pe*le.x,f.y=fe*q.y+pe*le.y,f.z=fe*q.z+pe*le.z,f.normalize(),M.push(f.x,f.y,f.z),s.x=w.x+i*f.x,s.y=w.y+i*f.y,s.z=w.z+i*f.z,C.push(s.x,s.y,s.z)}}function P(){for(let j=1;j<=n;j++)for(let q=1;q<=r;q++){const le=(r+1)*(j-1)+(q-1),ce=(r+1)*j+(q-1),ae=(r+1)*j+q,pe=(r+1)*(j-1)+q;N.push(le,ce,pe),N.push(ce,ae,pe)}}function H(){for(let j=0;j<=n;j++)for(let q=0;q<=r;q++)v.x=j/n,v.y=q/r,F.push(v.x,v.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new vP(new rA[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class XY extends Cr{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],i=new Set,r=new gt,o=new gt;if(e.index!==null){const c=e.attributes.position,s=e.index;let f=e.groups;f.length===0&&(f=[{start:0,count:s.count,materialIndex:0}]);for(let v=0,w=f.length;v<w;++v){const C=f[v],M=C.start,F=C.count;for(let N=M,z=M+F;N<z;N+=3)for(let L=0;L<3;L++){const P=s.getX(N+L),H=s.getX(N+(L+1)%3);r.fromBufferAttribute(c,P),o.fromBufferAttribute(c,H),pW(r,o,i)===!0&&(n.push(r.x,r.y,r.z),n.push(o.x,o.y,o.z))}}}else{const c=e.attributes.position;for(let s=0,f=c.count/3;s<f;s++)for(let v=0;v<3;v++){const w=3*s+v,C=3*s+(v+1)%3;r.fromBufferAttribute(c,w),o.fromBufferAttribute(c,C),pW(r,o,i)===!0&&(n.push(r.x,r.y,r.z),n.push(o.x,o.y,o.z))}}this.setAttribute("position",new Ni(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function pW(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return n.has(i)===!0||n.has(r)===!0?!1:(n.add(i),n.add(r),!0)}var mW=Object.freeze({__proto__:null,BoxGeometry:W_,CapsuleGeometry:aP,CircleGeometry:fb,ConeGeometry:lP,CylinderGeometry:Uw,DodecahedronGeometry:cP,EdgesGeometry:YB,ExtrudeGeometry:hP,IcosahedronGeometry:dP,LatheGeometry:db,OctahedronGeometry:pb,PlaneGeometry:Bw,PolyhedronGeometry:Mv,RingGeometry:fP,ShapeGeometry:mb,SphereGeometry:gb,TetrahedronGeometry:pP,TorusGeometry:mP,TorusKnotGeometry:gP,TubeGeometry:vP,WireframeGeometry:XY});class KY extends nl{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new bi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class YY extends ih{static get type(){return"RawShaderMaterial"}constructor(e){super(e),this.isRawShaderMaterial=!0}}class JB extends nl{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new bi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class JY extends JB{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Cn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Xo(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new bi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new bi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new bi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class QY extends nl{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new bi(16777215),this.specular=new bi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nc,this.combine=sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eJ extends nl{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new bi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class tJ extends nl{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class nJ extends nl{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nc,this.combine=sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iJ extends nl{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new bi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bv,this.normalScale=new Cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rJ extends ac{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Hy(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function sJ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function oJ(t){function e(r,o){return t[r]-t[o]}const n=t.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(e),i}function Xk(t,e,n){const i=t.length,r=new t.constructor(i);for(let o=0,c=0;c!==i;++o){const s=n[o]*e;for(let f=0;f!==e;++f)r[c++]=t[s+f]}return r}function QB(t,e,n,i){let r=1,o=t[0];for(;o!==void 0&&o[i]===void 0;)o=t[r++];if(o===void 0)return;let c=o[i];if(c!==void 0)if(Array.isArray(c))do c=o[i],c!==void 0&&(e.push(o.time),n.push.apply(n,c)),o=t[r++];while(o!==void 0);else if(c.toArray!==void 0)do c=o[i],c!==void 0&&(e.push(o.time),c.toArray(n,n.length)),o=t[r++];while(o!==void 0);else do c=o[i],c!==void 0&&(e.push(o.time),n.push(c)),o=t[r++];while(o!==void 0)}function JDe(t,e,n,i,r=30){const o=t.clone();o.name=e;const c=[];for(let f=0;f<o.tracks.length;++f){const v=o.tracks[f],w=v.getValueSize(),C=[],M=[];for(let F=0;F<v.times.length;++F){const N=v.times[F]*r;if(!(N<n||N>=i)){C.push(v.times[F]);for(let z=0;z<w;++z)M.push(v.values[F*w+z])}}C.length!==0&&(v.times=Hy(C,v.times.constructor),v.values=Hy(M,v.values.constructor),c.push(v))}o.tracks=c;let s=1/0;for(let f=0;f<o.tracks.length;++f)s>o.tracks[f].times[0]&&(s=o.tracks[f].times[0]);for(let f=0;f<o.tracks.length;++f)o.tracks[f].shift(-1*s);return o.resetDuration(),o}function QDe(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,o=e/i;for(let c=0;c<r;++c){const s=n.tracks[c],f=s.ValueTypeName;if(f==="bool"||f==="string")continue;const v=t.tracks.find(function(P){return P.name===s.name&&P.ValueTypeName===f});if(v===void 0)continue;let w=0;const C=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(w=C/3);let M=0;const F=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(M=F/3);const N=s.times.length-1;let z;if(o<=s.times[0]){const P=w,H=C-w;z=s.values.slice(P,H)}else if(o>=s.times[N]){const P=N*C+w,H=P+C-w;z=s.values.slice(P,H)}else{const P=s.createInterpolant(),H=w,j=C-w;P.evaluate(o),z=P.resultBuffer.slice(H,j)}f==="quaternion"&&new Cl().fromArray(z).normalize().conjugate().toArray(z);const L=v.times.length;for(let P=0;P<L;++P){const H=P*F+M;if(f==="quaternion")Cl.multiplyQuaternionsFlat(v.values,H,z,0,v.values,H);else{const j=F-M*2;for(let q=0;q<j;++q)v.values[H+q]-=z[q]}}}return t.blendMode=DB,t}const e2e={convertArray:Hy,isTypedArray:sJ,getKeyframeOrder:oJ,sortedArray:Xk,flattenJSON:QB,subclip:JDe,makeClipAdditive:QDe};class vb{constructor(e,n,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let i=this._cachedIndex,r=n[i],o=n[i-1];e:{t:{let c;n:{i:if(!(e<r)){for(let s=i+2;;){if(r===void 0){if(e<o)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(o=r,r=n[++i],e<r)break t}c=n.length;break n}if(!(e>=o)){const s=n[1];e<s&&(i=2,o=s);for(let f=i-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===f)break;if(r=o,o=n[--i-1],e>=o)break t}c=i,i=0;break n}break e}for(;i<c;){const s=i+c>>>1;e<n[s]?c=s:i=s+1}if(r=n[i],o=n[i-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let c=0;c!==r;++c)n[c]=i[o+c];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class aJ extends vb{constructor(e,n,i,r){super(e,n,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Uy,endingEnd:Uy}}intervalChanged_(e,n,i){const r=this.parameterPositions;let o=e-2,c=e+1,s=r[o],f=r[c];if(s===void 0)switch(this.getSettings_().endingStart){case Vy:o=e,s=2*n-i;break;case mS:o=r.length-2,s=n+r[o]-r[o+1];break;default:o=e,s=i}if(f===void 0)switch(this.getSettings_().endingEnd){case Vy:c=e,f=2*i-n;break;case mS:c=1,f=i+r[1]-r[0];break;default:c=e-1,f=n}const v=(i-n)*.5,w=this.valueSize;this._weightPrev=v/(n-s),this._weightNext=v/(f-i),this._offsetPrev=o*w,this._offsetNext=c*w}interpolate_(e,n,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=e*s,v=f-s,w=this._offsetPrev,C=this._offsetNext,M=this._weightPrev,F=this._weightNext,N=(i-n)/(r-n),z=N*N,L=z*N,P=-M*L+2*M*z-M*N,H=(1+M)*L+(-1.5-2*M)*z+(-.5+M)*N+1,j=(-1-F)*L+(1.5+F)*z+.5*N,q=F*L-F*z;for(let le=0;le!==s;++le)o[le]=P*c[w+le]+H*c[v+le]+j*c[f+le]+q*c[C+le];return o}}class ez extends vb{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=e*s,v=f-s,w=(i-n)/(r-n),C=1-w;for(let M=0;M!==s;++M)o[M]=c[v+M]*C+c[f+M]*w;return o}}class lJ extends vb{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class _d{constructor(e,n,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Hy(n,this.TimeBufferType),this.values=Hy(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:Hy(e.times,Array),values:Hy(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new lJ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ez(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new aJ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case pS:n=this.InterpolantFactoryMethodDiscrete;break;case tA:n=this.InterpolantFactoryMethodLinear;break;case pR:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return pS;case this.InterpolantFactoryMethodLinear:return tA;case this.InterpolantFactoryMethodSmooth:return pR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]*=e}return this}trim(e,n){const i=this.times,r=i.length;let o=0,c=r-1;for(;o!==r&&i[o]<e;)++o;for(;c!==-1&&i[c]>n;)--c;if(++c,o!==0||c!==r){o>=c&&(c=Math.max(c,1),o=c-1);const s=this.getValueSize();this.times=i.slice(o,c),this.values=this.values.slice(o*s,c*s)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let c=null;for(let s=0;s!==o;s++){const f=i[s];if(typeof f=="number"&&isNaN(f)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,f),e=!1;break}if(c!==null&&c>f){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,f,c),e=!1;break}c=f}if(r!==void 0&&sJ(r))for(let s=0,f=r.length;s!==f;++s){const v=r[s];if(isNaN(v)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,v),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===pR,o=e.length-1;let c=1;for(let s=1;s<o;++s){let f=!1;const v=e[s],w=e[s+1];if(v!==w&&(s!==1||v!==e[0]))if(r)f=!0;else{const C=s*i,M=C-i,F=C+i;for(let N=0;N!==i;++N){const z=n[C+N];if(z!==n[M+N]||z!==n[F+N]){f=!0;break}}}if(f){if(s!==c){e[c]=e[s];const C=s*i,M=c*i;for(let F=0;F!==i;++F)n[M+F]=n[C+F]}++c}}if(o>0){e[c]=e[o];for(let s=o*i,f=c*i,v=0;v!==i;++v)n[f+v]=n[s+v];++c}return c!==e.length?(this.times=e.slice(0,c),this.values=n.slice(0,c*i)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),i=this.constructor,r=new i(this.name,e,n);return r.createInterpolant=this.createInterpolant,r}}_d.prototype.TimeBufferType=Float32Array;_d.prototype.ValueBufferType=Float32Array;_d.prototype.DefaultInterpolation=tA;class j_ extends _d{constructor(e,n,i){super(e,n,i)}}j_.prototype.ValueTypeName="bool";j_.prototype.ValueBufferType=Array;j_.prototype.DefaultInterpolation=pS;j_.prototype.InterpolantFactoryMethodLinear=void 0;j_.prototype.InterpolantFactoryMethodSmooth=void 0;class tz extends _d{}tz.prototype.ValueTypeName="color";class SS extends _d{}SS.prototype.ValueTypeName="number";class cJ extends vb{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=(i-n)/(r-n);let v=e*s;for(let w=v+s;v!==w;v+=4)Cl.slerpFlat(o,0,c,v-s,c,v,f);return o}}class yb extends _d{InterpolantFactoryMethodLinear(e){return new cJ(this.times,this.values,this.getValueSize(),e)}}yb.prototype.ValueTypeName="quaternion";yb.prototype.InterpolantFactoryMethodSmooth=void 0;class $_ extends _d{constructor(e,n,i){super(e,n,i)}}$_.prototype.ValueTypeName="string";$_.prototype.ValueBufferType=Array;$_.prototype.DefaultInterpolation=pS;$_.prototype.InterpolantFactoryMethodLinear=void 0;$_.prototype.InterpolantFactoryMethodSmooth=void 0;class bS extends _d{}bS.prototype.ValueTypeName="vector";class ES{constructor(e="",n=-1,i=[],r=JA){this.name=e,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=xu(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],i=e.tracks,r=1/(e.fps||1);for(let c=0,s=i.length;c!==s;++c)n.push(n2e(i[c]).scale(r));const o=new this(e.name,e.duration,n,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const n=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,c=i.length;o!==c;++o)n.push(_d.toJSON(i[o]));return r}static CreateFromMorphTargetSequence(e,n,i,r){const o=n.length,c=[];for(let s=0;s<o;s++){let f=[],v=[];f.push((s+o-1)%o,s,(s+1)%o),v.push(0,1,0);const w=oJ(f);f=Xk(f,1,w),v=Xk(v,1,w),!r&&f[0]===0&&(f.push(o),v.push(v[0])),c.push(new SS(".morphTargetInfluences["+n[s].name+"]",f,v).scale(1/i))}return new this(e,-1,c)}static findByName(e,n){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===n)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,n,i){const r={},o=/^([\w-]*?)([\d]+)$/;for(let s=0,f=e.length;s<f;s++){const v=e[s],w=v.name.match(o);if(w&&w.length>1){const C=w[1];let M=r[C];M||(r[C]=M=[]),M.push(v)}}const c=[];for(const s in r)c.push(this.CreateFromMorphTargetSequence(s,r[s],n,i));return c}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(C,M,F,N,z){if(F.length!==0){const L=[],P=[];QB(F,L,P,N),L.length!==0&&z.push(new C(M,L,P))}},r=[],o=e.name||"default",c=e.fps||30,s=e.blendMode;let f=e.length||-1;const v=e.hierarchy||[];for(let C=0;C<v.length;C++){const M=v[C].keys;if(!(!M||M.length===0))if(M[0].morphTargets){const F={};let N;for(N=0;N<M.length;N++)if(M[N].morphTargets)for(let z=0;z<M[N].morphTargets.length;z++)F[M[N].morphTargets[z]]=-1;for(const z in F){const L=[],P=[];for(let H=0;H!==M[N].morphTargets.length;++H){const j=M[N];L.push(j.time),P.push(j.morphTarget===z?1:0)}r.push(new SS(".morphTargetInfluence["+z+"]",L,P))}f=F.length*c}else{const F=".bones["+n[C].name+"]";i(bS,F+".position",M,"pos",r),i(yb,F+".quaternion",M,"rot",r),i(bS,F+".scale",M,"scl",r)}}return r.length===0?null:new this(o,f,r,s)}resetDuration(){const e=this.tracks;let n=0;for(let i=0,r=e.length;i!==r;++i){const o=this.tracks[i];n=Math.max(n,o.times[o.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function t2e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return SS;case"vector":case"vector2":case"vector3":case"vector4":return bS;case"color":return tz;case"quaternion":return yb;case"bool":case"boolean":return j_;case"string":return $_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function n2e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=t2e(t.type);if(t.times===void 0){const n=[],i=[];QB(t.keys,n,i,"value"),t.times=n,t.values=i}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Bp={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class nz{constructor(e,n,i){const r=this;let o=!1,c=0,s=0,f;const v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(w){s++,o===!1&&r.onStart!==void 0&&r.onStart(w,c,s),o=!0},this.itemEnd=function(w){c++,r.onProgress!==void 0&&r.onProgress(w,c,s),c===s&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(w){r.onError!==void 0&&r.onError(w)},this.resolveURL=function(w){return f?f(w):w},this.setURLModifier=function(w){return f=w,this},this.addHandler=function(w,C){return v.push(w,C),this},this.removeHandler=function(w){const C=v.indexOf(w);return C!==-1&&v.splice(C,2),this},this.getHandler=function(w){for(let C=0,M=v.length;C<M;C+=2){const F=v[C],N=v[C+1];if(F.global&&(F.lastIndex=0),F.test(w))return N}return null}}}const uJ=new nz;class lc{constructor(e){this.manager=e!==void 0?e:uJ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const i=this;return new Promise(function(r,o){i.load(e,r,n,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}lc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Mp={};class i2e extends Error{constructor(e,n){super(e),this.response=n}}class Rf extends lc{constructor(e){super(e)}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Bp.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(o),this.manager.itemEnd(e)},0),o;if(Mp[e]!==void 0){Mp[e].push({onLoad:n,onProgress:i,onError:r});return}Mp[e]=[],Mp[e].push({onLoad:n,onProgress:i,onError:r});const c=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,f=this.responseType;fetch(c).then(v=>{if(v.status===200||v.status===0){if(v.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||v.body===void 0||v.body.getReader===void 0)return v;const w=Mp[e],C=v.body.getReader(),M=v.headers.get("X-File-Size")||v.headers.get("Content-Length"),F=M?parseInt(M):0,N=F!==0;let z=0;const L=new ReadableStream({start(P){H();function H(){C.read().then(({done:j,value:q})=>{if(j)P.close();else{z+=q.byteLength;const le=new ProgressEvent("progress",{lengthComputable:N,loaded:z,total:F});for(let ce=0,ae=w.length;ce<ae;ce++){const pe=w[ce];pe.onProgress&&pe.onProgress(le)}P.enqueue(q),H()}},j=>{P.error(j)})}}});return new Response(L)}else throw new i2e(`fetch for "${v.url}" responded with ${v.status}: ${v.statusText}`,v)}).then(v=>{switch(f){case"arraybuffer":return v.arrayBuffer();case"blob":return v.blob();case"document":return v.text().then(w=>new DOMParser().parseFromString(w,s));case"json":return v.json();default:if(s===void 0)return v.text();{const C=/charset="?([^;"\s]*)"?/i.exec(s),M=C&&C[1]?C[1].toLowerCase():void 0,F=new TextDecoder(M);return v.arrayBuffer().then(N=>F.decode(N))}}}).then(v=>{Bp.add(e,v);const w=Mp[e];delete Mp[e];for(let C=0,M=w.length;C<M;C++){const F=w[C];F.onLoad&&F.onLoad(v)}}).catch(v=>{const w=Mp[e];if(w===void 0)throw this.manager.itemError(e),v;delete Mp[e];for(let C=0,M=w.length;C<M;C++){const F=w[C];F.onError&&F.onError(v)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class r2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=new Rf(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(s){try{n(o.parse(JSON.parse(s)))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},i,r)}parse(e){const n=[];for(let i=0;i<e.length;i++){const r=ES.parse(e[i]);n.push(r)}return n}}class s2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=[],s=new sP,f=new Rf(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(o.withCredentials);let v=0;function w(C){f.load(e[C],function(M){const F=o.parse(M,!0);c[C]={width:F.width,height:F.height,format:F.format,mipmaps:F.mipmaps},v+=1,v===6&&(F.mipmapCount===1&&(s.minFilter=Ma),s.image=c,s.format=F.format,s.needsUpdate=!0,n&&n(s))},i,r)}if(Array.isArray(e))for(let C=0,M=e.length;C<M;++C)w(C);else f.load(e,function(C){const M=o.parse(C,!0);if(M.isCubemap){const F=M.mipmaps.length/M.mipmapCount;for(let N=0;N<F;N++){c[N]={mipmaps:[]};for(let z=0;z<M.mipmapCount;z++)c[N].mipmaps.push(M.mipmaps[N*M.mipmapCount+z]),c[N].format=M.format,c[N].width=M.width,c[N].height=M.height}s.image=c}else s.image.width=M.width,s.image.height=M.height,s.mipmaps=M.mipmaps;M.mipmapCount===1&&(s.minFilter=Ma),s.format=M.format,s.needsUpdate=!0,n&&n(s)},i,r);return s}}class MS extends lc{constructor(e){super(e)}load(e,n,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=Bp.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){n&&n(c),o.manager.itemEnd(e)},0),c;const s=yS("img");function f(){w(),Bp.add(e,this),n&&n(this),o.manager.itemEnd(e)}function v(C){w(),r&&r(C),o.manager.itemError(e),o.manager.itemEnd(e)}function w(){s.removeEventListener("load",f,!1),s.removeEventListener("error",v,!1)}return s.addEventListener("load",f,!1),s.addEventListener("error",v,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),o.manager.itemStart(e),s.src=e,s}}class o2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=new cb;o.colorSpace=$l;const c=new MS(this.manager);c.setCrossOrigin(this.crossOrigin),c.setPath(this.path);let s=0;function f(v){c.load(e[v],function(w){o.images[v]=w,s++,s===6&&(o.needsUpdate=!0,n&&n(o))},void 0,r)}for(let v=0;v<e.length;++v)f(v);return o}}class a2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=new Sf,s=new Rf(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(o.withCredentials),s.load(e,function(f){let v;try{v=o.parse(f)}catch(w){if(r!==void 0)r(w);else{console.error(w);return}}v.image!==void 0?c.image=v.image:v.data!==void 0&&(c.image.width=v.width,c.image.height=v.height,c.image.data=v.data),c.wrapS=v.wrapS!==void 0?v.wrapS:Yu,c.wrapT=v.wrapT!==void 0?v.wrapT:Yu,c.magFilter=v.magFilter!==void 0?v.magFilter:Ma,c.minFilter=v.minFilter!==void 0?v.minFilter:Ma,c.anisotropy=v.anisotropy!==void 0?v.anisotropy:1,v.colorSpace!==void 0&&(c.colorSpace=v.colorSpace),v.flipY!==void 0&&(c.flipY=v.flipY),v.format!==void 0&&(c.format=v.format),v.type!==void 0&&(c.type=v.type),v.mipmaps!==void 0&&(c.mipmaps=v.mipmaps,c.minFilter=vf),v.mipmapCount===1&&(c.minFilter=Ma),v.generateMipmaps!==void 0&&(c.generateMipmaps=v.generateMipmaps),c.needsUpdate=!0,n&&n(c,v)},i,r),c}}class l2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=new Oo,c=new MS(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(e,function(s){o.image=s,o.needsUpdate=!0,n!==void 0&&n(o)},i,r),o}}class Rv extends Cs{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new bi(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}class hJ extends Rv{constructor(e,n,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new bi(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const N2=new Hi,gW=new gt,vW=new gt;class iz{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Cn(512,512),this.map=null,this.mapPass=null,this.matrix=new Hi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ub,this._frameExtents=new Cn(1,1),this._viewportCount=1,this._viewports=[new xs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;gW.setFromMatrixPosition(e.matrixWorld),n.position.copy(gW),vW.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(vW),n.updateMatrixWorld(),N2.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(N2),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(N2)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class c2e extends iz{constructor(){super(new Ua(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,i=lw*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||n.far;(i!==n.fov||r!==n.aspect||o!==n.far)&&(n.fov=i,n.aspect=r,n.far=o,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class dJ extends Rv{constructor(e,n,i=0,r=Math.PI/3,o=0,c=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.target=new Cs,this.distance=i,this.angle=r,this.penumbra=o,this.decay=c,this.map=null,this.shadow=new c2e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const yW=new Hi,YC=new gt,B2=new gt;class u2e extends iz{constructor(){super(new Ua(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Cn(4,2),this._viewportCount=6,this._viewports=[new xs(2,1,1,1),new xs(0,1,1,1),new xs(3,1,1,1),new xs(1,1,1,1),new xs(3,0,1,1),new xs(1,0,1,1)],this._cubeDirections=[new gt(1,0,0),new gt(-1,0,0),new gt(0,0,1),new gt(0,0,-1),new gt(0,1,0),new gt(0,-1,0)],this._cubeUps=[new gt(0,1,0),new gt(0,1,0),new gt(0,1,0),new gt(0,1,0),new gt(0,0,1),new gt(0,0,-1)]}updateMatrices(e,n=0){const i=this.camera,r=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),YC.setFromMatrixPosition(e.matrixWorld),i.position.copy(YC),B2.copy(i.position),B2.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(B2),i.updateMatrixWorld(),r.makeTranslation(-YC.x,-YC.y,-YC.z),yW.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yW)}}class fJ extends Rv{constructor(e,n,i=0,r=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new u2e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class h2e extends iz{constructor(){super(new hb(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class pJ extends Rv{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.target=new Cs,this.shadow=new h2e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class mJ extends Rv{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class gJ extends Rv{constructor(e,n,i=10,r=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class vJ{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new gt)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return n.copy(c[0]).multiplyScalar(.282095),n.addScaledVector(c[1],.488603*r),n.addScaledVector(c[2],.488603*o),n.addScaledVector(c[3],.488603*i),n.addScaledVector(c[4],1.092548*(i*r)),n.addScaledVector(c[5],1.092548*(r*o)),n.addScaledVector(c[6],.315392*(3*o*o-1)),n.addScaledVector(c[7],1.092548*(i*o)),n.addScaledVector(c[8],.546274*(i*i-r*r)),n}getIrradianceAt(e,n){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return n.copy(c[0]).multiplyScalar(.886227),n.addScaledVector(c[1],2*.511664*r),n.addScaledVector(c[2],2*.511664*o),n.addScaledVector(c[3],2*.511664*i),n.addScaledVector(c[4],2*.429043*i*r),n.addScaledVector(c[5],2*.429043*r*o),n.addScaledVector(c[6],.743125*o*o-.247708),n.addScaledVector(c[7],2*.429043*i*o),n.addScaledVector(c[8],.429043*(i*i-r*r)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,n+r*3);return this}toArray(e=[],n=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,n+r*3);return e}static getBasisAt(e,n){const i=e.x,r=e.y,o=e.z;n[0]=.282095,n[1]=.488603*r,n[2]=.488603*o,n[3]=.488603*i,n[4]=1.092548*i*r,n[5]=1.092548*r*o,n[6]=.315392*(3*o*o-1),n[7]=1.092548*i*o,n[8]=.546274*(i*i-r*r)}}class yJ extends Rv{constructor(e=new vJ,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class yP extends lc{constructor(e){super(e),this.textures={}}load(e,n,i,r){const o=this,c=new Rf(o.manager);c.setPath(o.path),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(s){try{n(o.parse(JSON.parse(s)))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},i,r)}parse(e){const n=this.textures;function i(o){return n[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),n[o]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new bi().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const c=e.uniforms[o];switch(r.uniforms[o]={},c.type){case"t":r.uniforms[o].value=i(c.value);break;case"c":r.uniforms[o].value=new bi().setHex(c.value);break;case"v2":r.uniforms[o].value=new Cn().fromArray(c.value);break;case"v3":r.uniforms[o].value=new gt().fromArray(c.value);break;case"v4":r.uniforms[o].value=new xs().fromArray(c.value);break;case"m3":r.uniforms[o].value=new dr().fromArray(c.value);break;case"m4":r.uniforms[o].value=new Hi().fromArray(c.value);break;default:r.uniforms[o].value=c.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)r.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=new Cn().fromArray(o)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Cn().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return yP.createMaterialFromType(e)}static createMaterialFromType(e){const n={ShadowMaterial:KY,SpriteMaterial:GB,RawShaderMaterial:YY,ShaderMaterial:ih,PointsMaterial:WB,MeshPhysicalMaterial:JY,MeshStandardMaterial:JB,MeshPhongMaterial:QY,MeshToonMaterial:eJ,MeshNormalMaterial:tJ,MeshLambertMaterial:nJ,MeshDepthMaterial:UB,MeshDistanceMaterial:VB,MeshBasicMaterial:Ev,MeshMatcapMaterial:iJ,LineDashedMaterial:rJ,LineBasicMaterial:ac,Material:nl};return new n[e]}}class Kk{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class _J extends Cr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class xJ extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=new Rf(o.manager);c.setPath(o.path),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(s){try{n(o.parse(JSON.parse(s)))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},i,r)}parse(e){const n={},i={};function r(F,N){if(n[N]!==void 0)return n[N];const L=F.interleavedBuffers[N],P=o(F,L.buffer),H=gx(L.type,P),j=new iP(H,L.stride);return j.uuid=L.uuid,n[N]=j,j}function o(F,N){if(i[N]!==void 0)return i[N];const L=F.arrayBuffers[N],P=new Uint32Array(L).buffer;return i[N]=P,P}const c=e.isInstancedBufferGeometry?new _J:new Cr,s=e.data.index;if(s!==void 0){const F=gx(s.type,s.array);c.setIndex(new ns(F,1))}const f=e.data.attributes;for(const F in f){const N=f[F];let z;if(N.isInterleavedBufferAttribute){const L=r(e.data,N.data);z=new T_(L,N.itemSize,N.offset,N.normalized)}else{const L=gx(N.type,N.array),P=N.isInstancedBufferAttribute?uw:ns;z=new P(L,N.itemSize,N.normalized)}N.name!==void 0&&(z.name=N.name),N.usage!==void 0&&z.setUsage(N.usage),c.setAttribute(F,z)}const v=e.data.morphAttributes;if(v)for(const F in v){const N=v[F],z=[];for(let L=0,P=N.length;L<P;L++){const H=N[L];let j;if(H.isInterleavedBufferAttribute){const q=r(e.data,H.data);j=new T_(q,H.itemSize,H.offset,H.normalized)}else{const q=gx(H.type,H.array);j=new ns(q,H.itemSize,H.normalized)}H.name!==void 0&&(j.name=H.name),z.push(j)}c.morphAttributes[F]=z}e.data.morphTargetsRelative&&(c.morphTargetsRelative=!0);const C=e.data.groups||e.data.drawcalls||e.data.offsets;if(C!==void 0)for(let F=0,N=C.length;F!==N;++F){const z=C[F];c.addGroup(z.start,z.count,z.materialIndex)}const M=e.data.boundingSphere;if(M!==void 0){const F=new gt;M.center!==void 0&&F.fromArray(M.center),c.boundingSphere=new Sl(F,M.radius)}return e.name&&(c.name=e.name),e.userData&&(c.userData=e.userData),c}}class d2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=this.path===""?Kk.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||c;const s=new Rf(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(f){let v=null;try{v=JSON.parse(f)}catch(C){r!==void 0&&r(C),console.error("THREE:ObjectLoader: Can't parse "+e+".",C.message);return}const w=v.metadata;if(w===void 0||w.type===void 0||w.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(v,n)},i,r)}async loadAsync(e,n){const i=this,r=this.path===""?Kk.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const o=new Rf(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const c=await o.loadAsync(e,n),s=JSON.parse(c),f=s.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(s)}parse(e,n){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,r),c=this.parseImages(e.images,function(){n!==void 0&&n(v)}),s=this.parseTextures(e.textures,c),f=this.parseMaterials(e.materials,s),v=this.parseObject(e.object,o,f,s,i),w=this.parseSkeletons(e.skeletons,v);if(this.bindSkeletons(v,w),this.bindLightTargets(v),n!==void 0){let C=!1;for(const M in c)if(c[M].data instanceof HTMLImageElement){C=!0;break}C===!1&&n(v)}return v}async parseAsync(e){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=await this.parseImagesAsync(e.images),c=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,c),f=this.parseObject(e.object,r,s,c,n),v=this.parseSkeletons(e.skeletons,f);return this.bindSkeletons(f,v),this.bindLightTargets(f),f}parseShapes(e){const n={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const o=new nv().fromJSON(e[i]);n[o.uuid]=o}return n}parseSkeletons(e,n){const i={},r={};if(n.traverse(function(o){o.isBone&&(r[o.uuid]=o)}),e!==void 0)for(let o=0,c=e.length;o<c;o++){const s=new rP().fromJSON(e[o],r);i[s.uuid]=s}return i}parseGeometries(e,n){const i={};if(e!==void 0){const r=new xJ;for(let o=0,c=e.length;o<c;o++){let s;const f=e[o];switch(f.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(f);break;default:f.type in mW?s=mW[f.type].fromJSON(f,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${f.type}"`)}s.uuid=f.uuid,f.name!==void 0&&(s.name=f.name),f.userData!==void 0&&(s.userData=f.userData),i[f.uuid]=s}}return i}parseMaterials(e,n){const i={},r={};if(e!==void 0){const o=new yP;o.setTextures(n);for(let c=0,s=e.length;c<s;c++){const f=e[c];i[f.uuid]===void 0&&(i[f.uuid]=o.parse(f)),r[f.uuid]=i[f.uuid]}}return r}parseAnimations(e){const n={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],o=ES.parse(r);n[o.uuid]=o}return n}parseImages(e,n){const i=this,r={};let o;function c(f){return i.manager.itemStart(f),o.load(f,function(){i.manager.itemEnd(f)},void 0,function(){i.manager.itemError(f),i.manager.itemEnd(f)})}function s(f){if(typeof f=="string"){const v=f,w=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(v)?v:i.resourcePath+v;return c(w)}else return f.data?{data:gx(f.type,f.data),width:f.width,height:f.height}:null}if(e!==void 0&&e.length>0){const f=new nz(n);o=new MS(f),o.setCrossOrigin(this.crossOrigin);for(let v=0,w=e.length;v<w;v++){const C=e[v],M=C.url;if(Array.isArray(M)){const F=[];for(let N=0,z=M.length;N<z;N++){const L=M[N],P=s(L);P!==null&&(P instanceof HTMLImageElement?F.push(P):F.push(new Sf(P.data,P.width,P.height)))}r[C.uuid]=new Gy(F)}else{const F=s(C.url);r[C.uuid]=new Gy(F)}}}return r}async parseImagesAsync(e){const n=this,i={};let r;async function o(c){if(typeof c=="string"){const s=c,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s)?s:n.resourcePath+s;return await r.loadAsync(f)}else return c.data?{data:gx(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){r=new MS(this.manager),r.setCrossOrigin(this.crossOrigin);for(let c=0,s=e.length;c<s;c++){const f=e[c],v=f.url;if(Array.isArray(v)){const w=[];for(let C=0,M=v.length;C<M;C++){const F=v[C],N=await o(F);N!==null&&(N instanceof HTMLImageElement?w.push(N):w.push(new Sf(N.data,N.width,N.height)))}i[f.uuid]=new Gy(w)}else{const w=await o(f.url);i[f.uuid]=new Gy(w)}}}return i}parseTextures(e,n){function i(o,c){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),c[o])}const r={};if(e!==void 0)for(let o=0,c=e.length;o<c;o++){const s=e[o];s.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),n[s.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const f=n[s.image],v=f.data;let w;Array.isArray(v)?(w=new cb,v.length===6&&(w.needsUpdate=!0)):(v&&v.data?w=new Sf:w=new Oo,v&&(w.needsUpdate=!0)),w.source=f,w.uuid=s.uuid,s.name!==void 0&&(w.name=s.name),s.mapping!==void 0&&(w.mapping=i(s.mapping,f2e)),s.channel!==void 0&&(w.channel=s.channel),s.offset!==void 0&&w.offset.fromArray(s.offset),s.repeat!==void 0&&w.repeat.fromArray(s.repeat),s.center!==void 0&&w.center.fromArray(s.center),s.rotation!==void 0&&(w.rotation=s.rotation),s.wrap!==void 0&&(w.wrapS=i(s.wrap[0],_W),w.wrapT=i(s.wrap[1],_W)),s.format!==void 0&&(w.format=s.format),s.internalFormat!==void 0&&(w.internalFormat=s.internalFormat),s.type!==void 0&&(w.type=s.type),s.colorSpace!==void 0&&(w.colorSpace=s.colorSpace),s.minFilter!==void 0&&(w.minFilter=i(s.minFilter,xW)),s.magFilter!==void 0&&(w.magFilter=i(s.magFilter,xW)),s.anisotropy!==void 0&&(w.anisotropy=s.anisotropy),s.flipY!==void 0&&(w.flipY=s.flipY),s.generateMipmaps!==void 0&&(w.generateMipmaps=s.generateMipmaps),s.premultiplyAlpha!==void 0&&(w.premultiplyAlpha=s.premultiplyAlpha),s.unpackAlignment!==void 0&&(w.unpackAlignment=s.unpackAlignment),s.compareFunction!==void 0&&(w.compareFunction=s.compareFunction),s.userData!==void 0&&(w.userData=s.userData),r[s.uuid]=w}return r}parseObject(e,n,i,r,o){let c;function s(M){return n[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",M),n[M]}function f(M){if(M!==void 0){if(Array.isArray(M)){const F=[];for(let N=0,z=M.length;N<z;N++){const L=M[N];i[L]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",L),F.push(i[L])}return F}return i[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",M),i[M]}}function v(M){return r[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",M),r[M]}let w,C;switch(e.type){case"Scene":c=new _S,e.background!==void 0&&(Number.isInteger(e.background)?c.background=new bi(e.background):c.background=v(e.background)),e.environment!==void 0&&(c.environment=v(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?c.fog=new nP(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(c.fog=new tP(e.fog.color,e.fog.density)),e.fog.name!==""&&(c.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(c.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(c.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&c.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(c.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&c.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":c=new Ua(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(c.focus=e.focus),e.zoom!==void 0&&(c.zoom=e.zoom),e.filmGauge!==void 0&&(c.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(c.filmOffset=e.filmOffset),e.view!==void 0&&(c.view=Object.assign({},e.view));break;case"OrthographicCamera":c=new hb(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(c.zoom=e.zoom),e.view!==void 0&&(c.view=Object.assign({},e.view));break;case"AmbientLight":c=new mJ(e.color,e.intensity);break;case"DirectionalLight":c=new pJ(e.color,e.intensity),c.target=e.target||"";break;case"PointLight":c=new fJ(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":c=new gJ(e.color,e.intensity,e.width,e.height);break;case"SpotLight":c=new dJ(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),c.target=e.target||"";break;case"HemisphereLight":c=new hJ(e.color,e.groundColor,e.intensity);break;case"LightProbe":c=new yJ().fromJSON(e);break;case"SkinnedMesh":w=s(e.geometry),C=f(e.material),c=new kY(w,C),e.bindMode!==void 0&&(c.bindMode=e.bindMode),e.bindMatrix!==void 0&&c.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(c.skeleton=e.skeleton);break;case"Mesh":w=s(e.geometry),C=f(e.material),c=new va(w,C);break;case"InstancedMesh":w=s(e.geometry),C=f(e.material);const M=e.count,F=e.instanceMatrix,N=e.instanceColor;c=new NY(w,C,M),c.instanceMatrix=new uw(new Float32Array(F.array),16),N!==void 0&&(c.instanceColor=new uw(new Float32Array(N.array),N.itemSize));break;case"BatchedMesh":w=s(e.geometry),C=f(e.material),c=new BY(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,C),c.geometry=w,c.perObjectFrustumCulled=e.perObjectFrustumCulled,c.sortObjects=e.sortObjects,c._drawRanges=e.drawRanges,c._reservedRanges=e.reservedRanges,c._visibility=e.visibility,c._active=e.active,c._bounds=e.bounds.map(z=>{const L=new Ql;L.min.fromArray(z.boxMin),L.max.fromArray(z.boxMax);const P=new Sl;return P.radius=z.sphereRadius,P.center.fromArray(z.sphereCenter),{boxInitialized:z.boxInitialized,box:L,sphereInitialized:z.sphereInitialized,sphere:P}}),c._maxInstanceCount=e.maxInstanceCount,c._maxVertexCount=e.maxVertexCount,c._maxIndexCount=e.maxIndexCount,c._geometryInitialized=e.geometryInitialized,c._geometryCount=e.geometryCount,c._matricesTexture=v(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(c._colorsTexture=v(e.colorsTexture.uuid));break;case"LOD":c=new OY;break;case"Line":c=new fv(s(e.geometry),f(e.material));break;case"LineLoop":c=new zY(s(e.geometry),f(e.material));break;case"LineSegments":c=new If(s(e.geometry),f(e.material));break;case"PointCloud":case"Points":c=new UY(s(e.geometry),f(e.material));break;case"Sprite":c=new LY(f(e.material));break;case"Group":c=new yx;break;case"Bone":c=new HB;break;default:c=new Cs}if(c.uuid=e.uuid,e.name!==void 0&&(c.name=e.name),e.matrix!==void 0?(c.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(c.matrixAutoUpdate=e.matrixAutoUpdate),c.matrixAutoUpdate&&c.matrix.decompose(c.position,c.quaternion,c.scale)):(e.position!==void 0&&c.position.fromArray(e.position),e.rotation!==void 0&&c.rotation.fromArray(e.rotation),e.quaternion!==void 0&&c.quaternion.fromArray(e.quaternion),e.scale!==void 0&&c.scale.fromArray(e.scale)),e.up!==void 0&&c.up.fromArray(e.up),e.castShadow!==void 0&&(c.castShadow=e.castShadow),e.receiveShadow!==void 0&&(c.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(c.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(c.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(c.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(c.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&c.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(c.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(c.visible=e.visible),e.frustumCulled!==void 0&&(c.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(c.renderOrder=e.renderOrder),e.userData!==void 0&&(c.userData=e.userData),e.layers!==void 0&&(c.layers.mask=e.layers),e.children!==void 0){const M=e.children;for(let F=0;F<M.length;F++)c.add(this.parseObject(M[F],n,i,r,o))}if(e.animations!==void 0){const M=e.animations;for(let F=0;F<M.length;F++){const N=M[F];c.animations.push(o[N])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(c.autoUpdate=e.autoUpdate);const M=e.levels;for(let F=0;F<M.length;F++){const N=M[F],z=c.getObjectByProperty("uuid",N.object);z!==void 0&&c.addLevel(z,N.distance,N.hysteresis)}}return c}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=n[i.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(n){if(n.isDirectionalLight||n.isSpotLight){const i=n.target,r=e.getObjectByProperty("uuid",i);r!==void 0?n.target=r:n.target=new Cs}})}}const f2e={UVMapping:jA,CubeReflectionMapping:rm,CubeRefractionMapping:dv,EquirectangularReflectionMapping:uS,EquirectangularRefractionMapping:hS,CubeUVReflectionMapping:Ow},_W={RepeatWrapping:dS,ClampToEdgeWrapping:Yu,MirroredRepeatWrapping:fS},xW={NearestFilter:el,NearestMipmapNearestFilter:CB,NearestMipmapLinearFilter:mx,LinearFilter:Ma,LinearMipmapNearestFilter:R1,LinearMipmapLinearFilter:vf};class p2e extends lc{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=Bp.get(e);if(c!==void 0){if(o.manager.itemStart(e),c.then){c.then(v=>{n&&n(v),o.manager.itemEnd(e)}).catch(v=>{r&&r(v)});return}return setTimeout(function(){n&&n(c),o.manager.itemEnd(e)},0),c}const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader;const f=fetch(e,s).then(function(v){return v.blob()}).then(function(v){return createImageBitmap(v,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(v){return Bp.add(e,v),n&&n(v),o.manager.itemEnd(e),v}).catch(function(v){r&&r(v),Bp.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});Bp.add(e,f),o.manager.itemStart(e)}}let DM;class rz{static getContext(){return DM===void 0&&(DM=new(window.AudioContext||window.webkitAudioContext)),DM}static setContext(e){DM=e}}class m2e extends lc{constructor(e){super(e)}load(e,n,i,r){const o=this,c=new Rf(this.manager);c.setResponseType("arraybuffer"),c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(f){try{const v=f.slice(0);rz.getContext().decodeAudioData(v,function(C){n(C)}).catch(s)}catch(v){s(v)}},i,r);function s(f){r?r(f):console.error(f),o.manager.itemError(e)}}}const wW=new Hi,CW=new Hi,xy=new Hi;class g2e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ua,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ua,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,xy.copy(e.projectionMatrix);const r=n.eyeSep/2,o=r*n.near/n.focus,c=n.near*Math.tan(c_*n.fov*.5)/n.zoom;let s,f;CW.elements[12]=-r,wW.elements[12]=r,s=-c*n.aspect+o,f=c*n.aspect+o,xy.elements[0]=2*n.near/(f-s),xy.elements[8]=(f+s)/(f-s),this.cameraL.projectionMatrix.copy(xy),s=-c*n.aspect-o,f=c*n.aspect-o,xy.elements[0]=2*n.near/(f-s),xy.elements[8]=(f+s)/(f-s),this.cameraR.projectionMatrix.copy(xy)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(CW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wW)}}class sz{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=SW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=SW();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function SW(){return performance.now()}const wy=new gt,bW=new Cl,v2e=new gt,Cy=new gt;class y2e extends Cs{constructor(){super(),this.type="AudioListener",this.context=rz.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new sz}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(wy,bW,v2e),Cy.set(0,0,-1).applyQuaternion(bW),n.positionX){const r=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(wy.x,r),n.positionY.linearRampToValueAtTime(wy.y,r),n.positionZ.linearRampToValueAtTime(wy.z,r),n.forwardX.linearRampToValueAtTime(Cy.x,r),n.forwardY.linearRampToValueAtTime(Cy.y,r),n.forwardZ.linearRampToValueAtTime(Cy.z,r),n.upX.linearRampToValueAtTime(i.x,r),n.upY.linearRampToValueAtTime(i.y,r),n.upZ.linearRampToValueAtTime(i.z,r)}else n.setPosition(wy.x,wy.y,wy.z),n.setOrientation(Cy.x,Cy.y,Cy.z,i.x,i.y,i.z)}}class wJ extends Cs{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Sy=new gt,EW=new Cl,_2e=new gt,by=new gt;class x2e extends wJ{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Sy,EW,_2e),by.set(0,0,1).applyQuaternion(EW);const n=this.panner;if(n.positionX){const i=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Sy.x,i),n.positionY.linearRampToValueAtTime(Sy.y,i),n.positionZ.linearRampToValueAtTime(Sy.z,i),n.orientationX.linearRampToValueAtTime(by.x,i),n.orientationY.linearRampToValueAtTime(by.y,i),n.orientationZ.linearRampToValueAtTime(by.z,i)}else n.setPosition(Sy.x,Sy.y,Sy.z),n.setOrientation(by.x,by.y,by.z)}}class w2e{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let i=0;i<n.length;i++)e+=n[i];return e/n.length}}class CJ{constructor(e,n,i){this.binding=e,this.valueSize=i;let r,o,c;switch(n){case"quaternion":r=this._slerp,o=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,o=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const i=this.buffer,r=this.valueSize,o=e*r+r;let c=this.cumulativeWeight;if(c===0){for(let s=0;s!==r;++s)i[o+s]=i[s];c=n}else{c+=n;const s=n/c;this._mixBufferRegion(i,o,0,s,r)}this.cumulativeWeight=c}accumulateAdditive(e){const n=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,i=this.buffer,r=e*n+n,o=this.cumulativeWeight,c=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const f=n*this._origIndex;this._mixBufferRegion(i,r,f,1-o,n)}c>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let f=n,v=n+n;f!==v;++f)if(i[f]!==i[f+n]){s.setValue(i,r);break}}saveOriginalState(){const e=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(n,r);for(let o=i,c=r;o!==c;++o)n[o]=n[r+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,r,o){if(r>=.5)for(let c=0;c!==o;++c)e[n+c]=e[i+c]}_slerp(e,n,i,r){Cl.slerpFlat(e,n,e,n,e,i,r)}_slerpAdditive(e,n,i,r,o){const c=this._workIndex*o;Cl.multiplyQuaternionsFlat(e,c,e,n,e,i),Cl.slerpFlat(e,n,e,n,e,c,r)}_lerp(e,n,i,r,o){const c=1-r;for(let s=0;s!==o;++s){const f=n+s;e[f]=e[f]*c+e[i+s]*r}}_lerpAdditive(e,n,i,r,o){for(let c=0;c!==o;++c){const s=n+c;e[s]=e[s]+e[i+c]*r}}}const oz="\\[\\]\\.:\\/",C2e=new RegExp("["+oz+"]","g"),az="[^"+oz+"]",S2e="[^"+oz.replace("\\.","")+"]",b2e=/((?:WC+[\/:])*)/.source.replace("WC",az),E2e=/(WCOD+)?/.source.replace("WCOD",S2e),M2e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",az),R2e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",az),T2e=new RegExp("^"+b2e+E2e+M2e+R2e+"$"),A2e=["material","materials","bones","map"];class P2e{constructor(e,n,i){const r=i||ys.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,r)}getValue(e,n){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,n)}setValue(e,n){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].unbind()}}class ys{constructor(e,n,i){this.path=n,this.parsedPath=i||ys.parseTrackName(n),this.node=ys.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new ys.Composite(e,n,i):new ys(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(C2e,"")}static parseTrackName(e){const n=T2e.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=i.nodeName.substring(r+1);A2e.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){const i=function(o){for(let c=0;c<o.length;c++){const s=o[c];if(s.name===n||s.uuid===n)return s;const f=i(s.children);if(f)return f}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)e[n++]=i[r]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,r=n.propertyName;let o=n.propertyIndex;if(e||(e=ys.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let v=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let w=0;w<e.length;w++)if(e[w].name===v){v=w;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(v!==void 0){if(e[v]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[v]}}const c=e[r];if(c===void 0){const v=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+v+"."+r+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let f=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}f=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else c.fromArray!==void 0&&c.toArray!==void 0?(f=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(f=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=r;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ys.Composite=P2e;ys.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ys.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ys.prototype.GetterByBindingType=[ys.prototype._getValue_direct,ys.prototype._getValue_array,ys.prototype._getValue_arrayElement,ys.prototype._getValue_toArray];ys.prototype.SetterByBindingTypeAndVersioning=[[ys.prototype._setValue_direct,ys.prototype._setValue_direct_setNeedsUpdate,ys.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ys.prototype._setValue_array,ys.prototype._setValue_array_setNeedsUpdate,ys.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ys.prototype._setValue_arrayElement,ys.prototype._setValue_arrayElement_setNeedsUpdate,ys.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ys.prototype._setValue_fromArray,ys.prototype._setValue_fromArray_setNeedsUpdate,ys.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class I2e{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xu(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,i=this._paths,r=this._parsedPaths,o=this._bindings,c=o.length;let s,f=e.length,v=this.nCachedObjects_;for(let w=0,C=arguments.length;w!==C;++w){const M=arguments[w],F=M.uuid;let N=n[F];if(N===void 0){N=f++,n[F]=N,e.push(M);for(let z=0,L=c;z!==L;++z)o[z].push(new ys(M,i[z],r[z]))}else if(N<v){s=e[N];const z=--v,L=e[z];n[L.uuid]=N,e[N]=L,n[F]=z,e[z]=M;for(let P=0,H=c;P!==H;++P){const j=o[P],q=j[z];let le=j[N];j[N]=q,le===void 0&&(le=new ys(M,i[P],r[P])),j[z]=le}}else e[N]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=v}remove(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,r=i.length;let o=this.nCachedObjects_;for(let c=0,s=arguments.length;c!==s;++c){const f=arguments[c],v=f.uuid,w=n[v];if(w!==void 0&&w>=o){const C=o++,M=e[C];n[M.uuid]=w,e[w]=M,n[v]=C,e[C]=f;for(let F=0,N=r;F!==N;++F){const z=i[F],L=z[C],P=z[w];z[w]=L,z[C]=P}}}this.nCachedObjects_=o}uncache(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,r=i.length;let o=this.nCachedObjects_,c=e.length;for(let s=0,f=arguments.length;s!==f;++s){const v=arguments[s],w=v.uuid,C=n[w];if(C!==void 0)if(delete n[w],C<o){const M=--o,F=e[M],N=--c,z=e[N];n[F.uuid]=C,e[C]=F,n[z.uuid]=M,e[M]=z,e.pop();for(let L=0,P=r;L!==P;++L){const H=i[L],j=H[M],q=H[N];H[C]=j,H[M]=q,H.pop()}}else{const M=--c,F=e[M];M>0&&(n[F.uuid]=C),e[C]=F,e.pop();for(let N=0,z=r;N!==z;++N){const L=i[N];L[C]=L[M],L.pop()}}}this.nCachedObjects_=o}subscribe_(e,n){const i=this._bindingsIndicesByPath;let r=i[e];const o=this._bindings;if(r!==void 0)return o[r];const c=this._paths,s=this._parsedPaths,f=this._objects,v=f.length,w=this.nCachedObjects_,C=new Array(v);r=o.length,i[e]=r,c.push(e),s.push(n),o.push(C);for(let M=w,F=f.length;M!==F;++M){const N=f[M];C[M]=new ys(N,e,n)}return C}unsubscribe_(e){const n=this._bindingsIndicesByPath,i=n[e];if(i!==void 0){const r=this._paths,o=this._parsedPaths,c=this._bindings,s=c.length-1,f=c[s],v=e[s];n[v]=i,c[i]=f,c.pop(),o[i]=o[s],o.pop(),r[i]=r[s],r.pop()}}}class SJ{constructor(e,n,i=null,r=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=r;const o=n.tracks,c=o.length,s=new Array(c),f={endingStart:Uy,endingEnd:Uy};for(let v=0;v!==c;++v){const w=o[v].createInterpolant(null);s[v]=w,w.settings=f}this._interpolantSettings=f,this._interpolants=s,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=rY,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){const r=this._clip.duration,o=e._clip.duration,c=o/r,s=r/o;e.warp(1,c,n),this.warp(s,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){const r=this._mixer,o=r.time,c=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const f=s.parameterPositions,v=s.sampleValues;return f[0]=o,f[1]=o+i,v[0]=e/c,v[1]=n/c,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,r){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const f=(e-o)*i;f<0||i===0?n=0:(this._startTime=null,n=i*f)}n*=this._updateTimeScale(e);const c=this._updateTime(n),s=this._updateWeight(e);if(s>0){const f=this._interpolants,v=this._propertyBindings;switch(this.blendMode){case DB:for(let w=0,C=f.length;w!==C;++w)f[w].evaluate(c),v[w].accumulateAdditive(s);break;case JA:default:for(let w=0,C=f.length;w!==C;++w)f[w].evaluate(c),v[w].accumulate(r,s)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,i=this.loop;let r=this.time+e,o=this._loopCount;const c=i===sY;if(e===0)return o===-1?r:c&&(o&1)===1?n-r:r;if(i===iY){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=n)r=n;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),r>=n||r<0){const s=Math.floor(r/n);r-=n*s,o+=Math.abs(s);const f=this.repetitions-o;if(f<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?n:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(f===1){const v=e<0;this._setEndings(v,!v,c)}else this._setEndings(!1,!1,c);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=r;if(c&&(o&1)===1)return n-r}return r}_setEndings(e,n,i){const r=this._interpolantSettings;i?(r.endingStart=Vy,r.endingEnd=Vy):(e?r.endingStart=this.zeroSlopeAtStart?Vy:Uy:r.endingStart=mS,n?r.endingEnd=this.zeroSlopeAtEnd?Vy:Uy:r.endingEnd=mS)}_scheduleFading(e,n,i){const r=this._mixer,o=r.time;let c=this._weightInterpolant;c===null&&(c=r._lendControlInterpolant(),this._weightInterpolant=c);const s=c.parameterPositions,f=c.sampleValues;return s[0]=o,f[0]=n,s[1]=o+e,f[1]=i,this}}const D2e=new Float32Array(1);class F2e extends Pf{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const i=e._localRoot||this._root,r=e._clip.tracks,o=r.length,c=e._propertyBindings,s=e._interpolants,f=i.uuid,v=this._bindingsByRootAndName;let w=v[f];w===void 0&&(w={},v[f]=w);for(let C=0;C!==o;++C){const M=r[C],F=M.name;let N=w[F];if(N!==void 0)++N.referenceCount,c[C]=N;else{if(N=c[C],N!==void 0){N._cacheIndex===null&&(++N.referenceCount,this._addInactiveBinding(N,f,F));continue}const z=n&&n._propertyBindings[C].binding.parsedPath;N=new CJ(ys.create(i,F,z),M.ValueTypeName,M.getValueSize()),++N.referenceCount,this._addInactiveBinding(N,f,F),c[C]=N}s[C].resultBuffer=N.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,i)}const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const o=n[i];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const o=n[i];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){const r=this._actions,o=this._actionsByClip;let c=o[n];if(c===void 0)c={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[n]=c;else{const s=c.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),c.actionByRoot[i]=e}_removeInactiveAction(e){const n=this._actions,i=n[n.length-1],r=e._cacheIndex;i._cacheIndex=r,n[r]=i,n.pop(),e._cacheIndex=null;const o=e._clip.uuid,c=this._actionsByClip,s=c[o],f=s.knownActions,v=f[f.length-1],w=e._byClipCacheIndex;v._byClipCacheIndex=w,f[w]=v,f.pop(),e._byClipCacheIndex=null;const C=s.actionByRoot,M=(e._localRoot||this._root).uuid;delete C[M],f.length===0&&delete c[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const o=n[i];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const n=this._actions,i=e._cacheIndex,r=this._nActiveActions++,o=n[r];e._cacheIndex=r,n[r]=e,o._cacheIndex=i,n[i]=o}_takeBackAction(e){const n=this._actions,i=e._cacheIndex,r=--this._nActiveActions,o=n[r];e._cacheIndex=r,n[r]=e,o._cacheIndex=i,n[i]=o}_addInactiveBinding(e,n,i){const r=this._bindingsByRootAndName,o=this._bindings;let c=r[n];c===void 0&&(c={},r[n]=c),c[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const n=this._bindings,i=e.binding,r=i.rootNode.uuid,o=i.path,c=this._bindingsByRootAndName,s=c[r],f=n[n.length-1],v=e._cacheIndex;f._cacheIndex=v,n[v]=f,n.pop(),delete s[o],Object.keys(s).length===0&&delete c[r]}_lendBinding(e){const n=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,o=n[r];e._cacheIndex=r,n[r]=e,o._cacheIndex=i,n[i]=o}_takeBackBinding(e){const n=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,o=n[r];e._cacheIndex=r,n[r]=e,o._cacheIndex=i,n[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=e[n];return i===void 0&&(i=new ez(new Float32Array(2),new Float32Array(2),1,D2e),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){const n=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=n[r];e.__cacheIndex=r,n[r]=e,o.__cacheIndex=i,n[i]=o}clipAction(e,n,i){const r=n||this._root,o=r.uuid;let c=typeof e=="string"?ES.findByName(r,e):e;const s=c!==null?c.uuid:e,f=this._actionsByClip[s];let v=null;if(i===void 0&&(c!==null?i=c.blendMode:i=JA),f!==void 0){const C=f.actionByRoot[o];if(C!==void 0&&C.blendMode===i)return C;v=f.knownActions[0],c===null&&(c=v._clip)}if(c===null)return null;const w=new SJ(this,c,n,i);return this._bindAction(w,v),this._addInactiveAction(w,s,o),w}existingAction(e,n){const i=n||this._root,r=i.uuid,o=typeof e=="string"?ES.findByName(i,e):e,c=o?o.uuid:e,s=this._actionsByClip[c];return s!==void 0&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let i=n-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const n=this._actions,i=this._nActiveActions,r=this.time+=e,o=Math.sign(e),c=this._accuIndex^=1;for(let v=0;v!==i;++v)n[v]._update(r,e,o,c);const s=this._bindings,f=this._nActiveBindings;for(let v=0;v!==f;++v)s[v].apply(c);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,i=e.uuid,r=this._actionsByClip,o=r[i];if(o!==void 0){const c=o.knownActions;for(let s=0,f=c.length;s!==f;++s){const v=c[s];this._deactivateAction(v);const w=v._cacheIndex,C=n[n.length-1];v._cacheIndex=null,v._byClipCacheIndex=null,C._cacheIndex=w,n[w]=C,n.pop(),this._removeInactiveBindingsForAction(v)}delete r[i]}}uncacheRoot(e){const n=e.uuid,i=this._actionsByClip;for(const c in i){const s=i[c].actionByRoot,f=s[n];f!==void 0&&(this._deactivateAction(f),this._removeInactiveAction(f))}const r=this._bindingsByRootAndName,o=r[n];if(o!==void 0)for(const c in o){const s=o[c];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,n){const i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class lz{constructor(e){this.value=e}clone(){return new lz(this.value.clone===void 0?this.value:this.value.clone())}}let L2e=0;class O2e extends Pf{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:L2e++}),this.name="",this.usage=gS,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let i=0,r=n.length;i<r;i++){const o=Array.isArray(n[i])?n[i]:[n[i]];for(let c=0;c<o.length;c++)this.uniforms.push(o[c].clone())}return this}clone(){return new this.constructor().copy(this)}}class k2e extends iP{constructor(e,n,i=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class N2e{constructor(e,n,i,r,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=i,this.elementSize=r,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const MW=new Hi;class cz{constructor(e,n,i=0,r=1/0){this.ray=new Nw(e,n),this.near=i,this.far=r,this.camera=null,this.layers=new u_,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return MW.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(MW),this}intersectObject(e,n=!0,i=[]){return Yk(e,this,i,n),i.sort(RW),i}intersectObjects(e,n=!0,i=[]){for(let r=0,o=e.length;r<o;r++)Yk(e[r],this,i,n);return i.sort(RW),i}}function RW(t,e){return t.distance-e.distance}function Yk(t,e,n,i){let r=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(r=!1),r===!0&&i===!0){const o=t.children;for(let c=0,s=o.length;c<s;c++)Yk(o[c],e,n,!0)}}class B2e{constructor(e=1,n=0,i=0){return this.radius=e,this.phi=n,this.theta=i,this}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Xo(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class z2e{constructor(e=1,n=0,i=0){return this.radius=e,this.theta=n,this.y=i,this}set(e,n,i){return this.radius=e,this.theta=n,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=n,this}clone(){return new this.constructor().copy(this)}}class uz{constructor(e,n,i,r){uz.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,n,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,n=0){for(let i=0;i<4;i++)this.elements[i]=e[i+n];return this}set(e,n,i,r){const o=this.elements;return o[0]=e,o[2]=n,o[1]=i,o[3]=r,this}}const TW=new Cn;class bJ{constructor(e=new Cn(1/0,1/0),n=new Cn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=TW.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,TW).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const AW=new gt,FM=new gt;class U2e{constructor(e=new gt,n=new gt){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){AW.subVectors(e,this.start),FM.subVectors(this.end,this.start);const i=FM.dot(FM);let o=FM.dot(AW)/i;return n&&(o=Xo(o,0,1)),o}closestPointToPoint(e,n,i){const r=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const PW=new gt;class V2e extends Cs{constructor(e,n){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const i=new Cr,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let c=0,s=1,f=32;c<f;c++,s++){const v=c/f*Math.PI*2,w=s/f*Math.PI*2;r.push(Math.cos(v),Math.sin(v),1,Math.cos(w),Math.sin(w),1)}i.setAttribute("position",new Ni(r,3));const o=new ac({fog:!1,toneMapped:!1});this.cone=new If(i,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),PW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(PW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Cg=new gt,LM=new Hi,z2=new Hi;class G2e extends If{constructor(e){const n=EJ(e),i=new Cr,r=[],o=[],c=new bi(0,0,1),s=new bi(0,1,0);for(let v=0;v<n.length;v++){const w=n[v];w.parent&&w.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(c.r,c.g,c.b),o.push(s.r,s.g,s.b))}i.setAttribute("position",new Ni(r,3)),i.setAttribute("color",new Ni(o,3));const f=new ac({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,f),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,i=this.geometry,r=i.getAttribute("position");z2.copy(this.root.matrixWorld).invert();for(let o=0,c=0;o<n.length;o++){const s=n[o];s.parent&&s.parent.isBone&&(LM.multiplyMatrices(z2,s.matrixWorld),Cg.setFromMatrixPosition(LM),r.setXYZ(c,Cg.x,Cg.y,Cg.z),LM.multiplyMatrices(z2,s.parent.matrixWorld),Cg.setFromMatrixPosition(LM),r.setXYZ(c+1,Cg.x,Cg.y,Cg.z),c+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function EJ(t){const e=[];t.isBone===!0&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,EJ(t.children[n]));return e}class H2e extends va{constructor(e,n,i){const r=new gb(n,4,2),o=new Ev({wireframe:!0,fog:!1,toneMapped:!1});super(r,o),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const W2e=new gt,IW=new bi,DW=new bi;class j2e extends Cs{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new pb(n);r.rotateY(Math.PI*.5),this.material=new Ev({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=r.getAttribute("position"),c=new Float32Array(o.count*3);r.setAttribute("color",new ns(c,3)),this.add(new va(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");IW.copy(this.light.color),DW.copy(this.light.groundColor);for(let i=0,r=n.count;i<r;i++){const o=i<r/2?IW:DW;n.setXYZ(i,o.r,o.g,o.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(W2e.setFromMatrixPosition(this.light.matrixWorld).negate())}}class $2e extends If{constructor(e=10,n=10,i=4473924,r=8947848){i=new bi(i),r=new bi(r);const o=n/2,c=e/n,s=e/2,f=[],v=[];for(let M=0,F=0,N=-s;M<=n;M++,N+=c){f.push(-s,0,N,s,0,N),f.push(N,0,-s,N,0,s);const z=M===o?i:r;z.toArray(v,F),F+=3,z.toArray(v,F),F+=3,z.toArray(v,F),F+=3,z.toArray(v,F),F+=3}const w=new Cr;w.setAttribute("position",new Ni(f,3)),w.setAttribute("color",new Ni(v,3));const C=new ac({vertexColors:!0,toneMapped:!1});super(w,C),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class q2e extends If{constructor(e=10,n=16,i=8,r=64,o=4473924,c=8947848){o=new bi(o),c=new bi(c);const s=[],f=[];if(n>1)for(let C=0;C<n;C++){const M=C/n*(Math.PI*2),F=Math.sin(M)*e,N=Math.cos(M)*e;s.push(0,0,0),s.push(F,0,N);const z=C&1?o:c;f.push(z.r,z.g,z.b),f.push(z.r,z.g,z.b)}for(let C=0;C<i;C++){const M=C&1?o:c,F=e-e/i*C;for(let N=0;N<r;N++){let z=N/r*(Math.PI*2),L=Math.sin(z)*F,P=Math.cos(z)*F;s.push(L,0,P),f.push(M.r,M.g,M.b),z=(N+1)/r*(Math.PI*2),L=Math.sin(z)*F,P=Math.cos(z)*F,s.push(L,0,P),f.push(M.r,M.g,M.b)}}const v=new Cr;v.setAttribute("position",new Ni(s,3)),v.setAttribute("color",new Ni(f,3));const w=new ac({vertexColors:!0,toneMapped:!1});super(v,w),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const FW=new gt,OM=new gt,LW=new gt;class Z2e extends Cs{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",n===void 0&&(n=1);let r=new Cr;r.setAttribute("position",new Ni([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const o=new ac({fog:!1,toneMapped:!1});this.lightPlane=new fv(r,o),this.add(this.lightPlane),r=new Cr,r.setAttribute("position",new Ni([0,0,0,0,0,1],3)),this.targetLine=new fv(r,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),FW.setFromMatrixPosition(this.light.matrixWorld),OM.setFromMatrixPosition(this.light.target.matrixWorld),LW.subVectors(OM,FW),this.lightPlane.lookAt(OM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(OM),this.targetLine.scale.z=LW.length()}}const kM=new gt,jo=new lb;class X2e extends If{constructor(e){const n=new Cr,i=new ac({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],o=[],c={};s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4");function s(N,z){f(N),f(z)}function f(N){r.push(0,0,0),o.push(0,0,0),c[N]===void 0&&(c[N]=[]),c[N].push(r.length/3-1)}n.setAttribute("position",new Ni(r,3)),n.setAttribute("color",new Ni(o,3)),super(n,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=c,this.update();const v=new bi(16755200),w=new bi(16711680),C=new bi(43775),M=new bi(16777215),F=new bi(3355443);this.setColors(v,w,C,M,F)}setColors(e,n,i,r,o){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,n.r,n.g,n.b),s.setXYZ(25,n.r,n.g,n.b),s.setXYZ(26,n.r,n.g,n.b),s.setXYZ(27,n.r,n.g,n.b),s.setXYZ(28,n.r,n.g,n.b),s.setXYZ(29,n.r,n.g,n.b),s.setXYZ(30,n.r,n.g,n.b),s.setXYZ(31,n.r,n.g,n.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,o.r,o.g,o.b),s.setXYZ(41,o.r,o.g,o.b),s.setXYZ(42,o.r,o.g,o.b),s.setXYZ(43,o.r,o.g,o.b),s.setXYZ(44,o.r,o.g,o.b),s.setXYZ(45,o.r,o.g,o.b),s.setXYZ(46,o.r,o.g,o.b),s.setXYZ(47,o.r,o.g,o.b),s.setXYZ(48,o.r,o.g,o.b),s.setXYZ(49,o.r,o.g,o.b),s.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap,i=1,r=1;jo.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),sa("c",n,e,jo,0,0,-1),sa("t",n,e,jo,0,0,1),sa("n1",n,e,jo,-i,-r,-1),sa("n2",n,e,jo,i,-r,-1),sa("n3",n,e,jo,-i,r,-1),sa("n4",n,e,jo,i,r,-1),sa("f1",n,e,jo,-i,-r,1),sa("f2",n,e,jo,i,-r,1),sa("f3",n,e,jo,-i,r,1),sa("f4",n,e,jo,i,r,1),sa("u1",n,e,jo,i*.7,r*1.1,-1),sa("u2",n,e,jo,-i*.7,r*1.1,-1),sa("u3",n,e,jo,0,r*2,-1),sa("cf1",n,e,jo,-i,0,1),sa("cf2",n,e,jo,i,0,1),sa("cf3",n,e,jo,0,-r,1),sa("cf4",n,e,jo,0,r,1),sa("cn1",n,e,jo,-i,0,-1),sa("cn2",n,e,jo,i,0,-1),sa("cn3",n,e,jo,0,-r,-1),sa("cn4",n,e,jo,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function sa(t,e,n,i,r,o,c){kM.set(r,o,c).unproject(i);const s=e[t];if(s!==void 0){const f=n.getAttribute("position");for(let v=0,w=s.length;v<w;v++)f.setXYZ(s[v],kM.x,kM.y,kM.z)}}const NM=new Ql;class K2e extends If{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),o=new Cr;o.setIndex(new ns(i,1)),o.setAttribute("position",new ns(r,3)),super(o,new ac({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&NM.setFromObject(this.object),NM.isEmpty())return;const n=NM.min,i=NM.max,r=this.geometry.attributes.position,o=r.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=n.x,o[4]=i.y,o[5]=i.z,o[6]=n.x,o[7]=n.y,o[8]=i.z,o[9]=i.x,o[10]=n.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=n.z,o[15]=n.x,o[16]=i.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=i.x,o[22]=n.y,o[23]=n.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Y2e extends If{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Cr;o.setIndex(new ns(i,1)),o.setAttribute("position",new Ni(r,3)),super(o,new ac({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class J2e extends fv{constructor(e,n=1,i=16776960){const r=i,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],c=new Cr;c.setAttribute("position",new Ni(o,3)),c.computeBoundingSphere(),super(c,new ac({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],f=new Cr;f.setAttribute("position",new Ni(s,3)),f.computeBoundingSphere(),this.add(new va(f,new Ev({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const OW=new gt;let BM,U2;class Q2e extends Cs{constructor(e=new gt(0,0,1),n=new gt(0,0,0),i=1,r=16776960,o=i*.2,c=o*.2){super(),this.type="ArrowHelper",BM===void 0&&(BM=new Cr,BM.setAttribute("position",new Ni([0,0,0,0,1,0],3)),U2=new Uw(0,.5,1,5,1),U2.translate(0,-.5,0)),this.position.copy(n),this.line=new fv(BM,new ac({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new va(U2,new Ev({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,o,c)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{OW.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(OW,n)}}setLength(e,n=e*.2,i=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(i,n,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class eFe extends If{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Cr;r.setAttribute("position",new Ni(n,3)),r.setAttribute("color",new Ni(i,3));const o=new ac({vertexColors:!0,toneMapped:!1});super(r,o),this.type="AxesHelper"}setColors(e,n,i){const r=new bi,o=this.geometry.attributes.color.array;return r.set(e),r.toArray(o,0),r.toArray(o,3),r.set(n),r.toArray(o,6),r.toArray(o,9),r.set(i),r.toArray(o,12),r.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Eg{constructor(){this.type="ShapePath",this.color=new bi,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new tv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,i,r){return this.currentPath.quadraticCurveTo(e,n,i,r),this}bezierCurveTo(e,n,i,r,o,c){return this.currentPath.bezierCurveTo(e,n,i,r,o,c),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(P){const H=[];for(let j=0,q=P.length;j<q;j++){const le=P[j],ce=new nv;ce.curves=le.curves,H.push(ce)}return H}function i(P,H){const j=H.length;let q=!1;for(let le=j-1,ce=0;ce<j;le=ce++){let ae=H[le],pe=H[ce],fe=pe.x-ae.x,ue=pe.y-ae.y;if(Math.abs(ue)>Number.EPSILON){if(ue<0&&(ae=H[ce],fe=-fe,pe=H[le],ue=-ue),P.y<ae.y||P.y>pe.y)continue;if(P.y===ae.y){if(P.x===ae.x)return!0}else{const Ee=ue*(P.x-ae.x)-fe*(P.y-ae.y);if(Ee===0)return!0;if(Ee<0)continue;q=!q}}else{if(P.y!==ae.y)continue;if(pe.x<=P.x&&P.x<=ae.x||ae.x<=P.x&&P.x<=pe.x)return!0}}return q}const r=od.isClockWise,o=this.subPaths;if(o.length===0)return[];let c,s,f;const v=[];if(o.length===1)return s=o[0],f=new nv,f.curves=s.curves,v.push(f),v;let w=!r(o[0].getPoints());w=e?!w:w;const C=[],M=[];let F=[],N=0,z;M[N]=void 0,F[N]=[];for(let P=0,H=o.length;P<H;P++)s=o[P],z=s.getPoints(),c=r(z),c=e?!c:c,c?(!w&&M[N]&&N++,M[N]={s:new nv,p:z},M[N].s.curves=s.curves,w&&N++,F[N]=[]):F[N].push({h:s,p:z[0]});if(!M[0])return n(o);if(M.length>1){let P=!1,H=0;for(let j=0,q=M.length;j<q;j++)C[j]=[];for(let j=0,q=M.length;j<q;j++){const le=F[j];for(let ce=0;ce<le.length;ce++){const ae=le[ce];let pe=!0;for(let fe=0;fe<M.length;fe++)i(ae.p,M[fe].p)&&(j!==fe&&H++,pe?(pe=!1,C[fe].push(ae)):P=!0);pe&&C[j].push(ae)}}H>0&&P===!1&&(F=C)}let L;for(let P=0,H=M.length;P<H;P++){f=M[P].s,v.push(f),L=F[P];for(let j=0,q=L.length;j<q;j++)f.holes.push(L[j].h)}return v}}class tFe extends Pf{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class nFe extends fd{constructor(e=1,n=1,i=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,n,{...r,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rb}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rb);const MJ=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:wB,AddEquation:Ig,AddOperation:XK,AdditiveAnimationBlendMode:DB,AdditiveBlending:Nk,AgXToneMapping:eY,AlphaFormat:MB,AlwaysCompare:mY,AlwaysDepth:ST,AlwaysStencilFunc:Vk,AmbientLight:mJ,AnimationAction:SJ,AnimationClip:ES,AnimationLoader:r2e,AnimationMixer:F2e,AnimationObjectGroup:I2e,AnimationUtils:e2e,ArcCurve:VY,ArrayCamera:IY,ArrowHelper:Q2e,AttachedBindMode:Uk,Audio:wJ,AudioAnalyser:w2e,AudioContext:rz,AudioListener:y2e,AudioLoader:m2e,AxesHelper:eFe,BackSide:Jl,BasicDepthPacking:oY,BasicShadowMap:AK,BatchedMesh:BY,Bone:HB,BooleanKeyframeTrack:j_,Box2:bJ,Box3:Ql,Box3Helper:Y2e,BoxGeometry:W_,BoxHelper:K2e,BufferAttribute:ns,BufferGeometry:Cr,BufferGeometryLoader:xJ,ByteType:SB,Cache:Bp,Camera:lb,CameraHelper:X2e,CanvasTexture:bDe,CapsuleGeometry:aP,CatmullRomCurve3:GY,CineonToneMapping:JK,CircleGeometry:fb,ClampToEdgeWrapping:Yu,Clock:sz,Color:bi,ColorKeyframeTrack:tz,ColorManagement:ls,CompressedArrayTexture:CDe,CompressedCubeTexture:SDe,CompressedTexture:sP,CompressedTextureLoader:s2e,ConeGeometry:lP,ConstantAlphaFactor:$K,ConstantColorFactor:WK,Controls:tFe,CubeCamera:SY,CubeReflectionMapping:rm,CubeRefractionMapping:dv,CubeTexture:cb,CubeTextureLoader:o2e,CubeUVReflectionMapping:Ow,CubicBezierCurve:$B,CubicBezierCurve3:HY,CubicInterpolant:aJ,CullFaceBack:kk,CullFaceFront:TK,CullFaceFrontBack:JEe,CullFaceNone:RK,Curve:yd,CurvePath:jY,CustomBlending:PK,CustomToneMapping:QK,CylinderGeometry:Uw,Cylindrical:z2e,Data3DTexture:OB,DataArrayTexture:QA,DataTexture:Sf,DataTextureLoader:a2e,DataUtils:dRe,DecrementStencilOp:dMe,DecrementWrapStencilOp:pMe,DefaultLoadingManager:uJ,DepthFormat:l_,DepthStencilFormat:R_,DepthTexture:zB,DetachedBindMode:nY,DirectionalLight:pJ,DirectionalLightHelper:Z2e,DiscreteInterpolant:lJ,DodecahedronGeometry:cP,DoubleSide:gf,DstAlphaFactor:zK,DstColorFactor:VK,DynamicCopyUsage:AMe,DynamicDrawUsage:SMe,DynamicReadUsage:MMe,EdgesGeometry:YB,EllipseCurve:oP,EqualCompare:hY,EqualDepth:ET,EqualStencilFunc:yMe,EquirectangularReflectionMapping:uS,EquirectangularRefractionMapping:hS,Euler:nc,EventDispatcher:Pf,ExtrudeGeometry:hP,FileLoader:Rf,Float16BufferAttribute:yRe,Float32BufferAttribute:Ni,FloatType:kc,Fog:nP,FogExp2:tP,FramebufferTexture:wDe,FrontSide:im,Frustum:ub,GLBufferAttribute:N2e,GLSL1:IMe,GLSL3:Gk,GreaterCompare:dY,GreaterDepth:RT,GreaterEqualCompare:pY,GreaterEqualDepth:MT,GreaterEqualStencilFunc:CMe,GreaterStencilFunc:xMe,GridHelper:$2e,Group:yx,HalfFloatType:kw,HemisphereLight:hJ,HemisphereLightHelper:j2e,IcosahedronGeometry:dP,ImageBitmapLoader:p2e,ImageLoader:MS,ImageUtils:yY,IncrementStencilOp:hMe,IncrementWrapStencilOp:fMe,InstancedBufferAttribute:uw,InstancedBufferGeometry:_J,InstancedInterleavedBuffer:k2e,InstancedMesh:NY,Int16BufferAttribute:gRe,Int32BufferAttribute:vRe,Int8BufferAttribute:fRe,IntType:$A,InterleavedBuffer:iP,InterleavedBufferAttribute:T_,Interpolant:vb,InterpolateDiscrete:pS,InterpolateLinear:tA,InterpolateSmooth:pR,InvertStencilOp:mMe,KeepStencilOp:Ay,KeyframeTrack:_d,LOD:OY,LatheGeometry:db,Layers:u_,LessCompare:uY,LessDepth:bT,LessEqualCompare:FB,LessEqualDepth:E_,LessEqualStencilFunc:_Me,LessStencilFunc:vMe,Light:Rv,LightProbe:yJ,Line:fv,Line3:U2e,LineBasicMaterial:ac,LineCurve:qB,LineCurve3:WY,LineDashedMaterial:rJ,LineLoop:zY,LineSegments:If,LinearFilter:Ma,LinearInterpolant:ez,LinearMipMapLinearFilter:nMe,LinearMipMapNearestFilter:tMe,LinearMipmapLinearFilter:vf,LinearMipmapNearestFilter:R1,LinearSRGBColorSpace:H_,LinearToneMapping:KK,LinearTransfer:ab,Loader:lc,LoaderUtils:Kk,LoadingManager:nz,LoopOnce:iY,LoopPingPong:sY,LoopRepeat:rY,LuminanceAlphaFormat:AB,LuminanceFormat:TB,MOUSE:KEe,Material:nl,MaterialLoader:yP,MathUtils:ZMe,Matrix2:uz,Matrix3:dr,Matrix4:Hi,MaxEquation:LK,Mesh:va,MeshBasicMaterial:Ev,MeshDepthMaterial:UB,MeshDistanceMaterial:VB,MeshLambertMaterial:nJ,MeshMatcapMaterial:iJ,MeshNormalMaterial:tJ,MeshPhongMaterial:QY,MeshPhysicalMaterial:JY,MeshStandardMaterial:JB,MeshToonMaterial:eJ,MinEquation:FK,MirroredRepeatWrapping:fS,MixOperation:ZK,MultiplyBlending:zk,MultiplyOperation:sb,NearestFilter:el,NearestMipMapLinearFilter:eMe,NearestMipMapNearestFilter:QEe,NearestMipmapLinearFilter:mx,NearestMipmapNearestFilter:CB,NeutralToneMapping:tY,NeverCompare:cY,NeverDepth:CT,NeverStencilFunc:gMe,NoBlending:Wp,NoColorSpace:Lp,NoToneMapping:Cf,NormalAnimationBlendMode:JA,NormalBlending:a_,NotEqualCompare:fY,NotEqualDepth:TT,NotEqualStencilFunc:wMe,NumberKeyframeTrack:SS,Object3D:Cs,ObjectLoader:d2e,ObjectSpaceNormalMap:lY,OctahedronGeometry:pb,OneFactor:kK,OneMinusConstantAlphaFactor:qK,OneMinusConstantColorFactor:jK,OneMinusDstAlphaFactor:UK,OneMinusDstColorFactor:GK,OneMinusSrcAlphaFactor:wT,OneMinusSrcColorFactor:BK,OrthographicCamera:hb,PCFShadowMap:WA,PCFSoftShadowMap:M1,PMREMGenerator:Hk,Path:tv,PerspectiveCamera:Ua,Plane:Tg,PlaneGeometry:Bw,PlaneHelper:J2e,PointLight:fJ,PointLightHelper:H2e,Points:UY,PointsMaterial:WB,PolarGridHelper:q2e,PolyhedronGeometry:Mv,PositionalAudio:x2e,PropertyBinding:ys,PropertyMixer:CJ,QuadraticBezierCurve:ZB,QuadraticBezierCurve3:XB,Quaternion:Cl,QuaternionKeyframeTrack:yb,QuaternionLinearInterpolant:cJ,RED_GREEN_RGTC2_Format:QT,RED_RGTC1_Format:IB,REVISION:rb,RGBADepthPacking:aY,RGBAFormat:wl,RGBAIntegerFormat:YA,RGBA_ASTC_10x10_Format:qT,RGBA_ASTC_10x5_Format:WT,RGBA_ASTC_10x6_Format:jT,RGBA_ASTC_10x8_Format:$T,RGBA_ASTC_12x10_Format:ZT,RGBA_ASTC_12x12_Format:XT,RGBA_ASTC_4x4_Format:kT,RGBA_ASTC_5x4_Format:NT,RGBA_ASTC_5x5_Format:BT,RGBA_ASTC_6x5_Format:zT,RGBA_ASTC_6x6_Format:UT,RGBA_ASTC_8x5_Format:VT,RGBA_ASTC_8x6_Format:GT,RGBA_ASTC_8x8_Format:HT,RGBA_BPTC_Format:D1,RGBA_ETC2_EAC_Format:OT,RGBA_PVRTC_2BPPV1_Format:DT,RGBA_PVRTC_4BPPV1_Format:IT,RGBA_S3TC_DXT1_Format:A1,RGBA_S3TC_DXT3_Format:P1,RGBA_S3TC_DXT5_Format:I1,RGBDepthPacking:aMe,RGBFormat:RB,RGBIntegerFormat:iMe,RGB_BPTC_SIGNED_Format:KT,RGB_BPTC_UNSIGNED_Format:YT,RGB_ETC1_Format:FT,RGB_ETC2_Format:LT,RGB_PVRTC_2BPPV1_Format:PT,RGB_PVRTC_4BPPV1_Format:AT,RGB_S3TC_DXT1_Format:T1,RGDepthPacking:lMe,RGFormat:PB,RGIntegerFormat:KA,RawShaderMaterial:YY,Ray:Nw,Raycaster:cz,RectAreaLight:gJ,RedFormat:XA,RedIntegerFormat:ob,ReinhardToneMapping:YK,RenderTarget:_Y,RepeatWrapping:dS,ReplaceStencilOp:uMe,ReverseSubtractEquation:DK,RingGeometry:fP,SIGNED_RED_GREEN_RGTC2_Format:eA,SIGNED_RED_RGTC1_Format:JT,SRGBColorSpace:$l,SRGBTransfer:Ns,Scene:_S,ShaderChunk:kr,ShaderLib:ed,ShaderMaterial:ih,ShadowMaterial:KY,Shape:nv,ShapeGeometry:mb,ShapePath:Eg,ShapeUtils:od,ShortType:bB,Skeleton:rP,SkeletonHelper:G2e,SkinnedMesh:kY,Source:Gy,Sphere:Sl,SphereGeometry:gb,Spherical:B2e,SphericalHarmonics3:vJ,SplineCurve:KB,SpotLight:dJ,SpotLightHelper:V2e,Sprite:LY,SpriteMaterial:GB,SrcAlphaFactor:xT,SrcAlphaSaturateFactor:HK,SrcColorFactor:NK,StaticCopyUsage:TMe,StaticDrawUsage:gS,StaticReadUsage:EMe,StereoCamera:g2e,StreamCopyUsage:PMe,StreamDrawUsage:bMe,StreamReadUsage:RMe,StringKeyframeTrack:$_,SubtractEquation:IK,SubtractiveBlending:Bk,TOUCH:YEe,TangentSpaceNormalMap:bv,TetrahedronGeometry:pP,Texture:Oo,TextureLoader:l2e,TextureUtils:tDe,TorusGeometry:mP,TorusKnotGeometry:gP,Triangle:Fc,TriangleFanDrawMode:oMe,TriangleStripDrawMode:sMe,TrianglesDrawMode:rMe,TubeGeometry:vP,UVMapping:jA,Uint16BufferAttribute:kB,Uint32BufferAttribute:NB,Uint8BufferAttribute:pRe,Uint8ClampedBufferAttribute:mRe,Uniform:lz,UniformsGroup:O2e,UniformsLib:wi,UniformsUtils:CY,UnsignedByteType:dd,UnsignedInt248Type:M_,UnsignedInt5999Type:EB,UnsignedIntType:sm,UnsignedShort4444Type:qA,UnsignedShort5551Type:ZA,UnsignedShortType:aw,VSMShadowMap:qh,Vector2:Cn,Vector3:gt,Vector4:xs,VectorKeyframeTrack:bS,VideoTexture:xDe,WebGL3DRenderTarget:nRe,WebGLArrayRenderTarget:tRe,WebGLCoordinateSystem:yf,WebGLCubeRenderTarget:bY,WebGLMultipleRenderTargets:nFe,WebGLRenderTarget:fd,WebGLRenderer:DY,WebGLUtils:PY,WebGPUCoordinateSystem:vS,WireframeGeometry:XY,WrapAroundEnding:mS,ZeroCurvatureEnding:Uy,ZeroFactor:OK,ZeroSlopeEnding:Vy,ZeroStencilOp:cMe,createCanvasElement:vY},Symbol.toStringTag,{value:"Module"}));var RJ={exports:{}},q_={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */q_.ConcurrentRoot=1;q_.ContinuousEventPriority=4;q_.DefaultEventPriority=16;q_.DiscreteEventPriority=1;q_.IdleEventPriority=536870912;q_.LegacyRoot=0;RJ.exports=q_;var xx=RJ.exports;function iFe(t){let e;const n=new Set,i=(v,w)=>{const C=typeof v=="function"?v(e):v;if(C!==e){const M=e;e=w?C:Object.assign({},e,C),n.forEach(F=>F(e,M))}},r=()=>e,o=(v,w=r,C=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let M=w(e);function F(){const N=w(e);if(!C(M,N)){const z=M;v(M=N,z)}}return n.add(F),()=>n.delete(F)},f={setState:i,getState:r,subscribe:(v,w,C)=>w||C?o(v,w,C):(n.add(v),()=>n.delete(v)),destroy:()=>n.clear()};return e=t(i,r,f),f}const rFe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),kW=rFe?Q.useEffect:Q.useLayoutEffect;function TJ(t){const e=typeof t=="function"?iFe(t):t,n=(i=e.getState,r=Object.is)=>{const[,o]=Q.useReducer(L=>L+1,0),c=e.getState(),s=Q.useRef(c),f=Q.useRef(i),v=Q.useRef(r),w=Q.useRef(!1),C=Q.useRef();C.current===void 0&&(C.current=i(c));let M,F=!1;(s.current!==c||f.current!==i||v.current!==r||w.current)&&(M=i(c),F=!r(C.current,M)),kW(()=>{F&&(C.current=M),s.current=c,f.current=i,v.current=r,w.current=!1});const N=Q.useRef(c);kW(()=>{const L=()=>{try{const H=e.getState(),j=f.current(H);v.current(C.current,j)||(s.current=H,C.current=j,o())}catch{w.current=!0,o()}},P=e.subscribe(L);return e.getState()!==N.current&&L(),P},[]);const z=F?M:C.current;return Q.useDebugValue(z),z};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[n,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},n}var AJ={exports:{}},PJ={exports:{}},IJ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Me,$e){var ut=Me.length;Me.push($e);e:for(;0<ut;){var Mt=ut-1>>>1,Gt=Me[Mt];if(0<r(Gt,$e))Me[Mt]=$e,Me[ut]=Gt,ut=Mt;else break e}}function n(Me){return Me.length===0?null:Me[0]}function i(Me){if(Me.length===0)return null;var $e=Me[0],ut=Me.pop();if(ut!==$e){Me[0]=ut;e:for(var Mt=0,Gt=Me.length,Xt=Gt>>>1;Mt<Xt;){var Qe=2*(Mt+1)-1,Ge=Me[Qe],He=Qe+1,De=Me[He];if(0>r(Ge,ut))He<Gt&&0>r(De,Ge)?(Me[Mt]=De,Me[He]=ut,Mt=He):(Me[Mt]=Ge,Me[Qe]=ut,Mt=Qe);else if(He<Gt&&0>r(De,ut))Me[Mt]=De,Me[He]=ut,Mt=He;else break e}}return $e}function r(Me,$e){var ut=Me.sortIndex-$e.sortIndex;return ut!==0?ut:Me.id-$e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,s=c.now();t.unstable_now=function(){return c.now()-s}}var f=[],v=[],w=1,C=null,M=3,F=!1,N=!1,z=!1,L=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(Me){for(var $e=n(v);$e!==null;){if($e.callback===null)i(v);else if($e.startTime<=Me)i(v),$e.sortIndex=$e.expirationTime,e(f,$e);else break;$e=n(v)}}function q(Me){if(z=!1,j(Me),!N)if(n(f)!==null)N=!0,qe(le);else{var $e=n(v);$e!==null&&ft(q,$e.startTime-Me)}}function le(Me,$e){N=!1,z&&(z=!1,P(pe),pe=-1),F=!0;var ut=M;try{for(j($e),C=n(f);C!==null&&(!(C.expirationTime>$e)||Me&&!Ee());){var Mt=C.callback;if(typeof Mt=="function"){C.callback=null,M=C.priorityLevel;var Gt=Mt(C.expirationTime<=$e);$e=t.unstable_now(),typeof Gt=="function"?C.callback=Gt:C===n(f)&&i(f),j($e)}else i(f);C=n(f)}if(C!==null)var Xt=!0;else{var Qe=n(v);Qe!==null&&ft(q,Qe.startTime-$e),Xt=!1}return Xt}finally{C=null,M=ut,F=!1}}var ce=!1,ae=null,pe=-1,fe=5,ue=-1;function Ee(){return!(t.unstable_now()-ue<fe)}function We(){if(ae!==null){var Me=t.unstable_now();ue=Me;var $e=!0;try{$e=ae(!0,Me)}finally{$e?rt():(ce=!1,ae=null)}}else ce=!1}var rt;if(typeof H=="function")rt=function(){H(We)};else if(typeof MessageChannel<"u"){var tt=new MessageChannel,Ye=tt.port2;tt.port1.onmessage=We,rt=function(){Ye.postMessage(null)}}else rt=function(){L(We,0)};function qe(Me){ae=Me,ce||(ce=!0,rt())}function ft(Me,$e){pe=L(function(){Me(t.unstable_now())},$e)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Me){Me.callback=null},t.unstable_continueExecution=function(){N||F||(N=!0,qe(le))},t.unstable_forceFrameRate=function(Me){0>Me||125<Me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fe=0<Me?Math.floor(1e3/Me):5},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_getFirstCallbackNode=function(){return n(f)},t.unstable_next=function(Me){switch(M){case 1:case 2:case 3:var $e=3;break;default:$e=M}var ut=M;M=$e;try{return Me()}finally{M=ut}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Me,$e){switch(Me){case 1:case 2:case 3:case 4:case 5:break;default:Me=3}var ut=M;M=Me;try{return $e()}finally{M=ut}},t.unstable_scheduleCallback=function(Me,$e,ut){var Mt=t.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Mt+ut:Mt):ut=Mt,Me){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=ut+Gt,Me={id:w++,callback:$e,priorityLevel:Me,startTime:ut,expirationTime:Gt,sortIndex:-1},ut>Mt?(Me.sortIndex=ut,e(v,Me),n(f)===null&&Me===n(v)&&(z?(P(pe),pe=-1):z=!0,ft(q,ut-Mt))):(Me.sortIndex=Gt,e(f,Me),N||F||(N=!0,qe(le))),Me},t.unstable_shouldYield=Ee,t.unstable_wrapCallback=function(Me){var $e=M;return function(){var ut=M;M=$e;try{return Me.apply(this,arguments)}finally{M=ut}}}})(IJ);PJ.exports=IJ;var Jk=PJ.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sFe=function(e){var n={},i=Q,r=Jk,o=Object.assign;function c(T){for(var A="https://reactjs.org/docs/error-decoder.html?invariant="+T,Z=1;Z<arguments.length;Z++)A+="&args[]="+encodeURIComponent(arguments[Z]);return"Minified React error #"+T+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,f=Symbol.for("react.element"),v=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),N=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),q=Symbol.for("react.offscreen"),le=Symbol.iterator;function ce(T){return T===null||typeof T!="object"?null:(T=le&&T[le]||T["@@iterator"],typeof T=="function"?T:null)}function ae(T){if(T==null)return null;if(typeof T=="function")return T.displayName||T.name||null;if(typeof T=="string")return T;switch(T){case w:return"Fragment";case v:return"Portal";case M:return"Profiler";case C:return"StrictMode";case L:return"Suspense";case P:return"SuspenseList"}if(typeof T=="object")switch(T.$$typeof){case N:return(T.displayName||"Context")+".Consumer";case F:return(T._context.displayName||"Context")+".Provider";case z:var A=T.render;return T=T.displayName,T||(T=A.displayName||A.name||"",T=T!==""?"ForwardRef("+T+")":"ForwardRef"),T;case H:return A=T.displayName||null,A!==null?A:ae(T.type)||"Memo";case j:A=T._payload,T=T._init;try{return ae(T(A))}catch{}}return null}function pe(T){var A=T.type;switch(T.tag){case 24:return"Cache";case 9:return(A.displayName||"Context")+".Consumer";case 10:return(A._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return T=A.render,T=T.displayName||T.name||"",A.displayName||(T!==""?"ForwardRef("+T+")":"ForwardRef");case 7:return"Fragment";case 5:return A;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(A);case 8:return A===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof A=="function")return A.displayName||A.name||null;if(typeof A=="string")return A}return null}function fe(T){var A=T,Z=T;if(T.alternate)for(;A.return;)A=A.return;else{T=A;do A=T,A.flags&4098&&(Z=A.return),T=A.return;while(T)}return A.tag===3?Z:null}function ue(T){if(fe(T)!==T)throw Error(c(188))}function Ee(T){var A=T.alternate;if(!A){if(A=fe(T),A===null)throw Error(c(188));return A!==T?null:T}for(var Z=T,ne=A;;){var me=Z.return;if(me===null)break;var Ae=me.alternate;if(Ae===null){if(ne=me.return,ne!==null){Z=ne;continue}break}if(me.child===Ae.child){for(Ae=me.child;Ae;){if(Ae===Z)return ue(me),T;if(Ae===ne)return ue(me),A;Ae=Ae.sibling}throw Error(c(188))}if(Z.return!==ne.return)Z=me,ne=Ae;else{for(var _t=!1,Jt=me.child;Jt;){if(Jt===Z){_t=!0,Z=me,ne=Ae;break}if(Jt===ne){_t=!0,ne=me,Z=Ae;break}Jt=Jt.sibling}if(!_t){for(Jt=Ae.child;Jt;){if(Jt===Z){_t=!0,Z=Ae,ne=me;break}if(Jt===ne){_t=!0,ne=Ae,Z=me;break}Jt=Jt.sibling}if(!_t)throw Error(c(189))}}if(Z.alternate!==ne)throw Error(c(190))}if(Z.tag!==3)throw Error(c(188));return Z.stateNode.current===Z?T:A}function We(T){return T=Ee(T),T!==null?rt(T):null}function rt(T){if(T.tag===5||T.tag===6)return T;for(T=T.child;T!==null;){var A=rt(T);if(A!==null)return A;T=T.sibling}return null}function tt(T){if(T.tag===5||T.tag===6)return T;for(T=T.child;T!==null;){if(T.tag!==4){var A=tt(T);if(A!==null)return A}T=T.sibling}return null}var Ye=Array.isArray,qe=e.getPublicInstance,ft=e.getRootHostContext,Me=e.getChildHostContext,$e=e.prepareForCommit,ut=e.resetAfterCommit,Mt=e.createInstance,Gt=e.appendInitialChild,Xt=e.finalizeInitialChildren,Qe=e.prepareUpdate,Ge=e.shouldSetTextContent,He=e.createTextInstance,De=e.scheduleTimeout,kt=e.cancelTimeout,rn=e.noTimeout,Re=e.isPrimaryRenderer,Kt=e.supportsMutation,bt=e.supportsPersistence,Dt=e.supportsHydration,_e=e.getInstanceFromNode,At=e.preparePortalMount,Ot=e.getCurrentEventPriority,tn=e.detachDeletedInstance,xe=e.supportsMicrotasks,Se=e.scheduleMicrotask,it=e.supportsTestSelectors,Le=e.findFiberRoot,Pe=e.getBoundingRect,vt=e.getTextContent,yt=e.isHiddenSubtree,nn=e.matchAccessibilityRole,jt=e.setFocusIfFocusable,Fn=e.setupIntersectionObserver,Bn=e.appendChild,Zn=e.appendChildToContainer,Li=e.commitTextUpdate,zn=e.commitMount,oi=e.commitUpdate,gi=e.insertBefore,Ti=e.insertInContainerBefore,pi=e.removeChild,Ji=e.removeChildFromContainer,er=e.resetTextContent,vi=e.hideInstance,Wt=e.hideTextInstance,ui=e.unhideInstance,vn=e.unhideTextInstance,Ln=e.clearContainer,mi=e.cloneInstance,hi=e.createContainerChildSet,Xi=e.appendChildToContainerChildSet,cs=e.finalizeContainerChildren,Ft=e.replaceContainerChildren,we=e.cloneHiddenInstance,Ie=e.cloneHiddenTextInstance,je=e.canHydrateInstance,pt=e.canHydrateTextInstance,nt=e.canHydrateSuspenseInstance,wt=e.isSuspenseInstancePending,zt=e.isSuspenseInstanceFallback,St=e.registerSuspenseInstanceRetry,Bt=e.getNextHydratableSibling,Zt=e.getFirstHydratableChild,Yt=e.getFirstHydratableChildWithinContainer,fn=e.getFirstHydratableChildWithinSuspenseInstance,In=e.hydrateInstance,Gn=e.hydrateTextInstance,Ci=e.hydrateSuspenseInstance,Ri=e.getNextHydratableInstanceAfterSuspenseInstance,Mi=e.commitHydratedContainer,Be=e.commitHydratedSuspenseInstance,Pt=e.clearSuspenseBoundary,$t=e.clearSuspenseBoundaryFromContainer,ht=e.shouldDeleteUnhydratedTailInstances,Lt=e.didNotMatchHydratedContainerTextInstance,An=e.didNotMatchHydratedTextInstance,Dn;function Xn(T){if(Dn===void 0)try{throw Error()}catch(Z){var A=Z.stack.trim().match(/\n( *(at )?)/);Dn=A&&A[1]||""}return`
`+Dn+T}var Yn=!1;function Si(T,A){if(!T||Yn)return"";Yn=!0;var Z=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(A)if(A=function(){throw Error()},Object.defineProperty(A.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(A,[])}catch(Kn){var ne=Kn}Reflect.construct(T,[],A)}else{try{A.call()}catch(Kn){ne=Kn}T.call(A.prototype)}else{try{throw Error()}catch(Kn){ne=Kn}T()}}catch(Kn){if(Kn&&ne&&typeof Kn.stack=="string"){for(var me=Kn.stack.split(`
`),Ae=ne.stack.split(`
`),_t=me.length-1,Jt=Ae.length-1;1<=_t&&0<=Jt&&me[_t]!==Ae[Jt];)Jt--;for(;1<=_t&&0<=Jt;_t--,Jt--)if(me[_t]!==Ae[Jt]){if(_t!==1||Jt!==1)do if(_t--,Jt--,0>Jt||me[_t]!==Ae[Jt]){var Sn=`
`+me[_t].replace(" at new "," at ");return T.displayName&&Sn.includes("<anonymous>")&&(Sn=Sn.replace("<anonymous>",T.displayName)),Sn}while(1<=_t&&0<=Jt);break}}}finally{Yn=!1,Error.prepareStackTrace=Z}return(T=T?T.displayName||T.name:"")?Xn(T):""}var Wi=Object.prototype.hasOwnProperty,di=[],or=-1;function Pr(T){return{current:T}}function ji(T){0>or||(T.current=di[or],di[or]=null,or--)}function vr(T,A){or++,di[or]=T.current,T.current=A}var wr={},fi=Pr(wr),fs=Pr(!1),tr=wr;function Ss(T,A){var Z=T.type.contextTypes;if(!Z)return wr;var ne=T.stateNode;if(ne&&ne.__reactInternalMemoizedUnmaskedChildContext===A)return ne.__reactInternalMemoizedMaskedChildContext;var me={},Ae;for(Ae in Z)me[Ae]=A[Ae];return ne&&(T=T.stateNode,T.__reactInternalMemoizedUnmaskedChildContext=A,T.__reactInternalMemoizedMaskedChildContext=me),me}function is(T){return T=T.childContextTypes,T!=null}function rs(){ji(fs),ji(fi)}function Yo(T,A,Z){if(fi.current!==wr)throw Error(c(168));vr(fi,A),vr(fs,Z)}function Qr(T,A,Z){var ne=T.stateNode;if(A=A.childContextTypes,typeof ne.getChildContext!="function")return Z;ne=ne.getChildContext();for(var me in ne)if(!(me in A))throw Error(c(108,pe(T)||"Unknown",me));return o({},Z,ne)}function Jo(T){return T=(T=T.stateNode)&&T.__reactInternalMemoizedMergedChildContext||wr,tr=fi.current,vr(fi,T),vr(fs,fs.current),!0}function cc(T,A,Z){var ne=T.stateNode;if(!ne)throw Error(c(169));Z?(T=Qr(T,A,tr),ne.__reactInternalMemoizedMergedChildContext=T,ji(fs),ji(fi),vr(fi,T)):ji(fs),vr(fs,Z)}var Zr=Math.clz32?Math.clz32:dm,Wa=Math.log,El=Math.LN2;function dm(T){return T>>>=0,T===0?32:31-(Wa(T)/El|0)|0}var Qo=64,Ml=4194304;function Wc(T){switch(T&-T){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return T&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return T&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return T}}function jc(T,A){var Z=T.pendingLanes;if(Z===0)return 0;var ne=0,me=T.suspendedLanes,Ae=T.pingedLanes,_t=Z&268435455;if(_t!==0){var Jt=_t&~me;Jt!==0?ne=Wc(Jt):(Ae&=_t,Ae!==0&&(ne=Wc(Ae)))}else _t=Z&~me,_t!==0?ne=Wc(_t):Ae!==0&&(ne=Wc(Ae));if(ne===0)return 0;if(A!==0&&A!==ne&&!(A&me)&&(me=ne&-ne,Ae=A&-A,me>=Ae||me===16&&(Ae&4194240)!==0))return A;if(ne&4&&(ne|=Z&16),A=T.entangledLanes,A!==0)for(T=T.entanglements,A&=ne;0<A;)Z=31-Zr(A),me=1<<Z,ne|=T[Z],A&=~me;return ne}function Tv(T,A){switch(T){case 1:case 2:case 4:return A+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return A+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xd(T,A){for(var Z=T.suspendedLanes,ne=T.pingedLanes,me=T.expirationTimes,Ae=T.pendingLanes;0<Ae;){var _t=31-Zr(Ae),Jt=1<<_t,Sn=me[_t];Sn===-1?(!(Jt&Z)||Jt&ne)&&(me[_t]=Tv(Jt,A)):Sn<=A&&(T.expiredLanes|=Jt),Ae&=~Jt}}function Df(T){return T=T.pendingLanes&-1073741825,T!==0?T:T&1073741824?1073741824:0}function cr(T){for(var A=[],Z=0;31>Z;Z++)A.push(T);return A}function uh(T,A,Z){T.pendingLanes|=A,A!==536870912&&(T.suspendedLanes=0,T.pingedLanes=0),T=T.eventTimes,A=31-Zr(A),T[A]=Z}function Mr(T,A){var Z=T.pendingLanes&~A;T.pendingLanes=A,T.suspendedLanes=0,T.pingedLanes=0,T.expiredLanes&=A,T.mutableReadLanes&=A,T.entangledLanes&=A,A=T.entanglements;var ne=T.eventTimes;for(T=T.expirationTimes;0<Z;){var me=31-Zr(Z),Ae=1<<me;A[me]=0,ne[me]=-1,T[me]=-1,Z&=~Ae}}function Av(T,A){var Z=T.entangledLanes|=A;for(T=T.entanglements;Z;){var ne=31-Zr(Z),me=1<<ne;me&A|T[ne]&A&&(T[ne]|=A),Z&=~me}}var Hn=0;function wd(T){return T&=-T,1<T?4<T?T&268435455?16:536870912:4:1}var $c=r.unstable_scheduleCallback,hh=r.unstable_cancelCallback,Rl=r.unstable_shouldYield,fm=r.unstable_requestPaint,bs=r.unstable_now,Wn=r.unstable_ImmediatePriority,ur=r.unstable_UserBlockingPriority,nr=r.unstable_NormalPriority,Ia=r.unstable_IdlePriority,xo=null,$i=null;function pm(T){if($i&&typeof $i.onCommitFiberRoot=="function")try{$i.onCommitFiberRoot(xo,T,void 0,(T.current.flags&128)===128)}catch{}}function Cd(T,A){return T===A&&(T!==0||1/T===1/A)||T!==T&&A!==A}var ya=typeof Object.is=="function"?Object.is:Cd,Gs=null,Es=!1,mm=!1;function dh(T){Gs===null?Gs=[T]:Gs.push(T)}function Sd(T){Es=!0,dh(T)}function wo(){if(!mm&&Gs!==null){mm=!0;var T=0,A=Hn;try{var Z=Gs;for(Hn=1;T<Z.length;T++){var ne=Z[T];do ne=ne(!0);while(ne!==null)}Gs=null,Es=!1}catch(me){throw Gs!==null&&(Gs=Gs.slice(T+1)),$c(Wn,wo),me}finally{Hn=A,mm=!1}}return null}var gm=s.ReactCurrentBatchConfig;function la(T,A){if(ya(T,A))return!0;if(typeof T!="object"||T===null||typeof A!="object"||A===null)return!1;var Z=Object.keys(T),ne=Object.keys(A);if(Z.length!==ne.length)return!1;for(ne=0;ne<Z.length;ne++){var me=Z[ne];if(!Wi.call(A,me)||!ya(T[me],A[me]))return!1}return!0}function ca(T){switch(T.tag){case 5:return Xn(T.type);case 16:return Xn("Lazy");case 13:return Xn("Suspense");case 19:return Xn("SuspenseList");case 0:case 2:case 15:return T=Si(T.type,!1),T;case 11:return T=Si(T.type.render,!1),T;case 1:return T=Si(T.type,!0),T;default:return""}}function Os(T,A){if(T&&T.defaultProps){A=o({},A),T=T.defaultProps;for(var Z in T)A[Z]===void 0&&(A[Z]=T[Z]);return A}return A}var Ff=Pr(null),Tl=null,Ms=null,ea=null;function ja(){ea=Ms=Tl=null}function Qs(T,A,Z){Re?(vr(Ff,A._currentValue),A._currentValue=Z):(vr(Ff,A._currentValue2),A._currentValue2=Z)}function Lf(T){var A=Ff.current;ji(Ff),Re?T._currentValue=A:T._currentValue2=A}function $a(T,A,Z){for(;T!==null;){var ne=T.alternate;if((T.childLanes&A)!==A?(T.childLanes|=A,ne!==null&&(ne.childLanes|=A)):ne!==null&&(ne.childLanes&A)!==A&&(ne.childLanes|=A),T===Z)break;T=T.return}}function Al(T,A){Tl=T,ea=Ms=null,T=T.dependencies,T!==null&&T.firstContext!==null&&(T.lanes&A&&(So=!0),T.firstContext=null)}function Bo(T){var A=Re?T._currentValue:T._currentValue2;if(ea!==T)if(T={context:T,memoizedValue:A,next:null},Ms===null){if(Tl===null)throw Error(c(308));Ms=T,Tl.dependencies={lanes:0,firstContext:T}}else Ms=Ms.next=T;return A}var ua=null,Pl=!1;function Il(T){T.updateQueue={baseState:T.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z_(T,A){T=T.updateQueue,A.updateQueue===T&&(A.updateQueue={baseState:T.baseState,firstBaseUpdate:T.firstBaseUpdate,lastBaseUpdate:T.lastBaseUpdate,shared:T.shared,effects:T.effects})}function uc(T,A){return{eventTime:T,lane:A,tag:0,payload:null,callback:null,next:null}}function eo(T,A){var Z=T.updateQueue;Z!==null&&(Z=Z.shared,Rs!==null&&T.mode&1&&!(xr&2)?(T=Z.interleaved,T===null?(A.next=A,ua===null?ua=[Z]:ua.push(Z)):(A.next=T.next,T.next=A),Z.interleaved=A):(T=Z.pending,T===null?A.next=A:(A.next=T.next,T.next=A),Z.pending=A))}function vm(T,A,Z){if(A=A.updateQueue,A!==null&&(A=A.shared,(Z&4194240)!==0)){var ne=A.lanes;ne&=T.pendingLanes,Z|=ne,A.lanes=Z,Av(T,Z)}}function Of(T,A){var Z=T.updateQueue,ne=T.alternate;if(ne!==null&&(ne=ne.updateQueue,Z===ne)){var me=null,Ae=null;if(Z=Z.firstBaseUpdate,Z!==null){do{var _t={eventTime:Z.eventTime,lane:Z.lane,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null};Ae===null?me=Ae=_t:Ae=Ae.next=_t,Z=Z.next}while(Z!==null);Ae===null?me=Ae=A:Ae=Ae.next=A}else me=Ae=A;Z={baseState:ne.baseState,firstBaseUpdate:me,lastBaseUpdate:Ae,shared:ne.shared,effects:ne.effects},T.updateQueue=Z;return}T=Z.lastBaseUpdate,T===null?Z.firstBaseUpdate=A:T.next=A,Z.lastBaseUpdate=A}function kf(T,A,Z,ne){var me=T.updateQueue;Pl=!1;var Ae=me.firstBaseUpdate,_t=me.lastBaseUpdate,Jt=me.shared.pending;if(Jt!==null){me.shared.pending=null;var Sn=Jt,Kn=Sn.next;Sn.next=null,_t===null?Ae=Kn:_t.next=Kn,_t=Sn;var Ai=T.alternate;Ai!==null&&(Ai=Ai.updateQueue,Jt=Ai.lastBaseUpdate,Jt!==_t&&(Jt===null?Ai.firstBaseUpdate=Kn:Jt.next=Kn,Ai.lastBaseUpdate=Sn))}if(Ae!==null){var pr=me.baseState;_t=0,Ai=Kn=Sn=null,Jt=Ae;do{var Gi=Jt.lane,vs=Jt.eventTime;if((ne&Gi)===Gi){Ai!==null&&(Ai=Ai.next={eventTime:vs,lane:0,tag:Jt.tag,payload:Jt.payload,callback:Jt.callback,next:null});e:{var Fi=T,io=Jt;switch(Gi=A,vs=Z,io.tag){case 1:if(Fi=io.payload,typeof Fi=="function"){pr=Fi.call(vs,pr,Gi);break e}pr=Fi;break e;case 3:Fi.flags=Fi.flags&-65537|128;case 0:if(Fi=io.payload,Gi=typeof Fi=="function"?Fi.call(vs,pr,Gi):Fi,Gi==null)break e;pr=o({},pr,Gi);break e;case 2:Pl=!0}}Jt.callback!==null&&Jt.lane!==0&&(T.flags|=64,Gi=me.effects,Gi===null?me.effects=[Jt]:Gi.push(Jt))}else vs={eventTime:vs,lane:Gi,tag:Jt.tag,payload:Jt.payload,callback:Jt.callback,next:null},Ai===null?(Kn=Ai=vs,Sn=pr):Ai=Ai.next=vs,_t|=Gi;if(Jt=Jt.next,Jt===null){if(Jt=me.shared.pending,Jt===null)break;Gi=Jt,Jt=Gi.next,Gi.next=null,me.lastBaseUpdate=Gi,me.shared.pending=null}}while(!0);if(Ai===null&&(Sn=pr),me.baseState=Sn,me.firstBaseUpdate=Kn,me.lastBaseUpdate=Ai,A=me.shared.interleaved,A!==null){me=A;do _t|=me.lane,me=me.next;while(me!==A)}else Ae===null&&(me.shared.lanes=0);Lu|=_t,T.lanes=_t,T.memoizedState=pr}}function fh(T,A,Z){if(T=A.effects,A.effects=null,T!==null)for(A=0;A<T.length;A++){var ne=T[A],me=ne.callback;if(me!==null){if(ne.callback=null,ne=Z,typeof me!="function")throw Error(c(191,me));me.call(ne)}}}var ph=new i.Component().refs;function Pv(T,A,Z,ne){A=T.memoizedState,Z=Z(ne,A),Z=Z==null?A:o({},A,Z),T.memoizedState=Z,T.lanes===0&&(T.updateQueue.baseState=Z)}var Eu={isMounted:function(T){return(T=T._reactInternals)?fe(T)===T:!1},enqueueSetState:function(T,A,Z){T=T._reactInternals;var ne=Eo(),me=pa(T),Ae=uc(ne,me);Ae.payload=A,Z!=null&&(Ae.callback=Z),eo(T,Ae),A=Mo(T,me,ne),A!==null&&vm(A,T,me)},enqueueReplaceState:function(T,A,Z){T=T._reactInternals;var ne=Eo(),me=pa(T),Ae=uc(ne,me);Ae.tag=1,Ae.payload=A,Z!=null&&(Ae.callback=Z),eo(T,Ae),A=Mo(T,me,ne),A!==null&&vm(A,T,me)},enqueueForceUpdate:function(T,A){T=T._reactInternals;var Z=Eo(),ne=pa(T),me=uc(Z,ne);me.tag=2,A!=null&&(me.callback=A),eo(T,me),A=Mo(T,ne,Z),A!==null&&vm(A,T,ne)}};function Mu(T,A,Z,ne,me,Ae,_t){return T=T.stateNode,typeof T.shouldComponentUpdate=="function"?T.shouldComponentUpdate(ne,Ae,_t):A.prototype&&A.prototype.isPureReactComponent?!la(Z,ne)||!la(me,Ae):!0}function X_(T,A,Z){var ne=!1,me=wr,Ae=A.contextType;return typeof Ae=="object"&&Ae!==null?Ae=Bo(Ae):(me=is(A)?tr:fi.current,ne=A.contextTypes,Ae=(ne=ne!=null)?Ss(T,me):wr),A=new A(Z,Ae),T.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=Eu,T.stateNode=A,A._reactInternals=T,ne&&(T=T.stateNode,T.__reactInternalMemoizedUnmaskedChildContext=me,T.__reactInternalMemoizedMaskedChildContext=Ae),A}function mh(T,A,Z,ne){T=A.state,typeof A.componentWillReceiveProps=="function"&&A.componentWillReceiveProps(Z,ne),typeof A.UNSAFE_componentWillReceiveProps=="function"&&A.UNSAFE_componentWillReceiveProps(Z,ne),A.state!==T&&Eu.enqueueReplaceState(A,A.state,null)}function ym(T,A,Z,ne){var me=T.stateNode;me.props=Z,me.state=T.memoizedState,me.refs=ph,Il(T);var Ae=A.contextType;typeof Ae=="object"&&Ae!==null?me.context=Bo(Ae):(Ae=is(A)?tr:fi.current,me.context=Ss(T,Ae)),me.state=T.memoizedState,Ae=A.getDerivedStateFromProps,typeof Ae=="function"&&(Pv(T,A,Ae,Z),me.state=T.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof me.getSnapshotBeforeUpdate=="function"||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(A=me.state,typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount(),A!==me.state&&Eu.enqueueReplaceState(me,me.state,null),kf(T,Z,me,ne),me.state=T.memoizedState),typeof me.componentDidMount=="function"&&(T.flags|=4194308)}var qc=[],zo=0,Vi=null,ii=0,Da=[],_i=0,Zc=null,qa=1,yi="";function Xc(T,A){qc[zo++]=ii,qc[zo++]=Vi,Vi=T,ii=A}function Nf(T,A,Z){Da[_i++]=qa,Da[_i++]=yi,Da[_i++]=Zc,Zc=T;var ne=qa;T=yi;var me=32-Zr(ne)-1;ne&=~(1<<me),Z+=1;var Ae=32-Zr(A)+me;if(30<Ae){var _t=me-me%5;Ae=(ne&(1<<_t)-1).toString(32),ne>>=_t,me-=_t,qa=1<<32-Zr(A)+me|Z<<me|ne,yi=Ae+T}else qa=1<<Ae|Z<<me|ne,yi=T}function Bf(T){T.return!==null&&(Xc(T,1),Nf(T,1,0))}function hc(T){for(;T===Vi;)Vi=qc[--zo],qc[zo]=null,ii=qc[--zo],qc[zo]=null;for(;T===Zc;)Zc=Da[--_i],Da[_i]=null,yi=Da[--_i],Da[_i]=null,qa=Da[--_i],Da[_i]=null}var Co=null,ps=null,As=!1,dc=!1,ha=null;function zf(T,A){var Z=Na(5,null,null,0);Z.elementType="DELETED",Z.stateNode=A,Z.return=T,A=T.deletions,A===null?(T.deletions=[Z],T.flags|=16):A.push(Z)}function fc(T,A){switch(T.tag){case 5:return A=je(A,T.type,T.pendingProps),A!==null?(T.stateNode=A,Co=T,ps=Zt(A),!0):!1;case 6:return A=pt(A,T.pendingProps),A!==null?(T.stateNode=A,Co=T,ps=null,!0):!1;case 13:if(A=nt(A),A!==null){var Z=Zc!==null?{id:qa,overflow:yi}:null;return T.memoizedState={dehydrated:A,treeContext:Z,retryLane:1073741824},Z=Na(18,null,null,0),Z.stateNode=A,Z.return=T,T.child=Z,Co=T,ps=null,!0}return!1;default:return!1}}function ms(T){return(T.mode&1)!==0&&(T.flags&128)===0}function Uf(T){if(As){var A=ps;if(A){var Z=A;if(!fc(T,A)){if(ms(T))throw Error(c(418));A=Bt(Z);var ne=Co;A&&fc(T,A)?zf(ne,Z):(T.flags=T.flags&-4097|2,As=!1,Co=T)}}else{if(ms(T))throw Error(c(418));T.flags=T.flags&-4097|2,As=!1,Co=T}}}function Mn(T){for(T=T.return;T!==null&&T.tag!==5&&T.tag!==3&&T.tag!==13;)T=T.return;Co=T}function bd(T){if(!Dt||T!==Co)return!1;if(!As)return Mn(T),As=!0,!1;if(T.tag!==3&&(T.tag!==5||ht(T.type)&&!Ge(T.type,T.memoizedProps))){var A=ps;if(A){if(ms(T)){for(T=ps;T;)T=Bt(T);throw Error(c(418))}for(;A;)zf(T,A),A=Bt(A)}}if(Mn(T),T.tag===13){if(!Dt)throw Error(c(316));if(T=T.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(c(317));ps=Ri(T)}else ps=Co?Bt(T.stateNode):null;return!0}function Dl(){Dt&&(ps=Co=null,dc=As=!1)}function Ed(T){ha===null?ha=[T]:ha.push(T)}function Ru(T,A,Z){if(T=Z.ref,T!==null&&typeof T!="function"&&typeof T!="object"){if(Z._owner){if(Z=Z._owner,Z){if(Z.tag!==1)throw Error(c(309));var ne=Z.stateNode}if(!ne)throw Error(c(147,T));var me=ne,Ae=""+T;return A!==null&&A.ref!==null&&typeof A.ref=="function"&&A.ref._stringRef===Ae?A.ref:(A=function(_t){var Jt=me.refs;Jt===ph&&(Jt=me.refs={}),_t===null?delete Jt[Ae]:Jt[Ae]=_t},A._stringRef=Ae,A)}if(typeof T!="string")throw Error(c(284));if(!Z._owner)throw Error(c(290,T))}return T}function gh(T,A){throw T=Object.prototype.toString.call(A),Error(c(31,T==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":T))}function pc(T){var A=T._init;return A(T._payload)}function _m(T){function A(cn,Qt){if(T){var gn=cn.deletions;gn===null?(cn.deletions=[Qt],cn.flags|=16):gn.push(Qt)}}function Z(cn,Qt){if(!T)return null;for(;Qt!==null;)A(cn,Qt),Qt=Qt.sibling;return null}function ne(cn,Qt){for(cn=new Map;Qt!==null;)Qt.key!==null?cn.set(Qt.key,Qt):cn.set(Qt.index,Qt),Qt=Qt.sibling;return cn}function me(cn,Qt){return cn=nu(cn,Qt),cn.index=0,cn.sibling=null,cn}function Ae(cn,Qt,gn){return cn.index=gn,T?(gn=cn.alternate,gn!==null?(gn=gn.index,gn<Qt?(cn.flags|=2,Qt):gn):(cn.flags|=2,Qt)):(cn.flags|=1048576,Qt)}function _t(cn){return T&&cn.alternate===null&&(cn.flags|=2),cn}function Jt(cn,Qt,gn,ai){return Qt===null||Qt.tag!==6?(Qt=mp(gn,cn.mode,ai),Qt.return=cn,Qt):(Qt=me(Qt,gn),Qt.return=cn,Qt)}function Sn(cn,Qt,gn,ai){var Bi=gn.type;return Bi===w?Ai(cn,Qt,gn.props.children,ai,gn.key):Qt!==null&&(Qt.elementType===Bi||typeof Bi=="object"&&Bi!==null&&Bi.$$typeof===j&&pc(Bi)===Qt.type)?(ai=me(Qt,gn.props),ai.ref=Ru(cn,Qt,gn),ai.return=cn,ai):(ai=fp(gn.type,gn.key,gn.props,null,cn.mode,ai),ai.ref=Ru(cn,Qt,gn),ai.return=cn,ai)}function Kn(cn,Qt,gn,ai){return Qt===null||Qt.tag!==4||Qt.stateNode.containerInfo!==gn.containerInfo||Qt.stateNode.implementation!==gn.implementation?(Qt=Qv(gn,cn.mode,ai),Qt.return=cn,Qt):(Qt=me(Qt,gn.children||[]),Qt.return=cn,Qt)}function Ai(cn,Qt,gn,ai,Bi){return Qt===null||Qt.tag!==7?(Qt=Nu(gn,cn.mode,ai,Bi),Qt.return=cn,Qt):(Qt=me(Qt,gn),Qt.return=cn,Qt)}function pr(cn,Qt,gn){if(typeof Qt=="string"&&Qt!==""||typeof Qt=="number")return Qt=mp(""+Qt,cn.mode,gn),Qt.return=cn,Qt;if(typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case f:return gn=fp(Qt.type,Qt.key,Qt.props,null,cn.mode,gn),gn.ref=Ru(cn,null,Qt),gn.return=cn,gn;case v:return Qt=Qv(Qt,cn.mode,gn),Qt.return=cn,Qt;case j:var ai=Qt._init;return pr(cn,ai(Qt._payload),gn)}if(Ye(Qt)||ce(Qt))return Qt=Nu(Qt,cn.mode,gn,null),Qt.return=cn,Qt;gh(cn,Qt)}return null}function Gi(cn,Qt,gn,ai){var Bi=Qt!==null?Qt.key:null;if(typeof gn=="string"&&gn!==""||typeof gn=="number")return Bi!==null?null:Jt(cn,Qt,""+gn,ai);if(typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case f:return gn.key===Bi?Sn(cn,Qt,gn,ai):null;case v:return gn.key===Bi?Kn(cn,Qt,gn,ai):null;case j:return Bi=gn._init,Gi(cn,Qt,Bi(gn._payload),ai)}if(Ye(gn)||ce(gn))return Bi!==null?null:Ai(cn,Qt,gn,ai,null);gh(cn,gn)}return null}function vs(cn,Qt,gn,ai,Bi){if(typeof ai=="string"&&ai!==""||typeof ai=="number")return cn=cn.get(gn)||null,Jt(Qt,cn,""+ai,Bi);if(typeof ai=="object"&&ai!==null){switch(ai.$$typeof){case f:return cn=cn.get(ai.key===null?gn:ai.key)||null,Sn(Qt,cn,ai,Bi);case v:return cn=cn.get(ai.key===null?gn:ai.key)||null,Kn(Qt,cn,ai,Bi);case j:var Sr=ai._init;return vs(cn,Qt,gn,Sr(ai._payload),Bi)}if(Ye(ai)||ce(ai))return cn=cn.get(gn)||null,Ai(Qt,cn,ai,Bi,null);gh(Qt,ai)}return null}function Fi(cn,Qt,gn,ai){for(var Bi=null,Sr=null,yr=Qt,es=Qt=0,Ro=null;yr!==null&&es<gn.length;es++){yr.index>es?(Ro=yr,yr=null):Ro=yr.sibling;var rr=Gi(cn,yr,gn[es],ai);if(rr===null){yr===null&&(yr=Ro);break}T&&yr&&rr.alternate===null&&A(cn,yr),Qt=Ae(rr,Qt,es),Sr===null?Bi=rr:Sr.sibling=rr,Sr=rr,yr=Ro}if(es===gn.length)return Z(cn,yr),As&&Xc(cn,es),Bi;if(yr===null){for(;es<gn.length;es++)yr=pr(cn,gn[es],ai),yr!==null&&(Qt=Ae(yr,Qt,es),Sr===null?Bi=yr:Sr.sibling=yr,Sr=yr);return As&&Xc(cn,es),Bi}for(yr=ne(cn,yr);es<gn.length;es++)Ro=vs(yr,cn,es,gn[es],ai),Ro!==null&&(T&&Ro.alternate!==null&&yr.delete(Ro.key===null?es:Ro.key),Qt=Ae(Ro,Qt,es),Sr===null?Bi=Ro:Sr.sibling=Ro,Sr=Ro);return T&&yr.forEach(function(iu){return A(cn,iu)}),As&&Xc(cn,es),Bi}function io(cn,Qt,gn,ai){var Bi=ce(gn);if(typeof Bi!="function")throw Error(c(150));if(gn=Bi.call(gn),gn==null)throw Error(c(151));for(var Sr=Bi=null,yr=Qt,es=Qt=0,Ro=null,rr=gn.next();yr!==null&&!rr.done;es++,rr=gn.next()){yr.index>es?(Ro=yr,yr=null):Ro=yr.sibling;var iu=Gi(cn,yr,rr.value,ai);if(iu===null){yr===null&&(yr=Ro);break}T&&yr&&iu.alternate===null&&A(cn,yr),Qt=Ae(iu,Qt,es),Sr===null?Bi=iu:Sr.sibling=iu,Sr=iu,yr=Ro}if(rr.done)return Z(cn,yr),As&&Xc(cn,es),Bi;if(yr===null){for(;!rr.done;es++,rr=gn.next())rr=pr(cn,rr.value,ai),rr!==null&&(Qt=Ae(rr,Qt,es),Sr===null?Bi=rr:Sr.sibling=rr,Sr=rr);return As&&Xc(cn,es),Bi}for(yr=ne(cn,yr);!rr.done;es++,rr=gn.next())rr=vs(yr,cn,es,rr.value,ai),rr!==null&&(T&&rr.alternate!==null&&yr.delete(rr.key===null?es:rr.key),Qt=Ae(rr,Qt,es),Sr===null?Bi=rr:Sr.sibling=rr,Sr=rr);return T&&yr.forEach(function(g){return A(cn,g)}),As&&Xc(cn,es),Bi}function po(cn,Qt,gn,ai){if(typeof gn=="object"&&gn!==null&&gn.type===w&&gn.key===null&&(gn=gn.props.children),typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case f:e:{for(var Bi=gn.key,Sr=Qt;Sr!==null;){if(Sr.key===Bi){if(Bi=gn.type,Bi===w){if(Sr.tag===7){Z(cn,Sr.sibling),Qt=me(Sr,gn.props.children),Qt.return=cn,cn=Qt;break e}}else if(Sr.elementType===Bi||typeof Bi=="object"&&Bi!==null&&Bi.$$typeof===j&&pc(Bi)===Sr.type){Z(cn,Sr.sibling),Qt=me(Sr,gn.props),Qt.ref=Ru(cn,Sr,gn),Qt.return=cn,cn=Qt;break e}Z(cn,Sr);break}else A(cn,Sr);Sr=Sr.sibling}gn.type===w?(Qt=Nu(gn.props.children,cn.mode,ai,gn.key),Qt.return=cn,cn=Qt):(ai=fp(gn.type,gn.key,gn.props,null,cn.mode,ai),ai.ref=Ru(cn,Qt,gn),ai.return=cn,cn=ai)}return _t(cn);case v:e:{for(Sr=gn.key;Qt!==null;){if(Qt.key===Sr)if(Qt.tag===4&&Qt.stateNode.containerInfo===gn.containerInfo&&Qt.stateNode.implementation===gn.implementation){Z(cn,Qt.sibling),Qt=me(Qt,gn.children||[]),Qt.return=cn,cn=Qt;break e}else{Z(cn,Qt);break}else A(cn,Qt);Qt=Qt.sibling}Qt=Qv(gn,cn.mode,ai),Qt.return=cn,cn=Qt}return _t(cn);case j:return Sr=gn._init,po(cn,Qt,Sr(gn._payload),ai)}if(Ye(gn))return Fi(cn,Qt,gn,ai);if(ce(gn))return io(cn,Qt,gn,ai);gh(cn,gn)}return typeof gn=="string"&&gn!==""||typeof gn=="number"?(gn=""+gn,Qt!==null&&Qt.tag===6?(Z(cn,Qt.sibling),Qt=me(Qt,gn),Qt.return=cn,cn=Qt):(Z(cn,Qt),Qt=mp(gn,cn.mode,ai),Qt.return=cn,cn=Qt),_t(cn)):Z(cn,Qt)}return po}var Uo=_m(!0),Vf=_m(!1),mc={},Za=Pr(mc),Md=Pr(mc),Vo=Pr(mc);function Fl(T){if(T===mc)throw Error(c(174));return T}function Gf(T,A){vr(Vo,A),vr(Md,T),vr(Za,mc),T=ft(A),ji(Za),vr(Za,T)}function Tu(){ji(Za),ji(Md),ji(Vo)}function Hf(T){var A=Fl(Vo.current),Z=Fl(Za.current);A=Me(Z,T.type,A),Z!==A&&(vr(Md,T),vr(Za,A))}function xm(T){Md.current===T&&(ji(Za),ji(Md))}var zs=Pr(0);function Wf(T){for(var A=T;A!==null;){if(A.tag===13){var Z=A.memoizedState;if(Z!==null&&(Z=Z.dehydrated,Z===null||wt(Z)||zt(Z)))return A}else if(A.tag===19&&A.memoizedProps.revealOrder!==void 0){if(A.flags&128)return A}else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===T)break;for(;A.sibling===null;){if(A.return===null||A.return===T)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}return null}var wm=[];function jf(){for(var T=0;T<wm.length;T++){var A=wm[T];Re?A._workInProgressVersionPrimary=null:A._workInProgressVersionSecondary=null}wm.length=0}var $f=s.ReactCurrentDispatcher,da=s.ReactCurrentBatchConfig,Kc=0,Fs=null,to=null,Zs=null,vh=!1,il=!1,rl=0,ir=0;function no(){throw Error(c(321))}function yh(T,A){if(A===null)return!1;for(var Z=0;Z<A.length&&Z<T.length;Z++)if(!ya(T[Z],A[Z]))return!1;return!0}function Rd(T,A,Z,ne,me,Ae){if(Kc=Ae,Fs=A,A.memoizedState=null,A.updateQueue=null,A.lanes=0,$f.current=T===null||T.memoizedState===null?Im:Nv,T=Z(ne,me),il){Ae=0;do{if(il=!1,rl=0,25<=Ae)throw Error(c(301));Ae+=1,Zs=to=null,A.updateQueue=null,$f.current=J_,T=Z(ne,me)}while(il)}if($f.current=Au,A=to!==null&&to.next!==null,Kc=0,Zs=to=Fs=null,vh=!1,A)throw Error(c(300));return T}function _h(){var T=rl!==0;return rl=0,T}function Fa(){var T={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zs===null?Fs.memoizedState=Zs=T:Zs=Zs.next=T,Zs}function fr(){if(to===null){var T=Fs.alternate;T=T!==null?T.memoizedState:null}else T=to.next;var A=Zs===null?Fs.memoizedState:Zs.next;if(A!==null)Zs=A,to=T;else{if(T===null)throw Error(c(310));to=T,T={memoizedState:to.memoizedState,baseState:to.baseState,baseQueue:to.baseQueue,queue:to.queue,next:null},Zs===null?Fs.memoizedState=Zs=T:Zs=Zs.next=T}return Zs}function Yc(T,A){return typeof A=="function"?A(T):A}function qf(T){var A=fr(),Z=A.queue;if(Z===null)throw Error(c(311));Z.lastRenderedReducer=T;var ne=to,me=ne.baseQueue,Ae=Z.pending;if(Ae!==null){if(me!==null){var _t=me.next;me.next=Ae.next,Ae.next=_t}ne.baseQueue=me=Ae,Z.pending=null}if(me!==null){Ae=me.next,ne=ne.baseState;var Jt=_t=null,Sn=null,Kn=Ae;do{var Ai=Kn.lane;if((Kc&Ai)===Ai)Sn!==null&&(Sn=Sn.next={lane:0,action:Kn.action,hasEagerState:Kn.hasEagerState,eagerState:Kn.eagerState,next:null}),ne=Kn.hasEagerState?Kn.eagerState:T(ne,Kn.action);else{var pr={lane:Ai,action:Kn.action,hasEagerState:Kn.hasEagerState,eagerState:Kn.eagerState,next:null};Sn===null?(Jt=Sn=pr,_t=ne):Sn=Sn.next=pr,Fs.lanes|=Ai,Lu|=Ai}Kn=Kn.next}while(Kn!==null&&Kn!==Ae);Sn===null?_t=ne:Sn.next=Jt,ya(ne,A.memoizedState)||(So=!0),A.memoizedState=ne,A.baseState=_t,A.baseQueue=Sn,Z.lastRenderedState=ne}if(T=Z.interleaved,T!==null){me=T;do Ae=me.lane,Fs.lanes|=Ae,Lu|=Ae,me=me.next;while(me!==T)}else me===null&&(Z.lanes=0);return[A.memoizedState,Z.dispatch]}function Td(T){var A=fr(),Z=A.queue;if(Z===null)throw Error(c(311));Z.lastRenderedReducer=T;var ne=Z.dispatch,me=Z.pending,Ae=A.memoizedState;if(me!==null){Z.pending=null;var _t=me=me.next;do Ae=T(Ae,_t.action),_t=_t.next;while(_t!==me);ya(Ae,A.memoizedState)||(So=!0),A.memoizedState=Ae,A.baseQueue===null&&(A.baseState=Ae),Z.lastRenderedState=Ae}return[Ae,ne]}function Zf(){}function Ad(T,A){var Z=Fs,ne=fr(),me=A(),Ae=!ya(ne.memoizedState,me);if(Ae&&(ne.memoizedState=me,So=!0),ne=ne.queue,wh(Fv.bind(null,Z,ne,T),[T]),ne.getSnapshot!==A||Ae||Zs!==null&&Zs.memoizedState.tag&1){if(Z.flags|=2048,Xf(9,Dv.bind(null,Z,ne,me,A),void 0,null),Rs===null)throw Error(c(349));Kc&30||Iv(Z,A,me)}return me}function Iv(T,A,Z){T.flags|=16384,T={getSnapshot:A,value:Z},A=Fs.updateQueue,A===null?(A={lastEffect:null,stores:null},Fs.updateQueue=A,A.stores=[T]):(Z=A.stores,Z===null?A.stores=[T]:Z.push(T))}function Dv(T,A,Z,ne){A.value=Z,A.getSnapshot=ne,xh(A)&&Mo(T,1,-1)}function Fv(T,A,Z){return Z(function(){xh(A)&&Mo(T,1,-1)})}function xh(T){var A=T.getSnapshot;T=T.value;try{var Z=A();return!ya(T,Z)}catch{return!0}}function Cm(T){var A=Fa();return typeof T=="function"&&(T=T()),A.memoizedState=A.baseState=T,T={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yc,lastRenderedState:T},A.queue=T,T=T.dispatch=Rm.bind(null,Fs,T),[A.memoizedState,T]}function Xf(T,A,Z,ne){return T={tag:T,create:A,destroy:Z,deps:ne,next:null},A=Fs.updateQueue,A===null?(A={lastEffect:null,stores:null},Fs.updateQueue=A,A.lastEffect=T.next=T):(Z=A.lastEffect,Z===null?A.lastEffect=T.next=T:(ne=Z.next,Z.next=T,T.next=ne,A.lastEffect=T)),T}function K_(){return fr().memoizedState}function Sm(T,A,Z,ne){var me=Fa();Fs.flags|=T,me.memoizedState=Xf(1|A,Z,void 0,ne===void 0?null:ne)}function Pd(T,A,Z,ne){var me=fr();ne=ne===void 0?null:ne;var Ae=void 0;if(to!==null){var _t=to.memoizedState;if(Ae=_t.destroy,ne!==null&&yh(ne,_t.deps)){me.memoizedState=Xf(A,Z,Ae,ne);return}}Fs.flags|=T,me.memoizedState=Xf(1|A,Z,Ae,ne)}function Kf(T,A){return Sm(8390656,8,T,A)}function wh(T,A){return Pd(2048,8,T,A)}function bm(T,A){return Pd(4,2,T,A)}function Lv(T,A){return Pd(4,4,T,A)}function Ov(T,A){if(typeof A=="function")return T=T(),A(T),function(){A(null)};if(A!=null)return T=T(),A.current=T,function(){A.current=null}}function Y_(T,A,Z){return Z=Z!=null?Z.concat([T]):null,Pd(4,4,Ov.bind(null,A,T),Z)}function Ch(){}function Id(T,A){var Z=fr();A=A===void 0?null:A;var ne=Z.memoizedState;return ne!==null&&A!==null&&yh(A,ne[1])?ne[0]:(Z.memoizedState=[T,A],T)}function kv(T,A){var Z=fr();A=A===void 0?null:A;var ne=Z.memoizedState;return ne!==null&&A!==null&&yh(A,ne[1])?ne[0]:(T=T(),Z.memoizedState=[T,A],T)}function Xa(T,A){var Z=Hn;Hn=Z!==0&&4>Z?Z:4,T(!0);var ne=da.transition;da.transition={};try{T(!1),A()}finally{Hn=Z,da.transition=ne}}function Em(){return fr().memoizedState}function Mm(T,A,Z){var ne=pa(T);Z={lane:ne,action:Z,hasEagerState:!1,eagerState:null,next:null},Tm(T)?Am(A,Z):(Yf(T,A,Z),Z=Eo(),T=Mo(T,ne,Z),T!==null&&Pm(T,A,ne))}function Rm(T,A,Z){var ne=pa(T),me={lane:ne,action:Z,hasEagerState:!1,eagerState:null,next:null};if(Tm(T))Am(A,me);else{Yf(T,A,me);var Ae=T.alternate;if(T.lanes===0&&(Ae===null||Ae.lanes===0)&&(Ae=A.lastRenderedReducer,Ae!==null))try{var _t=A.lastRenderedState,Jt=Ae(_t,Z);if(me.hasEagerState=!0,me.eagerState=Jt,ya(Jt,_t))return}catch{}finally{}Z=Eo(),T=Mo(T,ne,Z),T!==null&&Pm(T,A,ne)}}function Tm(T){var A=T.alternate;return T===Fs||A!==null&&A===Fs}function Am(T,A){il=vh=!0;var Z=T.pending;Z===null?A.next=A:(A.next=Z.next,Z.next=A),T.pending=A}function Yf(T,A,Z){Rs!==null&&T.mode&1&&!(xr&2)?(T=A.interleaved,T===null?(Z.next=Z,ua===null?ua=[A]:ua.push(A)):(Z.next=T.next,T.next=Z),A.interleaved=Z):(T=A.pending,T===null?Z.next=Z:(Z.next=T.next,T.next=Z),A.pending=Z)}function Pm(T,A,Z){if(Z&4194240){var ne=A.lanes;ne&=T.pendingLanes,Z|=ne,A.lanes=Z,Av(T,Z)}}var Au={readContext:Bo,useCallback:no,useContext:no,useEffect:no,useImperativeHandle:no,useInsertionEffect:no,useLayoutEffect:no,useMemo:no,useReducer:no,useRef:no,useState:no,useDebugValue:no,useDeferredValue:no,useTransition:no,useMutableSource:no,useSyncExternalStore:no,useId:no,unstable_isNewReconciler:!1},Im={readContext:Bo,useCallback:function(T,A){return Fa().memoizedState=[T,A===void 0?null:A],T},useContext:Bo,useEffect:Kf,useImperativeHandle:function(T,A,Z){return Z=Z!=null?Z.concat([T]):null,Sm(4194308,4,Ov.bind(null,A,T),Z)},useLayoutEffect:function(T,A){return Sm(4194308,4,T,A)},useInsertionEffect:function(T,A){return Sm(4,2,T,A)},useMemo:function(T,A){var Z=Fa();return A=A===void 0?null:A,T=T(),Z.memoizedState=[T,A],T},useReducer:function(T,A,Z){var ne=Fa();return A=Z!==void 0?Z(A):A,ne.memoizedState=ne.baseState=A,T={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:T,lastRenderedState:A},ne.queue=T,T=T.dispatch=Mm.bind(null,Fs,T),[ne.memoizedState,T]},useRef:function(T){var A=Fa();return T={current:T},A.memoizedState=T},useState:Cm,useDebugValue:Ch,useDeferredValue:function(T){var A=Cm(T),Z=A[0],ne=A[1];return Kf(function(){var me=da.transition;da.transition={};try{ne(T)}finally{da.transition=me}},[T]),Z},useTransition:function(){var T=Cm(!1),A=T[0];return T=Xa.bind(null,T[1]),Fa().memoizedState=T,[A,T]},useMutableSource:function(){},useSyncExternalStore:function(T,A,Z){var ne=Fs,me=Fa();if(As){if(Z===void 0)throw Error(c(407));Z=Z()}else{if(Z=A(),Rs===null)throw Error(c(349));Kc&30||Iv(ne,A,Z)}me.memoizedState=Z;var Ae={value:Z,getSnapshot:A};return me.queue=Ae,Kf(Fv.bind(null,ne,Ae,T),[T]),ne.flags|=2048,Xf(9,Dv.bind(null,ne,Ae,Z,A),void 0,null),Z},useId:function(){var T=Fa(),A=Rs.identifierPrefix;if(As){var Z=yi,ne=qa;Z=(ne&~(1<<32-Zr(ne)-1)).toString(32)+Z,A=":"+A+"R"+Z,Z=rl++,0<Z&&(A+="H"+Z.toString(32)),A+=":"}else Z=ir++,A=":"+A+"r"+Z.toString(32)+":";return T.memoizedState=A},unstable_isNewReconciler:!1},Nv={readContext:Bo,useCallback:Id,useContext:Bo,useEffect:wh,useImperativeHandle:Y_,useInsertionEffect:bm,useLayoutEffect:Lv,useMemo:kv,useReducer:qf,useRef:K_,useState:function(){return qf(Yc)},useDebugValue:Ch,useDeferredValue:function(T){var A=qf(Yc),Z=A[0],ne=A[1];return wh(function(){var me=da.transition;da.transition={};try{ne(T)}finally{da.transition=me}},[T]),Z},useTransition:function(){var T=qf(Yc)[0],A=fr().memoizedState;return[T,A]},useMutableSource:Zf,useSyncExternalStore:Ad,useId:Em,unstable_isNewReconciler:!1},J_={readContext:Bo,useCallback:Id,useContext:Bo,useEffect:wh,useImperativeHandle:Y_,useInsertionEffect:bm,useLayoutEffect:Lv,useMemo:kv,useReducer:Td,useRef:K_,useState:function(){return Td(Yc)},useDebugValue:Ch,useDeferredValue:function(T){var A=Td(Yc),Z=A[0],ne=A[1];return wh(function(){var me=da.transition;da.transition={};try{ne(T)}finally{da.transition=me}},[T]),Z},useTransition:function(){var T=Td(Yc)[0],A=fr().memoizedState;return[T,A]},useMutableSource:Zf,useSyncExternalStore:Ad,useId:Em,unstable_isNewReconciler:!1};function Pu(T,A){try{var Z="",ne=A;do Z+=ca(ne),ne=ne.return;while(ne);var me=Z}catch(Ae){me=`
Error generating stack: `+Ae.message+`
`+Ae.stack}return{value:T,source:A,stack:me}}function Bv(T,A){try{console.error(A.value)}catch(Z){setTimeout(function(){throw Z})}}var Q_=typeof WeakMap=="function"?WeakMap:Map;function zv(T,A,Z){Z=uc(-1,Z),Z.tag=3,Z.payload={element:null};var ne=A.value;return Z.callback=function(){Ho||(Ho=!0,$m=ne),Bv(T,A)},Z}function Sh(T,A,Z){Z=uc(-1,Z),Z.tag=3;var ne=T.type.getDerivedStateFromError;if(typeof ne=="function"){var me=A.value;Z.payload=function(){return ne(me)},Z.callback=function(){Bv(T,A)}}var Ae=T.stateNode;return Ae!==null&&typeof Ae.componentDidCatch=="function"&&(Z.callback=function(){Bv(T,A),typeof ne!="function"&&(sl===null?sl=new Set([this]):sl.add(this));var _t=A.stack;this.componentDidCatch(A.value,{componentStack:_t!==null?_t:""})}),Z}function Uv(T,A,Z){var ne=T.pingCache;if(ne===null){ne=T.pingCache=new Q_;var me=new Set;ne.set(A,me)}else me=ne.get(A),me===void 0&&(me=new Set,ne.set(A,me));me.has(Z)||(me.add(Z),T=Zm.bind(null,T,A,Z),A.then(T,T))}function Vv(T){do{var A;if((A=T.tag===13)&&(A=T.memoizedState,A=A!==null?A.dehydrated!==null:!0),A)return T;T=T.return}while(T!==null);return null}function Dm(T,A,Z,ne,me){return T.mode&1?(T.flags|=65536,T.lanes=me,T):(T===A?T.flags|=65536:(T.flags|=128,Z.flags|=131072,Z.flags&=-52805,Z.tag===1&&(Z.alternate===null?Z.tag=17:(A=uc(-1,1),A.tag=2,eo(Z,A))),Z.lanes|=1),T)}function La(T){T.flags|=4}function Jf(T,A){if(T!==null&&T.child===A.child)return!0;if(A.flags&16)return!1;for(T=A.child;T!==null;){if(T.flags&12854||T.subtreeFlags&12854)return!1;T=T.sibling}return!0}var gc,Dd,Fd,Ld;if(Kt)gc=function(T,A){for(var Z=A.child;Z!==null;){if(Z.tag===5||Z.tag===6)Gt(T,Z.stateNode);else if(Z.tag!==4&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===A)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===A)return;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}},Dd=function(){},Fd=function(T,A,Z,ne,me){if(T=T.memoizedProps,T!==ne){var Ae=A.stateNode,_t=Fl(Za.current);Z=Qe(Ae,Z,T,ne,me,_t),(A.updateQueue=Z)&&La(A)}},Ld=function(T,A,Z,ne){Z!==ne&&La(A)};else if(bt){gc=function(T,A,Z,ne){for(var me=A.child;me!==null;){if(me.tag===5){var Ae=me.stateNode;Z&&ne&&(Ae=we(Ae,me.type,me.memoizedProps,me)),Gt(T,Ae)}else if(me.tag===6)Ae=me.stateNode,Z&&ne&&(Ae=Ie(Ae,me.memoizedProps,me)),Gt(T,Ae);else if(me.tag!==4){if(me.tag===22&&me.memoizedState!==null)Ae=me.child,Ae!==null&&(Ae.return=me),gc(T,me,!0,!0);else if(me.child!==null){me.child.return=me,me=me.child;continue}}if(me===A)break;for(;me.sibling===null;){if(me.return===null||me.return===A)return;me=me.return}me.sibling.return=me.return,me=me.sibling}};var Fm=function(T,A,Z,ne){for(var me=A.child;me!==null;){if(me.tag===5){var Ae=me.stateNode;Z&&ne&&(Ae=we(Ae,me.type,me.memoizedProps,me)),Xi(T,Ae)}else if(me.tag===6)Ae=me.stateNode,Z&&ne&&(Ae=Ie(Ae,me.memoizedProps,me)),Xi(T,Ae);else if(me.tag!==4){if(me.tag===22&&me.memoizedState!==null)Ae=me.child,Ae!==null&&(Ae.return=me),Fm(T,me,!0,!0);else if(me.child!==null){me.child.return=me,me=me.child;continue}}if(me===A)break;for(;me.sibling===null;){if(me.return===null||me.return===A)return;me=me.return}me.sibling.return=me.return,me=me.sibling}};Dd=function(T,A){var Z=A.stateNode;if(!Jf(T,A)){T=Z.containerInfo;var ne=hi(T);Fm(ne,A,!1,!1),Z.pendingChildren=ne,La(A),cs(T,ne)}},Fd=function(T,A,Z,ne,me){var Ae=T.stateNode,_t=T.memoizedProps;if((T=Jf(T,A))&&_t===ne)A.stateNode=Ae;else{var Jt=A.stateNode,Sn=Fl(Za.current),Kn=null;_t!==ne&&(Kn=Qe(Jt,Z,_t,ne,me,Sn)),T&&Kn===null?A.stateNode=Ae:(Ae=mi(Ae,Kn,Z,_t,ne,A,T,Jt),Xt(Ae,Z,ne,me,Sn)&&La(A),A.stateNode=Ae,T?La(A):gc(Ae,A,!1,!1))}},Ld=function(T,A,Z,ne){Z!==ne?(T=Fl(Vo.current),Z=Fl(Za.current),A.stateNode=He(ne,T,Z,A),La(A)):A.stateNode=T.stateNode}}else Dd=function(){},Fd=function(){},Ld=function(){};function Ll(T,A){if(!As)switch(T.tailMode){case"hidden":A=T.tail;for(var Z=null;A!==null;)A.alternate!==null&&(Z=A),A=A.sibling;Z===null?T.tail=null:Z.sibling=null;break;case"collapsed":Z=T.tail;for(var ne=null;Z!==null;)Z.alternate!==null&&(ne=Z),Z=Z.sibling;ne===null?A||T.tail===null?T.tail=null:T.tail.sibling=null:ne.sibling=null}}function ta(T){var A=T.alternate!==null&&T.alternate.child===T.child,Z=0,ne=0;if(A)for(var me=T.child;me!==null;)Z|=me.lanes|me.childLanes,ne|=me.subtreeFlags&14680064,ne|=me.flags&14680064,me.return=T,me=me.sibling;else for(me=T.child;me!==null;)Z|=me.lanes|me.childLanes,ne|=me.subtreeFlags,ne|=me.flags,me.return=T,me=me.sibling;return T.subtreeFlags|=ne,T.childLanes=Z,A}function Jc(T,A,Z){var ne=A.pendingProps;switch(hc(A),A.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(A),null;case 1:return is(A.type)&&rs(),ta(A),null;case 3:return ne=A.stateNode,Tu(),ji(fs),ji(fi),jf(),ne.pendingContext&&(ne.context=ne.pendingContext,ne.pendingContext=null),(T===null||T.child===null)&&(bd(A)?La(A):T===null||T.memoizedState.isDehydrated&&!(A.flags&256)||(A.flags|=1024,ha!==null&&(lp(ha),ha=null))),Dd(T,A),ta(A),null;case 5:xm(A),Z=Fl(Vo.current);var me=A.type;if(T!==null&&A.stateNode!=null)Fd(T,A,me,ne,Z),T.ref!==A.ref&&(A.flags|=512,A.flags|=2097152);else{if(!ne){if(A.stateNode===null)throw Error(c(166));return ta(A),null}if(T=Fl(Za.current),bd(A)){if(!Dt)throw Error(c(175));T=In(A.stateNode,A.type,A.memoizedProps,Z,T,A,!dc),A.updateQueue=T,T!==null&&La(A)}else{var Ae=Mt(me,ne,Z,T,A);gc(Ae,A,!1,!1),A.stateNode=Ae,Xt(Ae,me,ne,Z,T)&&La(A)}A.ref!==null&&(A.flags|=512,A.flags|=2097152)}return ta(A),null;case 6:if(T&&A.stateNode!=null)Ld(T,A,T.memoizedProps,ne);else{if(typeof ne!="string"&&A.stateNode===null)throw Error(c(166));if(T=Fl(Vo.current),Z=Fl(Za.current),bd(A)){if(!Dt)throw Error(c(176));if(T=A.stateNode,ne=A.memoizedProps,(Z=Gn(T,ne,A,!dc))&&(me=Co,me!==null))switch(Ae=(me.mode&1)!==0,me.tag){case 3:Lt(me.stateNode.containerInfo,T,ne,Ae);break;case 5:An(me.type,me.memoizedProps,me.stateNode,T,ne,Ae)}Z&&La(A)}else A.stateNode=He(ne,T,Z,A)}return ta(A),null;case 13:if(ji(zs),ne=A.memoizedState,As&&ps!==null&&A.mode&1&&!(A.flags&128)){for(T=ps;T;)T=Bt(T);return Dl(),A.flags|=98560,A}if(ne!==null&&ne.dehydrated!==null){if(ne=bd(A),T===null){if(!ne)throw Error(c(318));if(!Dt)throw Error(c(344));if(T=A.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(c(317));Ci(T,A)}else Dl(),!(A.flags&128)&&(A.memoizedState=null),A.flags|=4;return ta(A),null}return ha!==null&&(lp(ha),ha=null),A.flags&128?(A.lanes=Z,A):(ne=ne!==null,Z=!1,T===null?bd(A):Z=T.memoizedState!==null,ne&&!Z&&(A.child.flags|=8192,A.mode&1&&(T===null||zs.current&1?fo===0&&(fo=3):up())),A.updateQueue!==null&&(A.flags|=4),ta(A),null);case 4:return Tu(),Dd(T,A),T===null&&At(A.stateNode.containerInfo),ta(A),null;case 10:return Lf(A.type._context),ta(A),null;case 17:return is(A.type)&&rs(),ta(A),null;case 19:if(ji(zs),me=A.memoizedState,me===null)return ta(A),null;if(ne=(A.flags&128)!==0,Ae=me.rendering,Ae===null)if(ne)Ll(me,!1);else{if(fo!==0||T!==null&&T.flags&128)for(T=A.child;T!==null;){if(Ae=Wf(T),Ae!==null){for(A.flags|=128,Ll(me,!1),T=Ae.updateQueue,T!==null&&(A.updateQueue=T,A.flags|=4),A.subtreeFlags=0,T=Z,ne=A.child;ne!==null;)Z=ne,me=T,Z.flags&=14680066,Ae=Z.alternate,Ae===null?(Z.childLanes=0,Z.lanes=me,Z.child=null,Z.subtreeFlags=0,Z.memoizedProps=null,Z.memoizedState=null,Z.updateQueue=null,Z.dependencies=null,Z.stateNode=null):(Z.childLanes=Ae.childLanes,Z.lanes=Ae.lanes,Z.child=Ae.child,Z.subtreeFlags=0,Z.deletions=null,Z.memoizedProps=Ae.memoizedProps,Z.memoizedState=Ae.memoizedState,Z.updateQueue=Ae.updateQueue,Z.type=Ae.type,me=Ae.dependencies,Z.dependencies=me===null?null:{lanes:me.lanes,firstContext:me.firstContext}),ne=ne.sibling;return vr(zs,zs.current&1|2),A.child}T=T.sibling}me.tail!==null&&bs()>jm&&(A.flags|=128,ne=!0,Ll(me,!1),A.lanes=4194304)}else{if(!ne)if(T=Wf(Ae),T!==null){if(A.flags|=128,ne=!0,T=T.updateQueue,T!==null&&(A.updateQueue=T,A.flags|=4),Ll(me,!0),me.tail===null&&me.tailMode==="hidden"&&!Ae.alternate&&!As)return ta(A),null}else 2*bs()-me.renderingStartTime>jm&&Z!==1073741824&&(A.flags|=128,ne=!0,Ll(me,!1),A.lanes=4194304);me.isBackwards?(Ae.sibling=A.child,A.child=Ae):(T=me.last,T!==null?T.sibling=Ae:A.child=Ae,me.last=Ae)}return me.tail!==null?(A=me.tail,me.rendering=A,me.tail=A.sibling,me.renderingStartTime=bs(),A.sibling=null,T=zs.current,vr(zs,ne?T&1|2:T&1),A):(ta(A),null);case 22:case 23:return ku(),ne=A.memoizedState!==null,T!==null&&T.memoizedState!==null!==ne&&(A.flags|=8192),ne&&A.mode&1?Ka&1073741824&&(ta(A),Kt&&A.subtreeFlags&6&&(A.flags|=8192)):ta(A),null;case 24:return null;case 25:return null}throw Error(c(156,A.tag))}var Lm=s.ReactCurrentOwner,So=!1;function fa(T,A,Z,ne){A.child=T===null?Vf(A,null,Z,ne):Uo(A,T.child,Z,ne)}function Om(T,A,Z,ne,me){Z=Z.render;var Ae=A.ref;return Al(A,me),ne=Rd(T,A,Z,ne,Ae,me),Z=_h(),T!==null&&!So?(A.updateQueue=T.updateQueue,A.flags&=-2053,T.lanes&=~me,vc(T,A,me)):(As&&Z&&Bf(A),A.flags|=1,fa(T,A,ne,me),A.child)}function km(T,A,Z,ne,me){if(T===null){var Ae=Z.type;return typeof Ae=="function"&&!Ym(Ae)&&Ae.defaultProps===void 0&&Z.compare===null&&Z.defaultProps===void 0?(A.tag=15,A.type=Ae,Nm(T,A,Ae,ne,me)):(T=fp(Z.type,null,ne,A,A.mode,me),T.ref=A.ref,T.return=A,A.child=T)}if(Ae=T.child,!(T.lanes&me)){var _t=Ae.memoizedProps;if(Z=Z.compare,Z=Z!==null?Z:la,Z(_t,ne)&&T.ref===A.ref)return vc(T,A,me)}return A.flags|=1,T=nu(Ae,ne),T.ref=A.ref,T.return=A,A.child=T}function Nm(T,A,Z,ne,me){if(T!==null&&la(T.memoizedProps,ne)&&T.ref===A.ref)if(So=!1,(T.lanes&me)!==0)T.flags&131072&&(So=!0);else return A.lanes=T.lanes,vc(T,A,me);return bh(T,A,Z,ne,me)}function Gv(T,A,Z){var ne=A.pendingProps,me=ne.children,Ae=T!==null?T.memoizedState:null;if(ne.mode==="hidden")if(!(A.mode&1))A.memoizedState={baseLanes:0,cachePool:null},vr(jd,Ka),Ka|=Z;else if(Z&1073741824)A.memoizedState={baseLanes:0,cachePool:null},ne=Ae!==null?Ae.baseLanes:Z,vr(jd,Ka),Ka|=ne;else return T=Ae!==null?Ae.baseLanes|Z:Z,A.lanes=A.childLanes=1073741824,A.memoizedState={baseLanes:T,cachePool:null},A.updateQueue=null,vr(jd,Ka),Ka|=T,null;else Ae!==null?(ne=Ae.baseLanes|Z,A.memoizedState=null):ne=Z,vr(jd,Ka),Ka|=ne;return fa(T,A,me,Z),A.child}function Bm(T,A){var Z=A.ref;(T===null&&Z!==null||T!==null&&T.ref!==Z)&&(A.flags|=512,A.flags|=2097152)}function bh(T,A,Z,ne,me){var Ae=is(Z)?tr:fi.current;return Ae=Ss(A,Ae),Al(A,me),Z=Rd(T,A,Z,ne,Ae,me),ne=_h(),T!==null&&!So?(A.updateQueue=T.updateQueue,A.flags&=-2053,T.lanes&=~me,vc(T,A,me)):(As&&ne&&Bf(A),A.flags|=1,fa(T,A,Z,me),A.child)}function e0(T,A,Z,ne,me){if(is(Z)){var Ae=!0;Jo(A)}else Ae=!1;if(Al(A,me),A.stateNode===null)T!==null&&(T.alternate=null,A.alternate=null,A.flags|=2),X_(A,Z,ne),ym(A,Z,ne,me),ne=!0;else if(T===null){var _t=A.stateNode,Jt=A.memoizedProps;_t.props=Jt;var Sn=_t.context,Kn=Z.contextType;typeof Kn=="object"&&Kn!==null?Kn=Bo(Kn):(Kn=is(Z)?tr:fi.current,Kn=Ss(A,Kn));var Ai=Z.getDerivedStateFromProps,pr=typeof Ai=="function"||typeof _t.getSnapshotBeforeUpdate=="function";pr||typeof _t.UNSAFE_componentWillReceiveProps!="function"&&typeof _t.componentWillReceiveProps!="function"||(Jt!==ne||Sn!==Kn)&&mh(A,_t,ne,Kn),Pl=!1;var Gi=A.memoizedState;_t.state=Gi,kf(A,ne,_t,me),Sn=A.memoizedState,Jt!==ne||Gi!==Sn||fs.current||Pl?(typeof Ai=="function"&&(Pv(A,Z,Ai,ne),Sn=A.memoizedState),(Jt=Pl||Mu(A,Z,Jt,ne,Gi,Sn,Kn))?(pr||typeof _t.UNSAFE_componentWillMount!="function"&&typeof _t.componentWillMount!="function"||(typeof _t.componentWillMount=="function"&&_t.componentWillMount(),typeof _t.UNSAFE_componentWillMount=="function"&&_t.UNSAFE_componentWillMount()),typeof _t.componentDidMount=="function"&&(A.flags|=4194308)):(typeof _t.componentDidMount=="function"&&(A.flags|=4194308),A.memoizedProps=ne,A.memoizedState=Sn),_t.props=ne,_t.state=Sn,_t.context=Kn,ne=Jt):(typeof _t.componentDidMount=="function"&&(A.flags|=4194308),ne=!1)}else{_t=A.stateNode,Z_(T,A),Jt=A.memoizedProps,Kn=A.type===A.elementType?Jt:Os(A.type,Jt),_t.props=Kn,pr=A.pendingProps,Gi=_t.context,Sn=Z.contextType,typeof Sn=="object"&&Sn!==null?Sn=Bo(Sn):(Sn=is(Z)?tr:fi.current,Sn=Ss(A,Sn));var vs=Z.getDerivedStateFromProps;(Ai=typeof vs=="function"||typeof _t.getSnapshotBeforeUpdate=="function")||typeof _t.UNSAFE_componentWillReceiveProps!="function"&&typeof _t.componentWillReceiveProps!="function"||(Jt!==pr||Gi!==Sn)&&mh(A,_t,ne,Sn),Pl=!1,Gi=A.memoizedState,_t.state=Gi,kf(A,ne,_t,me);var Fi=A.memoizedState;Jt!==pr||Gi!==Fi||fs.current||Pl?(typeof vs=="function"&&(Pv(A,Z,vs,ne),Fi=A.memoizedState),(Kn=Pl||Mu(A,Z,Kn,ne,Gi,Fi,Sn)||!1)?(Ai||typeof _t.UNSAFE_componentWillUpdate!="function"&&typeof _t.componentWillUpdate!="function"||(typeof _t.componentWillUpdate=="function"&&_t.componentWillUpdate(ne,Fi,Sn),typeof _t.UNSAFE_componentWillUpdate=="function"&&_t.UNSAFE_componentWillUpdate(ne,Fi,Sn)),typeof _t.componentDidUpdate=="function"&&(A.flags|=4),typeof _t.getSnapshotBeforeUpdate=="function"&&(A.flags|=1024)):(typeof _t.componentDidUpdate!="function"||Jt===T.memoizedProps&&Gi===T.memoizedState||(A.flags|=4),typeof _t.getSnapshotBeforeUpdate!="function"||Jt===T.memoizedProps&&Gi===T.memoizedState||(A.flags|=1024),A.memoizedProps=ne,A.memoizedState=Fi),_t.props=ne,_t.state=Fi,_t.context=Sn,ne=Kn):(typeof _t.componentDidUpdate!="function"||Jt===T.memoizedProps&&Gi===T.memoizedState||(A.flags|=4),typeof _t.getSnapshotBeforeUpdate!="function"||Jt===T.memoizedProps&&Gi===T.memoizedState||(A.flags|=1024),ne=!1)}return Hv(T,A,Z,ne,Ae,me)}function Hv(T,A,Z,ne,me,Ae){Bm(T,A);var _t=(A.flags&128)!==0;if(!ne&&!_t)return me&&cc(A,Z,!1),vc(T,A,Ae);ne=A.stateNode,Lm.current=A;var Jt=_t&&typeof Z.getDerivedStateFromError!="function"?null:ne.render();return A.flags|=1,T!==null&&_t?(A.child=Uo(A,T.child,null,Ae),A.child=Uo(A,null,Jt,Ae)):fa(T,A,Jt,Ae),A.memoizedState=ne.state,me&&cc(A,Z,!0),A.child}function zm(T){var A=T.stateNode;A.pendingContext?Yo(T,A.pendingContext,A.pendingContext!==A.context):A.context&&Yo(T,A.context,!1),Gf(T,A.containerInfo)}function t0(T,A,Z,ne,me){return Dl(),Ed(me),A.flags|=256,fa(T,A,Z,ne),A.child}var Od={dehydrated:null,treeContext:null,retryLane:0};function Eh(T){return{baseLanes:T,cachePool:null}}function Mh(T,A,Z){var ne=A.pendingProps,me=zs.current,Ae=!1,_t=(A.flags&128)!==0,Jt;if((Jt=_t)||(Jt=T!==null&&T.memoizedState===null?!1:(me&2)!==0),Jt?(Ae=!0,A.flags&=-129):(T===null||T.memoizedState!==null)&&(me|=1),vr(zs,me&1),T===null)return Uf(A),T=A.memoizedState,T!==null&&(T=T.dehydrated,T!==null)?(A.mode&1?zt(T)?A.lanes=8:A.lanes=1073741824:A.lanes=1,null):(me=ne.children,T=ne.fallback,Ae?(ne=A.mode,Ae=A.child,me={mode:"hidden",children:me},!(ne&1)&&Ae!==null?(Ae.childLanes=0,Ae.pendingProps=me):Ae=pp(me,ne,0,null),T=Nu(T,ne,Z,null),Ae.return=A,T.return=A,Ae.sibling=T,A.child=Ae,A.child.memoizedState=Eh(Z),A.memoizedState=Od,T):kd(A,me));if(me=T.memoizedState,me!==null){if(Jt=me.dehydrated,Jt!==null){if(_t)return A.flags&256?(A.flags&=-257,Rh(T,A,Z,Error(c(422)))):A.memoizedState!==null?(A.child=T.child,A.flags|=128,null):(Ae=ne.fallback,me=A.mode,ne=pp({mode:"visible",children:ne.children},me,0,null),Ae=Nu(Ae,me,Z,null),Ae.flags|=2,ne.return=A,Ae.return=A,ne.sibling=Ae,A.child=ne,A.mode&1&&Uo(A,T.child,null,Z),A.child.memoizedState=Eh(Z),A.memoizedState=Od,Ae);if(!(A.mode&1))A=Rh(T,A,Z,null);else if(zt(Jt))A=Rh(T,A,Z,Error(c(419)));else if(ne=(Z&T.childLanes)!==0,So||ne){if(ne=Rs,ne!==null){switch(Z&-Z){case 4:Ae=2;break;case 16:Ae=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Ae=32;break;case 536870912:Ae=268435456;break;default:Ae=0}ne=Ae&(ne.suspendedLanes|Z)?0:Ae,ne!==0&&ne!==me.retryLane&&(me.retryLane=ne,Mo(T,ne,-1))}up(),A=Rh(T,A,Z,Error(c(421)))}else wt(Jt)?(A.flags|=128,A.child=T.child,A=r0.bind(null,T),St(Jt,A),A=null):(Z=me.treeContext,Dt&&(ps=fn(Jt),Co=A,As=!0,ha=null,dc=!1,Z!==null&&(Da[_i++]=qa,Da[_i++]=yi,Da[_i++]=Zc,qa=Z.id,yi=Z.overflow,Zc=A)),A=kd(A,A.pendingProps.children),A.flags|=4096);return A}return Ae?(ne=Iu(T,A,ne.children,ne.fallback,Z),Ae=A.child,me=T.child.memoizedState,Ae.memoizedState=me===null?Eh(Z):{baseLanes:me.baseLanes|Z,cachePool:null},Ae.childLanes=T.childLanes&~Z,A.memoizedState=Od,ne):(Z=Nd(T,A,ne.children,Z),A.memoizedState=null,Z)}return Ae?(ne=Iu(T,A,ne.children,ne.fallback,Z),Ae=A.child,me=T.child.memoizedState,Ae.memoizedState=me===null?Eh(Z):{baseLanes:me.baseLanes|Z,cachePool:null},Ae.childLanes=T.childLanes&~Z,A.memoizedState=Od,ne):(Z=Nd(T,A,ne.children,Z),A.memoizedState=null,Z)}function kd(T,A){return A=pp({mode:"visible",children:A},T.mode,0,null),A.return=T,T.child=A}function Nd(T,A,Z,ne){var me=T.child;return T=me.sibling,Z=nu(me,{mode:"visible",children:Z}),!(A.mode&1)&&(Z.lanes=ne),Z.return=A,Z.sibling=null,T!==null&&(ne=A.deletions,ne===null?(A.deletions=[T],A.flags|=16):ne.push(T)),A.child=Z}function Iu(T,A,Z,ne,me){var Ae=A.mode;T=T.child;var _t=T.sibling,Jt={mode:"hidden",children:Z};return!(Ae&1)&&A.child!==T?(Z=A.child,Z.childLanes=0,Z.pendingProps=Jt,A.deletions=null):(Z=nu(T,Jt),Z.subtreeFlags=T.subtreeFlags&14680064),_t!==null?ne=nu(_t,ne):(ne=Nu(ne,Ae,me,null),ne.flags|=2),ne.return=A,Z.return=A,Z.sibling=ne,A.child=Z,ne}function Rh(T,A,Z,ne){return ne!==null&&Ed(ne),Uo(A,T.child,null,Z),T=kd(A,A.pendingProps.children),T.flags|=2,A.memoizedState=null,T}function Qf(T,A,Z){T.lanes|=A;var ne=T.alternate;ne!==null&&(ne.lanes|=A),$a(T.return,A,Z)}function ep(T,A,Z,ne,me){var Ae=T.memoizedState;Ae===null?T.memoizedState={isBackwards:A,rendering:null,renderingStartTime:0,last:ne,tail:Z,tailMode:me}:(Ae.isBackwards=A,Ae.rendering=null,Ae.renderingStartTime=0,Ae.last=ne,Ae.tail=Z,Ae.tailMode=me)}function Um(T,A,Z){var ne=A.pendingProps,me=ne.revealOrder,Ae=ne.tail;if(fa(T,A,ne.children,Z),ne=zs.current,ne&2)ne=ne&1|2,A.flags|=128;else{if(T!==null&&T.flags&128)e:for(T=A.child;T!==null;){if(T.tag===13)T.memoizedState!==null&&Qf(T,Z,A);else if(T.tag===19)Qf(T,Z,A);else if(T.child!==null){T.child.return=T,T=T.child;continue}if(T===A)break e;for(;T.sibling===null;){if(T.return===null||T.return===A)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}ne&=1}if(vr(zs,ne),!(A.mode&1))A.memoizedState=null;else switch(me){case"forwards":for(Z=A.child,me=null;Z!==null;)T=Z.alternate,T!==null&&Wf(T)===null&&(me=Z),Z=Z.sibling;Z=me,Z===null?(me=A.child,A.child=null):(me=Z.sibling,Z.sibling=null),ep(A,!1,me,Z,Ae);break;case"backwards":for(Z=null,me=A.child,A.child=null;me!==null;){if(T=me.alternate,T!==null&&Wf(T)===null){A.child=me;break}T=me.sibling,me.sibling=Z,Z=me,me=T}ep(A,!0,Z,null,Ae);break;case"together":ep(A,!1,null,null,void 0);break;default:A.memoizedState=null}return A.child}function vc(T,A,Z){if(T!==null&&(A.dependencies=T.dependencies),Lu|=A.lanes,!(Z&A.childLanes))return null;if(T!==null&&A.child!==T.child)throw Error(c(153));if(A.child!==null){for(T=A.child,Z=nu(T,T.pendingProps),A.child=Z,Z.return=A;T.sibling!==null;)T=T.sibling,Z=Z.sibling=nu(T,T.pendingProps),Z.return=A;Z.sibling=null}return A.child}function Th(T,A,Z){switch(A.tag){case 3:zm(A),Dl();break;case 5:Hf(A);break;case 1:is(A.type)&&Jo(A);break;case 4:Gf(A,A.stateNode.containerInfo);break;case 10:Qs(A,A.type._context,A.memoizedProps.value);break;case 13:var ne=A.memoizedState;if(ne!==null)return ne.dehydrated!==null?(vr(zs,zs.current&1),A.flags|=128,null):Z&A.child.childLanes?Mh(T,A,Z):(vr(zs,zs.current&1),T=vc(T,A,Z),T!==null?T.sibling:null);vr(zs,zs.current&1);break;case 19:if(ne=(Z&A.childLanes)!==0,T.flags&128){if(ne)return Um(T,A,Z);A.flags|=128}var me=A.memoizedState;if(me!==null&&(me.rendering=null,me.tail=null,me.lastEffect=null),vr(zs,zs.current),ne)break;return null;case 22:case 23:return A.lanes=0,Gv(T,A,Z)}return vc(T,A,Z)}function tp(T,A){switch(hc(A),A.tag){case 1:return is(A.type)&&rs(),T=A.flags,T&65536?(A.flags=T&-65537|128,A):null;case 3:return Tu(),ji(fs),ji(fi),jf(),T=A.flags,T&65536&&!(T&128)?(A.flags=T&-65537|128,A):null;case 5:return xm(A),null;case 13:if(ji(zs),T=A.memoizedState,T!==null&&T.dehydrated!==null){if(A.alternate===null)throw Error(c(340));Dl()}return T=A.flags,T&65536?(A.flags=T&-65537|128,A):null;case 19:return ji(zs),null;case 4:return Tu(),null;case 10:return Lf(A.type._context),null;case 22:case 23:return ku(),null;case 24:return null;default:return null}}var Un=!1,yc=!1,Wv=typeof WeakSet=="function"?WeakSet:Set,ci=null;function na(T,A){var Z=T.ref;if(Z!==null)if(typeof Z=="function")try{Z(null)}catch(ne){ra(T,A,ne)}else Z.current=null}function Jn(T,A,Z){try{Z()}catch(ne){ra(T,A,ne)}}var Vm=!1;function n0(T,A){for($e(T.containerInfo),ci=A;ci!==null;)if(T=ci,A=T.child,(T.subtreeFlags&1028)!==0&&A!==null)A.return=T,ci=A;else for(;ci!==null;){T=ci;try{var Z=T.alternate;if(T.flags&1024)switch(T.tag){case 0:case 11:case 15:break;case 1:if(Z!==null){var ne=Z.memoizedProps,me=Z.memoizedState,Ae=T.stateNode,_t=Ae.getSnapshotBeforeUpdate(T.elementType===T.type?ne:Os(T.type,ne),me);Ae.__reactInternalSnapshotBeforeUpdate=_t}break;case 3:Kt&&Ln(T.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(c(163))}}catch(Jt){ra(T,T.return,Jt)}if(A=T.sibling,A!==null){A.return=T.return,ci=A;break}ci=T.return}return Z=Vm,Vm=!1,Z}function Ah(T,A,Z){var ne=A.updateQueue;if(ne=ne!==null?ne.lastEffect:null,ne!==null){var me=ne=ne.next;do{if((me.tag&T)===T){var Ae=me.destroy;me.destroy=void 0,Ae!==void 0&&Jn(A,Z,Ae)}me=me.next}while(me!==ne)}}function _c(T,A){if(A=A.updateQueue,A=A!==null?A.lastEffect:null,A!==null){var Z=A=A.next;do{if((Z.tag&T)===T){var ne=Z.create;Z.destroy=ne()}Z=Z.next}while(Z!==A)}}function np(T){var A=T.ref;if(A!==null){var Z=T.stateNode;switch(T.tag){case 5:T=qe(Z);break;default:T=Z}typeof A=="function"?A(T):A.current=T}}function Bd(T,A,Z){if($i&&typeof $i.onCommitFiberUnmount=="function")try{$i.onCommitFiberUnmount(xo,A)}catch{}switch(A.tag){case 0:case 11:case 14:case 15:if(T=A.updateQueue,T!==null&&(T=T.lastEffect,T!==null)){var ne=T=T.next;do{var me=ne,Ae=me.destroy;me=me.tag,Ae!==void 0&&(me&2||me&4)&&Jn(A,Z,Ae),ne=ne.next}while(ne!==T)}break;case 1:if(na(A,Z),T=A.stateNode,typeof T.componentWillUnmount=="function")try{T.props=A.memoizedProps,T.state=A.memoizedState,T.componentWillUnmount()}catch(_t){ra(A,Z,_t)}break;case 5:na(A,Z);break;case 4:Kt?Oa(T,A,Z):bt&&bt&&(A=A.stateNode.containerInfo,Z=hi(A),Ft(A,Z))}}function jv(T,A,Z){for(var ne=A;;)if(Bd(T,ne,Z),ne.child===null||Kt&&ne.tag===4){if(ne===A)break;for(;ne.sibling===null;){if(ne.return===null||ne.return===A)return;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}else ne.child.return=ne,ne=ne.child}function i0(T){var A=T.alternate;A!==null&&(T.alternate=null,i0(A)),T.child=null,T.deletions=null,T.sibling=null,T.tag===5&&(A=T.stateNode,A!==null&&tn(A)),T.stateNode=null,T.return=null,T.dependencies=null,T.memoizedProps=null,T.memoizedState=null,T.pendingProps=null,T.stateNode=null,T.updateQueue=null}function Gm(T){return T.tag===5||T.tag===3||T.tag===4}function zd(T){e:for(;;){for(;T.sibling===null;){if(T.return===null||Gm(T.return))return null;T=T.return}for(T.sibling.return=T.return,T=T.sibling;T.tag!==5&&T.tag!==6&&T.tag!==18;){if(T.flags&2||T.child===null||T.tag===4)continue e;T.child.return=T,T=T.child}if(!(T.flags&2))return T.stateNode}}function Ud(T){if(Kt){e:{for(var A=T.return;A!==null;){if(Gm(A))break e;A=A.return}throw Error(c(160))}var Z=A;switch(Z.tag){case 5:A=Z.stateNode,Z.flags&32&&(er(A),Z.flags&=-33),Z=zd(T),bo(T,Z,A);break;case 3:case 4:A=Z.stateNode.containerInfo,Z=zd(T),Vd(T,Z,A);break;default:throw Error(c(161))}}}function Vd(T,A,Z){var ne=T.tag;if(ne===5||ne===6)T=T.stateNode,A?Ti(Z,T,A):Zn(Z,T);else if(ne!==4&&(T=T.child,T!==null))for(Vd(T,A,Z),T=T.sibling;T!==null;)Vd(T,A,Z),T=T.sibling}function bo(T,A,Z){var ne=T.tag;if(ne===5||ne===6)T=T.stateNode,A?gi(Z,T,A):Bn(Z,T);else if(ne!==4&&(T=T.child,T!==null))for(bo(T,A,Z),T=T.sibling;T!==null;)bo(T,A,Z),T=T.sibling}function Oa(T,A,Z){for(var ne=A,me=!1,Ae,_t;;){if(!me){me=ne.return;e:for(;;){if(me===null)throw Error(c(160));switch(Ae=me.stateNode,me.tag){case 5:_t=!1;break e;case 3:Ae=Ae.containerInfo,_t=!0;break e;case 4:Ae=Ae.containerInfo,_t=!0;break e}me=me.return}me=!0}if(ne.tag===5||ne.tag===6)jv(T,ne,Z),_t?Ji(Ae,ne.stateNode):pi(Ae,ne.stateNode);else if(ne.tag===18)_t?$t(Ae,ne.stateNode):Pt(Ae,ne.stateNode);else if(ne.tag===4){if(ne.child!==null){Ae=ne.stateNode.containerInfo,_t=!0,ne.child.return=ne,ne=ne.child;continue}}else if(Bd(T,ne,Z),ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===A)break;for(;ne.sibling===null;){if(ne.return===null||ne.return===A)return;ne=ne.return,ne.tag===4&&(me=!1)}ne.sibling.return=ne.return,ne=ne.sibling}}function Hm(T,A){if(Kt){switch(A.tag){case 0:case 11:case 14:case 15:Ah(3,A,A.return),_c(3,A),Ah(5,A,A.return);return;case 1:return;case 5:var Z=A.stateNode;if(Z!=null){var ne=A.memoizedProps;T=T!==null?T.memoizedProps:ne;var me=A.type,Ae=A.updateQueue;A.updateQueue=null,Ae!==null&&oi(Z,Ae,me,T,ne,A)}return;case 6:if(A.stateNode===null)throw Error(c(162));Z=A.memoizedProps,Li(A.stateNode,T!==null?T.memoizedProps:Z,Z);return;case 3:Dt&&T!==null&&T.memoizedState.isDehydrated&&Mi(A.stateNode.containerInfo);return;case 12:return;case 13:Gd(A);return;case 19:Gd(A);return;case 17:return}throw Error(c(163))}switch(A.tag){case 0:case 11:case 14:case 15:Ah(3,A,A.return),_c(3,A),Ah(5,A,A.return);return;case 12:return;case 13:Gd(A);return;case 19:Gd(A);return;case 3:Dt&&T!==null&&T.memoizedState.isDehydrated&&Mi(A.stateNode.containerInfo);break;case 22:case 23:return}e:if(bt){switch(A.tag){case 1:case 5:case 6:break e;case 3:case 4:A=A.stateNode,Ft(A.containerInfo,A.pendingChildren);break e}throw Error(c(163))}}function Gd(T){var A=T.updateQueue;if(A!==null){T.updateQueue=null;var Z=T.stateNode;Z===null&&(Z=T.stateNode=new Wv),A.forEach(function(ne){var me=Xm.bind(null,T,ne);Z.has(ne)||(Z.add(ne),ne.then(me,me))})}}function $v(T,A){for(ci=A;ci!==null;){A=ci;var Z=A.deletions;if(Z!==null)for(var ne=0;ne<Z.length;ne++){var me=Z[ne];try{var Ae=T;Kt?Oa(Ae,me,A):jv(Ae,me,A);var _t=me.alternate;_t!==null&&(_t.return=null),me.return=null}catch(Bi){ra(me,A,Bi)}}if(Z=A.child,A.subtreeFlags&12854&&Z!==null)Z.return=A,ci=Z;else for(;ci!==null;){A=ci;try{var Jt=A.flags;if(Jt&32&&Kt&&er(A.stateNode),Jt&512){var Sn=A.alternate;if(Sn!==null){var Kn=Sn.ref;Kn!==null&&(typeof Kn=="function"?Kn(null):Kn.current=null)}}if(Jt&8192)switch(A.tag){case 13:if(A.memoizedState!==null){var Ai=A.alternate;(Ai===null||Ai.memoizedState===null)&&(Zd=bs())}break;case 22:var pr=A.memoizedState!==null,Gi=A.alternate,vs=Gi!==null&&Gi.memoizedState!==null;if(Z=A,Kt){e:if(ne=Z,me=pr,Ae=null,Kt)for(var Fi=ne;;){if(Fi.tag===5){if(Ae===null){Ae=Fi;var io=Fi.stateNode;me?vi(io):ui(Fi.stateNode,Fi.memoizedProps)}}else if(Fi.tag===6){if(Ae===null){var po=Fi.stateNode;me?Wt(po):vn(po,Fi.memoizedProps)}}else if((Fi.tag!==22&&Fi.tag!==23||Fi.memoizedState===null||Fi===ne)&&Fi.child!==null){Fi.child.return=Fi,Fi=Fi.child;continue}if(Fi===ne)break;for(;Fi.sibling===null;){if(Fi.return===null||Fi.return===ne)break e;Ae===Fi&&(Ae=null),Fi=Fi.return}Ae===Fi&&(Ae=null),Fi.sibling.return=Fi.return,Fi=Fi.sibling}}if(pr&&!vs&&Z.mode&1){ci=Z;for(var cn=Z.child;cn!==null;){for(Z=ci=cn;ci!==null;){ne=ci;var Qt=ne.child;switch(ne.tag){case 0:case 11:case 14:case 15:Ah(4,ne,ne.return);break;case 1:na(ne,ne.return);var gn=ne.stateNode;if(typeof gn.componentWillUnmount=="function"){var ai=ne.return;try{gn.props=ne.memoizedProps,gn.state=ne.memoizedState,gn.componentWillUnmount()}catch(Bi){ra(ne,ai,Bi)}}break;case 5:na(ne,ne.return);break;case 22:if(ne.memoizedState!==null){gs(Z);continue}}Qt!==null?(Qt.return=ne,ci=Qt):gs(Z)}cn=cn.sibling}}}switch(Jt&4102){case 2:Ud(A),A.flags&=-3;break;case 6:Ud(A),A.flags&=-3,Hm(A.alternate,A);break;case 4096:A.flags&=-4097;break;case 4100:A.flags&=-4097,Hm(A.alternate,A);break;case 4:Hm(A.alternate,A)}}catch(Bi){ra(A,A.return,Bi)}if(Z=A.sibling,Z!==null){Z.return=A.return,ci=Z;break}ci=A.return}}}function qv(T,A,Z){ci=T,Zv(T)}function Zv(T,A,Z){for(var ne=(T.mode&1)!==0;ci!==null;){var me=ci,Ae=me.child;if(me.tag===22&&ne){var _t=me.memoizedState!==null||Un;if(!_t){var Jt=me.alternate,Sn=Jt!==null&&Jt.memoizedState!==null||yc;Jt=Un;var Kn=yc;if(Un=_t,(yc=Sn)&&!Kn)for(ci=me;ci!==null;)_t=ci,Sn=_t.child,_t.tag===22&&_t.memoizedState!==null?ip(me):Sn!==null?(Sn.return=_t,ci=Sn):ip(me);for(;Ae!==null;)ci=Ae,Zv(Ae),Ae=Ae.sibling;ci=me,Un=Jt,yc=Kn}ka(T)}else me.subtreeFlags&8772&&Ae!==null?(Ae.return=me,ci=Ae):ka(T)}}function ka(T){for(;ci!==null;){var A=ci;if(A.flags&8772){var Z=A.alternate;try{if(A.flags&8772)switch(A.tag){case 0:case 11:case 15:yc||_c(5,A);break;case 1:var ne=A.stateNode;if(A.flags&4&&!yc)if(Z===null)ne.componentDidMount();else{var me=A.elementType===A.type?Z.memoizedProps:Os(A.type,Z.memoizedProps);ne.componentDidUpdate(me,Z.memoizedState,ne.__reactInternalSnapshotBeforeUpdate)}var Ae=A.updateQueue;Ae!==null&&fh(A,Ae,ne);break;case 3:var _t=A.updateQueue;if(_t!==null){if(Z=null,A.child!==null)switch(A.child.tag){case 5:Z=qe(A.child.stateNode);break;case 1:Z=A.child.stateNode}fh(A,_t,Z)}break;case 5:var Jt=A.stateNode;Z===null&&A.flags&4&&zn(Jt,A.type,A.memoizedProps,A);break;case 6:break;case 4:break;case 12:break;case 13:if(Dt&&A.memoizedState===null){var Sn=A.alternate;if(Sn!==null){var Kn=Sn.memoizedState;if(Kn!==null){var Ai=Kn.dehydrated;Ai!==null&&Be(Ai)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(c(163))}yc||A.flags&512&&np(A)}catch(pr){ra(A,A.return,pr)}}if(A===T){ci=null;break}if(Z=A.sibling,Z!==null){Z.return=A.return,ci=Z;break}ci=A.return}}function gs(T){for(;ci!==null;){var A=ci;if(A===T){ci=null;break}var Z=A.sibling;if(Z!==null){Z.return=A.return,ci=Z;break}ci=A.return}}function ip(T){for(;ci!==null;){var A=ci;try{switch(A.tag){case 0:case 11:case 15:var Z=A.return;try{_c(4,A)}catch(Sn){ra(A,Z,Sn)}break;case 1:var ne=A.stateNode;if(typeof ne.componentDidMount=="function"){var me=A.return;try{ne.componentDidMount()}catch(Sn){ra(A,me,Sn)}}var Ae=A.return;try{np(A)}catch(Sn){ra(A,Ae,Sn)}break;case 5:var _t=A.return;try{np(A)}catch(Sn){ra(A,_t,Sn)}}}catch(Sn){ra(A,A.return,Sn)}if(A===T){ci=null;break}var Jt=A.sibling;if(Jt!==null){Jt.return=A.return,ci=Jt;break}ci=A.return}}var Hd=0,rp=1,sp=2,op=3,Wm=4;if(typeof Symbol=="function"&&Symbol.for){var xc=Symbol.for;Hd=xc("selector.component"),rp=xc("selector.has_pseudo_class"),sp=xc("selector.role"),op=xc("selector.test_id"),Wm=xc("selector.text")}function Du(T){var A=_e(T);if(A!=null){if(typeof A.memoizedProps["data-testname"]!="string")throw Error(c(364));return A}if(T=Le(T),T===null)throw Error(c(362));return T.stateNode.current}function yn(T,A){switch(A.$$typeof){case Hd:if(T.type===A.value)return!0;break;case rp:e:{A=A.value,T=[T,0];for(var Z=0;Z<T.length;){var ne=T[Z++],me=T[Z++],Ae=A[me];if(ne.tag!==5||!yt(ne)){for(;Ae!=null&&yn(ne,Ae);)me++,Ae=A[me];if(me===A.length){A=!0;break e}else for(ne=ne.child;ne!==null;)T.push(ne,me),ne=ne.sibling}}A=!1}return A;case sp:if(T.tag===5&&nn(T.stateNode,A.value))return!0;break;case Wm:if((T.tag===5||T.tag===6)&&(T=vt(T),T!==null&&0<=T.indexOf(A.value)))return!0;break;case op:if(T.tag===5&&(T=T.memoizedProps["data-testname"],typeof T=="string"&&T.toLowerCase()===A.value.toLowerCase()))return!0;break;default:throw Error(c(365))}return!1}function ni(T){switch(T.$$typeof){case Hd:return"<"+(ae(T.value)||"Unknown")+">";case rp:return":has("+(ni(T)||"")+")";case sp:return'[role="'+T.value+'"]';case Wm:return'"'+T.value+'"';case op:return'[data-testname="'+T.value+'"]';default:throw Error(c(365))}}function Ph(T,A){var Z=[];T=[T,0];for(var ne=0;ne<T.length;){var me=T[ne++],Ae=T[ne++],_t=A[Ae];if(me.tag!==5||!yt(me)){for(;_t!=null&&yn(me,_t);)Ae++,_t=A[Ae];if(Ae===A.length)Z.push(me);else for(me=me.child;me!==null;)T.push(me,Ae),me=me.sibling}}return Z}function Ur(T,A){if(!it)throw Error(c(363));T=Du(T),T=Ph(T,A),A=[],T=Array.from(T);for(var Z=0;Z<T.length;){var ne=T[Z++];if(ne.tag===5)yt(ne)||A.push(ne.stateNode);else for(ne=ne.child;ne!==null;)T.push(ne),ne=ne.sibling}return A}var Tt=Math.ceil,Wd=s.ReactCurrentDispatcher,Qc=s.ReactCurrentOwner,Hs=s.ReactCurrentBatchConfig,xr=0,Rs=null,Xs=null,Ps=0,Ka=0,jd=Pr(0),fo=0,Fu=null,Lu=0,$d=0,qd=0,Ol=null,Go=null,Zd=0,jm=1/0;function _a(){jm=bs()+500}var Ho=!1,$m=null,sl=null,Nr=!1,Qi=null,ap=0,ol=0,Xd=null,eu=-1,Kd=0;function Eo(){return xr&6?bs():eu!==-1?eu:eu=bs()}function pa(T){return T.mode&1?xr&2&&Ps!==0?Ps&-Ps:gm.transition!==null?(Kd===0&&(T=Qo,Qo<<=1,!(Qo&4194240)&&(Qo=64),Kd=T),Kd):(T=Hn,T!==0?T:Ot()):1}function Mo(T,A,Z){if(50<ol)throw ol=0,Xd=null,Error(c(185));var ne=al(T,A);return ne===null?null:(uh(ne,A,Z),(!(xr&2)||ne!==Rs)&&(ne===Rs&&(!(xr&2)&&($d|=A),fo===4&&xa(ne,Ps)),ia(ne,Z),A===1&&xr===0&&!(T.mode&1)&&(_a(),Es&&wo())),ne)}function al(T,A){T.lanes|=A;var Z=T.alternate;for(Z!==null&&(Z.lanes|=A),Z=T,T=T.return;T!==null;)T.childLanes|=A,Z=T.alternate,Z!==null&&(Z.childLanes|=A),Z=T,T=T.return;return Z.tag===3?Z.stateNode:null}function ia(T,A){var Z=T.callbackNode;xd(T,A);var ne=jc(T,T===Rs?Ps:0);if(ne===0)Z!==null&&hh(Z),T.callbackNode=null,T.callbackPriority=0;else if(A=ne&-ne,T.callbackPriority!==A){if(Z!=null&&hh(Z),A===1)T.tag===0?Sd(qm.bind(null,T)):dh(qm.bind(null,T)),xe?Se(function(){xr===0&&wo()}):$c(Wn,wo),Z=null;else{switch(wd(ne)){case 1:Z=Wn;break;case 4:Z=ur;break;case 16:Z=nr;break;case 536870912:Z=Ia;break;default:Z=nr}Z=Km(Z,Yd.bind(null,T))}T.callbackPriority=A,T.callbackNode=Z}}function Yd(T,A){if(eu=-1,Kd=0,xr&6)throw Error(c(327));var Z=T.callbackNode;if(Nl()&&T.callbackNode!==Z)return null;var ne=jc(T,T===Rs?Ps:0);if(ne===0)return null;if(ne&30||ne&T.expiredLanes||A)A=tu(T,ne);else{A=ne;var me=xr;xr|=2;var Ae=Ih();(Rs!==T||Ps!==A)&&(_a(),ll(T,A));do try{Kv();break}catch(Jt){ss(T,Jt)}while(!0);ja(),Wd.current=Ae,xr=me,Xs!==null?A=0:(Rs=null,Ps=0,A=fo)}if(A!==0){if(A===2&&(me=Df(T),me!==0&&(ne=me,A=Ou(T,me))),A===1)throw Z=Fu,ll(T,0),xa(T,ne),ia(T,bs()),Z;if(A===6)xa(T,ne);else{if(me=T.current.alternate,!(ne&30)&&!Xv(me)&&(A=tu(T,ne),A===2&&(Ae=Df(T),Ae!==0&&(ne=Ae,A=Ou(T,Ae))),A===1))throw Z=Fu,ll(T,0),xa(T,ne),ia(T,bs()),Z;switch(T.finishedWork=me,T.finishedLanes=ne,A){case 0:case 1:throw Error(c(345));case 2:kl(T,Go);break;case 3:if(xa(T,ne),(ne&130023424)===ne&&(A=Zd+500-bs(),10<A)){if(jc(T,0)!==0)break;if(me=T.suspendedLanes,(me&ne)!==ne){Eo(),T.pingedLanes|=T.suspendedLanes&me;break}T.timeoutHandle=De(kl.bind(null,T,Go),A);break}kl(T,Go);break;case 4:if(xa(T,ne),(ne&4194240)===ne)break;for(A=T.eventTimes,me=-1;0<ne;){var _t=31-Zr(ne);Ae=1<<_t,_t=A[_t],_t>me&&(me=_t),ne&=~Ae}if(ne=me,ne=bs()-ne,ne=(120>ne?120:480>ne?480:1080>ne?1080:1920>ne?1920:3e3>ne?3e3:4320>ne?4320:1960*Tt(ne/1960))-ne,10<ne){T.timeoutHandle=De(kl.bind(null,T,Go),ne);break}kl(T,Go);break;case 5:kl(T,Go);break;default:throw Error(c(329))}}}return ia(T,bs()),T.callbackNode===Z?Yd.bind(null,T):null}function Ou(T,A){var Z=Ol;return T.current.memoizedState.isDehydrated&&(ll(T,A).flags|=256),T=tu(T,A),T!==2&&(A=Go,Go=Z,A!==null&&lp(A)),T}function lp(T){Go===null?Go=T:Go.push.apply(Go,T)}function Xv(T){for(var A=T;;){if(A.flags&16384){var Z=A.updateQueue;if(Z!==null&&(Z=Z.stores,Z!==null))for(var ne=0;ne<Z.length;ne++){var me=Z[ne],Ae=me.getSnapshot;me=me.value;try{if(!ya(Ae(),me))return!1}catch{return!1}}}if(Z=A.child,A.subtreeFlags&16384&&Z!==null)Z.return=A,A=Z;else{if(A===T)break;for(;A.sibling===null;){if(A.return===null||A.return===T)return!0;A=A.return}A.sibling.return=A.return,A=A.sibling}}return!0}function xa(T,A){for(A&=~qd,A&=~$d,T.suspendedLanes|=A,T.pingedLanes&=~A,T=T.expirationTimes;0<A;){var Z=31-Zr(A),ne=1<<Z;T[Z]=-1,A&=~ne}}function qm(T){if(xr&6)throw Error(c(327));Nl();var A=jc(T,0);if(!(A&1))return ia(T,bs()),null;var Z=tu(T,A);if(T.tag!==0&&Z===2){var ne=Df(T);ne!==0&&(A=ne,Z=Ou(T,ne))}if(Z===1)throw Z=Fu,ll(T,0),xa(T,A),ia(T,bs()),Z;if(Z===6)throw Error(c(345));return T.finishedWork=T.current.alternate,T.finishedLanes=A,kl(T,Go),ia(T,bs()),null}function cp(T){Qi!==null&&Qi.tag===0&&!(xr&6)&&Nl();var A=xr;xr|=1;var Z=Hs.transition,ne=Hn;try{if(Hs.transition=null,Hn=1,T)return T()}finally{Hn=ne,Hs.transition=Z,xr=A,!(xr&6)&&wo()}}function ku(){Ka=jd.current,ji(jd)}function ll(T,A){T.finishedWork=null,T.finishedLanes=0;var Z=T.timeoutHandle;if(Z!==rn&&(T.timeoutHandle=rn,kt(Z)),Xs!==null)for(Z=Xs.return;Z!==null;){var ne=Z;switch(hc(ne),ne.tag){case 1:ne=ne.type.childContextTypes,ne!=null&&rs();break;case 3:Tu(),ji(fs),ji(fi),jf();break;case 5:xm(ne);break;case 4:Tu();break;case 13:ji(zs);break;case 19:ji(zs);break;case 10:Lf(ne.type._context);break;case 22:case 23:ku()}Z=Z.return}if(Rs=T,Xs=T=nu(T.current,null),Ps=Ka=A,fo=0,Fu=null,qd=$d=Lu=0,Go=Ol=null,ua!==null){for(A=0;A<ua.length;A++)if(Z=ua[A],ne=Z.interleaved,ne!==null){Z.interleaved=null;var me=ne.next,Ae=Z.pending;if(Ae!==null){var _t=Ae.next;Ae.next=me,ne.next=_t}Z.pending=ne}ua=null}return T}function ss(T,A){do{var Z=Xs;try{if(ja(),$f.current=Au,vh){for(var ne=Fs.memoizedState;ne!==null;){var me=ne.queue;me!==null&&(me.pending=null),ne=ne.next}vh=!1}if(Kc=0,Zs=to=Fs=null,il=!1,rl=0,Qc.current=null,Z===null||Z.return===null){fo=1,Fu=A,Xs=null;break}e:{var Ae=T,_t=Z.return,Jt=Z,Sn=A;if(A=Ps,Jt.flags|=32768,Sn!==null&&typeof Sn=="object"&&typeof Sn.then=="function"){var Kn=Sn,Ai=Jt,pr=Ai.tag;if(!(Ai.mode&1)&&(pr===0||pr===11||pr===15)){var Gi=Ai.alternate;Gi?(Ai.updateQueue=Gi.updateQueue,Ai.memoizedState=Gi.memoizedState,Ai.lanes=Gi.lanes):(Ai.updateQueue=null,Ai.memoizedState=null)}var vs=Vv(_t);if(vs!==null){vs.flags&=-257,Dm(vs,_t,Jt,Ae,A),vs.mode&1&&Uv(Ae,Kn,A),A=vs,Sn=Kn;var Fi=A.updateQueue;if(Fi===null){var io=new Set;io.add(Sn),A.updateQueue=io}else Fi.add(Sn);break e}else{if(!(A&1)){Uv(Ae,Kn,A),up();break e}Sn=Error(c(426))}}else if(As&&Jt.mode&1){var po=Vv(_t);if(po!==null){!(po.flags&65536)&&(po.flags|=256),Dm(po,_t,Jt,Ae,A),Ed(Sn);break e}}Ae=Sn,fo!==4&&(fo=2),Ol===null?Ol=[Ae]:Ol.push(Ae),Sn=Pu(Sn,Jt),Jt=_t;do{switch(Jt.tag){case 3:Jt.flags|=65536,A&=-A,Jt.lanes|=A;var cn=zv(Jt,Sn,A);Of(Jt,cn);break e;case 1:Ae=Sn;var Qt=Jt.type,gn=Jt.stateNode;if(!(Jt.flags&128)&&(typeof Qt.getDerivedStateFromError=="function"||gn!==null&&typeof gn.componentDidCatch=="function"&&(sl===null||!sl.has(gn)))){Jt.flags|=65536,A&=-A,Jt.lanes|=A;var ai=Sh(Jt,Ae,A);Of(Jt,ai);break e}}Jt=Jt.return}while(Jt!==null)}Yv(Z)}catch(Bi){A=Bi,Xs===Z&&Z!==null&&(Xs=Z=Z.return);continue}break}while(!0)}function Ih(){var T=Wd.current;return Wd.current=Au,T===null?Au:T}function up(){(fo===0||fo===3||fo===2)&&(fo=4),Rs===null||!(Lu&268435455)&&!($d&268435455)||xa(Rs,Ps)}function tu(T,A){var Z=xr;xr|=2;var ne=Ih();Rs===T&&Ps===A||ll(T,A);do try{Dh();break}catch(me){ss(T,me)}while(!0);if(ja(),xr=Z,Wd.current=ne,Xs!==null)throw Error(c(261));return Rs=null,Ps=0,fo}function Dh(){for(;Xs!==null;)hp(Xs)}function Kv(){for(;Xs!==null&&!Rl();)hp(Xs)}function hp(T){var A=Qd(T.alternate,T,Ka);T.memoizedProps=T.pendingProps,A===null?Yv(T):Xs=A,Qc.current=null}function Yv(T){var A=T;do{var Z=A.alternate;if(T=A.return,A.flags&32768){if(Z=tp(Z,A),Z!==null){Z.flags&=32767,Xs=Z;return}if(T!==null)T.flags|=32768,T.subtreeFlags=0,T.deletions=null;else{fo=6,Xs=null;return}}else if(Z=Jc(Z,A,Ka),Z!==null){Xs=Z;return}if(A=A.sibling,A!==null){Xs=A;return}Xs=A=T}while(A!==null);fo===0&&(fo=5)}function kl(T,A){var Z=Hn,ne=Hs.transition;try{Hs.transition=null,Hn=1,Jv(T,A,Z)}finally{Hs.transition=ne,Hn=Z}return null}function Jv(T,A,Z){do Nl();while(Qi!==null);if(xr&6)throw Error(c(327));var ne=T.finishedWork,me=T.finishedLanes;if(ne===null)return null;if(T.finishedWork=null,T.finishedLanes=0,ne===T.current)throw Error(c(177));T.callbackNode=null,T.callbackPriority=0;var Ae=ne.lanes|ne.childLanes;if(Mr(T,Ae),T===Rs&&(Xs=Rs=null,Ps=0),!(ne.subtreeFlags&2064)&&!(ne.flags&2064)||Nr||(Nr=!0,Km(nr,function(){return Nl(),null})),Ae=(ne.flags&15990)!==0,ne.subtreeFlags&15990||Ae){Ae=Hs.transition,Hs.transition=null;var _t=Hn;Hn=1;var Jt=xr;xr|=4,Qc.current=null,n0(T,ne),$v(T,ne),ut(T.containerInfo),T.current=ne,qv(ne),fm(),xr=Jt,Hn=_t,Hs.transition=Ae}else T.current=ne;if(Nr&&(Nr=!1,Qi=T,ap=me),Ae=T.pendingLanes,Ae===0&&(sl=null),pm(ne.stateNode),ia(T,bs()),A!==null)for(Z=T.onRecoverableError,ne=0;ne<A.length;ne++)Z(A[ne]);if(Ho)throw Ho=!1,T=$m,$m=null,T;return ap&1&&T.tag!==0&&Nl(),Ae=T.pendingLanes,Ae&1?T===Xd?ol++:(ol=0,Xd=T):ol=0,wo(),null}function Nl(){if(Qi!==null){var T=wd(ap),A=Hs.transition,Z=Hn;try{if(Hs.transition=null,Hn=16>T?16:T,Qi===null)var ne=!1;else{if(T=Qi,Qi=null,ap=0,xr&6)throw Error(c(331));var me=xr;for(xr|=4,ci=T.current;ci!==null;){var Ae=ci,_t=Ae.child;if(ci.flags&16){var Jt=Ae.deletions;if(Jt!==null){for(var Sn=0;Sn<Jt.length;Sn++){var Kn=Jt[Sn];for(ci=Kn;ci!==null;){var Ai=ci;switch(Ai.tag){case 0:case 11:case 15:Ah(8,Ai,Ae)}var pr=Ai.child;if(pr!==null)pr.return=Ai,ci=pr;else for(;ci!==null;){Ai=ci;var Gi=Ai.sibling,vs=Ai.return;if(i0(Ai),Ai===Kn){ci=null;break}if(Gi!==null){Gi.return=vs,ci=Gi;break}ci=vs}}}var Fi=Ae.alternate;if(Fi!==null){var io=Fi.child;if(io!==null){Fi.child=null;do{var po=io.sibling;io.sibling=null,io=po}while(io!==null)}}ci=Ae}}if(Ae.subtreeFlags&2064&&_t!==null)_t.return=Ae,ci=_t;else e:for(;ci!==null;){if(Ae=ci,Ae.flags&2048)switch(Ae.tag){case 0:case 11:case 15:Ah(9,Ae,Ae.return)}var cn=Ae.sibling;if(cn!==null){cn.return=Ae.return,ci=cn;break e}ci=Ae.return}}var Qt=T.current;for(ci=Qt;ci!==null;){_t=ci;var gn=_t.child;if(_t.subtreeFlags&2064&&gn!==null)gn.return=_t,ci=gn;else e:for(_t=Qt;ci!==null;){if(Jt=ci,Jt.flags&2048)try{switch(Jt.tag){case 0:case 11:case 15:_c(9,Jt)}}catch(Bi){ra(Jt,Jt.return,Bi)}if(Jt===_t){ci=null;break e}var ai=Jt.sibling;if(ai!==null){ai.return=Jt.return,ci=ai;break e}ci=Jt.return}}if(xr=me,wo(),$i&&typeof $i.onPostCommitFiberRoot=="function")try{$i.onPostCommitFiberRoot(xo,T)}catch{}ne=!0}return ne}finally{Hn=Z,Hs.transition=A}}return!1}function Jd(T,A,Z){A=Pu(Z,A),A=zv(T,A,1),eo(T,A),A=Eo(),T=al(T,1),T!==null&&(uh(T,1,A),ia(T,A))}function ra(T,A,Z){if(T.tag===3)Jd(T,T,Z);else for(;A!==null;){if(A.tag===3){Jd(A,T,Z);break}else if(A.tag===1){var ne=A.stateNode;if(typeof A.type.getDerivedStateFromError=="function"||typeof ne.componentDidCatch=="function"&&(sl===null||!sl.has(ne))){T=Pu(Z,T),T=Sh(A,T,1),eo(A,T),T=Eo(),A=al(A,1),A!==null&&(uh(A,1,T),ia(A,T));break}}A=A.return}}function Zm(T,A,Z){var ne=T.pingCache;ne!==null&&ne.delete(A),A=Eo(),T.pingedLanes|=T.suspendedLanes&Z,Rs===T&&(Ps&Z)===Z&&(fo===4||fo===3&&(Ps&130023424)===Ps&&500>bs()-Zd?ll(T,0):qd|=Z),ia(T,A)}function dp(T,A){A===0&&(T.mode&1?(A=Ml,Ml<<=1,!(Ml&130023424)&&(Ml=4194304)):A=1);var Z=Eo();T=al(T,A),T!==null&&(uh(T,A,Z),ia(T,Z))}function r0(T){var A=T.memoizedState,Z=0;A!==null&&(Z=A.retryLane),dp(T,Z)}function Xm(T,A){var Z=0;switch(T.tag){case 13:var ne=T.stateNode,me=T.memoizedState;me!==null&&(Z=me.retryLane);break;case 19:ne=T.stateNode;break;default:throw Error(c(314))}ne!==null&&ne.delete(A),dp(T,Z)}var Qd;Qd=function(T,A,Z){if(T!==null)if(T.memoizedProps!==A.pendingProps||fs.current)So=!0;else{if(!(T.lanes&Z)&&!(A.flags&128))return So=!1,Th(T,A,Z);So=!!(T.flags&131072)}else So=!1,As&&A.flags&1048576&&Nf(A,ii,A.index);switch(A.lanes=0,A.tag){case 2:var ne=A.type;T!==null&&(T.alternate=null,A.alternate=null,A.flags|=2),T=A.pendingProps;var me=Ss(A,fi.current);Al(A,Z),me=Rd(null,A,ne,T,me,Z);var Ae=_h();return A.flags|=1,typeof me=="object"&&me!==null&&typeof me.render=="function"&&me.$$typeof===void 0?(A.tag=1,A.memoizedState=null,A.updateQueue=null,is(ne)?(Ae=!0,Jo(A)):Ae=!1,A.memoizedState=me.state!==null&&me.state!==void 0?me.state:null,Il(A),me.updater=Eu,A.stateNode=me,me._reactInternals=A,ym(A,ne,T,Z),A=Hv(null,A,ne,!0,Ae,Z)):(A.tag=0,As&&Ae&&Bf(A),fa(null,A,me,Z),A=A.child),A;case 16:ne=A.elementType;e:{switch(T!==null&&(T.alternate=null,A.alternate=null,A.flags|=2),T=A.pendingProps,me=ne._init,ne=me(ne._payload),A.type=ne,me=A.tag=Jm(ne),T=Os(ne,T),me){case 0:A=bh(null,A,ne,T,Z);break e;case 1:A=e0(null,A,ne,T,Z);break e;case 11:A=Om(null,A,ne,T,Z);break e;case 14:A=km(null,A,ne,Os(ne.type,T),Z);break e}throw Error(c(306,ne,""))}return A;case 0:return ne=A.type,me=A.pendingProps,me=A.elementType===ne?me:Os(ne,me),bh(T,A,ne,me,Z);case 1:return ne=A.type,me=A.pendingProps,me=A.elementType===ne?me:Os(ne,me),e0(T,A,ne,me,Z);case 3:e:{if(zm(A),T===null)throw Error(c(387));ne=A.pendingProps,Ae=A.memoizedState,me=Ae.element,Z_(T,A),kf(A,ne,null,Z);var _t=A.memoizedState;if(ne=_t.element,Dt&&Ae.isDehydrated)if(Ae={element:ne,isDehydrated:!1,cache:_t.cache,transitions:_t.transitions},A.updateQueue.baseState=Ae,A.memoizedState=Ae,A.flags&256){me=Error(c(423)),A=t0(T,A,ne,Z,me);break e}else if(ne!==me){me=Error(c(424)),A=t0(T,A,ne,Z,me);break e}else for(Dt&&(ps=Yt(A.stateNode.containerInfo),Co=A,As=!0,ha=null,dc=!1),Z=Vf(A,null,ne,Z),A.child=Z;Z;)Z.flags=Z.flags&-3|4096,Z=Z.sibling;else{if(Dl(),ne===me){A=vc(T,A,Z);break e}fa(T,A,ne,Z)}A=A.child}return A;case 5:return Hf(A),T===null&&Uf(A),ne=A.type,me=A.pendingProps,Ae=T!==null?T.memoizedProps:null,_t=me.children,Ge(ne,me)?_t=null:Ae!==null&&Ge(ne,Ae)&&(A.flags|=32),Bm(T,A),fa(T,A,_t,Z),A.child;case 6:return T===null&&Uf(A),null;case 13:return Mh(T,A,Z);case 4:return Gf(A,A.stateNode.containerInfo),ne=A.pendingProps,T===null?A.child=Uo(A,null,ne,Z):fa(T,A,ne,Z),A.child;case 11:return ne=A.type,me=A.pendingProps,me=A.elementType===ne?me:Os(ne,me),Om(T,A,ne,me,Z);case 7:return fa(T,A,A.pendingProps,Z),A.child;case 8:return fa(T,A,A.pendingProps.children,Z),A.child;case 12:return fa(T,A,A.pendingProps.children,Z),A.child;case 10:e:{if(ne=A.type._context,me=A.pendingProps,Ae=A.memoizedProps,_t=me.value,Qs(A,ne,_t),Ae!==null)if(ya(Ae.value,_t)){if(Ae.children===me.children&&!fs.current){A=vc(T,A,Z);break e}}else for(Ae=A.child,Ae!==null&&(Ae.return=A);Ae!==null;){var Jt=Ae.dependencies;if(Jt!==null){_t=Ae.child;for(var Sn=Jt.firstContext;Sn!==null;){if(Sn.context===ne){if(Ae.tag===1){Sn=uc(-1,Z&-Z),Sn.tag=2;var Kn=Ae.updateQueue;if(Kn!==null){Kn=Kn.shared;var Ai=Kn.pending;Ai===null?Sn.next=Sn:(Sn.next=Ai.next,Ai.next=Sn),Kn.pending=Sn}}Ae.lanes|=Z,Sn=Ae.alternate,Sn!==null&&(Sn.lanes|=Z),$a(Ae.return,Z,A),Jt.lanes|=Z;break}Sn=Sn.next}}else if(Ae.tag===10)_t=Ae.type===A.type?null:Ae.child;else if(Ae.tag===18){if(_t=Ae.return,_t===null)throw Error(c(341));_t.lanes|=Z,Jt=_t.alternate,Jt!==null&&(Jt.lanes|=Z),$a(_t,Z,A),_t=Ae.sibling}else _t=Ae.child;if(_t!==null)_t.return=Ae;else for(_t=Ae;_t!==null;){if(_t===A){_t=null;break}if(Ae=_t.sibling,Ae!==null){Ae.return=_t.return,_t=Ae;break}_t=_t.return}Ae=_t}fa(T,A,me.children,Z),A=A.child}return A;case 9:return me=A.type,ne=A.pendingProps.children,Al(A,Z),me=Bo(me),ne=ne(me),A.flags|=1,fa(T,A,ne,Z),A.child;case 14:return ne=A.type,me=Os(ne,A.pendingProps),me=Os(ne.type,me),km(T,A,ne,me,Z);case 15:return Nm(T,A,A.type,A.pendingProps,Z);case 17:return ne=A.type,me=A.pendingProps,me=A.elementType===ne?me:Os(ne,me),T!==null&&(T.alternate=null,A.alternate=null,A.flags|=2),A.tag=1,is(ne)?(T=!0,Jo(A)):T=!1,Al(A,Z),X_(A,ne,me),ym(A,ne,me,Z),Hv(null,A,ne,!0,T,Z);case 19:return Um(T,A,Z);case 22:return Gv(T,A,Z)}throw Error(c(156,A.tag))};function Km(T,A){return $c(T,A)}function s0(T,A,Z,ne){this.tag=T,this.key=Z,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=A,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ne,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Na(T,A,Z,ne){return new s0(T,A,Z,ne)}function Ym(T){return T=T.prototype,!(!T||!T.isReactComponent)}function Jm(T){if(typeof T=="function")return Ym(T)?1:0;if(T!=null){if(T=T.$$typeof,T===z)return 11;if(T===H)return 14}return 2}function nu(T,A){var Z=T.alternate;return Z===null?(Z=Na(T.tag,A,T.key,T.mode),Z.elementType=T.elementType,Z.type=T.type,Z.stateNode=T.stateNode,Z.alternate=T,T.alternate=Z):(Z.pendingProps=A,Z.type=T.type,Z.flags=0,Z.subtreeFlags=0,Z.deletions=null),Z.flags=T.flags&14680064,Z.childLanes=T.childLanes,Z.lanes=T.lanes,Z.child=T.child,Z.memoizedProps=T.memoizedProps,Z.memoizedState=T.memoizedState,Z.updateQueue=T.updateQueue,A=T.dependencies,Z.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext},Z.sibling=T.sibling,Z.index=T.index,Z.ref=T.ref,Z}function fp(T,A,Z,ne,me,Ae){var _t=2;if(ne=T,typeof T=="function")Ym(T)&&(_t=1);else if(typeof T=="string")_t=5;else e:switch(T){case w:return Nu(Z.children,me,Ae,A);case C:_t=8,me|=8;break;case M:return T=Na(12,Z,A,me|2),T.elementType=M,T.lanes=Ae,T;case L:return T=Na(13,Z,A,me),T.elementType=L,T.lanes=Ae,T;case P:return T=Na(19,Z,A,me),T.elementType=P,T.lanes=Ae,T;case q:return pp(Z,me,Ae,A);default:if(typeof T=="object"&&T!==null)switch(T.$$typeof){case F:_t=10;break e;case N:_t=9;break e;case z:_t=11;break e;case H:_t=14;break e;case j:_t=16,ne=null;break e}throw Error(c(130,T==null?T:typeof T,""))}return A=Na(_t,Z,A,me),A.elementType=T,A.type=ne,A.lanes=Ae,A}function Nu(T,A,Z,ne){return T=Na(7,T,ne,A),T.lanes=Z,T}function pp(T,A,Z,ne){return T=Na(22,T,ne,A),T.elementType=q,T.lanes=Z,T.stateNode={},T}function mp(T,A,Z){return T=Na(6,T,null,A),T.lanes=Z,T}function Qv(T,A,Z){return A=Na(4,T.children!==null?T.children:[],T.key,A),A.lanes=Z,A.stateNode={containerInfo:T.containerInfo,pendingChildren:null,implementation:T.implementation},A}function Vw(T,A,Z,ne,me){this.tag=A,this.containerInfo=T,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=rn,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cr(0),this.expirationTimes=cr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cr(0),this.identifierPrefix=ne,this.onRecoverableError=me,Dt&&(this.mutableSourceEagerHydrationData=null)}function Is(T,A,Z,ne,me,Ae,_t,Jt,Sn){return T=new Vw(T,A,Z,Jt,Sn),A===1?(A=1,Ae===!0&&(A|=8)):A=0,Ae=Na(3,null,null,A),T.current=Ae,Ae.stateNode=T,Ae.memoizedState={element:ne,isDehydrated:Z,cache:null,transitions:null},Il(Ae),T}function ey(T){if(!T)return wr;T=T._reactInternals;e:{if(fe(T)!==T||T.tag!==1)throw Error(c(170));var A=T;do{switch(A.tag){case 3:A=A.stateNode.context;break e;case 1:if(is(A.type)){A=A.stateNode.__reactInternalMemoizedMergedChildContext;break e}}A=A.return}while(A!==null);throw Error(c(171))}if(T.tag===1){var Z=T.type;if(is(Z))return Qr(T,Z,A)}return A}function o0(T){var A=T._reactInternals;if(A===void 0)throw typeof T.render=="function"?Error(c(188)):(T=Object.keys(T).join(","),Error(c(268,T)));return T=We(A),T===null?null:T.stateNode}function a0(T,A){if(T=T.memoizedState,T!==null&&T.dehydrated!==null){var Z=T.retryLane;T.retryLane=Z!==0&&Z<A?Z:A}}function Fh(T,A){a0(T,A),(T=T.alternate)&&a0(T,A)}function l0(T){return T=We(T),T===null?null:T.stateNode}function ef(){return null}return n.attemptContinuousHydration=function(T){if(T.tag===13){var A=Eo();Mo(T,134217728,A),Fh(T,134217728)}},n.attemptHydrationAtCurrentPriority=function(T){if(T.tag===13){var A=Eo(),Z=pa(T);Mo(T,Z,A),Fh(T,Z)}},n.attemptSynchronousHydration=function(T){switch(T.tag){case 3:var A=T.stateNode;if(A.current.memoizedState.isDehydrated){var Z=Wc(A.pendingLanes);Z!==0&&(Av(A,Z|1),ia(A,bs()),!(xr&6)&&(_a(),wo()))}break;case 13:var ne=Eo();cp(function(){return Mo(T,1,ne)}),Fh(T,1)}},n.batchedUpdates=function(T,A){var Z=xr;xr|=1;try{return T(A)}finally{xr=Z,xr===0&&(_a(),Es&&wo())}},n.createComponentSelector=function(T){return{$$typeof:Hd,value:T}},n.createContainer=function(T,A,Z,ne,me,Ae,_t){return Is(T,A,!1,null,Z,ne,me,Ae,_t)},n.createHasPseudoClassSelector=function(T){return{$$typeof:rp,value:T}},n.createHydrationContainer=function(T,A,Z,ne,me,Ae,_t,Jt,Sn){return T=Is(Z,ne,!0,T,me,Ae,_t,Jt,Sn),T.context=ey(null),Z=T.current,ne=Eo(),me=pa(Z),Ae=uc(ne,me),Ae.callback=A??null,eo(Z,Ae),T.current.lanes=me,uh(T,me,ne),ia(T,ne),T},n.createPortal=function(T,A,Z){var ne=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:v,key:ne==null?null:""+ne,children:T,containerInfo:A,implementation:Z}},n.createRoleSelector=function(T){return{$$typeof:sp,value:T}},n.createTestNameSelector=function(T){return{$$typeof:op,value:T}},n.createTextSelector=function(T){return{$$typeof:Wm,value:T}},n.deferredUpdates=function(T){var A=Hn,Z=Hs.transition;try{return Hs.transition=null,Hn=16,T()}finally{Hn=A,Hs.transition=Z}},n.discreteUpdates=function(T,A,Z,ne,me){var Ae=Hn,_t=Hs.transition;try{return Hs.transition=null,Hn=1,T(A,Z,ne,me)}finally{Hn=Ae,Hs.transition=_t,xr===0&&_a()}},n.findAllNodes=Ur,n.findBoundingRects=function(T,A){if(!it)throw Error(c(363));A=Ur(T,A),T=[];for(var Z=0;Z<A.length;Z++)T.push(Pe(A[Z]));for(A=T.length-1;0<A;A--){Z=T[A];for(var ne=Z.x,me=ne+Z.width,Ae=Z.y,_t=Ae+Z.height,Jt=A-1;0<=Jt;Jt--)if(A!==Jt){var Sn=T[Jt],Kn=Sn.x,Ai=Kn+Sn.width,pr=Sn.y,Gi=pr+Sn.height;if(ne>=Kn&&Ae>=pr&&me<=Ai&&_t<=Gi){T.splice(A,1);break}else if(ne!==Kn||Z.width!==Sn.width||Gi<Ae||pr>_t){if(!(Ae!==pr||Z.height!==Sn.height||Ai<ne||Kn>me)){Kn>ne&&(Sn.width+=Kn-ne,Sn.x=ne),Ai<me&&(Sn.width=me-Kn),T.splice(A,1);break}}else{pr>Ae&&(Sn.height+=pr-Ae,Sn.y=Ae),Gi<_t&&(Sn.height=_t-pr),T.splice(A,1);break}}}return T},n.findHostInstance=o0,n.findHostInstanceWithNoPortals=function(T){return T=Ee(T),T=T!==null?tt(T):null,T===null?null:T.stateNode},n.findHostInstanceWithWarning=function(T){return o0(T)},n.flushControlled=function(T){var A=xr;xr|=1;var Z=Hs.transition,ne=Hn;try{Hs.transition=null,Hn=1,T()}finally{Hn=ne,Hs.transition=Z,xr=A,xr===0&&(_a(),wo())}},n.flushPassiveEffects=Nl,n.flushSync=cp,n.focusWithin=function(T,A){if(!it)throw Error(c(363));for(T=Du(T),A=Ph(T,A),A=Array.from(A),T=0;T<A.length;){var Z=A[T++];if(!yt(Z)){if(Z.tag===5&&jt(Z.stateNode))return!0;for(Z=Z.child;Z!==null;)A.push(Z),Z=Z.sibling}}return!1},n.getCurrentUpdatePriority=function(){return Hn},n.getFindAllNodesFailureDescription=function(T,A){if(!it)throw Error(c(363));var Z=0,ne=[];T=[Du(T),0];for(var me=0;me<T.length;){var Ae=T[me++],_t=T[me++],Jt=A[_t];if((Ae.tag!==5||!yt(Ae))&&(yn(Ae,Jt)&&(ne.push(ni(Jt)),_t++,_t>Z&&(Z=_t)),_t<A.length))for(Ae=Ae.child;Ae!==null;)T.push(Ae,_t),Ae=Ae.sibling}if(Z<A.length){for(T=[];Z<A.length;Z++)T.push(ni(A[Z]));return`findAllNodes was able to match part of the selector:
  `+(ne.join(" > ")+`

No matching component was found for:
  `)+T.join(" > ")}return null},n.getPublicRootInstance=function(T){if(T=T.current,!T.child)return null;switch(T.child.tag){case 5:return qe(T.child.stateNode);default:return T.child.stateNode}},n.injectIntoDevTools=function(T){if(T={bundleType:T.bundleType,version:T.version,rendererPackageName:T.rendererPackageName,rendererConfig:T.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:l0,findFiberByHostInstance:T.findFiberByHostInstance||ef,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")T=!1;else{var A=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(A.isDisabled||!A.supportsFiber)T=!0;else{try{xo=A.inject(T),$i=A}catch{}T=!!A.checkDCE}}return T},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(T,A,Z,ne){if(!it)throw Error(c(363));T=Ur(T,A);var me=Fn(T,Z,ne).disconnect;return{disconnect:function(){me()}}},n.registerMutableSourceForHydration=function(T,A){var Z=A._getVersion;Z=Z(A._source),T.mutableSourceEagerHydrationData==null?T.mutableSourceEagerHydrationData=[A,Z]:T.mutableSourceEagerHydrationData.push(A,Z)},n.runWithPriority=function(T,A){var Z=Hn;try{return Hn=T,A()}finally{Hn=Z}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(T,A,Z,ne){var me=A.current,Ae=Eo(),_t=pa(me);return Z=ey(Z),A.context===null?A.context=Z:A.pendingContext=Z,A=uc(Ae,_t),A.payload={element:T},ne=ne===void 0?null:ne,ne!==null&&(A.callback=ne),eo(me,A),T=Mo(me,_t,Ae),T!==null&&vm(T,me,_t),_t},n};AJ.exports=sFe;var oFe=AJ.exports;const aFe=pv(oFe),hz={},dz=t=>void Object.assign(hz,t);function lFe(t,e){function n(w,{args:C=[],attach:M,...F},N){let z=`${w[0].toUpperCase()}${w.slice(1)}`,L;if(w==="primitive"){if(F.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const P=F.object;L=J0(P,{type:w,root:N,attach:M,primitive:!0})}else{const P=hz[z];if(!P)throw new Error(`R3F: ${z} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(C))throw new Error("R3F: The args prop must be an array!");L=J0(new P(...C),{type:w,root:N,attach:M,memoizedProps:{args:C}})}return L.__r3f.attach===void 0&&(L instanceof Cr?L.__r3f.attach="geometry":L instanceof nl&&(L.__r3f.attach="material")),z!=="inject"&&H2(L,F),L}function i(w,C){let M=!1;if(C){var F,N;(F=C.__r3f)!=null&&F.attach?G2(w,C,C.__r3f.attach):C.isObject3D&&w.isObject3D&&(w.add(C),M=!0),M||(N=w.__r3f)==null||N.objects.push(C),C.__r3f||J0(C,{}),C.__r3f.parent=w,eN(C),Q0(C)}}function r(w,C,M){let F=!1;if(C){var N,z;if((N=C.__r3f)!=null&&N.attach)G2(w,C,C.__r3f.attach);else if(C.isObject3D&&w.isObject3D){C.parent=w,C.dispatchEvent({type:"added"}),w.dispatchEvent({type:"childadded",child:C});const L=w.children.filter(H=>H!==C),P=L.indexOf(M);w.children=[...L.slice(0,P),C,...L.slice(P)],F=!0}F||(z=w.__r3f)==null||z.objects.push(C),C.__r3f||J0(C,{}),C.__r3f.parent=w,eN(C),Q0(C)}}function o(w,C,M=!1){w&&[...w].forEach(F=>c(C,F,M))}function c(w,C,M){if(C){var F,N,z;if(C.__r3f&&(C.__r3f.parent=null),(F=w.__r3f)!=null&&F.objects&&(w.__r3f.objects=w.__r3f.objects.filter(q=>q!==C)),(N=C.__r3f)!=null&&N.attach)VW(w,C,C.__r3f.attach);else if(C.isObject3D&&w.isObject3D){var L;w.remove(C),(L=C.__r3f)!=null&&L.root&&mFe(gR(C),C)}const H=(z=C.__r3f)==null?void 0:z.primitive,j=!H&&(M===void 0?C.dispose!==null:M);if(!H){var P;o((P=C.__r3f)==null?void 0:P.objects,C,j),o(C.children,C,j)}if(delete C.__r3f,j&&C.dispose&&C.type!=="Scene"){const q=()=>{try{C.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Jk.unstable_scheduleCallback(Jk.unstable_IdlePriority,q):q()}Q0(w)}}function s(w,C,M,F){var N;const z=(N=w.__r3f)==null?void 0:N.parent;if(!z)return;const L=n(C,M,w.__r3f.root);if(w.children){for(const P of w.children)P.__r3f&&i(L,P);w.children=w.children.filter(P=>!P.__r3f)}w.__r3f.objects.forEach(P=>i(L,P)),w.__r3f.objects=[],w.__r3f.autoRemovedBeforeAppend||c(z,w),L.parent&&(L.__r3f.autoRemovedBeforeAppend=!0),i(z,L),L.raycast&&L.__r3f.eventCount&&gR(L).getState().internal.interaction.push(L),[F,F.alternate].forEach(P=>{P!==null&&(P.stateNode=L,P.ref&&(typeof P.ref=="function"?P.ref(L):P.ref.current=L))})}const f=()=>{};return{reconciler:aFe({createInstance:n,removeChild:c,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(w,C)=>{if(!C)return;const M=w.getState().scene;M.__r3f&&(M.__r3f.root=w,i(M,C))},removeChildFromContainer:(w,C)=>{C&&c(w.getState().scene,C)},insertInContainerBefore:(w,C,M)=>{if(!C||!M)return;const F=w.getState().scene;F.__r3f&&r(F,C,M)},getRootHostContext:()=>null,getChildHostContext:w=>w,finalizeInitialChildren(w){var C;return!!((C=w==null?void 0:w.__r3f)!=null?C:{}).handlers},prepareUpdate(w,C,M,F){var N;if(((N=w==null?void 0:w.__r3f)!=null?N:{}).primitive&&F.object&&F.object!==w)return[!0];{const{args:L=[],children:P,...H}=F,{args:j=[],children:q,...le}=M;if(!Array.isArray(L))throw new Error("R3F: the args prop must be an array!");if(L.some((ae,pe)=>ae!==j[pe]))return[!0];const ce=BJ(w,H,le,!0);return ce.changes.length?[!1,ce]:null}},commitUpdate(w,[C,M],F,N,z,L){C?s(w,F,z,L):H2(w,M)},commitMount(w,C,M,F){var N;const z=(N=w.__r3f)!=null?N:{};w.raycast&&z.handlers&&z.eventCount&&gR(w).getState().internal.interaction.push(w)},getPublicInstance:w=>w,prepareForCommit:()=>null,preparePortalMount:w=>J0(w.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(w){var C;const{attach:M,parent:F}=(C=w.__r3f)!=null?C:{};M&&F&&VW(F,w,M),w.isObject3D&&(w.visible=!1),Q0(w)},unhideInstance(w,C){var M;const{attach:F,parent:N}=(M=w.__r3f)!=null?M:{};F&&N&&G2(N,w,F),(w.isObject3D&&C.visible==null||C.visible)&&(w.visible=!0),Q0(w)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>e?e():xx.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&lo.fun(performance.now)?performance.now:lo.fun(Date.now)?Date.now:()=>0,scheduleTimeout:lo.fun(setTimeout)?setTimeout:void 0,cancelTimeout:lo.fun(clearTimeout)?clearTimeout:void 0}),applyProps:H2}}var NW,BW;const V2=t=>"colorSpace"in t||"outputColorSpace"in t,DJ=()=>{var t;return(t=hz.ColorManagement)!=null?t:null},FJ=t=>t&&t.isOrthographicCamera,cFe=t=>t&&t.hasOwnProperty("current"),_b=typeof window<"u"&&((NW=window.document)!=null&&NW.createElement||((BW=window.navigator)==null?void 0:BW.product)==="ReactNative")?Q.useLayoutEffect:Q.useEffect;function LJ(t){const e=Q.useRef(t);return _b(()=>void(e.current=t),[t]),e}function uFe({set:t}){return _b(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class OJ extends Q.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}OJ.getDerivedStateFromError=()=>({error:!0});const kJ="__default",zW=new Map,hFe=t=>t&&!!t.memoized&&!!t.changes;function NJ(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const JC=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()};function gR(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const lo={obj:t=>t===Object(t)&&!lo.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:i="reference",strict:r=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(lo.str(t)||lo.num(t)||lo.boo(t))return t===e;const o=lo.obj(t);if(o&&i==="reference")return t===e;const c=lo.arr(t);if(c&&n==="reference")return t===e;if((c||o)&&t===e)return!0;let s;for(s in t)if(!(s in e))return!1;if(o&&n==="shallow"&&i==="shallow"){for(s in r?e:t)if(!lo.equ(t[s],e[s],{strict:r,objects:"reference"}))return!1}else for(s in r?e:t)if(t[s]!==e[s])return!1;if(lo.und(s)){if(c&&t.length===0&&e.length===0||o&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function dFe(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function J0(t,e){const n=t;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function Qk(t,e){let n=t;if(e.includes("-")){const i=e.split("-"),r=i.pop();return n=i.reduce((o,c)=>o[c],t),{target:n,key:r}}else return{target:n,key:e}}const UW=/-\d+$/;function G2(t,e,n){if(lo.str(n)){if(UW.test(n)){const o=n.replace(UW,""),{target:c,key:s}=Qk(t,o);Array.isArray(c[s])||(c[s]=[])}const{target:i,key:r}=Qk(t,n);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=n(t,e)}function VW(t,e,n){var i,r;if(lo.str(n)){const{target:o,key:c}=Qk(t,n),s=e.__r3f.previousAttach;s===void 0?delete o[c]:o[c]=s}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(t,e);(r=e.__r3f)==null||delete r.previousAttach}function BJ(t,{children:e,key:n,ref:i,...r},{children:o,key:c,ref:s,...f}={},v=!1){const w=t.__r3f,C=Object.entries(r),M=[];if(v){const N=Object.keys(f);for(let z=0;z<N.length;z++)r.hasOwnProperty(N[z])||C.unshift([N[z],kJ+"remove"])}C.forEach(([N,z])=>{var L;if((L=t.__r3f)!=null&&L.primitive&&N==="object"||lo.equ(z,f[N]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(N))return M.push([N,z,!0,[]]);let P=[];N.includes("-")&&(P=N.split("-")),M.push([N,z,!1,P]);for(const H in r){const j=r[H];H.startsWith(`${N}-`)&&M.push([H,j,!1,H.split("-")])}});const F={...r};return w!=null&&w.memoizedProps&&w!=null&&w.memoizedProps.args&&(F.args=w.memoizedProps.args),w!=null&&w.memoizedProps&&w!=null&&w.memoizedProps.attach&&(F.attach=w.memoizedProps.attach),{memoized:F,changes:M}}const fFe=typeof process<"u"&&!1;function H2(t,e){var n;const i=t.__r3f,r=i==null?void 0:i.root,o=r==null||r.getState==null?void 0:r.getState(),{memoized:c,changes:s}=hFe(e)?e:BJ(t,e),f=i==null?void 0:i.eventCount;t.__r3f&&(t.__r3f.memoizedProps=c);for(let w=0;w<s.length;w++){let[C,M,F,N]=s[w];if(V2(t)){const H="srgb",j="srgb-linear";C==="encoding"?(C="colorSpace",M=M===3001?H:j):C==="outputEncoding"&&(C="outputColorSpace",M=M===3001?H:j)}let z=t,L=z[C];if(N.length&&(L=N.reduce((P,H)=>P[H],t),!(L&&L.set))){const[P,...H]=N.reverse();z=H.reverse().reduce((j,q)=>j[q],t),C=P}if(M===kJ+"remove")if(z.constructor){let P=zW.get(z.constructor);P||(P=new z.constructor,zW.set(z.constructor,P)),M=P[C]}else M=0;if(F&&i)M?i.handlers[C]=M:delete i.handlers[C],i.eventCount=Object.keys(i.handlers).length;else if(L&&L.set&&(L.copy||L instanceof u_)){if(Array.isArray(M))L.fromArray?L.fromArray(M):L.set(...M);else if(L.copy&&M&&M.constructor&&(fFe?L.constructor.name===M.constructor.name:L.constructor===M.constructor))L.copy(M);else if(M!==void 0){const P=L instanceof bi;!P&&L.setScalar?L.setScalar(M):L instanceof u_&&M instanceof u_?L.mask=M.mask:L.set(M),!DJ()&&o&&!o.linear&&P&&L.convertSRGBToLinear()}}else if(z[C]=M,z[C]instanceof Oo&&z[C].format===wl&&z[C].type===dd&&o){const P=z[C];V2(P)&&V2(o.gl)?P.colorSpace=o.gl.outputColorSpace:P.encoding=o.gl.outputEncoding}Q0(t)}if(i&&i.parent&&t.raycast&&f!==i.eventCount){const w=gR(t).getState().internal,C=w.interaction.indexOf(t);C>-1&&w.interaction.splice(C,1),i.eventCount&&w.interaction.push(t)}return!(s.length===1&&s[0][0]==="onUpdate")&&s.length&&(n=t.__r3f)!=null&&n.parent&&eN(t),t}function Q0(t){var e,n;const i=(e=t.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function eN(t){t.onUpdate==null||t.onUpdate(t)}function zJ(t,e){t.manual||(FJ(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function zM(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function pFe(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return xx.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return xx.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return xx.ContinuousEventPriority;default:return xx.DefaultEventPriority}}function UJ(t,e,n,i){const r=n.get(e);r&&(n.delete(e),n.size===0&&(t.delete(i),r.target.releasePointerCapture(i)))}function mFe(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(i=>i!==e),n.initialHits=n.initialHits.filter(i=>i!==e),n.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&n.hovered.delete(r)}),n.capturedMap.forEach((i,r)=>{UJ(n.capturedMap,e,i,r)})}function gFe(t){function e(f){const{internal:v}=t.getState(),w=f.offsetX-v.initialClick[0],C=f.offsetY-v.initialClick[1];return Math.round(Math.sqrt(w*w+C*C))}function n(f){return f.filter(v=>["Move","Over","Enter","Out","Leave"].some(w=>{var C;return(C=v.__r3f)==null?void 0:C.handlers["onPointer"+w]}))}function i(f,v){const w=t.getState(),C=new Set,M=[],F=v?v(w.internal.interaction):w.internal.interaction;for(let P=0;P<F.length;P++){const H=JC(F[P]);H&&(H.raycaster.camera=void 0)}w.previousRoot||w.events.compute==null||w.events.compute(f,w);function N(P){const H=JC(P);if(!H||!H.events.enabled||H.raycaster.camera===null)return[];if(H.raycaster.camera===void 0){var j;H.events.compute==null||H.events.compute(f,H,(j=H.previousRoot)==null?void 0:j.getState()),H.raycaster.camera===void 0&&(H.raycaster.camera=null)}return H.raycaster.camera?H.raycaster.intersectObject(P,!0):[]}let z=F.flatMap(N).sort((P,H)=>{const j=JC(P.object),q=JC(H.object);return!j||!q?P.distance-H.distance:q.events.priority-j.events.priority||P.distance-H.distance}).filter(P=>{const H=zM(P);return C.has(H)?!1:(C.add(H),!0)});w.events.filter&&(z=w.events.filter(z,w));for(const P of z){let H=P.object;for(;H;){var L;(L=H.__r3f)!=null&&L.eventCount&&M.push({...P,eventObject:H}),H=H.parent}}if("pointerId"in f&&w.internal.capturedMap.has(f.pointerId))for(let P of w.internal.capturedMap.get(f.pointerId).values())C.has(zM(P.intersection))||M.push(P.intersection);return M}function r(f,v,w,C){const M=t.getState();if(f.length){const F={stopped:!1};for(const N of f){const z=JC(N.object)||M,{raycaster:L,pointer:P,camera:H,internal:j}=z,q=new gt(P.x,P.y,0).unproject(H),le=ue=>{var Ee,We;return(Ee=(We=j.capturedMap.get(ue))==null?void 0:We.has(N.eventObject))!=null?Ee:!1},ce=ue=>{const Ee={intersection:N,target:v.target};j.capturedMap.has(ue)?j.capturedMap.get(ue).set(N.eventObject,Ee):j.capturedMap.set(ue,new Map([[N.eventObject,Ee]])),v.target.setPointerCapture(ue)},ae=ue=>{const Ee=j.capturedMap.get(ue);Ee&&UJ(j.capturedMap,N.eventObject,Ee,ue)};let pe={};for(let ue in v){let Ee=v[ue];typeof Ee!="function"&&(pe[ue]=Ee)}let fe={...N,...pe,pointer:P,intersections:f,stopped:F.stopped,delta:w,unprojectedPoint:q,ray:L.ray,camera:H,stopPropagation(){const ue="pointerId"in v&&j.capturedMap.get(v.pointerId);if((!ue||ue.has(N.eventObject))&&(fe.stopped=F.stopped=!0,j.hovered.size&&Array.from(j.hovered.values()).find(Ee=>Ee.eventObject===N.eventObject))){const Ee=f.slice(0,f.indexOf(N));o([...Ee,N])}},target:{hasPointerCapture:le,setPointerCapture:ce,releasePointerCapture:ae},currentTarget:{hasPointerCapture:le,setPointerCapture:ce,releasePointerCapture:ae},nativeEvent:v};if(C(fe),F.stopped===!0)break}}return f}function o(f){const{internal:v}=t.getState();for(const w of v.hovered.values())if(!f.length||!f.find(C=>C.object===w.object&&C.index===w.index&&C.instanceId===w.instanceId)){const M=w.eventObject.__r3f,F=M==null?void 0:M.handlers;if(v.hovered.delete(zM(w)),M!=null&&M.eventCount){const N={...w,intersections:f};F.onPointerOut==null||F.onPointerOut(N),F.onPointerLeave==null||F.onPointerLeave(N)}}}function c(f,v){for(let w=0;w<v.length;w++){const C=v[w].__r3f;C==null||C.handlers.onPointerMissed==null||C.handlers.onPointerMissed(f)}}function s(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return v=>{const{internal:w}=t.getState();"pointerId"in v&&w.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{w.capturedMap.has(v.pointerId)&&(w.capturedMap.delete(v.pointerId),o([]))})}}return function(w){const{onPointerMissed:C,internal:M}=t.getState();M.lastEvent.current=w;const F=f==="onPointerMove",N=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",L=i(w,F?n:void 0),P=N?e(w):0;f==="onPointerDown"&&(M.initialClick=[w.offsetX,w.offsetY],M.initialHits=L.map(j=>j.eventObject)),N&&!L.length&&P<=2&&(c(w,M.interaction),C&&C(w)),F&&o(L);function H(j){const q=j.eventObject,le=q.__r3f,ce=le==null?void 0:le.handlers;if(le!=null&&le.eventCount)if(F){if(ce.onPointerOver||ce.onPointerEnter||ce.onPointerOut||ce.onPointerLeave){const ae=zM(j),pe=M.hovered.get(ae);pe?pe.stopped&&j.stopPropagation():(M.hovered.set(ae,j),ce.onPointerOver==null||ce.onPointerOver(j),ce.onPointerEnter==null||ce.onPointerEnter(j))}ce.onPointerMove==null||ce.onPointerMove(j)}else{const ae=ce[f];ae?(!N||M.initialHits.includes(q))&&(c(w,M.interaction.filter(pe=>!M.initialHits.includes(pe))),ae(j)):N&&M.initialHits.includes(q)&&c(w,M.interaction.filter(pe=>!M.initialHits.includes(pe)))}}r(L,w,P,H)}}return{handlePointer:s}}const vFe=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],VJ=t=>!!(t!=null&&t.render),fz=Q.createContext(null),yFe=(t,e)=>{const n=TJ((s,f)=>{const v=new gt,w=new gt,C=new gt;function M(P=f().camera,H=w,j=f().size){const{width:q,height:le,top:ce,left:ae}=j,pe=q/le;H instanceof gt?C.copy(H):C.set(...H);const fe=P.getWorldPosition(v).distanceTo(C);if(FJ(P))return{width:q/P.zoom,height:le/P.zoom,top:ce,left:ae,factor:1,distance:fe,aspect:pe};{const ue=P.fov*Math.PI/180,Ee=2*Math.tan(ue/2)*fe,We=Ee*(q/le);return{width:We,height:Ee,top:ce,left:ae,factor:q/We,distance:fe,aspect:pe}}}let F;const N=P=>s(H=>({performance:{...H.performance,current:P}})),z=new Cn;return{set:s,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(P=1)=>t(f(),P),advance:(P,H)=>e(P,H,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new sz,pointer:z,mouse:z,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const P=f();F&&clearTimeout(F),P.performance.current!==P.performance.min&&N(P.performance.min),F=setTimeout(()=>N(f().performance.max),P.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:M},setEvents:P=>s(H=>({...H,events:{...H.events,...P}})),setSize:(P,H,j,q,le)=>{const ce=f().camera,ae={width:P,height:H,top:q||0,left:le||0,updateStyle:j};s(pe=>({size:ae,viewport:{...pe.viewport,...M(ce,w,ae)}}))},setDpr:P=>s(H=>{const j=NJ(P);return{viewport:{...H.viewport,dpr:j,initialDpr:H.viewport.initialDpr||j}}}),setFrameloop:(P="always")=>{const H=f().clock;H.stop(),H.elapsedTime=0,P!=="never"&&(H.start(),H.elapsedTime=0),s(()=>({frameloop:P}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Q.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(P,H,j)=>{const q=f().internal;return q.priority=q.priority+(H>0?1:0),q.subscribers.push({ref:P,priority:H,store:j}),q.subscribers=q.subscribers.sort((le,ce)=>le.priority-ce.priority),()=>{const le=f().internal;le!=null&&le.subscribers&&(le.priority=le.priority-(H>0?1:0),le.subscribers=le.subscribers.filter(ce=>ce.ref!==P))}}}}}),i=n.getState();let r=i.size,o=i.viewport.dpr,c=i.camera;return n.subscribe(()=>{const{camera:s,size:f,viewport:v,gl:w,set:C}=n.getState();if(f.width!==r.width||f.height!==r.height||v.dpr!==o){var M;r=f,o=v.dpr,zJ(s,f),w.setPixelRatio(v.dpr);const F=(M=f.updateStyle)!=null?M:typeof HTMLCanvasElement<"u"&&w.domElement instanceof HTMLCanvasElement;w.setSize(f.width,f.height,F)}s!==c&&(c=s,C(F=>({viewport:{...F.viewport,...F.viewport.getCurrentViewport(s)}})))}),n.subscribe(s=>t(s)),n};let UM,_Fe=new Set,xFe=new Set,wFe=new Set;function W2(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function QC(t,e){switch(t){case"before":return W2(_Fe,e);case"after":return W2(xFe,e);case"tail":return W2(wFe,e)}}let j2,$2;function q2(t,e,n){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(i=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),j2=e.internal.subscribers,UM=0;UM<j2.length;UM++)$2=j2[UM],$2.ref.current($2.store.getState(),i,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function CFe(t){let e=!1,n=!1,i,r,o;function c(v){r=requestAnimationFrame(c),e=!0,i=0,QC("before",v),n=!0;for(const C of t.values()){var w;o=C.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((w=o.gl.xr)!=null&&w.isPresenting)&&(i+=q2(v,o))}if(n=!1,QC("after",v),i===0)return QC("tail",v),e=!1,cancelAnimationFrame(r)}function s(v,w=1){var C;if(!v)return t.forEach(M=>s(M.store.getState(),w));(C=v.gl.xr)!=null&&C.isPresenting||!v.internal.active||v.frameloop==="never"||(w>1?v.internal.frames=Math.min(60,v.internal.frames+w):n?v.internal.frames=2:v.internal.frames=1,e||(e=!0,requestAnimationFrame(c)))}function f(v,w=!0,C,M){if(w&&QC("before",v),C)q2(v,C,M);else for(const F of t.values())q2(v,F.store.getState());w&&QC("after",v)}return{loop:c,invalidate:s,advance:f}}function pz(){const t=Q.useContext(fz);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Ic(t=n=>n,e){return pz()(t,e)}function _P(t,e=0){const n=pz(),i=n.getState().internal.subscribe,r=LJ(t);return _b(()=>i(r,e,n),[e,i,n]),null}const om=new Map,{invalidate:GW,advance:HW}=CFe(om),{reconciler:RS,applyProps:Z0}=lFe(om,pFe),X0={objects:"shallow",strict:!1},SFe=(t,e)=>{const n=typeof t=="function"?t(e):t;return VJ(n)?n:new DY({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function bFe(t,e){const n=typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement;if(e){const{width:i,height:r,top:o,left:c,updateStyle:s=n}=e;return{width:i,height:r,top:o,left:c,updateStyle:s}}else if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:i,height:r,top:o,left:c}=t.parentElement.getBoundingClientRect();return{width:i,height:r,top:o,left:c,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function GJ(t){const e=om.get(t),n=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,o=i||yFe(GW,HW),c=n||RS.createContainer(o,xx.ConcurrentRoot,null,!1,null,"",r,null);e||om.set(t,{fiber:c,store:o});let s,f=!1,v;return{configure(w={}){let{gl:C,size:M,scene:F,events:N,onCreated:z,shadows:L=!1,linear:P=!1,flat:H=!1,legacy:j=!1,orthographic:q=!1,frameloop:le="always",dpr:ce=[1,2],performance:ae,raycaster:pe,camera:fe,onPointerMissed:ue}=w,Ee=o.getState(),We=Ee.gl;Ee.gl||Ee.set({gl:We=SFe(C,t)});let rt=Ee.raycaster;rt||Ee.set({raycaster:rt=new cz});const{params:tt,...Ye}=pe||{};if(lo.equ(Ye,rt,X0)||Z0(rt,{...Ye}),lo.equ(tt,rt.params,X0)||Z0(rt,{params:{...rt.params,...tt}}),!Ee.camera||Ee.camera===v&&!lo.equ(v,fe,X0)){v=fe;const ut=fe instanceof lb,Mt=ut?fe:q?new hb(0,0,0,0,.1,1e3):new Ua(75,0,.1,1e3);ut||(Mt.position.z=5,fe&&(Z0(Mt,fe),("aspect"in fe||"left"in fe||"right"in fe||"bottom"in fe||"top"in fe)&&(Mt.manual=!0,Mt.updateProjectionMatrix())),!Ee.camera&&!(fe!=null&&fe.rotation)&&Mt.lookAt(0,0,0)),Ee.set({camera:Mt}),rt.camera=Mt}if(!Ee.scene){let ut;F instanceof _S?ut=F:(ut=new _S,F&&Z0(ut,F)),Ee.set({scene:J0(ut)})}if(!Ee.xr){var qe;const ut=(Xt,Qe)=>{const Ge=o.getState();Ge.frameloop!=="never"&&HW(Xt,!0,Ge,Qe)},Mt=()=>{const Xt=o.getState();Xt.gl.xr.enabled=Xt.gl.xr.isPresenting,Xt.gl.xr.setAnimationLoop(Xt.gl.xr.isPresenting?ut:null),Xt.gl.xr.isPresenting||GW(Xt)},Gt={connect(){const Xt=o.getState().gl;Xt.xr.addEventListener("sessionstart",Mt),Xt.xr.addEventListener("sessionend",Mt)},disconnect(){const Xt=o.getState().gl;Xt.xr.removeEventListener("sessionstart",Mt),Xt.xr.removeEventListener("sessionend",Mt)}};typeof((qe=We.xr)==null?void 0:qe.addEventListener)=="function"&&Gt.connect(),Ee.set({xr:Gt})}if(We.shadowMap){const ut=We.shadowMap.enabled,Mt=We.shadowMap.type;if(We.shadowMap.enabled=!!L,lo.boo(L))We.shadowMap.type=M1;else if(lo.str(L)){var ft;const Gt={basic:AK,percentage:WA,soft:M1,variance:qh};We.shadowMap.type=(ft=Gt[L])!=null?ft:M1}else lo.obj(L)&&Object.assign(We.shadowMap,L);(ut!==We.shadowMap.enabled||Mt!==We.shadowMap.type)&&(We.shadowMap.needsUpdate=!0)}const Me=DJ();Me&&("enabled"in Me?Me.enabled=!j:"legacyMode"in Me&&(Me.legacyMode=j)),f||Z0(We,{outputEncoding:P?3e3:3001,toneMapping:H?Cf:wB}),Ee.legacy!==j&&Ee.set(()=>({legacy:j})),Ee.linear!==P&&Ee.set(()=>({linear:P})),Ee.flat!==H&&Ee.set(()=>({flat:H})),C&&!lo.fun(C)&&!VJ(C)&&!lo.equ(C,We,X0)&&Z0(We,C),N&&!Ee.events.handlers&&Ee.set({events:N(o)});const $e=bFe(t,M);return lo.equ($e,Ee.size,X0)||Ee.setSize($e.width,$e.height,$e.updateStyle,$e.top,$e.left),ce&&Ee.viewport.dpr!==NJ(ce)&&Ee.setDpr(ce),Ee.frameloop!==le&&Ee.setFrameloop(le),Ee.onPointerMissed||Ee.set({onPointerMissed:ue}),ae&&!lo.equ(ae,Ee.performance,X0)&&Ee.set(ut=>({performance:{...ut.performance,...ae}})),s=z,f=!0,this},render(w){return f||this.configure(),RS.updateContainer(re.jsx(EFe,{store:o,children:w,onCreated:s,rootElement:t}),c,null,()=>{}),o},unmount(){HJ(t)}}}function EFe({store:t,children:e,onCreated:n,rootElement:i}){return _b(()=>{const r=t.getState();r.set(o=>({internal:{...o.internal,active:!0}})),n&&n(r),t.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),re.jsx(fz.Provider,{value:t,children:e})}function HJ(t,e){const n=om.get(t),i=n==null?void 0:n.fiber;if(i){const r=n==null?void 0:n.store.getState();r&&(r.internal.active=!1),RS.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var o,c,s,f;r.events.disconnect==null||r.events.disconnect(),(o=r.gl)==null||(c=o.renderLists)==null||c.dispose==null||c.dispose(),(s=r.gl)==null||s.forceContextLoss==null||s.forceContextLoss(),(f=r.gl)!=null&&f.xr&&r.xr.disconnect(),dFe(r),om.delete(t)}catch{}},500)})}}function MFe(t,e,n){return re.jsx(RFe,{children:t,container:e,state:n},e.uuid)}function RFe({state:t={},children:e,container:n}){const{events:i,size:r,...o}=t,c=pz(),[s]=Q.useState(()=>new cz),[f]=Q.useState(()=>new Cn),v=Q.useCallback((C,M)=>{const F={...C};Object.keys(C).forEach(z=>{(vFe.includes(z)||C[z]!==M[z]&&M[z])&&delete F[z]});let N;if(M&&r){const z=M.camera;N=C.viewport.getCurrentViewport(z,new gt,r),z!==C.camera&&zJ(z,r)}return{...F,scene:n,raycaster:s,pointer:f,mouse:f,previousRoot:c,events:{...C.events,...M==null?void 0:M.events,...i},size:{...C.size,...r},viewport:{...C.viewport,...N},...o}},[t]),[w]=Q.useState(()=>{const C=c.getState();return TJ((F,N)=>({...C,scene:n,raycaster:s,pointer:f,mouse:f,previousRoot:c,events:{...C.events,...i},size:{...C.size,...r},...o,set:F,get:N,setEvents:z=>F(L=>({...L,events:{...L.events,...z}}))}))});return Q.useEffect(()=>{const C=c.subscribe(M=>w.setState(F=>v(M,F)));return()=>{C()}},[v]),Q.useEffect(()=>{w.setState(C=>v(c.getState(),C))},[v]),Q.useEffect(()=>()=>{w.destroy()},[]),re.jsx(re.Fragment,{children:RS.createPortal(re.jsx(fz.Provider,{value:w,children:e}),w,null)})}RS.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Q.version});const Z2={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function WJ(t){const{handlePointer:e}=gFe(t);return{priority:1,enabled:!0,compute(n,i,r){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Z2).reduce((n,i)=>({...n,[i]:e(i)}),{}),update:()=>{var n;const{events:i,internal:r}=t.getState();(n=r.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:n=>{var i;const{set:r,events:o}=t.getState();o.disconnect==null||o.disconnect(),r(c=>({events:{...c.events,connected:n}})),Object.entries((i=o.handlers)!=null?i:[]).forEach(([c,s])=>{const[f,v]=Z2[c];n.addEventListener(f,s,{passive:v})})},disconnect:()=>{const{set:n,events:i}=t.getState();if(i.connected){var r;Object.entries((r=i.handlers)!=null?r:[]).forEach(([o,c])=>{if(i&&i.connected instanceof HTMLElement){const[s]=Z2[o];i.connected.removeEventListener(s,c)}}),n(o=>({events:{...o.events,connected:void 0}}))}}}}function tN(t,e,n){var i,r,o,c,s;e==null&&(e=100);function f(){var w=Date.now()-c;w<e&&w>=0?i=setTimeout(f,e-w):(i=null,n||(s=t.apply(o,r),o=r=null))}var v=function(){o=this,r=arguments,c=Date.now();var w=n&&!i;return i||(i=setTimeout(f,e)),w&&(s=t.apply(o,r),o=r=null),s};return v.clear=function(){i&&(clearTimeout(i),i=null)},v.flush=function(){i&&(s=t.apply(o,r),o=r=null,clearTimeout(i),i=null)},v}tN.debounce=tN;var TFe=tN;const WW=pv(TFe);var AFe=Object.defineProperty,PFe=Object.defineProperties,IFe=Object.getOwnPropertyDescriptors,jW=Object.getOwnPropertySymbols,DFe=Object.prototype.hasOwnProperty,FFe=Object.prototype.propertyIsEnumerable,$W=(t,e,n)=>e in t?AFe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qW=(t,e)=>{for(var n in e||(e={}))DFe.call(e,n)&&$W(t,n,e[n]);if(jW)for(var n of jW(e))FFe.call(e,n)&&$W(t,n,e[n]);return t},LFe=(t,e)=>PFe(t,IFe(e)),ZW,XW;typeof window<"u"&&((ZW=window.document)!=null&&ZW.createElement||((XW=window.navigator)==null?void 0:XW.product)==="ReactNative")?Q.useLayoutEffect:Q.useEffect;function jJ(t,e,n){if(!t)return;if(n(t)===!0)return t;let i=t.child;for(;i;){const r=jJ(i,e,n);if(r)return r;i=i.sibling}}function $J(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const KW=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=KW;return}return KW.apply(this,arguments)};const mz=$J(Q.createContext(null));class qJ extends Q.Component{render(){return Q.createElement(mz.Provider,{value:this._reactInternals},this.props.children)}}function OFe(){const t=Q.useContext(mz);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Q.useId();return Q.useMemo(()=>{for(const i of[t,t==null?void 0:t.alternate]){if(!i)continue;const r=jJ(i,!1,o=>{let c=o.memoizedState;for(;c;){if(c.memoizedState===e)return!0;c=c.next}});if(r)return r}},[t,e])}function kFe(){const t=OFe(),[e]=Q.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&typeof n.type=="object"){const r=n.type._context===void 0&&n.type.Provider===n.type?n.type:n.type._context;r&&r!==mz&&!e.has(r)&&e.set(r,Q.useContext($J(r)))}n=n.return}return e}function NFe(){const t=kFe();return Q.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>i=>Q.createElement(e,null,Q.createElement(n.Provider,LFe(qW({},i),{value:t.get(n)}))),e=>Q.createElement(qJ,qW({},e))),[t])}function BFe({debounce:t,scroll:e,polyfill:n,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const r=n||typeof window<"u"&&window.ResizeObserver,[o,c]=Q.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!r)return o.width=1280,o.height=800,[()=>{},o,()=>{}];const s=Q.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),f=t?typeof t=="number"?t:t.scroll:null,v=t?typeof t=="number"?t:t.resize:null,w=Q.useRef(!1);Q.useEffect(()=>(w.current=!0,()=>void(w.current=!1)));const[C,M,F]=Q.useMemo(()=>{const P=()=>{if(!s.current.element)return;const{left:H,top:j,width:q,height:le,bottom:ce,right:ae,x:pe,y:fe}=s.current.element.getBoundingClientRect(),ue={left:H,top:j,width:q,height:le,bottom:ce,right:ae,x:pe,y:fe};s.current.element instanceof HTMLElement&&i&&(ue.height=s.current.element.offsetHeight,ue.width=s.current.element.offsetWidth),Object.freeze(ue),w.current&&!GFe(s.current.lastBounds,ue)&&c(s.current.lastBounds=ue)};return[P,v?WW(P,v):P,f?WW(P,f):P]},[c,i,f,v]);function N(){s.current.scrollContainers&&(s.current.scrollContainers.forEach(P=>P.removeEventListener("scroll",F,!0)),s.current.scrollContainers=null),s.current.resizeObserver&&(s.current.resizeObserver.disconnect(),s.current.resizeObserver=null),s.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",s.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",s.current.orientationHandler))}function z(){var P;s.current.element&&(s.current.resizeObserver=new r(M),(P=s.current.resizeObserver)==null||P.observe(s.current.element),e&&s.current.scrollContainers&&s.current.scrollContainers.forEach(H=>H.addEventListener("scroll",F,{capture:!0,passive:!0})),s.current.orientationHandler=()=>{F()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",s.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",s.current.orientationHandler))}const L=P=>{!P||P===s.current.element||(N(),s.current.element=P,s.current.scrollContainers=ZJ(P),z())};return UFe(F,!!e),zFe(M),Q.useEffect(()=>{N(),z()},[e,F,M]),Q.useEffect(()=>N,[]),[L,o,C]}function zFe(t){Q.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function UFe(t,e){Q.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function ZJ(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(t);return[n,i,r].some(o=>o==="auto"||o==="scroll")&&e.push(t),[...e,...ZJ(t.parentElement)]}const VFe=["x","y","top","bottom","left","right","width","height"],GFe=(t,e)=>VFe.every(n=>t[n]===e[n]),HFe=Q.forwardRef(function({children:e,fallback:n,resize:i,style:r,gl:o,events:c=WJ,eventSource:s,eventPrefix:f,shadows:v,linear:w,flat:C,legacy:M,orthographic:F,frameloop:N,dpr:z,performance:L,raycaster:P,camera:H,scene:j,onPointerMissed:q,onCreated:le,...ce},ae){Q.useMemo(()=>dz(MJ),[]);const pe=NFe(),[fe,ue]=BFe({scroll:!0,debounce:{scroll:50,resize:0},...i}),Ee=Q.useRef(null),We=Q.useRef(null);Q.useImperativeHandle(ae,()=>Ee.current);const rt=LJ(q),[tt,Ye]=Q.useState(!1),[qe,ft]=Q.useState(!1);if(tt)throw tt;if(qe)throw qe;const Me=Q.useRef(null);_b(()=>{const ut=Ee.current;ue.width>0&&ue.height>0&&ut&&(Me.current||(Me.current=GJ(ut)),Me.current.configure({gl:o,events:c,shadows:v,linear:w,flat:C,legacy:M,orthographic:F,frameloop:N,dpr:z,performance:L,raycaster:P,camera:H,scene:j,size:ue,onPointerMissed:(...Mt)=>rt.current==null?void 0:rt.current(...Mt),onCreated:Mt=>{Mt.events.connect==null||Mt.events.connect(s?cFe(s)?s.current:s:We.current),f&&Mt.setEvents({compute:(Gt,Xt)=>{const Qe=Gt[f+"X"],Ge=Gt[f+"Y"];Xt.pointer.set(Qe/Xt.size.width*2-1,-(Ge/Xt.size.height)*2+1),Xt.raycaster.setFromCamera(Xt.pointer,Xt.camera)}}),le==null||le(Mt)}}),Me.current.render(re.jsx(pe,{children:re.jsx(OJ,{set:ft,children:re.jsx(Q.Suspense,{fallback:re.jsx(uFe,{set:Ye}),children:e})})})))}),Q.useEffect(()=>{const ut=Ee.current;if(ut)return()=>HJ(ut)},[]);const $e=s?"none":"auto";return re.jsx("div",{ref:We,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:$e,...r},...ce,children:re.jsx("div",{ref:fe,style:{width:"100%",height:"100%"},children:re.jsx("canvas",{ref:Ee,style:{display:"block"},children:n})})})}),WFe=Q.forwardRef(function(e,n){return re.jsx(qJ,{children:re.jsx(HFe,{...e,ref:n})})});var XJ={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(nN,function(){var n,i,r;function o(s,f){if(!n)n=f;else if(!i)i=f;else{var v="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",w={};n(w),r=f(w),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}o(["exports"],function(s){function f(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var v,w={},C={};function M(){if(v)return C;v=1,Object.defineProperty(C,"__esModule",{value:!0}),C.setMatrixArrayType=function(_){C.ARRAY_TYPE=a=_},C.toRadian=function(_){return _*p},C.equals=function(_,m){return Math.abs(_-m)<=d*Math.max(1,Math.abs(_),Math.abs(m))},C.RANDOM=C.ARRAY_TYPE=C.EPSILON=void 0;var d=1e-6;C.EPSILON=d;var a=typeof Float32Array<"u"?Float32Array:Array;C.ARRAY_TYPE=a;var u=Math.random;C.RANDOM=u;var p=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var _=0,m=arguments.length;m--;)_+=arguments[m]*arguments[m];return Math.sqrt(_)}),C}var F,N={};function z(){if(F)return N;function d(m){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(m)}F=1,Object.defineProperty(N,"__esModule",{value:!0}),N.create=function(){var m=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m},N.clone=function(m){var x=new a.ARRAY_TYPE(4);return x[0]=m[0],x[1]=m[1],x[2]=m[2],x[3]=m[3],x},N.copy=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[3],m},N.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m},N.fromValues=function(m,x,R,k){var V=new a.ARRAY_TYPE(4);return V[0]=m,V[1]=x,V[2]=R,V[3]=k,V},N.set=function(m,x,R,k,V){return m[0]=x,m[1]=R,m[2]=k,m[3]=V,m},N.transpose=function(m,x){if(m===x){var R=x[1];m[1]=x[2],m[2]=R}else m[0]=x[0],m[1]=x[2],m[2]=x[1],m[3]=x[3];return m},N.invert=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=R*b-V*k;return O?(m[0]=b*(O=1/O),m[1]=-k*O,m[2]=-V*O,m[3]=R*O,m):null},N.adjoint=function(m,x){var R=x[0];return m[0]=x[3],m[1]=-x[1],m[2]=-x[2],m[3]=R,m},N.determinant=function(m){return m[0]*m[3]-m[2]*m[1]},N.multiply=p,N.rotate=function(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=Math.sin(R),D=Math.cos(R);return m[0]=k*D+b*U,m[1]=V*D+O*U,m[2]=k*-U+b*D,m[3]=V*-U+O*D,m},N.scale=function(m,x,R){var k=x[1],V=x[2],b=x[3],O=R[0],U=R[1];return m[0]=x[0]*O,m[1]=k*O,m[2]=V*U,m[3]=b*U,m},N.fromRotation=function(m,x){var R=Math.sin(x),k=Math.cos(x);return m[0]=k,m[1]=R,m[2]=-R,m[3]=k,m},N.fromScaling=function(m,x){return m[0]=x[0],m[1]=0,m[2]=0,m[3]=x[1],m},N.str=function(m){return"mat2("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+")"},N.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3])},N.LDU=function(m,x,R,k){return m[2]=k[2]/k[0],R[0]=k[0],R[1]=k[1],R[3]=k[3]-m[2]*R[1],[m,x,R]},N.add=function(m,x,R){return m[0]=x[0]+R[0],m[1]=x[1]+R[1],m[2]=x[2]+R[2],m[3]=x[3]+R[3],m},N.subtract=_,N.exactEquals=function(m,x){return m[0]===x[0]&&m[1]===x[1]&&m[2]===x[2]&&m[3]===x[3]},N.equals=function(m,x){var R=m[0],k=m[1],V=m[2],b=m[3],O=x[0],U=x[1],D=x[2],B=x[3];return Math.abs(R-O)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(O))&&Math.abs(k-U)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(U))&&Math.abs(V-D)<=a.EPSILON*Math.max(1,Math.abs(V),Math.abs(D))&&Math.abs(b-B)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))},N.multiplyScalar=function(m,x,R){return m[0]=x[0]*R,m[1]=x[1]*R,m[2]=x[2]*R,m[3]=x[3]*R,m},N.multiplyScalarAndAdd=function(m,x,R,k){return m[0]=x[0]+R[0]*k,m[1]=x[1]+R[1]*k,m[2]=x[2]+R[2]*k,m[3]=x[3]+R[3]*k,m},N.sub=N.mul=void 0;var a=function(m,x){if(m&&m.__esModule)return m;if(m===null||d(m)!=="object"&&typeof m!="function")return{default:m};var R=u(void 0);if(R&&R.has(m))return R.get(m);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in m)if(b!=="default"&&Object.prototype.hasOwnProperty.call(m,b)){var O=V?Object.getOwnPropertyDescriptor(m,b):null;O&&(O.get||O.set)?Object.defineProperty(k,b,O):k[b]=m[b]}return k.default=m,R&&R.set(m,k),k}(M());function u(m){if(typeof WeakMap!="function")return null;var x=new WeakMap,R=new WeakMap;return(u=function(k){return k?R:x})(m)}function p(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=R[0],D=R[1],B=R[2],W=R[3];return m[0]=k*U+b*D,m[1]=V*U+O*D,m[2]=k*B+b*W,m[3]=V*B+O*W,m}function _(m,x,R){return m[0]=x[0]-R[0],m[1]=x[1]-R[1],m[2]=x[2]-R[2],m[3]=x[3]-R[3],m}return N.mul=p,N.sub=_,N}var L,P={};function H(){if(L)return P;function d(m){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(m)}L=1,Object.defineProperty(P,"__esModule",{value:!0}),P.create=function(){var m=new a.ARRAY_TYPE(6);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[4]=0,m[5]=0),m[0]=1,m[3]=1,m},P.clone=function(m){var x=new a.ARRAY_TYPE(6);return x[0]=m[0],x[1]=m[1],x[2]=m[2],x[3]=m[3],x[4]=m[4],x[5]=m[5],x},P.copy=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[3],m[4]=x[4],m[5]=x[5],m},P.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m[4]=0,m[5]=0,m},P.fromValues=function(m,x,R,k,V,b){var O=new a.ARRAY_TYPE(6);return O[0]=m,O[1]=x,O[2]=R,O[3]=k,O[4]=V,O[5]=b,O},P.set=function(m,x,R,k,V,b,O){return m[0]=x,m[1]=R,m[2]=k,m[3]=V,m[4]=b,m[5]=O,m},P.invert=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=x[4],U=x[5],D=R*b-k*V;return D?(m[0]=b*(D=1/D),m[1]=-k*D,m[2]=-V*D,m[3]=R*D,m[4]=(V*U-b*O)*D,m[5]=(k*O-R*U)*D,m):null},P.determinant=function(m){return m[0]*m[3]-m[1]*m[2]},P.multiply=p,P.rotate=function(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=Math.sin(R),W=Math.cos(R);return m[0]=k*W+b*B,m[1]=V*W+O*B,m[2]=k*-B+b*W,m[3]=V*-B+O*W,m[4]=U,m[5]=D,m},P.scale=function(m,x,R){var k=x[1],V=x[2],b=x[3],O=x[4],U=x[5],D=R[0],B=R[1];return m[0]=x[0]*D,m[1]=k*D,m[2]=V*B,m[3]=b*B,m[4]=O,m[5]=U,m},P.translate=function(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=R[0],W=R[1];return m[0]=k,m[1]=V,m[2]=b,m[3]=O,m[4]=k*B+b*W+U,m[5]=V*B+O*W+D,m},P.fromRotation=function(m,x){var R=Math.sin(x),k=Math.cos(x);return m[0]=k,m[1]=R,m[2]=-R,m[3]=k,m[4]=0,m[5]=0,m},P.fromScaling=function(m,x){return m[0]=x[0],m[1]=0,m[2]=0,m[3]=x[1],m[4]=0,m[5]=0,m},P.fromTranslation=function(m,x){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m[4]=x[0],m[5]=x[1],m},P.str=function(m){return"mat2d("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+")"},P.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],1)},P.add=function(m,x,R){return m[0]=x[0]+R[0],m[1]=x[1]+R[1],m[2]=x[2]+R[2],m[3]=x[3]+R[3],m[4]=x[4]+R[4],m[5]=x[5]+R[5],m},P.subtract=_,P.multiplyScalar=function(m,x,R){return m[0]=x[0]*R,m[1]=x[1]*R,m[2]=x[2]*R,m[3]=x[3]*R,m[4]=x[4]*R,m[5]=x[5]*R,m},P.multiplyScalarAndAdd=function(m,x,R,k){return m[0]=x[0]+R[0]*k,m[1]=x[1]+R[1]*k,m[2]=x[2]+R[2]*k,m[3]=x[3]+R[3]*k,m[4]=x[4]+R[4]*k,m[5]=x[5]+R[5]*k,m},P.exactEquals=function(m,x){return m[0]===x[0]&&m[1]===x[1]&&m[2]===x[2]&&m[3]===x[3]&&m[4]===x[4]&&m[5]===x[5]},P.equals=function(m,x){var R=m[0],k=m[1],V=m[2],b=m[3],O=m[4],U=m[5],D=x[0],B=x[1],W=x[2],K=x[3],J=x[4],se=x[5];return Math.abs(R-D)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(D))&&Math.abs(k-B)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(B))&&Math.abs(V-W)<=a.EPSILON*Math.max(1,Math.abs(V),Math.abs(W))&&Math.abs(b-K)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(K))&&Math.abs(O-J)<=a.EPSILON*Math.max(1,Math.abs(O),Math.abs(J))&&Math.abs(U-se)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(se))},P.sub=P.mul=void 0;var a=function(m,x){if(m&&m.__esModule)return m;if(m===null||d(m)!=="object"&&typeof m!="function")return{default:m};var R=u(void 0);if(R&&R.has(m))return R.get(m);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in m)if(b!=="default"&&Object.prototype.hasOwnProperty.call(m,b)){var O=V?Object.getOwnPropertyDescriptor(m,b):null;O&&(O.get||O.set)?Object.defineProperty(k,b,O):k[b]=m[b]}return k.default=m,R&&R.set(m,k),k}(M());function u(m){if(typeof WeakMap!="function")return null;var x=new WeakMap,R=new WeakMap;return(u=function(k){return k?R:x})(m)}function p(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=R[0],W=R[1],K=R[2],J=R[3],se=R[4],oe=R[5];return m[0]=k*B+b*W,m[1]=V*B+O*W,m[2]=k*K+b*J,m[3]=V*K+O*J,m[4]=k*se+b*oe+U,m[5]=V*se+O*oe+D,m}function _(m,x,R){return m[0]=x[0]-R[0],m[1]=x[1]-R[1],m[2]=x[2]-R[2],m[3]=x[3]-R[3],m[4]=x[4]-R[4],m[5]=x[5]-R[5],m}return P.mul=p,P.sub=_,P}var j,q={};function le(){if(j)return q;function d(m){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(m)}j=1,Object.defineProperty(q,"__esModule",{value:!0}),q.create=function(){var m=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[5]=0,m[6]=0,m[7]=0),m[0]=1,m[4]=1,m[8]=1,m},q.fromMat4=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[4],m[4]=x[5],m[5]=x[6],m[6]=x[8],m[7]=x[9],m[8]=x[10],m},q.clone=function(m){var x=new a.ARRAY_TYPE(9);return x[0]=m[0],x[1]=m[1],x[2]=m[2],x[3]=m[3],x[4]=m[4],x[5]=m[5],x[6]=m[6],x[7]=m[7],x[8]=m[8],x},q.copy=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[3],m[4]=x[4],m[5]=x[5],m[6]=x[6],m[7]=x[7],m[8]=x[8],m},q.fromValues=function(m,x,R,k,V,b,O,U,D){var B=new a.ARRAY_TYPE(9);return B[0]=m,B[1]=x,B[2]=R,B[3]=k,B[4]=V,B[5]=b,B[6]=O,B[7]=U,B[8]=D,B},q.set=function(m,x,R,k,V,b,O,U,D,B){return m[0]=x,m[1]=R,m[2]=k,m[3]=V,m[4]=b,m[5]=O,m[6]=U,m[7]=D,m[8]=B,m},q.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=1,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},q.transpose=function(m,x){if(m===x){var R=x[1],k=x[2],V=x[5];m[1]=x[3],m[2]=x[6],m[3]=R,m[5]=x[7],m[6]=k,m[7]=V}else m[0]=x[0],m[1]=x[3],m[2]=x[6],m[3]=x[1],m[4]=x[4],m[5]=x[7],m[6]=x[2],m[7]=x[5],m[8]=x[8];return m},q.invert=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=x[4],U=x[5],D=x[6],B=x[7],W=x[8],K=W*O-U*B,J=-W*b+U*D,se=B*b-O*D,oe=R*K+k*J+V*se;return oe?(m[0]=K*(oe=1/oe),m[1]=(-W*k+V*B)*oe,m[2]=(U*k-V*O)*oe,m[3]=J*oe,m[4]=(W*R-V*D)*oe,m[5]=(-U*R+V*b)*oe,m[6]=se*oe,m[7]=(-B*R+k*D)*oe,m[8]=(O*R-k*b)*oe,m):null},q.adjoint=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=x[4],U=x[5],D=x[6],B=x[7],W=x[8];return m[0]=O*W-U*B,m[1]=V*B-k*W,m[2]=k*U-V*O,m[3]=U*D-b*W,m[4]=R*W-V*D,m[5]=V*b-R*U,m[6]=b*B-O*D,m[7]=k*D-R*B,m[8]=R*O-k*b,m},q.determinant=function(m){var x=m[3],R=m[4],k=m[5],V=m[6],b=m[7],O=m[8];return m[0]*(O*R-k*b)+m[1]*(-O*x+k*V)+m[2]*(b*x-R*V)},q.multiply=p,q.translate=function(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=x[6],W=x[7],K=x[8],J=R[0],se=R[1];return m[0]=k,m[1]=V,m[2]=b,m[3]=O,m[4]=U,m[5]=D,m[6]=J*k+se*O+B,m[7]=J*V+se*U+W,m[8]=J*b+se*D+K,m},q.rotate=function(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=x[6],W=x[7],K=x[8],J=Math.sin(R),se=Math.cos(R);return m[0]=se*k+J*O,m[1]=se*V+J*U,m[2]=se*b+J*D,m[3]=se*O-J*k,m[4]=se*U-J*V,m[5]=se*D-J*b,m[6]=B,m[7]=W,m[8]=K,m},q.scale=function(m,x,R){var k=R[0],V=R[1];return m[0]=k*x[0],m[1]=k*x[1],m[2]=k*x[2],m[3]=V*x[3],m[4]=V*x[4],m[5]=V*x[5],m[6]=x[6],m[7]=x[7],m[8]=x[8],m},q.fromTranslation=function(m,x){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=1,m[5]=0,m[6]=x[0],m[7]=x[1],m[8]=1,m},q.fromRotation=function(m,x){var R=Math.sin(x),k=Math.cos(x);return m[0]=k,m[1]=R,m[2]=0,m[3]=-R,m[4]=k,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},q.fromScaling=function(m,x){return m[0]=x[0],m[1]=0,m[2]=0,m[3]=0,m[4]=x[1],m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},q.fromMat2d=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=0,m[3]=x[2],m[4]=x[3],m[5]=0,m[6]=x[4],m[7]=x[5],m[8]=1,m},q.fromQuat=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=R+R,U=k+k,D=V+V,B=R*O,W=k*O,K=k*U,J=V*O,se=V*U,oe=V*D,te=b*O,de=b*U,ge=b*D;return m[0]=1-K-oe,m[3]=W-ge,m[6]=J+de,m[1]=W+ge,m[4]=1-B-oe,m[7]=se-te,m[2]=J-de,m[5]=se+te,m[8]=1-B-K,m},q.normalFromMat4=function(m,x){var R=x[0],k=x[1],V=x[2],b=x[3],O=x[4],U=x[5],D=x[6],B=x[7],W=x[8],K=x[9],J=x[10],se=x[11],oe=x[12],te=x[13],de=x[14],ge=x[15],Te=R*U-k*O,Ve=R*D-V*O,Oe=R*B-b*O,Ne=k*D-V*U,st=k*B-b*U,ke=V*B-b*D,et=W*te-K*oe,ct=W*de-J*oe,dt=W*ge-se*oe,xt=K*de-J*te,Rt=K*ge-se*te,It=J*ge-se*de,Et=Te*It-Ve*Rt+Oe*xt+Ne*dt-st*ct+ke*et;return Et?(m[0]=(U*It-D*Rt+B*xt)*(Et=1/Et),m[1]=(D*dt-O*It-B*ct)*Et,m[2]=(O*Rt-U*dt+B*et)*Et,m[3]=(V*Rt-k*It-b*xt)*Et,m[4]=(R*It-V*dt+b*ct)*Et,m[5]=(k*dt-R*Rt-b*et)*Et,m[6]=(te*ke-de*st+ge*Ne)*Et,m[7]=(de*Oe-oe*ke-ge*Ve)*Et,m[8]=(oe*st-te*Oe+ge*Te)*Et,m):null},q.projection=function(m,x,R){return m[0]=2/x,m[1]=0,m[2]=0,m[3]=0,m[4]=-2/R,m[5]=0,m[6]=-1,m[7]=1,m[8]=1,m},q.str=function(m){return"mat3("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+", "+m[6]+", "+m[7]+", "+m[8]+")"},q.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8])},q.add=function(m,x,R){return m[0]=x[0]+R[0],m[1]=x[1]+R[1],m[2]=x[2]+R[2],m[3]=x[3]+R[3],m[4]=x[4]+R[4],m[5]=x[5]+R[5],m[6]=x[6]+R[6],m[7]=x[7]+R[7],m[8]=x[8]+R[8],m},q.subtract=_,q.multiplyScalar=function(m,x,R){return m[0]=x[0]*R,m[1]=x[1]*R,m[2]=x[2]*R,m[3]=x[3]*R,m[4]=x[4]*R,m[5]=x[5]*R,m[6]=x[6]*R,m[7]=x[7]*R,m[8]=x[8]*R,m},q.multiplyScalarAndAdd=function(m,x,R,k){return m[0]=x[0]+R[0]*k,m[1]=x[1]+R[1]*k,m[2]=x[2]+R[2]*k,m[3]=x[3]+R[3]*k,m[4]=x[4]+R[4]*k,m[5]=x[5]+R[5]*k,m[6]=x[6]+R[6]*k,m[7]=x[7]+R[7]*k,m[8]=x[8]+R[8]*k,m},q.exactEquals=function(m,x){return m[0]===x[0]&&m[1]===x[1]&&m[2]===x[2]&&m[3]===x[3]&&m[4]===x[4]&&m[5]===x[5]&&m[6]===x[6]&&m[7]===x[7]&&m[8]===x[8]},q.equals=function(m,x){var R=m[0],k=m[1],V=m[2],b=m[3],O=m[4],U=m[5],D=m[6],B=m[7],W=m[8],K=x[0],J=x[1],se=x[2],oe=x[3],te=x[4],de=x[5],ge=x[6],Te=x[7],Ve=x[8];return Math.abs(R-K)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(K))&&Math.abs(k-J)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(V-se)<=a.EPSILON*Math.max(1,Math.abs(V),Math.abs(se))&&Math.abs(b-oe)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(oe))&&Math.abs(O-te)<=a.EPSILON*Math.max(1,Math.abs(O),Math.abs(te))&&Math.abs(U-de)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(de))&&Math.abs(D-ge)<=a.EPSILON*Math.max(1,Math.abs(D),Math.abs(ge))&&Math.abs(B-Te)<=a.EPSILON*Math.max(1,Math.abs(B),Math.abs(Te))&&Math.abs(W-Ve)<=a.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ve))},q.sub=q.mul=void 0;var a=function(m,x){if(m&&m.__esModule)return m;if(m===null||d(m)!=="object"&&typeof m!="function")return{default:m};var R=u(void 0);if(R&&R.has(m))return R.get(m);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in m)if(b!=="default"&&Object.prototype.hasOwnProperty.call(m,b)){var O=V?Object.getOwnPropertyDescriptor(m,b):null;O&&(O.get||O.set)?Object.defineProperty(k,b,O):k[b]=m[b]}return k.default=m,R&&R.set(m,k),k}(M());function u(m){if(typeof WeakMap!="function")return null;var x=new WeakMap,R=new WeakMap;return(u=function(k){return k?R:x})(m)}function p(m,x,R){var k=x[0],V=x[1],b=x[2],O=x[3],U=x[4],D=x[5],B=x[6],W=x[7],K=x[8],J=R[0],se=R[1],oe=R[2],te=R[3],de=R[4],ge=R[5],Te=R[6],Ve=R[7],Oe=R[8];return m[0]=J*k+se*O+oe*B,m[1]=J*V+se*U+oe*W,m[2]=J*b+se*D+oe*K,m[3]=te*k+de*O+ge*B,m[4]=te*V+de*U+ge*W,m[5]=te*b+de*D+ge*K,m[6]=Te*k+Ve*O+Oe*B,m[7]=Te*V+Ve*U+Oe*W,m[8]=Te*b+Ve*D+Oe*K,m}function _(m,x,R){return m[0]=x[0]-R[0],m[1]=x[1]-R[1],m[2]=x[2]-R[2],m[3]=x[3]-R[3],m[4]=x[4]-R[4],m[5]=x[5]-R[5],m[6]=x[6]-R[6],m[7]=x[7]-R[7],m[8]=x[8]-R[8],m}return q.mul=p,q.sub=_,q}var ce,ae={};function pe(){if(ce)return ae;function d(b){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},d(b)}ce=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=function(){var b=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},ae.clone=function(b){var O=new a.ARRAY_TYPE(16);return O[0]=b[0],O[1]=b[1],O[2]=b[2],O[3]=b[3],O[4]=b[4],O[5]=b[5],O[6]=b[6],O[7]=b[7],O[8]=b[8],O[9]=b[9],O[10]=b[10],O[11]=b[11],O[12]=b[12],O[13]=b[13],O[14]=b[14],O[15]=b[15],O},ae.copy=function(b,O){return b[0]=O[0],b[1]=O[1],b[2]=O[2],b[3]=O[3],b[4]=O[4],b[5]=O[5],b[6]=O[6],b[7]=O[7],b[8]=O[8],b[9]=O[9],b[10]=O[10],b[11]=O[11],b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15],b},ae.fromValues=function(b,O,U,D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe){var Ne=new a.ARRAY_TYPE(16);return Ne[0]=b,Ne[1]=O,Ne[2]=U,Ne[3]=D,Ne[4]=B,Ne[5]=W,Ne[6]=K,Ne[7]=J,Ne[8]=se,Ne[9]=oe,Ne[10]=te,Ne[11]=de,Ne[12]=ge,Ne[13]=Te,Ne[14]=Ve,Ne[15]=Oe,Ne},ae.set=function(b,O,U,D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe,Ne){return b[0]=O,b[1]=U,b[2]=D,b[3]=B,b[4]=W,b[5]=K,b[6]=J,b[7]=se,b[8]=oe,b[9]=te,b[10]=de,b[11]=ge,b[12]=Te,b[13]=Ve,b[14]=Oe,b[15]=Ne,b},ae.identity=p,ae.transpose=function(b,O){if(b===O){var U=O[1],D=O[2],B=O[3],W=O[6],K=O[7],J=O[11];b[1]=O[4],b[2]=O[8],b[3]=O[12],b[4]=U,b[6]=O[9],b[7]=O[13],b[8]=D,b[9]=W,b[11]=O[14],b[12]=B,b[13]=K,b[14]=J}else b[0]=O[0],b[1]=O[4],b[2]=O[8],b[3]=O[12],b[4]=O[1],b[5]=O[5],b[6]=O[9],b[7]=O[13],b[8]=O[2],b[9]=O[6],b[10]=O[10],b[11]=O[14],b[12]=O[3],b[13]=O[7],b[14]=O[11],b[15]=O[15];return b},ae.invert=function(b,O){var U=O[0],D=O[1],B=O[2],W=O[3],K=O[4],J=O[5],se=O[6],oe=O[7],te=O[8],de=O[9],ge=O[10],Te=O[11],Ve=O[12],Oe=O[13],Ne=O[14],st=O[15],ke=U*J-D*K,et=U*se-B*K,ct=U*oe-W*K,dt=D*se-B*J,xt=D*oe-W*J,Rt=B*oe-W*se,It=te*Oe-de*Ve,Et=te*Ne-ge*Ve,en=te*st-Te*Ve,dn=de*Ne-ge*Oe,Ht=de*st-Te*Oe,Vn=ge*st-Te*Ne,Rn=ke*Vn-et*Ht+ct*dn+dt*en-xt*Et+Rt*It;return Rn?(b[0]=(J*Vn-se*Ht+oe*dn)*(Rn=1/Rn),b[1]=(B*Ht-D*Vn-W*dn)*Rn,b[2]=(Oe*Rt-Ne*xt+st*dt)*Rn,b[3]=(ge*xt-de*Rt-Te*dt)*Rn,b[4]=(se*en-K*Vn-oe*Et)*Rn,b[5]=(U*Vn-B*en+W*Et)*Rn,b[6]=(Ne*ct-Ve*Rt-st*et)*Rn,b[7]=(te*Rt-ge*ct+Te*et)*Rn,b[8]=(K*Ht-J*en+oe*It)*Rn,b[9]=(D*en-U*Ht-W*It)*Rn,b[10]=(Ve*xt-Oe*ct+st*ke)*Rn,b[11]=(de*ct-te*xt-Te*ke)*Rn,b[12]=(J*Et-K*dn-se*It)*Rn,b[13]=(U*dn-D*Et+B*It)*Rn,b[14]=(Oe*et-Ve*dt-Ne*ke)*Rn,b[15]=(te*dt-de*et+ge*ke)*Rn,b):null},ae.adjoint=function(b,O){var U=O[0],D=O[1],B=O[2],W=O[3],K=O[4],J=O[5],se=O[6],oe=O[7],te=O[8],de=O[9],ge=O[10],Te=O[11],Ve=O[12],Oe=O[13],Ne=O[14],st=O[15];return b[0]=J*(ge*st-Te*Ne)-de*(se*st-oe*Ne)+Oe*(se*Te-oe*ge),b[1]=-(D*(ge*st-Te*Ne)-de*(B*st-W*Ne)+Oe*(B*Te-W*ge)),b[2]=D*(se*st-oe*Ne)-J*(B*st-W*Ne)+Oe*(B*oe-W*se),b[3]=-(D*(se*Te-oe*ge)-J*(B*Te-W*ge)+de*(B*oe-W*se)),b[4]=-(K*(ge*st-Te*Ne)-te*(se*st-oe*Ne)+Ve*(se*Te-oe*ge)),b[5]=U*(ge*st-Te*Ne)-te*(B*st-W*Ne)+Ve*(B*Te-W*ge),b[6]=-(U*(se*st-oe*Ne)-K*(B*st-W*Ne)+Ve*(B*oe-W*se)),b[7]=U*(se*Te-oe*ge)-K*(B*Te-W*ge)+te*(B*oe-W*se),b[8]=K*(de*st-Te*Oe)-te*(J*st-oe*Oe)+Ve*(J*Te-oe*de),b[9]=-(U*(de*st-Te*Oe)-te*(D*st-W*Oe)+Ve*(D*Te-W*de)),b[10]=U*(J*st-oe*Oe)-K*(D*st-W*Oe)+Ve*(D*oe-W*J),b[11]=-(U*(J*Te-oe*de)-K*(D*Te-W*de)+te*(D*oe-W*J)),b[12]=-(K*(de*Ne-ge*Oe)-te*(J*Ne-se*Oe)+Ve*(J*ge-se*de)),b[13]=U*(de*Ne-ge*Oe)-te*(D*Ne-B*Oe)+Ve*(D*ge-B*de),b[14]=-(U*(J*Ne-se*Oe)-K*(D*Ne-B*Oe)+Ve*(D*se-B*J)),b[15]=U*(J*ge-se*de)-K*(D*ge-B*de)+te*(D*se-B*J),b},ae.determinant=function(b){var O=b[0],U=b[1],D=b[2],B=b[3],W=b[4],K=b[5],J=b[6],se=b[7],oe=b[8],te=b[9],de=b[10],ge=b[11],Te=b[12],Ve=b[13],Oe=b[14],Ne=b[15];return(O*K-U*W)*(de*Ne-ge*Oe)-(O*J-D*W)*(te*Ne-ge*Ve)+(O*se-B*W)*(te*Oe-de*Ve)+(U*J-D*K)*(oe*Ne-ge*Te)-(U*se-B*K)*(oe*Oe-de*Te)+(D*se-B*J)*(oe*Ve-te*Te)},ae.multiply=_,ae.translate=function(b,O,U){var D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe=U[0],Ne=U[1],st=U[2];return O===b?(b[12]=O[0]*Oe+O[4]*Ne+O[8]*st+O[12],b[13]=O[1]*Oe+O[5]*Ne+O[9]*st+O[13],b[14]=O[2]*Oe+O[6]*Ne+O[10]*st+O[14],b[15]=O[3]*Oe+O[7]*Ne+O[11]*st+O[15]):(B=O[1],W=O[2],K=O[3],J=O[4],se=O[5],oe=O[6],te=O[7],de=O[8],ge=O[9],Te=O[10],Ve=O[11],b[0]=D=O[0],b[1]=B,b[2]=W,b[3]=K,b[4]=J,b[5]=se,b[6]=oe,b[7]=te,b[8]=de,b[9]=ge,b[10]=Te,b[11]=Ve,b[12]=D*Oe+J*Ne+de*st+O[12],b[13]=B*Oe+se*Ne+ge*st+O[13],b[14]=W*Oe+oe*Ne+Te*st+O[14],b[15]=K*Oe+te*Ne+Ve*st+O[15]),b},ae.scale=function(b,O,U){var D=U[0],B=U[1],W=U[2];return b[0]=O[0]*D,b[1]=O[1]*D,b[2]=O[2]*D,b[3]=O[3]*D,b[4]=O[4]*B,b[5]=O[5]*B,b[6]=O[6]*B,b[7]=O[7]*B,b[8]=O[8]*W,b[9]=O[9]*W,b[10]=O[10]*W,b[11]=O[11]*W,b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15],b},ae.rotate=function(b,O,U,D){var B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct,dt,xt,Rt,It,Et,en,dn,Ht=D[0],Vn=D[1],Rn=D[2],xn=Math.hypot(Ht,Vn,Rn);return xn<a.EPSILON?null:(Ht*=xn=1/xn,Vn*=xn,Rn*=xn,B=Math.sin(U),W=Math.cos(U),se=O[1],oe=O[2],te=O[3],ge=O[5],Te=O[6],Ve=O[7],Ne=O[9],st=O[10],ke=O[11],et=Ht*Ht*(K=1-W)+W,xt=Ht*Vn*K-Rn*B,Rt=Vn*Vn*K+W,It=Rn*Vn*K+Ht*B,Et=Ht*Rn*K+Vn*B,en=Vn*Rn*K-Ht*B,dn=Rn*Rn*K+W,b[0]=(J=O[0])*et+(de=O[4])*(ct=Vn*Ht*K+Rn*B)+(Oe=O[8])*(dt=Rn*Ht*K-Vn*B),b[1]=se*et+ge*ct+Ne*dt,b[2]=oe*et+Te*ct+st*dt,b[3]=te*et+Ve*ct+ke*dt,b[4]=J*xt+de*Rt+Oe*It,b[5]=se*xt+ge*Rt+Ne*It,b[6]=oe*xt+Te*Rt+st*It,b[7]=te*xt+Ve*Rt+ke*It,b[8]=J*Et+de*en+Oe*dn,b[9]=se*Et+ge*en+Ne*dn,b[10]=oe*Et+Te*en+st*dn,b[11]=te*Et+Ve*en+ke*dn,O!==b&&(b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15]),b)},ae.rotateX=function(b,O,U){var D=Math.sin(U),B=Math.cos(U),W=O[4],K=O[5],J=O[6],se=O[7],oe=O[8],te=O[9],de=O[10],ge=O[11];return O!==b&&(b[0]=O[0],b[1]=O[1],b[2]=O[2],b[3]=O[3],b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15]),b[4]=W*B+oe*D,b[5]=K*B+te*D,b[6]=J*B+de*D,b[7]=se*B+ge*D,b[8]=oe*B-W*D,b[9]=te*B-K*D,b[10]=de*B-J*D,b[11]=ge*B-se*D,b},ae.rotateY=function(b,O,U){var D=Math.sin(U),B=Math.cos(U),W=O[0],K=O[1],J=O[2],se=O[3],oe=O[8],te=O[9],de=O[10],ge=O[11];return O!==b&&(b[4]=O[4],b[5]=O[5],b[6]=O[6],b[7]=O[7],b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15]),b[0]=W*B-oe*D,b[1]=K*B-te*D,b[2]=J*B-de*D,b[3]=se*B-ge*D,b[8]=W*D+oe*B,b[9]=K*D+te*B,b[10]=J*D+de*B,b[11]=se*D+ge*B,b},ae.rotateZ=function(b,O,U){var D=Math.sin(U),B=Math.cos(U),W=O[0],K=O[1],J=O[2],se=O[3],oe=O[4],te=O[5],de=O[6],ge=O[7];return O!==b&&(b[8]=O[8],b[9]=O[9],b[10]=O[10],b[11]=O[11],b[12]=O[12],b[13]=O[13],b[14]=O[14],b[15]=O[15]),b[0]=W*B+oe*D,b[1]=K*B+te*D,b[2]=J*B+de*D,b[3]=se*B+ge*D,b[4]=oe*B-W*D,b[5]=te*B-K*D,b[6]=de*B-J*D,b[7]=ge*B-se*D,b},ae.fromTranslation=function(b,O){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=O[0],b[13]=O[1],b[14]=O[2],b[15]=1,b},ae.fromScaling=function(b,O){return b[0]=O[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=O[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=O[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ae.fromRotation=function(b,O,U){var D,B,W,K=U[0],J=U[1],se=U[2],oe=Math.hypot(K,J,se);return oe<a.EPSILON?null:(K*=oe=1/oe,J*=oe,se*=oe,D=Math.sin(O),B=Math.cos(O),b[0]=K*K*(W=1-B)+B,b[1]=J*K*W+se*D,b[2]=se*K*W-J*D,b[3]=0,b[4]=K*J*W-se*D,b[5]=J*J*W+B,b[6]=se*J*W+K*D,b[7]=0,b[8]=K*se*W+J*D,b[9]=J*se*W-K*D,b[10]=se*se*W+B,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)},ae.fromXRotation=function(b,O){var U=Math.sin(O),D=Math.cos(O);return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=D,b[6]=U,b[7]=0,b[8]=0,b[9]=-U,b[10]=D,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ae.fromYRotation=function(b,O){var U=Math.sin(O),D=Math.cos(O);return b[0]=D,b[1]=0,b[2]=-U,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=U,b[9]=0,b[10]=D,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ae.fromZRotation=function(b,O){var U=Math.sin(O),D=Math.cos(O);return b[0]=D,b[1]=U,b[2]=0,b[3]=0,b[4]=-U,b[5]=D,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ae.fromRotationTranslation=m,ae.fromQuat2=function(b,O){var U=new a.ARRAY_TYPE(3),D=-O[0],B=-O[1],W=-O[2],K=O[3],J=O[4],se=O[5],oe=O[6],te=O[7],de=D*D+B*B+W*W+K*K;return de>0?(U[0]=2*(J*K+te*D+se*W-oe*B)/de,U[1]=2*(se*K+te*B+oe*D-J*W)/de,U[2]=2*(oe*K+te*W+J*B-se*D)/de):(U[0]=2*(J*K+te*D+se*W-oe*B),U[1]=2*(se*K+te*B+oe*D-J*W),U[2]=2*(oe*K+te*W+J*B-se*D)),m(b,O,U),b},ae.getTranslation=function(b,O){return b[0]=O[12],b[1]=O[13],b[2]=O[14],b},ae.getScaling=x,ae.getRotation=function(b,O){var U=new a.ARRAY_TYPE(3);x(U,O);var D=1/U[0],B=1/U[1],W=1/U[2],K=O[0]*D,J=O[1]*B,se=O[2]*W,oe=O[4]*D,te=O[5]*B,de=O[6]*W,ge=O[8]*D,Te=O[9]*B,Ve=O[10]*W,Oe=K+te+Ve,Ne=0;return Oe>0?(Ne=2*Math.sqrt(Oe+1),b[3]=.25*Ne,b[0]=(de-Te)/Ne,b[1]=(ge-se)/Ne,b[2]=(J-oe)/Ne):K>te&&K>Ve?(Ne=2*Math.sqrt(1+K-te-Ve),b[3]=(de-Te)/Ne,b[0]=.25*Ne,b[1]=(J+oe)/Ne,b[2]=(ge+se)/Ne):te>Ve?(Ne=2*Math.sqrt(1+te-K-Ve),b[3]=(ge-se)/Ne,b[0]=(J+oe)/Ne,b[1]=.25*Ne,b[2]=(de+Te)/Ne):(Ne=2*Math.sqrt(1+Ve-K-te),b[3]=(J-oe)/Ne,b[0]=(ge+se)/Ne,b[1]=(de+Te)/Ne,b[2]=.25*Ne),b},ae.fromRotationTranslationScale=function(b,O,U,D){var B=O[0],W=O[1],K=O[2],J=O[3],se=B+B,oe=W+W,te=K+K,de=B*se,ge=B*oe,Te=B*te,Ve=W*oe,Oe=W*te,Ne=K*te,st=J*se,ke=J*oe,et=J*te,ct=D[0],dt=D[1],xt=D[2];return b[0]=(1-(Ve+Ne))*ct,b[1]=(ge+et)*ct,b[2]=(Te-ke)*ct,b[3]=0,b[4]=(ge-et)*dt,b[5]=(1-(de+Ne))*dt,b[6]=(Oe+st)*dt,b[7]=0,b[8]=(Te+ke)*xt,b[9]=(Oe-st)*xt,b[10]=(1-(de+Ve))*xt,b[11]=0,b[12]=U[0],b[13]=U[1],b[14]=U[2],b[15]=1,b},ae.fromRotationTranslationScaleOrigin=function(b,O,U,D,B){var W=O[0],K=O[1],J=O[2],se=O[3],oe=W+W,te=K+K,de=J+J,ge=W*oe,Te=W*te,Ve=W*de,Oe=K*te,Ne=K*de,st=J*de,ke=se*oe,et=se*te,ct=se*de,dt=D[0],xt=D[1],Rt=D[2],It=B[0],Et=B[1],en=B[2],dn=(1-(Oe+st))*dt,Ht=(Te+ct)*dt,Vn=(Ve-et)*dt,Rn=(Te-ct)*xt,xn=(1-(ge+st))*xt,hn=(Ne+ke)*xt,si=(Ve+et)*Rt,Nn=(Ne-ke)*Rt,qn=(1-(ge+Oe))*Rt;return b[0]=dn,b[1]=Ht,b[2]=Vn,b[3]=0,b[4]=Rn,b[5]=xn,b[6]=hn,b[7]=0,b[8]=si,b[9]=Nn,b[10]=qn,b[11]=0,b[12]=U[0]+It-(dn*It+Rn*Et+si*en),b[13]=U[1]+Et-(Ht*It+xn*Et+Nn*en),b[14]=U[2]+en-(Vn*It+hn*Et+qn*en),b[15]=1,b},ae.fromQuat=function(b,O){var U=O[0],D=O[1],B=O[2],W=O[3],K=U+U,J=D+D,se=B+B,oe=U*K,te=D*K,de=D*J,ge=B*K,Te=B*J,Ve=B*se,Oe=W*K,Ne=W*J,st=W*se;return b[0]=1-de-Ve,b[1]=te+st,b[2]=ge-Ne,b[3]=0,b[4]=te-st,b[5]=1-oe-Ve,b[6]=Te+Oe,b[7]=0,b[8]=ge+Ne,b[9]=Te-Oe,b[10]=1-oe-de,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ae.frustum=function(b,O,U,D,B,W,K){var J=1/(U-O),se=1/(B-D),oe=1/(W-K);return b[0]=2*W*J,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*W*se,b[6]=0,b[7]=0,b[8]=(U+O)*J,b[9]=(B+D)*se,b[10]=(K+W)*oe,b[11]=-1,b[12]=0,b[13]=0,b[14]=K*W*2*oe,b[15]=0,b},ae.perspectiveNO=R,ae.perspectiveZO=function(b,O,U,D,B){var W,K=1/Math.tan(O/2);return b[0]=K/U,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=K,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,B!=null&&B!==1/0?(b[10]=B*(W=1/(D-B)),b[14]=B*D*W):(b[10]=-1,b[14]=-D),b},ae.perspectiveFromFieldOfView=function(b,O,U,D){var B=Math.tan(O.upDegrees*Math.PI/180),W=Math.tan(O.downDegrees*Math.PI/180),K=Math.tan(O.leftDegrees*Math.PI/180),J=Math.tan(O.rightDegrees*Math.PI/180),se=2/(K+J),oe=2/(B+W);return b[0]=se,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=oe,b[6]=0,b[7]=0,b[8]=-(K-J)*se*.5,b[9]=(B-W)*oe*.5,b[10]=D/(U-D),b[11]=-1,b[12]=0,b[13]=0,b[14]=D*U/(U-D),b[15]=0,b},ae.orthoNO=k,ae.orthoZO=function(b,O,U,D,B,W,K){var J=1/(O-U),se=1/(D-B),oe=1/(W-K);return b[0]=-2*J,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*se,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=oe,b[11]=0,b[12]=(O+U)*J,b[13]=(B+D)*se,b[14]=W*oe,b[15]=1,b},ae.lookAt=function(b,O,U,D){var B,W,K,J,se,oe,te,de,ge,Te,Ve=O[0],Oe=O[1],Ne=O[2],st=D[0],ke=D[1],et=D[2],ct=U[0],dt=U[1],xt=U[2];return Math.abs(Ve-ct)<a.EPSILON&&Math.abs(Oe-dt)<a.EPSILON&&Math.abs(Ne-xt)<a.EPSILON?p(b):(te=Ve-ct,de=Oe-dt,ge=Ne-xt,B=ke*(ge*=Te=1/Math.hypot(te,de,ge))-et*(de*=Te),W=et*(te*=Te)-st*ge,K=st*de-ke*te,(Te=Math.hypot(B,W,K))?(B*=Te=1/Te,W*=Te,K*=Te):(B=0,W=0,K=0),J=de*K-ge*W,se=ge*B-te*K,oe=te*W-de*B,(Te=Math.hypot(J,se,oe))?(J*=Te=1/Te,se*=Te,oe*=Te):(J=0,se=0,oe=0),b[0]=B,b[1]=J,b[2]=te,b[3]=0,b[4]=W,b[5]=se,b[6]=de,b[7]=0,b[8]=K,b[9]=oe,b[10]=ge,b[11]=0,b[12]=-(B*Ve+W*Oe+K*Ne),b[13]=-(J*Ve+se*Oe+oe*Ne),b[14]=-(te*Ve+de*Oe+ge*Ne),b[15]=1,b)},ae.targetTo=function(b,O,U,D){var B=O[0],W=O[1],K=O[2],J=D[0],se=D[1],oe=D[2],te=B-U[0],de=W-U[1],ge=K-U[2],Te=te*te+de*de+ge*ge;Te>0&&(te*=Te=1/Math.sqrt(Te),de*=Te,ge*=Te);var Ve=se*ge-oe*de,Oe=oe*te-J*ge,Ne=J*de-se*te;return(Te=Ve*Ve+Oe*Oe+Ne*Ne)>0&&(Ve*=Te=1/Math.sqrt(Te),Oe*=Te,Ne*=Te),b[0]=Ve,b[1]=Oe,b[2]=Ne,b[3]=0,b[4]=de*Ne-ge*Oe,b[5]=ge*Ve-te*Ne,b[6]=te*Oe-de*Ve,b[7]=0,b[8]=te,b[9]=de,b[10]=ge,b[11]=0,b[12]=B,b[13]=W,b[14]=K,b[15]=1,b},ae.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"},ae.frob=function(b){return Math.hypot(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15])},ae.add=function(b,O,U){return b[0]=O[0]+U[0],b[1]=O[1]+U[1],b[2]=O[2]+U[2],b[3]=O[3]+U[3],b[4]=O[4]+U[4],b[5]=O[5]+U[5],b[6]=O[6]+U[6],b[7]=O[7]+U[7],b[8]=O[8]+U[8],b[9]=O[9]+U[9],b[10]=O[10]+U[10],b[11]=O[11]+U[11],b[12]=O[12]+U[12],b[13]=O[13]+U[13],b[14]=O[14]+U[14],b[15]=O[15]+U[15],b},ae.subtract=V,ae.multiplyScalar=function(b,O,U){return b[0]=O[0]*U,b[1]=O[1]*U,b[2]=O[2]*U,b[3]=O[3]*U,b[4]=O[4]*U,b[5]=O[5]*U,b[6]=O[6]*U,b[7]=O[7]*U,b[8]=O[8]*U,b[9]=O[9]*U,b[10]=O[10]*U,b[11]=O[11]*U,b[12]=O[12]*U,b[13]=O[13]*U,b[14]=O[14]*U,b[15]=O[15]*U,b},ae.multiplyScalarAndAdd=function(b,O,U,D){return b[0]=O[0]+U[0]*D,b[1]=O[1]+U[1]*D,b[2]=O[2]+U[2]*D,b[3]=O[3]+U[3]*D,b[4]=O[4]+U[4]*D,b[5]=O[5]+U[5]*D,b[6]=O[6]+U[6]*D,b[7]=O[7]+U[7]*D,b[8]=O[8]+U[8]*D,b[9]=O[9]+U[9]*D,b[10]=O[10]+U[10]*D,b[11]=O[11]+U[11]*D,b[12]=O[12]+U[12]*D,b[13]=O[13]+U[13]*D,b[14]=O[14]+U[14]*D,b[15]=O[15]+U[15]*D,b},ae.exactEquals=function(b,O){return b[0]===O[0]&&b[1]===O[1]&&b[2]===O[2]&&b[3]===O[3]&&b[4]===O[4]&&b[5]===O[5]&&b[6]===O[6]&&b[7]===O[7]&&b[8]===O[8]&&b[9]===O[9]&&b[10]===O[10]&&b[11]===O[11]&&b[12]===O[12]&&b[13]===O[13]&&b[14]===O[14]&&b[15]===O[15]},ae.equals=function(b,O){var U=b[0],D=b[1],B=b[2],W=b[3],K=b[4],J=b[5],se=b[6],oe=b[7],te=b[8],de=b[9],ge=b[10],Te=b[11],Ve=b[12],Oe=b[13],Ne=b[14],st=b[15],ke=O[0],et=O[1],ct=O[2],dt=O[3],xt=O[4],Rt=O[5],It=O[6],Et=O[7],en=O[8],dn=O[9],Ht=O[10],Vn=O[11],Rn=O[12],xn=O[13],hn=O[14],si=O[15];return Math.abs(U-ke)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(ke))&&Math.abs(D-et)<=a.EPSILON*Math.max(1,Math.abs(D),Math.abs(et))&&Math.abs(B-ct)<=a.EPSILON*Math.max(1,Math.abs(B),Math.abs(ct))&&Math.abs(W-dt)<=a.EPSILON*Math.max(1,Math.abs(W),Math.abs(dt))&&Math.abs(K-xt)<=a.EPSILON*Math.max(1,Math.abs(K),Math.abs(xt))&&Math.abs(J-Rt)<=a.EPSILON*Math.max(1,Math.abs(J),Math.abs(Rt))&&Math.abs(se-It)<=a.EPSILON*Math.max(1,Math.abs(se),Math.abs(It))&&Math.abs(oe-Et)<=a.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Et))&&Math.abs(te-en)<=a.EPSILON*Math.max(1,Math.abs(te),Math.abs(en))&&Math.abs(de-dn)<=a.EPSILON*Math.max(1,Math.abs(de),Math.abs(dn))&&Math.abs(ge-Ht)<=a.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Ht))&&Math.abs(Te-Vn)<=a.EPSILON*Math.max(1,Math.abs(Te),Math.abs(Vn))&&Math.abs(Ve-Rn)<=a.EPSILON*Math.max(1,Math.abs(Ve),Math.abs(Rn))&&Math.abs(Oe-xn)<=a.EPSILON*Math.max(1,Math.abs(Oe),Math.abs(xn))&&Math.abs(Ne-hn)<=a.EPSILON*Math.max(1,Math.abs(Ne),Math.abs(hn))&&Math.abs(st-si)<=a.EPSILON*Math.max(1,Math.abs(st),Math.abs(si))},ae.sub=ae.mul=ae.ortho=ae.perspective=void 0;var a=function(b,O){if(b&&b.__esModule)return b;if(b===null||d(b)!=="object"&&typeof b!="function")return{default:b};var U=u(void 0);if(U&&U.has(b))return U.get(b);var D={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in b)if(W!=="default"&&Object.prototype.hasOwnProperty.call(b,W)){var K=B?Object.getOwnPropertyDescriptor(b,W):null;K&&(K.get||K.set)?Object.defineProperty(D,W,K):D[W]=b[W]}return D.default=b,U&&U.set(b,D),D}(M());function u(b){if(typeof WeakMap!="function")return null;var O=new WeakMap,U=new WeakMap;return(u=function(D){return D?U:O})(b)}function p(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function _(b,O,U){var D=O[0],B=O[1],W=O[2],K=O[3],J=O[4],se=O[5],oe=O[6],te=O[7],de=O[8],ge=O[9],Te=O[10],Ve=O[11],Oe=O[12],Ne=O[13],st=O[14],ke=O[15],et=U[0],ct=U[1],dt=U[2],xt=U[3];return b[0]=et*D+ct*J+dt*de+xt*Oe,b[1]=et*B+ct*se+dt*ge+xt*Ne,b[2]=et*W+ct*oe+dt*Te+xt*st,b[3]=et*K+ct*te+dt*Ve+xt*ke,b[4]=(et=U[4])*D+(ct=U[5])*J+(dt=U[6])*de+(xt=U[7])*Oe,b[5]=et*B+ct*se+dt*ge+xt*Ne,b[6]=et*W+ct*oe+dt*Te+xt*st,b[7]=et*K+ct*te+dt*Ve+xt*ke,b[8]=(et=U[8])*D+(ct=U[9])*J+(dt=U[10])*de+(xt=U[11])*Oe,b[9]=et*B+ct*se+dt*ge+xt*Ne,b[10]=et*W+ct*oe+dt*Te+xt*st,b[11]=et*K+ct*te+dt*Ve+xt*ke,b[12]=(et=U[12])*D+(ct=U[13])*J+(dt=U[14])*de+(xt=U[15])*Oe,b[13]=et*B+ct*se+dt*ge+xt*Ne,b[14]=et*W+ct*oe+dt*Te+xt*st,b[15]=et*K+ct*te+dt*Ve+xt*ke,b}function m(b,O,U){var D=O[0],B=O[1],W=O[2],K=O[3],J=D+D,se=B+B,oe=W+W,te=D*J,de=D*se,ge=D*oe,Te=B*se,Ve=B*oe,Oe=W*oe,Ne=K*J,st=K*se,ke=K*oe;return b[0]=1-(Te+Oe),b[1]=de+ke,b[2]=ge-st,b[3]=0,b[4]=de-ke,b[5]=1-(te+Oe),b[6]=Ve+Ne,b[7]=0,b[8]=ge+st,b[9]=Ve-Ne,b[10]=1-(te+Te),b[11]=0,b[12]=U[0],b[13]=U[1],b[14]=U[2],b[15]=1,b}function x(b,O){var U=O[4],D=O[5],B=O[6],W=O[8],K=O[9],J=O[10];return b[0]=Math.hypot(O[0],O[1],O[2]),b[1]=Math.hypot(U,D,B),b[2]=Math.hypot(W,K,J),b}function R(b,O,U,D,B){var W,K=1/Math.tan(O/2);return b[0]=K/U,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=K,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,B!=null&&B!==1/0?(b[10]=(B+D)*(W=1/(D-B)),b[14]=2*B*D*W):(b[10]=-1,b[14]=-2*D),b}function k(b,O,U,D,B,W,K){var J=1/(O-U),se=1/(D-B),oe=1/(W-K);return b[0]=-2*J,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*se,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*oe,b[11]=0,b[12]=(O+U)*J,b[13]=(B+D)*se,b[14]=(K+W)*oe,b[15]=1,b}function V(b,O,U){return b[0]=O[0]-U[0],b[1]=O[1]-U[1],b[2]=O[2]-U[2],b[3]=O[3]-U[3],b[4]=O[4]-U[4],b[5]=O[5]-U[5],b[6]=O[6]-U[6],b[7]=O[7]-U[7],b[8]=O[8]-U[8],b[9]=O[9]-U[9],b[10]=O[10]-U[10],b[11]=O[11]-U[11],b[12]=O[12]-U[12],b[13]=O[13]-U[13],b[14]=O[14]-U[14],b[15]=O[15]-U[15],b}return ae.perspective=R,ae.ortho=k,ae.mul=_,ae.sub=V,ae}var fe,ue={},Ee={};function We(){if(fe)return Ee;function d(B){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(W){return typeof W}:function(W){return W&&typeof Symbol=="function"&&W.constructor===Symbol&&W!==Symbol.prototype?"symbol":typeof W},d(B)}fe=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.create=p,Ee.clone=function(B){var W=new a.ARRAY_TYPE(3);return W[0]=B[0],W[1]=B[1],W[2]=B[2],W},Ee.length=_,Ee.fromValues=function(B,W,K){var J=new a.ARRAY_TYPE(3);return J[0]=B,J[1]=W,J[2]=K,J},Ee.copy=function(B,W){return B[0]=W[0],B[1]=W[1],B[2]=W[2],B},Ee.set=function(B,W,K,J){return B[0]=W,B[1]=K,B[2]=J,B},Ee.add=function(B,W,K){return B[0]=W[0]+K[0],B[1]=W[1]+K[1],B[2]=W[2]+K[2],B},Ee.subtract=m,Ee.multiply=x,Ee.divide=R,Ee.ceil=function(B,W){return B[0]=Math.ceil(W[0]),B[1]=Math.ceil(W[1]),B[2]=Math.ceil(W[2]),B},Ee.floor=function(B,W){return B[0]=Math.floor(W[0]),B[1]=Math.floor(W[1]),B[2]=Math.floor(W[2]),B},Ee.min=function(B,W,K){return B[0]=Math.min(W[0],K[0]),B[1]=Math.min(W[1],K[1]),B[2]=Math.min(W[2],K[2]),B},Ee.max=function(B,W,K){return B[0]=Math.max(W[0],K[0]),B[1]=Math.max(W[1],K[1]),B[2]=Math.max(W[2],K[2]),B},Ee.round=function(B,W){return B[0]=Math.round(W[0]),B[1]=Math.round(W[1]),B[2]=Math.round(W[2]),B},Ee.scale=function(B,W,K){return B[0]=W[0]*K,B[1]=W[1]*K,B[2]=W[2]*K,B},Ee.scaleAndAdd=function(B,W,K,J){return B[0]=W[0]+K[0]*J,B[1]=W[1]+K[1]*J,B[2]=W[2]+K[2]*J,B},Ee.distance=k,Ee.squaredDistance=V,Ee.squaredLength=b,Ee.negate=function(B,W){return B[0]=-W[0],B[1]=-W[1],B[2]=-W[2],B},Ee.inverse=function(B,W){return B[0]=1/W[0],B[1]=1/W[1],B[2]=1/W[2],B},Ee.normalize=function(B,W){var K=W[0],J=W[1],se=W[2],oe=K*K+J*J+se*se;return oe>0&&(oe=1/Math.sqrt(oe)),B[0]=W[0]*oe,B[1]=W[1]*oe,B[2]=W[2]*oe,B},Ee.dot=O,Ee.cross=function(B,W,K){var J=W[0],se=W[1],oe=W[2],te=K[0],de=K[1],ge=K[2];return B[0]=se*ge-oe*de,B[1]=oe*te-J*ge,B[2]=J*de-se*te,B},Ee.lerp=function(B,W,K,J){var se=W[0],oe=W[1],te=W[2];return B[0]=se+J*(K[0]-se),B[1]=oe+J*(K[1]-oe),B[2]=te+J*(K[2]-te),B},Ee.hermite=function(B,W,K,J,se,oe){var te=oe*oe,de=te*(2*oe-3)+1,ge=te*(oe-2)+oe,Te=te*(oe-1),Ve=te*(3-2*oe);return B[0]=W[0]*de+K[0]*ge+J[0]*Te+se[0]*Ve,B[1]=W[1]*de+K[1]*ge+J[1]*Te+se[1]*Ve,B[2]=W[2]*de+K[2]*ge+J[2]*Te+se[2]*Ve,B},Ee.bezier=function(B,W,K,J,se,oe){var te=1-oe,de=te*te,ge=oe*oe,Te=de*te,Ve=3*oe*de,Oe=3*ge*te,Ne=ge*oe;return B[0]=W[0]*Te+K[0]*Ve+J[0]*Oe+se[0]*Ne,B[1]=W[1]*Te+K[1]*Ve+J[1]*Oe+se[1]*Ne,B[2]=W[2]*Te+K[2]*Ve+J[2]*Oe+se[2]*Ne,B},Ee.random=function(B,W){W=W||1;var K=2*a.RANDOM()*Math.PI,J=2*a.RANDOM()-1,se=Math.sqrt(1-J*J)*W;return B[0]=Math.cos(K)*se,B[1]=Math.sin(K)*se,B[2]=J*W,B},Ee.transformMat4=function(B,W,K){var J=W[0],se=W[1],oe=W[2],te=K[3]*J+K[7]*se+K[11]*oe+K[15];return B[0]=(K[0]*J+K[4]*se+K[8]*oe+K[12])/(te=te||1),B[1]=(K[1]*J+K[5]*se+K[9]*oe+K[13])/te,B[2]=(K[2]*J+K[6]*se+K[10]*oe+K[14])/te,B},Ee.transformMat3=function(B,W,K){var J=W[0],se=W[1],oe=W[2];return B[0]=J*K[0]+se*K[3]+oe*K[6],B[1]=J*K[1]+se*K[4]+oe*K[7],B[2]=J*K[2]+se*K[5]+oe*K[8],B},Ee.transformQuat=function(B,W,K){var J=K[0],se=K[1],oe=K[2],te=W[0],de=W[1],ge=W[2],Te=se*ge-oe*de,Ve=oe*te-J*ge,Oe=J*de-se*te,Ne=se*Oe-oe*Ve,st=oe*Te-J*Oe,ke=J*Ve-se*Te,et=2*K[3];return Ve*=et,Oe*=et,st*=2,ke*=2,B[0]=te+(Te*=et)+(Ne*=2),B[1]=de+Ve+st,B[2]=ge+Oe+ke,B},Ee.rotateX=function(B,W,K,J){var se=[],oe=[];return se[0]=W[0]-K[0],se[1]=W[1]-K[1],se[2]=W[2]-K[2],oe[0]=se[0],oe[1]=se[1]*Math.cos(J)-se[2]*Math.sin(J),oe[2]=se[1]*Math.sin(J)+se[2]*Math.cos(J),B[0]=oe[0]+K[0],B[1]=oe[1]+K[1],B[2]=oe[2]+K[2],B},Ee.rotateY=function(B,W,K,J){var se=[],oe=[];return se[0]=W[0]-K[0],se[1]=W[1]-K[1],se[2]=W[2]-K[2],oe[0]=se[2]*Math.sin(J)+se[0]*Math.cos(J),oe[1]=se[1],oe[2]=se[2]*Math.cos(J)-se[0]*Math.sin(J),B[0]=oe[0]+K[0],B[1]=oe[1]+K[1],B[2]=oe[2]+K[2],B},Ee.rotateZ=function(B,W,K,J){var se=[],oe=[];return se[0]=W[0]-K[0],se[1]=W[1]-K[1],se[2]=W[2]-K[2],oe[0]=se[0]*Math.cos(J)-se[1]*Math.sin(J),oe[1]=se[0]*Math.sin(J)+se[1]*Math.cos(J),oe[2]=se[2],B[0]=oe[0]+K[0],B[1]=oe[1]+K[1],B[2]=oe[2]+K[2],B},Ee.angle=function(B,W){var K=B[0],J=B[1],se=B[2],oe=W[0],te=W[1],de=W[2],ge=Math.sqrt(K*K+J*J+se*se)*Math.sqrt(oe*oe+te*te+de*de),Te=ge&&O(B,W)/ge;return Math.acos(Math.min(Math.max(Te,-1),1))},Ee.zero=function(B){return B[0]=0,B[1]=0,B[2]=0,B},Ee.str=function(B){return"vec3("+B[0]+", "+B[1]+", "+B[2]+")"},Ee.exactEquals=function(B,W){return B[0]===W[0]&&B[1]===W[1]&&B[2]===W[2]},Ee.equals=function(B,W){var K=B[0],J=B[1],se=B[2],oe=W[0],te=W[1],de=W[2];return Math.abs(K-oe)<=a.EPSILON*Math.max(1,Math.abs(K),Math.abs(oe))&&Math.abs(J-te)<=a.EPSILON*Math.max(1,Math.abs(J),Math.abs(te))&&Math.abs(se-de)<=a.EPSILON*Math.max(1,Math.abs(se),Math.abs(de))},Ee.forEach=Ee.sqrLen=Ee.len=Ee.sqrDist=Ee.dist=Ee.div=Ee.mul=Ee.sub=void 0;var a=function(B,W){if(B&&B.__esModule)return B;if(B===null||d(B)!=="object"&&typeof B!="function")return{default:B};var K=u(void 0);if(K&&K.has(B))return K.get(B);var J={},se=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var oe in B)if(oe!=="default"&&Object.prototype.hasOwnProperty.call(B,oe)){var te=se?Object.getOwnPropertyDescriptor(B,oe):null;te&&(te.get||te.set)?Object.defineProperty(J,oe,te):J[oe]=B[oe]}return J.default=B,K&&K.set(B,J),J}(M());function u(B){if(typeof WeakMap!="function")return null;var W=new WeakMap,K=new WeakMap;return(u=function(J){return J?K:W})(B)}function p(){var B=new a.ARRAY_TYPE(3);return a.ARRAY_TYPE!=Float32Array&&(B[0]=0,B[1]=0,B[2]=0),B}function _(B){return Math.hypot(B[0],B[1],B[2])}function m(B,W,K){return B[0]=W[0]-K[0],B[1]=W[1]-K[1],B[2]=W[2]-K[2],B}function x(B,W,K){return B[0]=W[0]*K[0],B[1]=W[1]*K[1],B[2]=W[2]*K[2],B}function R(B,W,K){return B[0]=W[0]/K[0],B[1]=W[1]/K[1],B[2]=W[2]/K[2],B}function k(B,W){return Math.hypot(W[0]-B[0],W[1]-B[1],W[2]-B[2])}function V(B,W){var K=W[0]-B[0],J=W[1]-B[1],se=W[2]-B[2];return K*K+J*J+se*se}function b(B){var W=B[0],K=B[1],J=B[2];return W*W+K*K+J*J}function O(B,W){return B[0]*W[0]+B[1]*W[1]+B[2]*W[2]}Ee.sub=m,Ee.mul=x,Ee.div=R,Ee.dist=k,Ee.sqrDist=V,Ee.len=_,Ee.sqrLen=b;var U,D=(U=p(),function(B,W,K,J,se,oe){var te,de;for(W||(W=3),K||(K=0),de=J?Math.min(J*W+K,B.length):B.length,te=K;te<de;te+=W)U[0]=B[te],U[1]=B[te+1],U[2]=B[te+2],se(U,U,oe),B[te]=U[0],B[te+1]=U[1],B[te+2]=U[2];return B});return Ee.forEach=D,Ee}var rt,tt,Ye={};function qe(){if(rt)return Ye;function d(D){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(D)}rt=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=p,Ye.clone=function(D){var B=new a.ARRAY_TYPE(4);return B[0]=D[0],B[1]=D[1],B[2]=D[2],B[3]=D[3],B},Ye.fromValues=function(D,B,W,K){var J=new a.ARRAY_TYPE(4);return J[0]=D,J[1]=B,J[2]=W,J[3]=K,J},Ye.copy=function(D,B){return D[0]=B[0],D[1]=B[1],D[2]=B[2],D[3]=B[3],D},Ye.set=function(D,B,W,K,J){return D[0]=B,D[1]=W,D[2]=K,D[3]=J,D},Ye.add=function(D,B,W){return D[0]=B[0]+W[0],D[1]=B[1]+W[1],D[2]=B[2]+W[2],D[3]=B[3]+W[3],D},Ye.subtract=_,Ye.multiply=m,Ye.divide=x,Ye.ceil=function(D,B){return D[0]=Math.ceil(B[0]),D[1]=Math.ceil(B[1]),D[2]=Math.ceil(B[2]),D[3]=Math.ceil(B[3]),D},Ye.floor=function(D,B){return D[0]=Math.floor(B[0]),D[1]=Math.floor(B[1]),D[2]=Math.floor(B[2]),D[3]=Math.floor(B[3]),D},Ye.min=function(D,B,W){return D[0]=Math.min(B[0],W[0]),D[1]=Math.min(B[1],W[1]),D[2]=Math.min(B[2],W[2]),D[3]=Math.min(B[3],W[3]),D},Ye.max=function(D,B,W){return D[0]=Math.max(B[0],W[0]),D[1]=Math.max(B[1],W[1]),D[2]=Math.max(B[2],W[2]),D[3]=Math.max(B[3],W[3]),D},Ye.round=function(D,B){return D[0]=Math.round(B[0]),D[1]=Math.round(B[1]),D[2]=Math.round(B[2]),D[3]=Math.round(B[3]),D},Ye.scale=function(D,B,W){return D[0]=B[0]*W,D[1]=B[1]*W,D[2]=B[2]*W,D[3]=B[3]*W,D},Ye.scaleAndAdd=function(D,B,W,K){return D[0]=B[0]+W[0]*K,D[1]=B[1]+W[1]*K,D[2]=B[2]+W[2]*K,D[3]=B[3]+W[3]*K,D},Ye.distance=R,Ye.squaredDistance=k,Ye.length=V,Ye.squaredLength=b,Ye.negate=function(D,B){return D[0]=-B[0],D[1]=-B[1],D[2]=-B[2],D[3]=-B[3],D},Ye.inverse=function(D,B){return D[0]=1/B[0],D[1]=1/B[1],D[2]=1/B[2],D[3]=1/B[3],D},Ye.normalize=function(D,B){var W=B[0],K=B[1],J=B[2],se=B[3],oe=W*W+K*K+J*J+se*se;return oe>0&&(oe=1/Math.sqrt(oe)),D[0]=W*oe,D[1]=K*oe,D[2]=J*oe,D[3]=se*oe,D},Ye.dot=function(D,B){return D[0]*B[0]+D[1]*B[1]+D[2]*B[2]+D[3]*B[3]},Ye.cross=function(D,B,W,K){var J=W[0]*K[1]-W[1]*K[0],se=W[0]*K[2]-W[2]*K[0],oe=W[0]*K[3]-W[3]*K[0],te=W[1]*K[2]-W[2]*K[1],de=W[1]*K[3]-W[3]*K[1],ge=W[2]*K[3]-W[3]*K[2],Te=B[0],Ve=B[1],Oe=B[2],Ne=B[3];return D[0]=Ve*ge-Oe*de+Ne*te,D[1]=-Te*ge+Oe*oe-Ne*se,D[2]=Te*de-Ve*oe+Ne*J,D[3]=-Te*te+Ve*se-Oe*J,D},Ye.lerp=function(D,B,W,K){var J=B[0],se=B[1],oe=B[2],te=B[3];return D[0]=J+K*(W[0]-J),D[1]=se+K*(W[1]-se),D[2]=oe+K*(W[2]-oe),D[3]=te+K*(W[3]-te),D},Ye.random=function(D,B){var W,K,J,se,oe,te;B=B||1;do oe=(W=2*a.RANDOM()-1)*W+(K=2*a.RANDOM()-1)*K;while(oe>=1);do te=(J=2*a.RANDOM()-1)*J+(se=2*a.RANDOM()-1)*se;while(te>=1);var de=Math.sqrt((1-oe)/te);return D[0]=B*W,D[1]=B*K,D[2]=B*J*de,D[3]=B*se*de,D},Ye.transformMat4=function(D,B,W){var K=B[0],J=B[1],se=B[2],oe=B[3];return D[0]=W[0]*K+W[4]*J+W[8]*se+W[12]*oe,D[1]=W[1]*K+W[5]*J+W[9]*se+W[13]*oe,D[2]=W[2]*K+W[6]*J+W[10]*se+W[14]*oe,D[3]=W[3]*K+W[7]*J+W[11]*se+W[15]*oe,D},Ye.transformQuat=function(D,B,W){var K=B[0],J=B[1],se=B[2],oe=W[0],te=W[1],de=W[2],ge=W[3],Te=ge*K+te*se-de*J,Ve=ge*J+de*K-oe*se,Oe=ge*se+oe*J-te*K,Ne=-oe*K-te*J-de*se;return D[0]=Te*ge+Ne*-oe+Ve*-de-Oe*-te,D[1]=Ve*ge+Ne*-te+Oe*-oe-Te*-de,D[2]=Oe*ge+Ne*-de+Te*-te-Ve*-oe,D[3]=B[3],D},Ye.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=0,D},Ye.str=function(D){return"vec4("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+")"},Ye.exactEquals=function(D,B){return D[0]===B[0]&&D[1]===B[1]&&D[2]===B[2]&&D[3]===B[3]},Ye.equals=function(D,B){var W=D[0],K=D[1],J=D[2],se=D[3],oe=B[0],te=B[1],de=B[2],ge=B[3];return Math.abs(W-oe)<=a.EPSILON*Math.max(1,Math.abs(W),Math.abs(oe))&&Math.abs(K-te)<=a.EPSILON*Math.max(1,Math.abs(K),Math.abs(te))&&Math.abs(J-de)<=a.EPSILON*Math.max(1,Math.abs(J),Math.abs(de))&&Math.abs(se-ge)<=a.EPSILON*Math.max(1,Math.abs(se),Math.abs(ge))},Ye.forEach=Ye.sqrLen=Ye.len=Ye.sqrDist=Ye.dist=Ye.div=Ye.mul=Ye.sub=void 0;var a=function(D,B){if(D&&D.__esModule)return D;if(D===null||d(D)!=="object"&&typeof D!="function")return{default:D};var W=u(void 0);if(W&&W.has(D))return W.get(D);var K={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var se in D)if(se!=="default"&&Object.prototype.hasOwnProperty.call(D,se)){var oe=J?Object.getOwnPropertyDescriptor(D,se):null;oe&&(oe.get||oe.set)?Object.defineProperty(K,se,oe):K[se]=D[se]}return K.default=D,W&&W.set(D,K),K}(M());function u(D){if(typeof WeakMap!="function")return null;var B=new WeakMap,W=new WeakMap;return(u=function(K){return K?W:B})(D)}function p(){var D=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[3]=0),D}function _(D,B,W){return D[0]=B[0]-W[0],D[1]=B[1]-W[1],D[2]=B[2]-W[2],D[3]=B[3]-W[3],D}function m(D,B,W){return D[0]=B[0]*W[0],D[1]=B[1]*W[1],D[2]=B[2]*W[2],D[3]=B[3]*W[3],D}function x(D,B,W){return D[0]=B[0]/W[0],D[1]=B[1]/W[1],D[2]=B[2]/W[2],D[3]=B[3]/W[3],D}function R(D,B){return Math.hypot(B[0]-D[0],B[1]-D[1],B[2]-D[2],B[3]-D[3])}function k(D,B){var W=B[0]-D[0],K=B[1]-D[1],J=B[2]-D[2],se=B[3]-D[3];return W*W+K*K+J*J+se*se}function V(D){return Math.hypot(D[0],D[1],D[2],D[3])}function b(D){var B=D[0],W=D[1],K=D[2],J=D[3];return B*B+W*W+K*K+J*J}Ye.sub=_,Ye.mul=m,Ye.div=x,Ye.dist=R,Ye.sqrDist=k,Ye.len=V,Ye.sqrLen=b;var O,U=(O=p(),function(D,B,W,K,J,se){var oe,te;for(B||(B=4),W||(W=0),te=K?Math.min(K*B+W,D.length):D.length,oe=W;oe<te;oe+=B)O[0]=D[oe],O[1]=D[oe+1],O[2]=D[oe+2],O[3]=D[oe+3],J(O,O,se),D[oe]=O[0],D[oe+1]=O[1],D[oe+2]=O[2],D[oe+3]=O[3];return D});return Ye.forEach=U,Ye}function ft(){if(tt)return ue;function d(ke){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(et){return typeof et}:function(et){return et&&typeof Symbol=="function"&&et.constructor===Symbol&&et!==Symbol.prototype?"symbol":typeof et},d(ke)}tt=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=R,ue.identity=function(ke){return ke[0]=0,ke[1]=0,ke[2]=0,ke[3]=1,ke},ue.setAxisAngle=k,ue.getAxisAngle=function(ke,et){var ct=2*Math.acos(et[3]),dt=Math.sin(ct/2);return dt>a.EPSILON?(ke[0]=et[0]/dt,ke[1]=et[1]/dt,ke[2]=et[2]/dt):(ke[0]=1,ke[1]=0,ke[2]=0),ct},ue.getAngle=function(ke,et){var ct=W(ke,et);return Math.acos(2*ct*ct-1)},ue.multiply=V,ue.rotateX=function(ke,et,ct){ct*=.5;var dt=et[0],xt=et[1],Rt=et[2],It=et[3],Et=Math.sin(ct),en=Math.cos(ct);return ke[0]=dt*en+It*Et,ke[1]=xt*en+Rt*Et,ke[2]=Rt*en-xt*Et,ke[3]=It*en-dt*Et,ke},ue.rotateY=function(ke,et,ct){ct*=.5;var dt=et[0],xt=et[1],Rt=et[2],It=et[3],Et=Math.sin(ct),en=Math.cos(ct);return ke[0]=dt*en-Rt*Et,ke[1]=xt*en+It*Et,ke[2]=Rt*en+dt*Et,ke[3]=It*en-xt*Et,ke},ue.rotateZ=function(ke,et,ct){ct*=.5;var dt=et[0],xt=et[1],Rt=et[2],It=et[3],Et=Math.sin(ct),en=Math.cos(ct);return ke[0]=dt*en+xt*Et,ke[1]=xt*en-dt*Et,ke[2]=Rt*en+It*Et,ke[3]=It*en-Rt*Et,ke},ue.calculateW=function(ke,et){var ct=et[0],dt=et[1],xt=et[2];return ke[0]=ct,ke[1]=dt,ke[2]=xt,ke[3]=Math.sqrt(Math.abs(1-ct*ct-dt*dt-xt*xt)),ke},ue.exp=b,ue.ln=O,ue.pow=function(ke,et,ct){return O(ke,et),B(ke,ke,ct),b(ke,ke),ke},ue.slerp=U,ue.random=function(ke){var et=a.RANDOM(),ct=a.RANDOM(),dt=a.RANDOM(),xt=Math.sqrt(1-et),Rt=Math.sqrt(et);return ke[0]=xt*Math.sin(2*Math.PI*ct),ke[1]=xt*Math.cos(2*Math.PI*ct),ke[2]=Rt*Math.sin(2*Math.PI*dt),ke[3]=Rt*Math.cos(2*Math.PI*dt),ke},ue.invert=function(ke,et){var ct=et[0],dt=et[1],xt=et[2],Rt=et[3],It=ct*ct+dt*dt+xt*xt+Rt*Rt,Et=It?1/It:0;return ke[0]=-ct*Et,ke[1]=-dt*Et,ke[2]=-xt*Et,ke[3]=Rt*Et,ke},ue.conjugate=function(ke,et){return ke[0]=-et[0],ke[1]=-et[1],ke[2]=-et[2],ke[3]=et[3],ke},ue.fromMat3=D,ue.fromEuler=function(ke,et,ct,dt){var xt=.5*Math.PI/180;et*=xt,ct*=xt,dt*=xt;var Rt=Math.sin(et),It=Math.cos(et),Et=Math.sin(ct),en=Math.cos(ct),dn=Math.sin(dt),Ht=Math.cos(dt);return ke[0]=Rt*en*Ht-It*Et*dn,ke[1]=It*Et*Ht+Rt*en*dn,ke[2]=It*en*dn-Rt*Et*Ht,ke[3]=It*en*Ht+Rt*Et*dn,ke},ue.str=function(ke){return"quat("+ke[0]+", "+ke[1]+", "+ke[2]+", "+ke[3]+")"},ue.setAxes=ue.sqlerp=ue.rotationTo=ue.equals=ue.exactEquals=ue.normalize=ue.sqrLen=ue.squaredLength=ue.len=ue.length=ue.lerp=ue.dot=ue.scale=ue.mul=ue.add=ue.set=ue.copy=ue.fromValues=ue.clone=void 0;var a=x(M()),u=x(le()),p=x(We()),_=x(qe());function m(ke){if(typeof WeakMap!="function")return null;var et=new WeakMap,ct=new WeakMap;return(m=function(dt){return dt?ct:et})(ke)}function x(ke,et){if(ke&&ke.__esModule)return ke;if(ke===null||d(ke)!=="object"&&typeof ke!="function")return{default:ke};var ct=m(et);if(ct&&ct.has(ke))return ct.get(ke);var dt={},xt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Rt in ke)if(Rt!=="default"&&Object.prototype.hasOwnProperty.call(ke,Rt)){var It=xt?Object.getOwnPropertyDescriptor(ke,Rt):null;It&&(It.get||It.set)?Object.defineProperty(dt,Rt,It):dt[Rt]=ke[Rt]}return dt.default=ke,ct&&ct.set(ke,dt),dt}function R(){var ke=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(ke[0]=0,ke[1]=0,ke[2]=0),ke[3]=1,ke}function k(ke,et,ct){ct*=.5;var dt=Math.sin(ct);return ke[0]=dt*et[0],ke[1]=dt*et[1],ke[2]=dt*et[2],ke[3]=Math.cos(ct),ke}function V(ke,et,ct){var dt=et[0],xt=et[1],Rt=et[2],It=et[3],Et=ct[0],en=ct[1],dn=ct[2],Ht=ct[3];return ke[0]=dt*Ht+It*Et+xt*dn-Rt*en,ke[1]=xt*Ht+It*en+Rt*Et-dt*dn,ke[2]=Rt*Ht+It*dn+dt*en-xt*Et,ke[3]=It*Ht-dt*Et-xt*en-Rt*dn,ke}function b(ke,et){var ct=et[0],dt=et[1],xt=et[2],Rt=et[3],It=Math.sqrt(ct*ct+dt*dt+xt*xt),Et=Math.exp(Rt),en=It>0?Et*Math.sin(It)/It:0;return ke[0]=ct*en,ke[1]=dt*en,ke[2]=xt*en,ke[3]=Et*Math.cos(It),ke}function O(ke,et){var ct=et[0],dt=et[1],xt=et[2],Rt=et[3],It=Math.sqrt(ct*ct+dt*dt+xt*xt),Et=It>0?Math.atan2(It,Rt)/It:0;return ke[0]=ct*Et,ke[1]=dt*Et,ke[2]=xt*Et,ke[3]=.5*Math.log(ct*ct+dt*dt+xt*xt+Rt*Rt),ke}function U(ke,et,ct,dt){var xt,Rt,It,Et,en,dn=et[0],Ht=et[1],Vn=et[2],Rn=et[3],xn=ct[0],hn=ct[1],si=ct[2],Nn=ct[3];return(Rt=dn*xn+Ht*hn+Vn*si+Rn*Nn)<0&&(Rt=-Rt,xn=-xn,hn=-hn,si=-si,Nn=-Nn),1-Rt>a.EPSILON?(xt=Math.acos(Rt),It=Math.sin(xt),Et=Math.sin((1-dt)*xt)/It,en=Math.sin(dt*xt)/It):(Et=1-dt,en=dt),ke[0]=Et*dn+en*xn,ke[1]=Et*Ht+en*hn,ke[2]=Et*Vn+en*si,ke[3]=Et*Rn+en*Nn,ke}function D(ke,et){var ct,dt=et[0]+et[4]+et[8];if(dt>0)ct=Math.sqrt(dt+1),ke[3]=.5*ct,ke[0]=(et[5]-et[7])*(ct=.5/ct),ke[1]=(et[6]-et[2])*ct,ke[2]=(et[1]-et[3])*ct;else{var xt=0;et[4]>et[0]&&(xt=1),et[8]>et[3*xt+xt]&&(xt=2);var Rt=(xt+1)%3,It=(xt+2)%3;ct=Math.sqrt(et[3*xt+xt]-et[3*Rt+Rt]-et[3*It+It]+1),ke[xt]=.5*ct,ke[3]=(et[3*Rt+It]-et[3*It+Rt])*(ct=.5/ct),ke[Rt]=(et[3*Rt+xt]+et[3*xt+Rt])*ct,ke[It]=(et[3*It+xt]+et[3*xt+It])*ct}return ke}ue.clone=_.clone,ue.fromValues=_.fromValues,ue.copy=_.copy,ue.set=_.set,ue.add=_.add,ue.mul=V;var B=_.scale;ue.scale=B;var W=_.dot;ue.dot=W,ue.lerp=_.lerp;var K=_.length;ue.length=K,ue.len=K;var J=_.squaredLength;ue.squaredLength=J,ue.sqrLen=J;var se=_.normalize;ue.normalize=se,ue.exactEquals=_.exactEquals,ue.equals=_.equals;var oe,te,de,ge=(oe=p.create(),te=p.fromValues(1,0,0),de=p.fromValues(0,1,0),function(ke,et,ct){var dt=p.dot(et,ct);return dt<-.999999?(p.cross(oe,te,et),p.len(oe)<1e-6&&p.cross(oe,de,et),p.normalize(oe,oe),k(ke,oe,Math.PI),ke):dt>.999999?(ke[0]=0,ke[1]=0,ke[2]=0,ke[3]=1,ke):(p.cross(oe,et,ct),ke[0]=oe[0],ke[1]=oe[1],ke[2]=oe[2],ke[3]=1+dt,se(ke,ke))});ue.rotationTo=ge;var Te,Ve,Oe=(Te=R(),Ve=R(),function(ke,et,ct,dt,xt,Rt){return U(Te,et,xt,Rt),U(Ve,ct,dt,Rt),U(ke,Te,Ve,2*Rt*(1-Rt)),ke});ue.sqlerp=Oe;var Ne,st=(Ne=u.create(),function(ke,et,ct,dt){return Ne[0]=ct[0],Ne[3]=ct[1],Ne[6]=ct[2],Ne[1]=dt[0],Ne[4]=dt[1],Ne[7]=dt[2],Ne[2]=-et[0],Ne[5]=-et[1],Ne[8]=-et[2],se(ke,D(ke,Ne))});return ue.setAxes=st,ue}var Me,$e={};function ut(){if(Me)return $e;function d(U){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},d(U)}Me=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var U=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0,U[4]=0,U[5]=0,U[6]=0,U[7]=0),U[3]=1,U},$e.clone=function(U){var D=new a.ARRAY_TYPE(8);return D[0]=U[0],D[1]=U[1],D[2]=U[2],D[3]=U[3],D[4]=U[4],D[5]=U[5],D[6]=U[6],D[7]=U[7],D},$e.fromValues=function(U,D,B,W,K,J,se,oe){var te=new a.ARRAY_TYPE(8);return te[0]=U,te[1]=D,te[2]=B,te[3]=W,te[4]=K,te[5]=J,te[6]=se,te[7]=oe,te},$e.fromRotationTranslationValues=function(U,D,B,W,K,J,se){var oe=new a.ARRAY_TYPE(8);oe[0]=U,oe[1]=D,oe[2]=B,oe[3]=W;var te=.5*K,de=.5*J,ge=.5*se;return oe[4]=te*W+de*B-ge*D,oe[5]=de*W+ge*U-te*B,oe[6]=ge*W+te*D-de*U,oe[7]=-te*U-de*D-ge*B,oe},$e.fromRotationTranslation=x,$e.fromTranslation=function(U,D){return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=.5*D[0],U[5]=.5*D[1],U[6]=.5*D[2],U[7]=0,U},$e.fromRotation=function(U,D){return U[0]=D[0],U[1]=D[1],U[2]=D[2],U[3]=D[3],U[4]=0,U[5]=0,U[6]=0,U[7]=0,U},$e.fromMat4=function(U,D){var B=u.create();p.getRotation(B,D);var W=new a.ARRAY_TYPE(3);return p.getTranslation(W,D),x(U,B,W),U},$e.copy=R,$e.identity=function(U){return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=0,U[5]=0,U[6]=0,U[7]=0,U},$e.set=function(U,D,B,W,K,J,se,oe,te){return U[0]=D,U[1]=B,U[2]=W,U[3]=K,U[4]=J,U[5]=se,U[6]=oe,U[7]=te,U},$e.getDual=function(U,D){return U[0]=D[4],U[1]=D[5],U[2]=D[6],U[3]=D[7],U},$e.setDual=function(U,D){return U[4]=D[0],U[5]=D[1],U[6]=D[2],U[7]=D[3],U},$e.getTranslation=function(U,D){var B=D[4],W=D[5],K=D[6],J=D[7],se=-D[0],oe=-D[1],te=-D[2],de=D[3];return U[0]=2*(B*de+J*se+W*te-K*oe),U[1]=2*(W*de+J*oe+K*se-B*te),U[2]=2*(K*de+J*te+B*oe-W*se),U},$e.translate=function(U,D,B){var W=D[0],K=D[1],J=D[2],se=D[3],oe=.5*B[0],te=.5*B[1],de=.5*B[2],ge=D[4],Te=D[5],Ve=D[6],Oe=D[7];return U[0]=W,U[1]=K,U[2]=J,U[3]=se,U[4]=se*oe+K*de-J*te+ge,U[5]=se*te+J*oe-W*de+Te,U[6]=se*de+W*te-K*oe+Ve,U[7]=-W*oe-K*te-J*de+Oe,U},$e.rotateX=function(U,D,B){var W=-D[0],K=-D[1],J=-D[2],se=D[3],oe=D[4],te=D[5],de=D[6],ge=D[7],Te=oe*se+ge*W+te*J-de*K,Ve=te*se+ge*K+de*W-oe*J,Oe=de*se+ge*J+oe*K-te*W,Ne=ge*se-oe*W-te*K-de*J;return u.rotateX(U,D,B),U[4]=Te*(se=U[3])+Ne*(W=U[0])+Ve*(J=U[2])-Oe*(K=U[1]),U[5]=Ve*se+Ne*K+Oe*W-Te*J,U[6]=Oe*se+Ne*J+Te*K-Ve*W,U[7]=Ne*se-Te*W-Ve*K-Oe*J,U},$e.rotateY=function(U,D,B){var W=-D[0],K=-D[1],J=-D[2],se=D[3],oe=D[4],te=D[5],de=D[6],ge=D[7],Te=oe*se+ge*W+te*J-de*K,Ve=te*se+ge*K+de*W-oe*J,Oe=de*se+ge*J+oe*K-te*W,Ne=ge*se-oe*W-te*K-de*J;return u.rotateY(U,D,B),U[4]=Te*(se=U[3])+Ne*(W=U[0])+Ve*(J=U[2])-Oe*(K=U[1]),U[5]=Ve*se+Ne*K+Oe*W-Te*J,U[6]=Oe*se+Ne*J+Te*K-Ve*W,U[7]=Ne*se-Te*W-Ve*K-Oe*J,U},$e.rotateZ=function(U,D,B){var W=-D[0],K=-D[1],J=-D[2],se=D[3],oe=D[4],te=D[5],de=D[6],ge=D[7],Te=oe*se+ge*W+te*J-de*K,Ve=te*se+ge*K+de*W-oe*J,Oe=de*se+ge*J+oe*K-te*W,Ne=ge*se-oe*W-te*K-de*J;return u.rotateZ(U,D,B),U[4]=Te*(se=U[3])+Ne*(W=U[0])+Ve*(J=U[2])-Oe*(K=U[1]),U[5]=Ve*se+Ne*K+Oe*W-Te*J,U[6]=Oe*se+Ne*J+Te*K-Ve*W,U[7]=Ne*se-Te*W-Ve*K-Oe*J,U},$e.rotateByQuatAppend=function(U,D,B){var W=B[0],K=B[1],J=B[2],se=B[3],oe=D[0],te=D[1],de=D[2],ge=D[3];return U[0]=oe*se+ge*W+te*J-de*K,U[1]=te*se+ge*K+de*W-oe*J,U[2]=de*se+ge*J+oe*K-te*W,U[3]=ge*se-oe*W-te*K-de*J,U[4]=(oe=D[4])*se+(ge=D[7])*W+(te=D[5])*J-(de=D[6])*K,U[5]=te*se+ge*K+de*W-oe*J,U[6]=de*se+ge*J+oe*K-te*W,U[7]=ge*se-oe*W-te*K-de*J,U},$e.rotateByQuatPrepend=function(U,D,B){var W=D[0],K=D[1],J=D[2],se=D[3],oe=B[0],te=B[1],de=B[2],ge=B[3];return U[0]=W*ge+se*oe+K*de-J*te,U[1]=K*ge+se*te+J*oe-W*de,U[2]=J*ge+se*de+W*te-K*oe,U[3]=se*ge-W*oe-K*te-J*de,U[4]=W*(ge=B[7])+se*(oe=B[4])+K*(de=B[6])-J*(te=B[5]),U[5]=K*ge+se*te+J*oe-W*de,U[6]=J*ge+se*de+W*te-K*oe,U[7]=se*ge-W*oe-K*te-J*de,U},$e.rotateAroundAxis=function(U,D,B,W){if(Math.abs(W)<a.EPSILON)return R(U,D);var K=Math.hypot(B[0],B[1],B[2]);W*=.5;var J=Math.sin(W),se=J*B[0]/K,oe=J*B[1]/K,te=J*B[2]/K,de=Math.cos(W),ge=D[0],Te=D[1],Ve=D[2],Oe=D[3];U[0]=ge*de+Oe*se+Te*te-Ve*oe,U[1]=Te*de+Oe*oe+Ve*se-ge*te,U[2]=Ve*de+Oe*te+ge*oe-Te*se,U[3]=Oe*de-ge*se-Te*oe-Ve*te;var Ne=D[4],st=D[5],ke=D[6],et=D[7];return U[4]=Ne*de+et*se+st*te-ke*oe,U[5]=st*de+et*oe+ke*se-Ne*te,U[6]=ke*de+et*te+Ne*oe-st*se,U[7]=et*de-Ne*se-st*oe-ke*te,U},$e.add=function(U,D,B){return U[0]=D[0]+B[0],U[1]=D[1]+B[1],U[2]=D[2]+B[2],U[3]=D[3]+B[3],U[4]=D[4]+B[4],U[5]=D[5]+B[5],U[6]=D[6]+B[6],U[7]=D[7]+B[7],U},$e.multiply=k,$e.scale=function(U,D,B){return U[0]=D[0]*B,U[1]=D[1]*B,U[2]=D[2]*B,U[3]=D[3]*B,U[4]=D[4]*B,U[5]=D[5]*B,U[6]=D[6]*B,U[7]=D[7]*B,U},$e.lerp=function(U,D,B,W){var K=1-W;return V(D,B)<0&&(W=-W),U[0]=D[0]*K+B[0]*W,U[1]=D[1]*K+B[1]*W,U[2]=D[2]*K+B[2]*W,U[3]=D[3]*K+B[3]*W,U[4]=D[4]*K+B[4]*W,U[5]=D[5]*K+B[5]*W,U[6]=D[6]*K+B[6]*W,U[7]=D[7]*K+B[7]*W,U},$e.invert=function(U,D){var B=O(D);return U[0]=-D[0]/B,U[1]=-D[1]/B,U[2]=-D[2]/B,U[3]=D[3]/B,U[4]=-D[4]/B,U[5]=-D[5]/B,U[6]=-D[6]/B,U[7]=D[7]/B,U},$e.conjugate=function(U,D){return U[0]=-D[0],U[1]=-D[1],U[2]=-D[2],U[3]=D[3],U[4]=-D[4],U[5]=-D[5],U[6]=-D[6],U[7]=D[7],U},$e.normalize=function(U,D){var B=O(D);if(B>0){B=Math.sqrt(B);var W=D[0]/B,K=D[1]/B,J=D[2]/B,se=D[3]/B,oe=D[4],te=D[5],de=D[6],ge=D[7],Te=W*oe+K*te+J*de+se*ge;U[0]=W,U[1]=K,U[2]=J,U[3]=se,U[4]=(oe-W*Te)/B,U[5]=(te-K*Te)/B,U[6]=(de-J*Te)/B,U[7]=(ge-se*Te)/B}return U},$e.str=function(U){return"quat2("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+", "+U[4]+", "+U[5]+", "+U[6]+", "+U[7]+")"},$e.exactEquals=function(U,D){return U[0]===D[0]&&U[1]===D[1]&&U[2]===D[2]&&U[3]===D[3]&&U[4]===D[4]&&U[5]===D[5]&&U[6]===D[6]&&U[7]===D[7]},$e.equals=function(U,D){var B=U[0],W=U[1],K=U[2],J=U[3],se=U[4],oe=U[5],te=U[6],de=U[7],ge=D[0],Te=D[1],Ve=D[2],Oe=D[3],Ne=D[4],st=D[5],ke=D[6],et=D[7];return Math.abs(B-ge)<=a.EPSILON*Math.max(1,Math.abs(B),Math.abs(ge))&&Math.abs(W-Te)<=a.EPSILON*Math.max(1,Math.abs(W),Math.abs(Te))&&Math.abs(K-Ve)<=a.EPSILON*Math.max(1,Math.abs(K),Math.abs(Ve))&&Math.abs(J-Oe)<=a.EPSILON*Math.max(1,Math.abs(J),Math.abs(Oe))&&Math.abs(se-Ne)<=a.EPSILON*Math.max(1,Math.abs(se),Math.abs(Ne))&&Math.abs(oe-st)<=a.EPSILON*Math.max(1,Math.abs(oe),Math.abs(st))&&Math.abs(te-ke)<=a.EPSILON*Math.max(1,Math.abs(te),Math.abs(ke))&&Math.abs(de-et)<=a.EPSILON*Math.max(1,Math.abs(de),Math.abs(et))},$e.sqrLen=$e.squaredLength=$e.len=$e.length=$e.dot=$e.mul=$e.setReal=$e.getReal=void 0;var a=m(M()),u=m(ft()),p=m(pe());function _(U){if(typeof WeakMap!="function")return null;var D=new WeakMap,B=new WeakMap;return(_=function(W){return W?B:D})(U)}function m(U,D){if(U&&U.__esModule)return U;if(U===null||d(U)!=="object"&&typeof U!="function")return{default:U};var B=_(D);if(B&&B.has(U))return B.get(U);var W={},K=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in U)if(J!=="default"&&Object.prototype.hasOwnProperty.call(U,J)){var se=K?Object.getOwnPropertyDescriptor(U,J):null;se&&(se.get||se.set)?Object.defineProperty(W,J,se):W[J]=U[J]}return W.default=U,B&&B.set(U,W),W}function x(U,D,B){var W=.5*B[0],K=.5*B[1],J=.5*B[2],se=D[0],oe=D[1],te=D[2],de=D[3];return U[0]=se,U[1]=oe,U[2]=te,U[3]=de,U[4]=W*de+K*te-J*oe,U[5]=K*de+J*se-W*te,U[6]=J*de+W*oe-K*se,U[7]=-W*se-K*oe-J*te,U}function R(U,D){return U[0]=D[0],U[1]=D[1],U[2]=D[2],U[3]=D[3],U[4]=D[4],U[5]=D[5],U[6]=D[6],U[7]=D[7],U}function k(U,D,B){var W=D[0],K=D[1],J=D[2],se=D[3],oe=B[4],te=B[5],de=B[6],ge=B[7],Te=D[4],Ve=D[5],Oe=D[6],Ne=D[7],st=B[0],ke=B[1],et=B[2],ct=B[3];return U[0]=W*ct+se*st+K*et-J*ke,U[1]=K*ct+se*ke+J*st-W*et,U[2]=J*ct+se*et+W*ke-K*st,U[3]=se*ct-W*st-K*ke-J*et,U[4]=W*ge+se*oe+K*de-J*te+Te*ct+Ne*st+Ve*et-Oe*ke,U[5]=K*ge+se*te+J*oe-W*de+Ve*ct+Ne*ke+Oe*st-Te*et,U[6]=J*ge+se*de+W*te-K*oe+Oe*ct+Ne*et+Te*ke-Ve*st,U[7]=se*ge-W*oe-K*te-J*de+Ne*ct-Te*st-Ve*ke-Oe*et,U}$e.getReal=u.copy,$e.setReal=u.copy,$e.mul=k;var V=u.dot;$e.dot=V;var b=u.length;$e.length=b,$e.len=b;var O=u.squaredLength;return $e.squaredLength=O,$e.sqrLen=O,$e}var Mt,Gt,Xt={};function Qe(){if(Mt)return Xt;function d(D){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(D)}Mt=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=p,Xt.clone=function(D){var B=new a.ARRAY_TYPE(2);return B[0]=D[0],B[1]=D[1],B},Xt.fromValues=function(D,B){var W=new a.ARRAY_TYPE(2);return W[0]=D,W[1]=B,W},Xt.copy=function(D,B){return D[0]=B[0],D[1]=B[1],D},Xt.set=function(D,B,W){return D[0]=B,D[1]=W,D},Xt.add=function(D,B,W){return D[0]=B[0]+W[0],D[1]=B[1]+W[1],D},Xt.subtract=_,Xt.multiply=m,Xt.divide=x,Xt.ceil=function(D,B){return D[0]=Math.ceil(B[0]),D[1]=Math.ceil(B[1]),D},Xt.floor=function(D,B){return D[0]=Math.floor(B[0]),D[1]=Math.floor(B[1]),D},Xt.min=function(D,B,W){return D[0]=Math.min(B[0],W[0]),D[1]=Math.min(B[1],W[1]),D},Xt.max=function(D,B,W){return D[0]=Math.max(B[0],W[0]),D[1]=Math.max(B[1],W[1]),D},Xt.round=function(D,B){return D[0]=Math.round(B[0]),D[1]=Math.round(B[1]),D},Xt.scale=function(D,B,W){return D[0]=B[0]*W,D[1]=B[1]*W,D},Xt.scaleAndAdd=function(D,B,W,K){return D[0]=B[0]+W[0]*K,D[1]=B[1]+W[1]*K,D},Xt.distance=R,Xt.squaredDistance=k,Xt.length=V,Xt.squaredLength=b,Xt.negate=function(D,B){return D[0]=-B[0],D[1]=-B[1],D},Xt.inverse=function(D,B){return D[0]=1/B[0],D[1]=1/B[1],D},Xt.normalize=function(D,B){var W=B[0],K=B[1],J=W*W+K*K;return J>0&&(J=1/Math.sqrt(J)),D[0]=B[0]*J,D[1]=B[1]*J,D},Xt.dot=function(D,B){return D[0]*B[0]+D[1]*B[1]},Xt.cross=function(D,B,W){var K=B[0]*W[1]-B[1]*W[0];return D[0]=D[1]=0,D[2]=K,D},Xt.lerp=function(D,B,W,K){var J=B[0],se=B[1];return D[0]=J+K*(W[0]-J),D[1]=se+K*(W[1]-se),D},Xt.random=function(D,B){B=B||1;var W=2*a.RANDOM()*Math.PI;return D[0]=Math.cos(W)*B,D[1]=Math.sin(W)*B,D},Xt.transformMat2=function(D,B,W){var K=B[0],J=B[1];return D[0]=W[0]*K+W[2]*J,D[1]=W[1]*K+W[3]*J,D},Xt.transformMat2d=function(D,B,W){var K=B[0],J=B[1];return D[0]=W[0]*K+W[2]*J+W[4],D[1]=W[1]*K+W[3]*J+W[5],D},Xt.transformMat3=function(D,B,W){var K=B[0],J=B[1];return D[0]=W[0]*K+W[3]*J+W[6],D[1]=W[1]*K+W[4]*J+W[7],D},Xt.transformMat4=function(D,B,W){var K=B[0],J=B[1];return D[0]=W[0]*K+W[4]*J+W[12],D[1]=W[1]*K+W[5]*J+W[13],D},Xt.rotate=function(D,B,W,K){var J=B[0]-W[0],se=B[1]-W[1],oe=Math.sin(K),te=Math.cos(K);return D[0]=J*te-se*oe+W[0],D[1]=J*oe+se*te+W[1],D},Xt.angle=function(D,B){var W=D[0],K=D[1],J=B[0],se=B[1],oe=Math.sqrt(W*W+K*K)*Math.sqrt(J*J+se*se);return Math.acos(Math.min(Math.max(oe&&(W*J+K*se)/oe,-1),1))},Xt.zero=function(D){return D[0]=0,D[1]=0,D},Xt.str=function(D){return"vec2("+D[0]+", "+D[1]+")"},Xt.exactEquals=function(D,B){return D[0]===B[0]&&D[1]===B[1]},Xt.equals=function(D,B){var W=D[0],K=D[1],J=B[0],se=B[1];return Math.abs(W-J)<=a.EPSILON*Math.max(1,Math.abs(W),Math.abs(J))&&Math.abs(K-se)<=a.EPSILON*Math.max(1,Math.abs(K),Math.abs(se))},Xt.forEach=Xt.sqrLen=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=Xt.len=void 0;var a=function(D,B){if(D&&D.__esModule)return D;if(D===null||d(D)!=="object"&&typeof D!="function")return{default:D};var W=u(void 0);if(W&&W.has(D))return W.get(D);var K={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var se in D)if(se!=="default"&&Object.prototype.hasOwnProperty.call(D,se)){var oe=J?Object.getOwnPropertyDescriptor(D,se):null;oe&&(oe.get||oe.set)?Object.defineProperty(K,se,oe):K[se]=D[se]}return K.default=D,W&&W.set(D,K),K}(M());function u(D){if(typeof WeakMap!="function")return null;var B=new WeakMap,W=new WeakMap;return(u=function(K){return K?W:B})(D)}function p(){var D=new a.ARRAY_TYPE(2);return a.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0),D}function _(D,B,W){return D[0]=B[0]-W[0],D[1]=B[1]-W[1],D}function m(D,B,W){return D[0]=B[0]*W[0],D[1]=B[1]*W[1],D}function x(D,B,W){return D[0]=B[0]/W[0],D[1]=B[1]/W[1],D}function R(D,B){return Math.hypot(B[0]-D[0],B[1]-D[1])}function k(D,B){var W=B[0]-D[0],K=B[1]-D[1];return W*W+K*K}function V(D){return Math.hypot(D[0],D[1])}function b(D){var B=D[0],W=D[1];return B*B+W*W}Xt.len=V,Xt.sub=_,Xt.mul=m,Xt.div=x,Xt.dist=R,Xt.sqrDist=k,Xt.sqrLen=b;var O,U=(O=p(),function(D,B,W,K,J,se){var oe,te;for(B||(B=2),W||(W=0),te=K?Math.min(K*B+W,D.length):D.length,oe=W;oe<te;oe+=B)O[0]=D[oe],O[1]=D[oe+1],J(O,O,se),D[oe]=O[0],D[oe+1]=O[1];return D});return Xt.forEach=U,Xt}function Ge(){if(Gt)return w;function d(D){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(D)}Gt=1,Object.defineProperty(w,"__esModule",{value:!0}),w.vec4=w.vec3=w.vec2=w.quat2=w.quat=w.mat4=w.mat3=w.mat2d=w.mat2=w.glMatrix=void 0;var a=U(M());w.glMatrix=a;var u=U(z());w.mat2=u;var p=U(H());w.mat2d=p;var _=U(le());w.mat3=_;var m=U(pe());w.mat4=m;var x=U(ft());w.quat=x;var R=U(ut());w.quat2=R;var k=U(Qe());w.vec2=k;var V=U(We());w.vec3=V;var b=U(qe());function O(D){if(typeof WeakMap!="function")return null;var B=new WeakMap,W=new WeakMap;return(O=function(K){return K?W:B})(D)}function U(D,B){if(D&&D.__esModule)return D;if(D===null||d(D)!=="object"&&typeof D!="function")return{default:D};var W=O(B);if(W&&W.has(D))return W.get(D);var K={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var se in D)if(se!=="default"&&Object.prototype.hasOwnProperty.call(D,se)){var oe=J?Object.getOwnPropertyDescriptor(D,se):null;oe&&(oe.get||oe.set)?Object.defineProperty(K,se,oe):K[se]=D[se]}return K.default=D,W&&W.set(D,K),K}return w.vec4=b,w}var He,De,kt,rn,Re=Ge(),Kt=function(){if(De)return He;function d(a,u,p,_){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(_-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=p,this.p2y=_}return De=1,He=d,d.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var p=a,_=0;_<8;_++){var m=this.sampleCurveX(p)-a;if(Math.abs(m)<u)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=m/x}var R=0,k=1;for(p=a,_=0;_<20&&(m=this.sampleCurveX(p),!(Math.abs(m-a)<u));_++)a>m?R=p:k=p,p=.5*(k-R)+R;return p},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},He}(),bt=f(Kt);function Dt(){if(rn)return kt;function d(a,u){this.x=a,this.y=u}return rn=1,kt=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,p=a.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),p=Math.sin(a),_=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=_,this},_rotateAround:function(a,u){var p=Math.cos(a),_=Math.sin(a),m=u.y+_*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-_*(this.y-u.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(a){return a instanceof d?a:Array.isArray(a)?new d(a[0],a[1]):a},kt}var _e=f(Dt());function At(d,a){if(Array.isArray(d)){if(!Array.isArray(a)||d.length!==a.length)return!1;for(let u=0;u<d.length;u++)if(!At(d[u],a[u]))return!1;return!0}if(typeof d=="object"&&d!==null&&a!==null){if(typeof a!="object"||Object.keys(d).length!==Object.keys(a).length)return!1;for(const u in d)if(!At(d[u],a[u]))return!1;return!0}return d===a}const Ot=Math.PI/180,tn=180/Math.PI;function xe(d){return d*Ot}function Se(d){return d*tn}const it=[[0,0],[1,0],[1,1],[0,1]];function Le(d){if(d<=0)return 0;if(d>=1)return 1;const a=d*d,u=a*d;return 4*(d<.5?u:3*(d-a)+u-.75)}function Pe(d,a,u,p){const _=new bt(d,a,u,p);return function(m){return _.solve(m)}}const vt=Pe(.25,.1,.25,1);function yt(d,a,u){return Math.min(u,Math.max(a,d))}function nn(d,a,u){return(u=yt((u-d)/(a-d),0,1))*u*(3-2*u)}function jt(d,a,u){const p=u-a,_=((d-a)%p+p)%p+a;return _===a?u:_}function Fn(d,a,u){if(!d.length)return u(null,[]);let p=d.length;const _=new Array(d.length);let m=null;d.forEach((x,R)=>{a(x,(k,V)=>{k&&(m=k),_[R]=V,--p==0&&u(m,_)})})}function Bn(d,...a){for(const u of a)for(const p in u)d[p]=u[p];return d}let Zn=1;function Li(){return Zn++}function zn(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))}function oi(d,a){d.forEach(u=>{a[u]&&(a[u]=a[u].bind(a))})}function gi(d,a){return d.indexOf(a,d.length-a.length)!==-1}function Ti(d,a,u){const p={};for(const _ in d)p[_]=a.call(this,d[_],_,d);return p}function pi(d,a,u){const p={};for(const _ in d)a.call(this,d[_],_,d)&&(p[_]=d[_]);return p}function Ji(d){return Array.isArray(d)?d.map(Ji):typeof d=="object"&&d?Ti(d,Ji):d}const er={};function vi(d){er[d]||(typeof console<"u"&&console.warn(d),er[d]=!0)}function Wt(d,a,u){return(u.y-d.y)*(a.x-d.x)>(a.y-d.y)*(u.x-d.x)}function ui(d){let a=0;for(let u,p,_=0,m=d.length,x=m-1;_<m;x=_++)u=d[_],p=d[x],a+=(p.x-u.x)*(u.y+p.y);return a}function vn([d,a,u]){const p=xe(a+90),_=xe(u);return{x:d*Math.cos(p)*Math.sin(_),y:d*Math.sin(p)*Math.sin(_),z:d*Math.cos(_),azimuthal:a,polar:u}}function Ln(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function mi(d){const a={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,p,_,m)=>{const x=_||m;return a[p]=!x||x.toLowerCase(),""}),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a}let hi=null;function Xi(d,a){return[d[4*a],d[4*a+1],d[4*a+2],d[4*a+3]]}function cs(d,a,u,p){for(;a<u;){const _=a+u>>1;d[_]<p?a=_+1:u=_}return a}function Ft(d,a,u,p){for(;a<u;){const _=a+u>>1;d[_]<=p?a=_+1:u=_}return a}function we(d){return d>0?1/(1.001-d):1+d}function Ie(d){return d>0?1-1/(1.001-d):-d}const je={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!je.API_URL)return null;try{const d=new URL(je.API_URL);return d.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":d.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function pt(d){return je.API_URL_REGEX.test(d)}function nt(d){return je.API_SPRITE_REGEX.test(d)}let wt,zt,St,Bt,Zt,Yt;function fn(){return wt==null&&(wt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),wt}const In={now:()=>Bt!==void 0?Bt:performance.now(),setNow(d){Bt=d},restoreNow(){Bt=void 0},frame(d){const a=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(d,a=0){const{width:u,height:p}=d;Zt||(Zt=document.createElement("canvas"));const _=Zt.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(u>Zt.width||p>Zt.height)&&(Zt.width=u,Zt.height=p),_.clearRect(-a,-a,u+2*a,p+2*a),_.drawImage(d,0,0,u,p),_.getImageData(-a,-a,u+2*a,p+2*a)},resolveURL:d=>(zt||(zt=document.createElement("a")),zt.href=d,zt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(St==null&&(St=window.matchMedia("(prefers-reduced-motion: reduce)")),St.matches)},hasCanvasFingerprintNoise(){if(Yt!==void 0)return Yt;if(!fn())return Yt=!1,!1;const d=new OffscreenCanvas(85,1),a=d.getContext("2d",{willReadFrequently:!0});let u=0;for(let _=0;_<d.width;++_)a.fillStyle=`rgba(${u++},${u++},${u++}, 255)`,a.fillRect(_,0,1,1);const p=a.getImageData(0,0,d.width,d.height);u=0;for(let _=0;_<p.data.length;++_)if(_%4!=3&&u++!==p.data[_])return Yt=!0,!0;return Yt=!1,!1}};function Gn(d,a){const u=d.indexOf("?");if(u<0)return`${d}?${new URLSearchParams(a).toString()}`;const p=new URLSearchParams(d.slice(u));for(const _ in a)p.set(_,a[_]);return`${d.slice(0,u)}?${p.toString()}`}function Ci(d,a={persistentParams:[]}){const u=d.indexOf("?");if(u<0)return d;const p=new URLSearchParams,_=new URLSearchParams(d.slice(u));for(const x of a.persistentParams){const R=_.get(x);R&&p.set(x,R)}const m=p.toString();return`${d.slice(0,u)}${m.length>0?`?${m}`:""}`}const Ri="mapbox-tiles";let Mi=500,Be=50;const Pt=["language","worldview","jobid"];let $t,ht;function Lt(){try{return caches}catch{}}function An(){const d=Lt();d&&$t==null&&($t=d.open(Ri))}let Dn=1/0;const Xn={supported:!1,testSupport:function(d){!Wi&&Si&&(di?Pr(d):Yn=d)}};let Yn,Si,Wi=!1,di=!1;const or=typeof self<"u"?self:{};function Pr(d){const a=d.createTexture();d.bindTexture(d.TEXTURE_2D,a);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Si),d.isContextLost())return;Xn.supported=!0}catch{}d.deleteTexture(a),Wi=!0}or.document&&(Si=or.document.createElement("img"),Si.onload=function(){Yn&&Pr(Yn),Yn=null,di=!0},Si.onerror=function(){Wi=!0,Yn=null},Si.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ji={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ji);class vr extends Error{constructor(a,u,p){u===401&&pt(p)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=u,this.url=p}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const wr=Ln()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,fi=function(d,a){if(!(/^file:/.test(u=d.url)||/^file:/.test(wr())&&!/^\w+:/.test(u))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(p,_){const m=new AbortController,x=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:wr(),referrerPolicy:p.referrerPolicy,signal:m.signal});let R=!1,k=!1;const V=(b=x.url).indexOf("sku=")>0&&pt(b);var b;p.type==="json"&&x.headers.set("Accept","application/json");const O=(D,B,W)=>{if(k)return;if(D&&D.message!=="SecurityError"&&vi(D.toString()),B&&W)return U(B);const K=Date.now();fetch(x).then(J=>{if(J.ok){const se=V?J.clone():null;return U(J,se,K)}return _(new vr(J.statusText,J.status,p.url))}).catch(J=>{J.name!=="AbortError"&&_(new Error(`${J.message} ${p.url}`))})},U=(D,B,W)=>{(p.type==="arrayBuffer"?D.arrayBuffer():p.type==="json"?D.json():D.text()).then(K=>{k||(B&&W&&function(J,se,oe){if(An(),$t==null)return;const te=mi(se.headers.get("Cache-Control")||"");if(te["no-store"])return;const de={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((Ve,Oe)=>de.headers.set(Oe,Ve)),te["max-age"]&&de.headers.set("Expires",new Date(oe+1e3*te["max-age"]).toUTCString());const ge=de.headers.get("Expires");if(!ge||new Date(ge).getTime()-oe<42e4)return;let Te=Ci(J.url,{persistentParams:Pt});if(se.status===206){const Ve=J.headers.get("Range");if(!Ve)return;de.status=200,Te=Gn(Te,{range:Ve})}(function(Ve,Oe){if(ht===void 0)try{new Response(new ReadableStream),ht=!0}catch{ht=!1}ht?Oe(Ve.body):Ve.blob().then(Oe)})(se,Ve=>{const Oe=new Response((Ne=se.status)!==200&&Ne!==404&&[101,103,204,205,304].includes(Ne)?null:Ve,de);var Ne;An(),$t!=null&&$t.then(st=>st.put(Te,Oe)).catch(st=>vi(st.message))})}(x,B,W),R=!0,_(null,K,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(K=>{k||_(new Error(K.message))})};return V?function(D,B){if(An(),$t==null)return B(null);$t.then(W=>{let K=Ci(D.url,{persistentParams:Pt});const J=D.headers.get("Range");J&&(K=Gn(K,{range:J})),W.match(K).then(se=>{const oe=function(te){if(!te)return!1;const de=new Date(te.headers.get("Expires")||0),ge=mi(te.headers.get("Cache-Control")||"");return de>Date.now()&&!ge["no-cache"]}(se);W.delete(K),oe&&W.put(K,se.clone()),B(null,se,oe)}).catch(B)}).catch(B)}(x,O):O(null,null),{cancel:()=>{k=!0,R||m.abort()}}}(d,a);if(Ln()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",d,a,void 0,!0)}var u;return function(p,_){const m=new XMLHttpRequest;m.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const x in p.headers)m.setRequestHeader(x,p.headers[x]);return p.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=p.credentials==="include",m.onerror=()=>{_(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let x=m.response;if(p.type==="json")try{x=JSON.parse(m.response)}catch(R){return _(R)}_(null,x,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else _(new vr(m.statusText,m.status,p.url))},m.send(p.body),{cancel:()=>m.abort()}}(d,a)},fs=function(d,a){return fi(Bn(d,{type:"arrayBuffer"}),a)};function tr(d){const a=document.createElement("a");return a.href=d,a.protocol===location.protocol&&a.host===location.host}const Ss="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let is,rs;is=[],rs=0;const Yo=function(d,a){if(Xn.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),rs>=je.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:d,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return is.push(m),m}rs++;let u=!1;const p=()=>{if(!u)for(u=!0,rs--;is.length&&rs<je.MAX_PARALLEL_IMAGE_REQUESTS;){const m=is.shift(),{requestParameters:x,callback:R,cancelled:k}=m;k||(m.cancel=Yo(x,R).cancel)}},_=fs(d,(m,x,R,k)=>{p(),m?a(m):x&&(self.createImageBitmap?function(V,b){const O=new Blob([new Uint8Array(V)],{type:"image/png"});createImageBitmap(O).then(U=>{b(null,U)}).catch(U=>{b(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(V,b)=>a(V,b,R,k)):function(V,b){const O=new Image;O.onload=()=>{b(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Ss})},O.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new Blob([new Uint8Array(V)],{type:"image/png"});O.src=V.byteLength?URL.createObjectURL(U):Ss}(x,(V,b)=>a(V,b,R,k)))});return{cancel:()=>{_.cancel(),p()}}};var Qr,Jo,cc,Zr={exports:{}},Wa={exports:{}},El={exports:{}},dm=function(){if(cc)return Zr.exports;cc=1;var d=(Qr||(Qr=1,Wa.exports=function(u,p){var _,m,x,R,k,V,b,O;for(m=u.length-(_=3&u.length),x=p,k=3432918353,V=461845907,O=0;O<m;)b=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,x=27492+(65535&(R=5*(65535&(x=(x^=b=(65535&(b=(b=(65535&b)*k+(((b>>>16)*k&65535)<<16)&4294967295)<<15|b>>>17))*V+(((b>>>16)*V&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(b=0,_){case 3:b^=(255&u.charCodeAt(O+2))<<16;case 2:b^=(255&u.charCodeAt(O+1))<<8;case 1:x^=b=(65535&(b=(b=(65535&(b^=255&u.charCodeAt(O)))*k+(((b>>>16)*k&65535)<<16)&4294967295)<<15|b>>>17))*V+(((b>>>16)*V&65535)<<16)&4294967295}return x^=u.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Wa.exports),a=(Jo||(Jo=1,El.exports=function(u,p){for(var _,m=u.length,x=p^m,R=0;m>=4;)_=1540483477*(65535&(_=255&u.charCodeAt(R)|(255&u.charCodeAt(++R))<<8|(255&u.charCodeAt(++R))<<16|(255&u.charCodeAt(++R))<<24))+((1540483477*(_>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),m-=4,++R;switch(m){case 3:x^=(255&u.charCodeAt(R+2))<<16;case 2:x^=(255&u.charCodeAt(R+1))<<8;case 1:x=1540483477*(65535&(x^=255&u.charCodeAt(R)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),El.exports);return Zr.exports=d,Zr.exports.murmur3=d,Zr.exports.murmur2=a,Zr.exports}(),Qo=f(dm);class Ml{constructor(a,...u){Bn(this,u[0]||{}),this.type=a}}class Wc extends Ml{constructor(a,u={}){super("error",Bn({error:a},u))}}function jc(d,a,u){u[d]&&u[d].indexOf(a)!==-1||(u[d]=u[d]||[],u[d].push(a))}function Tv(d,a,u){if(u&&u[d]){const p=u[d].indexOf(a);p!==-1&&u[d].splice(p,1)}}class xd{on(a,u){return this._listeners=this._listeners||{},jc(a,u,this._listeners),this}off(a,u){return Tv(a,u,this._listeners),Tv(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},jc(a,u,this._oneTimeListeners),this):new Promise(p=>this.once(a,p))}fire(a,u){const p=typeof a=="string"?new Ml(a,u):a,_=p.type;if(this.listens(_)){p.target=this;const m=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const k of m)k.call(this,p);const x=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const k of x)Tv(_,k,this._oneTimeListeners),k.call(this,p);const R=this._eventedParent;R&&(Bn(p,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),R.fire(p))}else p instanceof Wc&&console.error(p.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var Df,cr={},uh=function(){if(Df)return cr;Df=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(m){return(m=Math.round(m))<0?0:m>255?255:m}function u(m){return a(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function p(m){return(x=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:x>1?1:x;var x}function _(m,x,R){return R<0?R+=1:R>1&&(R-=1),6*R<1?m+(x-m)*R*6:2*R<1?x:3*R<2?m+(x-m)*(2/3-R)*6:m}try{cr.parseCSSColor=function(m){var x,R=m.replace(/ /g,"").toLowerCase();if(R in d)return d[R].slice();if(R[0]==="#")return R.length===4?(x=parseInt(R.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:R.length===7&&(x=parseInt(R.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var k=R.indexOf("("),V=R.indexOf(")");if(k!==-1&&V+1===R.length){var b=R.substr(0,k),O=R.substr(k+1,V-(k+1)).split(","),U=1;switch(b){case"rgba":if(O.length!==4)return null;U=p(O.pop());case"rgb":return O.length!==3?null:[u(O[0]),u(O[1]),u(O[2]),U];case"hsla":if(O.length!==4)return null;U=p(O.pop());case"hsl":if(O.length!==3)return null;var D=(parseFloat(O[0])%360+360)%360/360,B=p(O[1]),W=p(O[2]),K=W<=.5?W*(B+1):W+B-W*B,J=2*W-K;return[a(255*_(J,K,D+1/3)),a(255*_(J,K,D)),a(255*_(J,K,D-1/3)),U];default:return null}}return null}}catch{}return cr}();class Mr{constructor(a,u,p,_=1){this.r=a,this.g=u,this.b=p,this.a=_}static parse(a){if(!a)return;if(a instanceof Mr)return a;if(typeof a!="string")return;const u=uh.parseCSSColor(a);return u?new Mr(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[a,u,p,_]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(a)},${Math.round(u)},${Math.round(p)},${_})`}toRenderColor(a){const{r:u,g:p,b:_,a:m}=this;return new Av(a,u,p,_,m)}}class Av{constructor(a,u,p,_,m){if(a){const x=a.image.height,R=x*x;u=m===0?0:u/m*(x-1),p=m===0?0:p/m*(x-1),_=m===0?0:_/m*(x-1);const k=Math.floor(u),V=Math.floor(p),b=Math.floor(_),O=Math.ceil(u),U=Math.ceil(p),D=Math.ceil(_),B=u-k,W=p-V,K=_-b,J=a.image.data,se=4*(k+V*R+b*x),oe=4*(k+V*R+D*x),te=4*(k+U*R+b*x),de=4*(k+U*R+D*x),ge=4*(O+V*R+b*x),Te=4*(O+V*R+D*x),Ve=4*(O+U*R+b*x),Oe=4*(O+U*R+D*x);if(se<0||Oe>=J.length)throw new Error("out of range");this.r=Hn(Hn(Hn(J[se],J[oe],K),Hn(J[te],J[de],K),W),Hn(Hn(J[ge],J[Te],K),Hn(J[Ve],J[Oe],K),W),B)/255*m,this.g=Hn(Hn(Hn(J[se+1],J[oe+1],K),Hn(J[te+1],J[de+1],K),W),Hn(Hn(J[ge+1],J[Te+1],K),Hn(J[Ve+1],J[Oe+1],K),W),B)/255*m,this.b=Hn(Hn(Hn(J[se+2],J[oe+2],K),Hn(J[te+2],J[de+2],K),W),Hn(Hn(J[ge+2],J[Te+2],K),Hn(J[Ve+2],J[Oe+2],K),W),B)/255*m,this.a=m}else this.r=u,this.g=p,this.b=_,this.a=m}toArray(){const{r:a,g:u,b:p,a:_}=this;return _===0?[0,0,0,0]:[255*a/_,255*u/_,255*p/_,_]}toArray01(){const{r:a,g:u,b:p,a:_}=this;return _===0?[0,0,0,0]:[a/_,u/_,p/_,_]}toArray01Scaled(a){const{r:u,g:p,b:_,a:m}=this;return m===0?[0,0,0]:[u/m*a,p/m*a,_/m*a]}toArray01PremultipliedAlpha(){const{r:a,g:u,b:p,a:_}=this;return[a,u,p,_]}toArray01Linear(){const{r:a,g:u,b:p,a:_}=this;return _===0?[0,0,0,0]:[Math.pow(a/_,2.2),Math.pow(u/_,2.2),Math.pow(p/_,2.2),_]}}function Hn(d,a,u){return d*(1-u)+a*u}function wd(d,a,u){return d.map((p,_)=>Hn(p,a[_],u))}Mr.black=new Mr(0,0,0,1),Mr.white=new Mr(1,1,1,1),Mr.transparent=new Mr(0,0,0,0),Mr.red=new Mr(1,0,0,1),Mr.blue=new Mr(0,0,1,1);var $c=Object.freeze({__proto__:null,array:wd,color:function(d,a,u){return new Mr(Hn(d.r,a.r,u),Hn(d.g,a.g,u),Hn(d.b,a.b,u),Hn(d.a,a.a,u))},number:Hn});function hh(d,...a){for(const u of a)for(const p in u)d[p]=u[p];return d}class Rl extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class fm{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[p,_]of u)this.bindings[p]=_}concat(a){return new fm(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const bs={kind:"null"},Wn={kind:"number"},ur={kind:"string"},nr={kind:"boolean"},Ia={kind:"color"},xo={kind:"object"},$i={kind:"value"},pm={kind:"collator"},Cd={kind:"formatted"},ya={kind:"resolvedImage"};function Gs(d,a){return{kind:"array",itemType:d,N:a}}function Es(d){if(d.kind==="array"){const a=Es(d.itemType);return typeof d.N=="number"?`array<${a}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${a}>`}return d.kind}const mm=[bs,Wn,ur,nr,Ia,Cd,xo,Gs($i),ya];function dh(d,a){if(a.kind==="error")return null;if(d.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!dh(d.itemType,a.itemType))&&(typeof d.N!="number"||d.N===a.N))return null}else{if(d.kind===a.kind)return null;if(d.kind==="value"){for(const u of mm)if(!dh(u,a))return null}}return`Expected ${Es(d)} but found ${Es(a)} instead.`}function Sd(d,a){return a.some(u=>u.kind===d.kind)}function wo(d,a){return a.some(u=>u==="null"?d===null:u==="array"?Array.isArray(d):u==="object"?d&&!Array.isArray(d)&&typeof d=="object":u===typeof d)}class gm{constructor(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class la{constructor(a,u,p,_,m){this.text=a.normalize?a.normalize():a,this.image=u,this.scale=p,this.fontStack=_,this.textColor=m}}class ca{constructor(a){this.sections=a}static fromString(a){return new ca([new la(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.namePrimary.length!==0)}static factory(a){return a instanceof ca?a:ca.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const u of this.sections){if(u.image){a.push(["image",u.image.namePrimary]);continue}a.push(u.text);const p={};u.fontStack&&(p["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(p["font-scale"]=u.scale),u.textColor&&(p["text-color"]=["rgba"].concat(u.textColor.toRenderColor(null).toArray())),a.push(p)}return a}}class Os{constructor(a){this.namePrimary=a.namePrimary,a.nameSecondary&&(this.nameSecondary=a.nameSecondary),this.available=a.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(a,u){return a?new Os({namePrimary:a,nameSecondary:u,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ff(d,a,u,p){return typeof d=="number"&&d>=0&&d<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[d,a,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[d,a,u,p]:[d,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tl(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Mr||d instanceof gm||d instanceof ca||d instanceof Os)return!0;if(Array.isArray(d)){for(const a of d)if(!Tl(a))return!1;return!0}if(typeof d=="object"){for(const a in d)if(!Tl(d[a]))return!1;return!0}return!1}function Ms(d){if(d===null)return bs;if(typeof d=="string")return ur;if(typeof d=="boolean")return nr;if(typeof d=="number")return Wn;if(d instanceof Mr)return Ia;if(d instanceof gm)return pm;if(d instanceof ca)return Cd;if(d instanceof Os)return ya;if(Array.isArray(d)){const a=d.length;let u;for(const p of d){const _=Ms(p);if(u){if(u===_)continue;u=$i;break}u=_}return Gs(u||$i,a)}return xo}function ea(d){const a=typeof d;return d===null?"":a==="string"||a==="number"||a==="boolean"?String(d):d instanceof Mr||d instanceof ca||d instanceof Os?d.toString():JSON.stringify(d)}class ja{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Tl(a[1]))return u.error("invalid value");const p=a[1];let _=Ms(p);const m=u.expectedType;return _.kind!=="array"||_.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(_=m),new ja(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ca?this.value.serialize():this.value}}class Qs{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Lf={string:ur,number:Wn,boolean:nr,object:xo};class $a{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let p,_=1;const m=a[0];if(m==="array"){let R,k;if(a.length>2){const V=a[1];if(typeof V!="string"||!(V in Lf)||V==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);R=Lf[V],_++}else R=$i;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);k=a[2],_++}p=Gs(R,k)}else p=Lf[m];const x=[];for(;_<a.length;_++){const R=u.parse(a[_],_,$i);if(!R)return null;x.push(R)}return new $a(p,x)}evaluate(a){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(a);if(!dh(this.type,Ms(p)))return p;if(u===this.args.length-1)throw new Qs(`The expression ${JSON.stringify(this.args[u].serialize())} evaluated to ${Es(Ms(p))} but was expected to be of type ${Es(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,u=[a.kind];if(a.kind==="array"){const p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){u.push(p.kind);const _=a.N;(typeof _=="number"||this.args.length>1)&&u.push(_)}}return u.concat(this.args.map(p=>p.serialize()))}}class Al{constructor(a){this.type=Cd,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const _=[];let m=!1;for(let x=1;x<=a.length-1;++x){const R=a[x];if(m&&typeof R=="object"&&!Array.isArray(R)){m=!1;let k=null;if(R["font-scale"]&&(k=u.parseObjectValue(R["font-scale"],x,"font-scale",Wn),!k))return null;let V=null;if(R["text-font"]&&(V=u.parseObjectValue(R["text-font"],x,"text-font",Gs(ur)),!V))return null;let b=null;if(R["text-color"]&&(b=u.parseObjectValue(R["text-color"],x,"text-color",Ia),!b))return null;const O=_[_.length-1];O.scale=k,O.font=V,O.textColor=b}else{const k=u.parse(a[x],x,$i);if(!k)return null;const V=k.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,_.push({content:k,scale:null,font:null,textColor:null})}}return new Al(_)}evaluate(a){return new ca(this.sections.map(u=>{const p=u.content.evaluate(a);return Ms(p)===ya?new la("",p,null,null,null):new la(ea(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const u of this.sections){a.push(u.content.serialize());const p={};u.scale&&(p["font-scale"]=u.scale.serialize()),u.font&&(p["text-font"]=u.font.serialize()),u.textColor&&(p["text-color"]=u.textColor.serialize()),a.push(p)}return a}}class Bo{constructor(a,u){this.type=ya,this.inputPrimary=a,this.inputSecondary=u}static parse(a,u){if(a.length<2)return u.error("Expected two or more arguments.");const p=u.parse(a[1],1,ur);if(!p)return u.error("No image name provided.");if(a.length===2)return new Bo(p);const _=u.parse(a[2],1,ur);return _?new Bo(p,_):u.error("Secondary image variant is not a string.")}evaluate(a){const u=Os.fromString(this.inputPrimary.evaluate(a),this.inputSecondary?this.inputSecondary.evaluate(a):void 0);return u&&a.availableImages&&(u.available=a.availableImages.indexOf(u.namePrimary)>-1,u.nameSecondary&&u.available&&a.availableImages&&(u.available=a.availableImages.indexOf(u.nameSecondary)>-1)),u}eachChild(a){a(this.inputPrimary),this.inputSecondary&&a(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ua(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":d===null?"null":typeof d}const Pl={"to-boolean":nr,"to-color":Ia,"to-number":Wn,"to-string":ur};class Il{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const p=a[0],_=[];let m=bs;if(p==="to-array"){if(!Array.isArray(a[1]))return null;const x=a[1].length;if(u.expectedType){if(u.expectedType.kind!=="array")return u.error(`Expected ${u.expectedType.kind} but found array.`);m=Gs(u.expectedType.itemType,x)}else{if(!(x>0&&Tl(a[1][0])))return null;m=Gs(Ms(a[1][0]),x)}for(let R=0;R<x;R++){const k=a[1][R];let V;if(ua(k)==="array")V=u.parse(k,void 0,m.itemType);else{const b=ua(k);if(b!==m.itemType.kind)return u.error(`Expected ${m.itemType.kind} but found ${b}.`);V=u.registry.literal.parse(["literal",k===void 0?null:k],u)}if(!V)return null;_.push(V)}}else{if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");m=Pl[p];for(let x=1;x<a.length;x++){const R=u.parse(a[x],x,$i);if(!R)return null;_.push(R)}}return new Il(m,_)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let u,p;for(const _ of this.args){if(u=_.evaluate(a),p=null,u instanceof Mr)return u;if(typeof u=="string"){const m=a.parseColor(u);if(m)return m}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ff(u[0],u[1],u[2],u[3]),!p))return new Mr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Qs(p||`Could not parse color from value '${typeof u=="string"?u:String(JSON.stringify(u))}'`)}if(this.type.kind==="number"){let u=null;for(const p of this.args){if(u=p.evaluate(a),u===null)return 0;const _=Number(u);if(!isNaN(_))return _}throw new Qs(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?ca.fromString(ea(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Os.fromString(ea(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(u=>u.evaluate(a)):ea(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Al([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Bo(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(u=>{a.push(u.serialize())}),a}}const Z_=["Unknown","Point","LineString","Polygon"];class uc{constructor(a,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Z_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,u=this.featureDistanceData.scale,{x:p,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(p*u-a[0])+this.featureDistanceData.bearing[1]*(_*u-a[1])}return 0}parseColor(a){let u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=Mr.parse(a)),u}getConfig(a){return this.options?this.options.get(a):null}}class eo{constructor(a,u,p,_,m){this.name=a,this.type=u,this._evaluate=p,this.args=_,this._overloadIndex=m}evaluate(a){if(!this._evaluate){const u=eo.definitions[this.name];this._evaluate=Array.isArray(u)?u[2]:u.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,u){const p=a[0],_=eo.definitions[p];if(!_)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,R=[];let k=null,V=-1;for(const[b,O]of x){if(Array.isArray(b)&&b.length!==a.length-1)continue;R.push(b),V++,k=new qf(u.registry,u.path,null,u.scope,void 0,u._scope,u.options);const U=[];let D=!1;for(let B=1;B<a.length;B++){const W=a[B],K=Array.isArray(b)?b[B-1]:b.type,J=k.parse(W,1+U.length,K);if(!J){D=!0;break}U.push(J)}if(!D)if(Array.isArray(b)&&b.length!==U.length)k.error(`Expected ${b.length} arguments, but found ${U.length} instead.`);else{for(let B=0;B<U.length;B++){const W=Array.isArray(b)?b[B]:b.type,K=U[B];k.concat(B+1).checkSubtype(W,K.type)}if(k.errors.length===0)return new eo(p,m,O,U,V)}}if(R.length===1)u.errors.push(...k.errors);else{const b=(R.length?R:x.map(([U])=>U)).map(vm).join(" | "),O=[];for(let U=1;U<a.length;U++){const D=u.parse(a[U],1+O.length);if(!D)return null;O.push(Es(D.type))}u.error(`Expected arguments of type ${b}, but found (${O.join(", ")}) instead.`)}return null}static register(a,u){eo.definitions=u;for(const p in u)a[p]=eo}}function vm(d){return Array.isArray(d)?`(${d.map(Es).join(", ")})`:`(${Es(d.type)}...)`}class Of{constructor(a,u,p){this.type=pm,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const _=p["case-sensitive"]===void 0?u.parse(!1,1,nr):u.parseObjectValue(p["case-sensitive"],1,"case-sensitive",nr);if(!_)return null;const m=p["diacritic-sensitive"]===void 0?u.parse(!1,1,nr):u.parseObjectValue(p["diacritic-sensitive"],1,"diacritic-sensitive",nr);if(!m)return null;let x=null;return p.locale&&(x=u.parseObjectValue(p.locale,1,"locale",ur),!x)?null:new Of(_,m,x)}evaluate(a){return new gm(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function kf(d,a,u=0,p=d.length-1,_=ph){for(;p>u;){if(p-u>600){const k=p-u+1,V=a-u+1,b=Math.log(k),O=.5*Math.exp(2*b/3),U=.5*Math.sqrt(b*O*(k-O)/k)*(V-k/2<0?-1:1);kf(d,a,Math.max(u,Math.floor(a-V*O/k+U)),Math.min(p,Math.floor(a+(k-V)*O/k+U)),_)}const m=d[a];let x=u,R=p;for(fh(d,u,a),_(d[p],m)>0&&fh(d,u,p);x<R;){for(fh(d,x,R),x++,R--;_(d[x],m)<0;)x++;for(;_(d[R],m)>0;)R--}_(d[u],m)===0?fh(d,u,R):(R++,fh(d,R,p)),R<=a&&(u=R+1),a<=R&&(p=R-1)}}function fh(d,a,u){const p=d[a];d[a]=d[u],d[u]=p}function ph(d,a){return d<a?-1:d>a?1:0}function Pv(d){let a=0;for(let u,p,_=0,m=d.length,x=m-1;_<m;x=_++)u=d[_],p=d[x],a+=(p.x-u.x)*(u.y+p.y);return a}function Eu(d,a){d[0]=Math.min(d[0],a[0]),d[1]=Math.min(d[1],a[1]),d[2]=Math.max(d[2],a[0]),d[3]=Math.max(d[3],a[1])}function Mu(d,a){return!(d[0]<=a[0]||d[2]>=a[2]||d[1]<=a[1]||d[3]>=a[3])}function X_(d,a,u){const p=d[0]-a[0],_=d[1]-a[1],m=d[0]-u[0],x=d[1]-u[1];return p*x-m*_==0&&p*m<=0&&_*x<=0}function mh(d,a,u=!1){let p=!1;for(let R=0,k=a.length;R<k;R++){const V=a[R];for(let b=0,O=V.length,U=O-1;b<O;U=b++){const D=V[U],B=V[b];if(X_(d,D,B))return u;(m=D)[1]>(_=d)[1]!=(x=B)[1]>_[1]&&_[0]<(x[0]-m[0])*(_[1]-m[1])/(x[1]-m[1])+m[0]&&(p=!p)}}var _,m,x;return p}function ym(d,a,u,p){const _=p[0]-u[0],m=p[1]-u[1],x=(d[0]-u[0])*m-_*(d[1]-u[1]),R=(a[0]-u[0])*m-_*(a[1]-u[1]);return x>0&&R<0||x<0&&R>0}function qc(d,a,u,p){return(_=[p[0]-u[0],p[1]-u[1]])[0]*(m=[a[0]-d[0],a[1]-d[1]])[1]-_[1]*m[0]!=0&&!(!ym(d,a,u,p)||!ym(u,p,d,a));var _,m}const zo=8192;function Vi(d,a){const u=(180+d[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,_=Math.pow(2,a.z);return[Math.round(u*_*zo),Math.round(p*_*zo)]}function ii(d,a){for(let u=0;u<a.length;u++)if(mh(d,a[u]))return!0;return!1}function Da(d,a,u){for(const p of u)for(let _=0,m=p.length,x=m-1;_<m;x=_++)if(qc(d,a,p[x],p[_]))return!0;return!1}function _i(d,a){for(let u=0;u<d.length;++u)if(!mh(d[u],a))return!1;for(let u=0;u<d.length-1;++u)if(Da(d[u],d[u+1],a))return!1;return!0}function Zc(d,a){for(let u=0;u<a.length;u++)if(_i(d,a[u]))return!0;return!1}function qa(d,a,u){const p=[];for(let _=0;_<d.length;_++){const m=[];for(let x=0;x<d[_].length;x++){const R=Vi(d[_][x],u);Eu(a,R),m.push(R)}p.push(m)}return p}function yi(d,a,u){const p=[];for(let _=0;_<d.length;_++){const m=qa(d[_],a,u);p.push(m)}return p}function Xc(d,a,u,p){if(d[0]<u[0]||d[0]>u[2]){const _=.5*p;let m=d[0]-u[0]>_?-p:u[0]-d[0]>_?p:0;m===0&&(m=d[0]-u[2]>_?-p:u[2]-d[0]>_?p:0),d[0]+=m}Eu(a,d)}function Nf(d,a,u,p){const _=Math.pow(2,p.z)*zo,m=[p.x*zo,p.y*zo],x=[];if(!d)return x;for(const R of d)for(const k of R){const V=[k.x+m[0],k.y+m[1]];Xc(V,a,u,_),x.push(V)}return x}function Bf(d,a,u,p){const _=Math.pow(2,p.z)*zo,m=[p.x*zo,p.y*zo],x=[];if(!d)return x;for(const k of d){const V=[];for(const b of k){const O=[b.x+m[0],b.y+m[1]];Eu(a,O),V.push(O)}x.push(V)}if(a[2]-a[0]<=_/2){(R=a)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const k of x)for(const V of k)Xc(V,a,u,_)}var R;return x}class hc{constructor(a,u){this.type=nr,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Tl(a[1])){const p=a[1];if(p.type==="FeatureCollection")for(let _=0;_<p.features.length;++_){const m=p.features[_].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new hc(p,p.features[_].geometry)}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new hc(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new hc(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=u.canonicalID();if(!x)return!1;if(p.type==="Polygon"){const R=qa(p.coordinates,m,x),k=Nf(u.geometry(),_,m,x);if(!Mu(_,m))return!1;for(const V of k)if(!mh(V,R))return!1}if(p.type==="MultiPolygon"){const R=yi(p.coordinates,m,x),k=Nf(u.geometry(),_,m,x);if(!Mu(_,m))return!1;for(const V of k)if(!ii(V,R))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=u.canonicalID();if(!x)return!1;if(p.type==="Polygon"){const R=qa(p.coordinates,m,x),k=Bf(u.geometry(),_,m,x);if(!Mu(_,m))return!1;for(const V of k)if(!_i(V,R))return!1}if(p.type==="MultiPolygon"){const R=yi(p.coordinates,m,x),k=Bf(u.geometry(),_,m,x);if(!Mu(_,m))return!1;for(const V of k)if(!Zc(V,R))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Co={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ps=1/298.257223563,As=ps*(2-ps),dc=Math.PI/180;class ha{static fromTile(a,u,p){const _=Math.PI*(1-2*(a+.5)/Math.pow(2,u)),m=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/dc;return new ha(m,p)}static get units(){return Co}constructor(a,u){if(a===void 0)throw new Error("No latitude given.");if(u&&!Co[u])throw new Error(`Unknown unit ${u}. Use one of: ${Object.keys(Co).join(", ")}`);const p=6378.137*dc*(u?Co[u]:1),_=Math.cos(a*dc),m=1/(1-As*(1-_*_)),x=Math.sqrt(m);this.kx=p*x*_,this.ky=p*x*m*(1-As)}distance(a,u){const p=ms(a[0]-u[0])*this.kx,_=(a[1]-u[1])*this.ky;return Math.sqrt(p*p+_*_)}bearing(a,u){const p=ms(u[0]-a[0])*this.kx;return Math.atan2(p,(u[1]-a[1])*this.ky)/dc}destination(a,u,p){const _=p*dc;return this.offset(a,Math.sin(_)*u,Math.cos(_)*u)}offset(a,u,p){return[a[0]+u/this.kx,a[1]+p/this.ky]}lineDistance(a){let u=0;for(let p=0;p<a.length-1;p++)u+=this.distance(a[p],a[p+1]);return u}area(a){let u=0;for(let p=0;p<a.length;p++){const _=a[p];for(let m=0,x=_.length,R=x-1;m<x;R=m++)u+=ms(_[m][0]-_[R][0])*(_[m][1]+_[R][1])*(p?-1:1)}return Math.abs(u)/2*this.kx*this.ky}along(a,u){let p=0;if(u<=0)return a[0];for(let _=0;_<a.length-1;_++){const m=a[_],x=a[_+1],R=this.distance(m,x);if(p+=R,p>u)return fc(m,x,(u-(p-R))/R)}return a[a.length-1]}pointToSegmentDistance(a,u,p){let[_,m]=u,x=ms(p[0]-_)*this.kx,R=(p[1]-m)*this.ky;if(x!==0||R!==0){const k=(ms(a[0]-_)*this.kx*x+(a[1]-m)*this.ky*R)/(x*x+R*R);k>1?(_=p[0],m=p[1]):k>0&&(_+=x/this.kx*k,m+=R/this.ky*k)}return x=ms(a[0]-_)*this.kx,R=(a[1]-m)*this.ky,Math.sqrt(x*x+R*R)}pointOnLine(a,u){let p=1/0,_=a[0][0],m=a[0][1],x=0,R=0;for(let k=0;k<a.length-1;k++){let V=a[k][0],b=a[k][1],O=ms(a[k+1][0]-V)*this.kx,U=(a[k+1][1]-b)*this.ky,D=0;O===0&&U===0||(D=(ms(u[0]-V)*this.kx*O+(u[1]-b)*this.ky*U)/(O*O+U*U),D>1?(V=a[k+1][0],b=a[k+1][1]):D>0&&(V+=O/this.kx*D,b+=U/this.ky*D)),O=ms(u[0]-V)*this.kx,U=(u[1]-b)*this.ky;const B=O*O+U*U;B<p&&(p=B,_=V,m=b,x=k,R=D)}return{point:[_,m],index:x,t:Math.max(0,Math.min(1,R))}}lineSlice(a,u,p){let _=this.pointOnLine(p,a),m=this.pointOnLine(p,u);if(_.index>m.index||_.index===m.index&&_.t>m.t){const V=_;_=m,m=V}const x=[_.point],R=_.index+1,k=m.index;!zf(p[R],x[0])&&R<=k&&x.push(p[R]);for(let V=R+1;V<=k;V++)x.push(p[V]);return zf(p[k],m.point)||x.push(m.point),x}lineSliceAlong(a,u,p){let _=0;const m=[];for(let x=0;x<p.length-1;x++){const R=p[x],k=p[x+1],V=this.distance(R,k);if(_+=V,_>a&&m.length===0&&m.push(fc(R,k,(a-(_-V))/V)),_>=u)return m.push(fc(R,k,(u-(_-V))/V)),m;_>a&&m.push(k)}return m}bufferPoint(a,u){const p=u/this.ky,_=u/this.kx;return[a[0]-_,a[1]-p,a[0]+_,a[1]+p]}bufferBBox(a,u){const p=u/this.ky,_=u/this.kx;return[a[0]-_,a[1]-p,a[2]+_,a[3]+p]}insideBBox(a,u){return ms(a[0]-u[0])>=0&&ms(a[0]-u[2])<=0&&a[1]>=u[1]&&a[1]<=u[3]}}function zf(d,a){return d[0]===a[0]&&d[1]===a[1]}function fc(d,a,u){const p=ms(a[0]-d[0]);return[d[0]+p*u,d[1]+(a[1]-d[1])*u]}function ms(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class Uf{constructor(a=[],u=(p,_)=>p<_?-1:p>_?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:p}=this,_=u[a];for(;a>0;){const m=a-1>>1,x=u[m];if(p(_,x)>=0)break;u[a]=x,a=m}u[a]=_}_down(a){const{data:u,compare:p}=this,_=this.length>>1,m=u[a];for(;a<_;){let x=1+(a<<1);const R=x+1;if(R<this.length&&p(u[R],u[x])<0&&(x=R),p(u[x],m)>=0)break;u[a]=u[x],a=x}u[a]=m}}var Mn=8192;function bd(d,a){return a.dist-d.dist}const Dl=100,Ed=50;function Ru(d){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==d.length)return!1;for(let u=0;u<a.length;u++)if(a[u]!==d[u])return!1;return!0}function gh(d){return d[1]-d[0]+1}function pc(d,a){const u=d[1]>=d[0]&&d[1]<a;return u||console.warn("Distance Expression: Index is out of range"),u}function _m(d,a){if(d[0]>d[1])return[null,null];const u=gh(d);if(a){if(u===2)return[d,null];const p=Math.floor(u/2);return[[d[0],d[0]+p],[d[0]+p,d[1]]]}{if(u===1)return[d,null];const p=Math.floor(u/2)-1;return[[d[0],d[0]+p],[d[0]+p+1,d[1]]]}}function Uo(d,a){const u=[1/0,1/0,-1/0,-1/0];if(!pc(a,d.length))return u;for(let p=a[0];p<=a[1];++p)Eu(u,d[p]);return u}function Vf(d){const a=[1/0,1/0,-1/0,-1/0];for(let u=0;u<d.length;++u)for(let p=0;p<d[u].length;++p)Eu(a,d[u][p]);return a}function mc(d,a,u){if(Ru(d)||Ru(a))return NaN;let p=0,_=0;return d[2]<a[0]&&(p=a[0]-d[2]),d[0]>a[2]&&(p=d[0]-a[2]),d[1]>a[3]&&(_=d[1]-a[3]),d[3]<a[1]&&(_=a[1]-d[3]),u.distance([0,0],[p,_])}function Za(d){return 360*d-180}function Md(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Vo(d,a){const u=Math.pow(2,a.z),p=(d.y/Mn+a.y)/u;return[Za((d.x/Mn+a.x)/u),Md(p)]}function Fl(d,a){const u=[];for(let p=0;p<d.length;++p)u.push(Vo(d[p],a));return u}function Gf(d,a,u){const p=u.pointOnLine(a,d).point;return u.distance(d,p)}function Tu(d,a,u,p,_){const m=u.slice(p[0],p[1]+1);let x=1/0;for(let R=a[0];R<=a[1];++R)if((x=Math.min(x,Gf(d[R],m,_)))===0)return 0;return x}function Hf(d,a,u,p,_){const m=Math.min(_.pointToSegmentDistance(d,u,p),_.pointToSegmentDistance(a,u,p)),x=Math.min(_.pointToSegmentDistance(u,d,a),_.pointToSegmentDistance(p,d,a));return Math.min(m,x)}function xm(d,a,u,p,_){if(!pc(a,d.length)||!pc(p,u.length))return NaN;let m=1/0;for(let x=a[0];x<a[1];++x)for(let R=p[0];R<p[1];++R){if(qc(d[x],d[x+1],u[R],u[R+1]))return 0;m=Math.min(m,Hf(d[x],d[x+1],u[R],u[R+1],_))}return m}function zs(d,a,u,p,_){if(!pc(a,d.length)||!pc(p,u.length))return NaN;let m=1/0;for(let x=a[0];x<=a[1];++x)for(let R=p[0];R<=p[1];++R)if((m=Math.min(m,_.distance(d[x],u[R])))===0)return m;return m}function Wf(d,a,u){if(mh(d,a,!0))return 0;let p=1/0;for(const _ of a){const m=_.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[m-1]&&(p=Math.min(p,u.pointToSegmentDistance(d,_[m-1],_[0])))===0||(p=Math.min(p,Gf(d,_,u)))===0)return p}return p}function wm(d,a,u,p){if(!pc(a,d.length))return NaN;for(let m=a[0];m<=a[1];++m)if(mh(d[m],u,!0))return 0;let _=1/0;for(let m=a[0];m<a[1];++m)for(const x of u)for(let R=0,k=x.length,V=k-1;R<k;V=R++){if(qc(d[m],d[m+1],x[V],x[R]))return 0;_=Math.min(_,Hf(d[m],d[m+1],x[V],x[R],p))}return _}function jf(d,a){for(const u of d)for(let p=0;p<=u.length-1;++p)if(mh(u[p],a,!0))return!0;return!1}function $f(d,a,u,p=1/0){const _=Vf(d),m=Vf(a);if(p!==1/0&&mc(_,m,u)>=p)return p;if(Mu(_,m)){if(jf(d,a))return 0}else if(jf(a,d))return 0;let x=p;for(const R of d)for(let k=0,V=R.length,b=V-1;k<V;b=k++)for(const O of a)for(let U=0,D=O.length,B=D-1;U<D;B=U++){if(qc(R[b],R[k],O[B],O[U]))return 0;x=Math.min(x,Hf(R[b],R[k],O[B],O[U],u))}return x}function da(d,a,u,p,_,m,x){if(m===null||x===null)return;const R=mc(Uo(p,m),Uo(_,x),u);R<a&&d.push({dist:R,range1:m,range2:x})}function Kc(d,a,u,p,_=1/0){let m=Math.min(p.distance(d[0],u[0][0]),_);if(m===0)return m;const x=new Uf([{dist:0,range1:[0,d.length-1],range2:[0,0]}],bd),R=a?Ed:Dl,k=Vf(u);for(;x.length;){const V=x.pop();if(V.dist>=m)continue;const b=V.range1;if(gh(b)<=R){if(!pc(b,d.length))return NaN;if(a){const O=wm(d,b,u,p);if((m=Math.min(m,O))===0)return m}else for(let O=b[0];O<=b[1];++O){const U=Wf(d[O],u,p);if((m=Math.min(m,U))===0)return m}}else{const O=_m(b,a);if(O[0]!==null){const U=mc(Uo(d,O[0]),k,p);U<m&&x.push({dist:U,range1:O[0],range2:[0,0]})}if(O[1]!==null){const U=mc(Uo(d,O[1]),k,p);U<m&&x.push({dist:U,range1:O[1],range2:[0,0]})}}}return m}function Fs(d,a,u,p,_,m=1/0){let x=Math.min(m,_.distance(d[0],u[0]));if(x===0)return x;const R=new Uf([{dist:0,range1:[0,d.length-1],range2:[0,u.length-1]}],bd),k=a?Ed:Dl,V=p?Ed:Dl;for(;R.length;){const b=R.pop();if(b.dist>=x)continue;const O=b.range1,U=b.range2;if(gh(O)<=k&&gh(U)<=V){if(!pc(O,d.length)||!pc(U,u.length))return NaN;if(a&&p?x=Math.min(x,xm(d,O,u,U,_)):a||p?a&&!p?x=Math.min(x,Tu(u,U,d,O,_)):!a&&p&&(x=Math.min(x,Tu(d,O,u,U,_))):x=Math.min(x,zs(d,O,u,U,_)),x===0)return x}else{const D=_m(O,a),B=_m(U,p);da(R,x,_,d,u,D[0],B[0]),da(R,x,_,d,u,D[0],B[1]),da(R,x,_,d,u,D[1],B[0]),da(R,x,_,d,u,D[1],B[1])}}return x}function to(d,a,u,p,_=1/0){let m=_;const x=Uo(d,[0,d.length-1]);for(const R of u)if(!(m!==1/0&&mc(x,Uo(R,[0,R.length-1]),p)>=m)&&(m=Math.min(m,Fs(d,a,R,!0,p,m)),m===0))return m;return m}function Zs(d,a,u,p,_=1/0){let m=_;const x=Uo(d,[0,d.length-1]);for(const R of u){if(m!==1/0&&mc(x,Vf(R),p)>=m)continue;const k=Kc(d,a,R,p,m);if(isNaN(k))return k;if((m=Math.min(m,k))===0)return m}return m}function vh(d){return d==="Point"||d==="MultiPoint"||d==="LineString"||d==="MultiLineString"||d==="Polygon"||d==="MultiPolygon"}class il{constructor(a,u){this.type=Wn,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(Tl(a[1])){const p=a[1];if(p.type==="FeatureCollection"){for(let _=0;_<p.features.length;++_)if(vh(p.features[_].geometry.type))return new il(p,p.features[_].geometry)}else if(p.type==="Feature"){if(vh(p.geometry.type))return new il(p,p.geometry)}else if(vh(p.type))return new il(p,p)}return u.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const u=a.geometry(),p=a.canonicalID();if(u!=null&&p!=null){if(a.geometryType()==="Point")return function(_,m,x){const R=[];for(const V of _)for(const b of V)R.push(Vo(b,m));const k=new ha(R[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?Fs(R,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",k):x.type==="MultiLineString"?to(R,!1,x.coordinates,k):x.type==="Polygon"||x.type==="MultiPolygon"?Zs(R,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,k):null}(u,p,this.geometries);if(a.geometryType()==="LineString")return function(_,m,x){const R=[];for(const V of _){const b=[];for(const O of V)b.push(Vo(O,m));R.push(b)}const k=new ha(R[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return to(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",R,k);if(x.type==="MultiLineString"){let V=1/0;for(let b=0;b<x.coordinates.length;b++){const O=to(x.coordinates[b],!0,R,k,V);if(isNaN(O))return O;if((V=Math.min(V,O))===0)return V}return V}if(x.type==="Polygon"||x.type==="MultiPolygon"){let V=1/0;for(let b=0;b<R.length;b++){const O=Zs(R[b],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,k,V);if(isNaN(O))return O;if((V=Math.min(V,O))===0)return V}return V}return null}(u,p,this.geometries);if(a.geometryType()==="Polygon")return function(_,m,x){const R=[];for(const V of function(b,O){const U=b.length;if(U<=1)return[b];const D=[];let B,W;for(let K=0;K<U;K++){const J=Pv(b[K]);J!==0&&(b[K].area=Math.abs(J),W===void 0&&(W=J<0),W===J<0?(B&&D.push(B),B=[b[K]]):B.push(b[K]))}return B&&D.push(B),D}(_)){const b=[];for(let O=0;O<V.length;++O)b.push(Fl(V[O],m));R.push(b)}const k=new ha(R[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Zs(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",R,k);if(x.type==="MultiLineString"){let V=1/0;for(let b=0;b<x.coordinates.length;b++){const O=Zs(x.coordinates[b],!0,R,k,V);if(isNaN(O))return O;if((V=Math.min(V,O))===0)return V}return V}return x.type==="Polygon"||x.type==="MultiPolygon"?function(V,b,O){let U=1/0;for(const D of V)for(const B of b){const W=$f(D,B,O,U);if(isNaN(W))return W;if((U=Math.min(U,W))===0)return U}return U}(x.type==="Polygon"?[x.coordinates]:x.coordinates,R,k):null}(u,p,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function rl(d,a){switch(d){case"string":return ea(a);case"number":return+a;case"boolean":return!!a;case"color":return Mr.parse(a);case"formatted":return ca.fromString(ea(a));case"resolvedImage":return Os.fromString(ea(a))}return a}function ir(d,a,u,p){return p!==void 0&&(d=p*Math.round(d/p)),a!==void 0&&d<a&&(d=a),u!==void 0&&d>u&&(d=u),d}class no{constructor(a,u,p){this.type=a,this.key=u,this.scope=p}static parse(a,u){let p=u.expectedType;if(p==null&&(p=$i),a.length<2||a.length>3)return u.error("Invalid number of arguments for 'config' expression.");const _=u.parse(a[1],1);if(!(_ instanceof ja))return u.error("Key name of 'config' expression must be a string literal.");if(a.length>=3){const m=u.parse(a[2],2);return m instanceof ja?new no(p,ea(_.value),ea(m.value)):u.error("Scope of 'config' expression must be a string literal.")}return new no(p,ea(_.value))}evaluate(a){const u=[this.key,this.scope,a.scope].filter(Boolean).join(""),p=a.getConfig(u);if(!p)return null;const{type:_,value:m,values:x,minValue:R,maxValue:k,stepValue:V}=p,b=p.default.evaluate(a);let O=b;if(m){const U=a.scope;a.scope=(U||"").split("").slice(1).join(""),O=m.evaluate(a),a.scope=U}return _&&(O=rl(_,O)),O===void 0||R===void 0&&k===void 0&&V===void 0||(typeof O=="number"?O=ir(O,R,k,V):Array.isArray(O)&&(O=O.map(U=>typeof U=="number"?ir(U,R,k,V):U))),m!==void 0&&O!==void 0&&x&&!x.includes(O)&&(O=b,_&&(O=rl(_,O))),(_&&_!==this.type||O!==void 0&&Ms(O)!==this.type)&&(O=rl(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.key),a}}function yh(d){if(d instanceof eo&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof hc||d instanceof il)return!1;let a=!0;return d.eachChild(u=>{a&&!yh(u)&&(a=!1)}),a}function Rd(d){if(d instanceof eo&&d.name==="feature-state")return!1;let a=!0;return d.eachChild(u=>{a&&!Rd(u)&&(a=!1)}),a}function _h(d){if(d instanceof no)return new Set([d.key]);let a=new Set;return d.eachChild(u=>{a=new Set([...a,..._h(u)])}),a}function Fa(d,a){if(d instanceof eo&&a.indexOf(d.name)>=0)return!1;let u=!0;return d.eachChild(p=>{u&&!Fa(p,a)&&(u=!1)}),u}class fr{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=a[1];return u.scope.has(p)?new fr(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Yc{constructor(a,u=[],p,_=new fm,m=[],x,R){this.registry=a,this.path=u,this.key=u.map(k=>typeof k=="string"?`['${k}']`:`[${k}]`).join(""),this.scope=_,this.errors=m,this.expectedType=p,this._scope=x,this.options=R}parse(a,u,p,_,m={}){return u||p?this.concat(u,null,p,_)._parse(a,m):this._parse(a,m)}parseObjectValue(a,u,p,_,m,x={}){return this.concat(u,p,_,m)._parse(a,x)}_parse(a,u){function p(_,m,x){return x==="assert"?new $a(m,[_]):x==="coerce"?new Il(m,[_]):_}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(_){let m=_.parse(a,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,R=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||R.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(x,R))return null}else m=p(m,x,u.typeAnnotation||"coerce");else m=p(m,x,u.typeAnnotation||"assert")}if(!(m instanceof ja)&&m.type.kind!=="resolvedImage"&&Td(m)){const x=new uc(this._scope,this.options);try{m=new ja(m.type,m.evaluate(x))}catch(R){return this.error(R.message),null}}return m}return Il.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,p,_){let m=typeof a=="number"?this.path.concat(a):this.path;m=typeof u=="string"?m.concat(u):m;const x=_?this.scope.concat(_):this.scope;return new Yc(this.registry,m,p||null,x,this.errors,this._scope,this.options)}error(a,...u){const p=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new Rl(p,a))}checkSubtype(a,u){const p=dh(a,u);return p&&this.error(p),p}}var qf=Yc;function Td(d){if(d instanceof fr)return Td(d.boundExpression);if(d instanceof eo&&d.name==="error"||d instanceof Of||d instanceof hc||d instanceof il||d instanceof no)return!1;const a=d instanceof Il||d instanceof $a;let u=!0;return d.eachChild(p=>{u=a?u&&Td(p):u&&p instanceof ja}),!!u&&yh(d)&&Fa(d,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zf(d,a){const u=d.length-1;let p,_,m=0,x=u,R=0;for(;m<=x;)if(R=Math.floor((m+x)/2),p=d[R],_=d[R+1],p<=a){if(R===u||a<_)return R;m=R+1}else{if(!(p>a))throw new Qs("Input is not a number.");x=R-1}return 0}class Ad{constructor(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[_,m]of p)this.labels.push(_),this.outputs.push(m)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(a[1],1,Wn);if(!p)return null;const _=[];let m=null;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(let x=1;x<a.length;x+=2){const R=x===1?-1/0:a[x],k=a[x+1],V=x,b=x+1;if(typeof R!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(_.length&&_[_.length-1][0]>=R)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);const O=u.parse(k,b,m);if(!O)return null;m=m||O.type,_.push([R,O])}return new Ad(m,p,_)}evaluate(a){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);const _=this.input.evaluate(a);if(_<=u[0])return p[0].evaluate(a);const m=u.length;return _>=u[m-1]?p[m-1].evaluate(a):p[Zf(u,_)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a}}const Iv=.95047,Dv=1.08883,Fv=4/29,xh=6/29,Cm=3*xh*xh,Xf=xh*xh*xh,K_=Math.PI/180,Sm=180/Math.PI;function Pd(d){return d>Xf?Math.pow(d,1/3):d/Cm+Fv}function Kf(d){return d>xh?d*d*d:Cm*(d-Fv)}function wh(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function bm(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function Lv(d){const a=bm(d.r),u=bm(d.g),p=bm(d.b),_=Pd((.4124564*a+.3575761*u+.1804375*p)/Iv),m=Pd((.2126729*a+.7151522*u+.072175*p)/1);return{l:116*m-16,a:500*(_-m),b:200*(m-Pd((.0193339*a+.119192*u+.9503041*p)/Dv)),alpha:d.a}}function Ov(d){let a=(d.l+16)/116,u=isNaN(d.a)?a:a+d.a/500,p=isNaN(d.b)?a:a-d.b/200;return a=1*Kf(a),u=Iv*Kf(u),p=Dv*Kf(p),new Mr(wh(3.2404542*u-1.5371385*a-.4985314*p),wh(-.969266*u+1.8760108*a+.041556*p),wh(.0556434*u-.2040259*a+1.0572252*p),d.alpha)}function Y_(d,a,u){const p=a-d;return d+u*(p>180||p<-180?p-360*Math.round(p/360):p)}const Ch={forward:Lv,reverse:Ov,interpolate:function(d,a,u){return{l:Hn(d.l,a.l,u),a:Hn(d.a,a.a,u),b:Hn(d.b,a.b,u),alpha:Hn(d.alpha,a.alpha,u)}}},Id={forward:function(d){const{l:a,a:u,b:p}=Lv(d),_=Math.atan2(p,u)*Sm;return{h:_<0?_+360:_,c:Math.sqrt(u*u+p*p),l:a,alpha:d.a}},reverse:function(d){const a=d.h*K_,u=d.c;return Ov({l:d.l,a:Math.cos(a)*u,b:Math.sin(a)*u,alpha:d.alpha})},interpolate:function(d,a,u){return{h:Y_(d.h,a.h,u),c:Hn(d.c,a.c,u),l:Hn(d.l,a.l,u),alpha:Hn(d.alpha,a.alpha,u)}}};var kv=Object.freeze({__proto__:null,hcl:Id,lab:Ch});class Xa{constructor(a,u,p,_,m){this.type=a,this.operator=u,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[x,R]of m)this.labels.push(x),this.outputs.push(R)}static interpolationFactor(a,u,p,_){let m=0;if(a.name==="exponential")m=Em(u,a.base,p,_);else if(a.name==="linear")m=Em(u,1,p,_);else if(a.name==="cubic-bezier"){const x=a.controlPoints;m=new bt(x[0],x[1],x[2],x[3]).solve(Em(u,1,p,_))}return m}static parse(a,u){let[p,_,m,...x]=a;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const V=_[1];if(typeof V!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:V}}else{if(_[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const V=_.slice(1);if(V.length!==4||V.some(b=>typeof b!="number"||b<0||b>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:V}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(m=u.parse(m,2,Wn),!m)return null;const R=[];let k=null;p==="interpolate-hcl"||p==="interpolate-lab"?k=Ia:u.expectedType&&u.expectedType.kind!=="value"&&(k=u.expectedType);for(let V=0;V<x.length;V+=2){const b=x[V],O=x[V+1],U=V+3,D=V+4;if(typeof b!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(R.length&&R[R.length-1][0]>=b)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const B=u.parse(O,D,k);if(!B)return null;k=k||B.type,R.push([b,B])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new Xa(k,p,_,m,R):u.error(`Type ${Es(k)} is not interpolatable.`)}evaluate(a){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);const _=this.input.evaluate(a);if(_<=u[0])return p[0].evaluate(a);const m=u.length;if(_>=u[m-1])return p[m-1].evaluate(a);const x=Zf(u,_),R=Xa.interpolationFactor(this.interpolation,_,u[x],u[x+1]),k=p[x].evaluate(a),V=p[x+1].evaluate(a);return this.operator==="interpolate"?$c[this.type.kind.toLowerCase()](k,V,R):this.operator==="interpolate-hcl"?Id.reverse(Id.interpolate(Id.forward(k),Id.forward(V),R)):Ch.reverse(Ch.interpolate(Ch.forward(k),Ch.forward(V),R))}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,a,this.input.serialize()];for(let p=0;p<this.labels.length;p++)u.push(this.labels[p],this.outputs[p].serialize());return u}}function Em(d,a,u,p){const _=p-u,m=d-u;return _===0?0:a===1?m/_:(Math.pow(a,m)-1)/(Math.pow(a,_)-1)}class Mm{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expectected at least one argument.");let p=null;const _=u.expectedType;_&&_.kind!=="value"&&(p=_);const m=[];for(const R of a.slice(1)){const k=u.parse(R,1+m.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,m.push(k)}const x=_&&m.some(R=>dh(_,R.type));return new Mm(x?$i:p,m)}evaluate(a){let u,p=null,_=0;for(const m of this.args){if(_++,p=m.evaluate(a),p&&p instanceof Os&&!p.available&&(u||(u=p),p=null,_===this.args.length))return u;if(p!==null)break}return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(u=>{a.push(u.serialize())}),a}}class Rm{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let m=1;m<a.length-1;m+=2){const x=a[m];if(typeof x!="string")return u.error(`Expected string, but found ${typeof x} instead.`,m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);const R=u.parse(a[m+1],m+1);if(!R)return null;p.push([x,R])}const _=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return _?new Rm(p,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[u,p]of this.bindings)a.push(u,p.serialize());return a.push(this.result.serialize()),a}}class Tm{constructor(a,u,p){this.type=a,this.index=u,this.input=p}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,Wn),_=u.parse(a[2],2,Gs(u.expectedType||$i));return p&&_?new Tm(_.type.itemType,p,_):null}evaluate(a){const u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new Qs(`Array index out of bounds: ${u} < 0.`);if(u>p.length-1)throw new Qs(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u===Math.floor(u))return p[u];const _=Math.floor(u),m=Math.ceil(u),x=p[_],R=p[m];if(typeof x!="number"||typeof R!="number")throw new Qs(`Cannot interpolate between non-number values at index ${u}.`);const k=u-_;return x*(1-k)+R*k}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Am{constructor(a,u){this.type=nr,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,$i),_=u.parse(a[2],2,$i);return p&&_?Sd(p.type,[nr,ur,Wn,bs,$i])?new Am(p,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(p.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(p==null)return!1;if(!wo(u,["boolean","string","number","null"]))throw new Qs(`Expected first argument to be of type boolean, string, number or null, but found ${Es(Ms(u))} instead.`);if(!wo(p,["string","array"]))throw new Qs(`Expected second argument to be of type array or string, but found ${Es(Ms(p))} instead.`);return p.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yf{constructor(a,u,p){this.type=Wn,this.needle=a,this.haystack=u,this.fromIndex=p}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,$i),_=u.parse(a[2],2,$i);if(!p||!_)return null;if(!Sd(p.type,[nr,ur,Wn,bs,$i]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(p.type)} instead`);if(a.length===4){const m=u.parse(a[3],3,Wn);return m?new Yf(p,_,m):null}return new Yf(p,_)}evaluate(a){const u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!wo(u,["boolean","string","number","null"]))throw new Qs(`Expected first argument to be of type boolean, string, number or null, but found ${Es(Ms(u))} instead.`);if(!wo(p,["string","array"]))throw new Qs(`Expected second argument to be of type array or string, but found ${Es(Ms(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(a);return p.indexOf(u,_)}return p.indexOf(u)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Pm{constructor(a,u,p,_,m,x){this.inputType=a,this.type=u,this.input=p,this.cases=_,this.outputs=m,this.otherwise=x}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let p,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);const m={},x=[];for(let V=2;V<a.length-1;V+=2){let b=a[V];const O=a[V+1];Array.isArray(b)||(b=[b]);const U=u.concat(V);if(b.length===0)return U.error("Expected at least one branch label.");for(const B of b){if(typeof B!="number"&&typeof B!="string")return U.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return U.error("Numeric branch labels must be integer values.");if(p){if(U.checkSubtype(p,Ms(B)))return null}else p=Ms(B);if(m[String(B)]!==void 0)return U.error("Branch labels must be unique.");m[String(B)]=x.length}const D=u.parse(O,V,_);if(!D)return null;_=_||D.type,x.push(D)}const R=u.parse(a[1],1,$i);if(!R)return null;const k=u.parse(a[a.length-1],a.length-1,_);return k?R.type.kind!=="value"&&u.concat(1).checkSubtype(p,R.type)?null:new Pm(p,_,R,m,x,k):null}evaluate(a){const u=this.input.evaluate(a);return(Ms(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),p=[],_={};for(const x of u){const R=_[this.cases[x]];R===void 0?(_[this.cases[x]]=p.length,p.push([this.cases[x],[x]])):p[R][1].push(x)}const m=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,R]of p)a.push(R.length===1?m(R[0]):R.map(m)),a.push(this.outputs[x].serialize());return a.push(this.otherwise.serialize()),a}}class Au{constructor(a,u,p){this.type=a,this.branches=u,this.otherwise=p}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const _=[];for(let x=1;x<a.length-1;x+=2){const R=u.parse(a[x],x,nr);if(!R)return null;const k=u.parse(a[x+1],x+1,p);if(!k)return null;_.push([R,k]),p=p||k.type}const m=u.parse(a[a.length-1],a.length-1,p);return m?new Au(p,_,m):null}evaluate(a){for(const[u,p]of this.branches)if(u.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,p]of this.branches)a(u),a(p);a(this.otherwise)}outputDefined(){return this.branches.every(([a,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(u=>{a.push(u.serialize())}),a}}class Im{constructor(a,u,p,_){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=_}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,$i),_=u.parse(a[2],2,Wn);if(!p||!_)return null;if(!Sd(p.type,[Gs($i),ur,$i]))return u.error(`Expected first argument to be of type array or string, but found ${Es(p.type)} instead`);if(a.length===4){const m=u.parse(a[3],3,Wn);return m?new Im(p.type,p,_,m):null}return new Im(p.type,p,_)}evaluate(a){const u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!wo(u,["string","array"]))throw new Qs(`Expected first argument to be of type array or string, but found ${Es(Ms(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(a);return u.slice(p,_)}return u.slice(p)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Nv(d,a){return d==="=="||d==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function J_(d,a,u,p){return p.compare(a,u)===0}function Pu(d,a,u){const p=d!=="=="&&d!=="!=";return class KJ{constructor(m,x,R){this.type=nr,this.lhs=m,this.rhs=x,this.collator=R,this.hasUntypedArgument=m.type.kind==="value"||x.type.kind==="value"}static parse(m,x){if(m.length!==3&&m.length!==4)return x.error("Expected two or three arguments.");const R=m[0];let k=x.parse(m[1],1,$i);if(!k)return null;if(!Nv(R,k.type))return x.concat(1).error(`"${R}" comparisons are not supported for type '${Es(k.type)}'.`);let V=x.parse(m[2],2,$i);if(!V)return null;if(!Nv(R,V.type))return x.concat(2).error(`"${R}" comparisons are not supported for type '${Es(V.type)}'.`);if(k.type.kind!==V.type.kind&&k.type.kind!=="value"&&V.type.kind!=="value")return x.error(`Cannot compare types '${Es(k.type)}' and '${Es(V.type)}'.`);p&&(k.type.kind==="value"&&V.type.kind!=="value"?k=new $a(V.type,[k]):k.type.kind!=="value"&&V.type.kind==="value"&&(V=new $a(k.type,[V])));let b=null;if(m.length===4){if(k.type.kind!=="string"&&V.type.kind!=="string"&&k.type.kind!=="value"&&V.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(b=x.parse(m[3],3,pm),!b)return null}return new KJ(k,V,b)}evaluate(m){const x=this.lhs.evaluate(m),R=this.rhs.evaluate(m);if(p&&this.hasUntypedArgument){const k=Ms(x),V=Ms(R);if(k.kind!==V.kind||k.kind!=="string"&&k.kind!=="number")throw new Qs(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${k.kind}, ${V.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const k=Ms(x),V=Ms(R);if(k.kind!=="string"||V.kind!=="string")return a(m,x,R)}return this.collator?u(m,x,R,this.collator.evaluate(m)):a(m,x,R)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[d];return this.eachChild(x=>{m.push(x.serialize())}),m}}}const Bv=Pu("==",function(d,a,u){return a===u},J_),Q_=Pu("!=",function(d,a,u){return a!==u},function(d,a,u,p){return!J_(0,a,u,p)}),zv=Pu("<",function(d,a,u){return a<u},function(d,a,u,p){return p.compare(a,u)<0}),Sh=Pu(">",function(d,a,u){return a>u},function(d,a,u,p){return p.compare(a,u)>0}),Uv=Pu("<=",function(d,a,u){return a<=u},function(d,a,u,p){return p.compare(a,u)<=0}),Vv=Pu(">=",function(d,a,u){return a>=u},function(d,a,u,p){return p.compare(a,u)>=0});class Dm{constructor(a,u,p,_,m,x){this.type=ur,this.number=a,this.locale=u,this.currency=p,this.unit=_,this.minFractionDigits=m,this.maxFractionDigits=x}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const p=u.parse(a[1],1,Wn);if(!p)return null;const _=a[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let m=null;if(_.locale&&(m=u.parseObjectValue(_.locale,2,"locale",ur),!m))return null;let x=null;if(_.currency&&(x=u.parseObjectValue(_.currency,2,"currency",ur),!x))return null;let R=null;if(_.unit&&(R=u.parseObjectValue(_.unit,2,"unit",ur),!R))return null;let k=null;if(_["min-fraction-digits"]&&(k=u.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",Wn),!k))return null;let V=null;return _["max-fraction-digits"]&&(V=u.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",Wn),!V)?null:new Dm(p,m,x,R,k,V)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class La{constructor(a){this.type=Wn,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Es(p.type)} instead.`):new La(p):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Qs(`Expected value to be of type string or array, but found ${Es(Ms(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(u=>{a.push(u.serialize())}),a}}function Jf(d){return function(){d=1831565813+(d|=0)|0;let a=Math.imul(d^d>>>15,1|d);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const gc={"==":Bv,"!=":Q_,">":Sh,"<":zv,">=":Vv,"<=":Uv,array:$a,at:Tm,boolean:$a,case:Au,coalesce:Mm,collator:Of,format:Al,image:Bo,in:Am,"index-of":Yf,interpolate:Xa,"interpolate-hcl":Xa,"interpolate-lab":Xa,length:La,let:Rm,literal:ja,match:Pm,number:$a,"number-format":Dm,object:$a,slice:Im,step:Ad,string:$a,"to-boolean":Il,"to-color":Il,"to-number":Il,"to-string":Il,var:fr,within:hc,distance:il,config:no};function Dd(d,[a,u,p,_]){a=a.evaluate(d),u=u.evaluate(d),p=p.evaluate(d);const m=_?_.evaluate(d):1,x=Ff(a,u,p,m);if(x)throw new Qs(x);return new Mr(a/255*m,u/255*m,p/255*m,m)}function Fd(d,[a,u,p,_]){a=a.evaluate(d),u=u.evaluate(d),p=p.evaluate(d);const m=_?_.evaluate(d):1,x=function(V,b,O,U){return typeof V=="number"&&V>=0&&V<=360?typeof b=="number"&&b>=0&&b<=100&&typeof O=="number"&&O>=0&&O<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:`Invalid hsla value [${[V,b,O,U].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof U=="number"?[V,b,O,U]:[V,b,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof U=="number"?[V,b,O,U]:[V,b,O]).join(", ")}]: 'h' must be between 0 and 360.`}(a,u,p,m);if(x)throw new Qs(x);const R=`hsla(${a}, ${u}%, ${p}%, ${m})`,k=Mr.parse(R);if(!k)throw new Qs(`Failed to parse HSLA color: ${R}`);return k}function Ld(d,a){return d in a}function Fm(d,a){const u=a[d];return u===void 0?null:u}function Ll(d){return{type:d}}function ta(d){return{result:"success",value:d}}function Jc(d){return{result:"error",value:d}}function Lm(d,a){return!!d&&!!d.parameters&&d.parameters.indexOf(a)>-1}function So(d){return d["property-type"]==="data-driven"}function fa(d){return Lm(d.expression,"measure-light")}function Om(d){return Lm(d.expression,"zoom")}function km(d){return!!d.expression&&d.expression.interpolated}function Nm(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function Gv(d){return d}function Bm(d,a){const u=a.type==="color",p=d.stops&&typeof d.stops[0][0]=="object",_=p||!(p||d.property!==void 0),m=d.type||(km(a)?"exponential":"interval");if(u&&((d=hh({},d)).stops&&(d.stops=d.stops.map(V=>[V[0],Mr.parse(V[1])])),d.default=Mr.parse(d.default?d.default:a.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!kv[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let x,R,k;if(m==="exponential")x=zm;else if(m==="interval")x=Hv;else if(m==="categorical"){x=e0,R=Object.create(null);for(const V of d.stops)R[V[0]]=V[1];k=typeof d.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);x=t0}if(p){const V={},b=[];for(let D=0;D<d.stops.length;D++){const B=d.stops[D],W=B[0].zoom;V[W]===void 0&&(V[W]={zoom:W,type:d.type,property:d.property,default:d.default,stops:[]},b.push(W)),V[W].stops.push([B[0].value,B[1]])}const O=[];for(const D of b)O.push([V[D].zoom,Bm(V[D],a)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Xa.interpolationFactor.bind(void 0,U),zoomStops:O.map(D=>D[0]),evaluate:({zoom:D},B)=>zm({stops:O,base:d.base},a,D).evaluate(D,B)}}if(_){const V=m==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:Xa.interpolationFactor.bind(void 0,V),zoomStops:d.stops.map(b=>b[0]),evaluate:({zoom:b})=>x(d,a,b,R,k)}}return{kind:"source",evaluate(V,b){const O=b&&b.properties?b.properties[d.property]:void 0;return O===void 0?bh(d.default,a.default):x(d,a,O,R,k)}}}function bh(d,a,u){return d!==void 0?d:a!==void 0?a:u!==void 0?u:void 0}function e0(d,a,u,p,_){return bh(typeof u===_?p[u]:void 0,d.default,a.default)}function Hv(d,a,u){if(ua(u)!=="number")return bh(d.default,a.default);const p=d.stops.length;if(p===1||u<=d.stops[0][0])return d.stops[0][1];if(u>=d.stops[p-1][0])return d.stops[p-1][1];const _=Zf(d.stops.map(m=>m[0]),u);return d.stops[_][1]}function zm(d,a,u){const p=d.base!==void 0?d.base:1;if(ua(u)!=="number")return bh(d.default,a.default);const _=d.stops.length;if(_===1||u<=d.stops[0][0])return d.stops[0][1];if(u>=d.stops[_-1][0])return d.stops[_-1][1];const m=Zf(d.stops.map(b=>b[0]),u),x=function(b,O,U,D){const B=D-U,W=b-U;return B===0?0:O===1?W/B:(Math.pow(O,W)-1)/(Math.pow(O,B)-1)}(u,p,d.stops[m][0],d.stops[m+1][0]),R=d.stops[m][1],k=d.stops[m+1][1];let V=$c[a.type]||Gv;if(d.colorSpace&&d.colorSpace!=="rgb"){const b=kv[d.colorSpace];V=(O,U)=>b.reverse(b.interpolate(b.forward(O),b.forward(U),x))}return typeof R.evaluate=="function"?{evaluate(...b){const O=R.evaluate.apply(void 0,b),U=k.evaluate.apply(void 0,b);if(O!==void 0&&U!==void 0)return V(O,U,x)}}:V(R,k,x)}function t0(d,a,u){return a.type==="color"?u=Mr.parse(u):a.type==="formatted"?u=ca.fromString(u.toString()):a.type==="resolvedImage"?u=Os.fromString(u.toString()):ua(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0),bh(u,d.default,a.default)}eo.register(gc,{error:[{kind:"error"},[ur],(d,[a])=>{throw new Qs(a.evaluate(d))}],typeof:[ur,[$i],(d,[a])=>Es(Ms(a.evaluate(d)))],"to-rgba":[Gs(Wn,4),[Ia],(d,[a])=>a.evaluate(d).toRenderColor(null).toArray()],rgb:[Ia,[Wn,Wn,Wn],Dd],rgba:[Ia,[Wn,Wn,Wn,Wn],Dd],hsl:[Ia,[Wn,Wn,Wn],Fd],hsla:[Ia,[Wn,Wn,Wn,Wn],Fd],has:{type:nr,overloads:[[[ur],(d,[a])=>Ld(a.evaluate(d),d.properties())],[[ur,xo],(d,[a,u])=>Ld(a.evaluate(d),u.evaluate(d))]]},get:{type:$i,overloads:[[[ur],(d,[a])=>Fm(a.evaluate(d),d.properties())],[[ur,xo],(d,[a,u])=>Fm(a.evaluate(d),u.evaluate(d))]]},"feature-state":[$i,[ur],(d,[a])=>Fm(a.evaluate(d),d.featureState||{})],properties:[xo,[],d=>d.properties()],"geometry-type":[ur,[],d=>d.geometryType()],id:[$i,[],d=>d.id()],zoom:[Wn,[],d=>d.globals.zoom],pitch:[Wn,[],d=>d.globals.pitch||0],"distance-from-center":[Wn,[],d=>d.distanceFromCenter()],"measure-light":[Wn,[ur],(d,[a])=>d.measureLight(a.evaluate(d))],"heatmap-density":[Wn,[],d=>d.globals.heatmapDensity||0],"line-progress":[Wn,[],d=>d.globals.lineProgress||0],"raster-value":[Wn,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[Wn,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[Wn,[],d=>d.globals.skyRadialProgress||0],accumulated:[$i,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[Wn,Ll(Wn),(d,a)=>{let u=0;for(const p of a)u+=p.evaluate(d);return u}],"*":[Wn,Ll(Wn),(d,a)=>{let u=1;for(const p of a)u*=p.evaluate(d);return u}],"-":{type:Wn,overloads:[[[Wn,Wn],(d,[a,u])=>a.evaluate(d)-u.evaluate(d)],[[Wn],(d,[a])=>-a.evaluate(d)]]},"/":[Wn,[Wn,Wn],(d,[a,u])=>a.evaluate(d)/u.evaluate(d)],"%":[Wn,[Wn,Wn],(d,[a,u])=>a.evaluate(d)%u.evaluate(d)],ln2:[Wn,[],()=>Math.LN2],pi:[Wn,[],()=>Math.PI],e:[Wn,[],()=>Math.E],"^":[Wn,[Wn,Wn],(d,[a,u])=>Math.pow(a.evaluate(d),u.evaluate(d))],sqrt:[Wn,[Wn],(d,[a])=>Math.sqrt(a.evaluate(d))],log10:[Wn,[Wn],(d,[a])=>Math.log(a.evaluate(d))/Math.LN10],ln:[Wn,[Wn],(d,[a])=>Math.log(a.evaluate(d))],log2:[Wn,[Wn],(d,[a])=>Math.log(a.evaluate(d))/Math.LN2],sin:[Wn,[Wn],(d,[a])=>Math.sin(a.evaluate(d))],cos:[Wn,[Wn],(d,[a])=>Math.cos(a.evaluate(d))],tan:[Wn,[Wn],(d,[a])=>Math.tan(a.evaluate(d))],asin:[Wn,[Wn],(d,[a])=>Math.asin(a.evaluate(d))],acos:[Wn,[Wn],(d,[a])=>Math.acos(a.evaluate(d))],atan:[Wn,[Wn],(d,[a])=>Math.atan(a.evaluate(d))],min:[Wn,Ll(Wn),(d,a)=>Math.min(...a.map(u=>u.evaluate(d)))],max:[Wn,Ll(Wn),(d,a)=>Math.max(...a.map(u=>u.evaluate(d)))],abs:[Wn,[Wn],(d,[a])=>Math.abs(a.evaluate(d))],round:[Wn,[Wn],(d,[a])=>{const u=a.evaluate(d);return u<0?-Math.round(-u):Math.round(u)}],floor:[Wn,[Wn],(d,[a])=>Math.floor(a.evaluate(d))],ceil:[Wn,[Wn],(d,[a])=>Math.ceil(a.evaluate(d))],"filter-==":[nr,[ur,$i],(d,[a,u])=>d.properties()[a.value]===u.value],"filter-id-==":[nr,[$i],(d,[a])=>d.id()===a.value],"filter-type-==":[nr,[ur],(d,[a])=>d.geometryType()===a.value],"filter-<":[nr,[ur,$i],(d,[a,u])=>{const p=d.properties()[a.value],_=u.value;return typeof p==typeof _&&p<_}],"filter-id-<":[nr,[$i],(d,[a])=>{const u=d.id(),p=a.value;return typeof u==typeof p&&u<p}],"filter->":[nr,[ur,$i],(d,[a,u])=>{const p=d.properties()[a.value],_=u.value;return typeof p==typeof _&&p>_}],"filter-id->":[nr,[$i],(d,[a])=>{const u=d.id(),p=a.value;return typeof u==typeof p&&u>p}],"filter-<=":[nr,[ur,$i],(d,[a,u])=>{const p=d.properties()[a.value],_=u.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[nr,[$i],(d,[a])=>{const u=d.id(),p=a.value;return typeof u==typeof p&&u<=p}],"filter->=":[nr,[ur,$i],(d,[a,u])=>{const p=d.properties()[a.value],_=u.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[nr,[$i],(d,[a])=>{const u=d.id(),p=a.value;return typeof u==typeof p&&u>=p}],"filter-has":[nr,[$i],(d,[a])=>a.value in d.properties()],"filter-has-id":[nr,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[nr,[Gs(ur)],(d,[a])=>a.value.indexOf(d.geometryType())>=0],"filter-id-in":[nr,[Gs($i)],(d,[a])=>a.value.indexOf(d.id())>=0],"filter-in-small":[nr,[ur,Gs($i)],(d,[a,u])=>u.value.indexOf(d.properties()[a.value])>=0],"filter-in-large":[nr,[ur,Gs($i)],(d,[a,u])=>function(p,_,m,x){for(;m<=x;){const R=m+x>>1;if(_[R]===p)return!0;_[R]>p?x=R-1:m=R+1}return!1}(d.properties()[a.value],u.value,0,u.value.length-1)],all:{type:nr,overloads:[[[nr,nr],(d,[a,u])=>a.evaluate(d)&&u.evaluate(d)],[Ll(nr),(d,a)=>{for(const u of a)if(!u.evaluate(d))return!1;return!0}]]},any:{type:nr,overloads:[[[nr,nr],(d,[a,u])=>a.evaluate(d)||u.evaluate(d)],[Ll(nr),(d,a)=>{for(const u of a)if(u.evaluate(d))return!0;return!1}]]},"!":[nr,[nr],(d,[a])=>!a.evaluate(d)],"is-supported-script":[nr,[ur],(d,[a])=>{const u=d.globals&&d.globals.isSupportedScript;return!u||u(a.evaluate(d))}],upcase:[ur,[ur],(d,[a])=>a.evaluate(d).toUpperCase()],downcase:[ur,[ur],(d,[a])=>a.evaluate(d).toLowerCase()],concat:[ur,Ll($i),(d,a)=>a.map(u=>ea(u.evaluate(d))).join("")],"resolved-locale":[ur,[pm],(d,[a])=>a.evaluate(d).resolvedLocale()],random:[Wn,[Wn,Wn,$i],(d,a)=>{const[u,p,_]=a.map(x=>x.evaluate(d));if(u>p||u===p)return u;let m;if(typeof _=="string")m=function(x){let R=0;if(x.length===0)return R;for(let k=0;k<x.length;k++)R=(R<<5)-R+x.charCodeAt(k),R|=0;return R}(_);else{if(typeof _!="number")throw new Qs(`Invalid seed input: ${_}`);m=_}return u+Jf(m)()*(p-u)}]});class Od{constructor(a,u,p,_){this.expression=a,this._warningHistory={},this._evaluator=new uc(p,_),this._defaultValue=u?function(m){return m.type==="color"&&(Nm(m.default)||Array.isArray(m.default))?new Mr(0,0,0,0):m.type==="color"?Mr.parse(m.default)||null:m.default===void 0?null:m.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this.configDependencies=_h(a)}evaluateWithoutErrorHandling(a,u,p,_,m,x,R,k){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=_||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=R||null,this._evaluator.featureDistanceData=k||null,this.expression.evaluate(this._evaluator)}evaluate(a,u,p,_,m,x,R,k){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=R||null,this._evaluator.featureDistanceData=k||null;try{const V=this.expression.evaluate(this._evaluator);if(V==null||typeof V=="number"&&V!=V)return this._defaultValue;if(this._enumValues&&!(V in this._enumValues))throw new Qs(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(V)} instead.`);return V}catch(V){return this._warningHistory[V.message]||(this._warningHistory[V.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${V.message}`)),this._defaultValue}}}function Eh(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in gc}function Mh(d,a,u,p){const _=new qf(gc,[],a?function(x){const R={color:Ia,string:ur,number:Wn,enum:ur,boolean:nr,formatted:Cd,resolvedImage:ya};return x.type==="array"?Gs(R[x.value]||$i,x.length):R[x.type]}(a):void 0,void 0,void 0,u,p),m=_.parse(d,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?ta(new Od(m,a,u,p)):Jc(_.errors)}class kd{constructor(a,u,p){this.kind=a,this._styleExpression=u,this.isLightConstant=p,this.isStateDependent=a!=="constant"&&!Rd(u.expression),this.configDependencies=_h(u.expression)}evaluateWithoutErrorHandling(a,u,p,_,m,x){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,_,m,x)}evaluate(a,u,p,_,m,x){return this._styleExpression.evaluate(a,u,p,_,m,x)}}class Nd{constructor(a,u,p,_,m){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!Rd(u.expression),this.isLightConstant=m,this.configDependencies=_h(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(a,u,p,_,m,x){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,_,m,x)}evaluate(a,u,p,_,m,x){return this._styleExpression.evaluate(a,u,p,_,m,x)}interpolationFactor(a,u,p){return this.interpolationType?Xa.interpolationFactor(this.interpolationType,a,u,p):0}}function Iu(d,a,u,p){if((d=Mh(d,a,u,p)).result==="error")return d;const _=d.value.expression,m=yh(_);if(!m&&!So(a))return Jc([new Rl("","data expressions not supported")]);const x=Fa(_,["zoom","pitch","distance-from-center"]);if(!x&&!Om(a))return Jc([new Rl("","zoom expressions not supported")]);const R=Fa(_,["measure-light"]);if(!R&&!fa(a))return Jc([new Rl("","measure-light expression not supported")]);const k=Fa(_,["line-progress"]);if(!k&&!function(O){return Lm(O.expression,"line-progress")}(a))return Jc([new Rl("","line-progress expression not supported")]);const V=a.expression&&a.expression.relaxZoomRestriction,b=Qf(_);return b||x||V?b instanceof Rl?Jc([b]):b instanceof Xa&&!km(a)?Jc([new Rl("",'"interpolate" expressions cannot be used with this property')]):ta(b?new Nd(m&&k?"camera":"composite",d.value,b.labels,b instanceof Xa?b.interpolation:void 0,R):new kd(m&&k?"constant":"source",d.value,R)):Jc([new Rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Rh{constructor(a,u){this._parameters=a,this._specification=u,hh(this,Bm(this._parameters,this._specification))}static deserialize(a){return new Rh(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Qf(d){let a=null;if(d instanceof Rm)a=Qf(d.result);else if(d instanceof Mm){for(const u of d.args)if(a=Qf(u),a)break}else(d instanceof Ad||d instanceof Xa)&&d.input instanceof eo&&d.input.name==="zoom"&&(a=d);return a instanceof Rl||d.eachChild(u=>{const p=Qf(u);p instanceof Rl?a=p:a&&p&&a!==p&&(a=new Rl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var ep,Um,vc=function(){if(Um)return ep;Um=1,ep=a;var d=3;function a(u,p,_){var m=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;var x=new Int32Array(this.arrayBuffer);u=x[0],this.d=(p=x[1])+2*(_=x[2]);for(var R=0;R<this.d*this.d;R++){var k=x[d+R],V=x[d+R+1];m.push(k===V?null:x.subarray(k,V))}var b=x[d+m.length+1];this.keys=x.subarray(x[d+m.length],b),this.bboxes=x.subarray(b),this.insert=this._insertReadonly}else{this.d=p+2*_;for(var O=0;O<this.d*this.d;O++)m.push([]);this.keys=[],this.bboxes=[]}this.n=p,this.extent=u,this.padding=_,this.scale=p/u,this.uid=0;var U=_/p*u;this.min=-U,this.max=u+U}return a.prototype.insert=function(u,p,_,m,x){this._forEachCell(p,_,m,x,this._insertCell,this.uid++),this.keys.push(u),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(m),this.bboxes.push(x)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(u,p,_,m,x,R){this.cells[x].push(R)},a.prototype.query=function(u,p,_,m,x){var R=this.min,k=this.max;if(u<=R&&p<=R&&k<=_&&k<=m&&!x)return Array.prototype.slice.call(this.keys);var V=[];return this._forEachCell(u,p,_,m,this._queryCell,V,{},x),V},a.prototype._queryCell=function(u,p,_,m,x,R,k,V){var b=this.cells[x];if(b!==null)for(var O=this.keys,U=this.bboxes,D=0;D<b.length;D++){var B=b[D];if(k[B]===void 0){var W=4*B;(V?V(U[W+0],U[W+1],U[W+2],U[W+3]):u<=U[W+2]&&p<=U[W+3]&&_>=U[W+0]&&m>=U[W+1])?(k[B]=!0,R.push(O[B])):k[B]=!1}}},a.prototype._forEachCell=function(u,p,_,m,x,R,k,V){for(var b=this._convertToCellCoord(u),O=this._convertToCellCoord(p),U=this._convertToCellCoord(_),D=this._convertToCellCoord(m),B=b;B<=U;B++)for(var W=O;W<=D;W++){var K=this.d*W+B;if((!V||V(this._convertFromCellCoord(B),this._convertFromCellCoord(W),this._convertFromCellCoord(B+1),this._convertFromCellCoord(W+1)))&&x.call(this,u,p,_,m,K,R,k,V))return}},a.prototype._convertFromCellCoord=function(u){return(u-this.padding)/this.scale},a.prototype._convertToCellCoord=function(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var u=this.cells,p=d+this.cells.length+1+1,_=0,m=0;m<this.cells.length;m++)_+=this.cells[m].length;var x=new Int32Array(p+_+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var R=p,k=0;k<u.length;k++){var V=u[k];x[d+k]=R,x.set(V,R),R+=V.length}return x[d+u.length]=R,x.set(this.keys,R),x[d+u.length+1]=R+=this.keys.length,x.set(this.bboxes,R),R+=this.bboxes.length,x.buffer},ep}(),Th=f(vc);const tp={};function Un(d,a,u={}){Object.defineProperty(d,"_classRegistryKey",{value:a,writable:!1}),tp[a]={klass:d,omit:u.omit||[]}}Un(Object,"Object"),Th.serialize=function(d,a){const u=d.toArrayBuffer();return a&&a.add(u),{buffer:u}},Th.deserialize=function(d){return new Th(d.buffer)},Object.defineProperty(Th,"name",{value:"Grid"}),Un(Th,"Grid"),Un(Mr,"Color"),Un(Error,"Error"),Un(ca,"Formatted"),Un(la,"FormattedSection"),Un(vr,"AJAXError"),Un(Os,"ResolvedImage"),Un(Rh,"StylePropertyFunction"),Un(Od,"StyleExpression",{omit:["_evaluator"]}),Un(Nd,"ZoomDependentExpression"),Un(kd,"ZoomConstantExpression"),Un(eo,"CompoundExpression",{omit:["_evaluate"]});for(const d in gc)tp[gc[d]._classRegistryKey]||Un(gc[d],`Expression${d}`);function yc(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function Wv(d){return self.ImageBitmap&&d instanceof ImageBitmap}function ci(d,a){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(yc(d)||Wv(d))return a&&a.add(d),d;if(ArrayBuffer.isView(d)){const u=d;return a&&a.add(u.buffer),u}if(d instanceof ImageData)return a&&a.add(d.data.buffer),d;if(Array.isArray(d)){const u=[];for(const p of d)u.push(ci(p,a));return u}if(d instanceof Map){const u={$name:"Map"};for(const[p,_]of d.entries())u[p]=ci(_);return u}if(d instanceof Set){const u={$name:"Set"};let p=0;for(const _ of d.values())u[++p]=ci(_);return u}if(typeof d=="object"){const u=d.constructor,p=u._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${p}`);const _=u.serialize?u.serialize(d,a):{};if(!u.serialize){for(const m in d)d.hasOwnProperty(m)&&(tp[p].omit.indexOf(m)>=0||(_[m]=ci(d[m],a)));d instanceof Error&&(_.message=d.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof d)}function na(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||yc(d)||Wv(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(na);if(typeof d=="object"){const a=d.$name||"Object";if(a==="Map"){const _=new Map;for(const m of Object.keys(d))m!=="$name"&&_.set(m,na(d[m]));return _}if(a==="Set"){const _=new Set;for(const m of Object.keys(d))m!=="$name"&&_.add(na(d[m]));return _}const{klass:u}=tp[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(d);const p=Object.create(u.prototype);for(const _ of Object.keys(d))_!=="$name"&&(p[_]=na(d[_]));return p}throw new Error("can't deserialize object of type "+typeof d)}const Jn={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function Vm(d){for(const a of d)if(_c(a.charCodeAt(0)))return!0;return!1}function n0(d){for(const a of d)if(!Ah(a.charCodeAt(0)))return!1;return!0}function Ah(d){return!(Jn.Arabic(d)||Jn["Arabic Supplement"](d)||Jn["Arabic Extended-A"](d)||Jn["Arabic Presentation Forms-A"](d)||Jn["Arabic Presentation Forms-B"](d))}function _c(d){return!(d!==746&&d!==747&&(d<4352||!(Jn["Bopomofo Extended"](d)||Jn.Bopomofo(d)||Jn["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Jn["CJK Compatibility Ideographs"](d)||Jn["CJK Compatibility"](d)||Jn["CJK Radicals Supplement"](d)||Jn["CJK Strokes"](d)||!(!Jn["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||Jn["CJK Unified Ideographs Extension A"](d)||Jn["CJK Unified Ideographs"](d)||Jn["Enclosed CJK Letters and Months"](d)||Jn["Hangul Compatibility Jamo"](d)||Jn["Hangul Jamo Extended-A"](d)||Jn["Hangul Jamo Extended-B"](d)||Jn["Hangul Jamo"](d)||Jn["Hangul Syllables"](d)||Jn.Hiragana(d)||Jn["Ideographic Description Characters"](d)||Jn.Kanbun(d)||Jn["Kangxi Radicals"](d)||Jn["Katakana Phonetic Extensions"](d)||Jn.Katakana(d)&&d!==12540||!(!Jn["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!Jn["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Jn["Unified Canadian Aboriginal Syllabics"](d)||Jn["Unified Canadian Aboriginal Syllabics Extended"](d)||Jn["Vertical Forms"](d)||Jn["Yijing Hexagram Symbols"](d)||Jn["Yi Syllables"](d)||Jn["Yi Radicals"](d))))}function np(d){return!(_c(d)||function(a){return!!(Jn["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Jn["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Jn["Letterlike Symbols"](a)||Jn["Number Forms"](a)||Jn["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Jn["Control Pictures"](a)&&a!==9251||Jn["Optical Character Recognition"](a)||Jn["Enclosed Alphanumerics"](a)||Jn["Geometric Shapes"](a)||Jn["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Jn["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Jn["CJK Symbols and Punctuation"](a)||Jn.Katakana(a)||Jn["Private Use Area"](a)||Jn["CJK Compatibility Forms"](a)||Jn["Small Form Variants"](a)||Jn["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(d))}function Bd(d){return d>=1424&&d<=2303||Jn["Arabic Presentation Forms-A"](d)||Jn["Arabic Presentation Forms-B"](d)}function jv(d,a){return!(!a&&Bd(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Jn.Khmer(d))}function i0(d){for(const a of d)if(Bd(a.charCodeAt(0)))return!0;return!1}const Gm="deferred",zd="loading",Ud="loaded";let Vd=null,bo="unavailable",Oa=null;const Hm=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(bo="error"),Vd&&Vd(d)};function Gd(){$v.fire(new Ml("pluginStateChange",{pluginStatus:bo,pluginURL:Oa}))}const $v=new xd,qv=function(){return bo},Zv=function(){if(bo!==Gm||!Oa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=zd,Gd(),Oa&&fs({url:Oa},d=>{d?Hm(d):(bo=Ud,Gd())})},ka={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===Ud||ka.applyArabicShaping!=null,isLoading:()=>bo===zd,setState(d){bo=d.pluginStatus,Oa=d.pluginURL},isParsed:()=>ka.applyArabicShaping!=null&&ka.processBidirectionalText!=null&&ka.processStyledBidirectionalText!=null,getPluginURL:()=>Oa};class gs{constructor(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch,this.brightness=u.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(u,p){for(const _ of u)if(!jv(_.charCodeAt(0),p))return!1;return!0}(a,ka.isLoaded())}}class ip{constructor(a,u,p,_){this.property=a,this.value=u,this.expression=function(m,x,R,k){if(Nm(m))return new Rh(m,x);if(Eh(m)||Array.isArray(m)&&m.length>0){const V=Iu(m,x,R,k);if(V.result==="error")throw new Error(V.value.map(b=>`${b.key}: ${b.message}`).join(", "));return V.value}{let V=m;return typeof m=="string"&&x.type==="color"&&(V=Mr.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>V}}}(u===void 0?a.specification.default:u,a.specification,p,_)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)}}class Hd{constructor(a,u,p){this.property=a,this.value=new ip(a,void 0,u,p)}transitioned(a,u){return new sp(this.property,this.value,u,Bn({},a.transition,this.transition),a.now)}untransitioned(){return new sp(this.property,this.value,null,{},0)}}class rp{constructor(a,u,p){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=u,this._options=p,this.configDependencies=new Set}getValue(a){return Ji(this._values[a].value.value)}setValue(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Hd(this._values[a].property,this._scope,this._options)),this._values[a].value=new ip(this._values[a].property,u===null?void 0:Ji(u),this._scope,this._options),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]))}setTransitionOrValue(a,u){u&&(this._options=u);const p=this._properties.properties;if(a)for(const _ in a){const m=a[_];if(gi(_,"-transition")){const x=_.slice(0,-11);p[x]&&this.setTransition(x,m)}else p.hasOwnProperty(_)&&this.setValue(_,m)}}getTransition(a){return Ji(this._values[a].transition)}setTransition(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Hd(this._values[a].property)),this._values[a].transition=Ji(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(a[u]=p);const _=this.getTransition(u);_!==void 0&&(a[`${u}-transition`]=_)}return a}transitioned(a,u){const p=new op(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(a,u._values[_]);return p}untransitioned(){const a=new op(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class sp{constructor(a,u,p,_,m){const x=_.delay||0,R=_.duration||0;m=m||0,this.property=a,this.value=u,this.begin=m+x,this.end=this.begin+R,a.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(a,u,p){const _=a.now||0,m=this.value.possiblyEvaluate(a,u,p),x=this.prior;if(x){if(_>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(_<this.begin)return x.possiblyEvaluate(a,u,p);{const R=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(a,u,p),m,Le(R))}}return m}}class op{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,p){const _=new Du(this._properties);for(const m of Object.keys(this._values))_._values[m]=this._values[m].possiblyEvaluate(a,u,p);return _}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Wm{constructor(a,u,p){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=u,this._options=p,this.configDependencies=new Set}getValue(a){return Ji(this._values[a].value)}setValue(a,u){this._values[a]=new ip(this._values[a].property,u===null?void 0:Ji(u),this._scope,this._options),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]))}serialize(){const a={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(a[u]=p)}return a}possiblyEvaluate(a,u,p){const _=new Du(this._properties);for(const m of Object.keys(this._values))_._values[m]=this._values[m].possiblyEvaluate(a,u,p);return _}}class xc{constructor(a,u,p){this.property=a,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,p,_){return this.property.evaluate(this.value,this.parameters,a,u,p,_)}}class Du{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class yn{constructor(a){this.specification=a}possiblyEvaluate(a,u){return a.expression.evaluate(u)}interpolate(a,u,p){const _=$c[this.specification.type];return _?_(a,u,p):a}}class ni{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,p,_){return new xc(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,_)}:a.expression,u)}interpolate(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new xc(this,{kind:"constant",value:void 0},a.parameters);const _=$c[this.specification.type];return _?new xc(this,{kind:"constant",value:_(a.value.value,u.value.value,p)},a.parameters):a}evaluate(a,u,p,_,m,x){return a.kind==="constant"?a.value:a.evaluate(u,p,_,m,x)}}class Ph{constructor(a){this.specification=a}possiblyEvaluate(a,u,p,_){return!!a.expression.evaluate(u,null,{},p,_)}interpolate(){return!1}}class Ur{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new gs(0,{});for(const p in a){const _=a[p];_.specification.overridable&&this.overridableProperties.push(p);const m=this.defaultPropertyValues[p]=new ip(_,void 0),x=this.defaultTransitionablePropertyValues[p]=new Hd(_);this.defaultTransitioningPropertyValues[p]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=m.possiblyEvaluate(u)}}}Un(ni,"DataDrivenProperty"),Un(yn,"DataConstantProperty"),Un(Ph,"ColorRampProperty");var Tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wd(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function Qc(d){if(Array.isArray(d))return d.map(Qc);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const a={};for(const u in d)a[u]=Qc(d[u]);return a}return Wd(d)}function Hs(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const a of d.slice(1))if(!Hs(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function xr(d,a="",u=null,p="fill"){if(d==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hs(d)||(d=Fu(d));const _=d;let m=!0;try{m=function(b){if(!Ps(b))return b;let O=Qc(b);return Xs(O),O=Rs(O),O}(_)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(_,null,2)}
        `)}let x=null,R=null;if(p!=="background"&&p!=="sky"&&p!=="slot"){R=Tt[`filter_${p}`];const b=Mh(m,R,a,u);if(b.result==="error")throw new Error(b.value.map(O=>`${O.key}: ${O.message}`).join(", "));x=(O,U,D)=>b.value.evaluate(O,U,{},D)}let k=null,V=null;if(m!==_){const b=Mh(_,R,a,u);if(b.result==="error")throw new Error(b.value.map(O=>`${O.key}: ${O.message}`).join(", "));k=(O,U,D,B,W)=>b.value.evaluate(O,U,{},D,void 0,void 0,B,W),V=!yh(b.value.expression)}return{filter:x,dynamicFilter:k||void 0,needGeometry:fo(m),needFeature:!!V}}function Rs(d){if(!Array.isArray(d))return d;const a=function(u){if(Ka.has(u[0])){for(let p=1;p<u.length;p++)if(Ps(u[p]))return!0}return u}(d);return a===!0?a:a.map(u=>Rs(u))}function Xs(d){let a=!1;const u=[];if(d[0]==="case"){for(let p=1;p<d.length-1;p+=2)a=a||Ps(d[p]),u.push(d[p+1]);u.push(d[d.length-1])}else if(d[0]==="match"){a=a||Ps(d[1]);for(let p=2;p<d.length-1;p+=2)u.push(d[p+1]);u.push(d[d.length-1])}else if(d[0]==="step"){a=a||Ps(d[1]);for(let p=1;p<d.length-1;p+=2)u.push(d[p+1])}a&&(d.length=0,d.push("any",...u));for(let p=1;p<d.length;p++)Xs(d[p])}function Ps(d){if(!Array.isArray(d))return!1;if((a=d[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let u=1;u<d.length;u++)if(Ps(d[u]))return!0;return!1}const Ka=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jd(d,a){return d<a?-1:d>a?1:0}function fo(d){if(!Array.isArray(d))return!1;if(d[0]==="within"||d[0]==="distance")return!0;for(let a=1;a<d.length;a++)if(fo(d[a]))return!0;return!1}function Fu(d){if(!d)return!0;const a=d[0];return d.length<=1?a!=="any":a==="=="?Lu(d[1],d[2],"=="):a==="!="?Ol(Lu(d[1],d[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Lu(d[1],d[2],a):a==="any"?(u=d.slice(1),["any"].concat(u.map(Fu))):a==="all"?["all"].concat(d.slice(1).map(Fu)):a==="none"?["all"].concat(d.slice(1).map(Fu).map(Ol)):a==="in"?$d(d[1],d.slice(2)):a==="!in"?Ol($d(d[1],d.slice(2))):a==="has"?qd(d[1]):a!=="!has"||Ol(qd(d[1]));var u}function Lu(d,a,u){switch(d){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,d,a]}}function $d(d,a){if(a.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(u=>typeof u!=typeof a[0])?["filter-in-large",d,["literal",a.sort(jd)]]:["filter-in-small",d,["literal",a]]}}function qd(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function Ol(d){return["!",d]}const Go="";function Zd(d,a){return a?`${d}${Go}${a}`:d}const jm="-transition",_a=new Set(["fill","line","background","hillshade","raster"]);class Ho extends xd{constructor(a,u,p,_,m){if(super(),this.id=a.id,this.fqid=Zd(this.id,p),this.type=a.type,this.scope=p,this.lut=_,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const x=Mh(this.filter,Tt[`filter_${a.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(a.slot&&(this.slot=a.slot),u.layout&&(this._unevaluatedLayout=new Wm(u.layout,this.scope,m),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),u.paint){this._transitionablePaint=new rp(u.paint,this.scope,m);for(const x in a.paint)this.setPaintProperty(x,a.paint[x]);for(const x in a.layout)this.setLayoutProperty(x,a.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(u.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D()&&_a.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,u){if(this.type==="custom"&&a==="visibility")return void(this.visibility=u);const p=this._unevaluatedLayout;p._properties.properties[a]&&(p.setValue(a,u),this.configDependencies=new Set([...this.configDependencies,...p.configDependencies]),a==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return gi(a,jm)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u){const p=this._transitionablePaint,_=p._properties.properties;if(gi(a,jm)){const O=a.slice(0,-11);return _[O]&&p.setTransition(O,u||void 0),!1}if(!_[a])return!1;const m=p._values[a],x=m.value.isDataDriven(),R=m.value;p.setValue(a,u),this.configDependencies=new Set([...this.configDependencies,...p.configDependencies]),this._handleSpecialPaintPropertyUpdate(a);const k=p._values[a].value,V=k.isDataDriven(),b=gi(a,"pattern")||a==="line-dasharray";return V||x||b||this._handleOverridablePaintPropertyUpdate(a,R,k)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,u,p){return null}_handleOverridablePaintPropertyUpdate(a,u,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){return pi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof xc&&So(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=xr(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(a){}queryIntersectsFeature(a,u,p,_,m,x,R,k,V){}queryIntersectsMatchingFeature(a,u,p,_){}}const $m={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sl{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.add(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qi(d,a=1){let u=0,p=0;return{members:d.map(_=>{const m=$m[_.type].BYTES_PER_ELEMENT,x=u=ap(u,Math.max(a,m)),R=_.components||1;return p=Math.max(p,m),u+=m*R,{name:_.name,type:_.type,components:R,offset:x}}),size:ap(u,Math.max(p,a)),alignment:a}}function ap(d,a){return Math.ceil(d/a)*a}class ol extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const _=2*a;return this.int16[_+0]=u,this.int16[_+1]=p,a}}ol.prototype.bytesPerElement=4,Un(ol,"StructArrayLayout2i4");class Xd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,u,p)}emplace(a,u,p,_){const m=3*a;return this.int16[m+0]=u,this.int16[m+1]=p,this.int16[m+2]=_,a}}Xd.prototype.bytesPerElement=6,Un(Xd,"StructArrayLayout3i6");class eu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,_){const m=this.length;return this.resize(m+1),this.emplace(m,a,u,p,_)}emplace(a,u,p,_,m){const x=4*a;return this.int16[x+0]=u,this.int16[x+1]=p,this.int16[x+2]=_,this.int16[x+3]=m,a}}eu.prototype.bytesPerElement=8,Un(eu,"StructArrayLayout4i8");class Kd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m){const x=this.length;return this.resize(x+1),this.emplace(x,a,u,p,_,m)}emplace(a,u,p,_,m,x){const R=5*a;return this.int16[R+0]=u,this.int16[R+1]=p,this.int16[R+2]=_,this.int16[R+3]=m,this.int16[R+4]=x,a}}Kd.prototype.bytesPerElement=10,Un(Kd,"StructArrayLayout5i10");class Eo extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R){const k=this.length;return this.resize(k+1),this.emplace(k,a,u,p,_,m,x,R)}emplace(a,u,p,_,m,x,R,k){const V=6*a,b=12*a,O=3*a;return this.int16[V+0]=u,this.int16[V+1]=p,this.uint8[b+4]=_,this.uint8[b+5]=m,this.uint8[b+6]=x,this.uint8[b+7]=R,this.float32[O+2]=k,a}}Eo.prototype.bytesPerElement=12,Un(Eo,"StructArrayLayout2i4ub1f12");class pa extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_){const m=this.length;return this.resize(m+1),this.emplace(m,a,u,p,_)}emplace(a,u,p,_,m){const x=4*a;return this.float32[x+0]=u,this.float32[x+1]=p,this.float32[x+2]=_,this.float32[x+3]=m,a}}pa.prototype.bytesPerElement=16,Un(pa,"StructArrayLayout4f16");class Mo extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,u,p)}emplace(a,u,p,_){const m=3*a;return this.float32[m+0]=u,this.float32[m+1]=p,this.float32[m+2]=_,a}}Mo.prototype.bytesPerElement=12,Un(Mo,"StructArrayLayout3f12");class al extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m){const x=this.length;return this.resize(x+1),this.emplace(x,a,u,p,_,m)}emplace(a,u,p,_,m,x){const R=6*a,k=3*a;return this.uint16[R+0]=u,this.uint16[R+1]=p,this.uint16[R+2]=_,this.uint16[R+3]=m,this.float32[k+2]=x,a}}al.prototype.bytesPerElement=12,Un(al,"StructArrayLayout4ui1f12");class ia extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,_){const m=this.length;return this.resize(m+1),this.emplace(m,a,u,p,_)}emplace(a,u,p,_,m){const x=4*a;return this.uint16[x+0]=u,this.uint16[x+1]=p,this.uint16[x+2]=_,this.uint16[x+3]=m,a}}ia.prototype.bytesPerElement=8,Un(ia,"StructArrayLayout4ui8");class Yd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,p,_,m,x)}emplace(a,u,p,_,m,x,R){const k=6*a;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=_,this.int16[k+3]=m,this.int16[k+4]=x,this.int16[k+5]=R,a}}Yd.prototype.bytesPerElement=12,Un(Yd,"StructArrayLayout6i12");class Ou extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O,U){const D=this.length;return this.resize(D+1),this.emplace(D,a,u,p,_,m,x,R,k,V,b,O,U)}emplace(a,u,p,_,m,x,R,k,V,b,O,U,D){const B=12*a;return this.int16[B+0]=u,this.int16[B+1]=p,this.int16[B+2]=_,this.int16[B+3]=m,this.uint16[B+4]=x,this.uint16[B+5]=R,this.uint16[B+6]=k,this.uint16[B+7]=V,this.int16[B+8]=b,this.int16[B+9]=O,this.int16[B+10]=U,this.int16[B+11]=D,a}}Ou.prototype.bytesPerElement=24,Un(Ou,"StructArrayLayout4i4ui4i24");class lp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,p,_,m,x)}emplace(a,u,p,_,m,x,R){const k=10*a,V=5*a;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=_,this.float32[V+2]=m,this.float32[V+3]=x,this.float32[V+4]=R,a}}lp.prototype.bytesPerElement=20,Un(lp,"StructArrayLayout3i3f20");class Xv extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}Xv.prototype.bytesPerElement=4,Un(Xv,"StructArrayLayout1ul4");class xa extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const _=2*a;return this.uint16[_+0]=u,this.uint16[_+1]=p,a}}xa.prototype.bytesPerElement=4,Un(xa,"StructArrayLayout2ui4");class qm extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O,U,D){const B=this.length;return this.resize(B+1),this.emplace(B,a,u,p,_,m,x,R,k,V,b,O,U,D)}emplace(a,u,p,_,m,x,R,k,V,b,O,U,D,B){const W=20*a,K=10*a;return this.int16[W+0]=u,this.int16[W+1]=p,this.int16[W+2]=_,this.int16[W+3]=m,this.int16[W+4]=x,this.float32[K+3]=R,this.float32[K+4]=k,this.float32[K+5]=V,this.float32[K+6]=b,this.int16[W+14]=O,this.uint32[K+8]=U,this.uint16[W+18]=D,this.uint16[W+19]=B,a}}qm.prototype.bytesPerElement=40,Un(qm,"StructArrayLayout5i4f1i1ul2ui40");class cp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R){const k=this.length;return this.resize(k+1),this.emplace(k,a,u,p,_,m,x,R)}emplace(a,u,p,_,m,x,R,k){const V=8*a;return this.int16[V+0]=u,this.int16[V+1]=p,this.int16[V+2]=_,this.int16[V+4]=m,this.int16[V+5]=x,this.int16[V+6]=R,this.int16[V+7]=k,a}}cp.prototype.bytesPerElement=16,Un(cp,"StructArrayLayout3i2i2i16");class ku extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m){const x=this.length;return this.resize(x+1),this.emplace(x,a,u,p,_,m)}emplace(a,u,p,_,m,x){const R=4*a,k=8*a;return this.float32[R+0]=u,this.float32[R+1]=p,this.float32[R+2]=_,this.int16[k+6]=m,this.int16[k+7]=x,a}}ku.prototype.bytesPerElement=16,Un(ku,"StructArrayLayout2f1f2i16");class ll extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,p,_,m,x)}emplace(a,u,p,_,m,x,R){const k=20*a,V=5*a;return this.uint8[k+0]=u,this.uint8[k+1]=p,this.float32[V+1]=_,this.float32[V+2]=m,this.float32[V+3]=x,this.float32[V+4]=R,a}}ll.prototype.bytesPerElement=20,Un(ll,"StructArrayLayout2ub4f20");class ss extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,u,p)}emplace(a,u,p,_){const m=3*a;return this.uint16[m+0]=u,this.uint16[m+1]=p,this.uint16[m+2]=_,a}}ss.prototype.bytesPerElement=6,Un(ss,"StructArrayLayout3ui6");class Ih extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de){const ge=this.length;return this.resize(ge+1),this.emplace(ge,a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de)}emplace(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de,ge){const Te=30*a,Ve=15*a,Oe=60*a;return this.int16[Te+0]=u,this.int16[Te+1]=p,this.int16[Te+2]=_,this.float32[Ve+2]=m,this.float32[Ve+3]=x,this.uint16[Te+8]=R,this.uint16[Te+9]=k,this.uint32[Ve+5]=V,this.uint32[Ve+6]=b,this.uint32[Ve+7]=O,this.uint16[Te+16]=U,this.uint16[Te+17]=D,this.uint16[Te+18]=B,this.float32[Ve+10]=W,this.float32[Ve+11]=K,this.uint8[Oe+48]=J,this.uint8[Oe+49]=se,this.uint8[Oe+50]=oe,this.uint32[Ve+13]=te,this.int16[Te+28]=de,this.uint8[Oe+58]=ge,a}}Ih.prototype.bytesPerElement=60,Un(Ih,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class up extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct,dt,xt){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct,dt,xt)}emplace(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J,se,oe,te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct,dt,xt,Rt){const It=20*a,Et=40*a,en=80*a;return this.float32[It+0]=u,this.float32[It+1]=p,this.int16[Et+4]=_,this.int16[Et+5]=m,this.int16[Et+6]=x,this.int16[Et+7]=R,this.int16[Et+8]=k,this.int16[Et+9]=V,this.int16[Et+10]=b,this.int16[Et+11]=O,this.int16[Et+12]=U,this.uint16[Et+13]=D,this.uint16[Et+14]=B,this.uint16[Et+15]=W,this.uint16[Et+16]=K,this.uint16[Et+17]=J,this.uint16[Et+18]=se,this.uint16[Et+19]=oe,this.uint16[Et+20]=te,this.uint16[Et+21]=de,this.uint16[Et+22]=ge,this.uint16[Et+23]=Te,this.uint16[Et+24]=Ve,this.uint16[Et+25]=Oe,this.uint16[Et+26]=Ne,this.uint16[Et+27]=st,this.uint32[It+14]=ke,this.float32[It+15]=et,this.float32[It+16]=ct,this.float32[It+17]=dt,this.float32[It+18]=xt,this.uint8[en+76]=Rt,a}}up.prototype.bytesPerElement=80,Un(up,"StructArrayLayout2f9i15ui1ul4f1ub80");class tu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}tu.prototype.bytesPerElement=4,Un(tu,"StructArrayLayout1f4");class Dh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m){const x=this.length;return this.resize(x+1),this.emplace(x,a,u,p,_,m)}emplace(a,u,p,_,m,x){const R=5*a;return this.float32[R+0]=u,this.float32[R+1]=p,this.float32[R+2]=_,this.float32[R+3]=m,this.float32[R+4]=x,a}}Dh.prototype.bytesPerElement=20,Un(Dh,"StructArrayLayout5f20");class Kv extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R){const k=this.length;return this.resize(k+1),this.emplace(k,a,u,p,_,m,x,R)}emplace(a,u,p,_,m,x,R,k){const V=7*a;return this.float32[V+0]=u,this.float32[V+1]=p,this.float32[V+2]=_,this.float32[V+3]=m,this.float32[V+4]=x,this.float32[V+5]=R,this.float32[V+6]=k,a}}Kv.prototype.bytesPerElement=28,Un(Kv,"StructArrayLayout7f28");class hp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O){const U=this.length;return this.resize(U+1),this.emplace(U,a,u,p,_,m,x,R,k,V,b,O)}emplace(a,u,p,_,m,x,R,k,V,b,O,U){const D=11*a;return this.float32[D+0]=u,this.float32[D+1]=p,this.float32[D+2]=_,this.float32[D+3]=m,this.float32[D+4]=x,this.float32[D+5]=R,this.float32[D+6]=k,this.float32[D+7]=V,this.float32[D+8]=b,this.float32[D+9]=O,this.float32[D+10]=U,a}}hp.prototype.bytesPerElement=44,Un(hp,"StructArrayLayout11f44");class Yv extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V){const b=this.length;return this.resize(b+1),this.emplace(b,a,u,p,_,m,x,R,k,V)}emplace(a,u,p,_,m,x,R,k,V,b){const O=9*a;return this.float32[O+0]=u,this.float32[O+1]=p,this.float32[O+2]=_,this.float32[O+3]=m,this.float32[O+4]=x,this.float32[O+5]=R,this.float32[O+6]=k,this.float32[O+7]=V,this.float32[O+8]=b,a}}Yv.prototype.bytesPerElement=36,Un(Yv,"StructArrayLayout9f36");class kl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,_){const m=this.length;return this.resize(m+1),this.emplace(m,a,u,p,_)}emplace(a,u,p,_,m){const x=6*a;return this.uint32[3*a+0]=u,this.uint16[x+2]=p,this.uint16[x+3]=_,this.uint16[x+4]=m,a}}kl.prototype.bytesPerElement=12,Un(kl,"StructArrayLayout1ul3ui12");class Jv extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}Jv.prototype.bytesPerElement=2,Un(Jv,"StructArrayLayout1ui2");class Nl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const _=2*a;return this.float32[_+0]=u,this.float32[_+1]=p,a}}Nl.prototype.bytesPerElement=8,Un(Nl,"StructArrayLayout2f8");class Jd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K){const J=this.length;return this.resize(J+1),this.emplace(J,a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K)}emplace(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J){const se=16*a;return this.float32[se+0]=u,this.float32[se+1]=p,this.float32[se+2]=_,this.float32[se+3]=m,this.float32[se+4]=x,this.float32[se+5]=R,this.float32[se+6]=k,this.float32[se+7]=V,this.float32[se+8]=b,this.float32[se+9]=O,this.float32[se+10]=U,this.float32[se+11]=D,this.float32[se+12]=B,this.float32[se+13]=W,this.float32[se+14]=K,this.float32[se+15]=J,a}}Jd.prototype.bytesPerElement=64,Un(Jd,"StructArrayLayout16f64");class ra extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,_,m,x,R){const k=this.length;return this.resize(k+1),this.emplace(k,a,u,p,_,m,x,R)}emplace(a,u,p,_,m,x,R,k){const V=10*a,b=5*a;return this.uint16[V+0]=u,this.uint16[V+1]=p,this.uint16[V+2]=_,this.uint16[V+3]=m,this.float32[b+2]=x,this.float32[b+3]=R,this.float32[b+4]=k,a}}ra.prototype.bytesPerElement=20,Un(ra,"StructArrayLayout4ui3f20");class Zm extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.int16[1*a+0]=u,a}}Zm.prototype.bytesPerElement=2,Un(Zm,"StructArrayLayout1i2");class dp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint8[1*a+0]=u,a}}dp.prototype.bytesPerElement=1,Un(dp,"StructArrayLayout1ub1");class r0 extends sl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}r0.prototype.size=40;class Xm extends qm{get(a){return new r0(this,a)}}Un(Xm,"CollisionBoxArray");class Qd extends sl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}Qd.prototype.size=60;class Km extends Ih{get(a){return new Qd(this,a)}}Un(Km,"PlacedSymbolArray");class s0 extends sl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}s0.prototype.size=80;class Na extends up{get(a){return new s0(this,a)}}Un(Na,"SymbolInstanceArray");class Ym extends tu{getoffsetX(a){return this.float32[1*a+0]}}Un(Ym,"GlyphOffsetArray");class Jm extends ol{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}Un(Jm,"SymbolLineVertexArray");class nu extends sl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nu.prototype.size=12;class fp extends kl{get(a){return new nu(this,a)}}Un(fp,"FeatureIndexArray");class Nu extends xa{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}Un(Nu,"FillExtrusionCentroidArray");class pp extends sl{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}pp.prototype.size=6;class mp extends Xd{get(a){return new pp(this,a)}}Un(mp,"FillExtrusionWallArray");const Qv=Qi([{name:"a_pos",components:2,type:"Int16"}],4),Vw=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Is{constructor(a=[]){this.segments=a}_prepareSegment(a,u,p,_){let m=this.segments[this.segments.length-1];return a>Is.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${Is.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!m||m.vertexLength+a>Is.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==_)&&(m={vertexOffset:u,primitiveOffset:p,vertexLength:0,primitiveLength:0},_!==void 0&&(m.sortKey=_),this.segments.push(m)),m}prepareSegment(a,u,p,_){return this._prepareSegment(a,u.length,p.length,_)}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,p,_){return new Is([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function ey(d,a){return 256*(d=yt(Math.floor(d),0,255))+yt(Math.floor(a),0,255)}Is.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Un(Is,"SegmentVector");const o0=Qi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),a0=Qi([{name:"a_dash",components:4,type:"Uint16"}]);class Fh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,u,p,_){this.ids.push(l0(a)),this.positions.push(u,p,_)}eachPosition(a,u){const p=l0(a);let _=0,m=this.ids.length-1;for(;_<m;){const x=_+m>>1;this.ids[x]>=p?m=x:_=x+1}for(;this.ids[_]===p;)u(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(a,u){const p=new Float64Array(a.ids),_=new Uint32Array(a.positions);return ef(p,_,0,p.length-1),u&&(u.add(p.buffer),u.add(_.buffer)),{ids:p,positions:_}}static deserialize(a){const u=new Fh;let p;u.ids=a.ids,u.positions=a.positions;for(const _ of u.ids)_!==p&&u.uniqueIds.push(_),p=_;return u.indexed=!0,u}}function l0(d){const a=+d;return!isNaN(a)&&Number.MIN_SAFE_INTEGER<=a&&a<=Number.MAX_SAFE_INTEGER?a:Qo(String(d))}function ef(d,a,u,p){for(;u<p;){const _=d[u+p>>1];let m=u-1,x=p+1;for(;;){do m++;while(d[m]<_);do x--;while(d[x]>_);if(m>=x)break;T(d,m,x),T(a,3*m,3*x),T(a,3*m+1,3*x+1),T(a,3*m+2,3*x+2)}x-u<p-x?(ef(d,a,u,x),u=x+1):(ef(d,a,x+1,p),p=x)}}function T(d,a,u){const p=d[a];d[a]=d[u],d[u]=p}Un(Fh,"FeaturePositionMap");class A{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,u),this.initialized=!0),!!this.location}set(a,u,p){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Z extends A{constructor(a){super(a),this.current=0}set(a,u,p){this.fetchUniformLocation(a,u)&&this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}}class ne extends A{constructor(a){super(a),this.current=0}set(a,u,p){this.fetchUniformLocation(a,u)&&this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class me extends A{constructor(a){super(a),this.current=[0,0]}set(a,u,p){this.fetchUniformLocation(a,u)&&(p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1])))}}class Ae extends A{constructor(a){super(a),this.current=[0,0,0]}set(a,u,p){this.fetchUniformLocation(a,u)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2])))}}class _t extends A{constructor(a){super(a),this.current=[0,0,0,0]}set(a,u,p){this.fetchUniformLocation(a,u)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3])))}}class Jt extends A{constructor(a){super(a),this.current=Mr.transparent.toRenderColor(null)}set(a,u,p){this.fetchUniformLocation(a,u)&&(p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a)))}}const Sn=new Float32Array(16);class Kn extends A{constructor(a){super(a),this.current=Sn}set(a,u,p){if(this.fetchUniformLocation(a,u)){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let _=1;_<16;_++)if(p[_]!==this.current[_]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}}}const Ai=new Float32Array(9),pr=new Float32Array(4);class Gi extends A{constructor(a){super(a),this.current=pr}set(a,u,p){if(this.fetchUniformLocation(a,u)){for(let _=0;_<4;_++)if(p[_]!==this.current[_]){this.current=p,this.gl.uniformMatrix2fv(this.location,!1,p);break}}}}function vs(d){return[ey(255*d.r,255*d.g),ey(255*d.b,255*d.a)]}class Fi{constructor(a,u,p,_){this.value=a,this.uniformNames=u.map(m=>`u_${m}`),this.type=p,this.context=_}setUniform(a,u,p,_,m){const x=_.constantOr(this.value);u.set(a,m,x instanceof Mr?x.toRenderColor(this.context.lut):x)}getBinding(a,u){return this.type==="color"?new Jt(a):new ne(a)}}class io{constructor(a,u){this.uniformNames=u.map(p=>`u_${p}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(a){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br)}setUniform(a,u,p,_,m){const x=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;x&&u.set(a,m,x)}getBinding(a,u){return u==="u_pattern"||u==="u_dash"?new _t(a):new ne(a)}}class po{constructor(a,u,p,_){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(m=>({name:`a_${m}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(a,u,p,_,m,x,R){const k=this.paintVertexArray.length,V=this.expression.evaluate(new gs(0,{brightness:x}),u,{},m,_,R);this.paintVertexArray.resize(a),this._setPaintValue(k,a,V,this.context)}updatePaintArray(a,u,p,_,m,x,R){const k=this.expression.evaluate({zoom:0,brightness:R},p,_,void 0,m);this._setPaintValue(a,u,k,this.context)}_setPaintValue(a,u,p,_){if(this.type==="color"){const m=vs(p.toRenderColor(_.lut));for(let x=a;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1])}else{for(let m=a;m<u;m++)this.paintVertexArray.emplace(m,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cn{constructor(a,u,p,_,m,x){this.expression=a,this.uniformNames=u.map(R=>`u_${R}_t`),this.type=p,this.useIntegerZoom=_,this.context=m,this.maxValue=0,this.paintVertexAttributes=u.map(R=>({name:`a_${R}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(a,u,p,_,m,x,R){const k=this.expression.evaluate(new gs(this.context.zoom,{brightness:x}),u,{},m,_,R),V=this.expression.evaluate(new gs(this.context.zoom+1,{brightness:x}),u,{},m,_,R),b=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(b,a,k,V,this.context)}updatePaintArray(a,u,p,_,m,x,R){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:R},p,_,void 0,m),V=this.expression.evaluate({zoom:this.context.zoom+1,brightness:R},p,_,void 0,m);this._setPaintValue(a,u,k,V,this.context)}_setPaintValue(a,u,p,_,m){if(this.type==="color"){const x=vs(p.toRenderColor(m.lut)),R=vs(p.toRenderColor(m.lut));for(let k=a;k<u;k++)this.paintVertexArray.emplace(k,x[0],x[1],R[0],R[1])}else{for(let x=a;x<u;x++)this.paintVertexArray.emplace(x,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u,p,_,m){const x=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,R=yt(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);u.set(a,m,R)}getBinding(a,u){return new ne(a)}}class Qt{constructor(a,u,p,_,m){this.expression=a,this.layerId=m,this.paintVertexAttributes=(p==="array"?a0:o0).members;for(let x=0;x<u.length;++x);this.paintVertexArray=new _}populatePaintArray(a,u,p,_){const m=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(m,a,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(a,u,p,_,m,x,R){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(a,u,p,_){if(!_||!p)return;const m=_[p];if(!m)return;const{tl:x,br:R,pixelRatio:k}=m;for(let V=a;V<u;V++)this.paintVertexArray.emplace(V,x[0],x[1],R[0],R[1],k)}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gn{constructor(a,u,p=()=>!0){this.binders={},this._buffers=[],this.context=u;const _=[];for(const m in a.paint._values){const x=a.paint.get(m);if(!p(m)||!(x instanceof xc&&So(x.property.specification)))continue;const R=Sr(m,a.type),k=x.value,V=x.property.specification.type,b=!!x.property.useIntegerZoom,O=m==="line-dasharray"||m.endsWith("pattern"),U=m==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant";if(k.kind!=="constant"||U)if(k.kind==="source"||U||O){const D=Ro(m,V,"source");this.binders[m]=O?new Qt(k,R,V,D,a.id):new po(k,R,V,D),_.push(`/a_${m}`)}else{const D=Ro(m,V,"composite");this.binders[m]=new cn(k,R,V,b,u,D),_.push(`/z_${m}`)}else this.binders[m]=O?new io(k.value,R):new Fi(k.value,R,V,u),_.push(`/u_${m}`)}this.cacheKey=_.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof po||u instanceof cn?u.maxValue:0}populatePaintArrays(a,u,p,_,m,x,R){for(const k in this.binders){const V=this.binders[k];V.context=this.context,(V instanceof po||V instanceof cn||V instanceof Qt)&&V.populatePaintArray(a,u,p,_,m,x,R)}}setConstantPatternPositions(a){for(const u in this.binders){const p=this.binders[u];p instanceof io&&p.setConstantPatternPositions(a)}}updatePaintArrays(a,u,p,_,m,x,R,k){let V=!1;const b=Object.keys(a),O=b.length!==0,U=O?b:u.uniqueIds;this.context.lut=m.lut;for(const D in this.binders){const B=this.binders[D];if(B.context=this.context,(B instanceof po||B instanceof cn||B instanceof Qt)&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const W=m.paint.get(D);B.expression=W.value;for(const K of U){const J=a[K.toString()];u.eachPosition(K,(se,oe,te)=>{const de=_.feature(se);B.updatePaintArray(oe,te,de,J,x,R,k)})}if(!O)for(const K of p.uniqueIds){const J=a[K.toString()];p.eachPosition(K,(se,oe,te)=>{const de=_.feature(se);B.updatePaintArray(oe,te,de,J,x,R,k)})}V=!0}}return V}defines(){const a=[];for(const u in this.binders){const p=this.binders[u];(p instanceof Fi||p instanceof io)&&a.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof po||p instanceof cn||p instanceof Qt)for(let _=0;_<p.paintVertexAttributes.length;_++)a.push(p.paintVertexAttributes[_].name)}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Fi||p instanceof io||p instanceof cn)for(const _ of p.uniformNames)a.push(_)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const u=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof Fi||_ instanceof io||_ instanceof cn)for(const m of _.uniformNames)u.push({name:m,property:p,binding:_.getBinding(a,m)})}return u}setUniforms(a,u,p,_,m){for(const{name:x,property:R,binding:k}of p)this.binders[R].setUniform(a,k,m,_.get(R),x)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const u=this.binders[a];(u instanceof po||u instanceof cn||u instanceof Qt)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(a){for(const u in this.binders){const p=this.binders[u];(p instanceof po||p instanceof cn||p instanceof Qt)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof po||u instanceof cn||u instanceof Qt)&&u.destroy()}}}class ai{constructor(a,u,p=()=>!0){this.programConfigurations={};for(const _ of a)this.programConfigurations[_.id]=new gn(_,u,p);this.needsUpload=!1,this._featureMap=new Fh,this._featureMapWithoutIds=new Fh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,u,p,_,m,x,R,k){for(const V in this.programConfigurations)this.programConfigurations[V].populatePaintArrays(a,u,_,m,x,R,k);u.id!==void 0?this._featureMap.add(u.id,p,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,p,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,p,_,m,x){for(const R of p)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,u,R,_,m,x||0)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const Bi={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sr(d,a){return Bi[d]||[d.replace(`${a}-`,"").replace(/-/g,"_")]}const yr={"line-pattern":{source:al,composite:al},"fill-pattern":{source:al,composite:al},"fill-extrusion-pattern":{source:al,composite:al},"line-dasharray":{source:ia,composite:ia}},es={color:{source:Nl,composite:pa},number:{source:tu,composite:Nl}};function Ro(d,a,u){const p=yr[d];return p&&p[u]||es[a][u]}Un(Fi,"ConstantBinder"),Un(io,"PatternConstantBinder"),Un(po,"SourceExpressionBinder"),Un(Qt,"PatternCompositeBinder"),Un(cn,"CompositeExpressionBinder"),Un(gn,"ProgramConfiguration",{omit:["_buffers"]}),Un(ai,"ProgramConfigurationSet");const rr=Mn/Math.PI/2,iu=5,g=6,l=16383,h=64,y=[h,32,16],S=-rr,E=rr;function I(d,a,u,p=rr){return u=xe(u),[d*Math.sin(u)*p,-a*p,d*Math.cos(u)*p]}function G(d,a,u){return I(Math.cos(xe(d)),Math.sin(xe(d)),a,u)}const $=63710088e-1,Y=2*Math.PI*$;class X{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new X(jt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,p=this.lat*u,_=a.lat*u,m=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((a.lng-this.lng)*u);return $*Math.acos(Math.min(m,1))}toBounds(a=0){const u=360*a/40075017,p=u/Math.cos(Math.PI/180*this.lat);return new ee({lng:this.lng-p,lat:this.lat-u},{lng:this.lng+p,lat:this.lat+u})}toEcef(a){return G(this.lat,this.lng,rr+a*rr/$)}static convert(a){if(a instanceof X)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new X(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new X(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ee{constructor(a,u){if(a)if(u)this.setSouthWest(a).setNorthEast(u);else if(a.length===4){const p=a;this.setSouthWest([p[0],p[1]]).setNorthEast([p[2],p[3]])}else{const p=a;this.setSouthWest(p[0]).setNorthEast(p[1])}}setNorthEast(a){return this._ne=a instanceof X?new X(a.lng,a.lat):X.convert(a),this}setSouthWest(a){return this._sw=a instanceof X?new X(a.lng,a.lat):X.convert(a),this}extend(a){const u=this._sw,p=this._ne;let _,m;if(a instanceof X)_=a,m=a;else{if(!(a instanceof ee))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(ee.convert(a)):this.extend(X.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(X.convert(a)):this;if(_=a._sw,m=a._ne,!_||!m)return this}return u||p?(u.lng=Math.min(_.lng,u.lng),u.lat=Math.min(_.lat,u.lat),p.lng=Math.max(m.lng,p.lng),p.lat=Math.max(m.lat,p.lat)):(this._sw=new X(_.lng,_.lat),this._ne=new X(m.lng,m.lat)),this}getCenter(){return new X((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new X(this.getWest(),this.getNorth())}getSouthEast(){return new X(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:u,lat:p}=X.convert(a);let _=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_}static convert(a){if(a)return a instanceof ee?a:new ee(a)}}const ie=0,he=25.5;function ye(d){return Y*Math.cos(d*Math.PI/180)}function ve(d){return(180+d)/360}function be(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function Ce(d,a){return d/ye(a)}function Fe(d){return 360*d-180}function ze(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Ue(d,a){return d*ye(ze(a))}const Ze=85.051129;function Ke(d){return Math.cos(xe(yt(d,-Ze,Ze)))}function Xe(d,a){const u=yt(a,ie,he),p=Math.pow(2,u);return Ke(d)*Y/(512*p)}function Je(d){return 1/Math.cos(d*Math.PI/180)}function ot(d,a=0){const u=Math.exp(Math.PI*(1-(d.y+a/Mn)/(1<<d.z)*2));return 80150034*u/(u*u+1)/Mn/(1<<d.z)}class mt{constructor(a,u,p=0){this.x=+a,this.y=+u,this.z=+p}static fromLngLat(a,u=0){const p=X.convert(a);return new mt(ve(p.lng),be(p.lat),Ce(u,p.lat))}toLngLat(){return new X(Fe(this.x),ze(this.y))}toAltitude(){return Ue(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Y*Je(ze(this.y))}}function lt(d,a,u,p,_,m,x,R,k){const V=(a+p)/2,b=(u+_)/2,O=new _e(V,b);R(O),function(U,D,B,W,K,J){const se=B-K,oe=W-J;return Math.abs((W-D)*se-(B-U)*oe)/Math.hypot(se,oe)}(O.x,O.y,m.x,m.y,x.x,x.y)>=k?(lt(d,a,u,V,b,m,O,R,k),lt(d,V,b,p,_,O,x,R,k)):d.push(x)}function at(d,a,u){let p=d[0],_=p.x,m=p.y;a(p);const x=[p];for(let R=1;R<d.length;R++){const k=d[R],{x:V,y:b}=k;a(k),lt(x,_,m,V,b,p,k,a,u),_=V,m=b,p=k}return x}function Nt(d,a,u,p){if(p(a,u)){const _=a.add(u)._mult(.5);Nt(d,a,_,p),Nt(d,_,u,p)}else d.push(u)}function qt(d,a){let u=d[0];const p=[u];for(let _=1;_<d.length;_++){const m=d[_];Nt(p,u,m,a),u=m}return p}const ln=Math.pow(2,14)-1,_n=-ln-1;function En(d,a){const u=Math.round(d.x*a),p=Math.round(d.y*a);return d.x=yt(u,_n,ln),d.y=yt(p,_n,ln),(u<d.x||u>d.x+1||p<d.y||p>d.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function Ct(d,a,u){const p=d.loadGeometry(),_=d.extent,m=Mn/_;if(a&&u&&u.projection.isReprojectedInTileSpace){const x=1<<a.z,{scale:R,x:k,y:V,projection:b}=u,O=U=>{const D=Fe((a.x+U.x/_)/x),B=ze((a.y+U.y/_)/x),W=b.project(D,B);U.x=(W.x*R-k)*_,U.y=(W.y*R-V)*_};for(let U=0;U<p.length;U++)if(d.type!==1)p[U]=at(p[U],O,1);else{const D=[];for(const B of p[U])B.x<0||B.x>=_||B.y<0||B.y>=_||(O(B),D.push(B));p[U]=D}}for(const x of p)for(const R of x)En(R,m);return p}function on(d,a){return{type:d.type,id:d.id,properties:d.properties,geometry:a?Ct(d):[]}}function Vt(d,a,u,p,_){d.emplaceBack(2*a+(p+1)/2,2*u+(_+1)/2)}function an(d,a,u){d.emplaceBack(a.x,a.y,a.z,u[0]*16384,u[1]*16384,u[2]*16384)}class un{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new ol,this.indexArray=new ss,this.segments=new Is,this.programConfigurations=new ai(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}updateFootprints(a,u){}populate(a,u,p,_){const m=this.layers[0],x=[];let R=null;m.type==="circle"&&(R=m.layout.get("circle-sort-key"));for(const{feature:V,id:b,index:O,sourceLayerIndex:U}of a){const D=this.layers[0]._featureFilter.needGeometry,B=on(V,D);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),B,p))continue;const W=R?R.evaluate(B,{},p):void 0,K={id:b,properties:V.properties,type:V.type,sourceLayerIndex:U,index:O,geometry:D?B.geometry:Ct(V,p,_),patterns:{},sortKey:W};x.push(K)}R&&x.sort((V,b)=>V.sortKey-b.sortKey);let k=null;_.projection.name==="globe"&&(this.globeExtVertexArray=new Yd,k=_.projection);for(const V of x){const{geometry:b,index:O,sourceLayerIndex:U}=V,D=a[O].feature;this.addFeature(V,b,O,u.availableImages,p,k,u.brightness),u.featureIndex.insert(D,b,O,U,this.index)}}update(a,u,p,_,m){const x=Object.keys(a).length!==0;x&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(a,u,x?this.stateDependentLayers:this.layers,p,_,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Qv.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Vw.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(a,u,p,_,m,x,R){for(const k of u)for(const V of k){const b=V.x,O=V.y;if(b<0||b>=Mn||O<0||O>=Mn)continue;if(x){const B=x.projectTilePoint(b,O,m),W=x.upVector(m,b,O),K=this.globeExtVertexArray;an(K,B,W),an(K,B,W),an(K,B,W),an(K,B,W)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),D=U.vertexLength;Vt(this.layoutVertexArray,b,O,-1,-1),Vt(this.layoutVertexArray,b,O,1,-1),Vt(this.layoutVertexArray,b,O,1,1),Vt(this.layoutVertexArray,b,O,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},_,m,R)}}function sn(d,a){for(let u=0;u<d.length;u++)if(sr(a,d[u]))return!0;for(let u=0;u<a.length;u++)if(sr(d,a[u]))return!0;return!!jn(d,a)}function Pn(d,a,u){return!!sr(d,a)||!!On(a,d,u)}function Qn(d,a){if(d.length===1)return Oi(a,d[0]);for(let u=0;u<a.length;u++){const p=a[u];for(let _=0;_<p.length;_++)if(sr(d,p[_]))return!0}for(let u=0;u<d.length;u++)if(Oi(a,d[u]))return!0;for(let u=0;u<a.length;u++)if(jn(d,a[u]))return!0;return!1}function ri(d,a,u){if(d.length>1){if(jn(d,a))return!0;for(let p=0;p<a.length;p++)if(On(a[p],d,u))return!0}for(let p=0;p<d.length;p++)if(On(d[p],a,u))return!0;return!1}function jn(d,a){if(d.length===0||a.length===0)return!1;for(let u=0;u<d.length-1;u++){const p=d[u],_=d[u+1];for(let m=0;m<a.length-1;m++)if(li(p,_,a[m],a[m+1]))return!0}return!1}function li(d,a,u,p){return Wt(d,u,p)!==Wt(a,u,p)&&Wt(d,a,u)!==Wt(d,a,p)}function On(d,a,u){const p=u*u;if(a.length===1)return d.distSqr(a[0])<p;for(let _=1;_<a.length;_++)if(xi(d,a[_-1],a[_])<p)return!0;return!1}function xi(d,a,u){const p=a.distSqr(u);if(p===0)return d.distSqr(a);const _=((d.x-a.x)*(u.x-a.x)+(d.y-a.y)*(u.y-a.y))/p;return d.distSqr(_<0?a:_>1?u:u.sub(a)._mult(_)._add(a))}function Oi(d,a){let u,p,_,m=!1;for(let x=0;x<d.length;x++){u=d[x];for(let R=0,k=u.length-1;R<u.length;k=R++)p=u[R],_=u[k],p.y>a.y!=_.y>a.y&&a.x<(_.x-p.x)*(a.y-p.y)/(_.y-p.y)+p.x&&(m=!m)}return m}function sr(d,a){let u=!1;for(let p=0,_=d.length-1;p<d.length;_=p++){const m=d[p],x=d[_];m.y>a.y!=x.y>a.y&&a.x<(x.x-m.x)*(a.y-m.y)/(x.y-m.y)+m.x&&(u=!u)}return u}function jr(d,a,u,p,_){for(const x of d)if(a<=x.x&&u<=x.y&&p>=x.x&&_>=x.y)return!0;const m=[new _e(a,u),new _e(a,_),new _e(p,_),new _e(p,u)];if(d.length>2){for(const x of m)if(sr(d,x))return!0}for(let x=0;x<d.length-1;x++)if(_r(d[x],d[x+1],m))return!0;return!1}function _r(d,a,u){const p=u[0],_=u[2];if(d.x<p.x&&a.x<p.x||d.x>_.x&&a.x>_.x||d.y<p.y&&a.y<p.y||d.y>_.y&&a.y>_.y)return!1;const m=Wt(d,a,u[0]);return m!==Wt(d,a,u[1])||m!==Wt(d,a,u[2])||m!==Wt(d,a,u[3])}function ts(d,a,u,p,_,m){let x=a.y-d.y,R=d.x-a.x;if(m=m||0){const k=x*x+R*R;if(k===0)return!0;const V=Math.sqrt(k);x/=V,R/=V}return!((u.x-d.x)*x+(u.y-d.y)*R-m<0||(p.x-d.x)*x+(p.y-d.y)*R-m<0||(_.x-d.x)*x+(_.y-d.y)*R-m<0)}function br(d,a,u,p,_,m,x){return!(ts(d,a,p,_,m,x)||ts(a,u,p,_,m,x)||ts(u,d,p,_,m,x)||ts(p,_,d,a,u,x)||ts(_,m,d,a,u,x)||ts(m,p,d,a,u,x))}function $r(d,a,u){const p=a.paint.get(d).value;return p.kind==="constant"?p.value:u.programConfigurations.get(a.id).getMaxValue(d)}function Ki(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function Vr(d,a,u,p,_){if(!a[0]&&!a[1])return d;const m=_e.convert(a)._mult(_);u==="viewport"&&m._rotate(-p);const x=[];for(let R=0;R<d.length;R++)x.push(d[R].sub(m));return x}function Br(d,a,u,p){const _=_e.convert(d)._mult(p);return a==="viewport"&&_._rotate(-u),_}let Rr,us;Un(un,"CircleBucket",{omit:["layers"]});var mo,Bl={exports:{}},wc=(mo||(mo=1,function(d,a){(function(u){function p(m,x,R){var k=_(256*m,256*(x=Math.pow(2,R)-x-1),R),V=_(256*(m+1),256*(x+1),R);return k[0]+","+k[1]+","+V[0]+","+V[1]}function _(m,x,R){var k=2*Math.PI*6378137/256/Math.pow(2,R);return[m*k-2*Math.PI*6378137/2,x*k-2*Math.PI*6378137/2]}u.getURL=function(m,x,R,k,V,b){return b=b||{},m+"?"+["bbox="+p(R,k,V),"format="+(b.format||"image/png"),"service="+(b.service||"WMS"),"version="+(b.version||"1.1.1"),"request="+(b.request||"GetMap"),"srs="+(b.srs||"EPSG:3857"),"width="+(b.width||256),"height="+(b.height||256),"layers="+x].join("&")},u.getTileBBox=p,u.getMercCoords=_,Object.defineProperty(u,"__esModule",{value:!0})})(a)}(0,Bl.exports)),Bl.exports);class To{constructor(a,u,p){this.z=a,this.x=u,this.y=p,this.key=Er(0,a,a,u,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u){const p=wc.getTileBBox(this.x,this.y,this.z),_=function(m,x,R){let k,V="";for(let b=m;b>0;b--)k=1<<b-1,V+=(x&k?1:0)+(R&k?2:0);return V}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",p)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mr{constructor(a,u){this.wrap=a,this.canonical=u,this.key=Er(a,u.z,u.z,u.x,u.y)}}class ar{constructor(a,u,p,_,m){this.overscaledZ=a,this.wrap=u,this.canonical=new To(p,+_,+m),this.key=u===0&&a===p?this.canonical.key:Er(u,a,p,_,m)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const u=this.canonical.z-a;return a>this.canonical.z?new ar(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ar(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(a,u=!0){if(this.overscaledZ===a&&u)return this.key;if(a>this.canonical.z)return Er(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y);{const p=this.canonical.z-a;return Er(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new ar(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new ar(u,this.wrap,u,p,_),new ar(u,this.wrap,u,p+1,_),new ar(u,this.wrap,u,p,_+1),new ar(u,this.wrap,u,p+1,_+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new ar(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new ar(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Er(d,a,u,p,_){const m=1<<Math.min(u,22);let x=m*(_%m)+p%m;return d&&u<22&&(x+=m*m*((d<0?-2*d-1:2*d)%(1<<2*(22-u)))),16*(32*x+u)+(a-u)}const Xr=[d=>{let a=d.canonical.x-1,u=d.wrap;return a<0&&(a=(1<<d.canonical.z)-1,u--),new ar(d.overscaledZ,u,d.canonical.z,a,d.canonical.y)},d=>{let a=d.canonical.x+1,u=d.wrap;return a===1<<d.canonical.z&&(a=0,u++),new ar(d.overscaledZ,u,d.canonical.z,a,d.canonical.y)},d=>new ar(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(d.canonical.y===0?1<<d.canonical.z:d.canonical.y)-1),d=>new ar(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];Un(To,"CanonicalTileID"),Un(ar,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Us=Qi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:hs}=Us,Wo=Qi([{name:"a_pos_3",components:3,type:"Int16"}]);var Bu=Qi([{name:"a_pos",type:"Int16",components:2}]);class cl{constructor(a,u){this.pos=a,this.dir=u}intersectsPlane(a,u,p){const _=Re.vec3.dot(u,this.dir);if(Math.abs(_)<1e-6)return!1;const m=((a[0]-this.pos[0])*u[0]+(a[1]-this.pos[1])*u[1]+(a[2]-this.pos[2])*u[2])/_;return p[0]=this.pos[0]+this.dir[0]*m,p[1]=this.pos[1]+this.dir[1]*m,p[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(a,u,p){if(Re.vec3.equals(this.pos,a)||u===0)return p[0]=p[1]=p[2]=0,!1;const[_,m,x]=this.dir,R=this.pos[0]-a[0],k=this.pos[1]-a[1],V=this.pos[2]-a[2],b=_*_+m*m+x*x,O=2*(R*_+k*m+V*x),U=O*O-4*b*(R*R+k*k+V*V-u*u);if(U<0){const D=Math.max(-O/2,0),B=R+_*D,W=k+m*D,K=V+x*D,J=Math.hypot(B,W,K);return p[0]=B*u/J,p[1]=W*u/J,p[2]=K*u/J,!1}{const D=(-O-Math.sqrt(U))/(2*b);if(D<0){const B=Math.hypot(R,k,V);return p[0]=R*u/B,p[1]=k*u/B,p[2]=V*u/B,!1}return p[0]=R+_*D,p[1]=k+m*D,p[2]=V+x*D,!0}}}class ul{constructor(a,u,p,_,m){this.TL=a,this.TR=u,this.BR=p,this.BL=_,this.horizon=m}static fromInvProjectionMatrix(a,u,p){const _=[-1,1,1],m=[1,1,1],x=[1,-1,1],R=[-1,-1,1],k=Re.vec3.transformMat4(_,_,a),V=Re.vec3.transformMat4(m,m,a),b=Re.vec3.transformMat4(x,x,a),O=Re.vec3.transformMat4(R,R,a);return new ul(k,V,b,O,u/p)}}function Cc(d,a,u){let p=1/0,_=-1/0;const m=[];for(const x of d){Re.vec3.sub(m,x,a);const R=Re.vec3.dot(m,u);p=Math.min(p,R),_=Math.max(_,R)}return[p,_]}function ru(d,a){let u=!0;for(let p=0;p<d.planes.length;p++){const _=d.planes[p];let m=0;for(let x=0;x<a.length;x++)m+=Re.vec3.dot(_,a[x])+_[3]>=0;if(m===0)return 0;m!==a.length&&(u=!1)}return u?2:1}function hl(d,a){for(const u of d.projections){const p=Cc(a,d.points[0],u.axis);if(u.projection[1]<p[0]||u.projection[0]>p[1])return 0}return 1}function Lh(d,a){let u=0;const p=[0,0,0,0];for(let _=0;_<d.length;_++)p[0]=d[_][0],p[1]=d[_][1],p[2]=d[_][2],p[3]=1,Re.vec4.dot(p,a)>=0&&u++;return u}class Sc{constructor(a,u){this.points=a||new Array(8).fill([0,0,0]),this.planes=u||new Array(6).fill([0,0,0,0]),this.bounds=Ir.fromPoints(this.points),this.projections=[],this.frustumEdges=[Re.vec3.sub([],this.points[2],this.points[3]),Re.vec3.sub([],this.points[0],this.points[3]),Re.vec3.sub([],this.points[4],this.points[0]),Re.vec3.sub([],this.points[5],this.points[1]),Re.vec3.sub([],this.points[6],this.points[2]),Re.vec3.sub([],this.points[7],this.points[3])];for(const p of this.frustumEdges){const _=[0,-p[2],p[1]],m=[p[2],0,-p[0]];this.projections.push({axis:_,projection:Cc(this.points,this.points[0],_)}),this.projections.push({axis:m,projection:Cc(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(a,u,p,_){const m=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(V=>{const b=Re.vec4.transformMat4([],V,a),O=1/b[3]/u*m;return Re.vec4.mul(b,b,[O,O,_?1/b[3]:O,O])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(V=>{const b=Re.vec3.sub([],x[V[0]],x[V[1]]),O=Re.vec3.sub([],x[V[2]],x[V[1]]),U=Re.vec3.normalize([],Re.vec3.cross([],b,O)),D=-Re.vec3.dot(U,x[V[1]]);return U.concat(D)}),k=[];for(let V=0;V<x.length;V++)k.push([x[V][0],x[V][1],x[V][2]]);return new Sc(k,R)}intersectsPrecise(a,u,p){for(let _=0;_<u.length;_++)if(!Lh(a,u[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!Lh(a,this.planes[_]))return 0;for(const _ of p)for(const m of this.frustumEdges){const x=Re.vec3.cross([],_,m),R=Re.vec3.length(x);if(R===0)continue;Re.vec3.scale(x,x,1/R);const k=Cc(this.points,this.points[0],x),V=Cc(a,this.points[0],x);if(k[0]>V[1]||V[0]>k[1])return 0}return 1}containsPoint(a){for(const u of this.planes){const p=u[3];if(Re.vec3.dot([u[0],u[1],u[2]],a)+p<0)return!1}return!0}}class Ir{static fromPoints(a){const u=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];for(const _ of a)Re.vec3.min(u,u,_),Re.vec3.max(p,p,_);return new Ir(u,p)}static fromTileIdAndHeight(a,u,p){const _=1<<a.canonical.z,m=a.canonical.x,x=a.canonical.y;return new Ir([m/_,x/_,u],[(m+1)/_,(x+1)/_,p])}static applyTransform(a,u){const p=a.getCorners();for(let _=0;_<p.length;++_)Re.vec3.transformMat4(p[_],p[_],u);return Ir.fromPoints(p)}static applyTransformFast(a,u){const p=[u[12],u[13],u[14]],_=[...p];for(let m=0;m<3;m++)for(let x=0;x<3;x++){const R=u[4*x+m],k=R*a.min[x],V=R*a.max[x];p[m]+=Math.min(k,V),_[m]+=Math.max(k,V)}return new Ir(p,_)}static projectAabbCorners(a,u){const p=a.getCorners();for(let _=0;_<p.length;++_)Re.vec3.transformMat4(p[_],p[_],u);return p}constructor(a,u){this.min=a,this.max=u,this.center=Re.vec3.scale([],Re.vec3.add([],this.min,this.max),.5)}quadrant(a){const u=[a%2==0,a<2],p=Re.vec3.clone(this.min),_=Re.vec3.clone(this.max);for(let m=0;m<u.length;m++)p[m]=u[m]?this.min[m]:this.center[m],_[m]=u[m]?this.center[m]:this.max[m];return _[2]=this.max[2],new Ir(p,_)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,u=this.max;return[[a[0],a[1],a[2]],[u[0],a[1],a[2]],[u[0],u[1],a[2]],[a[0],u[1],a[2]],[a[0],a[1],u[2]],[u[0],a[1],u[2]],[u[0],u[1],u[2]],[a[0],u[1],u[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?ru(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?ru(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,u){return u||this.intersects(a)?hl(a,this.getCorners()):0}intersectsPreciseFlat(a,u){return u||this.intersectsFlat(a)?hl(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let u=0;u<3;++u)if(this.min[u]>a.max[u]||a.min[u]>this.max[u])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let u=0;u<3;u++)this.min[u]=Math.min(this.min[u],a.min[u]),this.max[u]=Math.max(this.max[u],a.max[u])}encapsulatePoint(a){for(let u=0;u<3;u++)this.min[u]=Math.min(this.min[u],a[u]),this.max[u]=Math.max(this.max[u],a[u])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}function Qm(d){return d*rr/$}Un(Ir,"Aabb");const Gw=[new Ir([S,S,S],[E,E,E]),new Ir([S,S,S],[0,0,E]),new Ir([0,S,S],[E,0,E]),new Ir([S,0,S],[0,E,E]),new Ir([0,0,S],[E,E,E])];function eg(d,a,u,p=!0){const _=Re.vec3.scale([],d._camera.position,d.worldSize),m=[a,u,1,1];Re.vec4.transformMat4(m,m,d.pixelMatrixInverse),Re.vec4.scale(m,m,1/m[3]);const x=Re.vec3.sub([],m,_),R=Re.vec3.normalize([],x),k=d.globeMatrix,V=[k[12],k[13],k[14]],b=Re.vec3.sub([],V,_),O=Re.vec3.length(b),U=Re.vec3.normalize([],b),D=d.worldSize/(2*Math.PI),B=Re.vec3.dot(U,R),W=Math.asin(D/O);if(W<Math.acos(B)){if(!p)return null;const st=[],ke=[];Re.vec3.scale(st,R,O/B),Re.vec3.normalize(ke,Re.vec3.sub(ke,st,b)),Re.vec3.normalize(R,Re.vec3.add(R,b,Re.vec3.scale(R,ke,Math.tan(W)*O)))}const K=[];new cl(_,R).closestPointOnSphere(V,D,K);const J=Re.vec3.normalize([],Xi(k,0)),se=Re.vec3.normalize([],Xi(k,1)),oe=Re.vec3.normalize([],Xi(k,2)),te=Re.vec3.dot(J,K),de=Re.vec3.dot(se,K),ge=Re.vec3.dot(oe,K),Te=Se(Math.asin(-de/D));let Ve=Se(Math.atan2(te,ge));Ve=d.center.lng+function(st,ke){const et=(ke-st+180)%360-180;return et<-180?et+360:et}(d.center.lng,Ve);const Oe=ve(Ve),Ne=yt(be(Te),0,1);return new mt(Oe,Ne)}class Hw{constructor(a,u,p){this.a=Re.vec3.sub([],a,p),this.b=Re.vec3.sub([],u,p),this.center=p;const _=Re.vec3.normalize([],this.a),m=Re.vec3.normalize([],this.b);this.angle=Math.acos(Re.vec3.dot(_,m))}}function ty(d,a){if(d.angle===0)return null;let u;return u=d.a[a]===0?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[a]/d.a[a]/Math.sin(d.angle)-1/Math.tan(d.angle)),u<0||u>1?null:function(p,_,m,x){const R=Math.sin(m);return p*(Math.sin((1-x)*m)/R)+_*(Math.sin(x*m)/R)}(d.a[a],d.b[a],d.angle,yt(u,0,1))+d.center[a]}function tf(d){if(d.z<=1)return Gw[d.z+2*d.y+d.x];const a=xP(xb(d));return Ir.fromPoints(a)}function gp(d,a,u){return Re.vec3.scale(d,d,1-u),Re.vec3.scaleAndAdd(d,d,a,u)}function xz(d,a,u){for(const p of d)Re.vec3.transformMat4(p,p,a),Re.vec3.scale(p,p,u)}function wz(d,a,u,p){const _=a/d.worldSize,m=d.globeMatrix;if(u.z<=1){const Oe=tf(u).getCorners();return xz(Oe,m,_),Ir.fromPoints(Oe)}const x=xb(u,p),R=xP(x,rr+Qm(d._tileCoverLift));xz(R,m,_);const k=Number.MAX_VALUE,V=[-k,-k,-k],b=[k,k,k];if(x.contains(d.center)){for(const st of R)Re.vec3.min(b,b,st),Re.vec3.max(V,V,st);V[2]=0;const Oe=d.point,Ne=[Oe.x*_,Oe.y*_,0];return Re.vec3.min(b,b,Ne),Re.vec3.max(V,V,Ne),new Ir(b,V)}if(d._tileCoverLift>0){for(const Oe of R)Re.vec3.min(b,b,Oe),Re.vec3.max(V,V,Oe);return new Ir(b,V)}const O=[m[12]*_,m[13]*_,m[14]*_],U=x.getCenter(),D=yt(d.center.lat,-Ze,Ze),B=yt(U.lat,-Ze,Ze),W=ve(d.center.lng),K=be(D);let J=W-ve(U.lng);const se=K-be(B);J>.5?J-=1:J<-.5&&(J+=1);let oe=0;if(Math.abs(J)>Math.abs(se))oe=J>=0?1:3;else{oe=se>=0?0:2;const Oe=[m[4]*_,m[5]*_,m[6]*_],Ne=-Math.sin(xe(se>=0?x.getSouth():x.getNorth()))*rr;Re.vec3.scaleAndAdd(O,O,Oe,Ne)}const te=R[oe],de=R[(oe+1)%4],ge=new Hw(te,de,O),Te=[ty(ge,0)||te[0],ty(ge,1)||te[1],ty(ge,2)||te[2]],Ve=tg(d.zoom);if(Ve>0){const Oe=function({x:st,y:ke,z:et},ct,dt,xt,Rt){const It=1/(1<<et);let Et=st*It,en=Et+It,dn=ke*It,Ht=dn+It,Vn=0;const Rn=(Et+en)/2-xt;return Rn>.5?Vn=-1:Rn<-.5&&(Vn=1),Et=((Et+Vn)*ct-(xt*=ct))*dt+xt,en=((en+Vn)*ct-xt)*dt+xt,dn=(dn*ct-(Rt*=ct))*dt+Rt,Ht=(Ht*ct-Rt)*dt+Rt,[[Et,Ht,0],[en,Ht,0],[en,dn,0],[Et,dn,0]]}(u,a,d._pixelsPerMercatorPixel,W,K);for(let st=0;st<R.length;st++)gp(R[st],Oe[st],Ve);const Ne=Re.vec3.add([],Oe[oe],Oe[(oe+1)%4]);Re.vec3.scale(Ne,Ne,.5),gp(Te,Ne,Ve)}for(const Oe of R)Re.vec3.min(b,b,Oe),Re.vec3.max(V,V,Oe);return b[2]=Math.min(te[2],de[2]),Re.vec3.min(b,b,Te),Re.vec3.max(V,V,Te),new Ir(b,V)}function xb({x:d,y:a,z:u},p=!1){const _=1/(1<<u),m=new X(Fe(d*_),a===(1<<u)-1&&p?-90:ze((a+1)*_)),x=new X(Fe((d+1)*_),a===0&&p?90:ze(a*_));return new ee(m,x)}function xP(d,a=rr){const u=xe(d.getNorth()),p=xe(d.getSouth()),_=Math.cos(u),m=Math.cos(p),x=Math.sin(u),R=Math.sin(p),k=d.getWest(),V=d.getEast();return[I(m,R,k,a),I(m,R,V,a),I(_,x,V,a),I(_,x,k,a)]}function Ww(d,a,u,p){const _=1<<u.z,m=(d/Mn+u.x)/_;return G(ze((a/Mn+u.y)/_),Fe(m),p)}function wb({min:d,max:a}){return l/Math.max(a[0]-d[0],a[1]-d[1],a[2]-d[2])}const Cz=new Float64Array(16);function Cb(d){const a=wb(d),u=Re.mat4.fromScaling(Cz,[a,a,a]);return Re.mat4.translate(u,u,Re.vec3.negate([],d.min))}function wP(d){const a=Re.mat4.fromTranslation(Cz,d.min),u=1/wb(d);return Re.mat4.scale(a,a,[u,u,u])}function CP(d){const a=Mn/(2*Math.PI);return d/(2*Math.PI)/a}function Sz(d,a){return Mn/(512*Math.pow(2,d))*wb(tf(a))}function bz(d,a,u,p,_){const m=CP(u),x=[d,a,-u/(2*Math.PI)],R=Re.mat4.identity(new Float64Array(16));return Re.mat4.translate(R,R,x),Re.mat4.scale(R,R,[m,m,m]),Re.mat4.rotateX(R,R,xe(-_)),Re.mat4.rotateY(R,R,xe(-p)),R}function tg(d){return nn(iu,g,d)}function Ez(d,a){const u=G(a.lat,a.lng),p=function(m){const x=G(m._center.lat,m._center.lng),R=Re.vec3.fromValues(0,1,0);let k=Re.vec3.cross([],R,x);const V=Re.mat4.fromRotation([],-m.angle,x);k=Re.vec3.transformMat4(k,k,V),Re.mat4.fromRotation(V,-m._pitch,k);const b=Re.vec3.normalize([],x);return Re.vec3.scale(b,b,Qm(m.cameraToCenterDistance/m.pixelsPerMeter)),Re.vec3.transformMat4(b,b,V),Re.vec3.add([],x,b)}(d),_=Re.vec3.subtract([],p,u);return Re.vec3.angle(_,u)}function SP(d,a){return Ez(d,a)>Math.PI/2*1.01}const Mz=xe(85),hQ=Math.cos(Mz),dQ=Math.sin(Mz),fQ=Re.mat4.create(),Rz=d=>{const a=[];return d.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function Tz(d,a,u,p,_,m,x,R,k){if(m&&d.queryGeometry.isAboveHorizon)return!1;m&&(k*=d.pixelToTileUnitsFactor);const V=d.tileID.canonical,b=u.projection.upVectorScale(V,u.center.lat,u.worldSize).metersToTile;for(const O of a)for(const U of O){const D=U.add(R),B=_&&u.elevation?u.elevation.exaggeration()*_.getElevationAt(D.x,D.y,!0):0,W=u.projection.projectTilePoint(D.x,D.y,V);if(B>0){const oe=u.projection.upVector(V,D.x,D.y);W.x+=oe[0]*b*B,W.y+=oe[1]*b*B,W.z+=oe[2]*b*B}const K=m?D:pQ(W.x,W.y,W.z,p),J=m?d.tilespaceRays.map(oe=>gQ(oe,B)):d.queryGeometry.screenGeometry,se=Re.vec4.transformMat4([],[W.x,W.y,W.z,1],p);if(!x&&m?k*=se[3]/u.cameraToCenterDistance:x&&!m&&(k*=u.cameraToCenterDistance/se[3]),m){const oe=ze((U.y/Mn+V.y)/(1<<V.z));k/=u.projection.pixelsPerMeter(oe,1)/Ce(1,oe)}if(Pn(J,K,k))return!0}return!1}function pQ(d,a,u,p){const _=Re.vec4.transformMat4([],[d,a,u,1],p);return new _e(_[0]/_[3],_[1]/_[3])}const Az=Re.vec3.fromValues(0,0,0),mQ=Re.vec3.fromValues(0,0,1);function gQ(d,a){const u=Re.vec3.create();return Az[2]=a,d.intersectsPlane(Az,mQ,u),new _e(u[0],u[1])}class Pz extends un{}let Iz,Dz,Fz,Lz;function Oz(d,{width:a,height:u},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==a*u*p)throw new RangeError("mismatched image size")}else _=new Uint8Array(a*u*p);return d.width=a,d.height=u,d.data=_,d}function kz(d,a,u){const{width:p,height:_}=a;p===d.width&&_===d.height||(bP(d,a,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,p),height:Math.min(d.height,_)},u,null),d.width=p,d.height=_,d.data=a.data)}function bP(d,a,u,p,_,m,x,R){if(_.width===0||_.height===0)return a;if(_.width>d.width||_.height>d.height||u.x>d.width-_.width||u.y>d.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>a.width||_.height>a.height||p.x>a.width-_.width||p.y>a.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const k=d.data,V=a.data,b=m===4&&R;for(let O=0;O<_.height;O++){const U=((u.y+O)*d.width+u.x)*m,D=((p.y+O)*a.width+p.x)*m;if(b)for(let B=0;B<_.width;B++){const W=U+B*m+3,K=D+B*m;V[K+0]=255,V[K+1]=255,V[K+2]=255,V[K+3]=k[W]}else if(x)for(let B=0;B<_.width;B++){const W=U+B*m,K=D+B*m,J=k[W+3],se=new Mr(k[W+0]/255*J,k[W+1]/255*J,k[W+2]/255*J,J).toRenderColor(x).toArray();V[K+0]=se[0],V[K+1]=se[1],V[K+2]=se[2],V[K+3]=se[3]}else for(let B=0;B<_.width*m;B++)V[D+B]=k[U+B]}return a}Un(Pz,"HeatmapBucket",{omit:["layers"]});class ng{constructor(a,u){Oz(this,a,1,u)}resize(a){kz(this,new ng(a),1)}clone(){return new ng({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,p,_,m){bP(a,u,p,_,m,1,null)}}class Ya{constructor(a,u){Oz(this,a,4,u)}resize(a){kz(this,new Ya(a),4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,p,_,m,x,R){bP(a,u,p,_,m,4,x,R)}}class Nz{constructor(a,u){this.width=a.width,this.height=a.height,this.data=u instanceof Uint8Array?new Float32Array(u.buffer):u}}function jw(d){const a={},u=d.resolution||256,p=d.clips?d.clips.length:1,_=d.image||new Ya({width:u,height:p}),m=(x,R,k)=>{a[d.evaluationKey]=k;const V=d.expression.evaluate(a);V&&(_.data[x+R+0]=Math.floor(255*V.r/V.a),_.data[x+R+1]=Math.floor(255*V.g/V.a),_.data[x+R+2]=Math.floor(255*V.b/V.a),_.data[x+R+3]=Math.floor(255*V.a))};if(d.clips)for(let x=0,R=0;x<p;++x,R+=4*u)for(let k=0,V=0;k<u;k++,V+=4){const b=k/(u-1),{start:O,end:U}=d.clips[x];m(R,V,O*(1-b)+U*b)}else for(let x=0,R=0;x<u;x++,R+=4)m(0,R,x/(u-1));return _}Un(ng,"AlphaImage"),Un(Ya,"RGBAImage");const vQ=Qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:yQ}=vQ;function $w(d,a,u=2){const p=a&&a.length,_=p?a[0]*u:d.length;let m=Bz(d,0,_,u,!0);const x=[];if(!m||m.next===m.prev)return x;let R,k,V;if(p&&(m=function(b,O,U,D){const B=[];for(let W=0,K=O.length;W<K;W++){const J=Bz(b,O[W]*D,W<K-1?O[W+1]*D:b.length,D,!1);J===J.next&&(J.steiner=!0),B.push(MQ(J))}B.sort(SQ);for(let W=0;W<B.length;W++)U=bQ(B[W],U);return U}(d,a,m,u)),d.length>80*u){R=1/0,k=1/0;let b=-1/0,O=-1/0;for(let U=u;U<_;U+=u){const D=d[U],B=d[U+1];D<R&&(R=D),B<k&&(k=B),D>b&&(b=D),B>O&&(O=B)}V=Math.max(b-R,O-k),V=V!==0?32767/V:0}return qw(m,x,u,R,k,V,0),x}function Bz(d,a,u,p,_){let m;if(_===function(x,R,k,V){let b=0;for(let O=R,U=k-V;O<k;O+=V)b+=(x[U]-x[O])*(x[O+1]+x[U+1]),U=O;return b}(d,a,u,p)>0)for(let x=a;x<u;x+=p)m=Vz(x/p|0,d[x],d[x+1],m);else for(let x=u-p;x>=a;x-=p)m=Vz(x/p|0,d[x],d[x+1],m);return m&&Sb(m,m.next)&&(Xw(m),m=m.next),m}function ny(d,a){if(!d)return d;a||(a=d);let u,p=d;do if(u=!1,p.steiner||!Sb(p,p.next)&&Ao(p.prev,p,p.next)!==0)p=p.next;else{if(Xw(p),p=a=p.prev,p===p.next)break;u=!0}while(u||p!==a);return a}function qw(d,a,u,p,_,m,x){if(!d)return;!x&&m&&function(k,V,b,O){let U=k;do U.z===0&&(U.z=EP(U.x,U.y,V,b,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(D){let B,W=1;do{let K,J=D;D=null;let se=null;for(B=0;J;){B++;let oe=J,te=0;for(let ge=0;ge<W&&(te++,oe=oe.nextZ,oe);ge++);let de=W;for(;te>0||de>0&&oe;)te!==0&&(de===0||!oe||J.z<=oe.z)?(K=J,J=J.nextZ,te--):(K=oe,oe=oe.nextZ,de--),se?se.nextZ=K:D=K,K.prevZ=se,se=K;J=oe}se.nextZ=null,W*=2}while(B>1)}(U)}(d,p,_,m);let R=d;for(;d.prev!==d.next;){const k=d.prev,V=d.next;if(m?xQ(d,p,_,m):_Q(d))a.push(k.i,d.i,V.i),Xw(d),d=V.next,R=V.next;else if((d=V)===R){x?x===1?qw(d=wQ(ny(d),a),a,u,p,_,m,2):x===2&&CQ(d,a,u,p,_,m):qw(ny(d),a,u,p,_,m,1);break}}}function _Q(d){const a=d.prev,u=d,p=d.next;if(Ao(a,u,p)>=0)return!1;const _=a.x,m=u.x,x=p.x,R=a.y,k=u.y,V=p.y,b=_<m?_<x?_:x:m<x?m:x,O=R<k?R<V?R:V:k<V?k:V,U=_>m?_>x?_:x:m>x?m:x,D=R>k?R>V?R:V:k>V?k:V;let B=p.next;for(;B!==a;){if(B.x>=b&&B.x<=U&&B.y>=O&&B.y<=D&&c0(_,R,m,k,x,V,B.x,B.y)&&Ao(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function xQ(d,a,u,p){const _=d.prev,m=d,x=d.next;if(Ao(_,m,x)>=0)return!1;const R=_.x,k=m.x,V=x.x,b=_.y,O=m.y,U=x.y,D=R<k?R<V?R:V:k<V?k:V,B=b<O?b<U?b:U:O<U?O:U,W=R>k?R>V?R:V:k>V?k:V,K=b>O?b>U?b:U:O>U?O:U,J=EP(D,B,a,u,p),se=EP(W,K,a,u,p);let oe=d.prevZ,te=d.nextZ;for(;oe&&oe.z>=J&&te&&te.z<=se;){if(oe.x>=D&&oe.x<=W&&oe.y>=B&&oe.y<=K&&oe!==_&&oe!==x&&c0(R,b,k,O,V,U,oe.x,oe.y)&&Ao(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,te.x>=D&&te.x<=W&&te.y>=B&&te.y<=K&&te!==_&&te!==x&&c0(R,b,k,O,V,U,te.x,te.y)&&Ao(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;oe&&oe.z>=J;){if(oe.x>=D&&oe.x<=W&&oe.y>=B&&oe.y<=K&&oe!==_&&oe!==x&&c0(R,b,k,O,V,U,oe.x,oe.y)&&Ao(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;te&&te.z<=se;){if(te.x>=D&&te.x<=W&&te.y>=B&&te.y<=K&&te!==_&&te!==x&&c0(R,b,k,O,V,U,te.x,te.y)&&Ao(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function wQ(d,a){let u=d;do{const p=u.prev,_=u.next.next;!Sb(p,_)&&zz(p,u,u.next,_)&&Zw(p,_)&&Zw(_,p)&&(a.push(p.i,u.i,_.i),Xw(u),Xw(u.next),u=d=_),u=u.next}while(u!==d);return ny(u)}function CQ(d,a,u,p,_,m){let x=d;do{let R=x.next.next;for(;R!==x.prev;){if(x.i!==R.i&&RQ(x,R)){let k=Uz(x,R);return x=ny(x,x.next),k=ny(k,k.next),qw(x,a,u,p,_,m,0),void qw(k,a,u,p,_,m,0)}R=R.next}x=x.next}while(x!==d)}function SQ(d,a){return d.x-a.x}function bQ(d,a){const u=function(_,m){let x=m;const R=_.x,k=_.y;let V,b=-1/0;do{if(k<=x.y&&k>=x.next.y&&x.next.y!==x.y){const W=x.x+(k-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(W<=R&&W>b&&(b=W,V=x.x<x.next.x?x:x.next,W===R))return V}x=x.next}while(x!==m);if(!V)return null;const O=V,U=V.x,D=V.y;let B=1/0;x=V;do{if(R>=x.x&&x.x>=U&&R!==x.x&&c0(k<D?R:b,k,U,D,k<D?b:R,k,x.x,x.y)){const W=Math.abs(k-x.y)/(R-x.x);Zw(x,_)&&(W<B||W===B&&(x.x>V.x||x.x===V.x&&EQ(V,x)))&&(V=x,B=W)}x=x.next}while(x!==O);return V}(d,a);if(!u)return a;const p=Uz(u,d);return ny(p,p.next),ny(u,u.next)}function EQ(d,a){return Ao(d.prev,d,a.prev)<0&&Ao(a.next,d,d.next)<0}function EP(d,a,u,p,_){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-u)*_|0)|d<<8))|d<<4))|d<<2))|d<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*_|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function MQ(d){let a=d,u=d;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==d);return u}function c0(d,a,u,p,_,m,x,R){return(_-x)*(a-R)>=(d-x)*(m-R)&&(d-x)*(p-R)>=(u-x)*(a-R)&&(u-x)*(m-R)>=(_-x)*(p-R)}function RQ(d,a){return d.next.i!==a.i&&d.prev.i!==a.i&&!function(u,p){let _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==p.i&&_.next.i!==p.i&&zz(_,_.next,u,p))return!0;_=_.next}while(_!==u);return!1}(d,a)&&(Zw(d,a)&&Zw(a,d)&&function(u,p){let _=u,m=!1;const x=(u.x+p.x)/2,R=(u.y+p.y)/2;do _.y>R!=_.next.y>R&&_.next.y!==_.y&&x<(_.next.x-_.x)*(R-_.y)/(_.next.y-_.y)+_.x&&(m=!m),_=_.next;while(_!==u);return m}(d,a)&&(Ao(d.prev,d,a.prev)||Ao(d,a.prev,a))||Sb(d,a)&&Ao(d.prev,d,d.next)>0&&Ao(a.prev,a,a.next)>0)}function Ao(d,a,u){return(a.y-d.y)*(u.x-a.x)-(a.x-d.x)*(u.y-a.y)}function Sb(d,a){return d.x===a.x&&d.y===a.y}function zz(d,a,u,p){const _=Eb(Ao(d,a,u)),m=Eb(Ao(d,a,p)),x=Eb(Ao(u,p,d)),R=Eb(Ao(u,p,a));return _!==m&&x!==R||!(_!==0||!bb(d,u,a))||!(m!==0||!bb(d,p,a))||!(x!==0||!bb(u,d,p))||!(R!==0||!bb(u,a,p))}function bb(d,a,u){return a.x<=Math.max(d.x,u.x)&&a.x>=Math.min(d.x,u.x)&&a.y<=Math.max(d.y,u.y)&&a.y>=Math.min(d.y,u.y)}function Eb(d){return d>0?1:d<0?-1:0}function Zw(d,a){return Ao(d.prev,d,d.next)<0?Ao(d,a,d.next)>=0&&Ao(d,d.prev,a)>=0:Ao(d,a,d.prev)<0||Ao(d,d.next,a)<0}function Uz(d,a){const u=MP(d.i,d.x,d.y),p=MP(a.i,a.x,a.y),_=d.next,m=a.prev;return d.next=a,a.prev=d,u.next=_,_.prev=u,p.next=u,u.prev=p,m.next=p,p.prev=m,p}function Vz(d,a,u,p){const _=MP(d,a,u);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Xw(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function MP(d,a,u){return{i:d,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mb(d,a){const u=d.length;if(u<=1)return[d];const p=[];let _,m;for(let x=0;x<u;x++){const R=ui(d[x]);R!==0&&(d[x].area=Math.abs(R),m===void 0&&(m=R<0),m===R<0?(_&&p.push(_),_=[d[x]]):_.push(d[x]))}if(_&&p.push(_),a>1)for(let x=0;x<p.length;x++)p[x].length<=a||(kf(p[x],a,1,p[x].length-1,TQ),p[x]=p[x].slice(0,a));return p}function TQ(d,a){return a.area-d.area}function RP(d,a,u){const p=u.patternDependencies;let _=!1;for(const m of a){const x=m.paint.get(`${d}-pattern`);x.isConstant()||(_=!0);const R=x.constantOr(null);R&&(_=!0,p[R]=!0)}return _}function TP(d,a,u,p,_){const m=_.patternDependencies;for(const x of a){const R=x.paint.get(`${d}-pattern`).value;if(R.kind!=="constant"){let k=R.evaluate({zoom:p},u,{},_.availableImages);k=k&&k.name?k.name:k,m[k]=!0,u.patterns[x.id]=k}}return u}class AP{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ol,this.indexArray=new ss,this.indexArray2=new xa,this.programConfigurations=new ai(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new Is,this.segments2=new Is,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=a.projection}updateFootprints(a,u){}populate(a,u,p,_){this.hasPattern=RP("fill",this.layers,u);const m=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:R,id:k,index:V,sourceLayerIndex:b}of a){const O=this.layers[0]._featureFilter.needGeometry,U=on(R,O);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),U,p))continue;const D=m?m.evaluate(U,{},p,u.availableImages):void 0,B={id:k,properties:R.properties,type:R.type,sourceLayerIndex:b,index:V,geometry:O?U.geometry:Ct(R,p,_),patterns:{},sortKey:D};x.push(B)}m&&x.sort((R,k)=>R.sortKey-k.sortKey);for(const R of x){const{geometry:k,index:V,sourceLayerIndex:b}=R;if(this.hasPattern){const O=TP("fill",this.layers,R,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(R,k,V,p,{},u.availableImages,u.brightness);u.featureIndex.insert(a[V].feature,k,V,b,this.index)}}update(a,u,p,_,m){const x=Object.keys(a).length!==0;x&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(a,u,x?this.stateDependentLayers:this.layers,p,_,m)}addFeatures(a,u,p,_,m,x){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,u,p,_,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,yQ),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,p,_,m,x=[],R){for(const k of Mb(u,500)){let V=0;for(const W of k)V+=W.length;const b=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),O=b.vertexLength,U=[],D=[];for(const W of k){if(W.length===0)continue;W!==k[0]&&D.push(U.length/2);const K=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),J=K.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(J+W.length-1,J),U.push(W[0].x),U.push(W[0].y);for(let se=1;se<W.length;se++)this.layoutVertexArray.emplaceBack(W[se].x,W[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),U.push(W[se].x),U.push(W[se].y);K.vertexLength+=W.length,K.primitiveLength+=W.length}const B=$w(U,D);for(let W=0;W<B.length;W+=3)this.indexArray.emplaceBack(O+B[W],O+B[W+1],O+B[W+2]);b.vertexLength+=V,b.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,m,x,_,R)}}let Gz,Hz,Wz,jz;Un(AP,"FillBucket",{omit:["layers","patternFeatures"]});class PP{constructor(a,u,p,_){if(this.triangleCount=u.length/3,this.min=new _e(0,0),this.max=new _e(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[m,x]=[a[0].clone(),a[0].clone()];for(let O=1;O<a.length;++O){const U=a[O];m.x=Math.min(m.x,U.x),m.y=Math.min(m.y,U.y),x.x=Math.max(x.x,U.x),x.y=Math.max(x.y,U.y)}if(_){const O=Math.ceil(Math.max(x.x-m.x,x.y-m.y)/_);p=Math.max(p,O)}if(p===0)return;this.min=m,this.max=x;const R=this.max.sub(this.min);R.x=Math.max(R.x,1),R.y=Math.max(R.y,1);const k=Math.max(R.x,R.y)/p;this.cellsX=Math.max(1,Math.ceil(R.x/k)),this.cellsY=Math.max(1,Math.ceil(R.y/k)),this.xScale=1/k,this.yScale=1/k;const V=[];for(let O=0;O<this.triangleCount;O++){const U=a[u[3*O+0]].sub(this.min),D=a[u[3*O+1]].sub(this.min),B=a[u[3*O+2]].sub(this.min),W=nf(Math.floor(Math.min(U.x,D.x,B.x)),this.xScale,this.cellsX),K=nf(Math.floor(Math.max(U.x,D.x,B.x)),this.xScale,this.cellsX),J=nf(Math.floor(Math.min(U.y,D.y,B.y)),this.yScale,this.cellsY),se=nf(Math.floor(Math.max(U.y,D.y,B.y)),this.yScale,this.cellsY),oe=new _e(0,0),te=new _e(0,0),de=new _e(0,0),ge=new _e(0,0);for(let Te=J;Te<=se;++Te){oe.y=te.y=Te*k,de.y=ge.y=(Te+1)*k;for(let Ve=W;Ve<=K;++Ve)oe.x=de.x=Ve*k,te.x=ge.x=(Ve+1)*k,(br(U,D,B,oe,te,ge)||br(U,D,B,oe,ge,de))&&V.push({cellIdx:Te*this.cellsX+Ve,triIdx:O})}}if(V.length===0)return;V.sort((O,U)=>O.cellIdx-U.cellIdx||O.triIdx-U.triIdx);let b=0;for(;b<V.length;){const O=V[b].cellIdx,U={start:this.payload.length,len:0};for(;b<V.length&&V[b].cellIdx===O;)++U.len,this.payload.push(V[b++].triIdx);this.cells[O]=U}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,u){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const p=nf(a.x-this.min.x,this.xScale,this.cellsX),_=nf(a.y-this.min.y,this.yScale,this.cellsY),m=this.cells[_*this.cellsX+p];if(m){this._lazyInitLookup();for(let x=0;x<m.len;x++){const R=this.payload[m.start+x],k=Math.floor(R/8),V=1<<R%8;if(!(this.lookup[k]&V)&&(this.lookup[k]|=V,u.push(R),u.length===this.triangleCount))return}}}query(a,u,p){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>u.x||a.y>this.max.y||this.min.y>u.y)return;this._lazyInitLookup();const _=nf(a.x-this.min.x,this.xScale,this.cellsX),m=nf(u.x-this.min.x,this.xScale,this.cellsX),x=nf(a.y-this.min.y,this.yScale,this.cellsY),R=nf(u.y-this.min.y,this.yScale,this.cellsY);for(let k=x;k<=R;k++)for(let V=_;V<=m;V++){const b=this.cells[k*this.cellsX+V];if(b)for(let O=0;O<b.len;O++){const U=this.payload[b.start+O],D=Math.floor(U/8),B=1<<U%8;if(!(this.lookup[D]&B)&&(this.lookup[D]|=B,p.push(U),p.length===this.triangleCount))return}}}}function nf(d,a,u){return Math.max(0,Math.min(u-1,Math.floor(d*a)))}Un(PP,"TriangleGridIndex");class $z{constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.footprints=[]}updateFootprints(a,u){for(const p of this.footprints)u.push({footprint:p,id:a})}populate(a,u,p,_){const m=[];for(const{feature:x,id:R,index:k,sourceLayerIndex:V}of a){const b=this.layers[0]._featureFilter.needGeometry,O=on(x,b);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),O,p))continue;const U={id:R,properties:x.properties,type:x.type,sourceLayerIndex:V,index:k,geometry:b?O.geometry:Ct(x,p,_),patterns:{}};m.push(U)}for(const x of m){const{geometry:R,index:k,sourceLayerIndex:V}=x;this.addFeature(x,R,k,p,{},u.availableImages,u.brightness),u.featureIndex.insert(a[k].feature,R,k,V,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,u,p,_,m){}destroy(){}addFeature(a,u,p,_,m,x=[],R){for(const k of Mb(u,2)){const V=[],b=[],O=[],U=new _e(1/0,1/0),D=new _e(-1/0,-1/0);for(const K of k)if(K.length!==0){K!==k[0]&&O.push(b.length/2);for(let J=0;J<K.length;J++)b.push(K[J].x),b.push(K[J].y),V.push(K[J]),U.x=Math.min(U.x,K[J].x),U.y=Math.min(U.y,K[J].y),D.x=Math.max(D.x,K[J].x),D.y=Math.max(D.y,K[J].y)}const B=$w(b,O),W=new PP(V,B,8,256);this.footprints.push({vertices:V,indices:B,grid:W,min:U,max:D})}}}Un($z,"ClipBucket",{omit:["layers"]});const AQ=Qi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),PQ=Qi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),IQ=Qi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DQ=Qi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),FQ=Qi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),LQ=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:OQ}=AQ;var IP,qz,DP,Zz,FP,Xz,Kz,Rb={};function Yz(){if(qz)return IP;qz=1;var d=Dt();function a(_,m,x,R,k){this.properties={},this.extent=x,this.type=0,this._pbf=_,this._geometry=-1,this._keys=R,this._values=k,_.readFields(u,this,m)}function u(_,m,x){_==1?m.id=x.readVarint():_==2?function(R,k){for(var V=R.readVarint()+R.pos;R.pos<V;){var b=k._keys[R.readVarint()],O=k._values[R.readVarint()];k.properties[b]=O}}(x,m):_==3?m.type=x.readVarint():_==4&&(m._geometry=x.pos)}function p(_){for(var m,x,R=0,k=0,V=_.length,b=V-1;k<V;b=k++)R+=((x=_[b]).x-(m=_[k]).x)*(m.y+x.y);return R}return IP=a,a.types=["Unknown","Point","LineString","Polygon"],a.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var m,x=_.readVarint()+_.pos,R=1,k=0,V=0,b=0,O=[];_.pos<x;){if(k<=0){var U=_.readVarint();R=7&U,k=U>>3}if(k--,R===1||R===2)V+=_.readSVarint(),b+=_.readSVarint(),R===1&&(m&&O.push(m),m=[]),m.push(new d(V,b));else{if(R!==7)throw new Error("unknown command "+R);m&&m.push(m[0].clone())}}return m&&O.push(m),O},a.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var m=_.readVarint()+_.pos,x=1,R=0,k=0,V=0,b=1/0,O=-1/0,U=1/0,D=-1/0;_.pos<m;){if(R<=0){var B=_.readVarint();x=7&B,R=B>>3}if(R--,x===1||x===2)(k+=_.readSVarint())<b&&(b=k),k>O&&(O=k),(V+=_.readSVarint())<U&&(U=V),V>D&&(D=V);else if(x!==7)throw new Error("unknown command "+x)}return[b,U,O,D]},a.prototype.toGeoJSON=function(_,m,x){var R,k,V=this.extent*Math.pow(2,x),b=this.extent*_,O=this.extent*m,U=this.loadGeometry(),D=a.types[this.type];function B(J){for(var se=0;se<J.length;se++){var oe=J[se];J[se]=[360*(oe.x+b)/V-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+O)/V)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(R=0;R<U.length;R++)W[R]=U[R][0];B(U=W);break;case 2:for(R=0;R<U.length;R++)B(U[R]);break;case 3:for(U=function(J){var se=J.length;if(se<=1)return[J];for(var oe,te,de=[],ge=0;ge<se;ge++){var Te=p(J[ge]);Te!==0&&(te===void 0&&(te=Te<0),te===Te<0?(oe&&de.push(oe),oe=[J[ge]]):oe.push(J[ge]))}return oe&&de.push(oe),de}(U),R=0;R<U.length;R++)for(k=0;k<U[R].length;k++)B(U[R][k])}U.length===1?U=U[0]:D="Multi"+D;var K={type:"Feature",geometry:{type:D,coordinates:U},properties:this.properties};return"id"in this&&(K.id=this.id),K},IP}function Jz(){if(Zz)return DP;Zz=1;var d=Yz();function a(p,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(u,this,_),this.length=this._features.length}function u(p,_,m){p===15?_.version=m.readVarint():p===1?_.name=m.readString():p===5?_.extent=m.readVarint():p===2?_._features.push(m.pos):p===3?_._keys.push(m.readString()):p===4&&_._values.push(function(x){for(var R=null,k=x.readVarint()+x.pos;x.pos<k;){var V=x.readVarint()>>3;R=V===1?x.readString():V===2?x.readFloat():V===3?x.readDouble():V===4?x.readVarint64():V===5?x.readVarint():V===6?x.readSVarint():V===7?x.readBoolean():null}return R}(m))}return DP=a,a.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var _=this._pbf.readVarint()+this._pbf.pos;return new d(this._pbf,_,this.extent,this._keys,this._values)},DP}function Qz(){return Kz||(Kz=1,Rb.VectorTile=function(){if(Xz)return FP;Xz=1;var d=Jz();function a(u,p,_){if(u===3){var m=new d(_,_.readVarint()+_.pos);m.length&&(p[m.name]=m)}}return FP=function(u,p){this.layers=u.readFields(a,{},p)},FP}(),Rb.VectorTileFeature=Yz(),Rb.VectorTileLayer=Jz()),Rb}var u0=Qz();class iy extends _e{constructor(a,u,p){super(a,u),this.z=p}}class e4 extends iy{constructor(a,u,p,_){super(a,u,p),this.w=_}}function Tb(d,a,u,p){const _=[],m=p===0?(x,R,k,V,b,O)=>{x.push(new _e(O,k+(O-R)/(V-R)*(b-k)))}:(x,R,k,V,b,O)=>{x.push(new _e(R+(O-k)/(b-k)*(V-R),O))};for(const x of d){const R=[];for(const k of x){if(k.length<=2)continue;const V=[];for(let U=0;U<k.length-1;U++){const D=k[U].x,B=k[U].y,W=k[U+1].x,K=k[U+1].y,J=p===0?D:B,se=p===0?W:K;J<a?se>a&&m(V,D,B,W,K,a):J>u?se<u&&m(V,D,B,W,K,u):V.push(k[U]),se<a&&J>=a&&m(V,D,B,W,K,a),se>u&&J<=u&&m(V,D,B,W,K,u)}let b=k[k.length-1];const O=p===0?b.x:b.y;O>=a&&O<=u&&V.push(b),V.length&&(b=V[V.length-1],V[0].x===b.x&&V[0].y===b.y||V.push(V[0]),R.push(V))}R.length&&_.push(R)}return _}function t4(d,a,u,p){const _=u==="x"?"y":"x",m=(p-d[u])/(a[u]-d[u]);d[_]=d[_]+(a[_]-d[_])*m,d[u]=p,d.hasOwnProperty("z")&&(d.z=Hn(d.z,a.z,m)),d.hasOwnProperty("w")&&(d.w=Hn(d.w,a.w,m))}function n4(d,a,u,p){const _=u,m=p;for(const x of["x","y"]){let R=d,k=a;R[x]>=k[x]&&(R=a,k=d),R[x]<_&&k[x]>_&&t4(R,k,x,_),R[x]<m&&k[x]>m&&t4(k,R,x,m)}}const Ab=Number.MAX_SAFE_INTEGER;function i4(d,a,u,p){return d.order<a||d.order===Ab||!(d.clipMask&u)||function(_,m){return m.length!==0&&m.find(x=>x===_)===void 0}(p,d.clipScope)}function Pb(d,a){return d.x-a.x||d.y-a.y}function r4(d,a){return Pb(d.min,a.min)===0&&Pb(d.max,a.max)===0}function LP(d,a){return!(d.min.x>a.max.x||d.max.x<a.min.x||d.min.y>a.max.y||d.max.y<a.min.y)}function OP(d,a){if(d.length!==a.length)return!1;for(let u=0;u<d.length;u++)if(d[u].sourceId!==a[u].sourceId||!r4(d[u],a[u])||d[u].order!==a[u].order||d[u].clipMask!==a[u].clipMask||!At(d[u].clipScope,a[u].clipScope))return!1;return!0}function s4(d,a,u){const p=1/Mn,_=1/(1<<u.canonical.z),m=(a.x*p+u.canonical.x)*_+u.wrap,x=(a.y*p+u.canonical.y)*_;return{min:new _e((d.x*p+u.canonical.x)*_+u.wrap,(d.y*p+u.canonical.y)*_),max:new _e(m,x)}}function kQ(d,a,u){const p=1<<u.canonical.z,_=((a.x-u.wrap)*p-u.canonical.x)*Mn,m=(a.y*p-u.canonical.y)*Mn;return{min:new _e(((d.x-u.wrap)*p-u.canonical.x)*Mn,(d.y*p-u.canonical.y)*Mn),max:new _e(_,m)}}function o4(d,a,u,p,_,m,x){const R=d.indices,k=d.vertices,V=[];for(let b=p;b<p+_;b+=3){const O=a[u[b+0]+m],U=a[u[b+1]+m],D=a[u[b+2]+m],B=Math.min(O.x,U.x,D.x),W=Math.max(O.x,U.x,D.x),K=Math.min(O.y,U.y,D.y),J=Math.max(O.y,U.y,D.y);V.length=0,d.grid.query(new _e(B,K),new _e(W,J),V);for(let se=0;se<V.length;se++){const oe=V[se];if(br(k[R[3*oe+0]],k[R[3*oe+1]],k[R[3*oe+2]],O,U,D,x))return!0}}return!1}function a4(d,a,u,p){if(!d||!u)return!1;let _=d.vertices;if(!a.canonical.equals(p.canonical)||a.wrap!==p.wrap){if(u.vertices.length<d.vertices.length)return a4(u,p,d,a);const m=a.canonical,x=p.canonical,R=Math.pow(2,x.z-m.z);_=d.vertices.map(k=>new _e((k.x+m.x*Mn)*R-x.x*Mn,(k.y+m.y*Mn)*R-x.y*Mn))}return o4(u,_,d.indices,0,d.indices.length,0,0)}function l4(d,a,u,p){const _=Math.pow(2,p.z-u.z);return new _e((d+u.x*Mn)*_-p.x*Mn,(a+u.y*Mn)*_-p.y*Mn)}function c4(d,a){const u=[];a.grid.queryPoint(d,u);const p=a.indices,_=a.vertices;for(let m=0;m<u.length;m++){const x=u[m];if(sr([_[p[3*x+0]],_[p[3*x+1]],_[p[3*x+2]]],d))return!0}return!1}const kP=[new _e(0,0),new _e(Mn,0),new _e(Mn,Mn),new _e(0,Mn)];function u4(d,a){const u=[];let p=[];if(!a||d.length<2)return[d];if(d.length===2)return _r(d[0],d[1],kP)?[d]:[];for(let _=0;_<d.length+2;_++){const m=d[_%d.length],x=d[(_+1)%d.length],R=_r(_===0?d[d.length-1]:d[(_-1)%d.length],m,kP),k=_r(m,x,kP),V=R||k;V&&p.push(m),V&&k||p.length>0&&(p.length>1&&u.push(p),p=[])}return p.length>1&&u.push(p),u}const NP=u0.VectorTileFeature.types,NQ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],BQ=["fill-extrusion-flood-light-ground-radius"],zQ=Math.pow(2,13),UQ=Math.pow(2,15)-1,h4=new _e(0,1),ig=2147483648;function Kw(d,a,u,p,_,m,x,R){d.emplaceBack((a<<1)+x,(u<<1)+m,(Math.floor(p*zQ)<<1)+_,Math.round(R))}function Yw(d,a,u){d.emplaceBack(a.x*Mn,a.y*Mn,u?1:0)}function Ib(d,a,u,p,_,m){d.emplaceBack(a.x,a.y,(u.x<<1)+p,(u.y<<1)+_,m)}function Jw(d,a,u){d.emplaceBack(a.x,a.y,a.z,u[0]*16384,u[1]*16384,u[2]*16384)}class d4{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class f4{constructor(){this.centroidXY=new _e(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _e(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _e(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _e(this.max.x-this.min.x,this.max.y-this.min.y)}}class p4{constructor(){this.acc=new _e(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,u){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=u.x,a.min.y=a.max.y=u.y)}appendEdge(a,u,p){this.accCount++,this.acc._add(u);let _=!!this.borders;u.x<a.min.x?(a.min.x=u.x,_=!0):u.x>a.max.x&&(a.max.x=u.x,_=!0),u.y<a.min.y?(a.min.y=u.y,_=!0):u.y>a.max.y&&(a.max.y=u.y,_=!0),((u.x===0||u.x===Mn)&&u.x===p.x)!=((u.y===0||u.y===Mn)&&u.y===p.y)&&this.processBorderOverlap(u,p),_&&this.checkBorderIntersection(u,p)}checkBorderIntersection(a,u){u.x<0!=a.x<0&&this.addBorderIntersection(0,Hn(u.y,a.y,(0-u.x)/(a.x-u.x))),u.x>Mn!=a.x>Mn&&this.addBorderIntersection(1,Hn(u.y,a.y,(Mn-u.x)/(a.x-u.x))),u.y<0!=a.y<0&&this.addBorderIntersection(2,Hn(u.x,a.x,(0-u.y)/(a.y-u.y))),u.y>Mn!=a.y>Mn&&this.addBorderIntersection(3,Hn(u.x,a.x,(Mn-u.y)/(a.y-u.y)))}addBorderIntersection(a,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const p=this.borders[a];u<p[0]&&(p[0]=u),u>p[1]&&(p[1]=u)}processBorderOverlap(a,u){if(a.x===u.x){if(a.y===u.y)return;const p=a.x===0?0:1;this.addBorderIntersection(p,u.y),this.addBorderIntersection(p,a.y)}else{const p=a.y===0?2:3;this.addBorderIntersection(p,u.x),this.addBorderIntersection(p,a.x)}}centroid(){return this.accCount===0?new _e(0,0):new _e(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,u)=>a+ +(u[0]!==Number.MAX_VALUE),0):0}}function m4(d,a){const u=d.add(a)._unit(),p=yt(d.x*u.x+d.y*u.y,-1,1);var _,m,x;return x=Math.acos(p),Math.min(4,Math.max(-4,Math.tan(x)))/4*UQ*((_=d).x*(m=a).y-_.y*m.x<0?-1:1)}const VQ=[d=>d.x<0,d=>d.x>Mn,d=>d.y<0,d=>d.y>Mn];function GQ(d,a,u,p){const _=[4];if(p===0)return _;u._mult(p);const m=d.sub(u),x=a.sub(u),R=[d,a,m,x];for(let k=0;k<4;k++)for(const V of R)if(VQ[k](V)){_.push(k);break}return _}class g4{constructor(a){this.vertexArray=new Kd,this.indexArray=new ss,this.programConfigurations=new ai(a.layers,{zoom:a.zoom,lut:a.lut},u=>BQ.includes(u)),this._segments=new Is,this.hiddenByLandmarkVertexArray=new dp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Is}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,u,p,_=!1){const m=a.length;if(m>2){let x=Math.max(0,this._segments.get().length-1);const R=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let k;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const V=a[0],b=a[1];k=m4(V.sub(a[m-1])._perp()._unit(),b.sub(V)._perp()._unit())}for(let V=0;V<m;V++){const b=V===m-1?0:V+1,O=a[V],U=a[b],D=a[b===m-1?0:b+1],B=U.sub(O)._perp()._unit(),W=m4(B,D.sub(U)._perp()._unit()),K=k,J=W;if(BP(O,U,u)||_&&_4(O,u)&&_4(U,u)){k=W;continue}const se=R.vertexLength;Ib(this.vertexArray,O,U,1,1,K),Ib(this.vertexArray,O,U,1,0,K),Ib(this.vertexArray,O,U,0,1,J),Ib(this.vertexArray,O,U,0,0,J),R.vertexLength+=4;const oe=GQ(O,U,B,p);for(const te of oe)this._segmentToGroundQuads[x].push({id:se,region:te}),this._segmentToRegionTriCounts[x][te]+=2,R.primitiveLength+=2;k=W}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),u=a.length;for(let p=0;p<u;p++)this._segmentToGroundQuads[p].sort((_,m)=>_.region-m.region);for(let p=0;p<u;p++){const _=this._segmentToGroundQuads[p],m=a[p],x=this._segmentToRegionTriCounts[p];x.reduce((k,V)=>k+V,0);let R=0;for(let k=0;k<=4;k++){const V=x[k];if(V!==0){let b=this.regionSegments[k];b||(b=this.regionSegments[k]=new Is);const O={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+R,vertexLength:m.vertexLength,primitiveLength:V};b.get().push(O)}R+=V}for(let k=0;k<_.length;k++){const V=_[k].id;this.indexArray.emplaceBack(V,V+1,V+3),this.indexArray.emplaceBack(V,V+3,V+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,u,p,_,m,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,u,p,_,m,x)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,PQ.members),this.indexBuffer=a.createIndexBuffer(this.indexArray))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,u,p,_,m,x){this.hasData()&&this.programConfigurations.updatePaintArrays(a,u,p,_,m,x)}updateHiddenByLandmark(a){if(!this.hasData())return;const u=a.groundVertexCount+a.groundVertexArrayOffset;if(a.groundVertexCount===0)return;const p=a.flags&ig?1:0;for(let _=a.groundVertexArrayOffset;_<u;++_)this.hiddenByLandmarkVertexArray.emplace(_,p);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,FQ.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const u=this.regionSegments[a];u&&u.destroy()}}}}class Db{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ss,this.footprintVertices=new ol,this.footprintSegments=[],this.layoutVertexArray=new eu,this.centroidVertexArray=new Nu,this.wallVertexArray=new mp,this.indexArray=new ss,this.programConfigurations=new ai(a.layers,{zoom:a.zoom,lut:a.lut},u=>NQ.includes(u)),this.segments=new Is,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.groundEffect=new g4(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(a,u){}populate(a,u,p,_){this.features=[],this.hasPattern=RP("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ot(p),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:x,index:R,sourceLayerIndex:k}of a){const V=this.layers[0]._featureFilter.needGeometry,b=on(m,V);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),b,p))continue;const O={id:x,sourceLayerIndex:k,index:R,geometry:V?b.geometry:Ct(m,p,_),properties:m.properties,type:m.type,patterns:{}},U=this.layoutVertexArray.length,D=NP[O.type]==="Polygon";if(this.hasPattern)this.features.push(TP("fill-extrusion",this.layers,O,this.zoom,u));else if(this.wallMode)for(const B of O.geometry)for(const W of u4(B,D))this.addFeature(O,[W],R,p,{},u.availableImages,_,u.brightness);else this.addFeature(O,O.geometry,R,p,{},u.availableImages,_,u.brightness);u.featureIndex.insert(m,O.geometry,R,k,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,u,p,_,m,x){for(const R of this.features){const k=NP[R.type]==="Polygon",{geometry:V}=R;if(this.wallMode)for(const b of V)for(const O of u4(b,k))this.addFeature(R,[O],R.index,u,p,_,m,x);else this.addFeature(R,V,R.index,u,p,_,m,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,u,p,_,m){const x=Object.keys(a).length!==0;if(x&&!this.stateDependentLayers.length)return;const R=x?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(a,u,R,p,_,m),this.groundEffect.update(a,u,R,p,_,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,OQ),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,DQ.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,LQ.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,IQ.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,p,_,m,x,R,k){const V=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,b=[new _e(0,0),new _e(Mn,Mn)],O=R.projection,U=O.name==="globe",D=this.wallMode||NP[a.type]==="Polygon",B=new p4;B.centroidDataIndex=this.centroidData.length;const W=new f4,K=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},_)<=0,J=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},_);let se;if(W.height=J,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yd),this.wallMode){if(U)return void vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;se=function(Ne){const st=Ne[0].x===Ne[Ne.length-1].x&&Ne[0].y===Ne[Ne.length-1].y;(function(xn){let hn=0;const si=xn.length;for(let Nn=0;Nn<si;Nn++)hn+=(xn[(Nn+1)%si].x-xn[Nn].x)*(xn[(Nn+1)%si].y+xn[Nn].y);return hn>=0})(Ne)||(Ne=Ne.reverse());const et={geometry:[],joinNormals:[],indices:[]},ct=[],dt=[],xt=[];let Rt=Ne.length;if(Rt<(st?3:2))return et;for(;Rt>=2&&Ne[Rt-1].equals(Ne[Rt-2]);)Rt--;let It,Et,en,dn,Ht,Vn=0;for(;Vn<Rt-1&&Ne[Vn].equals(Ne[Vn+1]);)Vn++;st&&(It=Ne[Rt-2],Ht=Ne[Vn].sub(It)._unit()._perp());for(let xn=Vn;xn<Rt;xn++){if(en=xn===Rt-1?st?Ne[Vn+1]:void 0:Ne[xn+1],en&&Ne[xn].equals(en))continue;Ht&&(dn=Ht),It&&(Et=It),It=Ne[xn],Ht=en?en.sub(It)._unit()._perp():dn,dn=dn||Ht;let hn=dn.add(Ht);hn.x===0&&hn.y===0||hn._unit();const si=hn.x*Ht.x+hn.y*Ht.y,Nn=si!==0?1/si:1/0,qn=dn.x*Ht.y-dn.y*Ht.x>0;let Pi="miter";const zi=2;Pi==="miter"&&Nn>zi&&(Pi="bevel"),Pi==="bevel"&&(Nn>100&&(Pi="flipbevel"),Nn<zi&&(Pi="miter"));const Ui=(ki,Yi,Zi,Kr)=>{const Gr=new _e(ki.x,ki.y),Ei=new _e(ki.x,ki.y);Gr.x+=Yi.x*Kr,Gr.y+=Yi.y*Kr,Ei.x-=Yi.x*Math.max(Zi,1),Ei.y-=Yi.y*Math.max(Zi,1),xt.push(Yi),ct.push(Gr),dt.push(Ei)};if(Pi==="miter")hn._mult(Nn),Ui(It,hn,0,0);else if(Pi==="flipbevel")hn=Ht.mult(-1),Ui(It,hn,0,0),Ui(It,hn.mult(-1),0,0);else{const ki=-Math.sqrt(Nn*Nn-1),Yi=qn?ki:0,Zi=qn?0:ki;Et&&Ui(It,dn,Yi,Zi),en&&Ui(It,Ht,Yi,Zi)}}et.geometry=[...ct,...dt.reverse(),ct[0]],et.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const Rn=et.geometry.length-1;for(let xn=0;xn<Rn/2;xn++)if(xn+1<Rn/2){let hn=xn,si=xn+1,Nn=Rn-1-xn,qn=Rn-2-xn;hn=hn===0?Rn-1:hn-1,si=si===0?Rn-1:si-1,Nn=Nn===0?Rn-1:Nn-1,qn=qn===0?Rn-1:qn-1,et.indices.push(Nn),et.indices.push(si),et.indices.push(hn),et.indices.push(Nn),et.indices.push(qn),et.indices.push(si)}return et}(u[0]),u=[se.geometry]}const oe=(Ne,st)=>Ne<(st.length-1)/2||Ne===st.length-1,te=this.wallMode?[u]:Mb(u,500);for(let Ne=te.length-1;Ne>=0;Ne--){const st=te[Ne];(st.length===0||(de=st[0]).every(ke=>ke.x<=0)||de.every(ke=>ke.x>=Mn)||de.every(ke=>ke.y<=0)||de.every(ke=>ke.y>=Mn))&&te.splice(Ne,1)}var de;let ge;if(U)ge=S4(te,b,_);else{ge=[];for(const Ne of te)ge.push({polygon:Ne,bounds:b})}const Te=D?this.edgeRadius:0,Ve=Te>0&&this.zoom<17,Oe=(Ne,st)=>{if(Ne.length===0)return!1;const ke=Ne[Ne.length-1];return st.x===ke.x&&st.y===ke.y};for(const{polygon:Ne,bounds:st}of ge){let ke=0,et=0;for(const Rt of Ne)D&&!Rt[0].equals(Rt[Rt.length-1])&&Rt.push(Rt[0]),et+=D?Rt.length-1:Rt.length;const ct=this.segments.prepareSegment((D?5:4)*et,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);const dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new d4;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],D){const Rt=[],It=[];ke=ct.vertexLength;for(let en=0;en<Ne.length;en++){const dn=Ne[en];dn.length&&en!==0&&It.push(Rt.length/2);const Ht=[];let Vn,Rn;Vn=dn[1].sub(dn[0])._perp()._unit(),xt.ringIndices.push(dn.length-1);for(let xn=1;xn<dn.length;xn++){const hn=dn[xn],si=dn[xn===dn.length-1?1:xn+1],Nn=hn.clone();if(Te){Rn=si.sub(hn)._perp()._unit();const qn=Vn.add(Rn)._unit(),Pi=Te*Math.min(4,1/(Vn.x*qn.x+Vn.y*qn.y));Nn.x+=Pi*qn.x,Nn.y+=Pi*qn.y,Nn.x=Math.round(Nn.x),Nn.y=Math.round(Nn.y),Vn=Rn}if(!K||Te!==0&&!Ve||Oe(Ht,Nn)||Ht.push(Nn),Kw(this.layoutVertexArray,Nn.x,Nn.y,0,0,1,1,0),this.wallMode){const qn=oe(xn,dn);Yw(this.wallVertexArray,se.joinNormals[xn],!qn)}ct.vertexLength++,this.footprintVertices.emplaceBack(hn.x,hn.y),Rt.push(hn.x,hn.y),U&&Jw(this.layoutVertexExtArray,O.projectTilePoint(Nn.x,Nn.y,_),O.upVector(_,Nn.x,Nn.y))}K&&(Te===0||Ve)&&(Ht.length!==0&&Oe(Ht,Ht[0])&&Ht.pop(),this.groundEffect.addData(Ht,st,V))}const Et=this.wallMode?se.indices:$w(Rt,It);for(let en=0;en<Et.length;en+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+Et[en+0],xt.vertexOffset+Et[en+1],xt.vertexOffset+Et[en+2]),this.indexArray.emplaceBack(ke+Et[en],ke+Et[en+2],ke+Et[en+1]),ct.primitiveLength++;xt.indexCount+=Et.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let Rt=0;Rt<Ne.length;Rt++){const It=Ne[Rt];B.startRing(W,It[0]);let Et=It.length>4&&x4(It[It.length-2],It[0],It[1]),en=Te?HQ(It[It.length-2],It[0],It[1],Te):0;const dn=[];let Ht,Vn,Rn;Vn=It[1].sub(It[0])._perp()._unit();let xn=!0;for(let hn=1,si=0;hn<It.length;hn++){let Nn=It[hn-1],qn=It[hn];const Pi=It[hn===It.length-1?1:hn+1];if(B.appendEdge(W,qn,Nn),BP(qn,Nn,st)){Te&&(Vn=Pi.sub(qn)._perp()._unit(),xn=!xn);continue}const zi=qn.sub(Nn)._perp(),Ui=zi.x/(Math.abs(zi.x)+Math.abs(zi.y)),ki=zi.y>0?1:0,Yi=Nn.dist(qn);if(si+Yi>32768&&(si=0),Te){Rn=Pi.sub(qn)._perp()._unit();let Ei=y4(Nn,qn,Pi,v4(Vn,Rn),Te);isNaN(Ei)&&(Ei=0);const Tr=qn.sub(Nn)._unit();Nn=Nn.add(Tr.mult(en))._round(),qn=qn.add(Tr.mult(-Ei))._round(),en=Ei,Vn=Rn,K&&this.zoom>=17&&(Oe(dn,Nn)||dn.push(Nn),Oe(dn,qn)||dn.push(qn))}const Zi=ct.vertexLength,Kr=It.length>4&&x4(Nn,qn,Pi);let Gr=w4(si,Et,xn);if(Kw(this.layoutVertexArray,Nn.x,Nn.y,Ui,ki,0,0,Gr),Kw(this.layoutVertexArray,Nn.x,Nn.y,Ui,ki,0,1,Gr),this.wallMode){const Ei=oe(hn-1,It),Tr=se.joinNormals[hn-1];Yw(this.wallVertexArray,Tr,Ei),Yw(this.wallVertexArray,Tr,Ei)}if(si+=Yi,Gr=w4(si,Kr,!xn),Et=Kr,Kw(this.layoutVertexArray,qn.x,qn.y,Ui,ki,0,0,Gr),Kw(this.layoutVertexArray,qn.x,qn.y,Ui,ki,0,1,Gr),this.wallMode){const Ei=oe(hn,It),Tr=se.joinNormals[hn];Yw(this.wallVertexArray,Tr,Ei),Yw(this.wallVertexArray,Tr,Ei)}if(ct.vertexLength+=4,this.indexArray.emplaceBack(Zi+0,Zi+1,Zi+2),this.indexArray.emplaceBack(Zi+1,Zi+3,Zi+2),ct.primitiveLength+=2,Te){const Ei=ke+(hn===1?It.length-2:hn-2),Tr=hn===1?ke:Ei+1;if(this.indexArray.emplaceBack(Zi+1,Ei,Zi+3),this.indexArray.emplaceBack(Ei,Tr,Zi+3),ct.primitiveLength+=2,Ht===void 0&&(Ht=Zi),!BP(Pi,It[hn],st)){const Dr=hn===It.length-1?Ht:ct.vertexLength;this.indexArray.emplaceBack(Zi+2,Zi+3,Dr),this.indexArray.emplaceBack(Zi+3,Dr+1,Dr),this.indexArray.emplaceBack(Zi+3,Tr,Dr+1),ct.primitiveLength+=3}xn=!xn}if(U){const Ei=this.layoutVertexExtArray,Tr=O.projectTilePoint(Nn.x,Nn.y,_),Dr=O.projectTilePoint(qn.x,qn.y,_),ds=O.upVector(_,Nn.x,Nn.y),Ws=O.upVector(_,qn.x,qn.y);Jw(Ei,Tr,ds),Jw(Ei,Tr,ds),Jw(Ei,Dr,Ws),Jw(Ei,Dr,Ws)}}D&&(ke+=It.length-1),K&&Te&&this.zoom>=17&&(dn.length!==0&&Oe(dn,dn[0])&&dn.pop(),this.groundEffect.addData(dn,st,V,Te>0))}this.footprintSegments.push(xt),dt.triangleCount=this.indexArray.length-dt.triangleArrayOffset,this.polygonSegments.push(dt),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,W.vertexCount!==0){if(W.centroidXY=B.borders?h4:this.encodeCentroid(B,W),this.centroidData.push(W),B.borders){this.featuresOnBorder.push(B);const Ne=this.featuresOnBorder.length-1;for(let st=0;st<B.borders.length;st++)B.borders[st][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[st].push(Ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,m,x,_,k),this.groundEffect.addPaintPropertiesData(a,p,m,x,_,k),this.maxHeight=Math.max(this.maxHeight,J)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((u,p)=>this.featuresOnBorder[u].borders[a][0]-this.featuresOnBorder[p].borders[a][0])}splitToSubtiles(){const a=[];for(let R=0;R<this.centroidData.length;R++){const k=this.centroidData[R],V=+(k.min.y+k.max.y>Mn),b=2*V+(+(k.min.x+k.max.x>Mn)^V);for(let O=0;O<k.polygonSegLen;O++){const U=k.polygonSegIdx+O;a.push({centroidIdx:R,subtile:b,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}const u=new ss;a.sort((R,k)=>R.triangleSegmentIdx===k.triangleSegmentIdx?R.subtile-k.subtile:R.triangleSegmentIdx-k.triangleSegmentIdx);let p=0,_=0,m=0;for(const R of a){if(R.triangleSegmentIdx!==p)break;m++}const x=a.length;for(;_!==a.length;){p=a[_].triangleSegmentIdx;let R=0,k=_,V=_;for(let b=k;b<m&&a[b].subtile===R;b++)V++;for(;k!==m;){const b=a[k];R=b.subtile;const O=this.centroidData[b.centroidIdx].min.clone(),U=this.centroidData[b.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[p].vertexOffset,primitiveOffset:u.length,vertexLength:this.segments.segments[p].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=k;B<V;B++){const W=a[B],K=this.polygonSegments[W.polygonSegmentIdx],J=this.centroidData[W.centroidIdx].min,se=this.centroidData[W.centroidIdx].max,oe=this.indexArray.uint16;for(let te=K.triangleArrayOffset;te<K.triangleArrayOffset+K.triangleCount;te++)u.emplaceBack(oe[3*te],oe[3*te+1],oe[3*te+2]);D.primitiveLength+=K.triangleCount,O.x=Math.min(O.x,J.x),O.y=Math.min(O.y,J.y),U.x=Math.max(U.x,se.x),U.y=Math.max(U.y,se.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:O,max:U}),k=V;for(let B=k;B<m&&a[B].subtile===a[k].subtile;B++)V++}_=m;for(let b=_;b<x&&a[b].triangleSegmentIdx===a[_].triangleSegmentIdx;b++)m++}u._trim(),this.indexArray=u}getVisibleSegments(a,u,p){const _=new Is;if(this.wallMode){for(const W of this.triangleSubSegments)_.segments.push(W.segment);return _}let m=0,x=0;const R=1<<a.canonical.z;if(u){const W=u.getMinMaxForTile(a);W&&(m=W.min,x=W.max)}x+=this.maxHeight;const k=a.toUnwrapped();let V;const b=[k.canonical.x/R+k.wrap,k.canonical.y/R],O=[(k.canonical.x+1)/R+k.wrap,(k.canonical.y+1)/R],U=(W,K,J)=>[W[0]*(1-J[0])+K[0]*J[0],W[1]*(1-J[1])+K[1]*J[1]],D=[],B=[];for(const W of this.triangleSubSegments){D[0]=W.min.x/Mn,D[1]=W.min.y/Mn,B[0]=W.max.x/Mn,B[1]=W.max.y/Mn;const K=U(b,O,D),J=U(b,O,B);if(new Ir([K[0],K[1],m],[J[0],J[1],x]).intersectsPrecise(p)===0){V&&(_.segments.push(V),V=void 0);continue}const se=W.segment;V&&V.vertexOffset!==se.vertexOffset&&(_.segments.push(V),V=void 0),V?(V.vertexLength+=se.vertexLength,V.primitiveLength+=se.primitiveLength):V={vertexOffset:se.vertexOffset,primitiveLength:se.primitiveLength,vertexLength:se.vertexLength,primitiveOffset:se.primitiveOffset,sortKey:void 0,vaos:{}}}return V&&_.segments.push(V),_}encodeCentroid(a,u){const p=a.centroid(),_=u.span(),m=Math.min(7,Math.round(_.x*this.tileToMeter/10)),x=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new _e(yt(p.x,1,Mn-1)<<3|m,yt(p.y,1,Mn-1)<<3|x)}encodeBorderCentroid(a){if(!a.borders)return new _e(0,0);const u=a.borders,p=Number.MAX_VALUE;if(u[0][0]!==p||u[1][0]!==p){const _=u[0][0]!==p?0:1;return new _e(6|(u[0][0]!==p?0:65528),(u[_][0]+u[_][1])/2<<3|6)}{const _=u[2][0]!==p?2:3;return new _e((u[_][0]+u[_][1])/2<<3|6,6|(u[2][0]!==p?0:65528))}}showCentroid(a){const u=this.centroidData[a.centroidDataIndex];u.flags&=ig,u.centroidXY.x=0,u.centroidXY.y=0,this.writeCentroidToBuffer(u)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const u=a.vertexArrayOffset,p=a.vertexCount+a.vertexArrayOffset,_=a.flags&ig?h4:a.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(u);if(this.centroidVertexArray.geta_centroid_pos1(u)!==_.y||m!==_.x){for(let x=u;x<p;++x)this.centroidVertexArray.emplace(x,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,u,p){if(u.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=u.updateTime;const _=u.getReplacementRegionsForTile(a.toUnwrapped());if(OP(this.activeReplacements,_))return;if(this.activeReplacements=_,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const m=[];for(const x of this.activeReplacements){if(x.order<p)continue;const R=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-a.canonical.z));for(const k of this.centroidData)if(!(k.flags&ig||x.min.x>k.max.x||k.min.x>x.max.x||x.min.y>k.max.y||k.min.y>x.max.y))for(let V=0;V<k.footprintSegLen;V++){const b=this.footprintSegments[k.footprintSegIdx+V];if(m.length=0,WQ(this.footprintVertices,b.vertexOffset,b.vertexCount,x.footprintTileId.canonical,a.canonical,m),o4(x.footprint,m,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-R)){k.flags|=ig;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,u,p){let _=!1;for(let m=0;m<p.footprintSegLen;m++){const x=this.footprintSegments[p.footprintSegIdx+m];let R=0;for(const k of x.ringIndices){for(let V=R,b=k+R-1;V<k+R;b=V++){const O=this.footprintVertices.int16[2*(V+x.vertexOffset)+0],U=this.footprintVertices.int16[2*(V+x.vertexOffset)+1],D=this.footprintVertices.int16[2*(b+x.vertexOffset)+1];U>u!=D>u&&a<(this.footprintVertices.int16[2*(b+x.vertexOffset)+0]-O)*(u-U)/(D-U)+O&&(_=!_)}R=k}}return _}getHeightAtTileCoord(a,u){let p=Number.NEGATIVE_INFINITY,_=!0;const m=4*(a+Mn)*Mn+(u+Mn);if(this.partLookup.hasOwnProperty(m)){const x=this.partLookup[m];return x?{height:x.height,hidden:!!(x.flags&ig)}:void 0}for(const x of this.centroidData)a>x.max.x||x.min.x>a||u>x.max.y||x.min.y>u||this.footprintContainsPoint(a,u,x)&&x&&x.height>p&&(p=x.height,this.partLookup[m]=x,_=!!(x.flags&ig));if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:_};this.partLookup[m]=void 0}}function v4(d,a){const u=d.add(a)._unit();return d.x*u.x+d.y*u.y}function HQ(d,a,u,p){const _=a.sub(d)._perp()._unit(),m=u.sub(a)._perp()._unit();return y4(d,a,u,v4(_,m),p)}function y4(d,a,u,p,_){const m=Math.sqrt(1-p*p);return Math.min(d.dist(a)/3,a.dist(u)/3,_*m/p)}function BP(d,a,u){return d.x<u[0].x&&a.x<u[0].x||d.x>u[1].x&&a.x>u[1].x||d.y<u[0].y&&a.y<u[0].y||d.y>u[1].y&&a.y>u[1].y}function _4(d,a){return d.x<a[0].x||d.x>a[1].x||d.y<a[0].y||d.y>a[1].y}function x4(d,a,u){if(d.x<0||d.x>=Mn||a.x<0||a.x>=Mn||u.x<0||u.x>=Mn)return!1;const p=u.sub(a),_=p.perp(),m=d.sub(a);return(p.x*m.x+p.y*m.y)/Math.sqrt((p.x*p.x+p.y*p.y)*(m.x*m.x+m.y*m.y))>-.866&&_.x*m.x+_.y*m.y<0}function w4(d,a,u){const p=a?2|d:-3&d;return u?1|p:-2&p}function C4(){const d=Math.PI/32,a=Math.tan(d),u=$;return u*Math.sqrt(1+2*a*a)-u}function S4(d,a,u){const p=1<<u.z,_=Fe(u.x/p),m=Fe((u.x+1)/p),x=ze(u.y/p),R=ze((u.y+1)/p);return function(k,V,b,O,U=0,D){const B=[];if(!k.length||!b||!O)return B;const W=(ge,Te)=>{for(const Ve of ge)B.push({polygon:Ve,bounds:Te})},K=Math.ceil(Math.log2(b)),J=Math.ceil(Math.log2(O)),se=K-J,oe=[];for(let ge=0;ge<Math.abs(se);ge++)oe.push(se>0?0:1);for(let ge=0;ge<Math.min(K,J);ge++)oe.push(0),oe.push(1);let te=k;if(te=Tb(te,V[0].y-U,V[1].y+U,1),te=Tb(te,V[0].x-U,V[1].x+U,0),!te.length)return B;const de=[];for(oe.length?de.push({polygons:te,bounds:V,depth:0}):W(te,V);de.length;){const ge=de.pop(),Te=ge.depth,Ve=oe[Te],Oe=ge.bounds[0],Ne=ge.bounds[1],st=Ve===0?Oe.x:Oe.y,ke=Ve===0?Ne.x:Ne.y,et=D?D(Ve,st,ke):.5*(st+ke),ct=Tb(ge.polygons,st-U,et+U,Ve),dt=Tb(ge.polygons,et-U,ke+U,Ve);if(ct.length){const xt=[Oe,new _e(Ve===0?et:Ne.x,Ve===1?et:Ne.y)];oe.length>Te+1?de.push({polygons:ct,bounds:xt,depth:Te+1}):W(ct,xt)}if(dt.length){const xt=[new _e(Ve===0?et:Oe.x,Ve===1?et:Oe.y),Ne];oe.length>Te+1?de.push({polygons:dt,bounds:xt,depth:Te+1}):W(dt,xt)}}return B}(d,a,Math.ceil((m-_)/11.25),Math.ceil((x-R)/11.25),1,(k,V,b)=>{if(k===0)return .5*(V+b);{const O=ze((u.y+V/Mn)/p);return(be(.5*(ze((u.y+b/Mn)/p)+O))*p-u.y)*Mn}})}function WQ(d,a,u,p,_,m){const x=Math.pow(2,p.z-_.z);for(let R=0;R<u;R++){let k=d.int16[2*(R+a)+0],V=d.int16[2*(R+a)+1];k=(k+_.x*Mn)*x-p.x*Mn,V=(V+_.y*Mn)*x-p.y*Mn,m.push(new _e(k,V))}}let b4,E4;function Qw(d,a){return d.x*a.x+d.y*a.y}function M4(d,a){if(d.length===1){let u=0;const p=a[u++];let _;for(;!_||p.equals(_);)if(_=a[u++],!_)return 1/0;for(;u<a.length;u++){const m=a[u],x=d[0],R=_.sub(p),k=m.sub(p),V=x.sub(p),b=Qw(R,R),O=Qw(R,k),U=Qw(k,k),D=Qw(V,R),B=Qw(V,k),W=b*U-O*O,K=(U*D-O*B)/W,J=(b*B-O*D)/W,se=p.z*(1-K-J)+_.z*K+m.z*J;if(isFinite(se))return se}return 1/0}{let u=1/0;for(const p of a)u=Math.min(u,p.z);return u}}function R4(d,a,u,p,_,m,x,R){const k=x*_.getElevationAt(d,a,!0,!0),V=m[0]!==0,b=V?m[1]===0?x*(m[0]/7-450):x*function(O,U,D){const B=Math.floor(U[0]/8),W=Math.floor(U[1]/8),K=10*(U[0]-8*B),J=10*(U[1]-8*W),se=O.getElevationAt(B,W,!0,!0),oe=O.getMeterToDEM(D),te=Math.floor(.5*(K*oe-1)),de=Math.floor(.5*(J*oe-1)),ge=O.tileCoordToPixel(B,W),Te=2*te+1,Ve=2*de+1,Oe=function(dt,xt,Rt,It,Et){return[dt.getElevationAtPixel(xt,Rt,!0),dt.getElevationAtPixel(xt+Et,Rt,!0),dt.getElevationAtPixel(xt,Rt+Et,!0),dt.getElevationAtPixel(xt+It,Rt+Et,!0)]}(O,ge.x-te,ge.y-de,Te,Ve),Ne=Math.abs(Oe[0]-Oe[1]),st=Math.abs(Oe[2]-Oe[3]),ke=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),et=Math.min(.25,.5*oe*(Ne+st)/Te),ct=Math.min(.25,.5*oe*ke/Ve);return se+Math.max(et*K,ct*J)}(_,m,R):k;return{base:k+(u===0?-1:u),top:V?Math.max(b+p,k+u+2):k+p}}Un(Db,"FillExtrusionBucket",{omit:["layers","features"]}),Un(f4,"PartData"),Un(d4,"FootprintSegment"),Un(p4,"BorderCentroidData"),Un(g4,"GroundEffect");const jQ=Qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),$Q=Qi([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:qQ}=jQ,ZQ=Qi([{name:"a_packed",components:4,type:"Float32"}]),{members:XQ}=ZQ,KQ=Qi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:YQ}=KQ;class T4{constructor(a,u){this.width=a,this.height=u,this.nextRow=0,this.image=new ng({width:a,height:u}),this.positions={},this.uploaded=!1}getDash(a,u){const p=this.getKey(a,u);return this.positions[p]}trim(){const a=this.width,u=this.height=zn(this.nextRow);this.image.resize({width:a,height:u})}getKey(a,u){return a.join(",")+u}getDashRanges(a,u,p){const _=[];let m=a.length%2==1?-a[a.length-1]*p:0,x=a[0]*p,R=!0;_.push({left:m,right:x,isDash:R,zeroLength:a[0]===0});let k=a[0];for(let V=1;V<a.length;V++){R=!R;const b=a[V];m=k*p,k+=b,x=k*p,_.push({left:m,right:x,isDash:R,zeroLength:b===0})}return _}addRoundDash(a,u,p){const _=u/2;for(let m=-p;m<=p;m++){const x=this.width*(this.nextRow+p+m);let R=0,k=a[R];for(let V=0;V<this.width;V++){V/k.right>1&&(k=a[++R]);const b=Math.abs(V-k.left),O=Math.abs(V-k.right),U=Math.min(b,O);let D;const B=m/p*(_+1);if(k.isDash){const W=_-Math.abs(B);D=Math.sqrt(U*U+W*W)}else D=_-Math.sqrt(U*U+B*B);this.image.data[x+V]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(a,u){for(let k=a.length-1;k>=0;--k){const V=a[k],b=a[k+1];V.zeroLength?a.splice(k,1):b&&b.isDash===V.isDash&&(b.left=V.left,a.splice(k,1))}const p=a[0],_=a[a.length-1];p.isDash===_.isDash&&(p.left=_.left-this.width,_.right=p.right+this.width);const m=this.width*this.nextRow;let x=0,R=a[x];for(let k=0;k<this.width;k++){k/R.right>1&&(R=a[++x]);const V=Math.abs(k-R.left),b=Math.abs(k-R.right),O=Math.min(V,b);this.image.data[m+k]=Math.max(0,Math.min(255,(R.isDash?O:-O)+u+128))}}addDash(a,u){const p=this.getKey(a,u);if(this.positions[p])return this.positions[p];const _=u==="round",m=_?7:0,x=2*m+1;if(this.nextRow+x>this.height)return vi("LineAtlas out of space"),null;a.length===0&&a.push(1);let R=0;for(let b=0;b<a.length;b++)a[b]<0&&(vi("Negative value is found in line dasharray, replacing values with 0"),a[b]=0),R+=a[b];if(R!==0){const b=this.width/R,O=this.getDashRanges(a,this.width,b);_?this.addRoundDash(O,b,m):this.addRegularDash(O,u==="square"?.5*b:0)}const k=this.nextRow+m;this.nextRow+=x;const V={tl:[k,m],br:[R,0]};return this.positions[p]=V,V}}Un(T4,"LineAtlas");const JQ=u0.VectorTileFeature.types,QQ=Math.cos(Math.PI/180*37.5),eee=Math.cos(Math.PI/180*5);class zP{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Eo,this.layoutVertexArray2=new pa,this.patternVertexArray=new Mo,this.indexArray=new ss,this.programConfigurations=new ai(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new Is,this.maxLineLength=0,this.zOffsetVertexArray=new tu,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:Mn/64}updateFootprints(a,u){}populate(a,u,p,_){this.hasPattern=RP("line",this.layers,u);const m=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const x=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&x==="none"&&vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const R=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&R!==void 0;const k=[];for(const{feature:U,id:D,index:B,sourceLayerIndex:W}of a){const K=this.layers[0]._featureFilter.needGeometry,J=on(U,K);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),J,p))continue;const se=m?m.evaluate(J,{},p):void 0,oe={id:D,properties:U.properties,type:U.type,sourceLayerIndex:W,index:B,geometry:K?J.geometry:Ct(U,p,_),patterns:{},sortKey:se};k.push(oe)}m&&k.sort((U,D)=>U.sortKey-D.sortKey);const{lineAtlas:V,featureIndex:b}=u,O=this.addConstantDashes(V);for(const U of k){const{geometry:D,index:B,sourceLayerIndex:W}=U;if(O&&this.addFeatureDashes(U,V),this.hasPattern){const K=TP("line",this.layers,U,this.zoom,u);this.patternFeatures.push(K)}else this.addFeature(U,D,B,p,V.positions,u.availableImages,u.brightness);b.insert(a[B].feature,D,B,W,this.index)}}addConstantDashes(a){let u=!1;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(_.kind!=="constant"||m.kind!=="constant")u=!0;else{const x=m.value,R=_.value;if(!R)continue;a.addDash(R,x)}}return u}addFeatureDashes(a,u){const p=this.zoom;for(const _ of this.layers){const m=_.paint.get("line-dasharray").value,x=_.layout.get("line-cap").value;if(m.kind==="constant"&&x.kind==="constant")continue;let R,k;if(m.kind==="constant"){if(R=m.value,!R)continue}else R=m.evaluate({zoom:p},a);k=x.kind==="constant"?x.value:x.evaluate({zoom:p},a),u.addDash(R,k),a.patterns[_.id]=u.getKey(R,k)}}update(a,u,p,_,m){const x=Object.keys(a).length!==0;x&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(a,u,x?this.stateDependentLayers:this.layers,p,_,m)}addFeatures(a,u,p,_,m,x){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,u,p,_,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,XQ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,YQ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,$Q.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,qQ),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,p,_,m,x,R){const k=this.layers[0].layout,V=k.get("line-join").evaluate(a,{}),b=k.get("line-cap").evaluate(a,{}),O=k.get("line-miter-limit"),U=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a,this.zOffsetValue=k.get("line-z-offset").value;for(const D of u)this.addLine(D,a,_,V,b,O,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,m,x,_,R)}addLine(a,u,p,_,m,x,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const k=_==="none";if(this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<a.length-1;oe++)this.totalDistance+=a[oe].dist(a[oe+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const V=JQ[u.type]==="Polygon";let b=a.length;for(;b>=2&&a[b-1].equals(a[b-2]);)b--;let O=0;for(;O<b-1&&a[O].equals(a[O+1]);)O++;if(b<(V?3:2))return;_==="bevel"&&(x=1.05);const U=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let D,B,W,K,J,se;this.e1=this.e2=-1,V&&(D=a[b-2],J=a[O].sub(D)._unit()._perp());for(let oe=O;oe<b;oe++){if(W=oe===b-1?V?a[O+1]:void 0:a[oe+1],W&&a[oe].equals(W))continue;J&&(K=J),D&&(B=D),D=a[oe],se=this.hasZOffset?this.evaluateElevationValue(B?B.dist(D):0):null,J=W?W.sub(D)._unit()._perp():K,K=K||J;const te=B&&W;let de=te?_:V||k?"butt":m;const ge=K.x*J.x+K.y*J.y;if(k){const ct=function(dt){if(dt.patternJoinNone){const xt=dt.segmentPoints.length/2,Rt=dt.lineSoFar-dt.segmentStart;for(let It=0;It<xt;++It){const Et=dt.segmentPoints[2*It+1],en=Math.round(dt.segmentPoints[2*It])+.5+.25*Et;dt.patternVertexArray.emplaceBack(en,Rt,dt.segmentStart),dt.patternVertexArray.emplaceBack(en,Rt,dt.segmentStart)}dt.segmentPoints.length=0}dt.e1=dt.e2=-1};if(te&&ge<eee){this.updateDistance(B,D),this.addCurrentVertex(D,K,1,1,U,se),ct(this),this.addCurrentVertex(D,J,-1,-1,U,se);continue}if(B){if(!W){this.updateDistance(B,D),this.addCurrentVertex(D,K,1,1,U,se),ct(this);continue}de="miter"}}let Te=K.add(J);Te.x===0&&Te.y===0||Te._unit();const Ve=Te.x*J.x+Te.y*J.y,Oe=Ve!==0?1/Ve:1/0,Ne=2*Math.sqrt(2-2*Ve),st=Ve<QQ&&B&&W,ke=K.x*J.y-K.y*J.x>0,et=this.overscaling<=16?15*Mn/(512*this.overscaling):0;if(te&&de==="round"){if(Oe<R)de="miter";else if(Oe<=2){const ct=UP(D,-10,Mn+10);de=this.hasZOffset&&(ct||this.hasCrossSlope)?"miter":"fakeround"}}if(de==="miter"&&Oe>x&&(de="bevel"),de==="bevel"&&(Oe>2&&(de="flipbevel"),Oe<x&&(de="miter")),B&&!(de==="miter"&&st)&&this.updateDistance(B,D),de==="miter")if(st){const ct=D.dist(B);if(ct>2*et){const xt=D.sub(D.sub(B)._mult(et/ct)._round());this.updateDistance(B,xt),this.addCurrentVertex(xt,K,0,0,U,se),B=xt}this.updateDistance(B,D),Te._mult(Oe),this.addCurrentVertex(D,Te,0,0,U,se);const dt=D.dist(W);if(dt>2*et){const xt=D.add(W.sub(D)._mult(et/dt)._round());this.updateDistance(D,xt),this.addCurrentVertex(xt,J,0,0,U,se),D=xt}}else Te._mult(Oe),this.addCurrentVertex(D,Te,0,0,U,se);else if(de==="flipbevel"){if(Oe>100)Te=J.mult(-1);else{const ct=Oe*K.add(J).mag()/K.sub(J).mag();Te._perp()._mult(ct*(ke?-1:1))}this.addCurrentVertex(D,Te,0,0,U,se),this.addCurrentVertex(D,Te.mult(-1),0,0,U,se)}else if(de==="bevel"||de==="fakeround"){se!=null&&B&&this.addCurrentVertex(D,K,-1,-1,U,se);const ct=D.dist(B)<=2*et&&de!=="bevel",dt=Te.mult(ke?1:-1);dt._mult(Oe);const xt=J.mult(ke?-1:1),Rt=K.mult(ke?-1:1),It=this.evaluateElevationValue(this.distance);if(se==null&&(this.addHalfVertex(D,dt.x,dt.y,!1,!ke,0,U,It),ct||this.addHalfVertex(D,dt.x+2*Rt.x,dt.y+2*Rt.y,!1,ke,0,U,It)),de==="fakeround"){const Et=Math.round(180*Ne/Math.PI/20);this.addHalfVertex(D,Rt.x,Rt.y,!1,ke,0,U,It);for(let en=0;en<Et;en++){let dn=en/Et;if(dn!==.5){const Vn=dn-.5;dn+=dn*Vn*(dn-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Vn*Vn+(.848013+ge*(.215638*ge-1.06021)))}const Ht=xt.sub(Rt)._mult(dn)._add(Rt)._unit();this.addHalfVertex(D,Ht.x,Ht.y,!1,ke,0,U,It)}this.addHalfVertex(D,xt.x,xt.y,!1,ke,0,U,It)}ct||se!=null||this.addHalfVertex(D,dt.x+2*xt.x,dt.y+2*xt.y,!1,ke,0,U,It),se!=null&&W&&this.addCurrentVertex(D,J,1,1,U,se)}else de==="butt"?this.addCurrentVertex(D,Te,0,0,U,se):de==="square"?(B||this.addCurrentVertex(D,Te,-1,-1,U,se),this.addCurrentVertex(D,Te,0,0,U,se),B&&this.addCurrentVertex(D,Te,1,1,U,se)):de==="round"&&(B&&(this.addCurrentVertex(D,K,0,0,U,se),this.addCurrentVertex(D,K,1,1,U,se,!0)),W&&(this.addCurrentVertex(D,J,-1,-1,U,se,!0),this.addCurrentVertex(D,J,0,0,U,se)))}}addVerticesTo(a,u,p,_,m,x,R,k,V,b){const O=(u.w-a.w)/this.tessellationStep|0;let U=0;const D=this.scaledDistance;if(O>1){this.lineSoFar=a.w;const W=(u.x-a.x)/O,K=(u.y-a.y)/O,J=(u.z-a.z)/O,se=(u.w-a.w)/O;for(let oe=1;oe<O;++oe){a.x+=W,a.y+=K,a.z+=J,this.lineSoFar+=se,U+=se;const te=this.evaluateElevationValue(this.prevDistance+U);this.scaledDistance=(this.prevDistance+U)/this.totalDistance,this.addHalfVertex(a,p,_,b,!1,R,V,te),this.addHalfVertex(a,m,x,b,!0,-k,V,te)}}this.lineSoFar=u.w,this.scaledDistance=D;const B=this.evaluateElevationValue(this.distance);this.addHalfVertex(u,p,_,b,!1,R,V,B),this.addHalfVertex(u,m,x,b,!0,-k,V,B)}evaluateElevationValue(a){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):vi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(a,u,p,_,m,x,R=!1){const k=u.x+u.y*p,V=u.y-u.x*p,b=u.y*_-u.x,O=-u.y-u.x*_;if(x!=null){const D=Mn+10,B=x,W=new e4(a.x,a.y,B,this.lineSoFar),K=UP(a,-10,D),J=this.lineSoFar,se=this.distance;if(this.currentVertex)if(K){const oe=this.currentVertexIsOutside,te=this.currentVertex,de=new e4(a.x,a.y,B,this.lineSoFar);if(n4(te,de,-10,D),!UP(de,-10,D)){if(oe){this.e1=this.e2=-1,this.distance-=te.dist(W),this.lineSoFar=te.w;const ge=this.evaluateElevationValue(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,k,V,R,!1,p,m,ge),this.addHalfVertex(te,b,O,R,!0,-_,m,ge),this.prevDistance=this.distance}this.distance=this.prevDistance+te.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(te,de,k,V,b,O,p,_,m,R),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const oe=this.currentVertex;if(this.currentVertexIsOutside){n4(oe,W,-10,D),this.e1=this.e2=-1,this.distance-=oe.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=oe.w;const te=this.evaluateElevationValue(oe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(oe,k,V,R,!1,p,m,te),this.addHalfVertex(oe,b,O,R,!0,-_,m,te),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(oe,W,k,V,b,O,p,_,m,R)}else K||(this.addHalfVertex(a,k,V,R,!1,p,m,x),this.addHalfVertex(a,b,O,R,!0,-_,m,x));this.currentVertex=W,this.currentVertexIsOutside=K,this.lineSoFar=J}else this.addHalfVertex(a,k,V,R,!1,p,m,x),this.addHalfVertex(a,b,O,R,!0,-_,m,x)}addHalfVertex({x:a,y:u},p,_,m,x,R,k,V){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,R)),this.layoutVertexArray.emplaceBack((a<<1)+(m?1:0),(u<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(R===0?0:R<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),k.primitiveLength++),x?this.e2=b:this.e1=b,V!=null&&this.zOffsetVertexArray.emplaceBack(V)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,u){this.prevDistance=this.distance,this.distance+=a.dist(u),this.updateScaledDistance()}}function UP(d,a,u){return d.x<a||d.x>u||d.y<a||d.y>u}let A4,P4;function I4(d,a,u){return a*(Mn/(d.tileSize*Math.pow(2,u-d.tileID.overscaledZ)))}Un(zP,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const D4=(d,a,u)=>(1-u)*d+u*a;function F4(d,a){return 1/I4(d,1,a.tileZoom)}function L4(d,a,u,p){return d.translatePosMatrix(p||a.tileID.projMatrix,a,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const O4=d=>{const a=[];k4(d)&&a.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const u=d.paint.get("line-trim-offset");u[0]===0&&u[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),d.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const p=d.layout.get("line-join").constantOr("miter")==="none",_=!!d.paint.get("line-pattern").constantOr(1);return p&&_&&a.push("LINE_JOIN_NONE"),a};function k4(d){const a=d.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}let VP;const N4=()=>VP||(VP={layout:A4||(A4=new Ur({"line-cap":new ni(Tt.layout_line["line-cap"]),"line-join":new ni(Tt.layout_line["line-join"]),"line-miter-limit":new yn(Tt.layout_line["line-miter-limit"]),"line-round-limit":new yn(Tt.layout_line["line-round-limit"]),"line-sort-key":new ni(Tt.layout_line["line-sort-key"]),"line-z-offset":new ni(Tt.layout_line["line-z-offset"]),"line-elevation-reference":new yn(Tt.layout_line["line-elevation-reference"]),"line-cross-slope":new yn(Tt.layout_line["line-cross-slope"]),visibility:new yn(Tt.layout_line.visibility)})),paint:P4||(P4=new Ur({"line-opacity":new ni(Tt.paint_line["line-opacity"]),"line-color":new ni(Tt.paint_line["line-color"]),"line-translate":new yn(Tt.paint_line["line-translate"]),"line-translate-anchor":new yn(Tt.paint_line["line-translate-anchor"]),"line-width":new ni(Tt.paint_line["line-width"]),"line-gap-width":new ni(Tt.paint_line["line-gap-width"]),"line-offset":new ni(Tt.paint_line["line-offset"]),"line-blur":new ni(Tt.paint_line["line-blur"]),"line-dasharray":new ni(Tt.paint_line["line-dasharray"]),"line-pattern":new ni(Tt.paint_line["line-pattern"]),"line-gradient":new Ph(Tt.paint_line["line-gradient"]),"line-trim-offset":new yn(Tt.paint_line["line-trim-offset"]),"line-trim-fade-range":new yn(Tt.paint_line["line-trim-fade-range"]),"line-trim-color":new yn(Tt.paint_line["line-trim-color"]),"line-emissive-strength":new yn(Tt.paint_line["line-emissive-strength"]),"line-border-width":new ni(Tt.paint_line["line-border-width"]),"line-border-color":new ni(Tt.paint_line["line-border-color"]),"line-occlusion-opacity":new yn(Tt.paint_line["line-occlusion-opacity"])}))},VP);class tee extends ni{possiblyEvaluate(a,u){return u=new gs(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,p,_){return u=Bn({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,p,_)}}let eC;function B4(d,a){return a>0?a+2*d:d}const nee=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iee=Qi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ree=Qi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const see=Qi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),oee=Qi([{name:"a_texb",components:2,type:"Uint16"}]),aee=Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),lee=Qi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const z4=Qi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cee=Qi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qi([{name:"triangle",components:3,type:"Uint16"}]),Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wa=24;const Oh=128;function GP(d,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new gs(d+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=u;let m=0;for(;m<p.length&&p[m]<=d;)m++;m=Math.max(0,m-1);let x=m;for(;x<p.length&&p[x]<d+1;)x++;x=Math.min(p.length-1,x);const R=p[m],k=p[x];return u.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:k,interpolationType:_}:{kind:"camera",minZoom:R,maxZoom:k,minSize:u.evaluate(new gs(R)),maxSize:u.evaluate(new gs(k)),interpolationType:_}}}function Fb(d,{uSize:a,uSizeT:u},{lowerSize:p,upperSize:_}){return d.kind==="source"?p/Oh:d.kind==="composite"?Hn(p/Oh,_/Oh,u):a}function h0(d,a,u=1){let p=0,_=0;if(d.kind==="constant")_=d.layoutSize*u;else if(d.kind!=="source"){const{interpolationType:m,minZoom:x,maxZoom:R}=d,k=m?yt(Xa.interpolationFactor(m,a,x,R),0,1):0;d.kind==="camera"?_=Hn(d.minSize,d.maxSize,k)*u:p=k*u}return{uSizeT:p,uSize:_}}var uee=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Oh,evaluateSizeForFeature:Fb,evaluateSizeForZoom:h0,getSizeData:GP});function hee(d,a,u){return d.sections.forEach(p=>{p.text=function(_,m,x){const R=m.layout.get("text-transform").evaluate(x,{});return R==="uppercase"?_=_.toLocaleUpperCase():R==="lowercase"&&(_=_.toLocaleLowerCase()),ka.applyArabicShaping&&(_=ka.applyArabicShaping(_)),_}(p.text,a,u)}),d}const tC={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function dee(d){return d==="︶"||d==="﹈"||d==="︸"||d==="﹄"||d==="﹂"||d==="︾"||d==="︼"||d==="︺"||d==="︘"||d==="﹀"||d==="︐"||d==="︓"||d==="︔"||d==="｀"||d==="￣"||d==="︑"||d==="︒"}function fee(d){return d==="︵"||d==="﹇"||d==="︷"||d==="﹃"||d==="﹁"||d==="︽"||d==="︻"||d==="︹"||d==="︗"||d==="︿"}var U4,HP,V4,WP={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function pee(){return U4||(U4=1,WP.read=function(d,a,u,p,_){var m,x,R=8*_-p-1,k=(1<<R)-1,V=k>>1,b=-7,O=u?_-1:0,U=u?-1:1,D=d[a+O];for(O+=U,m=D&(1<<-b)-1,D>>=-b,b+=R;b>0;m=256*m+d[a+O],O+=U,b-=8);for(x=m&(1<<-b)-1,m>>=-b,b+=p;b>0;x=256*x+d[a+O],O+=U,b-=8);if(m===0)m=1-V;else{if(m===k)return x?NaN:1/0*(D?-1:1);x+=Math.pow(2,p),m-=V}return(D?-1:1)*x*Math.pow(2,m-p)},WP.write=function(d,a,u,p,_,m){var x,R,k,V=8*m-_-1,b=(1<<V)-1,O=b>>1,U=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=p?0:m-1,B=p?1:-1,W=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(R=isNaN(a)?1:0,x=b):(x=Math.floor(Math.log(a)/Math.LN2),a*(k=Math.pow(2,-x))<1&&(x--,k*=2),(a+=x+O>=1?U/k:U*Math.pow(2,1-O))*k>=2&&(x++,k/=2),x+O>=b?(R=0,x=b):x+O>=1?(R=(a*k-1)*Math.pow(2,_),x+=O):(R=a*Math.pow(2,O-1)*Math.pow(2,_),x=0));_>=8;d[u+D]=255&R,D+=B,R/=256,_-=8);for(x=x<<_|R,V+=_;V>0;d[u+D]=255&x,D+=B,x/=256,V-=8);d[u+D-B]|=128*W}),WP}function G4(){if(V4)return HP;V4=1,HP=a;var d=pee();function a(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}a.Varint=0,a.Fixed64=1,a.Bytes=2,a.Fixed32=5;var u=4294967296,p=1/u,_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function m(te){return te.type===a.Bytes?te.readVarint()+te.pos:te.pos+1}function x(te,de,ge){return ge?4294967296*de+(te>>>0):4294967296*(de>>>0)+(te>>>0)}function R(te,de,ge){var Te=de<=16383?1:de<=2097151?2:de<=268435455?3:Math.floor(Math.log(de)/(7*Math.LN2));ge.realloc(Te);for(var Ve=ge.pos-1;Ve>=te;Ve--)ge.buf[Ve+Te]=ge.buf[Ve]}function k(te,de){for(var ge=0;ge<te.length;ge++)de.writeVarint(te[ge])}function V(te,de){for(var ge=0;ge<te.length;ge++)de.writeSVarint(te[ge])}function b(te,de){for(var ge=0;ge<te.length;ge++)de.writeFloat(te[ge])}function O(te,de){for(var ge=0;ge<te.length;ge++)de.writeDouble(te[ge])}function U(te,de){for(var ge=0;ge<te.length;ge++)de.writeBoolean(te[ge])}function D(te,de){for(var ge=0;ge<te.length;ge++)de.writeFixed32(te[ge])}function B(te,de){for(var ge=0;ge<te.length;ge++)de.writeSFixed32(te[ge])}function W(te,de){for(var ge=0;ge<te.length;ge++)de.writeFixed64(te[ge])}function K(te,de){for(var ge=0;ge<te.length;ge++)de.writeSFixed64(te[ge])}function J(te,de){return(te[de]|te[de+1]<<8|te[de+2]<<16)+16777216*te[de+3]}function se(te,de,ge){te[ge]=de,te[ge+1]=de>>>8,te[ge+2]=de>>>16,te[ge+3]=de>>>24}function oe(te,de){return(te[de]|te[de+1]<<8|te[de+2]<<16)+(te[de+3]<<24)}return a.prototype={destroy:function(){this.buf=null},readFields:function(te,de,ge){for(ge=ge||this.length;this.pos<ge;){var Te=this.readVarint(),Ve=Te>>3,Oe=this.pos;this.type=7&Te,te(Ve,de,this),this.pos===Oe&&this.skip(Te)}return de},readMessage:function(te,de){return this.readFields(te,de,this.readVarint()+this.pos)},readFixed32:function(){var te=J(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=oe(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=J(this.buf,this.pos)+J(this.buf,this.pos+4)*u;return this.pos+=8,te},readSFixed64:function(){var te=J(this.buf,this.pos)+oe(this.buf,this.pos+4)*u;return this.pos+=8,te},readFloat:function(){var te=d.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=d.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var de,ge,Te=this.buf;return de=127&(ge=Te[this.pos++]),ge<128?de:(de|=(127&(ge=Te[this.pos++]))<<7,ge<128?de:(de|=(127&(ge=Te[this.pos++]))<<14,ge<128?de:(de|=(127&(ge=Te[this.pos++]))<<21,ge<128?de:function(Ve,Oe,Ne){var st,ke,et=Ne.buf;if(st=(112&(ke=et[Ne.pos++]))>>4,ke<128||(st|=(127&(ke=et[Ne.pos++]))<<3,ke<128)||(st|=(127&(ke=et[Ne.pos++]))<<10,ke<128)||(st|=(127&(ke=et[Ne.pos++]))<<17,ke<128)||(st|=(127&(ke=et[Ne.pos++]))<<24,ke<128)||(st|=(1&(ke=et[Ne.pos++]))<<31,ke<128))return x(Ve,st,Oe);throw new Error("Expected varint not more than 10 bytes")}(de|=(15&(ge=Te[this.pos]))<<28,te,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2==1?(te+1)/-2:te/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var te=this.readVarint()+this.pos,de=this.pos;return this.pos=te,te-de>=12&&_?function(ge,Te,Ve){return _.decode(ge.subarray(Te,Ve))}(this.buf,de,te):function(ge,Te,Ve){for(var Oe="",Ne=Te;Ne<Ve;){var st,ke,et,ct=ge[Ne],dt=null,xt=ct>239?4:ct>223?3:ct>191?2:1;if(Ne+xt>Ve)break;xt===1?ct<128&&(dt=ct):xt===2?(192&(st=ge[Ne+1]))==128&&(dt=(31&ct)<<6|63&st)<=127&&(dt=null):xt===3?(ke=ge[Ne+2],(192&(st=ge[Ne+1]))==128&&(192&ke)==128&&((dt=(15&ct)<<12|(63&st)<<6|63&ke)<=2047||dt>=55296&&dt<=57343)&&(dt=null)):xt===4&&(ke=ge[Ne+2],et=ge[Ne+3],(192&(st=ge[Ne+1]))==128&&(192&ke)==128&&(192&et)==128&&((dt=(15&ct)<<18|(63&st)<<12|(63&ke)<<6|63&et)<=65535||dt>=1114112)&&(dt=null)),dt===null?(dt=65533,xt=1):dt>65535&&(dt-=65536,Oe+=String.fromCharCode(dt>>>10&1023|55296),dt=56320|1023&dt),Oe+=String.fromCharCode(dt),Ne+=xt}return Oe}(this.buf,de,te)},readBytes:function(){var te=this.readVarint()+this.pos,de=this.buf.subarray(this.pos,te);return this.pos=te,de},readPackedVarint:function(te,de){if(this.type!==a.Bytes)return te.push(this.readVarint(de));var ge=m(this);for(te=te||[];this.pos<ge;)te.push(this.readVarint(de));return te},readPackedSVarint:function(te){if(this.type!==a.Bytes)return te.push(this.readSVarint());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==a.Bytes)return te.push(this.readBoolean());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==a.Bytes)return te.push(this.readFloat());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==a.Bytes)return te.push(this.readDouble());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==a.Bytes)return te.push(this.readFixed32());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==a.Bytes)return te.push(this.readSFixed32());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==a.Bytes)return te.push(this.readFixed64());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==a.Bytes)return te.push(this.readSFixed64());var de=m(this);for(te=te||[];this.pos<de;)te.push(this.readSFixed64());return te},skip:function(te){var de=7&te;if(de===a.Varint)for(;this.buf[this.pos++]>127;);else if(de===a.Bytes)this.pos=this.readVarint()+this.pos;else if(de===a.Fixed32)this.pos+=4;else{if(de!==a.Fixed64)throw new Error("Unimplemented type: "+de);this.pos+=8}},writeTag:function(te,de){this.writeVarint(te<<3|de)},realloc:function(te){for(var de=this.length||16;de<this.pos+te;)de*=2;if(de!==this.length){var ge=new Uint8Array(de);ge.set(this.buf),this.buf=ge,this.length=de}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),se(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),se(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),se(this.buf,-1&te,this.pos),se(this.buf,Math.floor(te*p),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),se(this.buf,-1&te,this.pos),se(this.buf,Math.floor(te*p),this.pos+4),this.pos+=8},writeVarint:function(te){(te=+te||0)>268435455||te<0?function(de,ge){var Te,Ve;if(de>=0?(Te=de%4294967296|0,Ve=de/4294967296|0):(Ve=~(-de/4294967296),4294967295^(Te=~(-de%4294967296))?Te=Te+1|0:(Te=0,Ve=Ve+1|0)),de>=18446744073709552e3||de<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ge.realloc(10),function(Oe,Ne,st){st.buf[st.pos++]=127&Oe|128,Oe>>>=7,st.buf[st.pos++]=127&Oe|128,Oe>>>=7,st.buf[st.pos++]=127&Oe|128,Oe>>>=7,st.buf[st.pos++]=127&Oe|128,st.buf[st.pos]=127&(Oe>>>=7)}(Te,0,ge),function(Oe,Ne){var st=(7&Oe)<<4;Ne.buf[Ne.pos++]|=st|((Oe>>>=3)?128:0),Oe&&(Ne.buf[Ne.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ne.buf[Ne.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ne.buf[Ne.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ne.buf[Ne.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ne.buf[Ne.pos++]=127&Oe)))))}(Ve,ge)}(te,this):(this.realloc(4),this.buf[this.pos++]=127&te|(te>127?128:0),te<=127||(this.buf[this.pos++]=127&(te>>>=7)|(te>127?128:0),te<=127||(this.buf[this.pos++]=127&(te>>>=7)|(te>127?128:0),te<=127||(this.buf[this.pos++]=te>>>7&127))))},writeSVarint:function(te){this.writeVarint(te<0?2*-te-1:2*te)},writeBoolean:function(te){this.writeVarint(!!te)},writeString:function(te){te=String(te),this.realloc(4*te.length),this.pos++;var de=this.pos;this.pos=function(Te,Ve,Oe){for(var Ne,st,ke=0;ke<Ve.length;ke++){if((Ne=Ve.charCodeAt(ke))>55295&&Ne<57344){if(!st){Ne>56319||ke+1===Ve.length?(Te[Oe++]=239,Te[Oe++]=191,Te[Oe++]=189):st=Ne;continue}if(Ne<56320){Te[Oe++]=239,Te[Oe++]=191,Te[Oe++]=189,st=Ne;continue}Ne=st-55296<<10|Ne-56320|65536,st=null}else st&&(Te[Oe++]=239,Te[Oe++]=191,Te[Oe++]=189,st=null);Ne<128?Te[Oe++]=Ne:(Ne<2048?Te[Oe++]=Ne>>6|192:(Ne<65536?Te[Oe++]=Ne>>12|224:(Te[Oe++]=Ne>>18|240,Te[Oe++]=Ne>>12&63|128),Te[Oe++]=Ne>>6&63|128),Te[Oe++]=63&Ne|128)}return Oe}(this.buf,te,this.pos);var ge=this.pos-de;ge>=128&&R(de,ge,this),this.pos=de-1,this.writeVarint(ge),this.pos+=ge},writeFloat:function(te){this.realloc(4),d.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),d.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var de=te.length;this.writeVarint(de),this.realloc(de);for(var ge=0;ge<de;ge++)this.buf[this.pos++]=te[ge]},writeRawMessage:function(te,de){this.pos++;var ge=this.pos;te(de,this);var Te=this.pos-ge;Te>=128&&R(ge,Te,this),this.pos=ge-1,this.writeVarint(Te),this.pos+=Te},writeMessage:function(te,de,ge){this.writeTag(te,a.Bytes),this.writeRawMessage(de,ge)},writePackedVarint:function(te,de){de.length&&this.writeMessage(te,k,de)},writePackedSVarint:function(te,de){de.length&&this.writeMessage(te,V,de)},writePackedBoolean:function(te,de){de.length&&this.writeMessage(te,U,de)},writePackedFloat:function(te,de){de.length&&this.writeMessage(te,b,de)},writePackedDouble:function(te,de){de.length&&this.writeMessage(te,O,de)},writePackedFixed32:function(te,de){de.length&&this.writeMessage(te,D,de)},writePackedSFixed32:function(te,de){de.length&&this.writeMessage(te,B,de)},writePackedFixed64:function(te,de){de.length&&this.writeMessage(te,W,de)},writePackedSFixed64:function(te,de){de.length&&this.writeMessage(te,K,de)},writeBytesField:function(te,de){this.writeTag(te,a.Bytes),this.writeBytes(de)},writeFixed32Field:function(te,de){this.writeTag(te,a.Fixed32),this.writeFixed32(de)},writeSFixed32Field:function(te,de){this.writeTag(te,a.Fixed32),this.writeSFixed32(de)},writeFixed64Field:function(te,de){this.writeTag(te,a.Fixed64),this.writeFixed64(de)},writeSFixed64Field:function(te,de){this.writeTag(te,a.Fixed64),this.writeSFixed64(de)},writeVarintField:function(te,de){this.writeTag(te,a.Varint),this.writeVarint(de)},writeSVarintField:function(te,de){this.writeTag(te,a.Varint),this.writeSVarint(de)},writeStringField:function(te,de){this.writeTag(te,a.Bytes),this.writeString(de)},writeFloatField:function(te,de){this.writeTag(te,a.Fixed32),this.writeFloat(de)},writeDoubleField:function(te,de){this.writeTag(te,a.Fixed64),this.writeDouble(de)},writeBooleanField:function(te,de){this.writeVarintField(te,!!de)}},HP}var Lb=f(G4());const jP=3;function mee(d,a,u){a.glyphs=[],d===1&&u.readMessage(gee,a)}function gee(d,a,u){if(d===3){const{id:p,bitmap:_,width:m,height:x,left:R,top:k,advance:V}=u.readMessage(vee,{});a.glyphs.push({id:p,bitmap:new ng({width:m+2*jP,height:x+2*jP},_),metrics:{width:m,height:x,left:R,top:k,advance:V}})}else d===4?a.ascender=u.readSVarint():d===5&&(a.descender=u.readSVarint())}function vee(d,a,u){d===1?a.id=u.readVarint():d===2?a.bitmap=u.readBytes():d===3?a.width=u.readVarint():d===4?a.height=u.readVarint():d===5?a.left=u.readSVarint():d===6?a.top=u.readSVarint():d===7&&(a.advance=u.readVarint())}const H4=jP,su={horizontal:1,vertical:2,horizontalOnly:3};class nC{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,u){const p=new nC;return p.scale=a||1,p.fontStack=u,p}static forImage(a){const u=new nC;return u.imageName=a,u}}class d0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,u){const p=new d0;for(let _=0;_<a.sections.length;_++){const m=a.sections[_];m.image?p.addImageSection(m):p.addTextSection(m,u)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(u,p){let _="";for(let m=0;m<u.length;m++){const x=u.charCodeAt(m+1)||null,R=u.charCodeAt(m-1)||null;_+=!p&&(x&&np(x)&&!tC[u[m+1]]||R&&np(R)&&!tC[u[m-1]])||!tC[u[m]]?u[m]:tC[u[m]]}return _}(this.text,a)}trim(){let a=0;for(let p=0;p<this.text.length&&Ob[this.text.charCodeAt(p)];p++)a++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&Ob[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(a,u),this.sectionIndex=this.sectionIndex.slice(a,u)}substring(a,u){const p=new d0;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,u)=>Math.max(a,this.sections[u].scale),0)}addTextSection(a,u){this.text+=a.text,this.sections.push(nC.forText(a.scale,a.fontStack||u));const p=this.sections.length-1;for(let _=0;_<a.text.length;++_)this.sectionIndex.push(p)}addImageSection(a){const u=a.image?a.image.namePrimary:"";if(u.length===0)return void vi("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(nC.forImage(u)),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $P(d,a,u,p,_,m,x,R,k,V,b,O,U,D,B){const W=d0.fromFeature(d,_);O===su.vertical&&W.verticalizePunctuation(U);let K=[];const J=function(ge,Te,Ve,Oe,Ne,st){if(!ge)return[];const ke=[],et=function(Rt,It,Et,en,dn,Ht){let Vn=0;for(let Rn=0;Rn<Rt.length();Rn++){const xn=Rt.getSection(Rn);Vn+=W4(Rt.getCodePoint(Rn),xn,en,dn,It,Ht)}return Vn/Math.max(1,Math.ceil(Vn/Et))}(ge,Te,Ve,Oe,Ne,st),ct=ge.text.indexOf("​")>=0;let dt=0;for(let Rt=0;Rt<ge.length();Rt++){const It=ge.getSection(Rt),Et=ge.getCodePoint(Rt);if(Ob[Et]||(dt+=W4(Et,It,Oe,Ne,Te,st)),Rt<ge.length()-1){const en=!((xt=Et)<11904||!(Jn["Bopomofo Extended"](xt)||Jn.Bopomofo(xt)||Jn["CJK Compatibility Forms"](xt)||Jn["CJK Compatibility Ideographs"](xt)||Jn["CJK Compatibility"](xt)||Jn["CJK Radicals Supplement"](xt)||Jn["CJK Strokes"](xt)||Jn["CJK Symbols and Punctuation"](xt)||Jn["CJK Unified Ideographs Extension A"](xt)||Jn["CJK Unified Ideographs"](xt)||Jn["Enclosed CJK Letters and Months"](xt)||Jn["Halfwidth and Fullwidth Forms"](xt)||Jn.Hiragana(xt)||Jn["Ideographic Description Characters"](xt)||Jn["Kangxi Radicals"](xt)||Jn["Katakana Phonetic Extensions"](xt)||Jn.Katakana(xt)||Jn["Vertical Forms"](xt)||Jn["Yi Radicals"](xt)||Jn["Yi Syllables"](xt)));(yee[Et]||en||It.imageName)&&ke.push($4(Rt+1,dt,et,ke,_ee(Et,ge.getCodePoint(Rt+1),en&&ct),!1))}}var xt;return q4($4(ge.length(),dt,et,ke,0,!0))}(W,V,m,a,p,D),{processBidirectionalText:se,processStyledBidirectionalText:oe}=ka;if(se&&W.sections.length===1){const ge=se(W.toString(),J);for(const Te of ge){const Ve=new d0;Ve.text=Te,Ve.sections=W.sections;for(let Oe=0;Oe<Te.length;Oe++)Ve.sectionIndex.push(0);K.push(Ve)}}else if(oe){const ge=oe(W.text,W.sectionIndex,J);for(const Te of ge){const Ve=new d0;Ve.text=Te[0],Ve.sectionIndex=Te[1],Ve.sections=W.sections,K.push(Ve)}}else K=function(ge,Te){const Ve=[],Oe=ge.text;let Ne=0;for(const st of Te)Ve.push(ge.substring(Ne,st)),Ne=st;return Ne<Oe.length&&Ve.push(ge.substring(Ne,Oe.length)),Ve}(W,J);const te=[],de={positionedLines:te,text:W.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Te,Ve,Oe,Ne,st,ke,et,ct,dt,xt,Rt){let It=0,Et=0,en=0;const dn=et==="right"?1:et==="left"?0:.5;let Ht=!1;for(const Nn of Ne){const qn=Nn.getSections();for(const Pi of qn){if(Pi.imageName)continue;const zi=Te[Pi.fontStack];if(zi&&(Ht=zi.ascender!==void 0&&zi.descender!==void 0,!Ht))break}if(!Ht)break}let Vn=0;for(const Nn of Ne){Nn.trim();const qn=Nn.getMaxScale(),Pi=(qn-1)*wa,zi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Vn]=zi;const Ui=zi.positionedGlyphs;let ki=0;if(!Nn.length()){Et+=st,++Vn;continue}let Yi=0,Zi=0;for(let Gr=0;Gr<Nn.length();Gr++){const Ei=Nn.getSection(Gr),Tr=Nn.getSectionIndex(Gr),Dr=Nn.getCodePoint(Gr);let ds=Ei.scale,Ws=null,so=null,js=null,ks=wa,Ks=0;const go=!(ct===su.horizontal||!xt&&!_c(Dr)||xt&&(Ob[Dr]||(Rn=Dr,Jn.Arabic(Rn)||Jn["Arabic Supplement"](Rn)||Jn["Arabic Extended-A"](Rn)||Jn["Arabic Presentation Forms-A"](Rn)||Jn["Arabic Presentation Forms-B"](Rn))));if(Ei.imageName){const Ca=Oe[Ei.imageName];if(!Ca)continue;js=Ei.imageName,ge.iconsInText=ge.iconsInText||!0,so=Ca.paddedRect;const os=Ca.displaySize;ds=ds*wa/Rt,Ws={width:os[0],height:os[1],left:0,top:-H4,advance:go?os[1]:os[0],localGlyph:!1},Ks=Ht?-Ws.height*ds:qn*wa-17-os[1]*ds,ks=Ws.advance;const zl=(go?os[0]:os[1])*ds-wa*qn;zl>0&&zl>ki&&(ki=zl)}else{const Ca=Ve[Ei.fontStack];if(!Ca)continue;Ca[Dr]&&(so=Ca[Dr]);const os=Te[Ei.fontStack];if(!os)continue;const zl=os.glyphs[Dr];if(!zl)continue;if(Ws=zl.metrics,ks=Dr!==8203?wa:0,Ht){const Uh=os.ascender!==void 0?Math.abs(os.ascender):0,Uu=os.descender!==void 0?Math.abs(os.descender):0,Vu=(Uh+Uu)*ds;Yi<Vu&&(Yi=Vu,Zi=(Uh-Uu)/2*ds),Ks=-Uh*ds}else Ks=(qn-ds)*wa-17}go?(ge.verticalizable=!0,Ui.push({glyph:Dr,imageName:js,x:It,y:Et+Ks,vertical:go,scale:ds,localGlyph:Ws.localGlyph,fontStack:Ei.fontStack,sectionIndex:Tr,metrics:Ws,rect:so}),It+=ks*ds+dt):(Ui.push({glyph:Dr,imageName:js,x:It,y:Et+Ks,vertical:go,scale:ds,localGlyph:Ws.localGlyph,fontStack:Ei.fontStack,sectionIndex:Tr,metrics:Ws,rect:so}),It+=Ws.advance*ds+dt)}Ui.length!==0&&(en=Math.max(It-dt,en),Ht?Z4(Ui,dn,ki,Zi,st*qn/2):Z4(Ui,dn,ki,0,st/2)),It=0;const Kr=st*qn+ki;zi.lineOffset=Math.max(ki,Pi),Et+=Kr,++Vn}var Rn;const xn=Et,{horizontalAlign:hn,verticalAlign:si}=qP(ke);(function(Nn,qn,Pi,zi,Ui,ki){const Yi=(qn-Pi)*Ui,Zi=-ki*zi;for(const Kr of Nn)for(const Gr of Kr.positionedGlyphs)Gr.x+=Yi,Gr.y+=Zi})(ge.positionedLines,dn,hn,si,en,xn),ge.top+=-si*xn,ge.bottom=ge.top+xn,ge.left+=-hn*en,ge.right=ge.left+en,ge.hasBaseline=Ht}(de,a,u,p,K,x,R,k,O,V,U,B),!function(ge){for(const Te of ge)if(Te.positionedGlyphs.length!==0)return!1;return!0}(te)&&de}const Ob={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yee={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function W4(d,a,u,p,_,m){if(a.imageName){const x=p[a.imageName];return x?x.displaySize[0]*a.scale*wa/m+_:0}{const x=u[a.fontStack],R=x&&x.glyphs[d];return R?R.metrics.advance*a.scale+_:0}}function j4(d,a,u,p){const _=Math.pow(d-a,2);return p?d<a?_/2:2*_:_+Math.abs(u)*u}function _ee(d,a,u){let p=0;return d===10&&(p-=1e4),u&&(p+=150),d!==40&&d!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function $4(d,a,u,p,_,m){let x=null,R=j4(a,u,_,m);for(const k of p){const V=j4(a-k.x,u,_,m)+k.badness;V<=R&&(x=k,R=V)}return{index:d,x:a,priorBreak:x,badness:R}}function q4(d){return d?q4(d.priorBreak).concat(d.index):[]}function qP(d){let a=.5,u=.5;switch(d){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function Z4(d,a,u,p,_){if(!(a||u||p||_))return;const m=d.length-1,x=d[m],R=(x.x+x.metrics.advance*x.scale)*a;for(let k=0;k<=m;k++)d[k].x-=R,d[k].y+=u+p+_}function xee(d,a,u,p){const{horizontalAlign:_,verticalAlign:m}=qP(p),x=u[0]-d.displaySize[0]*_,R=u[1]-d.displaySize[1]*m;return{imagePrimary:d,imageSecondary:a,top:R,bottom:R+d.displaySize[1],left:x,right:x+d.displaySize[0]}}function X4(d,a,u,p,_,m){const x=d.imagePrimary;let R;if(x.content){const K=x.content,J=x.pixelRatio||1;R=[K[0]/J,K[1]/J,x.displaySize[0]-K[2]/J,x.displaySize[1]-K[3]/J]}const k=a.left*m,V=a.right*m;let b,O,U,D;u==="width"||u==="both"?(D=_[0]+k-p[3],O=_[0]+V+p[1]):(D=_[0]+(k+V-x.displaySize[0])/2,O=D+x.displaySize[0]);const B=a.top*m,W=a.bottom*m;return u==="height"||u==="both"?(b=_[1]+B-p[0],U=_[1]+W+p[2]):(b=_[1]+(B+W-x.displaySize[1])/2,U=b+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:b,right:O,bottom:U,left:D,collisionPadding:R}}class vp extends _e{constructor(a,u,p,_,m){super(a,u),this.angle=_,this.z=p,m!==void 0&&(this.segment=m)}clone(){return new vp(this.x,this.y,this.z,this.angle,this.segment)}}function K4(d,a,u,p,_){if(a.segment===void 0)return!0;let m=a,x=a.segment+1,R=0;for(;R>-u/2;){if(x--,x<0)return!1;R-=d[x].dist(m),m=d[x]}R+=d[x].dist(d[x+1]),x++;const k=[];let V=0;for(;R<u/2;){const b=d[x],O=d[x+1];if(!O)return!1;let U=d[x-1].angleTo(b)-b.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:R,angleDelta:U}),V+=U;R-k[0].distance>p;)V-=k.shift().angleDelta;if(V>_)return!1;x++,R+=b.dist(O)}return!0}function Y4(d){let a=0;for(let u=0;u<d.length-1;u++)a+=d[u].dist(d[u+1]);return a}function J4(d,a,u){return d?.6*a*u:0}function Q4(d,a){return Math.max(d?d.right-d.left:0,a?a.right-a.left:0)}function wee(d,a,u,p,_,m){const x=J4(u,_,m),R=Q4(u,p)*m;let k=0;const V=Y4(d)/2;for(let b=0;b<d.length-1;b++){const O=d[b],U=d[b+1],D=O.dist(U);if(k+D>V){const B=(V-k)/D,W=Hn(O.x,U.x,B),K=Hn(O.y,U.y,B),J=new vp(W,K,0,U.angleTo(O),b);return!x||K4(d,J,R,x,a)?J:void 0}k+=D}}function Cee(d,a,u,p,_,m,x,R,k){const V=J4(p,m,x),b=Q4(p,_),O=b*x,U=d[0].x===0||d[0].x===k||d[0].y===0||d[0].y===k;return a-O<a/4&&(a=O+a/4),eU(d,U?a/2*R%a:(b/2+2*m)*x*R%a,a,V,u,O,U,!1,k)}function eU(d,a,u,p,_,m,x,R,k){const V=m/2,b=Y4(d);let O=0,U=a-u,D=[];for(let B=0;B<d.length-1;B++){const W=d[B],K=d[B+1],J=W.dist(K),se=K.angleTo(W);for(;U+u<O+J;){U+=u;const oe=(U-O)/J,te=Hn(W.x,K.x,oe),de=Hn(W.y,K.y,oe);if(te>=0&&te<k&&de>=0&&de<k&&U-V>=0&&U+V<=b){const ge=new vp(te,de,0,se,B);p&&!K4(d,ge,m,p,_)||D.push(ge)}}O+=J}return R||D.length||x||(D=eU(d,O/2,u,p,_,m,x,!0,k)),D}function tU(d,a,u,p,_){const m=[];for(let x=0;x<d.length;x++){const R=d[x];let k;for(let V=0;V<R.length-1;V++){let b=R[V],O=R[V+1];b.x<a&&O.x<a||(b.x<a?b=new _e(a,b.y+(a-b.x)/(O.x-b.x)*(O.y-b.y))._round():O.x<a&&(O=new _e(a,b.y+(a-b.x)/(O.x-b.x)*(O.y-b.y))._round()),b.y<u&&O.y<u||(b.y<u?b=new _e(b.x+(u-b.y)/(O.y-b.y)*(O.x-b.x),u)._round():O.y<u&&(O=new _e(b.x+(u-b.y)/(O.y-b.y)*(O.x-b.x),u)._round()),b.x>=p&&O.x>=p||(b.x>=p?b=new _e(p,b.y+(p-b.x)/(O.x-b.x)*(O.y-b.y))._round():O.x>=p&&(O=new _e(p,b.y+(p-b.x)/(O.x-b.x)*(O.y-b.y))._round()),b.y>=_&&O.y>=_||(b.y>=_?b=new _e(b.x+(_-b.y)/(O.y-b.y)*(O.x-b.x),_)._round():O.y>=_&&(O=new _e(b.x+(_-b.y)/(O.y-b.y)*(O.x-b.x),_)._round()),k&&b.equals(k[k.length-1])||(k=[b],m.push(k)),k.push(O)))))}}return m}function nU(d){let a=0,u=0;for(const x of d)a+=x.w*x.h,u=Math.max(u,x.w);d.sort((x,R)=>R.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let _=0,m=0;for(const x of d)for(let R=p.length-1;R>=0;R--){const k=p[R];if(!(x.w>k.w||x.h>k.h)){if(x.x=k.x,x.y=k.y,m=Math.max(m,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===k.w&&x.h===k.h){const V=p.pop();R<p.length&&(p[R]=V)}else x.h===k.h?(k.x+=x.w,k.w-=x.w):x.w===k.w?(k.y+=x.h,k.h-=x.h):(p.push({x:k.x+x.w,y:k.y,w:k.w-x.w,h:x.h}),k.y+=x.h,k.h-=x.h);break}}return{w:_,h:m,fill:a/(_*m)||0}}Un(vp,"Anchor");const iC=1;class ZP{constructor(a,{pixelRatio:u,version:p,stretchX:_,stretchY:m,content:x},R){this.paddedRect=a,this.pixelRatio=u,this.stretchX=_,this.stretchY=m,this.content=x,this.version=p,this.padding=R}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class iU{constructor(a,u,p){const _={},m={};this.haveRenderCallbacks=[];const x=[];this.addImages(a,_,iC,x),this.addImages(u,m,2,x);const{w:R,h:k}=nU(x),V=new Ya({width:R||1,height:k||1});for(const b in a){const O=a[b],U=_[b].paddedRect;Ya.copy(O.data,V,{x:0,y:0},{x:U.x+iC,y:U.y+iC},O.data,p,O.sdf)}for(const b in u){const O=u[b],U=m[b].paddedRect;let D=m[b].padding;const B=U.x+D,W=U.y+D,K=O.data.width,J=O.data.height;D=D>1?D-1:D,Ya.copy(O.data,V,{x:0,y:0},{x:B,y:W},O.data,p),Ya.copy(O.data,V,{x:0,y:J-D},{x:B,y:W-D},{width:K,height:D},p),Ya.copy(O.data,V,{x:0,y:0},{x:B,y:W+J},{width:K,height:D},p),Ya.copy(O.data,V,{x:K-D,y:0},{x:B-D,y:W},{width:D,height:J},p),Ya.copy(O.data,V,{x:0,y:0},{x:B+K,y:W},{width:D,height:J},p),Ya.copy(O.data,V,{x:K-D,y:J-D},{x:B-D,y:W-D},{width:D,height:D},p),Ya.copy(O.data,V,{x:0,y:J-D},{x:B+K,y:W-D},{width:D,height:D},p),Ya.copy(O.data,V,{x:0,y:0},{x:B+K,y:W+J},{width:D,height:D},p),Ya.copy(O.data,V,{x:K-D,y:0},{x:B-D,y:W+J},{width:D,height:D},p)}this.image=V,this.iconPositions=_,this.patternPositions=m}addImages(a,u,p,_){for(const m in a){const x=a[m],R={x:0,y:0,w:x.data.width+2*p,h:x.data.height+2*p};_.push(R),u[m]=new ZP(R,x,p),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(a,u,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>a.hasImage(_,p)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,p);for(const _ in a.getUpdatedImages(p))this.patchUpdatedImage(this.iconPositions[_],a.getImage(_,p),u),this.patchUpdatedImage(this.patternPositions[_],a.getImage(_,p),u)}patchUpdatedImage(a,u,p){if(!a||!u||a.version===u.version)return;a.version=u.version;const[_,m]=a.tl;p.update(u.data,{position:{x:_,y:m}})}}Un(ZP,"ImagePosition"),Un(iU,"ImageAtlas");const rC=1e20;function rU(d,a,u,p,_,m,x,R,k){for(let V=a;V<a+p;V++)sU(d,u*m+V,m,_,x,R,k);for(let V=u;V<u+_;V++)sU(d,V*m+a,1,p,x,R,k)}function sU(d,a,u,p,_,m,x){m[0]=0,x[0]=-rC,x[1]=rC,_[0]=d[a];for(let R=1,k=0,V=0;R<p;R++){_[R]=d[a+R*u];const b=R*R;do{const O=m[k];V=(_[R]-_[O]+b-O*O)/(R-O)/2}while(V<=x[k]&&--k>-1);k++,m[k]=R,x[k]=V,x[k+1]=rC}for(let R=0,k=0;R<p;R++){for(;x[k+1]<R;)k++;const V=m[k],b=R-V;d[a+R*u]=_[V]+b*b}}const kh=2,XP={none:0,ideographs:1,all:2};class f0{constructor(a,u,p){this.requestManager=a,this.localGlyphMode=u,this.localFontFamily=p,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a,u){this.urls[u]=a}getGlyphs(a,u,p){const _=[],m=this.urls[u]||je.GLYPHS_URL;for(const x in a)for(const R of a[x])_.push({stack:x,id:R});Fn(_,({stack:x,id:R},k)=>{let V=this.entries[x];V||(V=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=V.glyphs[R];if(b!==void 0)return void k(null,{stack:x,id:R,glyph:b});if(b=this._tinySDF(V,x,R),b)return V.glyphs[R]=b,void k(null,{stack:x,id:R,glyph:b});const O=Math.floor(R/256);if(256*O>65535)return vi("glyphs > 65535 not supported"),void k(null,{stack:x,id:R,glyph:b});if(V.ranges[O])return void k(null,{stack:x,id:R,glyph:b});let U=V.requests[O];U||(U=V.requests[O]=[],f0.loadGlyphRange(x,O,m,this.requestManager,(D,B)=>{if(B){V.ascender=B.ascender,V.descender=B.descender;for(const W in B.glyphs)this._doesCharSupportLocalGlyph(+W)||(V.glyphs[+W]=B.glyphs[+W]);V.ranges[O]=!0}for(const W of U)W(D,B);delete V.requests[O]})),U.push((D,B)=>{D?k(D):B&&k(null,{stack:x,id:R,glyph:B.glyphs[R]||null})})},(x,R)=>{if(x)p(x);else if(R){const k={};for(const{stack:V,id:b,glyph:O}of R)k[V]===void 0&&(k[V]={}),k[V].glyphs===void 0&&(k[V].glyphs={}),k[V].glyphs[b]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},k[V].ascender=this.entries[V].ascender,k[V].descender=this.entries[V].descender;p(null,k)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==XP.none&&(this.localGlyphMode===XP.all?!!this.localFontFamily:!!this.localFontFamily&&(Jn["CJK Unified Ideographs"](a)||Jn["Hangul Syllables"](a)||Jn.Hiragana(a)||Jn.Katakana(a)||Jn["CJK Symbols and Punctuation"](a)||Jn["CJK Unified Ideographs Extension A"](a)||Jn["CJK Unified Ideographs Extension B"](a)||Jn.Osage(a)))}_tinySDF(a,u,p){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let m=a.tinySDF;if(!m){let W="400";/bold/i.test(u)?W="900":/medium/i.test(u)?W="500":/light/i.test(u)&&(W="200"),m=a.tinySDF=new f0.TinySDF({fontFamily:_,fontWeight:W,fontSize:24*kh,buffer:3*kh,radius:8*kh}),m.fontWeight=W}if(this.localGlyphs[m.fontWeight][p])return this.localGlyphs[m.fontWeight][p];const x=String.fromCodePoint(p),{data:R,width:k,height:V,glyphWidth:b,glyphHeight:O,glyphLeft:U,glyphTop:D,glyphAdvance:B}=m.draw(x);return this.localGlyphs[m.fontWeight][p]={id:p,bitmap:new ng({width:k,height:V},R),metrics:{width:b/kh,height:O/kh,left:U/kh,top:D/kh-27,advance:B/kh,localGlyph:!0}}}}f0.loadGlyphRange=function(d,a,u,p,_){const m=256*a,x=m+255,R=p.transformRequest(p.normalizeGlyphsURL(u).replace("{fontstack}",d).replace("{range}",`${m}-${x}`),ji.Glyphs);fs(R,(k,V)=>{if(k)_(k);else if(V){const b={},O=function(U){return new Lb(U).readFields(mee,{})}(V);for(const U of O.glyphs)b[U.id]=U;_(null,{glyphs:b,ascender:O.ascender,descender:O.descender})}})},f0.TinySDF=class{constructor({fontSize:d=24,buffer:a=3,radius:u=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:m="normal",fontStyle:x="normal"}={}){this.buffer=a,this.cutoff=p,this.radius=u;const R=this.size=d+4*a,k=this._createCanvas(R),V=this.ctx=k.getContext("2d",{willReadFrequently:!0});V.font=`${x} ${m} ${d}px ${_}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(d){const a=document.createElement("canvas");return a.width=a.height=d,a}draw(d){const{width:a,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:m}=this.ctx.measureText(d),x=Math.ceil(u),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-_))),k=Math.min(this.size-this.buffer,x+Math.ceil(p)),V=R+2*this.buffer,b=k+2*this.buffer,O=Math.max(V*b,0),U=new Uint8ClampedArray(O),D={data:U,width:V,height:b,glyphWidth:R,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:a};if(R===0||k===0)return D;const{ctx:B,buffer:W,gridInner:K,gridOuter:J}=this;B.clearRect(W,W,R,k),B.fillText(d,W,W+x);const se=B.getImageData(W,W,R,k);J.fill(rC,0,O),K.fill(0,0,O);for(let oe=0;oe<k;oe++)for(let te=0;te<R;te++){const de=se.data[4*(oe*R+te)+3]/255;if(de===0)continue;const ge=(oe+W)*V+te+W;if(de===1)J[ge]=0,K[ge]=rC;else{const Te=.5-de;J[ge]=Te>0?Te*Te:0,K[ge]=Te<0?Te*Te:0}}rU(J,0,0,V,b,V,this.f,this.v,this.z),rU(K,W,W,R,k,V,this.f,this.v,this.z);for(let oe=0;oe<O;oe++){const te=Math.sqrt(J[oe])-Math.sqrt(K[oe]);U[oe]=Math.round(255-255*(te/this.radius+this.cutoff))}return D}};const rg=iC;function oU(d,a,u,p,_=1){const m=[],x=d.imagePrimary,R=x.pixelRatio,k=x.paddedRect.w-2*rg,V=x.paddedRect.h-2*rg,b=(d.right-d.left)*_,O=(d.bottom-d.top)*_,U=x.stretchX||[[0,k]],D=x.stretchY||[[0,V]],B=(ke,et)=>ke+et[1]-et[0],W=U.reduce(B,0),K=D.reduce(B,0),J=k-W,se=V-K;let oe=0,te=W,de=0,ge=K,Te=0,Ve=J,Oe=0,Ne=se;if(x.content&&p){const ke=x.content;oe=kb(U,0,ke[0]),de=kb(D,0,ke[1]),te=kb(U,ke[0],ke[2]),ge=kb(D,ke[1],ke[3]),Te=ke[0]-oe,Oe=ke[1]-de,Ve=ke[2]-ke[0]-te,Ne=ke[3]-ke[1]-ge}const st=(ke,et,ct,dt)=>{const xt=Nb(ke.stretch-oe,te,b,d.left*_),Rt=Bb(ke.fixed-Te,Ve,ke.stretch,W),It=Nb(et.stretch-de,ge,O,d.top*_),Et=Bb(et.fixed-Oe,Ne,et.stretch,K),en=Nb(ct.stretch-oe,te,b,d.left*_),dn=Bb(ct.fixed-Te,Ve,ct.stretch,W),Ht=Nb(dt.stretch-de,ge,O,d.top*_),Vn=Bb(dt.fixed-Oe,Ne,dt.stretch,K),Rn=new _e(xt,It),xn=new _e(en,It),hn=new _e(en,Ht),si=new _e(xt,Ht),Nn=new _e(Rt/R,Et/R),qn=new _e(dn/R,Vn/R),Pi=a*Math.PI/180;if(Pi){const Kr=Math.sin(Pi),Gr=Math.cos(Pi),Ei=[Gr,-Kr,Kr,Gr];Rn._matMult(Ei),xn._matMult(Ei),si._matMult(Ei),hn._matMult(Ei)}const zi=ke.stretch+ke.fixed,Ui=ct.stretch+ct.fixed,ki=et.stretch+et.fixed,Yi=dt.stretch+dt.fixed,Zi=d.imageSecondary;return{tl:Rn,tr:xn,bl:si,br:hn,texPrimary:{x:x.paddedRect.x+rg+zi,y:x.paddedRect.y+rg+ki,w:Ui-zi,h:Yi-ki},texSecondary:Zi?{x:Zi.paddedRect.x+rg+zi,y:Zi.paddedRect.y+rg+ki,w:Ui-zi,h:Yi-ki}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nn,pixelOffsetBR:qn,minFontScaleX:Ve/R/b,minFontScaleY:Ne/R/O,isSDF:u}};if(p&&(x.stretchX||x.stretchY)){const ke=aU(U,J,W),et=aU(D,se,K);for(let ct=0;ct<ke.length-1;ct++){const dt=ke[ct],xt=ke[ct+1];for(let Rt=0;Rt<et.length-1;Rt++)m.push(st(dt,et[Rt],xt,et[Rt+1]))}}else m.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:V+1}));return m}function kb(d,a,u){let p=0;for(const _ of d)p+=Math.max(a,Math.min(u,_[1]))-Math.max(a,Math.min(u,_[0]));return p}function aU(d,a,u){const p=[{fixed:-rg,stretch:0}];for(const[_,m]of d){const x=p[p.length-1];p.push({fixed:_-x.stretch,stretch:x.stretch}),p.push({fixed:_-x.stretch,stretch:x.stretch+(m-_)})}return p.push({fixed:a+rg,stretch:u}),p}function Nb(d,a,u,p){return d/a*u+p}function Bb(d,a,u,p){return d-a*u/p}function See(d,a,u,p){const _=a+d.positionedLines[p].lineOffset;return p===0?u+_/2:u+(_+(a+d.positionedLines[p-1].lineOffset))/2}function bee(d,a=1,u=!1){let p=1/0,_=1/0,m=-1/0,x=-1/0;const R=d[0];for(let D=0;D<R.length;D++){const B=R[D];(!D||B.x<p)&&(p=B.x),(!D||B.y<_)&&(_=B.y),(!D||B.x>m)&&(m=B.x),(!D||B.y>x)&&(x=B.y)}const k=Math.min(m-p,x-_);let V=k/2;const b=new Uf([],Eee);if(k===0)return new _e(p,_);for(let D=p;D<m;D+=k)for(let B=_;B<x;B+=k)b.push(new p0(D+V,B+V,V,d));let O=function(D){let B=0,W=0,K=0;const J=D[0];for(let se=0,oe=J.length,te=oe-1;se<oe;te=se++){const de=J[se],ge=J[te],Te=de.x*ge.y-ge.x*de.y;W+=(de.x+ge.x)*Te,K+=(de.y+ge.y)*Te,B+=3*Te}return new p0(W/B,K/B,0,D)}(d),U=b.length;for(;b.length;){const D=b.pop();(D.d>O.d||!O.d)&&(O=D,u&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,U)),D.max-O.d<=a||(V=D.h/2,b.push(new p0(D.p.x-V,D.p.y-V,V,d)),b.push(new p0(D.p.x+V,D.p.y-V,V,d)),b.push(new p0(D.p.x-V,D.p.y+V,V,d)),b.push(new p0(D.p.x+V,D.p.y+V,V,d)),U+=4)}return u&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function Eee(d,a){return a.max-d.max}class p0{constructor(a,u,p,_){this.p=new _e(a,u),this.h=p,this.d=function(m,x){let R=!1,k=1/0;for(let V=0;V<x.length;V++){const b=x[V];for(let O=0,U=b.length,D=U-1;O<U;D=O++){const B=b[O],W=b[D];B.y>m.y!=W.y>m.y&&m.x<(W.x-B.x)*(m.y-B.y)/(W.y-B.y)+B.x&&(R=!R),k=Math.min(k,xi(m,B,W))}}return(R?1:-1)*Math.sqrt(k)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const KP=Number.POSITIVE_INFINITY,Mee=Math.sqrt(2);function lU(d,[a,u]){let p=0,_=0;if(u===KP){a<0&&(a=0);const m=a/Mee;switch(d){case"top-right":case"top-left":_=m-7;break;case"bottom-right":case"bottom-left":_=7-m;break;case"bottom":_=7-a;break;case"top":_=a-7}switch(d){case"top-right":case"bottom-right":p=-m;break;case"top-left":case"bottom-left":p=m;break;case"left":p=a;break;case"right":p=-a}}else{switch(a=Math.abs(a),u=Math.abs(u),d){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(d){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}}return[p,_]}function YP(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ree(d,a,u,p,_,m,x,R,k,V,b,O,U,D,B){let W=m.textMaxSize.evaluate(a,{},O);W===void 0?W=x*m.textScaleFactor:W*=m.textScaleFactor;const K=d.layers[0].layout,J=K.get("icon-offset").evaluate(a,{},O),se=uU(u.horizontal)||u.vertical,oe=U.name==="globe",te=wa,de=x*m.textScaleFactor/te,ge=d.tilePixelRatio*W/te,Te=(dt=d.overscaling,d.zoom>18&&dt>2&&(dt>>=1),Math.max(Mn/(512*dt),1)*K.get("symbol-spacing")),Ve=K.get("text-padding")*d.tilePixelRatio,Oe=K.get("icon-padding")*d.tilePixelRatio,Ne=xe(K.get("text-max-angle")),st=K.get("text-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",ke=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",et=K.get("symbol-placement"),ct=Te/2;var dt;const xt=K.get("icon-text-fit").evaluate(a,{},O),Rt=K.get("icon-text-fit-padding").evaluate(a,{},O),It=xt!=="none";let Et;d.hasAnyIconTextFit===!1&&It&&(d.hasAnyIconTextFit=!0),p&&It&&(d.allowVerticalPlacement&&u.vertical&&(Et=X4(p,u.vertical,xt,Rt,J,de)),se&&(p=X4(p,se,xt,Rt,J,de)));const en=(dn,Ht,Vn)=>{if(Ht.x<0||Ht.x>=Mn||Ht.y<0||Ht.y>=Mn)return;let Rn=null;if(oe){const{x:xn,y:hn,z:si}=U.projectTilePoint(Ht.x,Ht.y,Vn);Rn={anchor:new vp(xn,hn,si,0,void 0),up:U.upVector(Vn,Ht.x,Ht.y)}}(function(xn,hn,si,Nn,qn,Pi,zi,Ui,ki,Yi,Zi,Kr,Gr,Ei,Tr,Dr,ds,Ws,so,js,ks,Ks,go,Ca,os,zl,Uh){const Uu=xn.addToLineVertexArray(hn,Nn);let Vu,ay,cg,ly,SC,PV,IV,DV=0,FV=0,LV=0,OV=0,MI=-1,RI=-1;const rf={};let kV=Qo("");const cy=si?si.anchor:hn,TI=ki.layout.get("icon-text-fit").evaluate(ks,{},os)!=="none";let AI=0,PI=0;if(ki._unevaluatedLayout.getValue("text-radial-offset")===void 0?[AI,PI]=ki.layout.get("text-offset").evaluate(ks,{},os).map(bc=>bc*wa):(AI=ki.layout.get("text-radial-offset").evaluate(ks,{},os)*wa,PI=KP),xn.allowVerticalPlacement&&qn.vertical){const bc=qn.vertical;if(Tr)PV=JP(bc),Ui&&(IV=JP(Ui));else{const Ec=ki.layout.get("text-rotate").evaluate(ks,{},os)+90;cg=zb(Yi,cy,hn,Zi,Kr,Gr,bc,Ei,Ec,Dr),Ui&&(ly=zb(Yi,cy,hn,Zi,Kr,Gr,Ui,Ws,Ec))}}if(Pi){const bc=ki.layout.get("icon-rotate").evaluate(ks,{},os),Ec=oU(Pi,bc,go,TI,Ks.iconScaleFactor),C0=Ui?oU(Ui,bc,go,TI,Ks.iconScaleFactor):void 0;ay=zb(Yi,cy,hn,Zi,Kr,Gr,Pi,Ws,bc),DV=4*Ec.length;const NV=xn.iconSizeData;let uy=null;NV.kind==="source"?(uy=[Oh*ki.layout.get("icon-size").evaluate(ks,{},os)*Ks.iconScaleFactor],uy[0]>sg&&vi(`${xn.layerIds[0]}: Value for "icon-size" is >= ${sC}. Reduce your "icon-size".`)):NV.kind==="composite"&&(uy=[Oh*Ks.compositeIconSizes[0].evaluate(ks,{},os)*Ks.iconScaleFactor,Oh*Ks.compositeIconSizes[1].evaluate(ks,{},os)*Ks.iconScaleFactor],(uy[0]>sg||uy[1]>sg)&&vi(`${xn.layerIds[0]}: Value for "icon-size" is >= ${sC}. Reduce your "icon-size".`)),xn.addSymbols(xn.icon,Ec,uy,js,so,ks,!1,si,hn,Uu.lineStartIndex,Uu.lineLength,-1,Ca,os,zl,Uh),MI=xn.icon.placedSymbolArray.length-1,C0&&(FV=4*C0.length,xn.addSymbols(xn.icon,C0,uy,js,so,ks,su.vertical,si,hn,Uu.lineStartIndex,Uu.lineLength,-1,Ca,os,zl,Uh),RI=xn.icon.placedSymbolArray.length-1)}for(const bc in qn.horizontal){const Ec=qn.horizontal[bc];Vu||(kV=Qo(Ec.text),Tr?SC=JP(Ec):Vu=zb(Yi,cy,hn,Zi,Kr,Gr,Ec,Ei,ki.layout.get("text-rotate").evaluate(ks,{},os),Dr));const C0=Ec.positionedLines.length===1;if(LV+=cU(xn,si,hn,Ec,zi,ki,Tr,ks,Dr,Uu,qn.vertical?su.horizontal:su.horizontalOnly,C0?Object.keys(qn.horizontal):[bc],rf,MI,Ks,Ca,os,zl),C0)break}qn.vertical&&(OV+=cU(xn,si,hn,qn.vertical,zi,ki,Tr,ks,Dr,Uu,su.vertical,["vertical"],rf,RI,Ks,Ca,os,zl));let ug=-1;const II=(bc,Ec)=>bc?Math.max(bc,Ec):Ec;ug=II(SC,ug),ug=II(PV,ug),ug=II(IV,ug);const Gte=ug>-1?1:0;xn.glyphOffsetArray.length>=65535&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ks.sortKey!==void 0&&xn.addToSortKeyRanges(xn.symbolInstances.length,ks.sortKey),xn.symbolInstances.emplaceBack(hn.x,hn.y,cy.x,cy.y,cy.z,rf.right>=0?rf.right:-1,rf.center>=0?rf.center:-1,rf.left>=0?rf.left:-1,rf.vertical>=0?rf.vertical:-1,MI,RI,kV,Vu!==void 0?Vu:xn.collisionBoxArray.length,Vu!==void 0?Vu+1:xn.collisionBoxArray.length,cg!==void 0?cg:xn.collisionBoxArray.length,cg!==void 0?cg+1:xn.collisionBoxArray.length,ay!==void 0?ay:xn.collisionBoxArray.length,ay!==void 0?ay+1:xn.collisionBoxArray.length,ly||xn.collisionBoxArray.length,ly?ly+1:xn.collisionBoxArray.length,Zi,LV,OV,DV,FV,Gte,0,AI,PI,ug,0,TI?1:0)})(d,Ht,Rn,dn,u,p,_,Et,d.layers[0],d.collisionBoxArray,a.index,a.sourceLayerIndex,d.index,Ve,st,k,0,Oe,ke,J,a,m,V,b,O,D,B)};if(et==="line")for(const dn of tU(a.geometry,0,0,Mn,Mn)){const Ht=Cee(dn,Te,Ne,u.vertical||se,p,te,ge,d.overscaling,Mn);for(const Vn of Ht)se&&Tee(d,se.text,ct,Vn)||en(dn,Vn,O)}else if(et==="line-center"){for(const dn of a.geometry)if(dn.length>1){const Ht=wee(dn,Ne,u.vertical||se,p,te,ge);Ht&&en(dn,Ht,O)}}else if(a.type==="Polygon")for(const dn of Mb(a.geometry,0)){const Ht=bee(dn,16);en(dn[0],new vp(Ht.x,Ht.y,0,0,void 0),O)}else if(a.type==="LineString")for(const dn of a.geometry)en(dn,new vp(dn[0].x,dn[0].y,0,0,void 0),O);else if(a.type==="Point")for(const dn of a.geometry)for(const Ht of dn)en([Ht],new vp(Ht.x,Ht.y,0,0,void 0),O)}const sC=255,sg=sC*Oh;function cU(d,a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K,J){const se=function(de,ge,Te,Ve,Oe,Ne,st,ke){const et=[];if(ge.positionedLines.length===0)return et;const ct=Ve.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,dt=function(en){const dn=en[0],Ht=en[1],Vn=dn*Ht;return Vn>0?[dn,-Ht]:Vn<0?[-dn,Ht]:dn===0?[Ht,dn]:[Ht,-dn]}(Te);let xt=Math.abs(ge.top-ge.bottom);for(const en of ge.positionedLines)xt-=en.lineOffset;const Rt=ge.positionedLines.length,It=xt/Rt;let Et=ge.top-Te[1];for(let en=0;en<Rt;++en){const dn=ge.positionedLines[en];Et=See(ge,It,Et,en);for(const Ht of dn.positionedGlyphs){if(!Ht.rect)continue;const Vn=Ht.rect||{};let Rn=H4+1,xn=!0,hn=1,si=0;if(Ht.imageName){const js=st[Ht.imageName];if(!js)continue;if(js.sdf){vi("SDF images are not supported in formatted text and will be ignored.");continue}xn=!1,hn=js.pixelRatio,Rn=iC/hn}const Nn=(Oe||ke)&&Ht.vertical,qn=Ht.metrics.advance*Ht.scale/2,Pi=Ht.metrics,zi=Ht.rect;if(zi===null)continue;ke&&ge.verticalizable&&(si=Ht.imageName?qn-Ht.metrics.width*Ht.scale/2:0);const Ui=Oe?[Ht.x+qn,Ht.y]:[0,0];let ki=[0,0],Yi=[0,0],Zi=!1;Oe||(Nn?(Yi=[Ht.x+qn+dt[0],Ht.y+dt[1]-si],Zi=!0):ki=[Ht.x+qn+Te[0],Ht.y+Te[1]-si]);const Kr=zi.w*Ht.scale/(hn*(Ht.localGlyph?kh:1)),Gr=zi.h*Ht.scale/(hn*(Ht.localGlyph?kh:1));let Ei,Tr,Dr,ds;if(Nn){const js=Ht.y-Et,ks=new _e(-qn,qn-js),Ks=-Math.PI/2,go=new _e(...Yi);Ei=new _e(-qn+ki[0],ki[1]),Ei._rotateAround(Ks,ks)._add(go),Ei.x+=-js+qn,Ei.y-=(Pi.left-Rn)*Ht.scale;const Ca=Ht.imageName?Pi.advance*Ht.scale:wa*Ht.scale,os=String.fromCodePoint(Ht.glyph);dee(os)?Ei.x+=(1-Rn)*Ht.scale:fee(os)?Ei.x+=Ca-Pi.height*Ht.scale+(-Rn-1)*Ht.scale:Ei.x+=Ht.imageName||Pi.width+2*Rn===zi.w&&Pi.height+2*Rn===zi.h?(Ca-Gr)/2:(Ca-(Pi.height+2*Rn)*Ht.scale)/2,Tr=new _e(Ei.x,Ei.y-Kr),Dr=new _e(Ei.x+Gr,Ei.y),ds=new _e(Ei.x+Gr,Ei.y-Kr)}else{const js=(Pi.left-Rn)*Ht.scale-qn+ki[0],ks=(-Pi.top-Rn)*Ht.scale+ki[1],Ks=js+Kr,go=ks+Gr;Ei=new _e(js,ks),Tr=new _e(Ks,ks),Dr=new _e(js,go),ds=new _e(Ks,go)}if(ct){let js;js=Oe?new _e(0,0):Zi?new _e(dt[0],dt[1]):new _e(Te[0],Te[1]),Ei._rotateAround(ct,js),Tr._rotateAround(ct,js),Dr._rotateAround(ct,js),ds._rotateAround(ct,js)}const Ws=new _e(0,0),so=new _e(0,0);et.push({tl:Ei,tr:Tr,bl:Dr,br:ds,texPrimary:Vn,texSecondary:void 0,writingMode:ge.writingMode,glyphOffset:Ui,sectionIndex:Ht.sectionIndex,isSDF:xn,pixelOffsetTL:Ws,pixelOffsetBR:so,minFontScaleX:0,minFontScaleY:0})}}return et}(0,p,k,m,x,R,_,d.allowVerticalPlacement),oe=d.textSizeData;let te=null;oe.kind==="source"?(te=[Oh*m.layout.get("text-size").evaluate(R,{},K)*B.textScaleFactor],te[0]>sg&&vi(`${d.layerIds[0]}: Value for "text-size" is >= ${sC}. Reduce your "text-size".`)):oe.kind==="composite"&&(te=[Oh*B.compositeTextSizes[0].evaluate(R,{},K)*B.textScaleFactor,Oh*B.compositeTextSizes[1].evaluate(R,{},K)*B.textScaleFactor],(te[0]>sg||te[1]>sg)&&vi(`${d.layerIds[0]}: Value for "text-size" is >= ${sC}. Reduce your "text-size".`)),d.addSymbols(d.text,se,te,k,x,R,b,a,u,V.lineStartIndex,V.lineLength,D,W,K,J,!1);for(const de of O)U[de]=d.text.placedSymbolArray.length-1;return 4*se.length}function uU(d){for(const a in d)return d[a];return null}function zb(d,a,u,p,_,m,x,R,k,V){let b=x.top,O=x.bottom,U=x.left,D=x.right;const B=x.collisionPadding;if(B&&(U-=B[0],b-=B[1],D+=B[2],O+=B[3]),k){const W=new _e(U,b),K=new _e(D,b),J=new _e(U,O),se=new _e(D,O),oe=xe(k);let te=new _e(0,0);V&&(te=new _e(V[0],V[1])),W._rotateAround(oe,te),K._rotateAround(oe,te),J._rotateAround(oe,te),se._rotateAround(oe,te),U=Math.min(W.x,K.x,J.x,se.x),D=Math.max(W.x,K.x,J.x,se.x),b=Math.min(W.y,K.y,J.y,se.y),O=Math.max(W.y,K.y,J.y,se.y)}return d.emplaceBack(a.x,a.y,a.z,u.x,u.y,U,b,D,O,R,p,_,m),d.length-1}function JP(d){d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const a=d.bottom-d.top;return a>0?Math.max(10,a):null}function Tee(d,a,u,p){const _=d.compareText;if(a in _){const m=_[a];for(let x=m.length-1;x>=0;x--)if(p.dist(m[x])<u)return!0}else _[a]=[];return _[a].push(p),!1}function hU(d,a){const u=d.fovAboveCenter,p=d.elevation?d.elevation.getMinElevationBelowMSL()*a:0,_=(d._camera.position[2]*d.worldSize-p)/Math.cos(d._pitch),m=Math.sin(u)*_/Math.sin(Math.max(Math.PI/2-d._pitch-u,.01));let x=Math.sin(d._pitch)*m+_;const R=_*(1/d._horizonShift);return d.elevation&&d.elevation.exaggeration()!==0||(x*=1+Math.max(d.zoom-17,0)),Math.min(1.01*x,R)}function oC(d,a){if(!a.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:a};const u=Math.pow(2,-d.z),p=d.x*u,_=(d.x+1)*u,m=d.y*u,x=(d.y+1)*u,R=Fe(p),k=Fe(_),V=ze(m),b=ze(x),O=a.project(R,V),U=a.project(k,V),D=a.project(k,b),B=a.project(R,b);let W=Math.min(O.x,U.x,D.x,B.x),K=Math.min(O.y,U.y,D.y,B.y),J=Math.max(O.x,U.x,D.x,B.x),se=Math.max(O.y,U.y,D.y,B.y);const oe=u/16;function te(ge,Te,Ve,Oe,Ne,st){const ke=(Ve+Ne)/2,et=(Oe+st)/2,ct=a.project(Fe(ke),ze(et)),dt=Math.max(0,W-ct.x,K-ct.y,ct.x-J,ct.y-se);W=Math.min(W,ct.x),J=Math.max(J,ct.x),K=Math.min(K,ct.y),se=Math.max(se,ct.y),dt>oe&&(te(ge,ct,Ve,Oe,ke,et),te(ct,Te,ke,et,Ne,st))}te(O,U,p,m,_,m),te(U,D,_,m,_,x),te(D,B,_,x,p,x),te(B,O,p,x,p,m),W-=oe,K-=oe,J+=oe,se+=oe;const de=1/Math.max(J-W,se-K);return{scale:de,x:W*de,y:K*de,x2:J*de,y2:se*de,projection:a}}function dU(d,{x:a,y:u},p=0){return new _e(((a-p)*d.scale-d.x)*Mn,(u*d.scale-d.y)*Mn)}const Aee=Re.mat4.identity(new Float32Array(16));class og{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,u){return{x:0,y:0,z:0}}unproject(a,u){return new X(0,0)}projectTilePoint(a,u,p){return{x:a,y:u,z:0}}locationPoint(a,u,p=!0){return a._coordinatePoint(a.locationCoordinate(u),p)}pixelsPerMeter(a,u){return Ce(1,a)*u}pixelSpaceConversion(a,u,p){return 1}farthestPixelDistance(a){return hU(a,a.pixelsPerMeter)}pointCoordinate(a,u,p,_){const m=a.horizonLineFromTop(!1),x=new _e(u,Math.max(m,p));return a.rayIntersectionCoordinate(a.pointRayIntersection(x,_))}pointCoordinate3D(a,u,p){const _=new _e(u,p);if(a.elevation)return a.elevation.pointCoordinate(_);{const m=this.pointCoordinate(a,_.x,_.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(a,u){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,u.x,u.y);const p=a.horizonLineFromTop();return u.y<p}createInversionMatrix(a,u){return Aee}createTileMatrix(a,u,p){let _,m,x;const R=p.canonical,k=Re.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const V=oC(R,this);_=1,m=V.x+p.wrap*V.scale,x=V.y,Re.mat4.scale(k,k,[_/V.scale,_/V.scale,a.pixelsPerMeter/u])}else _=u/a.zoomScale(R.z),m=(R.x+Math.pow(2,R.z)*p.wrap)*_,x=R.y*_;return Re.mat4.translate(k,k,[m,x,0]),Re.mat4.scale(k,k,[_/Mn,_/Mn,1]),k}upVector(a,u,p){return[0,0,1]}upVectorScale(a,u,p){return{metersToTile:1}}}class Pee extends og{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[u,p]=this.parallels=a.parallels||[29.5,45.5],_=Math.sin(xe(u));this.n=(_+Math.sin(xe(p)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(a,u){const{n:p,c:_,r0:m}=this,x=xe(a-this.center[0]),R=xe(u),k=Math.sqrt(_-2*p*Math.sin(R))/p;return{x:k*Math.sin(x*p),y:k*Math.cos(x*p)-m,z:0}}unproject(a,u){const{n:p,c:_,r0:m}=this,x=m+u;let R=Math.atan2(a,Math.abs(x))*Math.sign(x);x*p<0&&(R-=Math.PI*Math.sign(a)*Math.sign(x));const k=xe(this.center[0])*p;R=jt(R,-Math.PI-k,Math.PI-k);const V=yt(Se(R/p)+this.center[0],-180,180),b=Math.asin(yt((_-(a*a+x*x)*p*p)/(2*p),-1,1)),O=yt(Se(b),-Ze,Ze);return new X(V,O)}}const aC=1.340264,lC=-.081106,cC=893e-6,uC=.003796,Ub=Math.sqrt(3)/2;class Iee extends og{project(a,u){u=u/180*Math.PI,a=a/180*Math.PI;const p=Math.asin(Ub*Math.sin(u)),_=p*p,m=_*_*_;return{x:.5*(a*Math.cos(p)/(Ub*(aC+3*lC*_+m*(7*cC+9*uC*_)))/Math.PI+.5),y:1-.5*(p*(aC+lC*_+m*(cC+uC*_))/Math.PI+1),z:0}}unproject(a,u){a=(2*a-.5)*Math.PI;let p=u=(2*(1-u)-1)*Math.PI,_=p*p,m=_*_*_;for(let b,O,U,D=0;D<12&&(O=p*(aC+lC*_+m*(cC+uC*_))-u,U=aC+3*lC*_+m*(7*cC+9*uC*_),b=O/U,p=yt(p-b,-Math.PI/3,Math.PI/3),_=p*p,m=_*_*_,!(Math.abs(b)<1e-12));++D);const x=Ub*a*(aC+3*lC*_+m*(7*cC+9*uC*_))/Math.cos(p),R=Math.asin(Math.sin(p)/Ub),k=yt(180*x/Math.PI,-180,180),V=yt(180*R/Math.PI,-Ze,Ze);return new X(k,V)}}class Dee extends og{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,u){return{x:.5+a/360,y:.5-u/360,z:0}}unproject(a,u){const p=360*(a-.5),_=yt(360*(.5-u),-Ze,Ze);return new X(p,_)}}const m0=Math.PI/2;function Vb(d){return Math.tan((m0+d)/2)}class Fee extends og{constructor(a){super(a),this.center=a.center||[0,30];const[u,p]=this.parallels=a.parallels||[30,30];let _=xe(u),m=xe(p);this.southernCenter=_+m<0,this.southernCenter&&(_=-_,m=-m);const x=Math.cos(_),R=Vb(_);this.n=_===m?Math.sin(_):Math.log(x/Math.cos(m))/Math.log(Vb(m)/R),this.f=x*Math.pow(Vb(_),this.n)/this.n}project(a,u){u=xe(u),this.southernCenter&&(u=-u),a=xe(a-this.center[0]);const p=1e-6,{n:_,f:m}=this;m>0?u<-m0+p&&(u=-m0+p):u>m0-p&&(u=m0-p);const x=m/Math.pow(Vb(u),_);let R=x*Math.sin(_*a),k=m-x*Math.cos(_*a);return R=.5*(R/Math.PI+.5),k=.5*(k/Math.PI+.5),{x:R,y:this.southernCenter?k:1-k,z:0}}unproject(a,u){a=(2*a-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:p,f:_}=this,m=_-u,x=Math.sign(m),R=Math.sign(p)*Math.sqrt(a*a+m*m);let k=Math.atan2(a,Math.abs(m))*x;m*p<0&&(k-=Math.PI*Math.sign(a)*x);const V=yt(Se(k/p)+this.center[0],-180,180),b=yt(Se(2*Math.atan(Math.pow(_/R,1/p))-m0),-Ze,Ze);return new X(V,this.southernCenter?-b:b)}}class fU extends og{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,u){return{x:ve(a),y:be(u),z:0}}unproject(a,u){const p=Fe(a),_=ze(u);return new X(p,_)}}const pU=xe(Ze);class Lee extends og{project(a,u){const p=(u=xe(u))*u,_=p*p;return{x:.5*((a=xe(a))*(.8707-.131979*p+_*(_*(.003971*p-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+p*(.015085+_*(.028874*p-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(a,u){a=(2*a-.5)*Math.PI;let p=u=(2*(1-u)-1)*Math.PI,_=25,m=0,x=p*p;do{x=p*p;const V=x*x;m=(p*(1.007226+x*(.015085+V*(.028874*x-.044475-.005916*V)))-u)/(1.007226+x*(.045255+V*(.259866*x-.311325-.005916*11*V))),p=yt(p-m,-pU,pU)}while(Math.abs(m)>1e-6&&--_>0);x=p*p;const R=yt(Se(a/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),k=Se(p);return new X(R,k)}}const mU=xe(Ze);class Oee extends og{project(a,u){u=xe(u),a=xe(a);const p=Math.cos(u),_=2/Math.PI,m=Math.acos(p*Math.cos(a/2)),x=Math.sin(m)/m,R=.5*(a*_+2*p*Math.sin(a/2)/x)||0,k=.5*(u+Math.sin(u)/x)||0;return{x:.5*(R/Math.PI+.5),y:1-.5*(k/Math.PI+1),z:0}}unproject(a,u){let p=a=(2*a-.5)*Math.PI,_=u=(2*(1-u)-1)*Math.PI,m=25;const x=1e-6;let R=0,k=0;do{const V=Math.cos(_),b=Math.sin(_),O=2*b*V,U=b*b,D=V*V,B=Math.cos(p/2),W=Math.sin(p/2),K=2*B*W,J=W*W,se=1-D*B*B,oe=se?1/se:0,te=se?Math.acos(V*B)*Math.sqrt(1/se):0,de=.5*(2*te*V*W+2*p/Math.PI)-a,ge=.5*(te*b+_)-u,Te=.5*oe*(D*J+te*V*B*U)+1/Math.PI,Ve=oe*(K*O/4-te*b*W),Oe=.125*oe*(O*W-te*b*D*K),Ne=.5*oe*(U*B+te*J*V)+.5,st=Ve*Oe-Ne*Te;R=(ge*Ve-de*Ne)/st,k=(de*Oe-ge*Te)/st,p=yt(p-R,-Math.PI,Math.PI),_=yt(_-k,-mU,mU)}while((Math.abs(R)>x||Math.abs(k)>x)&&--m>0);return new X(Se(p),Se(_))}}class gU extends og{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,u){const{scale:p,cosPhi:_}=this;return{x:xe(a)*_*p+.5,y:-Math.sin(xe(u))/_*p+.5,z:0}}unproject(a,u){const{scale:p,cosPhi:_}=this,m=-(u-.5)/p,x=yt(Se((a-.5)/p)/_,-180,180),R=Math.asin(yt(m*_,-1,1)),k=yt(Se(R),-Ze,Ze);return new X(x,k)}}class kee extends fU{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,u,p){const _=Ww(a,u,p),m=Cb(tf(p));return Re.vec3.transformMat4(_,_,m),{x:_[0],y:_[1],z:_[2]}}locationPoint(a,u){const p=G(u.lat,u.lng),_=Re.vec3.normalize([],p),m=a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(u),a._centerAltitude):a._centerAltitude,x=Ce(1,0)*Mn*m;Re.vec3.scaleAndAdd(p,p,_,x);const R=Re.mat4.identity(new Float64Array(16));return Re.mat4.multiply(R,a.pixelMatrix,a.globeMatrix),Re.vec3.transformMat4(p,p,R),new _e(p[0],p[1])}pixelsPerMeter(a,u){return Ce(1,0)*u}pixelSpaceConversion(a,u,p){const _=Ce(1,a)*u,m=Hn(Ce(1,45)*u,_,p);return this.pixelsPerMeter(a,u)/m}createTileMatrix(a,u,p){const _=wP(tf(p.canonical));return Re.mat4.multiply(new Float64Array(16),a.globeMatrix,_)}createInversionMatrix(a,u){const{center:p}=a,_=Cb(tf(u));return Re.mat4.rotateY(_,_,xe(p.lng)),Re.mat4.rotateX(_,_,xe(p.lat)),Re.mat4.scale(_,_,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(a,u,p,_){return eg(a,u,p,!0)||new mt(0,0)}pointCoordinate3D(a,u,p){const _=this.pointCoordinate(a,u,p,0);return[_.x,_.y,_.z]}isPointAboveHorizon(a,u){return!eg(a,u.x,u.y,!1)}farthestPixelDistance(a){const u=function(_,m){const x=_.cameraToCenterDistance,R=_._centerAltitude*m,k=_._camera,V=_._camera.forward(),b=Re.vec3.add([],Re.vec3.scale([],V,-x),[0,0,R]),O=_.worldSize/(2*Math.PI),U=[0,0,-O],D=_.width/_.height,B=Math.tan(_.fovAboveCenter),W=Re.vec3.scale([],k.up(),B),K=Re.vec3.scale([],k.right(),B*D),J=Re.vec3.normalize([],Re.vec3.add([],Re.vec3.add([],V,W),K)),se=[];let oe;if(new cl(b,J).closestPointOnSphere(U,O,se)){const te=Re.vec3.add([],se,U),de=Re.vec3.sub([],te,b);oe=Math.cos(_.fovAboveCenter)*Re.vec3.length(de)}else{const te=Re.vec3.sub([],b,U),de=Re.vec3.sub([],U,b);Re.vec3.normalize(de,de);const ge=Re.vec3.length(te)-O;oe=Math.sqrt(ge*(ge+2*O));const Te=Math.acos(oe/(O+ge))-Math.acos(Re.vec3.dot(V,de));oe*=Math.cos(Te)}return 1.01*oe}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),p=tg(a.zoom);if(p>0){const _=hU(a,Ce(1,a.center.lat)*a.worldSize),m=a.worldSize/(2*Math.PI),x=Math.max(a.width,a.height)/a.worldSize*Math.PI;return Hn(u,_+m*(1-Math.cos(x)),Math.pow(p,10))}return u}upVector(a,u,p){return Ww(u,p,a,1)}upVectorScale(a){return{metersToTile:Qm(wb(tf(a)))}}}function vU(d){const a=d.parallels,u=!!a&&Math.abs(a[0]+a[1])<.01;switch(d.name){case"mercator":return new fU(d);case"equirectangular":return new Dee(d);case"naturalEarth":return new Lee(d);case"equalEarth":return new Iee(d);case"winkelTripel":return new Oee(d);case"albers":return u?new gU(d):new Pee(d);case"lambertConformalConic":return u?new gU(d):new Fee(d);case"globe":return new kee(d)}throw new Error(`Invalid projection name: ${d.name}`)}const Nee=u0.VectorTileFeature.types,Bee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gb(d,a,u,p,_,m,x,R,k,V,b,O,U){const D=R?Math.min(sg,Math.round(R[0])):0,B=R?Math.min(sg,Math.round(R[1])):0;d.emplaceBack(a,u,Math.round(32*p),Math.round(32*_),m,x,(D<<1)+(k?1:0),B,16*V,16*b,256*O,256*U)}function Hb(d,a,u){d.emplaceBack(a,u)}function Wb(d,a,u,p,_,m,x){d.emplaceBack(a,u,p,_,m,x)}function jb(d,a,u,p,_){d.emplaceBack(a,u,p,_),d.emplaceBack(a,u,p,_),d.emplaceBack(a,u,p,_),d.emplaceBack(a,u,p,_)}function zee(d){for(const a of d.sections)if(i0(a.text))return!0;return!1}class QP{constructor(a){this.layoutVertexArray=new Ou,this.indexArray=new ss,this.programConfigurations=a,this.segments=new Is,this.dynamicLayoutVertexArray=new pa,this.opacityVertexArray=new Xv,this.placedSymbolArray=new Km,this.iconTransitioningVertexArray=new xa,this.globeExtVertexArray=new lp,this.zOffsetVertexArray=new tu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(a,u,p,_,m){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,nee.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,ree.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Bee,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,oee.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,iee.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,see.members,!0)),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Un(QP,"SymbolBuffers");class eI{constructor(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new Is,this.collisionVertexArray=new ll,this.collisionVertexArrayExt=new pa}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,aee.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,lee.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Un(eI,"CollisionBuffers");class $b{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.lut=a.lut,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Re.mat4.identity([]),this.placementViewportMatrix=Re.mat4.identity([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=GP(this.zoom,u["text-size"]),this.iconSizeData=GP(this.zoom,u["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),m=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&_.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=p.get("text-writing-mode").map(x=>su[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=p.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new QP(new ai(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new QP(new ai(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new Ym,this.lineVertexArray=new Jm,this.symbolInstances=new Na}calculateGlyphDependencies(a,u,p,_,m){for(const x of a){const R=x.codePointAt(0);if(R===void 0)break;if(u[R]=!0,_&&m&&R<=65535){const k=tC[x];k&&(u[k.charCodeAt(0)]=!0)}}}updateFootprints(a,u){}updateReplacement(a,u){if(u.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=u.updateTime;const p=u.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!OP(this.activeReplacements,p)&&(this.activeReplacements=p,!0)}populate(a,u,p,_){const m=this.layers[0],x=m.layout,R=this.projection.name==="globe",k=x.get("text-font"),V=x.get("text-field"),b=x.get("icon-image"),O=(V.value.kind!=="constant"||V.value.value instanceof ca&&!V.value.value.isEmpty()||V.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),U=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,D=x.get("symbol-sort-key");if(this.features=[],!O&&!U)return;const B=u.iconDependencies,W=u.glyphDependencies,K=u.availableImages,J=new gs(this.zoom);for(const{feature:se,id:oe,index:te,sourceLayerIndex:de}of a){const ge=m._featureFilter.needGeometry,Te=on(se,ge);if(!m._featureFilter.filter(J,Te,p))continue;if(ge||(Te.geometry=Ct(se,p,_)),R&&se.type!==1&&p.z<=5){const st=Te.geometry,ke=.98078528056,et=(ct,dt)=>{const xt=Ww(ct.x,ct.y,p,1),Rt=Ww(dt.x,dt.y,p,1);return Re.vec3.dot(xt,Rt)<ke};for(let ct=0;ct<st.length;ct++)st[ct]=qt(st[ct],et)}let Ve,Oe;if(O){const st=m.getValueAndResolveTokens("text-field",Te,p,K),ke=ca.factory(st);zee(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||qv()==="unavailable"||this.hasRTLText&&ka.isParsed())&&(Ve=hee(ke,m,Te))}if(U){const st=m.getValueAndResolveTokens("icon-image",Te,p,K);Oe=st instanceof Os?st:Os.fromString(st)}if(!Ve&&!Oe)continue;const Ne=this.sortFeaturesByKey?D.evaluate(Te,{},p):void 0;if(this.features.push({id:oe,text:Ve,icon:Oe,index:te,sourceLayerIndex:de,geometry:Te.geometry,properties:se.properties,type:Nee[se.type],sortKey:Ne}),Oe&&(B[Oe.namePrimary]=!0,Oe.nameSecondary&&(B[Oe.nameSecondary]=!0)),Ve){const st=k.evaluate(Te,{},p).join(","),ke=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(su.vertical)>=0;for(const et of Ve.sections)if(et.image)B[et.image.namePrimary]=!0;else{const ct=Vm(Ve.toString()),dt=et.fontStack||st,xt=W[dt]=W[dt]||{};this.calculateGlyphDependencies(et.text,xt,ke,this.allowVerticalPlacement,ct)}}}x.get("symbol-placement")==="line"&&(this.features=function(se){const oe={},te={},de=[];let ge=0;function Te(st){de.push(se[st]),ge++}function Ve(st,ke,et){const ct=te[st];return delete te[st],te[ke]=ct,de[ct].geometry[0].pop(),de[ct].geometry[0]=de[ct].geometry[0].concat(et[0]),ct}function Oe(st,ke,et){const ct=oe[ke];return delete oe[ke],oe[st]=ct,de[ct].geometry[0].shift(),de[ct].geometry[0]=et[0].concat(de[ct].geometry[0]),ct}function Ne(st,ke,et){const ct=et?ke[0][ke[0].length-1]:ke[0][0];return`${st}:${ct.x}:${ct.y}`}for(let st=0;st<se.length;st++){const ke=se[st],et=ke.geometry,ct=ke.text?ke.text.toString():null;if(!ct){Te(st);continue}const dt=Ne(ct,et),xt=Ne(ct,et,!0);if(dt in te&&xt in oe&&te[dt]!==oe[xt]){const Rt=Oe(dt,xt,et),It=Ve(dt,xt,de[Rt].geometry);delete oe[dt],delete te[xt],te[Ne(ct,de[It].geometry,!0)]=It,de[Rt].geometry=null}else dt in te?Ve(dt,xt,et):xt in oe?Oe(dt,xt,et):(Te(st),oe[dt]=ge-1,te[xt]=ge-1)}return de.filter(st=>st.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,oe)=>se.sortKey-oe.sortKey)}update(a,u,p,_,m){const x=Object.keys(a).length!==0;if(x&&!this.stateDependentLayers.length)return;const R=x?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(a,u,R,p,_,m),this.icon.programConfigurations.updatePaintArrays(a,u,R,p,_,m)}updateZOffset(){const a=(m,x,R)=>{p+=x,p>m.length&&m.resize(p);for(let k=-x;k<0;k++)m.emplace(k+p,R)},u=(m,x,R)=>{_+=x,_>m.length&&m.resize(_);for(let k=-x;k<0;k++)m.emplace(k+_,R)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let p=0,_=0;for(let m=0;m<this.symbolInstances.length;m++){const x=this.symbolInstances.get(m),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:k,numIconVertices:V}=x,b=x.zOffset,O=V>0;if((R>0||k>0)&&(a(this.text.zOffsetVertexArray,R,b),a(this.text.zOffsetVertexArray,k,b)),O){const{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:D}=x;U>=0&&u(this.icon.zOffsetVertexArray,V,b),D>=0&&u(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,b)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=vU(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const p=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:_,y:m}of u)this.lineVertexArray.emplaceBack(_,m);return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,u,p,_,m,x,R,k,V,b,O,U,D,B,W,K){const J=a.indexArray,se=a.layoutVertexArray,oe=a.globeExtVertexArray,te=a.segments.prepareSegment(4*u.length,se,J,this.canOverlap?x.sortKey:void 0),de=this.glyphOffsetArray.length,ge=te.vertexLength,Te=this.allowVerticalPlacement&&R===su.vertical?Math.PI/2:0,Ve=x.text&&x.text.sections;for(let Ne=0;Ne<u.length;Ne++){const{tl:st,tr:ke,bl:et,br:ct,texPrimary:dt,texSecondary:xt,pixelOffsetTL:Rt,pixelOffsetBR:It,minFontScaleX:Et,minFontScaleY:en,glyphOffset:dn,isSDF:Ht,sectionIndex:Vn}=u[Ne],Rn=te.vertexLength,xn=dn[1];if(Gb(se,V.x,V.y,st.x,xn+st.y,dt.x,dt.y,p,Ht,Rt.x,Rt.y,Et,en),Gb(se,V.x,V.y,ke.x,xn+ke.y,dt.x+dt.w,dt.y,p,Ht,It.x,Rt.y,Et,en),Gb(se,V.x,V.y,et.x,xn+et.y,dt.x,dt.y+dt.h,p,Ht,Rt.x,It.y,Et,en),Gb(se,V.x,V.y,ct.x,xn+ct.y,dt.x+dt.w,dt.y+dt.h,p,Ht,It.x,It.y,Et,en),k){const{x:hn,y:si,z:Nn}=k.anchor,[qn,Pi,zi]=k.up;Wb(oe,hn,si,Nn,qn,Pi,zi),Wb(oe,hn,si,Nn,qn,Pi,zi),Wb(oe,hn,si,Nn,qn,Pi,zi),Wb(oe,hn,si,Nn,qn,Pi,zi),jb(a.dynamicLayoutVertexArray,hn,si,Nn,Te)}else jb(a.dynamicLayoutVertexArray,V.x,V.y,V.z,Te);if(K){const hn=xt||dt;Hb(a.iconTransitioningVertexArray,hn.x,hn.y),Hb(a.iconTransitioningVertexArray,hn.x+hn.w,hn.y),Hb(a.iconTransitioningVertexArray,hn.x,hn.y+hn.h),Hb(a.iconTransitioningVertexArray,hn.x+hn.w,hn.y+hn.h)}J.emplaceBack(Rn,Rn+1,Rn+2),J.emplaceBack(Rn+1,Rn+2,Rn+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dn[0]),Ne!==u.length-1&&Vn===u[Ne+1].sectionIndex||a.programConfigurations.populatePaintArrays(se.length,x,x.index,{},D,B,W,Ve&&Ve[Vn])}const Oe=k?k.anchor:V;a.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,V.x,V.y,de,this.glyphOffsetArray.length-de,ge,b,O,V.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],R,0,!1,0,U,0)}_commitLayoutVertex(a,u,p,_,m,x,R){a.emplaceBack(u,p,_,m,x,Math.round(R.x),Math.round(R.y))}_addCollisionDebugVertices(a,u,p,_,m,x,R){const k=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),V=k.vertexLength,b=R.tileAnchorX,O=R.tileAnchorY;for(let D=0;D<4;D++)p.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(p.collisionVertexArrayExt,u,a.padding,R.zOffset),this._commitLayoutVertex(p.layoutVertexArray,_,m,x,b,O,new _e(a.x1,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,_,m,x,b,O,new _e(a.x2,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,_,m,x,b,O,new _e(a.x2,a.y2)),this._commitLayoutVertex(p.layoutVertexArray,_,m,x,b,O,new _e(a.x1,a.y2)),k.vertexLength+=4;const U=p.indexArray;U.emplaceBack(V,V+1),U.emplaceBack(V+1,V+2),U.emplaceBack(V+2,V+3),U.emplaceBack(V+3,V),k.primitiveLength+=4}_addTextDebugCollisionBoxes(a,u,p,_,m,x){for(let R=_;R<m;R++){const k=p.get(R),V=this.getSymbolInstanceTextSize(a,x,u,R);this._addCollisionDebugVertices(k,V,this.textCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(a,u,p,_,m,x){for(let R=_;R<m;R++){const k=p.get(R),V=this.getSymbolInstanceIconSize(a,u,x.placedIconSymbolIndex);this._addCollisionDebugVertices(k,V,this.iconCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,x)}}generateCollisionDebugBuffers(a,u,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new eI(cp,z4.members,xa),this.iconCollisionBox=new eI(cp,z4.members,xa);const _=h0(this.iconSizeData,a),m=h0(this.textSizeData,a,p);for(let x=0;x<this.symbolInstances.length;x++){const R=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(m,a,u,R.textBoxStartIndex,R.textBoxEndIndex,R),this._addTextDebugCollisionBoxes(m,a,u,R.verticalTextBoxStartIndex,R.verticalTextBoxEndIndex,R),this._addIconDebugCollisionBoxes(_,a,u,R.iconBoxStartIndex,R.iconBoxEndIndex,R),this._addIconDebugCollisionBoxes(_,a,u,R.verticalIconBoxStartIndex,R.verticalIconBoxEndIndex,R)}}getSymbolInstanceTextSize(a,u,p,_){const m=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:_),x=Fb(this.textSizeData,a,m)/wa;return this.tilePixelRatio*x}getSymbolInstanceIconSize(a,u,p){const _=this.icon.placedSymbolArray.get(p),m=Fb(this.iconSizeData,a,_);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(a,u,p,_){a.emplaceBack(u,-p,-p,_),a.emplaceBack(u,p,-p,_),a.emplaceBack(u,p,p,_),a.emplaceBack(u,-p,p,_)}_updateTextDebugCollisionBoxes(a,u,p,_,m,x,R){for(let k=_;k<m;k++){const V=p.get(k),b=this.getSymbolInstanceTextSize(a,x,u,k);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,V.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(a,u,p,_,m,x,R){for(let k=_;k<m;k++){const V=p.get(k),b=this.getSymbolInstanceIconSize(a,u,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,V.padding,x.zOffset)}}updateCollisionDebugBuffers(a,u,p,_){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=h0(this.iconSizeData,a,_),x=h0(this.textSizeData,a,p);for(let R=0;R<this.symbolInstances.length;R++){const k=this.symbolInstances.get(R);this._updateTextDebugCollisionBoxes(x,a,u,k.textBoxStartIndex,k.textBoxEndIndex,k,p),this._updateTextDebugCollisionBoxes(x,a,u,k.verticalTextBoxStartIndex,k.verticalTextBoxEndIndex,k,p),this._updateIconDebugCollisionBoxes(m,a,u,k.iconBoxStartIndex,k.iconBoxEndIndex,k,_),this._updateIconDebugCollisionBoxes(m,a,u,k.verticalIconBoxStartIndex,k.verticalIconBoxEndIndex,k,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,u,p,_,m,x,R,k,V){const b={};if(u<p){const{x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te,featureIndex:de}=a.get(u);b.textBox={x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te},b.textFeatureIndex=de}if(_<m){const{x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te,featureIndex:de}=a.get(_);b.verticalTextBox={x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te},b.verticalTextFeatureIndex=de}if(x<R){const{x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te,featureIndex:de}=a.get(x);b.iconBox={x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te},b.iconFeatureIndex=de}if(k<V){const{x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te,featureIndex:de}=a.get(k);b.verticalIconBox={x1:O,y1:U,x2:D,y2:B,padding:W,projectedAnchorX:K,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:oe,tileAnchorY:te},b.verticalIconFeatureIndex=de}return b}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,u){const p=a.placedSymbolArray.get(u),_=p.vertexStartIndex+4*p.numGlyphs;for(let m=p.vertexStartIndex;m<_;m+=4)a.indexArray.emplaceBack(m,m+1,m+2),a.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),p=Math.cos(a),_=[],m=[],x=[];for(let R=0;R<this.symbolInstances.length;++R){x.push(R);const k=this.symbolInstances.get(R);_.push(0|Math.round(u*k.tileAnchorX+p*k.tileAnchorY)),m.push(k.featureIndex)}return x.sort((R,k)=>_[R]-_[k]||m[k]-m[R]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,u)=>this.symbolInstances.get(u).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:R,placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:V}=p;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),m>=0&&m!==_&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&x!==m&&x!==_&&this.addIndicesForPlacedSymbol(this.text,x),R>=0&&this.addIndicesForPlacedSymbol(this.text,R),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k),V>=0&&this.addIndicesForPlacedSymbol(this.icon,V)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yU,_U,tI;Un($b,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),$b.addDynamicAttributes=jb;class xU{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:bs,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Un(xU,"FormatSectionOverride",{omit:["defaultValue"]});const nI=()=>tI||(tI={layout:yU||(yU=new Ur({"symbol-placement":new yn(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new yn(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yn(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ni(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yn(Tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new yn(Tt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new yn(Tt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new yn(Tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yn(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new yn(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yn(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ni(Tt.layout_symbol["icon-size"]),"icon-size-scale-range":new yn(Tt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ni(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ni(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ni(Tt.layout_symbol["icon-image"]),"icon-rotate":new ni(Tt.layout_symbol["icon-rotate"]),"icon-padding":new yn(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new yn(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new ni(Tt.layout_symbol["icon-offset"]),"icon-anchor":new ni(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yn(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yn(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yn(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new ni(Tt.layout_symbol["text-field"]),"text-font":new ni(Tt.layout_symbol["text-font"]),"text-size":new ni(Tt.layout_symbol["text-size"]),"text-size-scale-range":new yn(Tt.layout_symbol["text-size-scale-range"]),"text-max-width":new ni(Tt.layout_symbol["text-max-width"]),"text-line-height":new ni(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new ni(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new ni(Tt.layout_symbol["text-justify"]),"text-radial-offset":new ni(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yn(Tt.layout_symbol["text-variable-anchor"]),"text-anchor":new ni(Tt.layout_symbol["text-anchor"]),"text-max-angle":new yn(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new yn(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new ni(Tt.layout_symbol["text-rotate"]),"text-padding":new yn(Tt.layout_symbol["text-padding"]),"text-keep-upright":new yn(Tt.layout_symbol["text-keep-upright"]),"text-transform":new ni(Tt.layout_symbol["text-transform"]),"text-offset":new ni(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new yn(Tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yn(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new yn(Tt.layout_symbol["text-optional"]),visibility:new yn(Tt.layout_symbol.visibility)})),paint:_U||(_U=new Ur({"icon-opacity":new ni(Tt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ni(Tt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ni(Tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ni(Tt.paint_symbol["text-emissive-strength"]),"icon-color":new ni(Tt.paint_symbol["icon-color"]),"icon-halo-color":new ni(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ni(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ni(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new yn(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new yn(Tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ni(Tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ni(Tt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ni(Tt.paint_symbol["text-occlusion-opacity"]),"text-color":new ni(Tt.paint_symbol["text-color"],{runtimeType:Ia,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new ni(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new ni(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new ni(Tt.paint_symbol["text-halo-blur"]),"text-translate":new yn(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new yn(Tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new yn(Tt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new yn(Tt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new yn(Tt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new yn(Tt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ni(Tt.paint_symbol["symbol-z-offset"])}))},tI);class qb extends Ho{constructor(a,u,p,_){super(a,nI(),u,p,_),this._colorAdjustmentMatrix=Re.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}recalculate(a,u){super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const m of p)_.indexOf(m)<0&&_.push(m);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,u,p,_){return this._saturation===a&&this._contrast===u&&this._brightnessMin===p&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(m,x,R,k){m=Ie(m),x=we(x);const V=Re.mat4.create(),b=m/3,O=1-2*b,U=[O,b,b,0,b,O,b,0,b,b,O,0,0,0,0,1],D=.5-.5*x,B=k-R;return Re.mat4.multiply(V,[B,0,0,0,0,B,0,0,0,0,B,0,R,R,R,1],[x,0,0,0,0,x,0,0,0,0,x,0,D,D,D,1]),Re.mat4.multiply(V,V,U),V}(a,u,p,_),this._saturation=a,this._contrast=u,this._brightnessMin=p,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,u,p,_){const m=this.layout.get(a).evaluate(u,{},p,_),x=this._unevaluatedLayout._values[a];return x.isDataDriven()||Eh(x.value)||!m?m:function(R,k){return k.replace(/{([^{}]+)}/g,(V,b)=>b in R?String(R[b]):"")}(u.properties,m)}createBucket(a){return new $b(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of nI().paint.overridableProperties){if(!qb.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),p=new xU(u),_=new Od(p,u.property.specification,this.scope,this.options);let m=null;m=u.value.kind==="constant"||u.value.kind==="source"?new kd("source",_):new Nd("composite",_,u.value.zoomStops,u.value._interpolationType),this.paint._values[a]=new xc(u.property,m,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&qb.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const p=a.get("text-field"),_=nI().paint.properties[u];let m=!1;const x=R=>{for(const k of R)if(_.overrides&&_.overrides.hasOverride(k))return void(m=!0)};if(p.value.kind==="constant"&&p.value.value instanceof ca)x(p.value.value.sections);else if(p.value.kind==="source"){const R=V=>{m||(V instanceof ja&&Ms(V.value)===Cd?x(V.value.sections):V instanceof Al?x(V.sections):V.eachChild(R))},k=p.value;k._styleExpression&&R(k._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,u,p){return{config:new gn(this,{zoom:u,lut:p}),overrideFog:!1}}}let wU,CU,SU,bU;var iI=Qi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function rI(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function sI(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class oI{constructor(a,u,p,_){this.context=a,this.format=p,this.useMipmap=_&&_.useMipmap,this.texture=a.gl.createTexture(),this.update(u,{premultiply:_&&_.premultiply})}update(a,u){const p=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,_=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:m}=this,{gl:x}=m,{x:R,y:k}=u&&u.position?u.position:{x:0,y:0},V=Math.max(R+p,this.size?this.size[0]:0),b=Math.max(k+_,this.size?this.size[1]:0);!this.size||this.size[0]===V&&this.size[1]===b||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!u||u.premultiply!==!1));const O=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&V>0&&b>0){const U=this.useMipmap?Math.floor(Math.log2(Math.max(V,b)))+1:1;x.texStorage2D(x.TEXTURE_2D,U,this.format,V,b),this.size=[V,b]}if(this.size)if(O)x.texSubImage2D(x.TEXTURE_2D,0,R,k,rI(this.format),sI(this.format),a);else{const U=a.data;U&&x.texSubImage2D(x.TEXTURE_2D,0,R,k,p,_,rI(this.format),sI(this.format),U)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(a,u,p=!1){const{context:_}=this,{gl:m}=_;m.bindTexture(m.TEXTURE_2D,this.texture),a!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!p?a===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),u!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrapS=u)}bindExtraParam(a,u,p,_){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),u!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,u),this.magFilter=u),a!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?a===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),p!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,p),this.wrapS=p),_!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,_),this.wrapT=_)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class Zb{constructor(a,u){this.context=a,this.texture=u}bind(a,u){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),a!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,a),this.minFilter=a),u!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrapS=u)}}function Xb(d,a,u,p,_,m,x,R){const k=[d,a,1,u,p,1,_,m,1],V=[x,R,1],b=Re.mat3.adjoint([],k),[O,U,D]=Re.vec3.transformMat3(V,V,b);return Re.mat3.multiply(k,k,[O,0,0,0,U,0,0,0,D])}function EU(d,a,u,p,_,m,x,R){const k=function(V,b,O,U,D,B,W,K){const J=Xb(0,0,1,0,1,1,0,1),se=Xb(V,b,O,U,D,B,W,K),oe=Re.mat3.adjoint([],J);return Re.mat3.multiply(se,se,oe)}(d,a,u,p,_,m,x,R);return[k[2]/k[8]/Mn,k[5]/k[8]/Mn]}function Kb(d){return[d[0],Math.min(Math.max(d[1],-Ze),Ze)]}class MU extends xd{constructor(a,u,p,_){super(),this.id=a,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=u,this._dirty=!1}load(a,u){if(this._loaded=u||!1,this.fire(new Ml("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Yo(this.map._requestManager.transformRequest(this.url,ji.Image),(p,_)=>{this._imageRequest=null,this._loaded=!0,p?this.fire(new Wc(p)):_&&(this.image=_ instanceof HTMLImageElement?In.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Zb(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ml("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Zb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let u=a[0][1],p=a[0][1];for(const m of a)m[1]>p&&(p=m[1]),m[1]<u&&(u=m[1]);const _=(p+u)/2;if(_>Ze?this.onNorthPole=!0:_<-Ze&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=a.map(mt.fromLngLat);this.tileID=function(x){let R=1/0,k=1/0,V=-1/0,b=-1/0;for(const W of x)R=Math.min(R,W.x),k=Math.min(k,W.y),V=Math.max(V,W.x),b=Math.max(b,W.y);const O=Math.max(V-R,b-k),U=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),D=Math.pow(2,U);let B=Math.floor((R+V)/2*D);return B>1&&(B-=1),new To(U,B,Math.floor((k+b)/2*D))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ml("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const J in this.tiles){const se=this.tiles[J];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const u=oC(new To(0,0,0),this.map.transform.projection),p=[u.projection.project(this.coordinates[0][0],this.coordinates[0][1]),u.projection.project(this.coordinates[1][0],this.coordinates[1][1]),u.projection.project(this.coordinates[2][0],this.coordinates[2][1]),u.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(J){const se=J[1].x-J[0].x,oe=J[1].y-J[0].y,te=J[2].x-J[1].x,de=J[2].y-J[1].y,ge=J[3].x-J[2].x,Te=J[3].y-J[2].y,Ve=J[0].x-J[3].x,Oe=J[0].y-J[3].y,Ne=se*de-te*oe,st=te*Te-ge*de,ke=ge*Oe-Ve*Te,et=Ve*oe-se*Oe;return Ne>0&&st>0&&ke>0&&et>0||Ne<0&&st<0&&ke<0&&et<0}(p))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=oC(this.tileID,this.map.transform.projection),[m,x,R,k]=this.coordinates.map(J=>{const se=_.projection.project(J[0],J[1]);return dU(_,se)._round()});this.perspectiveTransform=EU(m.x,m.y,x.x,x.y,R.x,R.y,k.x,k.y);const V=this._boundsArray=new eu;V.emplaceBack(m.x,m.y,0,0),V.emplaceBack(x.x,x.y,Mn,0),V.emplaceBack(k.x,k.y,0,Mn),V.emplaceBack(R.x,R.y,Mn,Mn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(V,iI.members),this.boundsSegments=Is.simpleSegment(0,0,4,2);const b=[],O=[Kb((U=this.coordinates)[0]),Kb(U[1]),Kb(U[2]),Kb(U[3])];var U;const[D,B,W,K]=function(J){let se=J[0][0],oe=se,te=J[0][1],de=te;for(let ge=1;ge<J.length;ge++)J[ge][0]<se?se=J[ge][0]:J[ge][0]>oe&&(oe=J[ge][0]),J[ge][1]<te?te=J[ge][1]:J[ge][1]>de&&(de=J[ge][1]);return[se,te,oe-se,de-te]}(O);{const J=new eu,[se,oe,te,de]=function(Rt){let It=Rt[0].x,Et=It,en=Rt[0].y,dn=en;for(let Ht=1;Ht<Rt.length;Ht++)Rt[Ht].x<It?It=Rt[Ht].x:Rt[Ht].x>Et&&(Et=Rt[Ht].x),Rt[Ht].y<en?en=Rt[Ht].y:Rt[Ht].y>dn&&(dn=Rt[Ht].y);return[It,en,Et-It,dn-en]}(p),ge=Rt=>[(Rt.x-se)/te,(Rt.y-oe)/de],[Te,Ve,Oe,Ne]=p.map(ge),st=function(Rt,It,Et,en,dn,Ht,Vn,Rn){const xn=Xb(0,0,1,0,1,1,0,1),hn=Xb(Rt,It,Et,en,dn,Ht,Vn,Rn),si=Re.mat3.adjoint([],hn);return Re.mat3.multiply(xn,xn,si)}(Te[0],Te[1],Ve[0],Ve[1],Oe[0],Oe[1],Ne[0],Ne[1]);this.elevatedGlobePerspectiveTransform=EU(Te[0],Te[1],Ve[0],Ve[1],Oe[0],Oe[1],Ne[0],Ne[1]);const ke=(Rt,It)=>{b.push(Rt.lng);const Et=Math.round((Rt.lng-D)/W*Mn),en=Math.round((Rt.lat-B)/K*Mn),dn=ge(It),Ht=Re.vec3.transformMat3([],[dn[0],dn[1],1],st),Vn=Math.round(Ht[0]/Ht[2]*Mn),Rn=Math.round(Ht[1]/Ht[2]*Mn);J.emplaceBack(Et,en,Vn,Rn)},et=p[3].x-p[0].x,ct=p[3].y-p[0].y,dt=p[2].x-p[1].x,xt=p[2].y-p[1].y;for(let Rt=0;Rt<65;Rt++){const It=Rt/64,Et=[p[0].x+It*et,p[0].y+It*ct],en=[p[1].x+It*dt,p[1].y+It*xt],dn=en[0]-Et[0],Ht=en[1]-Et[1];for(let Vn=0;Vn<65;Vn++){const Rn=Vn/64,xn={x:Et[0]+dn*Rn,y:Et[1]+Ht*Rn,z:0};ke(u.projection.unproject(xn.x,xn.y),xn)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(J,iI.members)}{this.maxLongitudeTriangleSize=0;let J=[],se=new ss;const oe=(te,de,ge)=>{se.emplaceBack(te,de,ge);const Te=b[te],Ve=b[de],Oe=b[ge],Ne=Math.min(Math.min(Te,Ve),Oe),st=Math.max(Math.max(Te,Ve),Oe)-Ne;st>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=st),J.push(Ne+st/2)};for(let te=0;te<64;te++)for(let de=0;de<64;de++){const ge=65*te+de,Te=ge+1,Ve=ge+65,Oe=Ve+1;oe(ge,Ve,Te),oe(Te,Ve,Oe)}[J,se]=function(te,de){const ge=Array.from({length:te.length},(Oe,Ne)=>Ne);ge.sort((Oe,Ne)=>te[Oe]-te[Ne]);const Te=[],Ve=new ss;for(let Oe=0;Oe<ge.length;Oe++){const Ne=ge[Oe];Te.push(te[Ne]);const st=3*Ne,ke=st+1;Ve.emplaceBack(de.uint16[st],de.uint16[ke],de.uint16[ke+1])}return[Te,Ve]}(J,se),this.elevatedGlobeTrianglesCenterLongitudes=J,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(se)}this.elevatedGlobeSegments=Is.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Mn,0,K/Mn,0,0,B,D,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const u=this.map.painter.context,p=u.gl;!this._dirty||this.texture instanceof Zb||(this.texture?this.texture.update(this.image):(this.texture=new oI(u,this.image,p.RGBA8),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(u)}loadTile(a,u){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},u(null)):(a.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const u=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!u)return null;const p=this.elevatedGlobeTrianglesCenterLongitudes;let _=(m=a+180)+360*Math.round((p[0]-m)/360);var m;const x=new Is,R=(O,U)=>{x.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:u.segments[0].vertexLength,primitiveLength:U,sortKey:void 0,vaos:{}})},k=.51*this.maxLongitudeTriangleSize;if(Math.abs(p[0]-_)<=k){const O=Ft(p,0,p.length,_+k);return O===p.length||R(O,cs(p,O+1,p.length,_+360-k)-O),x}_<p[0]&&(_+=360);const V=cs(p,0,p.length,_-k);if(V===p.length)return R(0,p.length),x;R(0,V-0);const b=Ft(p,V+1,p.length,_+k);return b!==p.length&&R(b,p.length-b),x}}const Uee=(Math.pow(256,2)-1)/16907520;class RU extends Ho{constructor(a,u,p,_){super(a,{layout:SU||(SU=new Ur({visibility:new yn(Tt.layout_raster.visibility)})),paint:bU||(bU=new Ur({"raster-opacity":new yn(Tt.paint_raster["raster-opacity"]),"raster-color":new Ph(Tt.paint_raster["raster-color"]),"raster-color-mix":new yn(Tt.paint_raster["raster-color-mix"]),"raster-color-range":new yn(Tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new yn(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yn(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yn(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new yn(Tt.paint_raster["raster-saturation"]),"raster-contrast":new yn(Tt.paint_raster["raster-contrast"]),"raster-resampling":new yn(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new yn(Tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new yn(Tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new yn(Tt.paint_raster["raster-array-band"]),"raster-elevation":new yn(Tt.paint_raster["raster-elevation"])}))},u,p,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof MU&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const u=this._transitionablePaint._values["raster-color"].value.expression,[p,_]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(p)&&isNaN(_)||p===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=jw({expression:u,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:p,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[p,_])}}let TU,AU,PU,IU,DU;class FU extends Ho{constructor(a,u,p,_){super(a,{layout:TU||(TU=new Ur({visibility:new yn(Tt["layout_raster-particle"].visibility)})),paint:AU||(AU=new Ur({"raster-particle-array-band":new yn(Tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new yn(Tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ph(Tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new yn(Tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new yn(Tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new yn(Tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new yn(Tt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new yn(Tt["paint_raster-particle"]["raster-particle-elevation"])}))},u,p,_),this._updateColorRamp(),this.lastInvalidatedAt=In.now()}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,u=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=jw({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:u}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=In.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Vee extends Ho{constructor(a,u){super(a,{},u,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function aI(d,a,u){const p=[0,0,1],_=Re.quat.identity([]);return Re.quat.rotateY(_,_,u?-xe(d)+Math.PI:xe(d)),Re.quat.rotateX(_,_,-xe(a)),Re.vec3.transformQuat(p,p,_),Re.vec3.normalize(p,p)}function LU(d,a){const u=Yb(d.projection,d.zoom,d.width,d.height),p=function(m,x,R,k,V){const b=new X(R.lng-180*ag,R.lat),O=new X(R.lng+180*ag,R.lat),U=m.project(b.lng,b.lat),D=m.project(O.lng,O.lat),B=-Math.atan2(D.y-U.y,D.x-U.x),W=mt.fromLngLat(R);W.y=yt(W.y,-1+ag,1-ag);const K=W.toLngLat(),J=m.project(K.lng,K.lat),se=mt.fromLngLat(K);se.x+=ag;const oe=se.toLngLat(),te=m.project(oe.lng,oe.lat),de=kU(te.x-J.x,te.y-J.y,B),ge=mt.fromLngLat(K);ge.y+=ag;const Te=ge.toLngLat(),Ve=m.project(Te.lng,Te.lat),Oe=kU(Ve.x-J.x,Ve.y-J.y,B),Ne=Math.abs(de.x)/Math.abs(Oe.y),st=Re.mat4.identity([]);Re.mat4.rotateZ(st,st,-B*(1-(V?0:k)));const ke=Re.mat4.identity([]);return Re.mat4.scale(ke,ke,[1,1-(1-Ne)*k,1]),ke[4]=-Oe.x/Oe.y*k,Re.mat4.rotateZ(ke,ke,B),Re.mat4.multiply(ke,st,ke),ke}(d.projection,0,d.center,u,a),_=OU(d);return Re.mat4.scale(p,p,[_,_,1]),p}function OU(d){const a=d.projection,u=Yb(d.projection,d.zoom,d.width,d.height),p=lI(a,d.center),_=lI(a,X.convert(a.center));return Math.pow(2,p*u+(1-u)*_)}function Yb(d,a,u,p,_=1/0){const m=d.range;if(!m)return 0;const x=Math.min(_,Math.max(u,p)),R=Math.log(x/1024)/Math.LN2;return nn(m[0]+R,m[1]+R,a)}const ag=1/4e4;function lI(d,a){const u=yt(a.lat,-Ze,Ze),p=new X(a.lng-180*ag,u),_=new X(a.lng+180*ag,u),m=d.project(p.lng,u),x=d.project(_.lng,u),R=mt.fromLngLat(p),k=mt.fromLngLat(_),V=x.x-m.x,b=x.y-m.y,O=k.x-R.x,U=k.y-R.y,D=Math.sqrt((O*O+U*U)/(V*V+b*b));return Math.log(D)/Math.LN2}function kU(d,a,u){const p=Math.cos(u),_=Math.sin(u);return{x:d*p-a*_,y:d*_+a*p}}function NU(d,a,u){Re.mat4.identity(d),Re.mat4.rotateZ(d,d,xe(a[2])),Re.mat4.rotateX(d,d,xe(a[0])),Re.mat4.rotateY(d,d,xe(a[1])),Re.mat4.scale(d,d,u),Re.mat4.multiply(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Jb(d,a,u,p,_,m,x,R){const k=[u[0]-a[0],u[1]-a[1],0],V=[p[0]-a[0],p[1]-a[1],0];if(Re.vec3.length(k)<1e-12||Re.vec3.length(V)<1e-12)return Re.quat.identity(d);const b=Re.vec3.cross([],k,V);Re.vec3.normalize(b,b),Re.vec3.subtract(V,p,a),k[2]=(m-_)*R,V[2]=(x-_)*R;const O=k;return Re.vec3.cross(O,k,V),Re.vec3.normalize(O,O),Re.quat.rotationTo(d,b,O)}function cI(d,a,u=!1){const p=tg(a.zoom),_=function(m,x,R){const k=x.worldSize,V=[m[12],m[13],m[14]],b=ze(V[1]/k),O=Fe(V[0]/k),U=Re.mat4.identity([]),D=Ce(1,b)*k,B=Ce(1,0)*k*Xe(b,x.zoom),W=1/CP(k);let K=B*W;if(R){const te=Yb(x.projection,x.zoom,x.width,x.height,1024);K=W*x.projection.pixelSpaceConversion(x.center.lat,k,te)}const J=G(b,O);Re.vec3.add(J,J,Re.vec3.scale([],Re.vec3.normalize([],J),D*K*V[2]));const se=function(te){const de=[te[0],te[1],te[2]];let ge=[0,1,0];const Te=Re.vec3.cross([],ge,de);return Re.vec3.cross(ge,de,Te),Re.vec3.squaredLength(ge)===0&&(ge=[0,1,0],Re.vec3.cross(Te,de,ge)),Re.vec3.normalize(Te,Te),Re.vec3.normalize(ge,ge),Re.vec3.normalize(de,de),[Te[0],Te[1],Te[2],0,ge[0],ge[1],ge[2],0,de[0],de[1],de[2],0,te[0],te[1],te[2],1]}(J);Re.mat4.scale(U,U,[K,K,K*D]),Re.mat4.translate(U,U,[-V[0],-V[1],-V[2]]);const oe=Re.mat4.multiply([],x.globeMatrix,se);return Re.mat4.multiply(oe,oe,U),Re.mat4.multiply(oe,oe,m),oe}(d,a,u);if(p>0){const m=function(x,R){const k=R.worldSize,V=Ce(1,0)*k*Xe(R.center.lat,R.zoom)/CP(k),b=Ce(1,R.center.lat)*k,O=Re.mat4.identity([]);return Re.mat4.rotateY(O,O,xe(R.center.lng)),Re.mat4.rotateX(O,O,xe(R.center.lat)),Re.mat4.translate(O,O,[0,0,rr]),Re.mat4.scale(O,O,[V,V,V*b]),Re.mat4.translate(O,O,[R.point.x-.5*k,R.point.y-.5*k,0]),Re.mat4.multiply(O,O,x),Re.mat4.multiply(O,R.globeMatrix,O)}(d,a);return function(x,R,k){const V=(B,W,K)=>{const J=Re.vec3.length(B),se=Re.vec3.length(W),oe=gp(B,W,K);return Re.vec3.scale(oe,oe,1/Re.vec3.length(oe)*Hn(J,se,K))},b=V([x[0],x[1],x[2]],[R[0],R[1],R[2]],k),O=V([x[4],x[5],x[6]],[R[4],R[5],R[6]],k),U=V([x[8],x[9],x[10]],[R[8],R[9],R[10]],k),D=gp([x[12],x[13],x[14]],[R[12],R[13],R[14]],k);return[b[0],b[1],b[2],0,O[0],O[1],O[2],0,U[0],U[1],U[2],0,D[0],D[1],D[2],1]}(_,m,p)}return _}function BU(d,a,u,p){const _=Ir.projectAabbCorners(p,u);let m=Number.MAX_VALUE,x=-1;for(let V=0;V<_.length;++V){const b=_[V];b[0]=(.5*b[0]+.5)*a.width,b[1]=(.5-.5*b[1])*a.height,b[2]<m&&(x=V,m=b[2])}const R=V=>new _e(_[V][0],_[V][1]);let k;switch(x){case 0:case 6:k=[R(1),R(5),R(4),R(7),R(3),R(2),R(1)];break;case 1:case 7:k=[R(0),R(4),R(5),R(6),R(2),R(3),R(0)];break;case 3:case 5:k=[R(1),R(0),R(4),R(7),R(6),R(2),R(1)];break;default:k=[R(1),R(5),R(6),R(7),R(3),R(0),R(1)]}if(sn(d,k))return m}const Gee=Qi([{name:"a_pos_3f",components:3,type:"Float32"}]),Hee=Qi([{name:"a_color_3f",components:3,type:"Float32"}]),Wee=Qi([{name:"a_color_4f",components:4,type:"Float32"}]),jee=Qi([{name:"a_uv_2f",components:2,type:"Float32"}]),$ee=Qi([{name:"a_normal_3f",components:3,type:"Float32"}]),qee=Qi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Zee=Qi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),zU={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Qb{constructor(a,u,p,_){this.message=(a?`${a}: `:"")+p,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}}function UU(d,a){const u=d.indexOf("://")===-1;try{return new URL(d,u&&a?"http://example.com":void 0),!0}catch{return!1}}class VU{constructor(a,u){this.feature=a,this.instancedDataOffset=u,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class GU{constructor(){this.instancedDataArray=new Jd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class uI{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.fqid),this.projection=a.projection,this.index=a.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(a,u){}populate(a,u,p,_){this.tileToMeter=ot(p);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:R,index:k,sourceLayerIndex:V}of a){const b=R??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),O=on(x,m);if(!this.layers[0]._featureFilter.filter(new gs(this.zoom),O,p))continue;const U={id:b,sourceLayerIndex:V,index:k,geometry:m?O.geometry:Ct(x,p,_),properties:x.properties,type:x.type,patterns:{}},D=this.addFeature(U,U.geometry,O);D&&u.featureIndex.insert(x,U.geometry,k,V,this.index,this.instancesPerModel[D].instancedDataArray.length,Mn/32)}this.lookup=null}update(a,u,p,_){for(const m in this.instancesPerModel){const x=this.instancesPerModel[m];for(const R in a)x.idToFeaturesIndex.hasOwnProperty(R)&&(this.evaluate(x.features[x.idToFeaturesIndex[R]],a[R],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];for(const _ of p.features){const m=this.layers[0],x=_.feature,R=this.canonical,k=m.paint.get("model-rotation").evaluate(x,{},R),V=m.paint.get("model-scale").evaluate(x,{},R),b=m.paint.get("model-translation").evaluate(x,{},R);Re.vec3.exactEquals(_.rotation,k)&&Re.vec3.exactEquals(_.scale,V)&&Re.vec3.exactEquals(_.translation,b)||(this.evaluate(_,_.featureStates,p,!0),a=!0)}}return a}updateReplacement(a,u,p,_){if(u.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=u.updateTime;const m=u.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(OP(this.activeReplacements,m))return!1;this.activeReplacements=m;let x=!1;for(const R in this.instancesPerModel){const k=this.instancesPerModel[R],V=k.instancedDataArray;for(const b of k.features){const O=b.instancedDataOffset,U=b.instancedDataCount;for(let D=0;D<U;D++){const B=16*(D+O);let W=V.float32[B+0];const K=W>Mn;W=K?W-Mn:W;const J=Math.floor(W),se=V.float32[B+1];let oe=!1;for(const te of this.activeReplacements)if(!i4(te,p,zU.Model,_)&&!(te.min.x>J||J>te.max.x||te.min.y>se||se>te.max.y)&&(oe=c4(l4(J,se,a.canonical,te.footprintTileId.canonical),te.footprint),oe))break;V.float32[B]=oe?W+Mn:W,x=x||oe!==K}}}return x}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];p.instancedDataArray.length<0||p.instancedDataArray.length===0||(p.instancedDataBuffer?p.instancedDataBuffer.updateData(p.instancedDataArray):p.instancedDataBuffer=a.createVertexBuffer(p.instancedDataArray,qee.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris)for(const u of this.modelUris)a.removeModel(u,"")}addFeature(a,u,p){const _=this.layers[0],m=_.layout.get("model-id").evaluate(p,{},this.canonical);if(!m)return vi(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),m;UU(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new GU);const x=this.instancesPerModel[m],R=x.instancedDataArray,k=new VU(p,R.length);for(const V of u)for(const b of V){if(b.x<0||b.x>=Mn||b.y<0||b.y>=Mn)continue;const O=(this.lookupDim-1)/Mn,U=this.lookupDim*(b.y*O|0)+b.x*O|0;if(this.lookup){if(this.lookup[U]!==0)continue;this.lookup[U]=1}this.instanceCount++;const D=R.length;R.resize(D+1),x.instancesEvaluatedElevation.push(0),R.float32[16*D]=b.x,R.float32[16*D+1]=b.y}return k.instancedDataCount=x.instancedDataArray.length-k.instancedDataOffset,k.instancedDataCount>0&&(a.id&&(x.idToFeaturesIndex[a.id]=x.features.length),x.features.push(k),this.evaluate(k,{},x,!1)),m}getModelUris(){return this.modelUris}evaluate(a,u,p,_){const m=this.layers[0],x=a.feature,R=this.canonical,k=a.rotation=m.paint.get("model-rotation").evaluate(x,u,R),V=a.scale=m.paint.get("model-scale").evaluate(x,u,R),b=a.translation=m.paint.get("model-translation").evaluate(x,u,R),O=m.paint.get("model-color").evaluate(x,u,R);O.a=m.paint.get("model-color-mix-intensity").evaluate(x,u,R);const U=[];this.maxVerticalOffset<b[2]&&(this.maxVerticalOffset=b[2]),this.maxScale=Math.max(Math.max(this.maxScale,V[0]),Math.max(V[1],V[2])),NU(U,k,V);const D=Math.round(100*O.a)+O.b/1.05;for(let B=0;B<a.instancedDataCount;++B){const W=a.instancedDataOffset+B,K=16*W,J=p.instancedDataArray.float32;let se=0;_&&(se=J[K+6]-p.instancesEvaluatedElevation[W]);const oe=0|J[K+1];J[K]=(0|J[K])+O.r/1.05,J[K+1]=oe+O.g/1.05,J[K+2]=D,J[K+3]=1/(R.z>10?this.tileToMeter:ot(R,oe)),J[K+4]=b[0],J[K+5]=b[1],J[K+6]=b[2]+se,J[K+7]=U[0],J[K+8]=U[1],J[K+9]=U[2],J[K+10]=U[4],J[K+11]=U[5],J[K+12]=U[6],J[K+13]=U[8],J[K+14]=U[9],J[K+15]=U[10],p.instancesEvaluatedElevation[W]=b[2]}}}let HU,WU;Un(uI,"ModelBucket",{omit:["layers"]}),Un(GU,"PerModelAttributes"),Un(VU,"ModelFeature");const ry=64,g0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jU(d,a,u,p,_,m,x,R,k,V=!1){const b=u.zoom,O=u.project(p),U=Xe(p.lat,b),D=1/U;Re.mat4.identity(d),Re.mat4.translate(d,d,[O.x+x[0]*D,O.y+x[1]*D,x[2]]);let B=1,W=1;const K=u.worldSize;if(V){if(u.projection.name==="mercator"){let te=0;u.elevation&&(te=u.elevation.getAtPointOrZero(new mt(O.x/K,O.y/K),0));const de=Re.vec4.transformMat4([],[O.x,O.y,te,1],u.projMatrix)[3]/u.cameraToCenterDistance;B=de,W=de*Xe(u.center.lat,b)}else if(u.projection.name==="globe"){const te=cI(d,u),de=Re.mat4.multiply([],u.projMatrix,te),ge=[0,0,0,1];Re.vec4.transformMat4(ge,ge,de);const Te=ge[3]/u.cameraToCenterDistance,Ve=tg(b),Oe=u.projection.pixelsPerMeter(p.lat,K)*Xe(p.lat,b),Ne=u.projection.pixelsPerMeter(u.center.lat,K)*Xe(u.center.lat,b);B=Te/Hn(Oe,Ke(u.center.lat),Ve),W=Te*U/Oe,B*=Ne,W*=Ne}}else B=D;Re.mat4.scale(d,d,[B,B,W]);const J=[...d],se=a.orientation,oe=[];if(NU(oe,[se[0]+_[0],se[1]+_[1],se[2]+_[2]],m),Re.mat4.multiply(d,J,oe),R&&u.elevation){let te=0;const de=[];if(k&&u.elevation){te=function(Ve,Oe,Ne,st,ke){const et=Oe.elevation;if(!et)return 0;const ct=Ir.projectAabbCorners(Ne,st),dt=Ce(1,ke.lat)*Oe.worldSize,xt=function(si,Nn){const qn=[0,0,1],Pi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zi of Pi){const Ui=si[zi.corners[0]],ki=si[zi.corners[1]],Yi=si[zi.corners[2]],Zi=[ki[0]-Ui[0],ki[1]-Ui[1],Nn*(ki[2]-Ui[2])],Kr=Re.vec3.cross(Zi,Zi,[Yi[0]-Ui[0],Yi[1]-Ui[1],Nn*(Yi[2]-Ui[2])]);Re.vec3.normalize(Kr,Kr),zi.dotProductWithUp=Re.vec3.dot(Kr,qn)}return Pi.sort((zi,Ui)=>zi.dotProductWithUp-Ui.dotProductWithUp),Pi[0].corners}(ct,dt),Rt=ct[xt[0]],It=ct[xt[1]],Et=ct[xt[2]],en=ct[xt[3]],dn=et.getAtPointOrZero(new mt(Rt[0]/Oe.worldSize,Rt[1]/Oe.worldSize),0),Ht=et.getAtPointOrZero(new mt(It[0]/Oe.worldSize,It[1]/Oe.worldSize),0),Vn=et.getAtPointOrZero(new mt(Et[0]/Oe.worldSize,Et[1]/Oe.worldSize),0),Rn=et.getAtPointOrZero(new mt(en[0]/Oe.worldSize,en[1]/Oe.worldSize),0),xn=(dn+Rn)/2,hn=(Ht+Vn)/2;return xn>hn?Ht<Vn?Jb(Ve,It,en,Rt,Ht,Rn,dn,dt):Jb(Ve,Et,Rt,en,Vn,dn,Rn,dt):dn<Rn?Jb(Ve,Rt,It,Et,dn,Ht,Vn,dt):Jb(Ve,en,Et,It,Rn,Vn,Ht,dt),Math.max(xn,hn)}(de,u,a.aabb,d,p);const ge=Re.mat4.fromQuat([],de),Te=Re.mat4.multiply([],ge,oe);Re.mat4.multiply(d,J,Te)}else te=u.elevation.getAtPointOrZero(new mt(O.x/K,O.y/K),0);te!==0&&(d[14]+=te)}}function hC(d,a,u=!1){d.uploaded||(d.gfxTexture=new oI(a,d.image,u?a.gl.R8:a.gl.RGBA8,{useMipmap:d.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function Xee(d,a,u){d.indexBuffer=a.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=a.createVertexBuffer(d.vertexArray,Gee.members,!1,!0),d.normalArray&&(d.normalBuffer=a.createVertexBuffer(d.normalArray,$ee.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=a.createVertexBuffer(d.texcoordArray,jee.members,!1,!0)),d.colorArray&&(d.colorBuffer=a.createVertexBuffer(d.colorArray,(d.colorArray.bytesPerElement===12?Hee:Wee).members,!1,!0)),d.featureArray&&(d.pbrBuffer=a.createVertexBuffer(d.featureArray,Zee.members,!0)),d.segments=Is.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const p=d.material;p.pbrMetallicRoughness.baseColorTexture&&hC(p.pbrMetallicRoughness.baseColorTexture,a),p.pbrMetallicRoughness.metallicRoughnessTexture&&hC(p.pbrMetallicRoughness.metallicRoughnessTexture,a),p.normalTexture&&hC(p.normalTexture,a),p.occlusionTexture&&hC(p.occlusionTexture,a,u),p.emissionTexture&&hC(p.emissionTexture,a)}function hI(d,a,u){if(d.meshes)for(const p of d.meshes)Xee(p,a,u);if(d.children)for(const p of d.children)hI(p,a,u)}function eE(d){if(d.meshes)for(const a of d.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(d.children)for(const a of d.children)eE(a)}function dI(d){if(d.meshes)for(const u of d.meshes)u.vertexBuffer&&(u.vertexBuffer.destroy(),u.indexBuffer.destroy(),u.normalBuffer&&u.normalBuffer.destroy(),u.texcoordBuffer&&u.texcoordBuffer.destroy(),u.colorBuffer&&u.colorBuffer.destroy(),u.pbrBuffer&&u.pbrBuffer.destroy(),u.segments.destroy(),u.material&&((a=u.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(d.children)for(const u of d.children)dI(u)}class v0{constructor(a,u,p){this._demTile=a,this._dem=this._demTile.dem,this._scale=u,this._offset=p}static create(a,u,p){const _=p||a.findDEMTileFor(u);if(!_||!_.dem)return;const m=_.dem,x=_.tileID,R=1<<u.canonical.z-x.canonical.z;return new v0(_,m.dim/Mn/R,[(u.canonical.x/R-x.canonical.x)*m.dim,(u.canonical.y/R-x.canonical.y)*m.dim])}tileCoordToPixel(a,u){const p=u*this._scale+this._offset[1],_=Math.floor(a*this._scale+this._offset[0]),m=Math.floor(p);return new _e(_,m)}getElevationAt(a,u,p,_){const m=a*this._scale+this._offset[0],x=u*this._scale+this._offset[1],R=Math.floor(m),k=Math.floor(x),V=this._dem;return _=!!_,p?Hn(Hn(V.get(R,k,_),V.get(R,k+1,_),x-k),Hn(V.get(R+1,k,_),V.get(R+1,k+1,_),x-k),m-R):V.get(R,k,_)}getElevationAtPixel(a,u,p){return this._dem.get(a,u,!!p)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Ce(1,a)*this._dem.stride}}const fI=new Float32Array(262144),sy=new Uint8Array(262144);function $U(d){let a=0;if(d.meshes)for(const u of d.meshes)a=Math.max(a,u.aabb.max[2]);if(d.children)for(const u of d.children)a=Math.max(a,$U(u));return a}function qU(d,a,u){if(d.meshes)for(const p of d.meshes){if(p.aabb.min[0]===1/0)continue;const _=Ir.applyTransform(p.aabb,d.matrix);u.insert(a,_.min[0],_.min[1],_.max[0],_.max[1])}if(d.children)for(const p of d.children)qU(p,a,u)}const ZU=["","wall","door","roof","window","lamp","logo"];class XU{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:$U(a)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const u=new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const p of this.node.meshes)this.node.lightMeshIndex!==a&&(p.transformedAabb=Ir.applyTransformFast(p.aabb,this.node.matrix),u.encapsulate(p.transformedAabb)),a++;this.aabb=u}return this.aabb}}class tE{constructor(a,u,p,_,m,x,R){this.id=p,this.layers=a,this.layerIds=this.layers.map(k=>k.fqid),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.modelTraits|=g0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,_&&(this.modelTraits|=g0.HasMapboxMeshFeatures),m&&(this.modelTraits|=g0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const k of u)this.nodesInfo.push(new XU(k)),qU(k,R.featureIndexArray.length,R.grid),R.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,R.bucketLayerIDs.length-1,0)}updateFootprints(a,u){for(const p of this.getNodesInfo()){const _=p.node;_.footprint&&u.push({footprint:_.footprint,id:a})}}update(a){const u=Object.keys(a).length!==0;if(u&&!this.stateDependentLayers.length)return;const p=u?this.stateDependentLayers:this.layers;for(const _ of p)this.evaluate(_,a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const u=this.getNodesInfo();for(const p of u){const _=p.node;this.uploaded?this.updatePbrBuffer(_):hI(_,a,!0)}for(const p of u)eE(p.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let u=!1;if(!a.meshes)return u;for(const p of a.meshes)p.pbrBuffer&&(p.pbrBuffer.updateData(p.featureArray),u=!0);return u}needsReEvaluation(a,u,p){const _=a.transform.projectionOptions,m=a.style.getBrightness(),x=this.brightness!==m;return!!(!this.uploaded||this.dirty||_.name!==this.projection.name||dC(p.paint.get("model-color").value,x)||dC(p.paint.get("model-color-mix-intensity").value,x)||dC(p.paint.get("model-roughness").value,x)||dC(p.paint.get("model-emissive-strength").value,x)||dC(p.paint.get("model-height-based-emissive-strength-multiplier").value,x))&&(this.projection=_,this.brightness=m,!0)}evaluateScale(a,u){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const p=this.getNodesInfo(),_=this.id.canonical;for(const m of p){const x=m.feature;m.evaluatedScale=u.paint.get("model-scale").evaluate(x,{},_)}}evaluate(a,u){const p=this.getNodesInfo();for(const _ of p){if(!_.node.meshes)continue;const m=_.feature,x=u&&u[m.id],R=_.node.meshes&&_.node.meshes[0].featureData,k=_.evaluatedColor[2],V=_.evaluatedRMEA[2],b=this.id.canonical;if(_.hasTranslucentParts=!1,R){for(let O=0;O<ZU.length;O++){const U=ZU[O];U.length&&(m.properties.part=U);const D=a.paint.get("model-color").evaluate(m,x,b).toRenderColor(null),B=a.paint.get("model-color-mix-intensity").evaluate(m,x,b);_.evaluatedColor[O]=[D.r,D.g,D.b,B],_.evaluatedRMEA[O][0]=a.paint.get("model-roughness").evaluate(m,x,b),_.evaluatedRMEA[O][2]=a.paint.get("model-emissive-strength").evaluate(m,x,b),_.evaluatedRMEA[O][3]=D.a,_.emissionHeightBasedParams[O]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,x,b),!_.hasTranslucentParts&&D.a<1&&(_.hasTranslucentParts=!0)}delete m.properties.part,Yee(_,k!==_.evaluatedColor[2]||V!==_.evaluatedRMEA[2],this.modelTraits)}else _.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(m,x,b);_.evaluatedScale=a.paint.get("model-scale").evaluate(m,x,b),this.updatePbrBuffer(_.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,u,p,_){const m=a.findDEMTileFor(p);if(m&&(m.tileID.canonical!==this.terrainTile||u!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const x=v0.create(a,p,m);if(!x)return;this.modelTraits&g0.HasMapboxMeshFeatures&&this.updateDEM(a,x,p,_);for(const R of this.getNodesInfo()){const k=R.node;if(!k.footprint||!k.footprint.vertices||!k.footprint.vertices.length)continue;const V=k.footprint.vertices;let b=x.getElevationAt(V[0].x,V[0].y,!0,!0);for(let O=1;O<V.length;O++)b=Math.min(b,x.getElevationAt(V[O].x,V[O].y,!0,!0));k.elevation=b}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=u}}updateDEM(a,u,p,_){let m=u._dem._modifiedForSources[_];if(m===void 0&&(u._dem._modifiedForSources[_]=[],m=u._dem._modifiedForSources[_]),m.includes(p.canonical))return;const x=u._dem.dim;m.push(p.canonical);let R=!1;for(const k of this.getNodesInfo()){const V=k.node;if(!V.footprint||!V.footprint.grid)continue;const b=V.footprint.grid,O=u.tileCoordToPixel(b.min.x,b.min.y),U=u.tileCoordToPixel(b.max.x,b.max.y),D=Math.min(Math.min(x-U.y,O.x),Math.min(O.y,x-U.x));if(D<0)continue;const B=yt(D,2,5);let W=Math.max(0,O.x-B),K=Math.max(0,O.y-B),J=Math.min(U.x+B,x-1),se=Math.min(U.y+B,x-1);for(let ge=K;ge<=se;++ge)for(let Te=W;Te<=J;++Te)sy[ge*x+Te]=255;let oe=0,te=0;for(let ge=0;ge<b.cellsY;++ge)for(let Te=0;Te<b.cellsX;++Te){if(!b.cells[ge*b.cellsX+Te])continue;const Ve=u.tileCoordToPixel(b.min.x+Te/b.xScale,b.min.y+ge/b.yScale),Oe=u.tileCoordToPixel(b.min.x+(Te+1)/b.xScale,b.min.y+(ge+1)/b.yScale);for(let Ne=Ve.y;Ne<=Math.min(Oe.y+1,x-1);++Ne)for(let st=Ve.x;st<=Math.min(Oe.x+1,x-1);++st)sy[Ne*x+st]===255&&(sy[Ne*x+st]=0,oe+=u.getElevationAtPixel(st,Ne),te++)}const de=oe/te;W=Math.max(1,O.x-B),K=Math.max(1,O.y-B),J=Math.min(U.x+B,x-2),se=Math.min(U.y+B,x-2),R=!0;for(let ge=K;ge<=se;++ge)for(let Te=W;Te<=J;++Te)sy[ge*x+Te]===0&&(fI[ge*x+Te]=u._dem.set(Te,ge,de));for(let ge=1;ge<B;++ge){W=Math.max(1,O.x-ge),K=Math.max(1,O.y-ge),J=Math.min(U.x+ge,x-2),se=Math.min(U.y+ge,x-2);for(let Te=K;Te<=se;++Te)for(let Ve=W;Ve<=J;++Ve){const Oe=Te*x+Ve;if(sy[Oe]===255){let Ne=0,st=0,ke=-1,et=-1;for(let ct=-1;ct<=1;++ct)for(let dt=-1;dt<=1;++dt){const xt=(Te+ct)*x+Ve+dt;if(sy[xt]>=ge)continue;const Rt=fI[xt],It=Math.abs(Rt);It>st&&(Ne=Rt,st=It,ke=dt,et=ct)}if(st>.1){const ct=1-(ge+.5*Math.abs(ke*et))/B;let dt=u._dem.get(Ve,Te)+Ne*ct;const xt=u._dem.get(Ve+ke,Te+et),Rt=u._dem.get(Ve-ke,Te-et,!0);(dt-xt)*(dt-Rt)>0&&(dt=(xt+Rt)/2),fI[Oe]=u._dem.set(Ve,Te,dt),sy[Oe]=ge}}}}}R&&(u._demTile.needsDEMTextureUpload=!0,u._dem._timestamp=In.now())}getNodesInfo(){return this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const u of a)eE(u.node),dI(u.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,u){if(u.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=u.updateTime;const p=u.getReplacementRegionsForTile(a.toUnwrapped()),_=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){const x=_[m].node;_[m].hiddenByReplacement=!!x.footprint&&!p.find(R=>R.footprint===x.footprint)}}getHeightAtTileCoord(a,u){const p=this.getNodesInfo(),_=[],m=[0,0,0],x=Re.mat4.identity([]);for(let R=0;R<this.nodesInfo.length;R++){const k=p[R],V=k.node.meshes[0],b=V.transformedAabb;if(a<b.min[0]||u<b.min[1]||a>b.max[0]||u>b.max[1])continue;if(k.node.hidden===!0)return{height:1/0,maxHeight:k.feature.properties.height,hidden:!1,verticalScale:k.evaluatedScale[2]};Re.mat4.invert(x,k.node.matrix),m[0]=a,m[1]=u,Re.vec3.transformMat4(m,m,x);const O=(m[0]-V.aabb.min[0])/(V.aabb.max[0]-V.aabb.min[0])*ry|0,U=Math.min(63,(m[1]-V.aabb.min[1])/(V.aabb.max[1]-V.aabb.min[1])*ry|0)*ry+Math.min(63,O),D=V.heightmap[U];if(!(D<0&&k.node.footprint))return k.hiddenByReplacement?void 0:{height:D,maxHeight:k.feature.properties.height,hidden:!1,verticalScale:k.evaluatedScale[2]};if(k.node.footprint.grid.query(new _e(a,u),new _e(a,u),_),_.length>0)return{height:void 0,maxHeight:k.feature.properties.height,hidden:k.hiddenByReplacement,verticalScale:k.evaluatedScale[2]}}}}function dC(d,a){return!d.isLightConstant&&a}function Kee(d,a,u,p,_,m,x,R){let k=(61440&a|(61440&a)>>4)>>8,V=(3840&a|(3840&a)>>4)>>4,b=240&a|(240&a)>>4;u[3]>0&&(k=Hn(k,255*u[0],u[3]),V=Hn(V,255*u[1],u[3]),b=Hn(b,255*u[2],u[3]));const O=k<<8|V,U=b<<8|Math.floor(255*p[3]),D=function(ge){const Te=yt(ge,0,2);return Math.min(Math.round(.5*Te*255),255)}(p[2])<<8|15*p[0]<<4|15*p[1],B=yt(_[0],0,1),W=yt(_[1],0,1),K=yt(_[2],0,1),J=yt(_[3],0,1);let se,oe,te,de;if(B!==W&&x!==m&&W!==B){const ge=x-m;oe=1/(ge*(W-B)),te=-(m+ge*B)/(ge*(W-B));const Te=yt(_[4],-1,1);de=Math.pow(10,Te),se=255*K<<8|255*J}else se=65535,oe=0,te=1,de=1;if(d.emplaceBack(O,U,D,se,oe,te,de),R){const ge=R.length;R.clear();for(let Te=0;Te<ge;Te++)R.emplaceBack(O,U,D,se,oe,te,de)}}function Yee(d,a,u){const p=d.node;let _=0;const m=u&g0.HasMeshoptCompression;for(const x of p.meshes){if(p.lights&&p.lightMeshIndex===_||!x.featureData)continue;x.featureArray=new ra,x.featureArray.reserve(x.featureData.length);let R=a;for(const k of x.featureData){const V=m?65535&k:k>>16&65535,b=m?k>>16&65535:65535&k,O=(15&b)<8?15&b:0,U=d.evaluatedRMEA[O],D=d.evaluatedColor[O],B=d.emissionHeightBasedParams[O];let W;if(R&&O===2&&p.lights&&(W=new ra,W.resize(10*p.lights.length)),Kee(x.featureArray,V,D,U,B,x.aabb.min[2],x.aabb.max[2],W),W&&R){R=!1;const K=p.meshes[p.lightMeshIndex];K.featureArray=W,K.featureArray._trim()}}x.featureArray._trim(),_++}}Un(tE,"Tiled3dModelBucket",{omit:["layers"]}),Un(XU,"Tiled3dModelFeature");const Jee=["id","tile","layer","source","sourceLayer","state"];class fC{constructor(a,u,p,_,m){this.type="Feature",this._vectorTileFeature=a,this._z=u,this._x=p,this._y=_,this.properties=a.properties,this.id=m}clone(){const a=new fC(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state={...this.state}),this.layer&&(a.layer={...this.layer}),this.namespace&&(a.namespace=this.namespace),a}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const u of Jee)this[u]!==void 0&&(a[u]=this[u]);return a}}function KU(d,a,u,p){const _=1<<d.z;a.lat=ze((p/Mn+d.y)/_),a.lng=Fe((u/Mn+d.x)/_)}const Qee={circle:class extends Ho{constructor(d,a,u,p){super(d,{layout:Rr||(Rr=new Ur({"circle-sort-key":new ni(Tt.layout_circle["circle-sort-key"]),visibility:new yn(Tt.layout_circle.visibility)})),paint:us||(us=new Ur({"circle-radius":new ni(Tt.paint_circle["circle-radius"]),"circle-color":new ni(Tt.paint_circle["circle-color"]),"circle-blur":new ni(Tt.paint_circle["circle-blur"]),"circle-opacity":new ni(Tt.paint_circle["circle-opacity"]),"circle-translate":new yn(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new yn(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yn(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yn(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ni(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ni(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ni(Tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new yn(Tt.paint_circle["circle-emissive-strength"])}))},a,u,p)}createBucket(d){return new un(d)}queryRadius(d){const a=d;return $r("circle-radius",this,a)+$r("circle-stroke-width",this,a)+Ki(this.paint.get("circle-translate"))}queryIntersectsFeature(d,a,u,p,_,m,x,R){const k=Br(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,d.pixelToTileUnitsFactor),V=this.paint.get("circle-radius").evaluate(a,u)+this.paint.get("circle-stroke-width").evaluate(a,u);return Tz(d,p,m,x,R,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",k,V)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,a,u){const p=Rz(this);return{config:new gn(this,{zoom:a,lut:u}),defines:p,overrideFog:!1}}},heatmap:class extends Ho{createBucket(d){return new Pz(d)}constructor(d,a,u,p){super(d,{layout:Iz||(Iz=new Ur({visibility:new yn(Tt.layout_heatmap.visibility)})),paint:Dz||(Dz=new Ur({"heatmap-radius":new ni(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ni(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yn(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ph(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yn(Tt.paint_heatmap["heatmap-opacity"])}))},a,u,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(d){return $r("heatmap-radius",this,d)}queryIntersectsFeature(d,a,u,p,_,m,x,R){const k=this.paint.get("heatmap-radius").evaluate(a,u);return Tz(d,p,m,x,R,!0,!0,new _e(0,0),k)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,a,u){return d==="heatmap"?{config:new gn(this,{zoom:a,lut:u}),overrideFog:!1}:{}}},hillshade:class extends Ho{constructor(d,a,u,p){super(d,{layout:Fz||(Fz=new Ur({visibility:new yn(Tt.layout_hillshade.visibility)})),paint:Lz||(Lz=new Ur({"hillshade-illumination-direction":new yn(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yn(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yn(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yn(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yn(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yn(Tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new yn(Tt.paint_hillshade["hillshade-emissive-strength"])}))},a,u,p)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,a,u){return{overrideFog:!1}}},fill:class extends Ho{constructor(d,a,u,p){super(d,{layout:Gz||(Gz=new Ur({"fill-sort-key":new ni(Tt.layout_fill["fill-sort-key"]),visibility:new yn(Tt.layout_fill.visibility),"fill-elevation-reference":new yn(Tt.layout_fill["fill-elevation-reference"])})),paint:Hz||(Hz=new Ur({"fill-antialias":new yn(Tt.paint_fill["fill-antialias"]),"fill-opacity":new ni(Tt.paint_fill["fill-opacity"]),"fill-color":new ni(Tt.paint_fill["fill-color"]),"fill-outline-color":new ni(Tt.paint_fill["fill-outline-color"]),"fill-translate":new yn(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new yn(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ni(Tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new yn(Tt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ni(Tt.paint_fill["fill-z-offset"])}))},a,u,p)}getProgramIds(){const d=this.paint.get("fill-pattern"),a=d&&d.constantOr(1),u=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getDefaultProgramParams(d,a,u){return{config:new gn(this,{zoom:a,lut:u}),overrideFog:!1}}recalculate(d,a){super.recalculate(d,a);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new AP(d)}queryRadius(){return Ki(this.paint.get("fill-translate"))}queryIntersectsFeature(d,a,u,p,_,m){return!d.queryGeometry.isAboveHorizon&&Qn(Vr(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,d.pixelToTileUnitsFactor),p)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Ho{constructor(d,a,u,p){super(d,{layout:b4||(b4=new Ur({visibility:new yn(Tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new yn(Tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:E4||(E4=new Ur({"fill-extrusion-opacity":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ni(Tt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new yn(Tt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},a,u,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new Db(d)}queryRadius(){return Ki(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,a,u,p,_,m,x,R,k){const V=Br(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,d.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(a,u),O=this.paint.get("fill-extrusion-base").evaluate(a,u),U=[0,0],D=R&&m.elevation,B=m.elevation?m.elevation.exaggeration():1,W=d.tile.getBucket(this);if(D&&W instanceof Db){const te=W.centroidVertexArray,de=k+1;de<te.length&&(U[0]=te.geta_centroid_pos0(de),U[1]=te.geta_centroid_pos1(de))}if(U[0]===0&&U[1]===1)return!1;m.projection.name==="globe"&&(p=S4([p],[new _e(0,0),new _e(Mn,Mn)],d.tileID.canonical).map(te=>te.polygon).flat());const K=D?R:null,[J,se]=function(te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct){return te.projection.name==="globe"?function(dt,xt,Rt,It,Et,en,dn,Ht,Vn,Rn,xn){const hn=[],si=[],Nn=dt.projection.upVectorScale(xn,dt.center.lat,dt.worldSize).metersToTile,qn=[0,0,0,1],Pi=[0,0,0,1],zi=(ki,Yi,Zi,Kr)=>{ki[0]=Yi,ki[1]=Zi,ki[2]=Kr,ki[3]=1},Ui=C4();Rt>0&&(Rt+=Ui),It+=Ui;for(const ki of xt){const Yi=[],Zi=[];for(const Kr of ki){const Gr=Kr.x+Et.x,Ei=Kr.y+Et.y,Tr=dt.projection.projectTilePoint(Gr,Ei,xn),Dr=dt.projection.upVector(xn,Kr.x,Kr.y);let ds=Rt,Ws=It;if(dn){const so=R4(Gr,Ei,Rt,It,dn,Ht,Vn,Rn);ds+=so.base,Ws+=so.top}Rt!==0?zi(qn,Tr.x+Dr[0]*Nn*ds,Tr.y+Dr[1]*Nn*ds,Tr.z+Dr[2]*Nn*ds):zi(qn,Tr.x,Tr.y,Tr.z),zi(Pi,Tr.x+Dr[0]*Nn*Ws,Tr.y+Dr[1]*Nn*Ws,Tr.z+Dr[2]*Nn*Ws),Re.vec3.transformMat4(qn,qn,en),Re.vec3.transformMat4(Pi,Pi,en),Yi.push(new iy(qn[0],qn[1],qn[2])),Zi.push(new iy(Pi[0],Pi[1],Pi[2]))}hn.push(Yi),si.push(Zi)}return[hn,si]}(te,de,ge,Te,Ve,Oe,Ne,st,ke,et,ct):Ne?function(dt,xt,Rt,It,Et,en,dn,Ht,Vn){const Rn=[],xn=[],hn=[0,0,0,1];for(const si of dt){const Nn=[],qn=[];for(const Pi of si){const zi=Pi.x+It.x,Ui=Pi.y+It.y,ki=R4(zi,Ui,xt,Rt,en,dn,Ht,Vn);hn[0]=zi,hn[1]=Ui,hn[2]=ki.base,hn[3]=1,Re.vec4.transformMat4(hn,hn,Et),hn[3]=Math.max(hn[3],1e-5);const Yi=new iy(hn[0]/hn[3],hn[1]/hn[3],hn[2]/hn[3]);hn[0]=zi,hn[1]=Ui,hn[2]=ki.top,hn[3]=1,Re.vec4.transformMat4(hn,hn,Et),hn[3]=Math.max(hn[3],1e-5);const Zi=new iy(hn[0]/hn[3],hn[1]/hn[3],hn[2]/hn[3]);Nn.push(Yi),qn.push(Zi)}Rn.push(Nn),xn.push(qn)}return[Rn,xn]}(de,ge,Te,Ve,Oe,Ne,st,ke,et):function(dt,xt,Rt,It,Et){const en=[],dn=[],Ht=Et[8]*xt,Vn=Et[9]*xt,Rn=Et[10]*xt,xn=Et[11]*xt,hn=Et[8]*Rt,si=Et[9]*Rt,Nn=Et[10]*Rt,qn=Et[11]*Rt;for(const Pi of dt){const zi=[],Ui=[];for(const ki of Pi){const Yi=ki.x+It.x,Zi=ki.y+It.y,Kr=Et[0]*Yi+Et[4]*Zi+Et[12],Gr=Et[1]*Yi+Et[5]*Zi+Et[13],Ei=Et[2]*Yi+Et[6]*Zi+Et[14],Tr=Et[3]*Yi+Et[7]*Zi+Et[15],Dr=Kr+Ht,ds=Gr+Vn,Ws=Ei+Rn,so=Math.max(Tr+xn,1e-5),js=Kr+hn,ks=Gr+si,Ks=Ei+Nn,go=Math.max(Tr+qn,1e-5);zi.push(new iy(Dr/so,ds/so,Ws/so)),Ui.push(new iy(js/go,ks/go,Ks/go))}en.push(zi),dn.push(Ui)}return[en,dn]}(de,ge,Te,Ve,Oe)}(m,p,O,b,V,x,K,U,B,m.center.lat,d.tileID.canonical),oe=d.queryGeometry;return function(te,de,ge){let Te=1/0;Qn(ge,de)&&(Te=M4(ge,de[0]));for(let Ve=0;Ve<de.length;Ve++){const Oe=de[Ve],Ne=te[Ve];for(let st=0;st<Oe.length-1;st++){const ke=Oe[st],et=[ke,Oe[st+1],Ne[st+1],Ne[st],ke];sn(ge,et)&&(Te=Math.min(Te,M4(ge,et)))}}return Te!==1/0&&Te}(J,se,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Ho{constructor(d,a,u,p){const _=N4();super(d,_,a,u,p),_.layout&&(this.layout=new Du(_.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof Ad,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,a){super.recalculate(d,a),this.paint._values["line-floorwidth"]=(()=>{if(eC)return eC;const u=N4();return eC=new tee(u.paint.properties["line-width"].specification),eC.useIntegerZoom=!0,eC})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new zP(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,a,u){const p=O4(this);return{config:new gn(this,{zoom:a,lut:u}),defines:p,overrideFog:!1}}queryRadius(d){const a=d,u=B4($r("line-width",this,a),$r("line-gap-width",this,a)),p=$r("line-offset",this,a);return u/2+Math.abs(p)+Ki(this.paint.get("line-translate"))}queryIntersectsFeature(d,a,u,p,_,m){if(d.queryGeometry.isAboveHorizon)return!1;const x=Vr(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,d.pixelToTileUnitsFactor),R=d.pixelToTileUnitsFactor/2*B4(this.paint.get("line-width").evaluate(a,u),this.paint.get("line-gap-width").evaluate(a,u)),k=this.paint.get("line-offset").evaluate(a,u);return k&&(p=function(V,b){const O=[],U=new _e(0,0);for(let D=0;D<V.length;D++){const B=V[D],W=[];for(let K=0;K<B.length;K++){const J=B[K],se=B[K+1],oe=K===0?U:J.sub(B[K-1])._unit()._perp(),te=K===B.length-1?U:se.sub(J)._unit()._perp(),de=oe._add(te)._unit();de._mult(1/(de.x*te.x+de.y*te.y)),W.push(de._mult(b)._add(J))}O.push(W)}return O}(p,k*d.pixelToTileUnitsFactor)),function(V,b,O){for(let U=0;U<b.length;U++){const D=b[U];if(V.length>=3){for(let B=0;B<D.length;B++)if(sr(V,D[B]))return!0}if(ri(V,D,O))return!0}return!1}(x,p,R)}isTileClipped(){return!0}isDraped(d){const a=this.layout.get("line-z-offset"),u=a.isConstant()&&!a.constantOr(0),p=this.layout.get("line-elevation-reference");return!(p==="sea"||p==="ground")&&(u||p!=="none")}},symbol:qb,background:class extends Ho{constructor(d,a,u,p){super(d,{layout:wU||(wU=new Ur({visibility:new yn(Tt.layout_background.visibility)})),paint:CU||(CU=new Ur({"background-pitch-alignment":new yn(Tt.paint_background["background-pitch-alignment"]),"background-color":new yn(Tt.paint_background["background-color"]),"background-pattern":new yn(Tt.paint_background["background-pattern"]),"background-opacity":new yn(Tt.paint_background["background-opacity"]),"background-emissive-strength":new yn(Tt.paint_background["background-emissive-strength"])}))},a,u,p)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,a,u){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:RU,"raster-particle":FU,sky:class extends Ho{constructor(d,a,u,p){super(d,{layout:PU||(PU=new Ur({visibility:new yn(Tt.layout_sky.visibility)})),paint:IU||(IU=new Ur({"sky-type":new yn(Tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new yn(Tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yn(Tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yn(Tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yn(Tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ph(Tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yn(Tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yn(Tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yn(Tt.paint_sky["sky-opacity"])}))},a,u,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="sky-gradient"?this._updateColorRamp():d!=="sky-atmosphere-sun"&&d!=="sky-atmosphere-halo-color"&&d!=="sky-atmosphere-color"&&d!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=jw({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(d,a){if(this.paint.get("sky-type")==="atmosphere"){const p=this.paint.get("sky-atmosphere-sun"),_=!p,m=d.style.light,x=m.properties.get("position");return _&&m.properties.get("anchor")==="viewport"&&vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?aI(x.azimuthal,90-x.polar,a):aI(p[0],90-p[1],a)}const u=this.paint.get("sky-gradient-center");return aI(u[0],90-u[1],a)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return d==="atmosphere"?["skyboxCapture","skybox"]:d==="gradient"?["skyboxGradient"]:null}},slot:class extends Ho{constructor(d,a,u,p){super(d,{paint:DU||(DU=new Ur({}))},a,null)}},model:class extends Ho{constructor(d,a,u,p){super(d,{layout:HU||(HU=new Ur({visibility:new yn(Tt.layout_model.visibility),"model-id":new ni(Tt.layout_model["model-id"])})),paint:WU||(WU=new Ur({"model-opacity":new yn(Tt.paint_model["model-opacity"]),"model-rotation":new ni(Tt.paint_model["model-rotation"]),"model-scale":new ni(Tt.paint_model["model-scale"]),"model-translation":new ni(Tt.paint_model["model-translation"]),"model-color":new ni(Tt.paint_model["model-color"]),"model-color-mix-intensity":new ni(Tt.paint_model["model-color-mix-intensity"]),"model-type":new yn(Tt.paint_model["model-type"]),"model-cast-shadows":new yn(Tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new yn(Tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new yn(Tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ni(Tt.paint_model["model-emissive-strength"]),"model-roughness":new ni(Tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ni(Tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new yn(Tt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new yn(Tt.paint_model["model-front-cutoff"])}))},a,u,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new uI(d)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof tE?Mn-1:0}queryIntersectsFeature(d,a,u,p,_,m){if(!this.modelManager)return!1;const x=this.modelManager,R=d.tile.getBucket(this);if(!(R&&R instanceof uI))return!1;const k=R;for(const V in k.instancesPerModel){const b=k.instancesPerModel[V],O=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(b.idToFeaturesIndex.hasOwnProperty(O)){const U=b.features[b.idToFeaturesIndex[O]],D=x.getModel(V,this.scope);if(!D)return!1;let B=Re.mat4.create();const W=new X(0,0),K=k.canonical;let J=Number.MAX_VALUE;for(let se=0;se<U.instancedDataCount;++se){const oe=16*(U.instancedDataOffset+se),te=b.instancedDataArray.float32,de=[te[oe+4],te[oe+5],te[oe+6]];KU(K,W,te[oe],0|te[oe+1]),jU(B,D,m,W,U.rotation,U.scale,de,!1,!1,!1),m.projection.name==="globe"&&(B=cI(B,m));const ge=Re.mat4.multiply([],m.projMatrix,B),Te=d.queryGeometry,Ve=BU(Te.isPointQuery()?Te.screenBounds:Te.screenGeometry,m,ge,D.aabb);Ve!=null&&(J=Math.min(Ve,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(d,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven()||d!=="model-color"&&d!=="model-color-mix-intensity"&&d!=="model-rotation"&&d!=="model-scale"&&d!=="model-translation"&&d!=="model-emissive-strength")}_isPropertyZoomDependent(d){const a=this._transitionablePaint._values[d];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof Nd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(d,a,u,p){const _=d.tile,m=_.getBucket(this);let x=null,R=Number.MAX_VALUE;if(!(m&&m instanceof tE))return{queryFeature:x,intersectionZ:R};const k=m.getNodesInfo()[a];if(k.hiddenByReplacement||!k.node.meshes||!u.filter(new gs(_.tileID.overscaledZ),k.feature,_.tileID.canonical))return{queryFeature:x,intersectionZ:R};const V=k.node,b=p.calculatePosMatrix(_.tileID.toUnwrapped(),p.worldSize),O=k.evaluatedScale;let U=0;p.elevation&&V.elevation&&(U=V.elevation*p.elevation.exaggeration()),Re.mat4.translate(b,b,[(V.anchor?V.anchor[0]:0)*(O[0]-1),(V.anchor?V.anchor[1]:0)*(O[1]-1),U]),Re.mat4.scale(b,b,O);const D=d.queryGeometry,B=D.isPointQuery()?D.screenBounds:D.screenGeometry,W=function(te){const de=Re.mat4.multiply([],b,te.matrix);Re.mat4.multiply(de,p.expandedFarZProjMatrix,de);for(let ge=0;ge<te.meshes.length;++ge){const Te=te.meshes[ge];if(ge===te.lightMeshIndex)continue;const Ve=BU(B,p,de,Te.aabb);Ve!=null&&(R=Math.min(Ve,R))}if(te.children)for(const ge of te.children)W(ge)};if(W(V),R===Number.MAX_VALUE)return{queryFeature:x,intersectionZ:R};const K=new X(0,0);KU(_.tileID.canonical,K,k.node.anchor[0],k.node.anchor[1]);const{z:J,x:se,y:oe}=_.tileID.canonical;return x=new fC({},J,se,oe,k.feature.id),x.properties=k.feature.properties,x.geometry={type:"Point",coordinates:[K.lng,K.lat]},x.layer={...this.serialize(),id:this.fqid},x.state={},x.tile=_.tileID.canonical,{queryFeature:x,intersectionZ:R}}},clip:class extends Ho{constructor(d,a,u,p){super(d,{layout:Wz||(Wz=new Ur({"clip-layer-types":new yn(Tt.layout_clip["clip-layer-types"]),"clip-layer-scope":new yn(Tt.layout_clip["clip-layer-scope"])})),paint:jz||(jz=new Ur({}))},a,u,p)}recalculate(d,a){super.recalculate(d,a)}createBucket(d){return new $z(d)}isTileClipped(){return!0}is3D(){return!0}}};class ete{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class tte{constructor(){this.tasks={},this.taskQueue=[],oi(["process"],this),this.invoker=new ete(this.process),this.nextId=0}add(a,u){const p=this.nextId++,_=function({type:m,isSymbolTile:x,zoom:R}){return R=R||0,m==="message"?0:m!=="maybePrepare"||x?m!=="parseTile"||x?m==="parseTile"&&x?300-R:m==="maybePrepare"&&x?400-R:500:200-R:100-R}(u);if(_===0){try{a()}finally{}return null}return this.tasks[p]={fn:a,metadata:u,priority:_,id:p},this.taskQueue.push(p),this.invoker.trigger(),{cancel:()=>{delete this.tasks[p]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(p=>!!this.tasks[p]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const u=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let a=null,u=1/0;for(let _=0;_<this.taskQueue.length;_++){const m=this.tasks[this.taskQueue[_]];m.priority<u&&(u=m.priority,a=_)}if(a===null)return null;const p=this.taskQueue[a];return this.taskQueue.splice(a,1),p}remove(){this.invoker.remove()}}class YU{constructor(a,u,p){this.target=a,this.parent=u,this.mapId=p,this.callbacks={},this.cancelCallbacks={},oi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new tte}send(a,u,p,_,m=!1,x){const R=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=x,this.callbacks[R]=p);const k=new Set;return this.target.postMessage({id:R,type:a,hasCallback:!!p,targetMapId:_,mustQueue:m,sourceMapId:this.mapId,data:ci(u,k)},k),{cancel:()=>{p&&delete this.callbacks[R],this.target.postMessage({id:R,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(a){const u=a.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){const _=this.cancelCallbacks[p];delete this.cancelCallbacks[p],_&&_.cancel()}else if(u.mustQueue||Ln()){const _=this.callbacks[p],m=this.scheduler.add(()=>this.processTask(p,u),_&&_.metadata||{type:"message"});m&&(this.cancelCallbacks[p]=m)}else this.processTask(p,u)}processTask(a,u){if(delete this.cancelCallbacks[a],u.type==="<response>"){const p=this.callbacks[a];delete this.callbacks[a],p&&(u.error?p(na(u.error)):p(null,na(u.data)))}else{const p=new Set,_=u.hasCallback?(x,R)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:x?ci(x):null,data:ci(R,p)},p)}:()=>{},m=na(u.data);if(this.parent[u.type])this.parent[u.type](u.sourceMapId,m,_);else if(this.parent.getWorkerSource){const x=u.type.split(".");this.parent.getWorkerSource(u.sourceMapId,x[0],m.source,m.scope)[x[1]](m,_)}else _(new Error(`Could not find function ${u.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class y0{constructor(a,u){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=Li();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const m=new y0.Actor(p[_],u,this.id);m.name=`Worker ${_}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,u,p){Fn(this.actors,(_,m)=>{_.send(a,u,m)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}y0.Actor=YU;class JU{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,u){const p=this.toIdx(a,u);return{min:this.minimums[p],max:this.maximums[p]}}isLeaf(a,u){return this.leaves[this.toIdx(a,u)]}toIdx(a,u){return u*this.size+a}}function QU(d,a,u,p){let _=0,m=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(p[x])<1e-15){if(u[x]<d[x]||u[x]>a[x])return null}else{const R=1/p[x];let k=(d[x]-u[x])*R,V=(a[x]-u[x])*R;if(k>V){const b=k;k=V,V=b}if(k>_&&(_=k),V<m&&(m=V),_>m)return null}return _}function eV(d,a,u,p,_,m,x,R,k,V,b){const O=p-d,U=_-a,D=m-u,B=x-d,W=R-a,K=k-u,J=b[1]*K-b[2]*W,se=b[2]*B-b[0]*K,oe=b[0]*W-b[1]*B,te=O*J+U*se+D*oe;if(Math.abs(te)<1e-15)return null;const de=1/te,ge=V[0]-d,Te=V[1]-a,Ve=V[2]-u,Oe=(ge*J+Te*se+Ve*oe)*de;if(Oe<0||Oe>1)return null;const Ne=Te*D-Ve*U,st=Ve*O-ge*D,ke=ge*U-Te*O,et=(b[0]*Ne+b[1]*st+b[2]*ke)*de;return et<0||Oe+et>1?null:(B*Ne+W*st+K*ke)*de}function tV(d,a,u){return(d-a)/(u-a)}function nV(d,a,u,p,_,m,x,R,k){const V=1<<u,b=m-p,O=x-_,U=(d+1)/V*b+p,D=(a+0)/V*O+_,B=(a+1)/V*O+_;R[0]=(d+0)/V*b+p,R[1]=D,k[0]=U,k[1]=B}class iV{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(m){const x=Math.ceil(Math.log2(m.dim/8)),R=[];let k=Math.ceil(Math.pow(2,x));const V=1/k,b=(D,B,W,K,J)=>{const se=K?1:0,oe=(D+1)*W-se,te=B*W,de=(B+1)*W-se;J[0]=D*W,J[1]=te,J[2]=oe,J[3]=de};let O=new JU(k);const U=[];for(let D=0;D<k*k;D++){b(D%k,Math.floor(D/k),V,!1,U);const B=lg(U[0],U[1],m),W=lg(U[2],U[1],m),K=lg(U[2],U[3],m),J=lg(U[0],U[3],m);O.minimums.push(Math.min(B,W,K,J)),O.maximums.push(Math.max(B,W,K,J)),O.leaves.push(1)}for(R.push(O),k/=2;k>=1;k/=2){const D=R[R.length-1];O=new JU(k);for(let B=0;B<k*k;B++){b(B%k,Math.floor(B/k),2,!0,U);const W=D.getElevation(U[0],U[1]),K=D.getElevation(U[2],U[1]),J=D.getElevation(U[2],U[3]),se=D.getElevation(U[0],U[3]),oe=D.isLeaf(U[0],U[1]),te=D.isLeaf(U[2],U[1]),de=D.isLeaf(U[2],U[3]),ge=D.isLeaf(U[0],U[3]),Te=Math.min(W.min,K.min,J.min,se.min),Ve=Math.max(W.max,K.max,J.max,se.max),Oe=oe&&te&&de&&ge;O.maximums.push(Ve),O.minimums.push(Te),O.leaves.push(Ve-Te<=5&&Oe?1:0)}R.push(O)}return R}(this.dem),p=u.length-1,_=u[p];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(u,0,0,p,0)}raycastRoot(a,u,p,_,m,x,R=1){return QU([a,u,-100],[p,_,this.maximums[0]*R],m,x)}raycast(a,u,p,_,m,x,R=1){if(!this.nodeCount)return null;const k=this.raycastRoot(a,u,p,_,m,x,R);if(k==null)return null;const V=[],b=[],O=[],U=[],D=[{idx:0,t:k,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:B,t:W,nodex:K,nodey:J,depth:se}=D.pop();if(this.leaves[B]){nV(K,J,se,a,u,p,_,O,U);const te=1<<se,de=(K+0)/te,ge=(K+1)/te,Te=(J+0)/te,Ve=(J+1)/te,Oe=lg(de,Te,this.dem)*R,Ne=lg(ge,Te,this.dem)*R,st=lg(ge,Ve,this.dem)*R,ke=lg(de,Ve,this.dem)*R,et=eV(O[0],O[1],Oe,U[0],O[1],Ne,U[0],U[1],st,m,x),ct=eV(U[0],U[1],st,O[0],U[1],ke,O[0],O[1],Oe,m,x),dt=Math.min(et!==null?et:Number.MAX_VALUE,ct!==null?ct:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const xt=Re.vec3.scaleAndAdd([],m,x,W);if(rV(Oe,Ne,ke,st,tV(xt[0],O[0],U[0]),tV(xt[1],O[1],U[1]))>=xt[2])return W}continue}let oe=0;for(let te=0;te<this._siblingOffset.length;te++){nV((K<<1)+this._siblingOffset[te][0],(J<<1)+this._siblingOffset[te][1],se+1,a,u,p,_,O,U),O[2]=-100,U[2]=this.maximums[this.childOffsets[B]+te]*R;const de=QU(O,U,m,x);if(de!=null){const ge=de;V[te]=ge;let Te=!1;for(let Ve=0;Ve<oe&&!Te;Ve++)ge>=V[b[Ve]]&&(b.splice(Ve,0,te),Te=!0);Te||(b[oe]=te),oe++}}for(let te=0;te<oe;te++){const de=b[te];D.push({idx:this.childOffsets[B]+de,t:V[de],nodex:(K<<1)+this._siblingOffset[de][0],nodey:(J<<1)+this._siblingOffset[de][1],depth:se+1})}}return null}_addNode(a,u,p){return this.minimums.push(a),this.maximums.push(u),this.leaves.push(p),this.childOffsets.push(0),this.nodeCount++}_construct(a,u,p,_,m){if(a[_].isLeaf(u,p)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const x=_-1,R=a[x];let k=0,V=0;for(let b=0;b<this._siblingOffset.length;b++){const O=2*u+this._siblingOffset[b][0],U=2*p+this._siblingOffset[b][1],D=R.getElevation(O,U),B=R.isLeaf(O,U),W=this._addNode(D.min,D.max,B);B&&(k|=1<<b),V||(V=W)}for(let b=0;b<this._siblingOffset.length;b++)k&1<<b||this._construct(a,2*u+this._siblingOffset[b][0],2*p+this._siblingOffset[b][1],x,V+b)}}function rV(d,a,u,p,_,m){return Hn(Hn(d,u,m),Hn(a,p,m),_)}function lg(d,a,u){const p=u.dim,_=yt(d*p-.5,0,p-1),m=yt(a*p-.5,0,p-1),x=Math.floor(_),R=Math.floor(m),k=Math.min(x+1,p-1),V=Math.min(R+1,p-1);return rV(u.get(x,R),u.get(k,R),u.get(x,V),u.get(k,V),_-x,m-R)}const nte={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ite(d,a,u){return(256*d*256+256*a+u)/10-1e4}function rte(d,a,u){return 256*d+a+u/256-32768}class nE{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,u,p,_=!1){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void vi(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const m=this.dim=u.height-2,x=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.floatView=new Float32Array(u.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let k=0;k<m;k++)x[this._idx(-1,k)]=x[this._idx(0,k)],x[this._idx(m,k)]=x[this._idx(m-1,k)],x[this._idx(k,-1)]=x[this._idx(k,0)],x[this._idx(k,m)]=x[this._idx(k,m-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(m,-1)]=x[this._idx(m-1,0)],x[this._idx(-1,m)]=x[this._idx(0,m-1)],x[this._idx(m,m)]=x[this._idx(m-1,m-1)]}const R=p==="terrarium"?rte:ite;for(let k=0;k<x.length;++k){const V=4*k;this.floatView[k]=R(this.pixels[V],this.pixels[V+1],this.pixels[V+2])}this._timestamp=In.now()}_buildQuadTree(){this._tree=new iV(this)}get(a,u,p=!1){p&&(a=yt(a,-1,this.dim),u=yt(u,-1,this.dim));const _=this._idx(a,u);return this.floatView[_]}set(a,u,p){const _=this._idx(a,u),m=this.floatView[_];return this.floatView[_]=p,p-m}static getUnpackVector(a){return nte[a]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)}static pack(a,u){const p=[0,0,0,0],_=nE.getUnpackVector(u);let m=Math.floor((a+_[3])/_[2]);return p[2]=m%256,m=Math.floor(m/256),p[1]=m%256,m=Math.floor(m/256),p[0]=m,p}getPixels(){return new Nz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,m=u*this.dim+this.dim,x=p*this.dim,R=p*this.dim+this.dim;switch(u){case-1:_=m-1;break;case 1:m=_+1}switch(p){case-1:x=R-1;break;case 1:R=x+1}const k=-u*this.dim,V=-p*this.dim;for(let b=x;b<R;b++)for(let O=_;O<m;O++){const U=4*this._idx(O,b),D=4*this._idx(O+k,b+V);this.pixels[U+0]=a.pixels[D+0],this.pixels[U+1]=a.pixels[D+1],this.pixels[U+2]=a.pixels[D+2],this.pixels[U+3]=a.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function ste(d,a,u){d===1?a.headerLength=u.readFixed32():d===2?a.x=u.readVarint():d===3?a.y=u.readVarint():d===4?a.z=u.readVarint():d===5&&a.layers.push(function(p,_){return p.readFields(ute,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},_)}(u,u.readVarint()+u.pos))}function ote(d,a,u){d===1?(a.delta_filter=function(p,_){return p.readFields(ate,{blockSize:0},_)}(u,u.readVarint()+u.pos),a.filter="delta_filter"):d===2?(u.readVarint(),a.filter="zigzag_filter"):d===3?(u.readVarint(),a.filter="bitshuffle_filter"):d===4&&(u.readVarint(),a.filter="byteshuffle_filter")}function ate(d,a,u){d===1&&(a.blockSize=u.readVarint())}function lte(d,a,u){d===1?(u.readVarint(),a.codec="gzip_data"):d===2?(u.readVarint(),a.codec="jpeg_image"):d===3?(u.readVarint(),a.codec="webp_image"):d===4&&(u.readVarint(),a.codec="png_image")}function cte(d,a,u){let p=0,_=0;d===1?a.firstByte=u.readFixed64():d===2?a.lastByte=u.readFixed64():d===3?a.filters.push(function(m,x){return m.readFields(ote,{},x)}(u,u.readVarint()+u.pos)):d===4?a.codec=function(m,x){return m.readFields(lte,{},x)}(u,u.readVarint()+u.pos):d===5?_=u.readFloat():d===6?p=u.readFloat():d===7?a.bands.push(u.readString()):d===8?a.offset=u.readDouble():d===9&&(a.scale=u.readDouble()),a.offset===0&&(a.offset=_),a.scale===0&&(a.scale=p)}function ute(d,a,u){d===1?a.version=u.readVarint():d===2?a.name=u.readString():d===3?a.units=u.readString():d===4?a.tileSize=u.readVarint():d===5?a.buffer=u.readVarint():d===6?a.pixelFormat=u.readVarint():d===7&&a.dataIndex.push(function(p,_){return p.readFields(cte,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},_)}(u,u.readVarint()+u.pos))}function hte(d,a,u){if(d===2)(function(p,_,m){p.readFields(dte,m,_)})(u,u.readVarint()+u.pos,a);else if(d===3)throw new Error("Not implemented")}function dte(d,a,u){if(d===1){let p=0;const _=u.readVarint()+u.pos;for(;u.pos<_;)a[p++]=u.readVarint()}}Un(nE,"DEMData"),Un(iV,"DemMinMaxQuadTree",{omit:["dem"]});class fte{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const u=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,u),u}put(a,u){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,u)}}function pte(d,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let u=a[3];for(let p=2;p>=1;p--){const _=p===1?1:0,m=p===2?1:0;for(let x=0;x<a[0];x++){const R=a[1]*x;for(let k=_;k<a[1];k++){const V=a[2]*(k+R);for(let b=m;b<a[2];b++){const O=a[3]*(b+V);for(let U=0;U<a[3];U++){const D=O+U;d[D]+=d[D-u]}}}}u*=a[p]}return d}function mte(d){for(let a=0,u=d.length;a<u;a++)d[a]=d[a]>>>1^-(1&d[a]);return d}function gte(d,a){switch(a){case"uint32":return d;case"uint16":for(let u=0;u<d.length;u+=2){const p=d[u],_=d[u+1];d[u]=(240&p)>>4|(61440&p)>>8|(240&_)<<4|61440&_,d[u+1]=15&p|(3840&p)>>4|(15&_)<<8|(3840&_)<<4}return d;case"uint8":for(let u=0;u<d.length;u+=4){const p=d[u],_=d[u+1],m=d[u+2],x=d[u+3];d[u+0]=(192&p)>>6|(192&_)>>4|(192&m)>>2|192&x,d[u+1]=(48&p)>>4|(48&_)>>2|48&m|(48&x)<<2,d[u+2]=(12&p)>>2|12&_|(12&m)<<2|(12&x)<<4,d[u+3]=3&p|(3&_)<<2|(3&m)<<4|(3&x)<<6}return d;default:throw new Error(`Invalid pixel format, "${a}"`)}}var ou=Uint8Array,pC=Uint16Array,vte=Int32Array,sV=new ou([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oV=new ou([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yte=new ou([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),aV=function(d,a){for(var u=new pC(31),p=0;p<31;++p)u[p]=a+=1<<d[p-1];var _=new vte(u[30]);for(p=1;p<30;++p)for(var m=u[p];m<u[p+1];++m)_[m]=m-u[p]<<5|p;return{b:u,r:_}},lV=aV(sV,2),cV=lV.b,_te=lV.r;cV[28]=258,_te[258]=28;for(var xte=aV(oV,0).b,uV=new pC(32768),ro=0;ro<32768;++ro){var _0=(43690&ro)>>1|(21845&ro)<<1;uV[ro]=((65280&(_0=(61680&(_0=(52428&_0)>>2|(13107&_0)<<2))>>4|(3855&_0)<<4))>>8|(255&_0)<<8)>>1}var mC=function(d,a,u){for(var p=d.length,_=0,m=new pC(a);_<p;++_)d[_]&&++m[d[_]-1];var x,R=new pC(a);for(_=1;_<a;++_)R[_]=R[_-1]+m[_-1]<<1;x=new pC(1<<a);var k=15-a;for(_=0;_<p;++_)if(d[_])for(var V=_<<4|d[_],b=a-d[_],O=R[d[_]-1]++<<b,U=O|(1<<b)-1;O<=U;++O)x[uV[O]>>k]=V;return x},gC=new ou(288);for(ro=0;ro<144;++ro)gC[ro]=8;for(ro=144;ro<256;++ro)gC[ro]=9;for(ro=256;ro<280;++ro)gC[ro]=7;for(ro=280;ro<288;++ro)gC[ro]=8;var hV=new ou(32);for(ro=0;ro<32;++ro)hV[ro]=5;var wte=mC(gC,9),Cte=mC(hV,5),pI=function(d){for(var a=d[0],u=1;u<d.length;++u)d[u]>a&&(a=d[u]);return a},Nh=function(d,a,u){var p=a/8|0;return(d[p]|d[p+1]<<8)>>(7&a)&u},mI=function(d,a){var u=a/8|0;return(d[u]|d[u+1]<<8|d[u+2]<<16)>>(7&a)},Ste=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Bh=function(d,a,u){var p=new Error(a||Ste[d]);if(p.code=d,Error.captureStackTrace&&Error.captureStackTrace(p,Bh),!u)throw p;return p},bte=new ou(0),Ete=typeof TextDecoder<"u"&&new TextDecoder;try{Ete.decode(bte,{stream:!0})}catch{}const Mte={gzip_data:"gzip"};class zu extends Error{constructor(a){super(a),this.name="MRTError"}}const Rte={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},dV={uint32:1,uint16:2,uint8:4},Tte={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let gI;class vI{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const u=this.layers[a];if(!u)throw new zu(`Layer '${a}' not found`);return u}getHeaderLength(a){const u=new Uint8Array(a),p=new DataView(a);if(u[0]!==13)throw new zu("File is not a valid MRT.");return p.getUint32(1,!0)}parseHeader(a){const u=new Uint8Array(a),p=this.getHeaderLength(a);if(u.length<p)throw new zu(`Expected header with length >= ${p} but got buffer of length ${u.length}`);const _=function(m,x){return m.readFields(ste,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new gI(u.subarray(0,p)));if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new zu(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const m of _.layers)this.layers[m.name]=new Ate(m,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const u=[],p=this.getLayer(a.layerName);for(let _ of a.blockIndices){const m=p.dataIndex[_],x=m.firstByte-a.firstByte,R=m.lastByte-a.firstByte;if(p._blocksInProgress.has(_))continue;const k={layerName:p.name,firstByte:x,lastByte:R,pixelFormat:p.pixelFormat,blockIndex:_,blockShape:[m.bands.length].concat(p.bandShape),buffer:p.buffer,codec:m.codec.codec,filters:m.filters.map(V=>V.filter)};p._blocksInProgress.add(_),u.push(k)}return new fV(u,()=>{u.forEach(_=>p._blocksInProgress.delete(_.blockIndex))},(_,m)=>{if(u.forEach(x=>p._blocksInProgress.delete(x.blockIndex)),_)throw _;m.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class Ate{constructor({version:a,name:u,units:p,tileSize:_,pixelFormat:m,buffer:x,dataIndex:R},k){if(this.version=a,this.version!==1)throw new zu(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=u,this.units=p,this.tileSize=_,this.buffer=x,this.pixelFormat=Rte[m],this.dataIndex=R,this.bandShape=[_+2*x,_+2*x,dV[this.pixelFormat]],this._decodedBlocks=new fte(k?k.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return dV[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const u=a.blockIndex.toString();this._decodedBlocks.get(u)||this._decodedBlocks.put(u,a.data)}getBlockForBand(a){let u=0;switch(typeof a){case"string":for(const[p,_]of this.dataIndex.entries()){for(const[m,x]of _.bands.entries())if(x===a)return{bandIndex:u+m,blockIndex:p,blockBandIndex:m};u+=_.bands.length}break;case"number":for(const[p,_]of this.dataIndex.entries()){if(a>=u&&a<u+_.bands.length)return{bandIndex:a,blockIndex:p,blockBandIndex:a-u};u+=_.bands.length}break;default:throw new zu(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}throw new zu(`Band not found: ${JSON.stringify(a)}`)}getDataRange(a){let u=1/0,p=-1/0;const _=[],m=new Set;for(const x of a){const{blockIndex:R}=this.getBlockForBand(x);if(R<0)throw new zu(`Invalid band: ${JSON.stringify(x)}`);const k=this.dataIndex[R];_.includes(R)||_.push(R),m.add(R),u=Math.min(u,k.firstByte),p=Math.max(p,k.lastByte)}if(m.size>this.cacheSize)throw new zu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:u,lastByte:p,blockIndices:_}}hasBand(a){const{blockIndex:u}=this.getBlockForBand(a);return u>=0}hasDataForBand(a){const{blockIndex:u}=this.getBlockForBand(a);return u>=0&&!!this._decodedBlocks.get(u.toString())}getBandView(a){const{blockIndex:u,blockBandIndex:p}=this.getBlockForBand(a),_=this._decodedBlocks.get(u.toString());if(!_)throw new zu(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[u],x=this.bandShape.reduce((V,b)=>V*b,1),R=p*x,k=_.subarray(R,R+x);return{data:k,bytes:new Uint8Array(k.buffer).subarray(k.byteOffset,k.byteOffset+k.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}vI.setPbf=function(d){gI=d};class fV{constructor(a,u,p){this.tasks=a,this._onCancel=u,this._onComplete=p,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,u){this._finalized||(this._onComplete(a,u),this._finalized=!0)}}vI.performDecoding=function(d,a){const u=new Uint8Array(d);return Promise.all(a.tasks.map(p=>{const{layerName:_,firstByte:m,lastByte:x,pixelFormat:R,blockShape:k,blockIndex:V,filters:b,codec:O}=p,U=u.subarray(m,x+1),D=new Uint32Array(k[0]*k[1]*k[2]);let B;if(O!=="gzip_data")throw new zu(`Unhandled codec: ${O}`);return B=function(W,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((te=function(Te){Te[0]==31&&Te[1]==139&&Te[2]==8||Bh(6,"invalid gzip data");var Ve=Te[3],Oe=10;4&Ve&&(Oe+=2+(Te[10]|Te[11]<<8));for(var Ne=(Ve>>3&1)+(Ve>>4&1);Ne>0;Ne-=!Te[Oe++]);return Oe+(2&Ve)}(oe=W))+8>oe.length&&Bh(6,"invalid gzip data"),function(Te,Ve,Oe,Ne){var st=Te.length;if(!st||Ve.f&&!Ve.l)return Oe||new ou(0);var ke=!Oe,et=ke||Ve.i!=2,ct=Ve.i;ke&&(Oe=new ou(3*st));var dt,xt,Rt=function(cg){var ly=Oe.length;if(cg>ly){var SC=new ou(Math.max(2*ly,cg));SC.set(Oe),Oe=SC}},It=Ve.f||0,Et=Ve.p||0,en=Ve.b||0,dn=Ve.l,Ht=Ve.d,Vn=Ve.m,Rn=Ve.n,xn=8*st;do{if(!dn){It=Nh(Te,Et,1);var hn=Nh(Te,Et+1,3);if(Et+=3,!hn){var si=Te[(Ei=4+((Et+7)/8|0))-4]|Te[Ei-3]<<8,Nn=Ei+si;if(Nn>st){ct&&Bh(0);break}et&&Rt(en+si),Oe.set(Te.subarray(Ei,Nn),en),Ve.b=en+=si,Ve.p=Et=8*Nn,Ve.f=It;continue}if(hn==1)dn=wte,Ht=Cte,Vn=9,Rn=5;else if(hn==2){var qn=Nh(Te,Et,31)+257,Pi=Nh(Te,Et+10,15)+4,zi=qn+Nh(Te,Et+5,31)+1;Et+=14;for(var Ui=new ou(zi),ki=new ou(19),Yi=0;Yi<Pi;++Yi)ki[yte[Yi]]=Nh(Te,Et+3*Yi,7);Et+=3*Pi;var Zi=pI(ki),Kr=(1<<Zi)-1,Gr=mC(ki,Zi);for(Yi=0;Yi<zi;){var Ei,Tr=Gr[Nh(Te,Et,Kr)];if(Et+=15&Tr,(Ei=Tr>>4)<16)Ui[Yi++]=Ei;else{var Dr=0,ds=0;for(Ei==16?(ds=3+Nh(Te,Et,3),Et+=2,Dr=Ui[Yi-1]):Ei==17?(ds=3+Nh(Te,Et,7),Et+=3):Ei==18&&(ds=11+Nh(Te,Et,127),Et+=7);ds--;)Ui[Yi++]=Dr}}var Ws=Ui.subarray(0,qn),so=Ui.subarray(qn);Vn=pI(Ws),Rn=pI(so),dn=mC(Ws,Vn),Ht=mC(so,Rn)}else Bh(1);if(Et>xn){ct&&Bh(0);break}}et&&Rt(en+131072);for(var js=(1<<Vn)-1,ks=(1<<Rn)-1,Ks=Et;;Ks=Et){var go=(Dr=dn[mI(Te,Et)&js])>>4;if((Et+=15&Dr)>xn){ct&&Bh(0);break}if(Dr||Bh(2),go<256)Oe[en++]=go;else{if(go==256){Ks=Et,dn=null;break}var Ca=go-254;go>264&&(Ca=Nh(Te,Et,(1<<(Uh=sV[Yi=go-257]))-1)+cV[Yi],Et+=Uh);var os=Ht[mI(Te,Et)&ks],zl=os>>4;if(os||Bh(3),Et+=15&os,so=xte[zl],zl>3){var Uh=oV[zl];so+=mI(Te,Et)&(1<<Uh)-1,Et+=Uh}if(Et>xn){ct&&Bh(0);break}et&&Rt(en+131072);var Uu=en+Ca;if(en<so){var Vu=0-so,ay=Math.min(so,Uu);for(Vu+en<0&&Bh(3);en<ay;++en)Oe[en]=(void 0)[Vu+en]}for(;en<Uu;++en)Oe[en]=Oe[en-so]}}Ve.l=dn,Ve.p=Ks,Ve.b=en,Ve.f=It,dn&&(It=1,Ve.m=Vn,Ve.d=Ht,Ve.n=Rn)}while(!It);return en!=Oe.length&&ke?(dt=Oe,((xt=en)==null||xt>dt.length)&&(xt=dt.length),new ou(dt.subarray(0,xt))):Oe.subarray(0,en)}(oe.subarray(te,-8),{i:2},new ou(((J=oe)[(se=J.length)-4]|J[se-3]<<8|J[se-2]<<16|J[se-1]<<24)>>>0))));var J,se,oe,te;const de=Mte[K];if(!de)throw new Error(`Unhandled codec: ${K}`);const ge=new globalThis.DecompressionStream(de);return new Response(new Blob([W]).stream().pipeThrough(ge)).arrayBuffer().then(Te=>new Uint8Array(Te))}(U,O).then(W=>(function(K,J){K.readFields(hte,J)}(new gI(W),D),new Tte[R](D.buffer))),B.then(W=>{for(let K=b.length-1;K>=0;K--)switch(b[K]){case"delta_filter":pte(W,k);break;case"zigzag_filter":mte(W);break;case"bitshuffle_filter":gte(W,R);break;default:throw new zu(`Unhandled filter "${b[K]}"`)}return{layerName:_,blockIndex:V,data:W}}).catch(W=>{throw W})}))},Un(fV,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var vC={workerUrl:"",workerClass:null,workerParams:void 0};const yI="mapboxgl_preloaded_worker_pool";class yC{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<yC.workerCount;)this.workers.push(vC.workerClass!=null?new vC.workerClass:new self.Worker(vC.workerUrl,vC.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yI]}numActive(){return Object.keys(this.active).length}}let _C;function iE(){return _C||(_C=new yC),_C}yC.workerCount=2;let xC,_I,zh,x0,xI,w0=null;function pV(){return Ln()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:_I||je.DRACO_URL}function mV(){if(Ln()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(x0)return x0;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return x0=WebAssembly.validate(d)?je.MESHOPT_SIMD_URL:je.MESHOPT_URL,x0}const rE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Pte={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},wC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gV(d,a,u){const p=u.json.bufferViews.length,_=u.buffers.length;a.bufferView=p,u.json.bufferViews[p]={buffer:_,byteLength:d.byteLength},u.buffers[_]=d}const wI="KHR_draco_mesh_compression";function Ite(d,a){const u=d.extensions&&d.extensions[wI];if(!u)return;const p=new zh.Decoder,_=xV(a,u.bufferView),m=new zh.Mesh;if(!p.DecodeArrayToMesh(_,_.byteLength,m))throw new Error("Failed to decode Draco mesh");const x=a.json.accessors[d.indices],R=rE[x.componentType],k=x.count*R.BYTES_PER_ELEMENT,V=zh._malloc(k);R===Uint16Array?p.GetTrianglesUInt16Array(m,k,V):p.GetTrianglesUInt32Array(m,k,V),gV(zh.memory.buffer.slice(V,V+k),x,a),zh._free(V);for(const b of Object.keys(u.attributes)){const O=p.GetAttributeByUniqueId(m,u.attributes[b]),U=a.json.accessors[d.attributes[b]],D=Pte[U.componentType],B=U.count*wC[U.type]*rE[U.componentType].BYTES_PER_ELEMENT,W=zh._malloc(B);p.GetAttributeDataArrayForAllPoints(m,O,zh[D],B,W),gV(zh.memory.buffer.slice(W,W+B),U,a),zh._free(W)}p.destroy(),m.destroy(),delete d.extensions[wI]}const sE="EXT_meshopt_compression";function Dte(d,a){if(!d.extensions||!d.extensions[sE])return;const u=d.extensions[sE],p=new Uint8Array(a.buffers[u.buffer],u.byteOffset||0,u.byteLength||0),_=new Uint8Array(u.count*u.byteStride);xI.decodeGltfBuffer(_,u.count,u.byteStride,p,u.mode,u.filter),d.buffer=a.buffers.length,d.byteOffset=0,a.buffers[d.buffer]=_.buffer,delete d.extensions[sE]}const vV=1179937895,yV=new TextDecoder("utf8");function _V(d,a){return new URL(d,a).href}function Fte(d,a,u,p){return fetch(_V(d.uri,p)).then(_=>_.arrayBuffer()).then(_=>{a.buffers[u]=_})}function xV(d,a){const u=d.json.bufferViews[a];return new Uint8Array(d.buffers[u.buffer],u.byteOffset||0,u.byteLength)}function Lte(d,a,u,p){if(d.uri){const _=_V(d.uri,p);return fetch(_).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{a.images[u]=m})}if(d.bufferView!==void 0){const _=xV(a,d.bufferView),m=new Blob([_],{type:d.mimeType});return createImageBitmap(m).then(x=>{a.images[u]=x})}}function wV(d,a=0,u){const p={json:null,images:[],buffers:[]};if(new Uint32Array(d,a,1)[0]===vV){const b=new Uint32Array(d,a);let O=2;const U=(b[O++]>>2)-3,D=b[O++]>>2;if(O++,p.json=JSON.parse(yV.decode(b.subarray(O,O+D))),O+=D,O<U){const B=b[O++];O++;const W=a+(O<<2);p.buffers[0]=d.slice(W,W+B)}}else p.json=JSON.parse(yV.decode(new Uint8Array(d,a)));const{buffers:_,images:m,meshes:x,extensionsUsed:R,bufferViews:k}=p.json;let V=Promise.resolve();if(_){const b=[];for(let O=0;O<_.length;O++){const U=_[O];U.uri?b.push(Fte(U,p,O,u)):p.buffers[O]||(p.buffers[O]=null)}V=Promise.all(b)}return V.then(()=>{const b=[],O=R&&R.includes(wI),U=R&&R.includes(sE);if(O&&b.push(function(){if(!zh)return xC??(xC=function(D){let B,W=null;function K(){B=new Uint8Array(W.buffer)}function J(){throw new Error("Unexpected Draco error.")}const se={a:{a:J,d:function(oe,te,de){return B.copyWithin(oe,te,te+de)},c:function(oe){const te=B.length,de=Math.max(oe>>>0,Math.ceil(1.2*te)),ge=Math.ceil((de-te)/65536);try{return W.grow(ge),K(),!0}catch{return!1}},b:J}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,se):D.then(oe=>oe.arrayBuffer()).then(oe=>WebAssembly.instantiate(oe,se))).then(oe=>{const{Rb:te,Qb:de,P:ge,T:Te,X:Ve,Ja:Oe,La:Ne,Qa:st,Va:ke,Wa:et,eb:ct,jb:dt,f:xt,e:Rt,yb:It,zb:Et,Ab:en,Bb:dn,Db:Ht,Gb:Vn}=oe.instance.exports;W=Rt;const Rn=(()=>{let xn=0,hn=0,si=0,Nn=0;return qn=>{si&&(te(Nn),te(xn),hn+=si,si=xn=0),xn||(hn+=128,xn=de(hn));const Pi=qn.length+7&-8;let zi=xn;Pi>=hn&&(si=Pi,zi=Nn=de(Pi));for(let Ui=0;Ui<qn.length;Ui++)B[zi+Ui]=qn[Ui];return zi}})();return K(),xt(),{memory:Rt,_free:te,_malloc:de,Mesh:class{constructor(){this.ptr=ge()}destroy(){Te(this.ptr)}},Decoder:class{constructor(){this.ptr=Oe()}destroy(){dt(this.ptr)}DecodeArrayToMesh(xn,hn,si){const Nn=Rn(xn),qn=Ne(this.ptr,Nn,hn,si.ptr);return!!Ve(qn)}GetAttributeByUniqueId(xn,hn){return{ptr:st(this.ptr,xn.ptr,hn)}}GetTrianglesUInt16Array(xn,hn,si){ke(this.ptr,xn.ptr,hn,si)}GetTrianglesUInt32Array(xn,hn,si){et(this.ptr,xn.ptr,hn,si)}GetAttributeDataArrayForAllPoints(xn,hn,si,Nn,qn){ct(this.ptr,xn.ptr,hn.ptr,si,Nn,qn)}},DT_INT8:It(),DT_UINT8:Et(),DT_INT16:en(),DT_UINT16:dn(),DT_UINT32:Ht(),DT_FLOAT32:Vn()}})}(fetch(pV())),xC.then(D=>{zh=D,xC=void 0}))}()),U&&b.push(function(){if(xI)return;const D=function(B){let W;const K=WebAssembly.instantiateStreaming(B,{}).then(oe=>{W=oe.instance,W.exports.__wasm_call_ctors()}),J={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(oe,te,de,ge,Te,Ve){(function(Oe,Ne,st,ke,et,ct,dt){const xt=Oe.exports.sbrk,Rt=ke+3&-4,It=xt(Rt*et),Et=xt(ct.length),en=new Uint8Array(Oe.exports.memory.buffer);en.set(ct,Et);const dn=Ne(It,ke,et,Et,ct.length);if(dn===0&&dt&&dt(It,Rt,et),st.set(en.subarray(It,It+ke*et)),xt(It-xt(0)),dn!==0)throw new Error(`Malformed buffer data: ${dn}`)})(W,W.exports[se[Te]],oe,te,de,ge,W.exports[J[Ve]])}}}(fetch(mV()));return D.ready.then(()=>{xI=D})}()),m)for(let D=0;D<m.length;D++)b.push(Lte(m[D],p,D,u));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(O&&x)for(const{primitives:D}of x)for(const B of D)Ite(B,p);if(U&&x&&k)for(const D of k)Dte(D,p);return p})})}function oy(d,a){const u=d.json.bufferViews[a.bufferView],p=rE[a.componentType];return new p(d.buffers[u.buffer],(a.byteOffset||0)+(u.byteOffset||0),a.count*(u.byteStride&&u.byteStride!==wC[a.type]*p.BYTES_PER_ELEMENT?u.byteStride/p.BYTES_PER_ELEMENT:wC[a.type]))}function CI(d,a,u,p){const _=rE[a.componentType],m=function(b){switch(b){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),x=d.json.bufferViews[a.bufferView],R=x.byteStride?x.byteStride/_.BYTES_PER_ELEMENT:wC[a.type],k=u.float32,V=k.length/u.capacity;for(let b=0,O=0;b<a.count*R;b+=R,O+=V)for(let U=0;U<V;U++)k[O+U]=p[b+U]*m;u._trim()}function Ote(d,a,u){const p=d.indices,_=d.attributes,m={};m.indexArray=new ss;const x=a.json.accessors[p],R=x.count/3;m.indexArray.reserve(R);const k=oy(a,x);for(let U=0;U<R;U++)m.indexArray.emplaceBack(k[3*U],k[3*U+1],k[3*U+2]);m.indexArray._trim(),m.vertexArray=new Mo;const V=a.json.accessors[_.POSITION];m.vertexArray.reserve(V.count);const b=oy(a,V);for(let U=0;U<V.count;U++)m.vertexArray.emplaceBack(b[3*U],b[3*U+1],b[3*U+2]);if(m.vertexArray._trim(),m.aabb=new Ir(V.min,V.max),m.centroid=function(U,D){const B=[0,0,0],W=U.length;if(W>0){for(let K=0;K<W;K++){const J=3*U[K];B[0]+=D[J],B[1]+=D[J+1],B[2]+=D[J+2]}B[0]/=W,B[1]/=W,B[2]/=W}return B}(k,b),_.COLOR_0!==void 0){const U=a.json.accessors[_.COLOR_0],D=wC[U.type],B=oy(a,U);m.colorArray=D===3?new Mo:new pa,m.colorArray.resize(U.count),CI(a,U,m.colorArray,B)}if(_.NORMAL!==void 0){m.normalArray=new Mo;const U=a.json.accessors[_.NORMAL];m.normalArray.resize(U.count);const D=oy(a,U);CI(a,U,m.normalArray,D)}if(_.TEXCOORD_0!==void 0&&u.length>0){m.texcoordArray=new Nl;const U=a.json.accessors[_.TEXCOORD_0];m.texcoordArray.resize(U.count);const D=oy(a,U);CI(a,U,m.texcoordArray,D)}if(_._FEATURE_ID_RGBA4444!==void 0){const U=a.json.accessors[_._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=oy(a,U))}_._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(oy(a,a.json.accessors[_._FEATURE_RGBA4444]).buffer));const O=d.material;return m.material=function(U,D){const{emissiveFactor:B=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:K=.5,normalTexture:J,occlusionTexture:se,emissiveTexture:oe,doubleSided:te}=U,{baseColorFactor:de=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:Te=1,baseColorTexture:Ve,metallicRoughnessTexture:Oe}=U.pbrMetallicRoughness||{},Ne=se?D[se.index]:void 0;if(se&&se.extensions&&se.extensions.KHR_texture_transform&&Ne){const st=se.extensions.KHR_texture_transform;Ne.offsetScale=[st.offset[0],st.offset[1],st.scale[0],st.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Mr(...de),metallicFactor:ge,roughnessFactor:Te,baseColorTexture:Ve?D[Ve.index]:void 0,metallicRoughnessTexture:Oe?D[Oe.index]:void 0},doubleSided:te,emissiveFactor:B,alphaMode:W,alphaCutoff:K,normalTexture:J?D[J.index]:void 0,occlusionTexture:Ne,emissionTexture:oe?D[oe.index]:void 0,defined:U.defined===void 0}}(O!==void 0?a.json.materials[O]:{defined:!1},u),m}function CV(d,a,u){const{matrix:p,rotation:_,translation:m,scale:x,mesh:R,extras:k,children:V}=d,b={};if(b.matrix=p||Re.mat4.fromRotationTranslationScale([],_||[0,0,0,1],m||[0,0,0],x||[1,1,1]),R!==void 0){b.meshes=u[R];const O=b.anchor=[0,0];for(const U of b.meshes){const{min:D,max:B}=U.aabb;O[0]+=D[0]+B[0],O[1]+=D[1]+B[1]}O[0]=Math.floor(O[0]/b.meshes.length/2),O[1]=Math.floor(O[1]/b.meshes.length/2)}if(k&&(k.id&&(b.id=k.id),k.lights&&(b.lights=function(O){if(!O.length)return[];const U=function(J){const se=atob(J),oe=new Uint8Array(se.length);for(let te=0;te<se.length;te++)oe[te]=se.codePointAt(te);return oe}(O),D=[],B=U.length/24,W=new Uint16Array(U.buffer),K=new Float32Array(U.buffer);for(let J=0;J<B;J++){const se=W[2*J*6]/30,oe=W[2*J*6+1]/30,te=W[2*J*6+10]/100,de=K[6*J+1],ge=K[6*J+2],Te=K[6*J+3],Ve=K[6*J+4],Oe=Te-de,Ne=Ve-ge,st=Math.hypot(Oe,Ne);D.push({pos:[de+.5*Oe,ge+.5*Ne,oe],normal:[Ne/st,-Oe/st,0],width:st,height:se,depth:te,points:[de,ge,Te,Ve]})}return D}(k.lights))),V){const O=[];for(const U of V)O.push(CV(a.json.nodes[U],a,u));b.children=O}return b}function kte(d){if(d.vertices.length===0||d.indices.length===0)return null;const a=new PP(d.vertices,d.indices,8,256),[u,p]=[a.min.clone(),a.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:a,min:u,max:p}}function Nte(d){if(!d.extras||!d.extras.ground)return null;const a=d.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const u=a[0];if(!u||!Array.isArray(u)||u.length===0)return null;const p=[];for(const x of u){if(!Array.isArray(x)||x.length!==2)continue;const R=x[0],k=x[1];typeof R=="number"&&typeof k=="number"&&p.push(new _e(R,k))}if(p.length<3)return null;p.length>1&&p[p.length-1].equals(p[0])&&p.pop();let _=0;for(let x=0;x<p.length;x++){const R=p[x],k=p[(x+1)%p.length],V=p[(x+2)%p.length];_+=(R.x-k.x)*(V.y-k.y)-(V.x-k.x)*(R.y-k.y)}_>0&&p.reverse();const m=$w(p.flatMap(x=>[x.x,x.y]),[]);return m.length===0?null:{vertices:p,indices:m}}function Bte(d,a){const u=[],p=[];let _=0;const m=[];for(const x of d){_=u.length;const R=x.vertexArray.float32,k=x.indexArray.uint16;for(let V=0;V<x.vertexArray.length;V++)m[0]=R[3*V+0],m[1]=R[3*V+1],m[2]=R[3*V+2],Re.vec3.transformMat4(m,m,a),u.push(new _e(m[0],m[1]));for(let V=0;V<3*x.indexArray.length;V++)p.push(k[V]+_)}if(p.length%3!=0)return null;for(let x=0;x<p.length;x+=3){const R=u[p[x+0]],k=u[p[x+1]],V=u[p[x+2]];(R.x-k.x)*(V.y-k.y)-(V.x-k.x)*(R.y-k.y)>0&&([p[x+1],p[x+2]]=[p[x+2],p[x+1]])}return{vertices:u,indices:p}}function SV(d){const a=function(k,V){const b=[],O=WebGL2RenderingContext;if(k.json.textures)for(const U of k.json.textures){const D={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};U.sampler!==void 0&&Object.assign(D,k.json.samplers[U.sampler]),b.push({image:V[U.source],sampler:D,uploaded:!1})}return b}(d,d.images),u=function(k,V){const b=[];for(const O of k.json.meshes){const U=[];for(const D of O.primitives)U.push(Ote(D,k,V));b.push(U)}return b}(d,a),{scenes:p,scene:_,nodes:m}=d.json,x=p?p[_||0].nodes:m,R=[];for(const k of x)R.push(CV(m[k],d,u));return function(k,V,b){const O={},U=new Set;for(let D=0;D<k.length;D++){const B=b[V[D]];if(!B.extras)continue;const W=B.extras["mapbox:footprint:version"],K=B.extras["mapbox:footprint:id"];(W||K)&&U.add(D),W==="1.0.0"&&K&&(O[K]=D)}for(let D=0;D<k.length;D++){if(U.has(D))continue;const B=k[D],W=b[V[D]];if(!W.extras)continue;let K=null;B.id in O&&(K=Bte(k[O[B.id]].meshes,B.matrix)),K||(K=Nte(W)),K&&(B.footprint=kte(K))}if(U.size>0){const D=Array.from(U.values()).sort((B,W)=>B-W);for(let B=D.length-1;B>=0;B--)k.splice(D[B],1)}}(R,x,d.json.nodes),R}function zte(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const a=d.vertexArray.float32,u=d.aabb.min[0]-1,p=d.aabb.min[1]-1,_=ry/(d.aabb.max[0]-u+2),m=ry/(d.aabb.max[1]-p+2);for(let x=0;x<a.length;x+=3){const R=a[x+2],k=(a[x+0]-u)*_|0,V=(a[x+1]-p)*m|0;R>d.heightmap[V*ry+k]&&(d.heightmap[V*ry+k]=R)}}function Ute(d,a){const u={};u.indexArray=new ss,u.indexArray.reserve(4*d.length),u.vertexArray=new Mo,u.vertexArray.reserve(10*d.length),u.colorArray=new pa,u.vertexArray.reserve(10*d.length);let p=0;for(const x of d){const R=Math.min(10,Math.max(4,1.3*x.height))*a,k=[-x.normal[1],x.normal[0],0],V=Math.min(.29,.1*x.width/x.depth),b=x.width-2*x.depth*a*(V+.01),O=Re.vec3.scaleAndAdd([],x.pos,k,b/2),U=Re.vec3.scaleAndAdd([],x.pos,k,-b/2),D=[O[0],O[1],O[2]+x.height],B=[U[0],U[1],U[2]+x.height],W=Re.vec3.scaleAndAdd([],x.normal,k,V);Re.vec3.scale(W,W,R);const K=Re.vec3.scaleAndAdd([],x.normal,k,-V);Re.vec3.scale(K,K,R),Re.vec3.add(W,O,W),Re.vec3.add(K,U,K),O[2]+=.1,U[2]+=.1,u.vertexArray.emplaceBack(W[0],W[1],W[2]),u.vertexArray.emplaceBack(K[0],K[1],K[2]),u.vertexArray.emplaceBack(O[0],O[1],O[2]),u.vertexArray.emplaceBack(U[0],U[1],U[2]),u.vertexArray.emplaceBack(D[0],D[1],D[2]),u.vertexArray.emplaceBack(B[0],B[1],B[2]),u.vertexArray.emplaceBack(O[0],O[1],O[2]),u.vertexArray.emplaceBack(U[0],U[1],U[2]),u.vertexArray.emplaceBack(W[0],W[1],W[2]),u.vertexArray.emplaceBack(K[0],K[1],K[2]);const J=b/R/2;u.colorArray.emplaceBack(-J-V,-1,J,.8),u.colorArray.emplaceBack(J+V,-1,J,.8),u.colorArray.emplaceBack(-J,0,J,1.3),u.colorArray.emplaceBack(J,0,J,1.3),u.colorArray.emplaceBack(J+V,-.8,J,.7),u.colorArray.emplaceBack(J+V,-.8,J,.7),u.colorArray.emplaceBack(0,0,J,1.3),u.colorArray.emplaceBack(0,0,J,1.3),u.colorArray.emplaceBack(J+V,-1.2,J,.8),u.colorArray.emplaceBack(J+V,-1.2,J,.8),u.indexArray.emplaceBack(6+p,4+p,8+p),u.indexArray.emplaceBack(7+p,9+p,5+p),u.indexArray.emplaceBack(0+p,1+p,2+p),u.indexArray.emplaceBack(1+p,3+p,2+p),p+=10}const _={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Mr.white,_.pbrMetallicRoughness=m,u.material=_,u.aabb=new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),u}class bV{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class EV{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Th(Mn,16,0),this.featureIndexArray=new fp,this.promoteId=u,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,u,p,_,m,x=0,R=0){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,m,x);const V=this.grid;for(let b=0;b<u.length;b++){const O=u[b],U=[1/0,1/0,-1/0,-1/0];for(let D=0;D<O.length;D++){const B=O[D];U[0]=Math.min(U[0],B.x),U[1]=Math.min(U[1],B.y),U[2]=Math.max(U[2],B.x),U[3]=Math.max(U[3],B.y)}R!==0&&(U[0]-=R,U[1]-=R,U[2]+=R,U[3]+=R),U[0]<Mn&&U[1]<Mn&&U[2]>=0&&U[3]>=0&&V.insert(k,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new u0.VectorTile(new Lb(this.rawTileData)).layers,this.sourceLayerCoder=new bV(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,u,p){this.loadVTLayers(),this.serializedLayersCache.clear();const _=xr(a.filter),m=a.tileResult,x=a.transform,R=m.bufferedTilespaceBounds,k=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(U,D,B,W)=>jr(m.bufferedTilespaceGeometry,U,D,B,W));k.sort(Vte);let V=null;x.elevation&&k.length>0&&(V=v0.create(x.elevation,this.tileID));const b={};let O;for(let U=0;U<k.length;U++){const D=k[U];if(D===O)continue;O=D;const B=this.featureIndexArray.get(D);let W=null;if(this.is3DTile){const K=this.bucketLayerIDs[0][0],J=u[K];if(J.type!=="model")continue;const{queryFeature:se,intersectionZ:oe}=J.queryIntersectsMatchingFeature(m,B.featureIndex,_,x);se&&this.appendToResult(b,K,B.featureIndex,se,oe)}else this.loadMatchingFeature(b,B,_,a.layers,a.availableImages,u,p,(K,J,se,oe=0)=>(W||(W=Ct(K,this.tileID.canonical,a.tileTransform)),J.queryIntersectsFeature(m,K,se,W,this.z,a.transform,a.pixelPosMatrix,V,oe)))}return b}loadMatchingFeature(a,u,p,_,m,x,R,k){const{featureIndex:V,bucketIndex:b,sourceLayerIndex:O,layoutVertexArrayOffset:U}=u,D=this.bucketLayerIDs[b];if(_.length&&!function(J,se){for(let oe=0;oe<J.length;oe++)if(se.indexOf(J[oe])>=0)return!0;return!1}(_,D))return;const B=this.sourceLayerCoder.decode(O),W=this.vtLayers[B].feature(V);if(p.needGeometry){const J=on(W,!0);if(!p.filter(new gs(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!p.filter(new gs(this.tileID.overscaledZ),W))return;const K=this.getId(W,B);for(let J=0;J<D.length;J++){const se=D[J];if(_.length&&_.indexOf(se)<0)continue;const oe=x[se];if(!oe)continue;let te={};K!==void 0&&R&&(te=R.getState(oe.sourceLayer||"_geojsonTileLayer",K));const de=!k||k(W,oe,te,U);if(!de)continue;const ge=new fC(W,this.z,this.x,this.y,K);let Te=this.serializedLayersCache.get(se);Te||(Te=oe.serialize(),Te.id=se,this.serializedLayersCache.set(se,Te)),ge.layer=Bn({},Te),ge.tile=this.tileID.canonical,ge.layer.paint=MV(Te.paint,oe.paint,W,te,m),ge.layer.layout=MV(Te.layout,oe.layout,W,te,m),this.appendToResult(a,se,V,ge,de)}}appendToResult(a,u,p,_,m){let x=a[u];x===void 0&&(x=a[u]=[]),x.push({featureIndex:p,feature:_,intersectionZ:m})}lookupSymbolFeatures(a,u,p,_,m,x,R){const k={};this.loadVTLayers();const V=xr(_);for(const b of a)this.loadMatchingFeature(k,{bucketIndex:u,sourceLayerIndex:p,featureIndex:b,layoutVertexArrayOffset:0},V,m,x,R);return k}loadFeature(a){const{featureIndex:u,sourceLayerIndex:p}=a;this.loadVTLayers();const _=this.sourceLayerCoder.decode(p),m=this.vtFeatures[_];if(m[u])return m[u];const x=this.vtLayers[_].feature(u);return m[u]=x,x}hasLayer(a){for(const u of this.bucketLayerIDs)for(const p of u)if(a===p)return!0;return!1}getId(a,u){let p=a.id;if(this.promoteId){const _=typeof this.promoteId=="string"?this.promoteId:this.promoteId[u];_!=null&&(p=a.properties[_]),typeof p=="boolean"&&(p=Number(p))}return p}}function MV(d,a,u,p,_){return Ti(d,(m,x)=>{const R=a instanceof Du?a.get(x):null;return R&&R.evaluate?R.evaluate(u,p,_):R})}function Vte(d,a){return a-d}Un(EV,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const RV=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class SI{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const m=RV[15&p];if(!m)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(a,2,1),[R]=new Uint32Array(a,4,1);return new SI(R,x,m,a)}constructor(a,u=64,p=Float64Array,_){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const m=RV.indexOf(this.ArrayType),x=2*a*this.ArrayType.BYTES_PER_ELEMENT,R=a*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-R%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+R+k,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+x+R+k),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+R+k,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=u,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return bI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:x,nodeSize:R}=this,k=[0,m.length-1,0],V=[];for(;k.length;){const b=k.pop()||0,O=k.pop()||0,U=k.pop()||0;if(O-U<=R){for(let K=U;K<=O;K++){const J=x[2*K],se=x[2*K+1];J>=a&&J<=p&&se>=u&&se<=_&&V.push(m[K])}continue}const D=U+O>>1,B=x[2*D],W=x[2*D+1];B>=a&&B<=p&&W>=u&&W<=_&&V.push(m[D]),(b===0?a<=B:u<=W)&&(k.push(U),k.push(D-1),k.push(1-b)),(b===0?p>=B:_>=W)&&(k.push(D+1),k.push(O),k.push(1-b))}return V}within(a,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:m,nodeSize:x}=this,R=[0,_.length-1,0],k=[],V=p*p;for(;R.length;){const b=R.pop()||0,O=R.pop()||0,U=R.pop()||0;if(O-U<=x){for(let K=U;K<=O;K++)AV(m[2*K],m[2*K+1],a,u)<=V&&k.push(_[K]);continue}const D=U+O>>1,B=m[2*D],W=m[2*D+1];AV(B,W,a,u)<=V&&k.push(_[D]),(b===0?a-p<=B:u-p<=W)&&(R.push(U),R.push(D-1),R.push(1-b)),(b===0?a+p>=B:u+p>=W)&&(R.push(D+1),R.push(O),R.push(1-b))}return k}}function bI(d,a,u,p,_,m){if(_-p<=u)return;const x=p+_>>1;TV(d,a,x,p,_,m),bI(d,a,u,p,x-1,1-m),bI(d,a,u,x+1,_,1-m)}function TV(d,a,u,p,_,m){for(;_>p;){if(_-p>600){const V=_-p+1,b=u-p+1,O=Math.log(V),U=.5*Math.exp(2*O/3),D=.5*Math.sqrt(O*U*(V-U)/V)*(b-V/2<0?-1:1);TV(d,a,u,Math.max(p,Math.floor(u-b*U/V+D)),Math.min(_,Math.floor(u+(V-b)*U/V+D)),m)}const x=a[2*u+m];let R=p,k=_;for(CC(d,a,p,u),a[2*_+m]>x&&CC(d,a,p,_);R<k;){for(CC(d,a,R,k),R++,k--;a[2*R+m]<x;)R++;for(;a[2*k+m]>x;)k--}a[2*p+m]===x?CC(d,a,p,k):(k++,CC(d,a,k,_)),k<=u&&(p=k+1),u<=k&&(_=k-1)}}function CC(d,a,u,p){EI(d,u,p),EI(a,2*u,2*p),EI(a,2*u+1,2*p+1)}function EI(d,a,u){const p=d[a];d[a]=d[u],d[u]=p}function AV(d,a,u,p){const _=d-u,m=a-p;return _*_+m*m}s.$=rp,s.A=class extends Qb{},s.B=ua,s.C=hh,s.D=Wd,s.E=xd,s.F=km,s.G=So,s.H=Om,s.I=ZP,s.J=Eh,s.K=Qc,s.L=Iu,s.M=Mh,s.N=Rd,s.O=Fa,s.P=_e,s.Q=yh,s.R=ji,s.S=eo,s.T=oI,s.U=uh,s.V=Qb,s.W=Hs,s.X=Nm,s.Y=fa,s.Z=function(d){const a=d.value;let u=[];if(!a)return u;const p=ua(a);return p!=="string"?(u=u.concat([new Qb(d.key,a,`string expected, "${p}" found`)]),u):(UU(a,!0)||(u=u.concat([new Qb(d.key,a,`invalid url "${a}"`)])),u)},s._=Tt,s.a=function(d){return je.API_CDN_URL_REGEX.test(d)},s.a$=ol,s.a0=Ur,s.a1=yn,s.a2=class{constructor(d){this.specification=d}possiblyEvaluate(d,a){return vn(d.expression.evaluate(a))}interpolate(d,a,u){return{x:Hn(d.x,a.x,u),y:Hn(d.y,a.y,u),z:Hn(d.z,a.z,u),azimuthal:Hn(d.azimuthal,a.azimuthal,u),polar:Hn(d.polar,a.polar,u)}}},s.a3=gs,s.a4=Nd,s.a5=mt,s.a6=Re,s.a7=nn,s.a8=Du,s.a9=tg,s.aA=ar,s.aB=RU,s.aC=FU,s.aD=MU,s.aE=function(d,a){const u=document.createElement("video");u.muted=!0,u.onloadstart=function(){a(null,u)};for(let p=0;p<d.length;p++){const _=document.createElement("source");tr(d[p])||(u.crossOrigin="Anonymous"),_.src=d[p],u.appendChild(_)}return{cancel:()=>{}}},s.aF=Zb,s.aG=function(d){return fetch(d).then(a=>a.arrayBuffer()).then(a=>wV(a,0,d))},s.aH=SV,s.aI=class{constructor(d,a,u,p){this.id=d,this.position=a!=null?new X(a[0],a[1]):new X(0,0),this.orientation=u??[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(d,a){if(Re.mat4.multiply(d.matrix,a,d.matrix),d.meshes)for(const u of d.meshes){const p=Ir.applyTransformFast(u.aabb,d.matrix);this.aabb.encapsulate(p)}if(d.children)for(const u of d.children)this._applyTransformations(u,d.matrix)}computeBoundsAndApplyParent(){const d=Re.mat4.identity([]);for(const a of this.nodes)this._applyTransformations(a,d)}computeModelMatrix(d,a,u,p,_,m,x=!1){jU(this.matrix,this,d.transform,this.position,a,u,p,_,m,x)}upload(d){if(!this.uploaded){for(const a of this.nodes)hI(a,d);for(const a of this.nodes)eE(a);this.uploaded=!0}}destroy(){for(const d of this.nodes)dI(d)}},s.aJ=oi,s.aK=function(d){return d.indexOf(Go)>=0},s.aL=oC,s.aM=Fe,s.aN=ze,s.aO=eu,s.aP=ss,s.aQ=Li,s.aR=Xm,s.aS=$b,s.aT=function(){ka.isLoading()||ka.isLoaded()||qv()!=="deferred"||Zv()},s.aU=xr,s.aV=on,s.aW=fC,s.aX=mi,s.aY=zP,s.aZ=AP,s.a_=Ct,s.aa=Hn,s.ab=Mn,s.ac=wd,s.ad=class{constructor(d){this.specification=d}possiblyEvaluate(d,a){return function([u,p]){const _=vn([1,u,p]);return{x:_.x,y:_.y,z:_.z}}(d.expression.evaluate(a))}interpolate(d,a,u){return{x:Hn(d.x,a.x,u),y:Hn(d.y,a.y,u),z:Hn(d.z,a.z,u)}}},s.ae=function(d,a,u=0,p=!0){const _=new _e(u,u),m=d.sub(_),x=a.add(_),R=[m,new _e(x.x,m.y),x,new _e(m.x,x.y)];return p&&R.push(m.clone()),R},s.af=function(d,a){const u=[];for(let p=0;p<d.length;p++){const _=jt(p-1,-1,d.length-1),m=jt(p+1,-1,d.length-1),x=d[p],R=d[m],k=d[_].sub(x).unit(),V=R.sub(x).unit(),b=V.angleWithSep(k.x,k.y),O=k.add(V).unit().mult(-1*a/Math.sin(b/2));u.push(x.add(O))}return u},s.ag=dU,s.ah=jr,s.ai=function(d,a,u=0){return Re.vec3.fromValues(((a.x-u)*d.scale-d.x)*Mn,(a.y*d.scale-d.y)*Mn,Ue(a.z,a.y))},s.aj=cl,s.ak=I4,s.al=function(d){let a=1/0,u=1/0,p=-1/0,_=-1/0;for(const m of d)a=Math.min(a,m.x),u=Math.min(u,m.y),p=Math.max(p,m.x),_=Math.max(_,m.y);return{min:new _e(a,u),max:new _e(p,_)}},s.am=ve,s.an=sr,s.ao=at,s.ap=yt,s.aq=rr,s.ar=function(d,a){const u={};for(let p=0;p<a.length;p++){const _=a[p];_ in d&&(u[_]=d[_])}return u},s.as=ee,s.at=be,s.au=class{constructor(d){this.entries={},this.scheduler=d}request(d,a,u,p){const _=this.entries[d]=this.entries[d]||{callbacks:[]};if(_.result){const[m,x]=_.result;return this.scheduler?this.scheduler.add(()=>{p(m,x)},a):p(m,x),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=u((m,x)=>{_.result=[m,x];for(const R of _.callbacks)this.scheduler?this.scheduler.add(()=>{R(m,x)},a):R(m,x);setTimeout(()=>delete this.entries[d],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(m=>m!==p),_.callbacks.length||(_.cancel(),delete this.entries[d]))}}},s.av=Zd,s.aw=function(d,a,u){const p=JSON.stringify(d.request);return d.data&&(this.deduped.entries[p]={result:[null,d.data]}),this.deduped.request(p,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},_=>{const m=fs(d.request,(x,R,k,V)=>{x?_(x):R&&_(null,{vectorTile:u?void 0:new u0.VectorTile(new Lb(R)),rawData:R,cacheControl:k,expires:V})});return()=>{m.cancel(),_()}},a)},s.ax=function(d){Dn++,Dn>Be&&(d.getActor().send("enforceCacheSizeLimit",Mi),Dn=0)},s.ay=fn,s.az=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log(d)/Math.LN2))},s.b=function(d){return je.API_FONTS_REGEX.test(d)},s.b$=ul,s.b0=Jv,s.b1=Bu,s.b2=Is,s.b3=$w,s.b4=iI,s.b5=function(d,a){const u=tg(a.zoom);if(u===0)return tf(d);const p=xb(d),_=xP(p),m=ve(p.getWest())*a.worldSize,x=ve(p.getEast())*a.worldSize,R=be(p.getNorth())*a.worldSize,k=be(p.getSouth())*a.worldSize,V=[m,R,0],b=[x,R,0],O=[m,k,0],U=[x,k,0],D=Re.mat4.invert([],a.globeMatrix);return Re.vec3.transformMat4(V,V,D),Re.vec3.transformMat4(b,b,D),Re.vec3.transformMat4(O,O,D),Re.vec3.transformMat4(U,U,D),_[0]=gp(_[0],O,u),_[1]=gp(_[1],U,u),_[2]=gp(_[2],b,u),_[3]=gp(_[3],V,u),Ir.fromPoints(_)},s.b6=Cb,s.b7=Ww,s.b8=gp,s.b9=Xd,s.bA=Mr,s.bB=jt,s.bC=xe,s.bD=Xi,s.bE=Ce,s.bF=function(d,a,u){d[4*a+0]=u[0],d[4*a+1]=u[1],d[4*a+2]=u[2],d[4*a+3]=u[3]},s.bG=Kn,s.bH=me,s.bI=Ae,s.bJ=ne,s.bK=Z,s.bL=X,s.bM=vU,s.bN=mr,s.bO=Sc,s.bP=OU,s.bQ=To,s.bR=wz,s.bS=function(d,a,u,p,_,m,x,R,k){if(k.name==="globe")return wz(d,a,new To(u,p,_),!1);const V=oC({z:u,x:p,y:_},k);return new Ir([(m+V.x/V.scale)*a,a*(V.y/V.scale),x],[(m+V.x2/V.scale)*a,a*(V.y2/V.scale),R])},s.bT=function(d,a,u){let p=0;for(let _=0;_<2;++_)d[_]>0&&(p+=(d[_]-0)*(d[_]-0)),a[_]<0&&(p+=(0-a[_])*(0-a[_]));return p},s.bU=Ze,s.bV=g,s.bW=function(d){const a=Re.mat4.identity(new Float64Array(16));Re.mat4.multiply(a,d.pixelMatrix,d.globeMatrix);const u=[0,S,0],p=[0,E,0];return Re.vec3.transformMat4(u,u,a),Re.vec3.transformMat4(p,p,a),[u[0]>0&&u[0]<=d.width&&u[1]>0&&u[1]<=d.height&&!SP(d,new X(d.center.lat,90)),p[0]>0&&p[0]<=d.width&&p[1]>0&&p[1]<=d.height&&!SP(d,new X(d.center.lat,-90))]},s.bX=function(d,a){const{scale:u}=d.tileTransform,p=u*Mn/(d.tileSize*Math.pow(2,a.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return Re.mat2.scale(new Float32Array(4),a.inverseAdjustmentMatrix,[p,p])},s.bY=Yb,s.bZ=LU,s.b_=function(d){const a=LU(d,!0);return Re.mat2.invert([],[a[0],a[1],a[4],a[5]])},s.ba=Wo,s.bb=vI,s.bc=Lb,s.bd=fs,s.be=function(d){const a=[];for(const u in d)a.push(d[u]);return a},s.bf=function(d,a){const u=[];for(const p in d)p in a||u.push(p);return u},s.bg=Fn,s.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bi=At,s.bj=function(d,a){const{x:u,y:p}=d.point,_=bz(u,p,d.worldSize/d._pixelsPerMercatorPixel,0,0);return Re.mat4.multiply(_,_,wP(tf(a)))},s.bk=h0,s.bl=su,s.bm=Fb,s.bn=function(d,a,u,p,_){const m=5*a+2;d.float32[m+0]=u,d.float32[m+1]=p,d.float32[m+2]=_},s.bo=jb,s.bp=tU,s.bq=sn,s.br=wa,s.bs=i4,s.bt=zU,s.bu=l4,s.bv=c4,s.bw=YP,s.bx=lU,s.by=qP,s.bz=SI,s.c=nt,s.c$=Xr,s.c0=function(d){const{x:a,y:u}=d.point,{lng:p,lat:_}=d._center;return bz(a,u,d.worldSize,p,_)},s.c1=Se,s.c2=Er,s.c3=iu,s.c4=function(d){const a=Math.round((d+45+360)%360/90)%4;return it[a]},s.c5=45,s.c6=ye,s.c7=_t,s.c8=function(d,a,u){const p=Math.sqrt(d*d+a*a+u*u),_=p>0?Math.acos(u/p)*tn:0;let m=d!==0||a!==0?Math.atan2(-a,-d)*tn+90:0;return m<0&&(m+=360),[p,m,_]},s.c9=ot,s.cA=function(d){const a=Ze-5;d=yt(d,-a,a)/a*90;const u=Math.pow(Math.abs(Math.sin(xe(d))),3);return Math.round(u*(y.length-1))},s.cB=function(d,a,u,p){const _=a.getNorth(),m=a.getSouth(),x=a.getWest(),R=a.getEast(),k=1<<d.z,V=R-x,b=_-m,O=V/h,U=-b/y[u],D=[0,O,0,U,0,0,_,x,0];if(d.z>0){const B=180/p;Re.mat3.multiply(D,D,[B/V+1,0,0,0,B/b+1,0,-.5*B/O,.5*B/U,1])}return D[2]=k,D[5]=d.x,D[8]=d.y,D},s.cC=tf,s.cD=function(d,a,u){const p=Re.mat4.identity(new Float64Array(16)),_=(a/(1<<d)-.5)*Math.PI*2;return Re.mat4.rotateY(p,u.globeMatrix,_),Float32Array.from(p)},s.cE=class{isDataAvailableAtPoint(d){const a=this._source();if(this.isUsingMockSource()||!a||d.y<0||d.y>1)return!1;const u=a.getSource().maxzoom,p=1<<u,_=Math.floor(d.x),m=Math.floor((d.x-_)*p),x=Math.floor(d.y*p),R=this.findDEMTileFor(new ar(u,_,u,m,x));return!(!R||!R.dem)}getAtPointOrZero(d,a=0){return this.getAtPoint(d,a)||0}getAtPoint(d,a,u=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const p=this._source();if(!p||d.y<0||d.y>1)return a;const _=p.getSource().maxzoom,m=1<<_,x=Math.floor(d.x),R=d.x-x,k=new ar(_,x,_,Math.floor(R*m),Math.floor(d.y*m)),V=this.findDEMTileFor(k);if(!V||!V.dem)return a;const b=V.dem,O=1<<V.tileID.canonical.z,U=(R*O-V.tileID.canonical.x)*b.dim,D=(d.y*O-V.tileID.canonical.y)*b.dim,B=Math.floor(U),W=Math.floor(D);return(u?this.exaggeration():1)*Hn(Hn(b.get(B,W),b.get(B,W+1),D-W),Hn(b.get(B+1,W),b.get(B+1,W+1),D-W),U-B)}getAtTileOffset(d,a,u){const p=1<<d.canonical.z;return this.getAtPointOrZero(new mt(d.wrap+(d.canonical.x+a/Mn)/p,(d.canonical.y+u/Mn)/p))}getAtTileOffsetFunc(d,a,u,p){return _=>{const m=this.getAtTileOffset(d,_.x,_.y),x=p.upVector(d.canonical,_.x,_.y),R=p.upVectorScale(d.canonical,a,u).metersToTile;return Re.vec3.scale(x,x,m*R),x}}getForTilePoints(d,a,u,p){if(this.isUsingMockSource())return!1;const _=v0.create(this,d,p);return!!_&&(a.forEach(m=>{m[2]=this.exaggeration()*_.getElevationAt(m[0],m[1],u)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(d);if(!a||!a.dem)return null;const u=a.dem.tree,p=a.tileID,_=1<<d.canonical.z-p.canonical.z;let m=d.canonical.x/_-p.canonical.x,x=d.canonical.y/_-p.canonical.y,R=0;for(let k=0;k<d.canonical.z-p.canonical.z&&!u.leaves[R];k++){m*=2,x*=2;const V=2*Math.floor(x)+Math.floor(m);R=u.childOffsets[R]+V,m%=1,x%=1}return{min:this.exaggeration()*u.minimums[R],max:this.exaggeration()*u.maximums[R]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,a,u){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(d.length===0)return null;let a=!1,u=Number.MAX_VALUE,p=Number.MIN_VALUE;for(const _ of d){const m=this.getMinMaxForTile(_.tileID);m&&(u=Math.min(u,m.min),p=Math.max(p,m.max),a=!0)}return a?{min:u,max:p}:null}},s.cF=Nz,s.cG=Qm,s.cH=function(d,a){return[Math.pow(d[0],2.2)*a,Math.pow(d[1],2.2)*a,Math.pow(d[2],2.2)*a]},s.cI=Sz,s.cJ=Ie,s.cK=we,s.cL=256,s.cM=function(d,a){const u=[0,0,0],p=Cb(tf(a.canonical));return Re.vec3.transformMat4(u,u,p),Re.vec3.transformMat4(u,u,d),u},s.cN=d=>({u_camera_to_center_distance:new ne(d),u_extrude_scale:new Gi(d),u_device_pixel_ratio:new ne(d),u_matrix:new Kn(d),u_inv_rot_matrix:new Kn(d),u_merc_center:new me(d),u_tile_id:new Ae(d),u_zoom_transition:new ne(d),u_up_dir:new Ae(d),u_emissive_strength:new ne(d)}),s.cO=d=>({u_matrix:new Kn(d),u_pixels_to_tile_units:new Gi(d),u_device_pixel_ratio:new ne(d),u_units_to_pixels:new me(d),u_dash_image:new Z(d),u_gradient_image:new Z(d),u_image_height:new ne(d),u_texsize:new me(d),u_tile_units_to_pixels:new ne(d),u_alpha_discard_threshold:new ne(d),u_trim_offset:new me(d),u_trim_fade_range:new me(d),u_trim_color:new _t(d),u_emissive_strength:new ne(d),u_zbias_factor:new ne(d),u_tile_to_meter:new ne(d)}),s.cP=d=>({u_matrix:new Kn(d),u_texsize:new me(d),u_pixels_to_tile_units:new Gi(d),u_device_pixel_ratio:new ne(d),u_image:new Z(d),u_units_to_pixels:new me(d),u_tile_units_to_pixels:new ne(d),u_alpha_discard_threshold:new ne(d),u_trim_offset:new me(d),u_emissive_strength:new ne(d),u_zbias_factor:new ne(d),u_tile_to_meter:new ne(d)}),s.cQ=ku,s.cR=cee,s.cS=uee,s.cT=Rz,s.cU=(d,a,u,p,_,m)=>{const x=d.transform,R=x.projection.name==="globe";let k;if(m.paint.get("circle-pitch-alignment")==="map")if(R){const b=Sz(x.zoom,a.canonical)*x._pixelsPerMercatorPixel;k=Float32Array.from([b,0,0,b])}else k=x.calculatePixelsToTileUnitsMatrix(u);else k=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const V={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(x.projection),u_matrix:d.translatePosMatrix(a.projMatrix,u,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:In.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:fQ,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(R){V.u_inv_rot_matrix=p,V.u_merc_center=_,V.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],V.u_zoom_transition=tg(x.zoom);const b=_[0]*Mn,O=_[1]*Mn;V.u_up_dir=x.projection.upVector(new To(0,0,0),b,O)}return V},s.cV=O4,s.cW=(d,a,u,p,_,m)=>{const x=d.transform,R=x.pitch<15?D4(.07,.7,yt((14-x.zoom)/5,0,1)):.07;return{u_matrix:L4(d,a,u,p),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:F4(a,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m,u_emissive_strength:u.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:ot(a.tileID.canonical,0)}},s.cX=(d,a,u,p,_,m,x)=>{const R=d.transform,k=R.calculatePixelsToTileUnitsMatrix(a),V=R.pitch<15?D4(.07,.7,yt((14-R.zoom)/5,0,1)):.07;return{u_matrix:L4(d,a,u,p),u_pixels_to_tile_units:k,u_device_pixel_ratio:m,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:k4(u)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:F4(a,d.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:u.paint.get("line-trim-fade-range"),u_trim_color:u.paint.get("line-trim-color").toRenderColor(u.lut).toArray01(),u_emissive_strength:u.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:ot(a.tileID.canonical,0)}},s.cY=zn,s.cZ=jw,s.c_=C4,s.ca=Ir,s.cb=vn,s.cc=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},s.cd=function(d){return d({pluginStatus:bo,pluginURL:Oa}),$v.on("pluginStateChange",d),d},s.ce=y0,s.cf=iE,s.cg=f0,s.ch=XP,s.ci=wr,s.cj=Hm,s.ck=Ci,s.cl=Qo,s.cm=Ji,s.cn=function(d){const a=d.indexOf(Go);return a>=0?d.slice(0,a):d},s.co=function(d){const a=d.indexOf(Go);return a>=0?d.slice(a+1):""},s.cp=function(d){const a=[],u=d.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),d.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},s.cq=function(d,a,u,p){return d.type==="custom"?new Vee(d,a):new Qee[d.type](d,a,u,p)},s.cr=pi,s.cs=$v,s.ct=fi,s.cu=Jt,s.cv=class extends A{constructor(d){super(d),this.current=Ai}set(d,a,u){if(this.fetchUniformLocation(d,a)){for(let p=0;p<9;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}}},s.cw=Le,s.cx=function(d,a,u){const p=tg(u.zoom),_=d.style.map._antialias,m=a.options.extStandardDerivativesForceOff||d.terrain&&d.terrain.exaggeration()>0;return p===0&&!_&&!m},s.cy=function(d){const a=d.pixelsPerMeter,u=a/Ce(1,d.center.lat),p=Re.mat4.identity(new Float64Array(16));return Re.mat4.translate(p,p,[d.point.x,d.point.y,0]),Re.mat4.scale(p,p,[u,u,a]),Float32Array.from(p)},s.cz=xb,s.d=function(d){return je.API_TILEJSON_REGEX.test(d)},s.d$=f,s.d0=Db,s.d1=ig,s.d2=450,s.d3=7,s.d4=Uee,s.d5=Qi,s.d6=Zm,s.d7=256,s.d8=wP,s.d9=Mo,s.dA=Ez,s.dB=function(d){const a=[0,0,0],u=Re.mat4.identity(new Float64Array(16));return Re.mat4.multiply(u,d.pixelMatrix,d.globeMatrix),Re.vec3.transformMat4(a,a,u),new _e(a[0],a[1])},s.dC=function(d,a,u=!1){if(bo===Gm||bo===zd||bo===Ud)throw new Error("setRTLTextPlugin cannot be called multiple times.");Oa=In.resolveURL(d),bo=Gm,Vd=a,Gd(),u||Zv()},s.dD=qv,s.dE=function(){iE().acquire(yI)},s.dF=function(){const d=_C;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(yI),_C=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dG=yC,s.dH=function(d){const a=Lt();if(!a)return;const u=a.delete(Ri);d&&u.catch(d).then(()=>d())},s.dI=vC,s.dJ=pV,s.dK=function(d){_I=In.resolveURL(d),w0||(w0=new y0(iE(),new xd)),w0.broadcast("setDracoUrl",_I)},s.dL=mV,s.dM=function(d){x0=In.resolveURL(d),w0||(w0=new y0(iE(),new xd)),w0.broadcast("setMeshoptUrl",x0)},s.dN=Un,s.dO=ng,s.dP=kh,s.dQ=bV,s.dR=EV,s.dS=T4,s.dT=Ti,s.dU=iU,s.dV=function(d,a,u,p,_,m,x,R,k,V,b=1,O){d.createArrays(),d.tilePixelRatio=Mn/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const U=d.layers[0].layout,D=d.layers[0]._unevaluatedLayout._values,B={};if(B.scaleFactor=b,B.textSizeScaleRange=U.get("text-size-scale-range"),B.iconSizeScaleRange=U.get("icon-size-scale-range"),B.textScaleFactor=yt(B.scaleFactor,B.textSizeScaleRange[0],B.textSizeScaleRange[1]),B.iconScaleFactor=yt(B.scaleFactor,B.iconSizeScaleRange[0],B.iconSizeScaleRange[1]),d.textSizeData.kind==="composite"){const{minZoom:se,maxZoom:oe}=d.textSizeData;B.compositeTextSizes=[D["text-size"].possiblyEvaluate(new gs(se),R),D["text-size"].possiblyEvaluate(new gs(oe),R)]}if(d.iconSizeData.kind==="composite"){const{minZoom:se,maxZoom:oe}=d.iconSizeData;B.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new gs(se),R),D["icon-size"].possiblyEvaluate(new gs(oe),R)]}B.layoutTextSize=D["text-size"].possiblyEvaluate(new gs(k+1),R),B.layoutIconSize=D["icon-size"].possiblyEvaluate(new gs(k+1),R),B.textMaxSize=D["text-size"].possiblyEvaluate(new gs(18),R);const W=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",K=U.get("text-size");let J=!1;for(const se of d.features)if(se.icon&&se.icon.nameSecondary){J=!0;break}for(const se of d.features){const oe=U.get("text-font").evaluate(se,{},R).join(","),te=K.evaluate(se,{},R)*B.textScaleFactor,de=B.layoutTextSize.evaluate(se,{},R)*B.textScaleFactor,ge=(B.layoutIconSize.evaluate(se,{},R),{horizontal:{},vertical:void 0}),Te=se.text;let Ve,Oe=[0,0];if(Te){const ke=Te.toString(),et=U.get("text-letter-spacing").evaluate(se,{},R)*wa,ct=U.get("text-line-height").evaluate(se,{},R)*wa,dt=n0(ke)?et:0,xt=U.get("text-anchor").evaluate(se,{},R),Rt=U.get("text-variable-anchor");if(!Rt){const Ht=U.get("text-radial-offset").evaluate(se,{},R);Oe=Ht?lU(xt,[Ht*wa,KP]):U.get("text-offset").evaluate(se,{},R).map(Vn=>Vn*wa)}let It=W?"center":U.get("text-justify").evaluate(se,{},R);const Et=U.get("symbol-placement")==="point",en=Et?U.get("text-max-width").evaluate(se,{},R)*wa:1/0,dn=Ht=>{d.allowVerticalPlacement&&Vm(ke)&&(ge.vertical=$P(Te,a,u,_,oe,en,ct,xt,Ht,dt,Oe,su.vertical,!0,de,te))};if(!W&&Rt){const Ht=It==="auto"?Rt.map(Rn=>YP(Rn)):[It];let Vn=!1;for(let Rn=0;Rn<Ht.length;Rn++){const xn=Ht[Rn];if(!ge.horizontal[xn])if(Vn)ge.horizontal[xn]=ge.horizontal[0];else{const hn=$P(Te,a,u,_,oe,en,ct,"center",xn,dt,Oe,su.horizontal,!1,de,te);hn&&(ge.horizontal[xn]=hn,Vn=hn.positionedLines.length===1)}}dn("left")}else{if(It==="auto"&&(It=YP(xt)),Et||U.get("text-writing-mode").indexOf("horizontal")>=0||!Vm(ke)){const Ht=$P(Te,a,u,_,oe,en,ct,xt,It,dt,Oe,su.horizontal,!1,de,te);Ht&&(ge.horizontal[It]=Ht)}dn(Et?"left":It)}}let Ne=!1;if(se.icon&&se.icon.namePrimary){const ke=p[se.icon.namePrimary];ke&&(Ve=xee(_[se.icon.namePrimary],se.icon.nameSecondary?_[se.icon.nameSecondary]:void 0,U.get("icon-offset").evaluate(se,{},R),U.get("icon-anchor").evaluate(se,{},R)),Ne=ke.sdf,d.sdfIcons===void 0?d.sdfIcons=ke.sdf:d.sdfIcons!==ke.sdf&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==d.pixelRatio||U.get("icon-rotate").constantOr(1)!==0)&&(d.iconsNeedLinear=!0))}const st=uU(ge.horizontal)||ge.vertical;d.iconsInText||(d.iconsInText=!!st&&st.iconsInText),(st||Ve)&&Ree(d,se,ge,Ve,p,B,de,0,Oe,Ne,x,R,V,O,J)}m&&d.generateCollisionDebugBuffers(k,d.collisionBoxArray,B.textScaleFactor)},s.dW=u0,s.dX=nE,s.dY=Dt,s.dZ=Qz,s.d_=G4,s.da=Dh,s.db=Kv,s.dc=function(d,a,u,p,_){return yt((d-a)/(u-a)*(_-p)+p,p,_)},s.dd=Jf,s.de=Xe,s.df=class{constructor(d,a,u,p){this.context=d,this.format=p,this.size=u,this.texture=d.gl.createTexture();const[_,m,x]=this.size,{gl:R}=d;R.bindTexture(R.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),R.texImage3D(R.TEXTURE_3D,0,this.format,_,m,x,0,rI(this.format),sI(this.format),a.data)}bind(d,a){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_3D,this.texture),d!==this.minFilter&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MAG_FILTER,d),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MIN_FILTER,d),this.minFilter=d),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},s.dg=cI,s.dh=[1,1,1],s.di=v0,s.dj=g0,s.dk=xa,s.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _e(1/0,1/0),max:new _e(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,a=!1){const u=s4(new _e(0,0),new _e(Mn,Mn),d),p=[];if(a&&!LP(u,this._globalClipBounds))return p;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!LP(u,_))continue;const m=kQ(_.min,_.max,d);p.push({min:m.min,max:m.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return p}setSources(d){this._setSources(d.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const u=[];for(const p of a.cache.getVisibleCoordinates()){const _=a.cache.getTile(p).buckets[a.layer];_&&_.updateFootprints(p.toUnwrapped(),u)}return u},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(d){const a=d.getFootprints();if(a.length===0)return;const u=d.getOrder(),p=d.getClipMask(),_=d.getClipScope();for(const m of a){if(!m.footprint)continue;const x=s4(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:u,clipMask:p,clipScope:_})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,u)=>a.priority-u.priority||Pb(a.min,u.min)||Pb(a.max,u.max)||a.order-u.order||a.clipMask-u.clipMask||function(p,_){const m=(x,R)=>x+R;return p.length-_.length||p.reduce(m,"").localeCompare(_.reduce(m,""))}(a.clipScope,u.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let a=0;for(;!d&&a!==this._activeRegions.length;){const u=this._activeRegions[a],p=this._prevRegions[a];d=u.priority!==p.priority||!r4(u,p)||u.order!==p.order||u.clipMask!==p.clipMask||!At(u.clipScope,p.clipScope),++a}}if(d){++this._updateTime;for(const u of this._activeRegions)u.order!==Ab&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,u.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,u.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,u.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,u.max.y));const a=u=>{const p=this._activeRegions;if(u>=p.length)return u;const _=p[u].priority;for(;u<p.length&&p[u].priority===_;)++u;return u};if(this._sourceIds.length>1){let u=0,p=a(u);for(;u!==p;){let _=u;const m=u;for(;_!==p;){const x=this._activeRegions[_];x.hiddenByOverlap=!1;for(let R=0;R<m;R++){const k=this._activeRegions[R];if(!k.hiddenByOverlap&&x.order===Ab&&LP(x,k)&&(x.hiddenByOverlap=a4(x.footprint,x.tileId,k.footprint,k.tileId),x.hiddenByOverlap))break}++_}u=p,p=a(u)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=d.length-1;a>=0;a--)this._addSource(d[a]);this._computeReplacement()}},s.dm=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,a){const u=new ol,p=new ss,_=[],m=d+1+2,x=a[0]+1,R=a[0]+1+(1+a.length),k=(V,b,O)=>{let U=V===m-1?V-2:V===0?V:V-1;return U+=O?24575:0,[U,b]};for(let V=0;V<m;++V)u.emplaceBack(...k(V,0,!0));for(let V=0;V<x;++V)for(let b=0;b<m;++b)u.emplaceBack(...k(b,V,(b===0||b===m-1)&&!0));for(let V=0;V<a.length;++V){const b=a[V];for(let O=0;O<m;++O)u.emplaceBack(...k(O,b,!0))}for(let V=0;V<a.length;++V){const b=p.length,O=a[V]+1+2,U=new ss;for(let W=0;W<O-1;W++){const K=W===O-2,J=K?m*(R-a.length+V-W):m;for(let se=0;se<m-1;se++){const oe=W*m+se;W===0||K||se===0||se===m-2?(U.emplaceBack(oe+1,oe,oe+J),U.emplaceBack(oe+J,oe+J+1,oe+1)):(p.emplaceBack(oe+1,oe,oe+J),p.emplaceBack(oe+J,oe+J+1,oe+1))}}const D=Is.simpleSegment(0,b,u.length,p.length-b);for(let W=0;W<U.uint16.length;W+=3)p.emplaceBack(U.uint16[W],U.uint16[W+1],U.uint16[W+2]);const B=Is.simpleSegment(0,b,u.length,p.length-b);_.push({withoutSkirts:D,withSkirts:B})}return{vertices:u,indices:p,segments:_}}_createGrid(d){const a=this._fillGridMeshWithLods(h,y);this._gridSegments=a.segments,this._gridBuffer=d.createVertexBuffer(a.vertices,Bu.members),this._gridIndexBuffer=d.createIndexBuffer(a.indices,!0)}_createPoles(d){const a=new ss;for(let x=0;x<=h;x++)a.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=d.createIndexBuffer(a,!0);const u=new Dh,p=new Dh,_=new Dh,m=new Dh;this._poleSegments=[];for(let x=0,R=0;x<iu;x++){const k=360/(1<<x);u.emplaceBack(0,-rr,0,.5,0),p.emplaceBack(0,-rr,0,.5,1),_.emplaceBack(0,-rr,0,.5,.5),m.emplaceBack(0,-rr,0,.5,.5);for(let V=0;V<=h;V++){let b=V/h,O=0;const U=Hn(0,k,b),[D,B,W]=I(hQ,dQ,U,rr);u.emplaceBack(D,B,W,b,O),p.emplaceBack(D,B,W,b,1-O);const K=xe(U);b=.5+.5*Math.sin(K),O=.5+.5*Math.cos(K),_.emplaceBack(D,B,W,b,O),m.emplaceBack(D,B,W,b,1-O)}this._poleSegments.push(Is.simpleSegment(R,0,66,64)),R+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(u,hs,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(p,hs,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(_,hs,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(m,hs,!1)}getGridBuffers(d,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},s.dn=Ab,s.dp=Pe,s.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dr=vt,s.ds=Je,s.dt=G,s.du=function([d,a,u]){const p=Math.hypot(d,a,u),_=Math.atan2(d,u),m=.5*Math.PI-Math.acos(-a/p);return new X(Se(_),Se(m))},s.dv=lI,s.dw=$,s.dx=function(d){const a=d.navigator?d.navigator.userAgent:null;return!!function(u){if(hi==null){const p=u.navigator?u.navigator.userAgent:null;hi=!!u.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return hi}(d)&&a&&(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dy=function(d,a){Mi=d,Be=a},s.dz=SP,s.e=je,s.e0=function(d){let a=0;if(new Uint32Array(d,0,1)[0]!==vV){const u=new Uint32Array(d,0,7),[,,p,_,m,x]=u;a=u.byteLength+_+m+x+m,(p!==d.byteLength||a>=d.byteLength)&&vi("Invalid b3dm header information.")}return wV(d,a)},s.e1=function(d,a){const u=SV(d);for(const p of u){for(const _ of p.meshes)zte(_);p.lights&&(p.lightMeshIndex=p.meshes.length,p.meshes.push(Ute(p.lights,a)))}return u},s.e2=tE,s.e3=YU,s.e4=ka,s.e5=function(d){An(),$t!=null&&$t.then(a=>{a.keys().then(u=>{for(let p=0;p<u.length-d;p++)a.delete(u[p])})})},s.f=function(d){return d.indexOf("mapbox:")===0},s.g=function(d,a){return fi(Bn(d,{method:"GET"}),a)},s.h=pt,s.i=function(d){return je.API_STYLE_REGEX.test(d)&&!nt(d)},s.j=function(d){return decodeURIComponent(atob(d).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(a,u)=>String.fromCharCode(+("0x"+u))))},s.l=Bn,s.m=Xn,s.n=function(d,a){return fi(Bn(d,{type:"json"}),a)},s.o=Yo,s.p=function(d,a){return fi(Bn(d,{method:"POST"}),a)},s.q=In,s.r=Ya,s.s=function(d){try{const a=self[d];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=Wc,s.u=function(){return function d(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},s.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},s.w=vi,s.x=Ml,s.y=2,s.z=nU}),o(["./shared"],function(s){function f(Ft){const we=Ft?Ft.url.toString():void 0;return we?performance.getEntriesByName(we):[]}function v(Ft){if(typeof Ft=="number"||typeof Ft=="boolean"||typeof Ft=="string"||Ft==null)return JSON.stringify(Ft);if(Array.isArray(Ft)){let Ie="[";for(const je of Ft)Ie+=`${v(je)},`;return`${Ie}]`}let we="{";for(const Ie of Object.keys(Ft).sort())we+=`${Ie}:${v(Ft[Ie])},`;return`${we}}`}function w(Ft){let we="";for(const Ie of s.bh)we+=`/${v(Ft[Ie])}`;return we}class C{constructor(we){this.keyCache={},this._layers={},this._layerConfigs={},we&&this.replace(we)}replace(we,Ie){this._layerConfigs={},this._layers={},this.update(we,[],Ie)}update(we,Ie,je){this._options=je;for(const nt of we)this._layerConfigs[nt.id]=nt,(this._layers[nt.id]=s.cq(nt,this.scope,null,this._options)).compileFilter(je),this.keyCache[nt.id]&&delete this.keyCache[nt.id];for(const nt of Ie)delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt];this.familiesBySource={};const pt=function(nt,wt){const zt={};for(let Bt=0;Bt<nt.length;Bt++){const Zt=wt&&wt[nt[Bt].id]||w(nt[Bt]);wt&&(wt[nt[Bt].id]=Zt);let Yt=zt[Zt];Yt||(Yt=zt[Zt]=[]),Yt.push(nt[Bt])}const St=[];for(const Bt in zt)St.push(zt[Bt]);return St}(s.be(this._layerConfigs),this.keyCache);for(const nt of pt){const wt=nt.map(fn=>this._layers[fn.id]),zt=wt[0];if(zt.visibility==="none")continue;const St=zt.source||"";let Bt=this.familiesBySource[St];Bt||(Bt=this.familiesBySource[St]={});const Zt=zt.sourceLayer||"_geojsonTileLayer";let Yt=Bt[Zt];Yt||(Yt=Bt[Zt]=[]),Yt.push(wt)}}}const M=1*s.dP;class F{constructor(we){const Ie={},je=[];for(const zt in we){const St=we[zt],Bt=Ie[zt]={};for(const Zt in St.glyphs){const Yt=St.glyphs[+Zt];if(!Yt||Yt.bitmap.width===0||Yt.bitmap.height===0)continue;const fn=Yt.metrics.localGlyph?M:1,In={x:0,y:0,w:Yt.bitmap.width+2*fn,h:Yt.bitmap.height+2*fn};je.push(In),Bt[Zt]=In}}const{w:pt,h:nt}=s.z(je),wt=new s.dO({width:pt||1,height:nt||1});for(const zt in we){const St=we[zt];for(const Bt in St.glyphs){const Zt=St.glyphs[+Bt];if(!Zt||Zt.bitmap.width===0||Zt.bitmap.height===0)continue;const Yt=Ie[zt][Bt],fn=Zt.metrics.localGlyph?M:1;s.dO.copy(Zt.bitmap,wt,{x:0,y:0},{x:Yt.x+fn,y:Yt.y+fn},Zt.bitmap)}}this.image=wt,this.positions=Ie}}s.dN(F,"GlyphAtlas");class N{constructor(we){this.tileID=new s.aA(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.lut=we.lut,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.scope=we.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.request&&we.request.collectResourceTiming,this.promoteId=we.promoteId,this.isSymbolTile=we.isSymbolTile,this.tileTransform=s.aL(we.tileID.canonical,we.projection),this.projection=we.projection,this.worldview=we.worldview,this.localizableLayerIds=we.localizableLayerIds,this.brightness=we.brightness,this.extraShadowCaster=!!we.extraShadowCaster,this.tessellationStep=we.tessellationStep,this.scaleFactor=we.scaleFactor}parse(we,Ie,je,pt,nt){this.status="parsing",this.data=we,this.collisionBoxArray=new s.aR;const wt=new s.dQ(Object.keys(we.layers).sort()),zt=new s.dR(this.tileID,this.promoteId);zt.bucketLayerIDs=[];const St={},Bt=new s.dS(256,256),Zt={featureIndex:zt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Bt,availableImages:je,brightness:this.brightness},Yt=Ie.familiesBySource[this.source];for(const Be in Yt){const Pt=we.layers[Be];if(!Pt)continue;let $t=!1,ht=!1,Lt=!1;for(const Xn of Yt[Be])Xn[0].type==="symbol"?$t=!0:ht=!0,Xn[0].is3D()&&Xn[0].type!=="model"&&(Lt=!0);if(this.extraShadowCaster&&!Lt||this.isSymbolTile===!0&&!$t||this.isSymbolTile===!1&&!ht)continue;Pt.version===1&&s.w(`Vector tile source "${this.source}" layer "${Be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const An=wt.encode(Be),Dn=[];for(let Xn=0,Yn=0;Xn<Pt.length;Xn++){const Si=Pt.feature(Xn),Wi=zt.getId(Si,Be);if(this.localizableLayerIds&&this.localizableLayerIds.has(Be)){const di=Si.properties?Si.properties.worldview:null;if(this.worldview&&typeof di=="string")if(di==="all")Si.properties.$localized=!0;else{if(!di.split(",").includes(this.worldview))continue;Si.properties.$localized=!0,Si.properties.worldview=this.worldview}}Dn.push({feature:Si,id:Wi,index:Yn,sourceLayerIndex:An}),Yn++}for(const Xn of Yt[Be]){const Yn=Xn[0];(!this.extraShadowCaster||Yn.is3D()&&Yn.type!=="model")&&(this.isSymbolTile!==void 0&&Yn.type==="symbol"!==this.isSymbolTile||Yn.minzoom&&this.zoom<Math.floor(Yn.minzoom)||Yn.maxzoom&&this.zoom>=Yn.maxzoom||Yn.visibility!=="none"&&(z(Xn,this.zoom,Zt.brightness,je),(St[Yn.id]=Yn.createBucket({index:zt.bucketLayerIDs.length,layers:Xn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:An,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Dn,Zt,this.tileID.canonical,this.tileTransform),zt.bucketLayerIDs.push(Xn.map(Si=>s.av(Si.id,Si.scope)))))}}let fn,In,Gn,Ci;Bt.trim();const Ri={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Mi=()=>{if(fn)return this.status="done",nt(fn);if(this.extraShadowCaster)this.status="done",nt(null,{buckets:s.be(St).filter(Be=>!Be.isEmpty()),featureIndex:zt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Zt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(In&&Gn&&Ci){const Be=new F(In),Pt=new s.dU(Gn,Ci,this.lut);for(const $t in St){const ht=St[$t];ht instanceof s.aS?(z(ht.layers,this.zoom,Zt.brightness,je),s.dV(ht,In,Be.positions,Gn,Pt.iconPositions,this.showCollisionBoxes,je,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):ht.hasPattern&&(ht instanceof s.aY||ht instanceof s.aZ||ht instanceof s.d0)&&(z(ht.layers,this.zoom,Zt.brightness,je),ht.addFeatures(Zt,this.tileID.canonical,Pt.patternPositions,je,this.tileTransform,this.brightness))}this.status="done",nt(null,{buckets:s.be(St).filter($t=>!$t.isEmpty()),featureIndex:zt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Be.image,lineAtlas:Bt,imageAtlas:Pt,brightness:Zt.brightness})}};if(!this.extraShadowCaster){const Be=s.dT(Zt.glyphDependencies,ht=>Object.keys(ht).map(Number));Object.keys(Be).length?pt.send("getGlyphs",{uid:this.uid,stacks:Be,scope:this.scope},(ht,Lt)=>{fn||(fn=ht,In=Lt,Mi())},void 0,!1,Ri):In={};const Pt=Object.keys(Zt.iconDependencies);Pt.length?pt.send("getImages",{icons:Pt,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ht,Lt)=>{fn||(fn=ht,Gn=Lt,Mi())},void 0,!1,Ri):Gn={};const $t=Object.keys(Zt.patternDependencies);$t.length?pt.send("getImages",{icons:$t,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ht,Lt)=>{fn||(fn=ht,Ci=Lt,Mi())},void 0,!1,Ri):Ci={}}Mi()}}function z(Ft,we,Ie,je){const pt=new s.a3(we,{brightness:Ie});for(const nt of Ft)nt.recalculate(pt,je)}class L extends s.E{constructor(we,Ie,je,pt,nt,wt){super(),this.actor=we,this.layerIndex=Ie,this.availableImages=je,this.loadVectorData=nt||s.aw,this.loading={},this.loaded={},this.deduped=new s.au(we.scheduler),this.isSpriteLoaded=pt,this.scheduler=we.scheduler,this.brightness=wt}loadTile(we,Ie){const je=we.uid,pt=we&&we.request,nt=pt&&pt.collectResourceTiming,wt=this.loading[je]=new N(we);wt.abort=this.loadVectorData(we,(zt,St)=>{const Bt=!this.loading[je];if(delete this.loading[je],Bt||zt||!St)return wt.status="done",Bt||(this.loaded[je]=wt),Ie(zt);const Zt=St.rawData,Yt={};St.expires&&(Yt.expires=St.expires),St.cacheControl&&(Yt.cacheControl=St.cacheControl),wt.vectorTile=St.vectorTile||new s.dW.VectorTile(new s.bc(Zt));const fn=()=>{wt.parse(wt.vectorTile,this.layerIndex,this.availableImages,this.actor,(In,Gn)=>{if(In||!Gn)return Ie(In);const Ci={};if(nt){const Ri=f(pt);Ri.length>0&&(Ci.resourceTiming=JSON.parse(JSON.stringify(Ri)))}Ie(null,s.l({rawTileData:Zt.slice(0)},Gn,Yt,Ci))})};this.isSpriteLoaded?fn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(fn,{type:"parseTile",isSymbolTile:we.isSymbolTile,zoom:we.tileZoom}):fn()}),this.loaded=this.loaded||{},this.loaded[je]=wt})}reloadTile(we,Ie){const je=this.loaded,pt=we.uid;if(je&&je[pt]){const nt=je[pt];nt.scaleFactor=we.scaleFactor,nt.showCollisionBoxes=we.showCollisionBoxes,nt.projection=we.projection,nt.brightness=we.brightness,nt.tileTransform=s.aL(we.tileID.canonical,we.projection),nt.extraShadowCaster=we.extraShadowCaster,nt.lut=we.lut;const wt=(zt,St)=>{const Bt=nt.reloadCallback;Bt&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,Bt)),Ie(zt,St)};nt.status==="parsing"?nt.reloadCallback=wt:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,wt):wt())}else Ie(null,void 0)}abortTile(we,Ie){const je=we.uid,pt=this.loading[je];pt&&(pt.abort&&pt.abort(),delete this.loading[je]),Ie()}removeTile(we,Ie){const je=this.loaded,pt=we.uid;je&&je[pt]&&delete je[pt],Ie()}}class P{loadTile(we,Ie){const{uid:je,encoding:pt,rawImageData:nt,padding:wt}=we,zt=ImageBitmap&&nt instanceof ImageBitmap?this.getImageData(nt,wt):nt;Ie(null,new s.dX(je,zt,pt,wt<1))}getImageData(we,Ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(we.width,we.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=we.width,this.offscreenCanvas.height=we.height,this.offscreenCanvasContext.drawImage(we,0,0,we.width,we.height);const je=this.offscreenCanvasContext.getImageData(-Ie,-Ie,we.width+2*Ie,we.height+2*Ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),je}}s.bb.setPbf(s.bc);class H{decodeRasterArray({task:we,buffer:Ie},je){s.bb.performDecoding(Ie,we).then(pt=>{je(null,pt)},pt=>{je(pt)})}}const j=s.dW.VectorTileFeature.prototype.toGeoJSON;class q{constructor(we){this._feature=we,this.extent=s.ab,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Ie of this._feature.geometry)we.push([new s.P(Ie[0],Ie[1])]);return we}{const we=[];for(const Ie of this._feature.geometry){const je=[];for(const pt of Ie)je.push(new s.P(pt[0],pt[1]));we.push(je)}return we}}toGeoJSON(we,Ie,je){return j.call(this,we,Ie,je)}}class le{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ab,this.length=we.length,this._features=we}feature(we){return new q(this._features[we])}}const ce=64/4096,ae=128;class pe{constructor(){this.features=new Map}clear(){this.features.clear()}load(we=[],Ie){for(const je of we){const pt=je.id;if(pt==null)continue;let nt=this.features.get(pt);nt&&this.updateCache(nt,Ie),je.geometry?(nt=ue(je),this.updateCache(nt,Ie),this.features.set(pt,nt)):this.features.delete(pt),this.updateCache(nt,Ie)}}updateCache(we,Ie){for(const{canonical:je,uid:pt}of Object.values(Ie)){const{z:nt,x:wt,y:zt}=je;fe(we,Math.pow(2,nt),wt,zt)&&delete Ie[pt]}}getTile(we,Ie,je){const pt=Math.pow(2,we),nt=[];for(const wt of this.features.values())fe(wt,pt,Ie,je)&&nt.push(tt(wt,pt,Ie,je));return{features:nt}}getFeatures(){return[...this.features.values()]}}function fe({minX:Ft,minY:we,maxX:Ie,maxY:je},pt,nt,wt){return Ft<(nt+1+ce)/pt&&we<(wt+1+ce)/pt&&Ie>(nt-ce)/pt&&je>(wt-ce)/pt}function ue(Ft){const{id:we,geometry:Ie,properties:je}=Ft;if(!Ie)return;if(Ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:pt,coordinates:nt}=Ie,wt={id:we,type:1,geometry:[],tags:je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},zt=wt.geometry;if(pt==="Point")Ee(nt,zt,wt);else if(pt==="MultiPoint")for(const St of nt)Ee(St,zt,wt);else if(pt==="LineString")wt.type=2,We(nt,zt,wt);else if(pt==="MultiLineString")wt.type=2,rt(nt,zt,wt);else if(pt==="Polygon")wt.type=3,rt(nt,zt,wt,!0);else{if(pt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");wt.type=3;for(const St of nt)rt(St,zt,wt,!0)}return wt}function Ee([Ft,we],Ie,je){const pt=s.am(Ft);let nt=s.at(we);nt=nt<0?0:nt>1?1:nt,Ie.push(pt,nt),je.minX=Math.min(je.minX,pt),je.minY=Math.min(je.minY,nt),je.maxX=Math.max(je.maxX,pt),je.maxY=Math.max(je.maxY,nt)}function We(Ft,we,Ie,je=!1,pt=!1){const nt=[];for(const wt of Ft)Ee(wt,nt,Ie);we.push(nt),je&&function(wt,zt){let St=0;for(let Bt=0,Zt=wt.length,Yt=Zt-2;Bt<Zt;Yt=Bt,Bt+=2)St+=(wt[Bt]-wt[Yt])*(wt[Bt+1]+wt[Yt+1]);if(St>0===zt)for(let Bt=0,Zt=wt.length;Bt<Zt/2;Bt+=2){const Yt=wt[Bt],fn=wt[Bt+1];wt[Bt]=wt[Zt-2-Bt],wt[Bt+1]=wt[Zt-1-Bt],wt[Zt-2-Bt]=Yt,wt[Zt-1-Bt]=fn}}(nt,pt)}function rt(Ft,we,Ie,je=!1){for(let pt=0;pt<Ft.length;pt++)We(Ft[pt],we,Ie,je,pt===0)}function tt(Ft,we,Ie,je){const{id:pt,type:nt,geometry:wt,tags:zt}=Ft,St=[];if(nt===1)(function(Bt,Zt,Yt,fn,In){for(let Gn=0;Gn<Bt.length;Gn+=2){const Ci=Math.round(s.ab*(Bt[Gn+0]*Zt-Yt)),Ri=Math.round(s.ab*(Bt[Gn+1]*Zt-fn));In.push([Ci,Ri])}})(wt,we,Ie,je,St);else for(const Bt of wt)Ye(Bt,we,Ie,je,St);return{id:pt,type:nt,geometry:St,tags:zt}}function Ye(Ft,we,Ie,je,pt){const nt=-ae,wt=s.ab+ae;let zt;for(let St=0;St<Ft.length-2;St+=2){let Bt=Math.round(s.ab*(Ft[St+0]*we-Ie)),Zt=Math.round(s.ab*(Ft[St+1]*we-je)),Yt=Math.round(s.ab*(Ft[St+2]*we-Ie)),fn=Math.round(s.ab*(Ft[St+3]*we-je));const In=Yt-Bt,Gn=fn-Zt;Bt<nt&&Yt<nt||(Bt<nt?(Zt+=Math.round(Gn*((nt-Bt)/In)),Bt=nt):Yt<nt&&(fn=Zt+Math.round(Gn*((nt-Bt)/In)),Yt=nt),Zt<nt&&fn<nt||(Zt<nt?(Bt+=Math.round(In*((nt-Zt)/Gn)),Zt=nt):fn<nt&&(Yt=Bt+Math.round(In*((nt-Zt)/Gn)),fn=nt),Bt>=wt&&Yt>=wt||(Bt>=wt?(Zt+=Math.round(Gn*((wt-Bt)/In)),Bt=wt):Yt>=wt&&(fn=Zt+Math.round(Gn*((wt-Bt)/In)),Yt=wt),Zt>=wt&&fn>=wt||(Zt>=wt?(Bt+=Math.round(In*((wt-Zt)/Gn)),Zt=wt):fn>=wt&&(Yt=Bt+Math.round(In*((wt-Zt)/Gn)),fn=wt),zt&&Bt===zt[zt.length-1][0]&&Zt===zt[zt.length-1][1]||(zt=[[Bt,Zt]],pt.push(zt)),zt.push([Yt,fn])))))}}var qe,ft,Me,$e={exports:{}},ut=function(){if(Me)return $e.exports;Me=1;var Ft=s.d_(),we=function(){if(ft)return qe;ft=1;var Zt=s.dY(),Yt=s.dZ().VectorTileFeature;function fn(Gn,Ci){this.options=Ci||{},this.features=Gn,this.length=Gn.length}function In(Gn,Ci){this.id=typeof Gn.id=="number"?Gn.id:void 0,this.type=Gn.type,this.rawGeometry=Gn.type===1?[Gn.geometry]:Gn.geometry,this.properties=Gn.tags,this.extent=Ci||4096}return qe=fn,fn.prototype.feature=function(Gn){return new In(this.features[Gn],this.options.extent)},In.prototype.loadGeometry=function(){var Gn=this.rawGeometry;this.geometry=[];for(var Ci=0;Ci<Gn.length;Ci++){for(var Ri=Gn[Ci],Mi=[],Be=0;Be<Ri.length;Be++)Mi.push(new Zt(Ri[Be][0],Ri[Be][1]));this.geometry.push(Mi)}return this.geometry},In.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Gn=this.geometry,Ci=1/0,Ri=-1/0,Mi=1/0,Be=-1/0,Pt=0;Pt<Gn.length;Pt++)for(var $t=Gn[Pt],ht=0;ht<$t.length;ht++){var Lt=$t[ht];Ci=Math.min(Ci,Lt.x),Ri=Math.max(Ri,Lt.x),Mi=Math.min(Mi,Lt.y),Be=Math.max(Be,Lt.y)}return[Ci,Mi,Ri,Be]},In.prototype.toGeoJSON=Yt.prototype.toGeoJSON,qe}();function Ie(Zt){var Yt=new Ft;return function(fn,In){for(var Gn in fn.layers)In.writeMessage(3,je,fn.layers[Gn])}(Zt,Yt),Yt.finish()}function je(Zt,Yt){var fn;Yt.writeVarintField(15,Zt.version||1),Yt.writeStringField(1,Zt.name||""),Yt.writeVarintField(5,Zt.extent||4096);var In={keys:[],values:[],keycache:{},valuecache:{}};for(fn=0;fn<Zt.length;fn++)In.feature=Zt.feature(fn),Yt.writeMessage(2,pt,In);var Gn=In.keys;for(fn=0;fn<Gn.length;fn++)Yt.writeStringField(3,Gn[fn]);var Ci=In.values;for(fn=0;fn<Ci.length;fn++)Yt.writeMessage(4,Bt,Ci[fn])}function pt(Zt,Yt){var fn=Zt.feature;fn.id!==void 0&&Yt.writeVarintField(1,fn.id),Yt.writeMessage(2,nt,Zt),Yt.writeVarintField(3,fn.type),Yt.writeMessage(4,St,fn)}function nt(Zt,Yt){var fn=Zt.feature,In=Zt.keys,Gn=Zt.values,Ci=Zt.keycache,Ri=Zt.valuecache;for(var Mi in fn.properties){var Be=fn.properties[Mi],Pt=Ci[Mi];if(Be!==null){Pt===void 0&&(In.push(Mi),Ci[Mi]=Pt=In.length-1),Yt.writeVarint(Pt);var $t=typeof Be;$t!=="string"&&$t!=="boolean"&&$t!=="number"&&(Be=JSON.stringify(Be));var ht=$t+":"+Be,Lt=Ri[ht];Lt===void 0&&(Gn.push(Be),Ri[ht]=Lt=Gn.length-1),Yt.writeVarint(Lt)}}}function wt(Zt,Yt){return(Yt<<3)+(7&Zt)}function zt(Zt){return Zt<<1^Zt>>31}function St(Zt,Yt){for(var fn=Zt.loadGeometry(),In=Zt.type,Gn=0,Ci=0,Ri=fn.length,Mi=0;Mi<Ri;Mi++){var Be=fn[Mi],Pt=1;In===1&&(Pt=Be.length),Yt.writeVarint(wt(1,Pt));for(var $t=In===3?Be.length-1:Be.length,ht=0;ht<$t;ht++){ht===1&&In!==1&&Yt.writeVarint(wt(2,$t-1));var Lt=Be[ht].x-Gn,An=Be[ht].y-Ci;Yt.writeVarint(zt(Lt)),Yt.writeVarint(zt(An)),Gn+=Lt,Ci+=An}In===3&&Yt.writeVarint(wt(7,1))}}function Bt(Zt,Yt){var fn=typeof Zt;fn==="string"?Yt.writeStringField(1,Zt):fn==="boolean"?Yt.writeBooleanField(7,Zt):fn==="number"&&(Zt%1!=0?Yt.writeDoubleField(3,Zt):Zt<0?Yt.writeSVarintField(6,Zt):Yt.writeVarintField(5,Zt))}return $e.exports=Ie,$e.exports.fromVectorTileJs=Ie,$e.exports.fromGeojsonVt=function(Zt,Yt){Yt=Yt||{};var fn={};for(var In in Zt)fn[In]=new we(Zt[In].features,Yt),fn[In].name=In,fn[In].version=Yt.version,fn[In].extent=Yt.extent;return Ie({layers:fn})},$e.exports.GeoJSONWrapper=we,$e.exports}(),Mt=s.d$(ut);const Gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ft=>Ft},Xt=Math.fround||(Qe=new Float32Array(1),Ft=>(Qe[0]=+Ft,Qe[0]));var Qe;const Ge=3,He=5,De=6;class kt{constructor(we){this.options=Object.assign(Object.create(Gt),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:Ie,minZoom:je,maxZoom:pt}=this.options;Ie&&console.time("total time");const nt=`prepare ${we.length} points`;Ie&&console.time(nt),this.points=we;const wt=[];for(let St=0;St<we.length;St++){const Bt=we[St];if(!Bt.geometry)continue;const[Zt,Yt]=Bt.geometry.coordinates,fn=Xt(Kt(Zt)),In=Xt(bt(Yt));wt.push(fn,In,1/0,St,-1,1),this.options.reduce&&wt.push(0)}let zt=this.trees[pt+1]=this._createTree(wt);Ie&&console.timeEnd(nt);for(let St=pt;St>=je;St--){const Bt=+Date.now();zt=this.trees[St]=this._createTree(this._cluster(zt,St)),Ie&&console.log("z%d: %d clusters in %dms",St,zt.numItems,+Date.now()-Bt)}return Ie&&console.timeEnd("total time"),this}getClusters(we,Ie){let je=((we[0]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,we[1]));let nt=we[2]===180?180:((we[2]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)je=-180,nt=180;else if(je>nt){const Yt=this.getClusters([je,pt,180,wt],Ie),fn=this.getClusters([-180,pt,nt,wt],Ie);return Yt.concat(fn)}const zt=this.trees[this._limitZoom(Ie)],St=zt.range(Kt(je),bt(wt),Kt(nt),bt(pt)),Bt=zt.data,Zt=[];for(const Yt of St){const fn=this.stride*Yt;Zt.push(Bt[fn+He]>1?rn(Bt,fn,this.clusterProps):this.points[Bt[fn+Ge]])}return Zt}getChildren(we){const Ie=this._getOriginId(we),je=this._getOriginZoom(we),pt="No cluster with the specified id.",nt=this.trees[je];if(!nt)throw new Error(pt);const wt=nt.data;if(Ie*this.stride>=wt.length)throw new Error(pt);const zt=this.options.radius/(this.options.extent*Math.pow(2,je-1)),St=nt.within(wt[Ie*this.stride],wt[Ie*this.stride+1],zt),Bt=[];for(const Zt of St){const Yt=Zt*this.stride;wt[Yt+4]===we&&Bt.push(wt[Yt+He]>1?rn(wt,Yt,this.clusterProps):this.points[wt[Yt+Ge]])}if(Bt.length===0)throw new Error(pt);return Bt}getLeaves(we,Ie,je){const pt=[];return this._appendLeaves(pt,we,Ie=Ie||10,je=je||0,0),pt}getTile(we,Ie,je){const pt=this.trees[this._limitZoom(we)],nt=Math.pow(2,we),{extent:wt,radius:zt}=this.options,St=zt/wt,Bt=(je-St)/nt,Zt=(je+1+St)/nt,Yt={features:[]};return this._addTileFeatures(pt.range((Ie-St)/nt,Bt,(Ie+1+St)/nt,Zt),pt.data,Ie,je,nt,Yt),Ie===0&&this._addTileFeatures(pt.range(1-St/nt,Bt,1,Zt),pt.data,nt,je,nt,Yt),Ie===nt-1&&this._addTileFeatures(pt.range(0,Bt,St/nt,Zt),pt.data,-1,je,nt,Yt),Yt.features.length?Yt:null}getClusterExpansionZoom(we){let Ie=this._getOriginZoom(we)-1;for(;Ie<=this.options.maxZoom;){const je=this.getChildren(we);if(Ie++,je.length!==1)break;we=je[0].properties.cluster_id}return Ie}_appendLeaves(we,Ie,je,pt,nt){const wt=this.getChildren(Ie);for(const zt of wt){const St=zt.properties;if(St&&St.cluster?nt+St.point_count<=pt?nt+=St.point_count:nt=this._appendLeaves(we,St.cluster_id,je,pt,nt):nt<pt?nt++:we.push(zt),we.length===je)break}return nt}_createTree(we){const Ie=new s.bz(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let je=0;je<we.length;je+=this.stride)Ie.add(we[je],we[je+1]);return Ie.finish(),Ie.data=we,Ie}_addTileFeatures(we,Ie,je,pt,nt,wt){for(const zt of we){const St=zt*this.stride,Bt=Ie[St+He]>1;let Zt,Yt,fn;if(Bt)Zt=Re(Ie,St,this.clusterProps),Yt=Ie[St],fn=Ie[St+1];else{const Ci=this.points[Ie[St+Ge]];Zt=Ci.properties;const[Ri,Mi]=Ci.geometry.coordinates;Yt=Kt(Ri),fn=bt(Mi)}const In={type:1,geometry:[[Math.round(this.options.extent*(Yt*nt-je)),Math.round(this.options.extent*(fn*nt-pt))]],tags:Zt};let Gn;Gn=Bt||this.options.generateId?Ie[St+Ge]:this.points[Ie[St+Ge]].id,Gn!==void 0&&(In.id=Gn),wt.features.push(In)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,Ie){const{radius:je,extent:pt,reduce:nt,minPoints:wt}=this.options,zt=je/(pt*Math.pow(2,Ie)),St=we.data,Bt=[],Zt=this.stride;for(let Yt=0;Yt<St.length;Yt+=Zt){if(St[Yt+2]<=Ie)continue;St[Yt+2]=Ie;const fn=St[Yt],In=St[Yt+1],Gn=we.within(St[Yt],St[Yt+1],zt),Ci=St[Yt+He];let Ri=Ci;for(const Mi of Gn){const Be=Mi*Zt;St[Be+2]>Ie&&(Ri+=St[Be+He])}if(Ri>Ci&&Ri>=wt){let Mi,Be=fn*Ci,Pt=In*Ci,$t=-1;const ht=(Yt/Zt<<5)+(Ie+1)+this.points.length;for(const Lt of Gn){const An=Lt*Zt;if(St[An+2]<=Ie)continue;St[An+2]=Ie;const Dn=St[An+He];Be+=St[An]*Dn,Pt+=St[An+1]*Dn,St[An+4]=ht,nt&&(Mi||(Mi=this._map(St,Yt,!0),$t=this.clusterProps.length,this.clusterProps.push(Mi)),nt(Mi,this._map(St,An)))}St[Yt+4]=ht,Bt.push(Be/Ri,Pt/Ri,1/0,ht,-1,Ri),nt&&Bt.push($t)}else{for(let Mi=0;Mi<Zt;Mi++)Bt.push(St[Yt+Mi]);if(Ri>1)for(const Mi of Gn){const Be=Mi*Zt;if(!(St[Be+2]<=Ie)){St[Be+2]=Ie;for(let Pt=0;Pt<Zt;Pt++)Bt.push(St[Be+Pt])}}}}return Bt}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,Ie,je){if(we[Ie+He]>1){const wt=this.clusterProps[we[Ie+De]];return je?Object.assign({},wt):wt}const pt=this.points[we[Ie+Ge]].properties,nt=this.options.map(pt);return je&&nt===pt?Object.assign({},nt):nt}}function rn(Ft,we,Ie){return{type:"Feature",id:Ft[we+Ge],properties:Re(Ft,we,Ie),geometry:{type:"Point",coordinates:[(je=Ft[we],360*(je-.5)),Dt(Ft[we+1])]}};var je}function Re(Ft,we,Ie){const je=Ft[we+He],pt=je>=1e4?`${Math.round(je/1e3)}k`:je>=1e3?Math.round(je/100)/10+"k":je,nt=Ft[we+De],wt=nt===-1?{}:Object.assign({},Ie[nt]);return Object.assign(wt,{cluster:!0,cluster_id:Ft[we+Ge],point_count:je,point_count_abbreviated:pt})}function Kt(Ft){return Ft/360+.5}function bt(Ft){const we=Math.sin(Ft*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Dt(Ft){const we=(180-360*Ft)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function _e(Ft,we,Ie,je){let pt=je;const nt=we+(Ie-we>>1);let wt,zt=Ie-we;const St=Ft[we],Bt=Ft[we+1],Zt=Ft[Ie],Yt=Ft[Ie+1];for(let fn=we+3;fn<Ie;fn+=3){const In=At(Ft[fn],Ft[fn+1],St,Bt,Zt,Yt);if(In>pt)wt=fn,pt=In;else if(In===pt){const Gn=Math.abs(fn-nt);Gn<zt&&(wt=fn,zt=Gn)}}pt>je&&(wt-we>3&&_e(Ft,we,wt,je),Ft[wt+2]=pt,Ie-wt>3&&_e(Ft,wt,Ie,je))}function At(Ft,we,Ie,je,pt,nt){let wt=pt-Ie,zt=nt-je;if(wt!==0||zt!==0){const St=((Ft-Ie)*wt+(we-je)*zt)/(wt*wt+zt*zt);St>1?(Ie=pt,je=nt):St>0&&(Ie+=wt*St,je+=zt*St)}return wt=Ft-Ie,zt=we-je,wt*wt+zt*zt}function Ot(Ft,we,Ie,je){const pt={id:Ft??null,type:we,geometry:Ie,tags:je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(we==="Point"||we==="MultiPoint"||we==="LineString")tn(pt,Ie);else if(we==="Polygon")tn(pt,Ie[0]);else if(we==="MultiLineString")for(const nt of Ie)tn(pt,nt);else if(we==="MultiPolygon")for(const nt of Ie)tn(pt,nt[0]);return pt}function tn(Ft,we){for(let Ie=0;Ie<we.length;Ie+=3)Ft.minX=Math.min(Ft.minX,we[Ie]),Ft.minY=Math.min(Ft.minY,we[Ie+1]),Ft.maxX=Math.max(Ft.maxX,we[Ie]),Ft.maxY=Math.max(Ft.maxY,we[Ie+1])}function xe(Ft,we,Ie,je){if(!we.geometry)return;const pt=we.geometry.coordinates;if(pt&&pt.length===0)return;const nt=we.geometry.type,wt=Math.pow(Ie.tolerance/((1<<Ie.maxZoom)*Ie.extent),2);let zt=[],St=we.id;if(Ie.promoteId?St=we.properties[Ie.promoteId]:Ie.generateId&&(St=je||0),nt==="Point")Se(pt,zt);else if(nt==="MultiPoint")for(const Bt of pt)Se(Bt,zt);else if(nt==="LineString")it(pt,zt,wt,!1);else if(nt==="MultiLineString"){if(Ie.lineMetrics){for(const Bt of pt)zt=[],it(Bt,zt,wt,!1),Ft.push(Ot(St,"LineString",zt,we.properties));return}Le(pt,zt,wt,!1)}else if(nt==="Polygon")Le(pt,zt,wt,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(const Bt of we.geometry.geometries)xe(Ft,{id:St,geometry:Bt,properties:we.properties},Ie,je);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Bt of pt){const Zt=[];Le(Bt,Zt,wt,!0),zt.push(Zt)}}Ft.push(Ot(St,nt,zt,we.properties))}function Se(Ft,we){we.push(Pe(Ft[0]),vt(Ft[1]),0)}function it(Ft,we,Ie,je){let pt,nt,wt=0;for(let St=0;St<Ft.length;St++){const Bt=Pe(Ft[St][0]),Zt=vt(Ft[St][1]);we.push(Bt,Zt,0),St>0&&(wt+=je?(pt*Zt-Bt*nt)/2:Math.sqrt(Math.pow(Bt-pt,2)+Math.pow(Zt-nt,2))),pt=Bt,nt=Zt}const zt=we.length-3;we[2]=1,_e(we,0,zt,Ie),we[zt+2]=1,we.size=Math.abs(wt),we.start=0,we.end=we.size}function Le(Ft,we,Ie,je){for(let pt=0;pt<Ft.length;pt++){const nt=[];it(Ft[pt],nt,Ie,je),we.push(nt)}}function Pe(Ft){return Ft/360+.5}function vt(Ft){const we=Math.sin(Ft*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function yt(Ft,we,Ie,je,pt,nt,wt,zt){if(je/=we,nt>=(Ie/=we)&&wt<je)return Ft;if(wt<Ie||nt>=je)return null;const St=[];for(const Bt of Ft){const Zt=Bt.geometry;let Yt=Bt.type;const fn=pt===0?Bt.minX:Bt.minY,In=pt===0?Bt.maxX:Bt.maxY;if(fn>=Ie&&In<je){St.push(Bt);continue}if(In<Ie||fn>=je)continue;let Gn=[];if(Yt==="Point"||Yt==="MultiPoint")nn(Zt,Gn,Ie,je,pt);else if(Yt==="LineString")jt(Zt,Gn,Ie,je,pt,!1,zt.lineMetrics);else if(Yt==="MultiLineString")Bn(Zt,Gn,Ie,je,pt,!1);else if(Yt==="Polygon")Bn(Zt,Gn,Ie,je,pt,!0);else if(Yt==="MultiPolygon")for(const Ci of Zt){const Ri=[];Bn(Ci,Ri,Ie,je,pt,!0),Ri.length&&Gn.push(Ri)}if(Gn.length){if(zt.lineMetrics&&Yt==="LineString"){for(const Ci of Gn)St.push(Ot(Bt.id,Yt,Ci,Bt.tags));continue}Yt!=="LineString"&&Yt!=="MultiLineString"||(Gn.length===1?(Yt="LineString",Gn=Gn[0]):Yt="MultiLineString"),Yt!=="Point"&&Yt!=="MultiPoint"||(Yt=Gn.length===3?"Point":"MultiPoint"),St.push(Ot(Bt.id,Yt,Gn,Bt.tags))}}return St.length?St:null}function nn(Ft,we,Ie,je,pt){for(let nt=0;nt<Ft.length;nt+=3){const wt=Ft[nt+pt];wt>=Ie&&wt<=je&&Zn(we,Ft[nt],Ft[nt+1],Ft[nt+2])}}function jt(Ft,we,Ie,je,pt,nt,wt){let zt=Fn(Ft);const St=pt===0?Li:zn;let Bt,Zt,Yt=Ft.start;for(let Ri=0;Ri<Ft.length-3;Ri+=3){const Mi=Ft[Ri],Be=Ft[Ri+1],Pt=Ft[Ri+2],$t=Ft[Ri+3],ht=Ft[Ri+4],Lt=pt===0?Mi:Be,An=pt===0?$t:ht;let Dn=!1;wt&&(Bt=Math.sqrt(Math.pow(Mi-$t,2)+Math.pow(Be-ht,2))),Lt<Ie?An>Ie&&(Zt=St(zt,Mi,Be,$t,ht,Ie),wt&&(zt.start=Yt+Bt*Zt)):Lt>je?An<je&&(Zt=St(zt,Mi,Be,$t,ht,je),wt&&(zt.start=Yt+Bt*Zt)):Zn(zt,Mi,Be,Pt),An<Ie&&Lt>=Ie&&(Zt=St(zt,Mi,Be,$t,ht,Ie),Dn=!0),An>je&&Lt<=je&&(Zt=St(zt,Mi,Be,$t,ht,je),Dn=!0),!nt&&Dn&&(wt&&(zt.end=Yt+Bt*Zt),we.push(zt),zt=Fn(Ft)),wt&&(Yt+=Bt)}let fn=Ft.length-3;const In=Ft[fn],Gn=Ft[fn+1],Ci=pt===0?In:Gn;Ci>=Ie&&Ci<=je&&Zn(zt,In,Gn,Ft[fn+2]),fn=zt.length-3,nt&&fn>=3&&(zt[fn]!==zt[0]||zt[fn+1]!==zt[1])&&Zn(zt,zt[0],zt[1],zt[2]),zt.length&&we.push(zt)}function Fn(Ft){const we=[];return we.size=Ft.size,we.start=Ft.start,we.end=Ft.end,we}function Bn(Ft,we,Ie,je,pt,nt){for(const wt of Ft)jt(wt,we,Ie,je,pt,nt,!1)}function Zn(Ft,we,Ie,je){Ft.push(we,Ie,je)}function Li(Ft,we,Ie,je,pt,nt){const wt=(nt-we)/(je-we);return Zn(Ft,nt,Ie+(pt-Ie)*wt,1),wt}function zn(Ft,we,Ie,je,pt,nt){const wt=(nt-Ie)/(pt-Ie);return Zn(Ft,we+(je-we)*wt,nt,1),wt}function oi(Ft,we){const Ie=[];for(let je=0;je<Ft.length;je++){const pt=Ft[je],nt=pt.type;let wt;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")wt=gi(pt.geometry,we);else if(nt==="MultiLineString"||nt==="Polygon"){wt=[];for(const zt of pt.geometry)wt.push(gi(zt,we))}else if(nt==="MultiPolygon"){wt=[];for(const zt of pt.geometry){const St=[];for(const Bt of zt)St.push(gi(Bt,we));wt.push(St)}}Ie.push(Ot(pt.id,nt,wt,pt.tags))}return Ie}function gi(Ft,we){const Ie=[];Ie.size=Ft.size,Ft.start!==void 0&&(Ie.start=Ft.start,Ie.end=Ft.end);for(let je=0;je<Ft.length;je+=3)Ie.push(Ft[je]+we,Ft[je+1],Ft[je+2]);return Ie}function Ti(Ft,we){if(Ft.transformed)return Ft;const Ie=1<<Ft.z,je=Ft.x,pt=Ft.y;for(const nt of Ft.features){const wt=nt.geometry,zt=nt.type;if(nt.geometry=[],zt===1)for(let St=0;St<wt.length;St+=2)nt.geometry.push(pi(wt[St],wt[St+1],we,Ie,je,pt));else for(let St=0;St<wt.length;St++){const Bt=[];for(let Zt=0;Zt<wt[St].length;Zt+=2)Bt.push(pi(wt[St][Zt],wt[St][Zt+1],we,Ie,je,pt));nt.geometry.push(Bt)}}return Ft.transformed=!0,Ft}function pi(Ft,we,Ie,je,pt,nt){return[Math.round(Ie*(Ft*je-pt)),Math.round(Ie*(we*je-nt))]}function Ji(Ft,we,Ie,je,pt){const nt=we===pt.maxZoom?0:pt.tolerance/((1<<we)*pt.extent),wt={features:[],numPoints:0,numSimplified:0,numFeatures:Ft.length,source:null,x:Ie,y:je,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const zt of Ft)er(wt,zt,nt,pt);return wt}function er(Ft,we,Ie,je){const pt=we.geometry,nt=we.type,wt=[];if(Ft.minX=Math.min(Ft.minX,we.minX),Ft.minY=Math.min(Ft.minY,we.minY),Ft.maxX=Math.max(Ft.maxX,we.maxX),Ft.maxY=Math.max(Ft.maxY,we.maxY),nt==="Point"||nt==="MultiPoint")for(let zt=0;zt<pt.length;zt+=3)wt.push(pt[zt],pt[zt+1]),Ft.numPoints++,Ft.numSimplified++;else if(nt==="LineString")vi(wt,pt,Ft,Ie,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(let zt=0;zt<pt.length;zt++)vi(wt,pt[zt],Ft,Ie,nt==="Polygon",zt===0);else if(nt==="MultiPolygon")for(let zt=0;zt<pt.length;zt++){const St=pt[zt];for(let Bt=0;Bt<St.length;Bt++)vi(wt,St[Bt],Ft,Ie,!0,Bt===0)}if(wt.length){let zt=we.tags||null;if(nt==="LineString"&&je.lineMetrics){zt={};for(const Bt in we.tags)zt[Bt]=we.tags[Bt];zt.mapbox_clip_start=pt.start/pt.size,zt.mapbox_clip_end=pt.end/pt.size}const St={geometry:wt,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:zt};we.id!==null&&(St.id=we.id),Ft.features.push(St)}}function vi(Ft,we,Ie,je,pt,nt){const wt=je*je;if(je>0&&we.size<(pt?wt:je))return void(Ie.numPoints+=we.length/3);const zt=[];for(let St=0;St<we.length;St+=3)(je===0||we[St+2]>wt)&&(Ie.numSimplified++,zt.push(we[St],we[St+1])),Ie.numPoints++;pt&&function(St,Bt){let Zt=0;for(let Yt=0,fn=St.length,In=fn-2;Yt<fn;In=Yt,Yt+=2)Zt+=(St[Yt]-St[In])*(St[Yt+1]+St[In+1]);if(Zt>0===Bt)for(let Yt=0,fn=St.length;Yt<fn/2;Yt+=2){const In=St[Yt],Gn=St[Yt+1];St[Yt]=St[fn-2-Yt],St[Yt+1]=St[fn-1-Yt],St[fn-2-Yt]=In,St[fn-1-Yt]=Gn}}(zt,nt),Ft.push(zt)}const Wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ui{constructor(we,Ie){const je=(Ie=this.options=function(nt,wt){for(const zt in wt)nt[zt]=wt[zt];return nt}(Object.create(Wt),Ie)).debug;if(je&&console.time("preprocess data"),Ie.maxZoom<0||Ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ie.promoteId&&Ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let pt=function(nt,wt){const zt=[];if(nt.type==="FeatureCollection")for(let St=0;St<nt.features.length;St++)xe(zt,nt.features[St],wt,St);else xe(zt,nt.type==="Feature"?nt:{geometry:nt},wt);return zt}(we,Ie);this.tiles={},this.tileCoords=[],je&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ie.indexMaxZoom,Ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pt=function(nt,wt){const zt=wt.buffer/wt.extent;let St=nt;const Bt=yt(nt,1,-1-zt,zt,0,-1,2,wt),Zt=yt(nt,1,1-zt,2+zt,0,-1,2,wt);return(Bt||Zt)&&(St=yt(nt,1,-zt,1+zt,0,-1,2,wt)||[],Bt&&(St=oi(Bt,1).concat(St)),Zt&&(St=St.concat(oi(Zt,-1)))),St}(pt,Ie),pt.length&&this.splitTile(pt,0,0,0),je&&(pt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(we,Ie,je,pt,nt,wt,zt){const St=[we,Ie,je,pt],Bt=this.options,Zt=Bt.debug;for(;St.length;){pt=St.pop(),je=St.pop(),Ie=St.pop(),we=St.pop();const Yt=1<<Ie,fn=vn(Ie,je,pt);let In=this.tiles[fn];if(!In&&(Zt>1&&console.time("creation"),In=this.tiles[fn]=Ji(we,Ie,je,pt,Bt),this.tileCoords.push({z:Ie,x:je,y:pt}),Zt)){Zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ie,je,pt,In.numFeatures,In.numPoints,In.numSimplified),console.timeEnd("creation"));const Dn=`z${Ie}`;this.stats[Dn]=(this.stats[Dn]||0)+1,this.total++}if(In.source=we,nt==null){if(Ie===Bt.indexMaxZoom||In.numPoints<=Bt.indexMaxPoints)continue}else{if(Ie===Bt.maxZoom||Ie===nt)continue;if(nt!=null){const Dn=nt-Ie;if(je!==wt>>Dn||pt!==zt>>Dn)continue}}if(In.source=null,we.length===0)continue;Zt>1&&console.time("clipping");const Gn=.5*Bt.buffer/Bt.extent,Ci=.5-Gn,Ri=.5+Gn,Mi=1+Gn;let Be=null,Pt=null,$t=null,ht=null,Lt=yt(we,Yt,je-Gn,je+Ri,0,In.minX,In.maxX,Bt),An=yt(we,Yt,je+Ci,je+Mi,0,In.minX,In.maxX,Bt);we=null,Lt&&(Be=yt(Lt,Yt,pt-Gn,pt+Ri,1,In.minY,In.maxY,Bt),Pt=yt(Lt,Yt,pt+Ci,pt+Mi,1,In.minY,In.maxY,Bt),Lt=null),An&&($t=yt(An,Yt,pt-Gn,pt+Ri,1,In.minY,In.maxY,Bt),ht=yt(An,Yt,pt+Ci,pt+Mi,1,In.minY,In.maxY,Bt),An=null),Zt>1&&console.timeEnd("clipping"),St.push(Be||[],Ie+1,2*je,2*pt),St.push(Pt||[],Ie+1,2*je,2*pt+1),St.push($t||[],Ie+1,2*je+1,2*pt),St.push(ht||[],Ie+1,2*je+1,2*pt+1)}}getTile(we,Ie,je){we=+we,Ie=+Ie,je=+je;const pt=this.options,{extent:nt,debug:wt}=pt;if(we<0||we>24)return null;const zt=1<<we,St=vn(we,Ie=Ie+zt&zt-1,je);if(this.tiles[St])return Ti(this.tiles[St],nt);wt>1&&console.log("drilling down to z%d-%d-%d",we,Ie,je);let Bt,Zt=we,Yt=Ie,fn=je;for(;!Bt&&Zt>0;)Zt--,Yt>>=1,fn>>=1,Bt=this.tiles[vn(Zt,Yt,fn)];return Bt&&Bt.source?(wt>1&&(console.log("found parent tile z%d-%d-%d",Zt,Yt,fn),console.time("drilling down")),this.splitTile(Bt.source,Zt,Yt,fn,we,Ie,je),wt>1&&console.timeEnd("drilling down"),this.tiles[St]?Ti(this.tiles[St],nt):null):null}}function vn(Ft,we,Ie){return 32*((1<<Ft)*Ie+we)+Ft}function Ln(Ft,we){const Ie=Ft.tileID.canonical;if(!this._geoJSONIndex)return void we(null,null);const je=this._geoJSONIndex.getTile(Ie.z,Ie.x,Ie.y);if(!je)return void we(null,null);const pt=new le(je.features);let nt=Mt(pt);nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),we(null,{vectorTile:pt,rawData:nt.buffer})}class mi extends L{constructor(we,Ie,je,pt,nt,wt){super(we,Ie,je,pt,Ln,wt),nt&&(this.loadGeoJSON=nt),this._dynamicIndex=new pe}loadData(we,Ie){const je=we&&we.request,pt=je&&je.collectResourceTiming;this.loadGeoJSON(we,(nt,wt)=>{if(nt||!wt)return Ie(nt);if(typeof wt!="object")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));{try{if(we.filter){const St=s.M(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(St.result==="error")throw new Error(St.value.map(Bt=>`${Bt.key}: ${Bt.message}`).join(", "));wt.features=wt.features.filter(Bt=>St.value.evaluate({zoom:0},Bt))}we.dynamic?(wt.type==="Feature"&&(wt={type:"FeatureCollection",features:[wt]}),we.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(wt.features,this.loaded),we.cluster&&(wt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=we.cluster?new kt(function({superclusterOptions:St,clusterProperties:Bt}){if(!Bt||!St)return St;const Zt={},Yt={},fn={accumulated:null,zoom:0},In={properties:null},Gn=Object.keys(Bt);for(const Ci of Gn){const[Ri,Mi]=Bt[Ci],Be=s.M(Mi),Pt=s.M(typeof Ri=="string"?[Ri,["accumulated"],["get",Ci]]:Ri);Zt[Ci]=Be.value,Yt[Ci]=Pt.value}return St.map=Ci=>{In.properties=Ci;const Ri={};for(const Mi of Gn)Ri[Mi]=Zt[Mi].evaluate(fn,In);return Ri},St.reduce=(Ci,Ri)=>{In.properties=Ri;for(const Mi of Gn)fn.accumulated=Ci[Mi],Ci[Mi]=Yt[Mi].evaluate(fn,In)},St}(we)).load(wt.features):we.dynamic?this._dynamicIndex:function(St,Bt){return new ui(St,Bt)}(wt,we.geojsonVtOptions)}catch(St){return Ie(St)}const zt={};if(pt){const St=f(je);St&&(zt.resourceTiming={},zt.resourceTiming[we.source]=JSON.parse(JSON.stringify(St)))}Ie(null,zt)}})}reloadTile(we,Ie){const je=this.loaded;return je&&je[we.uid]?we.partial?Ie(null,void 0):super.reloadTile(we,Ie):this.loadTile(we,Ie)}loadGeoJSON(we,Ie){if(we.request)s.n(we.request,Ie);else{if(typeof we.data!="string")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));try{return Ie(null,JSON.parse(we.data))}catch{return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(we,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(we.clusterId))}catch(je){Ie(je)}}getClusterChildren(we,Ie){try{Ie(null,this._geoJSONIndex.getChildren(we.clusterId))}catch(je){Ie(je)}}getClusterLeaves(we,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset))}catch(je){Ie(je)}}}class hi{constructor(we,Ie){this.tileID=new s.aA(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=we.projection,this.brightness=Ie}parse(we,Ie,je,pt){this.status="parsing";const nt=new s.aA(je.tileID.overscaledZ,je.tileID.wrap,je.tileID.canonical.z,je.tileID.canonical.x,je.tileID.canonical.y),wt=[],zt=Ie.familiesBySource[je.source],St=new s.dR(nt,je.promoteId);return St.bucketLayerIDs=[],St.is3DTile=!0,s.e0(we).then(Bt=>{if(!Bt)return pt(new Error("Could not parse tile"));const Zt=s.e1(Bt,1/s.c9(je.tileID.canonical)),Yt=Bt.json.extensionsUsed&&Bt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Bt.json.asset.extras&&Bt.json.asset.extras.MAPBOX_mesh_features,fn=Bt.json.extensionsUsed&&Bt.json.extensionsUsed.includes("EXT_meshopt_compression"),In=new s.a3(this.zoom,{brightness:this.brightness});for(const Gn in zt)for(const Ci of zt[Gn]){const Ri=Ci[0];St.bucketLayerIDs.push(Ci.map(Be=>s.av(Be.id,Be.scope))),Ri.recalculate(In,[]);const Mi=new s.e2(Ci,Zt,nt,Yt,fn,this.brightness,St);Yt||(Mi.needsUpload=!0),wt.push(Mi),Mi.evaluate(Ri)}this.status="done",pt(null,{buckets:wt,featureIndex:St,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Bt=>pt(new Error(Bt.message)))}}class Xi{constructor(we,Ie,je,pt,nt,wt){this.actor=we,this.layerIndex=Ie,this.availableImages=je,this.brightness=wt,this.loading={},this.loaded={}}loadTile(we,Ie){const je=we.uid,pt=this.loading[je]=new hi(we,this.brightness);s.bd(we.request,(nt,wt)=>{const zt=!this.loading[je];return delete this.loading[je],zt||nt?(pt.status="done",zt||(this.loaded[je]=pt),Ie(nt)):wt&&wt.byteLength!==0?void pt.parse(wt,this.layerIndex,we,(St,Bt)=>{pt.status="done",this.loaded=this.loaded||{},this.loaded[je]=pt,St||!Bt?Ie(St):Ie(null,Bt)}):(pt.status="done",this.loaded[je]=pt,Ie())})}reloadTile(we,Ie){const je=this.loaded,pt=we.uid;if(je&&je[pt]){const nt=je[pt];nt.projection=we.projection,nt.brightness=we.brightness;const wt=(zt,St)=>{nt.reloadCallback&&(delete nt.reloadCallback,this.loadTile(we,Ie)),Ie(zt,St)};nt.status==="parsing"?nt.reloadCallback=wt:nt.status==="done"&&this.loadTile(we,Ie)}}abortTile(we,Ie){const je=we.uid;this.loading[je]&&delete this.loading[je],Ie()}removeTile(we,Ie){const je=this.loaded,pt=we.uid;je&&je[pt]&&delete je[pt],Ie()}}class cs{constructor(we){this.self=we,this.actor=new s.e3(we,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bM({name:"mercator"}),this.workerSourceTypes={vector:L,geojson:mi,"batched-model":Xi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ie,je)=>{if(this.workerSourceTypes[Ie])throw new Error(`Worker source with name "${Ie}" already registered.`);this.workerSourceTypes[Ie]=je},this.self.registerRTLTextPlugin=Ie=>{if(s.e4.isParsed())throw new Error("RTL text plugin already registered.");s.e4.applyArabicShaping=Ie.applyArabicShaping,s.e4.processBidirectionalText=Ie.processBidirectionalText,s.e4.processStyledBidirectionalText=Ie.processStyledBidirectionalText}}clearCaches(we,Ie,je){delete this.layerIndexes[we],delete this.availableImages[we],delete this.workerSources[we],delete this.demWorkerSources[we],delete this.rasterArrayWorkerSource,je()}checkIfReady(we,Ie,je){je()}setReferrer(we,Ie){this.referrer=Ie}spriteLoaded(we,{scope:Ie,isLoaded:je}){if(this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),this.isSpriteLoaded[we][Ie]=je,this.workerSources[we]&&this.workerSources[we][Ie])for(const pt in this.workerSources[we][Ie]){const nt=this.workerSources[we][Ie][pt];for(const wt in nt){const zt=nt[wt];zt instanceof L&&(zt.isSpriteLoaded=je,zt.fire(new s.x("isSpriteLoaded")))}}}setImages(we,{scope:Ie,images:je},pt){if(this.availableImages[we]||(this.availableImages[we]={}),this.availableImages[we][Ie]=je,this.workerSources[we]&&this.workerSources[we][Ie]){for(const nt in this.workerSources[we][Ie]){const wt=this.workerSources[we][Ie][nt];for(const zt in wt)wt[zt].availableImages=je}pt()}else pt()}setProjection(we,Ie){this.projections[we]=s.bM(Ie)}setBrightness(we,Ie,je){this.brightness=Ie,je()}setLayers(we,Ie,je){this.getLayerIndex(we,Ie.scope).replace(Ie.layers,Ie.options),je()}updateLayers(we,Ie,je){this.getLayerIndex(we,Ie.scope).update(Ie.layers,Ie.removedIds,Ie.options),je()}loadTile(we,Ie,je){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).loadTile(Ie,je)}loadDEMTile(we,Ie,je){this.getDEMWorkerSource(we,Ie.source,Ie.scope).loadTile(Ie,je)}decodeRasterArray(we,Ie,je){this.getRasterArrayWorkerSource().decodeRasterArray(Ie,je)}reloadTile(we,Ie,je){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).reloadTile(Ie,je)}abortTile(we,Ie,je){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).abortTile(Ie,je)}removeTile(we,Ie,je){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).removeTile(Ie,je)}removeSource(we,Ie,je){if(!(this.workerSources[we]&&this.workerSources[we][Ie.scope]&&this.workerSources[we][Ie.scope][Ie.type]&&this.workerSources[we][Ie.scope][Ie.type][Ie.source]))return;const pt=this.workerSources[we][Ie.scope][Ie.type][Ie.source];delete this.workerSources[we][Ie.scope][Ie.type][Ie.source],pt.removeSource!==void 0?pt.removeSource(Ie,je):je()}loadWorkerSource(we,Ie,je){try{this.self.importScripts(Ie.url),je()}catch(pt){je(pt.toString())}}syncRTLPluginState(we,Ie,je){try{s.e4.setState(Ie);const pt=s.e4.getPluginURL();if(s.e4.isLoaded()&&!s.e4.isParsed()&&pt!=null){this.self.importScripts(pt);const nt=s.e4.isParsed();je(nt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pt}`),nt)}}catch(pt){je(pt.toString())}}setDracoUrl(we,Ie){this.dracoUrl=Ie}getAvailableImages(we,Ie){this.availableImages[we]||(this.availableImages[we]={});let je=this.availableImages[we][Ie];return je||(je=[]),je}getLayerIndex(we,Ie){this.layerIndexes[we]||(this.layerIndexes[we]={});let je=this.layerIndexes[we][Ie];return je||(je=this.layerIndexes[we][Ie]=new C,je.scope=Ie),je}getWorkerSource(we,Ie,je,pt){return this.workerSources[we]||(this.workerSources[we]={}),this.workerSources[we][pt]||(this.workerSources[we][pt]={}),this.workerSources[we][pt][Ie]||(this.workerSources[we][pt][Ie]={}),this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),this.workerSources[we][pt][Ie][je]||(this.workerSources[we][pt][Ie][je]=new this.workerSourceTypes[Ie]({send:(nt,wt,zt,St,Bt,Zt)=>{this.actor.send(nt,wt,zt,we,Bt,Zt)},scheduler:this.actor.scheduler},this.getLayerIndex(we,pt),this.getAvailableImages(we,pt),this.isSpriteLoaded[we][pt],void 0,this.brightness)),this.workerSources[we][pt][Ie][je]}getDEMWorkerSource(we,Ie,je){return this.demWorkerSources[we]||(this.demWorkerSources[we]={}),this.demWorkerSources[we][je]||(this.demWorkerSources[we][je]={}),this.demWorkerSources[we][je][Ie]||(this.demWorkerSources[we][je][Ie]=new P),this.demWorkerSources[we][je][Ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new H),this.rasterArrayWorkerSource}enforceCacheSizeLimit(we,Ie){s.e5(Ie)}getWorkerPerformanceMetrics(we,Ie,je){je(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new cs(self)),cs}),o(["./shared"],function(s){var f="3.8.0";const v={create:"create",load:"load",fullLoad:"fullLoad"},w={mark(g){performance.mark(g)},measure(g,l,h){performance.measure(g,l,h)}};function C(g){const l=g.name.split("?")[0];return s.a(l)&&l.includes("mapbox-gl.js")?"javascript":s.a(l)&&l.includes("mapbox-gl.css")?"css":s.b(l)?"fontRange":s.c(l)?"sprite":s.i(l)?"style":s.d(l)?"tilejson":"other"}var M,F={},N=function(){if(M)return F;function g(y){return!l(y)}function l(y){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,I,G=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(G);try{I=new Worker($),E=!0}catch{E=!1}return I&&I.terminate(),URL.revokeObjectURL($),E}()?function(){var E=document.createElement("canvas");E.width=E.height=1;var I=E.getContext("2d");if(!I)return!1;var G=I.getImageData(0,0,1,1);return G&&G.width===E.width}()?(h[S=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(E){var I,G=function($){var Y=document.createElement("canvas"),X=Object.create(g.webGLContextAttributes);return X.failIfMajorPerformanceCaveat=$,Y.getContext("webgl2",X)}(E);if(!G)return!1;try{I=G.createShader(G.VERTEX_SHADER)}catch{return!1}return!(!I||G.isContextLost())&&(G.shaderSource(I,"void main() {}"),G.compileShader(I),G.getShaderParameter(I,G.COMPILE_STATUS)===!0)}(S)),h[S]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var S}M=1,F.supported=g,F.notSupportedReason=l;var h={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},F}();function z(g,l,h){const y=document.createElement(g);return l!=null&&(y.className=l),h&&h.appendChild(y),y}function L(g,l,h){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const S of Object.keys(l))y.setAttributeNS(null,S,String(l[S]));return h&&h.appendChild(y),y}const P=typeof document<"u"?document.documentElement&&document.documentElement.style:null,H=P&&P.userSelect!==void 0?"userSelect":"WebkitUserSelect";let j;function q(){P&&H&&(j=P[H],P[H]="none")}function le(){P&&H&&(P[H]=j)}function ce(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ce,!0)}function ae(){window.addEventListener("click",ce,!0),window.setTimeout(()=>{window.removeEventListener("click",ce,!0)},0)}function pe(g,l){const h=g.getBoundingClientRect();return Ee(g,h,l)}function fe(g,l){const h=g.getBoundingClientRect(),y=[];for(let S=0;S<l.length;S++)y.push(Ee(g,h,l[S]));return y}function ue(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Ee(g,l,h){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new s.P((h.clientX-l.left)*y,(h.clientY-l.top)*y)}const We="01",rt="NO_ACCESS_TOKEN";class tt{constructor(l,h,y){this._transformRequestFn=l,this._customAccessToken=h,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const l=function(){let h="";for(let y=0;y<10;y++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",We,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}normalizeStyleURL(l,h){if(!s.f(l))return l;const y=qe(l);return y.params.push(`sdk=js-${f}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeGlyphsURL(l,h){if(!s.f(l))return l;const y=qe(l);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeModelURL(l,h){if(!s.f(l))return l;const y=qe(l);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeSourceURL(l,h,y,S){if(!s.f(l))return l;const E=qe(l);return E.path=`/v4/${E.authority}.json`,E.params.push("secure"),y&&E.params.push(`language=${y}`),S&&E.params.push(`worldview=${S}`),this._makeAPIURL(E,this._customAccessToken||h)}normalizeSpriteURL(l,h,y,S){const E=qe(l);return s.f(l)?(E.path=`/styles/v1${E.path}/sprite${h}${y}`,this._makeAPIURL(E,this._customAccessToken||S)):(E.path+=`${h}${y}`,ft(E))}normalizeTileURL(l,h,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!s.f(l))return l;const S=qe(l);S.path=S.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||y&&S.authority!=="raster"&&y===512?"@2x":""}${s.m.supported?".webp":"$1"}`),S.authority==="raster"?S.path=`/${s.e.RASTER_URL_PREFIX}${S.path}`:S.authority==="rasterarrays"?S.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${S.path}`:S.authority==="3dtiles"?S.path=`/${s.e.TILES3D_URL_PREFIX}${S.path}`:(S.path=S.path.replace(/^.+\/v4\//,"/"),S.path=`/${s.e.TILE_URL_VERSION}${S.path}`);const E=this._customAccessToken||function(I){for(const G of I){const $=G.match(/^access_token=(.*)$/);if($)return $[1]}return null}(S.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&S.params.push(`sku=${this._skuToken}`),this._makeAPIURL(S,E)}canonicalizeTileURL(l,h){const y=qe(l);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return l;let S="mapbox://";y.path.match(/^\/raster\/v1\//)?S+=`raster/${y.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?S+=`rasterarrays/${y.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:S+=`tiles/${y.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let E=y.params;return h&&(E=E.filter(I=>!I.match(/^access_token=/))),E.length&&(S+=`?${E.join("&")}`),S}canonicalizeTileset(l,h){const y=!!h&&s.f(h),S=[];for(const E of l.tiles||[])s.h(E)?S.push(this.canonicalizeTileURL(E,y)):S.push(E);return S}_makeAPIURL(l,h){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",S=qe(s.e.API_URL);if(l.protocol=S.protocol,l.authority=S.authority,l.protocol==="http"){const E=l.params.indexOf("secure");E>=0&&l.params.splice(E,1)}if(S.path!=="/"&&(l.path=`${S.path}${l.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ft(l);if(h=h||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return l.params=l.params.filter(E=>E.indexOf("access_token")===-1),l.params.push(`access_token=${h||""}`),ft(l)}}const Ye=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(g){const l=g.match(Ye);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function ft(g){const l=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${l}`}const Me="mapbox.eventData";function $e(g){if(!g)return null;const l=g.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(s.j(l[1]))}catch{return null}}class ut{constructor(l){this.type=l,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const h=$e(s.e.ACCESS_TOKEN);let y="";return y=h&&h.u?s.k(h.u):s.e.ACCESS_TOKEN||"",l?`${Me}.${l}:${y}`:`${Me}:${y}`}fetchEventData(){const l=s.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid");if(l)try{const S=localStorage.getItem(h);S&&(this.eventData=JSON.parse(S));const E=localStorage.getItem(y);E&&(this.anonId=E)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const l=s.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid"),S=this.anonId;if(l&&S)try{localStorage.setItem(y,S),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,h,y,S){if(!s.e.EVENTS_URL)return;const E=qe(s.e.EVENTS_URL);E.params.push(`access_token=${S||s.e.ACCESS_TOKEN||""}`);const I={event:this.type,created:new Date(l).toISOString()},G=h?s.l(I,h):I,$={url:ft(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([G])};this.pendingRequest=s.p($,Y=>{this.pendingRequest=null,y(Y),this.saveEventData(),this.processRequests(S)})}queueRequest(l,h){this.queue.push(l),this.processRequests(h)}}const Mt=new class extends ut{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,l){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(h=>s.f(h)||s.h(h))&&this.queueRequest(Date.now(),l)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=$e(s.e.ACCESS_TOKEN),h=l?l.u:s.e.ACCESS_TOKEN;let y=h!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),y=!0);const S=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),I=new Date(S),G=(S-this.eventData.lastSuccess)/864e5;y=y||G>=1||G<-1||E.getDate()!==I.getDate()}else y=!0;y?this.postEvent(S,{sdkIdentifier:"mapbox-gl-js",sdkVersion:f,skuId:We,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=S,this.eventData.tokenU=h)},g):this.processRequests()}},Gt=Mt.postTurnstileEvent.bind(Mt),Xt=new class extends ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,l,h,y){this.skuToken=l,this.errorCb=y,s.e.EVENTS_URL&&(h||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(rt)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:h}=this.queue.shift();l&&this.success[l]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:f,skuId:We,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},g))}remove(){this.errorCb=null}},Qe=Xt.postMapLoadEvent.bind(Xt),Ge=new class extends ut{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let l=this.mapInstanceIdMap.get(g);return l||(l=s.u(),this.mapInstanceIdMap.set(g,l)),l}getEventId(g){const l=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,l+1),l}postStyleLoadEvent(g,l){const{map:h,style:y,importedStyles:S}=l;if(!s.e.EVENTS_URL||!g&&!s.e.ACCESS_TOKEN)return;const E=this.getMapInstanceId(h),I={mapInstanceId:E,eventId:this.getEventId(E),style:y};S.length&&(I.importedStyles=S),this.queueRequest({timestamp:Date.now(),payload:I},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:h}=this.queue.shift();this.postEvent(l,h,()=>{},g)}},He=Ge.postStyleLoadEvent.bind(Ge),De=new class extends ut{constructor(){super("gljs.performance")}postPerformanceEvent(g,l){s.e.EVENTS_URL&&(g||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:h}=this.queue.shift(),y=function(S){const E=performance.getEntriesByType("resource"),I=performance.getEntriesByType("mark"),G=function(he){const ye={};if(he){for(const ve in he)if(ve!=="other")for(const be of he[ve]){const Ce=`${ve}ResolveRangeMin`,Fe=`${ve}ResolveRangeMax`,ze=`${ve}RequestCount`,Ue=`${ve}RequestCachedCount`;ye[Ce]=Math.min(ye[Ce]||1/0,be.startTime),ye[Fe]=Math.max(ye[Fe]||-1/0,be.responseEnd);const Ze=Ke=>{ye[Ke]===void 0&&(ye[Ke]=0),++ye[Ke]};be.transferSize!==void 0&&be.transferSize===0&&Ze(Ue),Ze(ze)}}return ye}(function(he,ye){const ve={};if(he)for(const be of he){const Ce=ye(be);ve[Ce]===void 0&&(ve[Ce]=[]),ve[Ce].push(be)}return ve}(E,C)),$=window.devicePixelRatio,Y=navigator.connection||navigator.mozConnection||navigator.webkitConnection,X=Y?Y.effectiveType:void 0,ee={counters:[],metadata:[],attributes:[]},ie=(he,ye,ve)=>{ve!=null&&he.push({name:ye,value:ve.toString()})};for(const he in G)ie(ee.counters,he,G[he]);if(S.interactionRange[0]!==1/0&&S.interactionRange[1]!==-1/0&&(ie(ee.counters,"interactionRangeMin",S.interactionRange[0]),ie(ee.counters,"interactionRangeMax",S.interactionRange[1])),I)for(const he of Object.keys(v)){const ye=v[he],ve=I.find(be=>be.name===ye);ve&&ie(ee.counters,ye,ve.startTime)}return ie(ee.counters,"visibilityHidden",S.visibilityHidden),ie(ee.attributes,"style",function(he){if(he)for(const ye of he){const ve=ye.name.split("?")[0];if(s.i(ve)){const be=ve.split("/").slice(-2);if(be.length===2)return`mapbox://styles/${be[0]}/${be[1]}`}}}(E)),ie(ee.attributes,"terrainEnabled",S.terrainEnabled?"true":"false"),ie(ee.attributes,"fogEnabled",S.fogEnabled?"true":"false"),ie(ee.attributes,"projection",S.projection),ie(ee.attributes,"zoom",S.zoom),ie(ee.metadata,"devicePixelRatio",$),ie(ee.metadata,"connectionEffectiveType",X),ie(ee.metadata,"navigatorUserAgent",navigator.userAgent),ie(ee.metadata,"screenWidth",window.screen.width),ie(ee.metadata,"screenHeight",window.screen.height),ie(ee.metadata,"windowWidth",window.innerWidth),ie(ee.metadata,"windowHeight",window.innerHeight),ie(ee.metadata,"mapWidth",S.width/$),ie(ee.metadata,"mapHeight",S.height/$),ie(ee.metadata,"webglRenderer",S.renderer),ie(ee.metadata,"webglVendor",S.vendor),ie(ee.metadata,"sdkVersion",f),ie(ee.metadata,"sdkIdentifier","mapbox-gl-js"),ee}(h);for(const S of y.metadata);for(const S of y.counters);for(const S of y.attributes);this.postEvent(l,y,()=>{},g)}},kt=De.postPerformanceEvent.bind(De),rn=new class extends ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,l,h,y){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const S=qe(s.e.API_URL+s.e.SESSION_PATH);S.params.push(`sku=${l||""}`),S.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const E={url:ft(S),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(E,I=>{this.pendingRequest=null,h(I),this.saveEventData(),this.processRequests(y)})}getSessionAPI(g,l,h,y){this.skuToken=l,this.errorCb=y,s.e.SESSION_PATH&&s.e.API_URL&&(h||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(rt)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:h}=this.queue.shift();l&&this.success[l]||this.getSession(h,this.skuToken,y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},g)}remove(){this.errorCb=null}},Re=rn.getSessionAPI.bind(rn),Kt=new Set;function bt(g,l){l?Kt.add(g):Kt.delete(g)}class Dt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,h){this._updatedSourceCaches[l]=h,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const h=l.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(l.id),this.setDirty()}removeLayer(l){const h=l.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][l.id]=l,this._updatedLayers[h].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const h in this._updatedLayers)l[h]=l[h]||{},l[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)l[h]=l[h]||{},l[h].removedIds=Object.keys(this._removedLayers[h]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function _e(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class At extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new s.r({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,h){if(this.loaded[h]!==l&&(this.loaded[h]=l,l)){for(const{ids:y,callback:S}of this.requestors)this._notify(y,h,S);this.requestors=[]}}hasImage(l,h){return!!this.getImage(l,h)}getImage(l,h){return this.images[h][l]}addImage(l,h,y){this._validate(l,y)&&(this.images[h][l]=y)}_validate(l,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new s.t(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new s.t(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new s.t(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const S of l){if(S[0]<y||S[1]<S[0]||h<S[1])return!1;y=S[1]}return!0}_validateContent(l,h){return!(l&&(l.length!==4||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,h,y){y.version=this.images[h][l].version+1,this.images[h][l]=y,this.updatedImages[h][l]=!0}removeImage(l,h){const y=this.images[h][l];delete this.images[h][l],delete this.patterns[h][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,h,y){let S=!0;const E=!!this.loaded[h];if(!E)for(const I of l)this.images[h][I]||(S=!1);E||S?this._notify(l,h,y):this.requestors.push({ids:l,scope:h,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,h,y){const S={};for(const E of l){this.images[h][E]||this.fire(new s.x("styleimagemissing",{id:E}));const I=this.images[h][E];I?S[E]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)}:s.w(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,S)}getPixelSize(l){const{width:h,height:y}=this.atlasImage[l];return{width:h,height:y}}getPattern(l,h,y){const S=this.patterns[h][l],E=this.getImage(l,h);if(!E)return null;if(S&&S.position.version===E.version)return S.position;if(S)S.position.version=E.version;else{const I={w:E.data.width+2*s.y,h:E.data.height+2*s.y,x:0,y:0},G=new s.I(I,E,s.y);this.patterns[h][l]={bin:I,position:G}}return this._updatePatternAtlas(h,y),this.patterns[h][l].position}bind(l,h){const y=l.gl;let S=this.atlasTexture[h];S?this.dirty&&(S.update(this.atlasImage[h]),this.dirty=!1):(S=new s.T(l,this.atlasImage[h],y.RGBA8),this.atlasTexture[h]=S),S.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,h){const y=[];for(const G in this.patterns[l])y.push(this.patterns[l][G].bin);const{w:S,h:E}=s.z(y),I=this.atlasImage[l];I.resize({width:S||1,height:E||1});for(const G in this.patterns[l]){const{bin:$,position:Y}=this.patterns[l][G];let X=Y.padding;const ee=$.x+X,ie=$.y+X,he=this.images[l][G].data,ye=he.width,ve=he.height;X=X>1?X-1:X,s.r.copy(he,I,{x:0,y:0},{x:ee,y:ie},{width:ye,height:ve},h),s.r.copy(he,I,{x:0,y:ve-X},{x:ee,y:ie-X},{width:ye,height:X},h),s.r.copy(he,I,{x:0,y:0},{x:ee,y:ie+ve},{width:ye,height:X},h),s.r.copy(he,I,{x:ye-X,y:0},{x:ee-X,y:ie},{width:X,height:ve},h),s.r.copy(he,I,{x:0,y:0},{x:ee+ye,y:ie},{width:X,height:ve},h),s.r.copy(he,I,{x:ye-X,y:ve-X},{x:ee-X,y:ie-X},{width:X,height:X},h),s.r.copy(he,I,{x:0,y:ve-X},{x:ee+ye,y:ie-X},{width:X,height:X},h),s.r.copy(he,I,{x:0,y:0},{x:ee+ye,y:ie+ve},{width:X,height:X},h),s.r.copy(he,I,{x:ye-X,y:0},{x:ee-X,y:ie+ve},{width:X,height:X},h)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,h){for(const y of l){if(this.callbackDispatchedThisFrame[h][y])continue;this.callbackDispatchedThisFrame[h][y]=!0;const S=this.images[h][y];_e(S)&&this.updateImage(y,h,S)}}}function Ot(g){const l=g.key,h=g.value,y=g.valueSpec||{},S=g.objectElementValidators||{},E=g.style,I=g.styleSpec;let G=[];const $=s.B(h);if($!=="object")return[new s.V(l,h,`object expected, ${$} found`)];for(const Y in h){const X=Y.split(".")[0];let ee;S[X]?ee=S[X]:y[X]?ee=vi:S["*"]?ee=S["*"]:y["*"]&&(ee=vi),ee?G=G.concat(ee({key:(l&&`${l}.`)+Y,value:h[Y],valueSpec:y[X]||y["*"],style:E,styleSpec:I,object:h,objectKey:Y},h)):G.push(new s.A(l,h[Y],`unknown property "${Y}"`))}for(const Y in y)S[Y]||y[Y].required&&y[Y].default===void 0&&h[Y]===void 0&&G.push(new s.V(l,h,`missing required property "${Y}"`));return G}function tn(g){const l=g.value,h=g.valueSpec,y=g.style,S=g.styleSpec,E=g.key,I=g.arrayElementValidator||vi;if(s.B(l)!=="array")return[new s.V(E,l,`array expected, ${s.B(l)} found`)];if(h.length&&l.length!==h.length)return[new s.V(E,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new s.V(E,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let G={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};S.$version<7&&(G.function=h.function),s.B(h.value)==="object"&&(G=h.value);let $=[];for(let Y=0;Y<l.length;Y++)$=$.concat(I({array:l,arrayIndex:Y,value:l[Y],valueSpec:G,style:y,styleSpec:S,key:`${E}[${Y}]`},!0));return $}function xe(g){const l=g.key,h=g.value,y=g.valueSpec;let S=s.B(h);if(S==="number"&&h!=h&&(S="NaN"),S!=="number")return[new s.V(l,h,`number expected, ${S} found`)];if("minimum"in y){let E=y.minimum;if(s.B(y.minimum)==="array"&&(E=y.minimum[g.arrayIndex]),h<E)return[new s.V(l,h,`${h} is less than the minimum value ${E}`)]}if("maximum"in y){let E=y.maximum;if(s.B(y.maximum)==="array"&&(E=y.maximum[g.arrayIndex]),h>E)return[new s.V(l,h,`${h} is greater than the maximum value ${E}`)]}return[]}function Se(g){const l=g.valueSpec,h=s.D(g.value.type);let y,S,E,I={};const G=h!=="categorical"&&g.value.property===void 0,$=!G,Y=s.B(g.value.stops)==="array"&&s.B(g.value.stops[0])==="array"&&s.B(g.value.stops[0][0])==="object",X=Ot({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(he){if(h==="identity")return[new s.V(he.key,he.value,'identity function may not have a "stops" property')];let ye=[];const ve=he.value;return ye=ye.concat(tn({key:he.key,value:ve,valueSpec:he.valueSpec,style:he.style,styleSpec:he.styleSpec,arrayElementValidator:ee})),s.B(ve)==="array"&&ve.length===0&&ye.push(new s.V(he.key,ve,"array must have at least one stop")),ye},default:function(he){return vi({key:he.key,value:he.value,valueSpec:l,style:he.style,styleSpec:he.styleSpec})}}});return h==="identity"&&G&&X.push(new s.V(g.key,g.value,'missing required property "property"')),h==="identity"||g.value.stops||X.push(new s.V(g.key,g.value,'missing required property "stops"')),h==="exponential"&&g.valueSpec.expression&&!s.F(g.valueSpec)&&X.push(new s.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&($&&!s.G(g.valueSpec)?X.push(new s.V(g.key,g.value,"property functions not supported")):G&&!s.H(g.valueSpec)&&X.push(new s.V(g.key,g.value,"zoom functions not supported"))),h!=="categorical"&&!Y||g.value.property!==void 0||X.push(new s.V(g.key,g.value,'"property" property is required')),X;function ee(he){let ye=[];const ve=he.value,be=he.key;if(s.B(ve)!=="array")return[new s.V(be,ve,`array expected, ${s.B(ve)} found`)];if(ve.length!==2)return[new s.V(be,ve,`array length 2 expected, length ${ve.length} found`)];if(Y){if(s.B(ve[0])!=="object")return[new s.V(be,ve,`object expected, ${s.B(ve[0])} found`)];if(ve[0].zoom===void 0)return[new s.V(be,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new s.V(be,ve,"object stop key must have value")];const Ce=s.D(ve[0].zoom);if(typeof Ce!="number")return[new s.V(be,ve[0].zoom,"stop zoom values must be numbers")];if(E&&E>Ce)return[new s.V(be,ve[0].zoom,"stop zoom values must appear in ascending order")];Ce!==E&&(E=Ce,S=void 0,I={}),ye=ye.concat(Ot({key:`${be}[0]`,value:ve[0],valueSpec:{zoom:{}},style:he.style,styleSpec:he.styleSpec,objectElementValidators:{zoom:xe,value:ie}}))}else ye=ye.concat(ie({key:`${be}[0]`,value:ve[0],valueSpec:{},style:he.style,styleSpec:he.styleSpec},ve));return s.J(s.K(ve[1]))?ye.concat([new s.V(`${be}[1]`,ve[1],"expressions are not allowed in function stops.")]):ye.concat(vi({key:`${be}[1]`,value:ve[1],valueSpec:l,style:he.style,styleSpec:he.styleSpec}))}function ie(he,ye){const ve=s.B(he.value),be=s.D(he.value),Ce=he.value!==null?he.value:ye;if(y){if(ve!==y)return[new s.V(he.key,Ce,`${ve} stop domain type must match previous stop domain type ${y}`)]}else y=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean"&&typeof be!="number"&&typeof be!="string"&&typeof be!="boolean")return[new s.V(he.key,Ce,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&h!=="categorical"){let Fe=`number expected, ${ve} found`;return s.G(l)&&h===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(he.key,Ce,Fe)]}return h!=="categorical"||ve!=="number"||typeof be=="number"&&isFinite(be)&&Math.floor(be)===be?h!=="categorical"&&ve==="number"&&typeof be=="number"&&typeof S=="number"&&S!==void 0&&be<S?[new s.V(he.key,Ce,"stop domain values must appear in ascending order")]:(S=be,h==="categorical"&&be in I?[new s.V(he.key,Ce,"stop domain values must be unique")]:(I[be]=!0,[])):[new s.V(he.key,Ce,`integer expected, found ${String(be)}`)]}}function it(g){const l=(g.expressionContext==="property"?s.L:s.M)(s.K(g.value),g.valueSpec);if(l.result==="error")return l.value.map(y=>new s.V(`${g.key}${y.key}`,g.value,y.message));const h=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!h.outputDefined())return[new s.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!s.N(h))return[new s.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Le(h,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!s.O(h,["zoom","feature-state"]))return[new s.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!s.Q(h))return[new s.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Le(g,l){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const S of l.valueSpec.expression.parameters)h.delete(S);if(h.size===0)return[];const y=[];return g instanceof s.S&&h.has(g.name)?[new s.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(S=>{y.push(...Le(S,l))}),y)}function Pe(g){const l=g.key,h=g.value,y=g.valueSpec,S=[];return Array.isArray(y.values)?y.values.indexOf(s.D(h))===-1&&S.push(new s.V(l,h,`expected one of [${y.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(y.values).indexOf(s.D(h))===-1&&S.push(new s.V(l,h,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(h)} found`)),S}function vt(g){return s.W(s.K(g.value))?it(s.C({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):yt(g)}function yt(g){const l=g.value,h=g.key;if(s.B(l)!=="array")return[new s.V(h,l,`array expected, ${s.B(l)} found`)];const y=g.styleSpec;let S,E=[];if(l.length<1)return[new s.V(h,l,"filter array must have at least 1 element")];switch(E=E.concat(Pe({key:`${h}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),s.D(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&s.D(l[1])==="$type"&&E.push(new s.V(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new s.V(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(S=s.B(l[1]),S!=="string"&&E.push(new s.V(`${h}[1]`,l[1],`string expected, ${S} found`)));for(let I=2;I<l.length;I++)S=s.B(l[I]),s.D(l[1])==="$type"?E=E.concat(Pe({key:`${h}[${I}]`,value:l[I],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&E.push(new s.V(`${h}[${I}]`,l[I],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let I=1;I<l.length;I++)E=E.concat(yt({key:`${h}[${I}]`,value:l[I],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":S=s.B(l[1]),l.length!==2?E.push(new s.V(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):S!=="string"&&E.push(new s.V(`${h}[1]`,l[1],`string expected, ${S} found`))}return E}function nn(g,l){const h=g.key,y=g.style,S=g.layer,E=g.styleSpec,I=g.value,G=g.objectKey,$=E[`${l}_${g.layerType}`];if(!$)return[];const Y=G.match(/^(.*)-transition$/);if(l==="paint"&&Y&&$[Y[1]]&&$[Y[1]].transition)return vi({key:h,value:I,valueSpec:E.transition,style:y,styleSpec:E});const X=g.valueSpec||$[G];if(!X)return[new s.A(h,I,`unknown property "${G}"`)];let ee;if(s.B(I)==="string"&&s.G(X)&&!X.tokens&&(ee=/^{([^}]+)}$/.exec(I))){const he=`\`{ "type": "identity", "property": ${ee?JSON.stringify(ee[1]):'"_"'} }\``;return[new s.V(h,I,`"${G}" does not support interpolation syntax
Use an identity property function instead: ${he}.`)]}const ie=[];if(g.layerType==="symbol")G!=="text-field"||!y||y.glyphs||y.imports||ie.push(new s.V(h,I,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&s.X(s.K(I))&&s.D(I.type)==="identity"&&ie.push(new s.V(h,I,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&S&&S.layout&&S.layout.hasOwnProperty("model-id")&&s.G(X)&&(s.Y(X)||s.H(X))){const he=s.L(s.K(I),X),ye=he.value.expression||he.value._styleExpression.expression;ye&&!s.O(ye,["measure-light"])&&(G==="model-emissive-strength"&&s.Q(ye)&&s.N(ye)||ie.push(new s.V(h,I,`${G} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ie.concat(vi({key:g.key,value:I,valueSpec:X,style:y,styleSpec:E,expressionContext:"property",propertyType:l,propertyKey:G}))}function jt(g){return nn(g,"paint")}function Fn(g){return nn(g,"layout")}function Bn(g){let l=[];const h=g.value,y=g.key,S=g.style,E=g.styleSpec;h.type||h.ref||l.push(new s.V(y,h,'either "type" or "ref" is required'));let I=s.D(h.type);const G=s.D(h.ref);if(h.id){const $=s.D(h.id);for(let Y=0;Y<g.arrayIndex;Y++){const X=S.layers[Y];s.D(X.id)===$&&l.push(new s.V(y,h.id,`duplicate layer id "${h.id}", previously used at line ${X.id.__line__}`))}}if("ref"in h){let $;["type","source","source-layer","filter","layout"].forEach(Y=>{Y in h&&l.push(new s.V(y,h[Y],`"${Y}" is prohibited for ref layers`))}),S.layers.forEach(Y=>{s.D(Y.id)===G&&($=Y)}),$?$.ref?l.push(new s.V(y,h.ref,"ref cannot reference another ref layer")):I=s.D($.type):typeof G=="string"&&l.push(new s.V(y,h.ref,`ref layer "${G}" not found`))}else if(I!=="background"&&I!=="sky"&&I!=="slot")if(h.source){const $=S.sources&&S.sources[h.source],Y=$&&s.D($.type);$?Y==="vector"&&I==="raster"?l.push(new s.V(y,h.source,`layer "${h.id}" requires a raster source`)):Y==="raster"&&I!=="raster"?l.push(new s.V(y,h.source,`layer "${h.id}" requires a vector source`)):Y!=="vector"||h["source-layer"]?Y==="raster-dem"&&I!=="hillshade"?l.push(new s.V(y,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):Y!=="raster-array"||["raster","raster-particle"].includes(I)?I!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||Y==="geojson"&&$.lineMetrics?I==="raster-particle"&&Y!=="raster-array"&&l.push(new s.V(y,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):l.push(new s.V(y,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new s.V(y,h.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new s.V(y,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new s.V(y,h.source,`source "${h.source}" not found`))}else l.push(new s.V(y,h,'missing required property "source"'));return l=l.concat(Ot({key:y,value:h,valueSpec:E.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>vi({key:`${y}.type`,value:h.type,valueSpec:E.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:$=>vt(s.C({layerType:I},$)),layout:$=>Ot({layer:h,key:$.key,value:$.value,valueSpec:{},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{"*":Y=>Fn(s.C({layerType:I},Y))}}),paint:$=>Ot({layer:h,key:$.key,value:$.value,valueSpec:{},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{"*":Y=>jt(s.C({layerType:I,layer:h},Y))}})}})),l}function Zn(g){const l=g.value,h=g.key,y=s.B(l);return y!=="string"?[new s.V(h,l,`string expected, ${y} found`)]:[]}const Li={promoteId:function({key:g,value:l}){if(s.B(l)==="string")return Zn({key:g,value:l});{const h=[];for(const y in l)h.push(...Zn({key:`${g}.${y}`,value:l[y]}));return h}}};function zn(g){const l=g.value,h=g.key,y=g.styleSpec,S=g.style;if(!l.type)return[new s.V(h,l,'"type" is required')];const E=s.D(l.type);let I=[];switch(["vector","raster","raster-dem","raster-array"].includes(E)&&(l.url||l.tiles||I.push(new s.A(h,l,'Either "url" or "tiles" is required.'))),E){case"vector":case"raster":case"raster-dem":case"raster-array":return I=I.concat(Ot({key:h,value:l,valueSpec:y[`source_${E.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Li})),I;case"geojson":if(I=Ot({key:h,value:l,valueSpec:y.source_geojson,style:S,styleSpec:y,objectElementValidators:Li}),l.cluster)for(const G in l.clusterProperties){const[$,Y]=l.clusterProperties[G],X=typeof $=="string"?[$,["accumulated"],["get",G]]:$;I.push(...it({key:`${h}.${G}.map`,value:Y,expressionContext:"cluster-map"})),I.push(...it({key:`${h}.${G}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return I;case"video":return Ot({key:h,value:l,valueSpec:y.source_video,style:S,styleSpec:y});case"image":return Ot({key:h,value:l,valueSpec:y.source_image,style:S,styleSpec:y});case"canvas":return[new s.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pe({key:`${h}.type`,value:l.type,valueSpec:{values:oi(y)},style:S,styleSpec:y})}}function oi(g){return g.source.reduce((l,h)=>{const y=g[h];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function gi(g){const l=g.value,h=g.styleSpec,y=h.light,S=g.style;let E=[];const I=s.B(l);if(l===void 0)return E;if(I!=="object")return E=E.concat([new s.V("light",l,`object expected, ${I} found`)]),E;for(const G in l){const $=G.match(/^(.*)-transition$/);E=E.concat($&&y[$[1]]&&y[$[1]].transition?vi({key:G,value:l[G],valueSpec:h.transition,style:S,styleSpec:h}):y[G]?vi({key:G,value:l[G],valueSpec:y[G],style:S,styleSpec:h}):[new s.V(G,l[G],`unknown property "${G}"`)])}return E}function Ti(g){const l=g.value;let h=[];if(!l)return h;const y=s.B(l);if(y!=="object")return h=h.concat([new s.V("light-3d",l,`object expected, ${y} found`)]),h;const S=g.styleSpec,E=S["light-3d"],I=g.key,G=g.style,$=g.style.lights;for(const ee of["type","id"])if(!(ee in l))return h=h.concat([new s.V("light-3d",l,`missing property ${ee} on light`)]),h;if(l.type&&$)for(let ee=0;ee<g.arrayIndex;ee++){const ie=s.D(l.type),he=$[ee];s.D(he.type)===ie&&h.push(new s.V(I,l.id,`duplicate light type "${l.type}", previously defined at line ${he.id.__line__}`))}const Y=`properties_light_${l.type}`;if(!(Y in S))return h=h.concat([new s.V("light-3d",l,`Invalid light type ${l.type}`)]),h;const X=S[Y];for(const ee in l)if(ee==="properties"){const ie=l[ee],he=s.B(ie);if(he!=="object")return h=h.concat([new s.V("properties",ie,`object expected, ${he} found`)]),h;for(const ye in ie)h=h.concat(X[ye]?vi({key:ye,value:ie[ye],valueSpec:X[ye],style:G,styleSpec:S}):[new s.A(g.key,ie[ye],`unknown property "${ye}"`)])}else{const ie=ee.match(/^(.*)-transition$/);h=h.concat(ie&&E[ie[1]]&&E[ie[1]].transition?vi({key:ee,value:l[ee],valueSpec:S.transition,style:G,styleSpec:S}):E[ee]?vi({key:ee,value:l[ee],valueSpec:E[ee],style:G,styleSpec:S}):[new s.A(ee,l[ee],`unknown property "${ee}"`)])}return h}function pi(g){const l=g.value,h=g.key,y=g.style,S=g.styleSpec,E=S.terrain;let I=[];const G=s.B(l);if(l===void 0||G==="null")return I;if(G!=="object")return I=I.concat([new s.V("terrain",l,`object expected, ${G} found`)]),I;for(const $ in l){const Y=$.match(/^(.*)-transition$/);I=I.concat(Y&&E[Y[1]]&&E[Y[1]].transition?vi({key:$,value:l[$],valueSpec:S.transition,style:y,styleSpec:S}):E[$]?vi({key:$,value:l[$],valueSpec:E[$],style:y,styleSpec:S}):[new s.A($,l[$],`unknown property "${$}"`)])}if(l.source){const $=y.sources&&y.sources[l.source],Y=$&&s.D($.type);$?Y!=="raster-dem"&&I.push(new s.V(h,l.source,`terrain cannot be used with a source of type ${String(Y)}, it only be used with a "raster-dem" source type`)):I.push(new s.V(h,l.source,`source "${l.source}" not found`))}else I.push(new s.V(h,l,'terrain is missing required property "source"'));return I}function Ji(g){const l=g.value,h=g.style,y=g.styleSpec,S=y.fog;let E=[];const I=s.B(l);if(l===void 0)return E;if(I!=="object")return E=E.concat([new s.V("fog",l,`object expected, ${I} found`)]),E;for(const G in l){const $=G.match(/^(.*)-transition$/);E=E.concat($&&S[$[1]]&&S[$[1]].transition?vi({key:G,value:l[G],valueSpec:y.transition,style:h,styleSpec:y}):S[G]?vi({key:G,value:l[G],valueSpec:S[G],style:h,styleSpec:y}):[new s.A(G,l[G],`unknown property "${G}"`)])}return E}const er={"*":()=>[],array:tn,boolean:function(g){const l=g.value,h=g.key,y=s.B(l);return y!=="boolean"?[new s.V(h,l,`boolean expected, ${y} found`)]:[]},number:xe,color:function(g){const l=g.key,h=g.value,y=s.B(h);return y!=="string"?[new s.V(l,h,`color expected, ${y} found`)]:s.U.parseCSSColor(h)===null?[new s.V(l,h,`color expected, "${h}" found`)]:[]},enum:Pe,filter:vt,function:Se,layer:Bn,object:Ot,source:zn,model:s.Z,light:gi,"light-3d":Ti,terrain:pi,fog:Ji,string:Zn,formatted:function(g){return Zn(g).length===0?[]:it(g)},resolvedImage:function(g){return Zn(g).length===0?[]:it(g)},projection:function(g){const l=g.value,h=g.styleSpec,y=h.projection,S=g.style;let E=[];const I=s.B(l);if(I==="object")for(const G in l)E=E.concat(vi({key:G,value:l[G],valueSpec:y[G],style:S,styleSpec:h}));else I!=="string"&&(E=E.concat([new s.V("projection",l,`object or string expected, ${I} found`)]));return E},import:function(g){const{value:l,styleSpec:h}=g,{data:y,...S}=l;Object.defineProperty(S,"__line__",{value:l.__line__,enumerable:!1});let E=Ot(s.C({},g,{value:S,valueSpec:h.import}));return s.D(S.id)===""&&E.push(new s.V(`${g.key}.id`,S,"import id can't be an empty string")),y&&(E=E.concat(ui(y,h,{key:`${g.key}.data`}))),E}};function vi(g,l=!1){const h=g.value,y=g.valueSpec,S=g.styleSpec;if(y.expression&&s.X(s.D(h)))return Se(g);if(y.expression&&s.J(s.K(h)))return it(g);if(y.type&&er[y.type]){const E=er[y.type](g);return l===!0&&E.length>0&&s.B(g.value)==="array"?it(g):E}return Ot(s.C({},g,{valueSpec:y.type?S[y.type]:y}))}function Wt(g){const l=g.value,h=g.key,y=Zn(g);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new s.V(h,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new s.V(h,l,'"glyphs" url must include a "{range}" token'))),y}function ui(g,l=s._,h={}){return vi({key:h.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:Wt,"*":()=>[]}})}function vn(g,l=s._){return nt(ui(g,l))}const Ln=g=>nt(zn(g)),mi=g=>nt(gi(g)),hi=g=>nt(Ti(g)),Xi=g=>nt(pi(g)),cs=g=>nt(Ji(g)),Ft=g=>nt(Bn(g)),we=g=>nt(vt(g)),Ie=g=>nt(jt(g)),je=g=>nt(Fn(g)),pt=g=>nt(s.Z(g));function nt(g){return g.slice().sort((l,h)=>l.line&&h.line?l.line-h.line:0)}function wt(g,l){let h=!1;if(l&&l.length)for(const y of l)y instanceof s.A?s.w(y.message):(g.fire(new s.t(new Error(y.message))),h=!0);return h}let zt;class St extends s.E{constructor(l,h="flat"){super(),this._transitionable=new s.$(zt||(zt=new s.a0({anchor:new s.a1(s._.light.anchor),position:new s.a2(s._.light.position),color:new s.a1(s._.light.color),intensity:new s.a1(s._.light.intensity)}))),this.setLight(l,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h,y={}){this._validate(mi,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=h)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||y.validate!==!1)&&wt(this,l.call(vn,s.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}let Bt=class extends s.E{constructor(g,l,h,y){super(),this.scope=h,this._transitionable=new s.$(new s.a0({source:new s.a1(s._.terrain.source),exaggeration:new s.a1(s._.terrain.exaggeration)}),h,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new s.a3(g)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const l=g.value.expression;if(!l)return null;let h=-1,y=-1,S=1;for(const E of l.zoomStops)S=l.evaluate(new s.a3(E)),S>.01?(h=E,y=-1):y=E;return S<.01&&h>0&&y>h?[h,y]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof s.a4}};const Zt=45,Yt=65,fn=.05;function In(g,l,h,y){const S=s.a7(Zt,Yt,h),[E,I]=Gn(g,y);let G=1-Math.min(1,Math.exp((l-E)/(I-E)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*g.alpha}function Gn(g,l){const h=.5/Math.tan(.5*l);return[g.range[0]+h,g.range[1]+h]}function Ci(g,l,h,y,S){const E=s.a6.vec3.transformMat4([],[l,h,y],S.mercatorFogMatrix);return In(g,s.a6.vec3.length(E),S.pitch,S._fov)}function Ri(g,l,h,y,S,E,I){const G=[[h,y,0],[S,y,0],[S,E,0],[h,E,0]];let $=Number.MAX_VALUE,Y=-Number.MAX_VALUE;for(const X of G){const ee=s.a6.vec3.transformMat4([],X,l),ie=s.a6.vec3.length(ee);$=Math.min($,ie),Y=Math.max(Y,ie)}return[In(g,$,I.pitch,I._fov),In(g,Y,I.pitch,I._fov)]}class Mi extends s.E{constructor(l,h,y,S){super();const E=new s.a0({range:new s.a1(s._.fog.range),color:new s.a1(s._.fog.color),"high-color":new s.a1(s._.fog["high-color"]),"space-color":new s.a1(s._.fog["space-color"]),"horizon-blend":new s.a1(s._.fog["horizon-blend"]),"star-intensity":new s.a1(s._.fog["star-intensity"]),"vertical-range":new s.a1(s._.fog["vertical-range"])});this._transitionable=new s.$(E,y,new Map(S)),this.set(l,S),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new s.a8(E),this.scope=y}get state(){const l=this._transform,h=l.projection.name==="globe",y=s.a9(l.zoom),S=this.properties.get("range"),E=[.5,3];return{range:h?[s.aa(E[0],S[0],y),s.aa(E[1],S[1],y)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,h,y={}){if(this._validate(cs,l,y))return;const S=s.l({},l);for(const E of Object.keys(s._.fog))S[E]===void 0&&(S[E]=s._.fog[E].default);this._options=S,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.a7(Zt,Yt,l))*h.a}getOpacityAtLatLng(l,h){return this._transform.projection.supportsFog?function(y,S,E){const I=s.a5.fromLngLat(S),G=E.elevation?E.elevation.getAtPointOrZero(I):0;return Ci(y,I.x,I.y,G,E)}(this.state,l,h):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Ri(this.state,h,0,0,s.ab,s.ab,this._transform)}getOpacityForBounds(l,h,y,S,E){return this._transform.projection.supportsFog?Ri(this.state,l,h,y,S,E,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Gn(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const y of h){const S=l.points[y];let E;if(S[2]>=0)E=S;else{const I=l.points[y-4];E=s.ac(I,S,I[2]/(I[2]-S[2]))}if(Ci(this.state,E[0],E[1],0,this._transform)>=fn)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||y.validate!==!1)&&wt(this,l.call(vn,s.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}class Be extends s.E{constructor(l,h,y,S){super(),this.scope=y,this._options=l,this.properties=new s.a8(h),this._transitionable=new s.$(h,y,new Map(S)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,h){this._options=l,this._transitionable.setTransitionOrValue(l.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Pt,$t;class ht{constructor(l,h,y,S){this.screenBounds=l,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(l,h){let y,S;if(l instanceof s.P||typeof l[0]=="number"){const E=s.P.convert(l);y=[E],S=h.isPointAboveHorizon(E)}else{const E=s.P.convert(l[0]),I=s.P.convert(l[1]);y=[E,I],S=s.ae(E,I).every(G=>h.isPointAboveHorizon(G))}return new ht(y,h.getCameraPoint(),S,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],S=s.ae(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?S[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(S[3]=this.cameraPoint)),s.af(S,l)}bufferedCameraGeometryGlobe(l){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],S=s.ae(h,y,l),E=this.cameraPoint.clone();switch(3*((E.y>h.y)+(E.y>y.y))+((E.x>h.x)+(E.x>y.x))){case 0:S[0]=E,S[4]=E.clone();break;case 1:S.splice(1,0,E);break;case 2:S[1]=E;break;case 3:S.splice(4,0,E);break;case 5:S.splice(2,0,E);break;case 6:S[3]=E;break;case 7:S.splice(3,0,E);break;case 8:S[2]=E}return S}containsTile(l,h,y,S=0){const E=l.queryPadding/h._pixelsPerMercatorPixel+1,I=y?this._bufferedCameraMercator(E,h):this._bufferedScreenMercator(E,h);let G=l.tileID.wrap+(I.unwrapped?S:0);const $=I.polygon.map(be=>s.ag(l.tileTransform,be,G));if(!s.ah($,0,0,s.ab,s.ab))return;G=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const Y=this.screenGeometryMercator.polygon.map(be=>s.ai(l.tileTransform,be,G)),X=Y.map(be=>new s.P(be[0],be[1])),ee=h.getFreeCameraOptions().position||new s.a5(0,0,0),ie=s.ai(l.tileTransform,ee,G),he=Y.map(be=>{const Ce=s.a6.vec3.sub(be,be,ie);return s.a6.vec3.normalize(Ce,Ce),new s.aj(ie,Ce)}),ye=s.ak(l,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:he,bufferedTilespaceGeometry:$,bufferedTilespaceBounds:(ve=s.al($),ve.min.x=s.ap(ve.min.x,0,s.ab),ve.min.y=s.ap(ve.min.y,0,s.ab),ve.max.x=s.ap(ve.max.x,0,s.ab),ve.max.y=s.ap(ve.max.y,0,s.ab),ve),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:ye};var ve}_bufferedScreenMercator(l,h){const y=Dn(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let S;return S=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),h):{polygon:this.bufferedScreenGeometry(l).map(E=>h.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[y]=S,S}}_bufferedCameraMercator(l,h){const y=Dn(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let S;return S=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),h):{polygon:this.bufferedCameraGeometry(l).map(E=>h.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[y]=S,S}}_projectAndResample(l,h){const y=function(E,I){const G=s.a6.mat4.multiply([],I.pixelMatrix,I.globeMatrix),$=[0,-s.aq,0,1],Y=[0,s.aq,0,1],X=[0,0,0,1];s.a6.vec4.transformMat4($,$,G),s.a6.vec4.transformMat4(Y,Y,G),s.a6.vec4.transformMat4(X,X,G);const ee=new s.P($[0]/$[3],$[1]/$[3]),ie=new s.P(Y[0]/Y[3],Y[1]/Y[3]),he=s.an(E,ee)&&$[3]<X[3],ye=s.an(E,ie)&&Y[3]<X[3];if(!he&&!ye)return null;const ve=function(Xe,Je,ot){for(let mt=1;mt<Xe.length;mt++){const lt=An(Je.pointCoordinate3D(Xe[mt-1]).x),at=An(Je.pointCoordinate3D(Xe[mt]).x);if(ot<0){if(lt<at)return{idx:mt,t:-lt/(at-1-lt)}}else if(at<lt)return{idx:mt,t:(1-lt)/(at+1-lt)}}return null}(E,I,he?-1:1);if(!ve)return null;const{idx:be,t:Ce}=ve;let Fe=be>1?Lt(E.slice(0,be),I):[],ze=be<E.length?Lt(E.slice(be),I):[];Fe=Fe.map(Xe=>new s.P(An(Xe.x),Xe.y)),ze=ze.map(Xe=>new s.P(An(Xe.x),Xe.y));const Ue=[...Fe];Ue.length===0&&Ue.push(ze[ze.length-1]);const Ze=s.aa(Ue[Ue.length-1].y,(ze.length===0?Fe[0]:ze[0]).y,Ce);let Ke;return Ke=he?[new s.P(0,Ze),new s.P(0,0),new s.P(1,0),new s.P(1,Ze)]:[new s.P(1,Ze),new s.P(1,1),new s.P(0,1),new s.P(0,Ze)],Ue.push(...Ke),ze.length===0?Ue.push(Fe[0]):Ue.push(...ze),{polygon:Ue.map(Xe=>new s.a5(Xe.x,Xe.y)),unwrapped:!1}}(l,h);if(y)return y;const S=function(E,I){let G=!1,$=-1/0,Y=0;for(let ee=0;ee<E.length-1;ee++)E[ee].x>$&&($=E[ee].x,Y=ee);for(let ee=0;ee<E.length-1;ee++){const ie=(Y+ee)%(E.length-1),he=E[ie],ye=E[ie+1];Math.abs(he.x-ye.x)>.5&&(he.x<ye.x?(he.x+=1,ie===0&&(E[E.length-1].x+=1)):(ye.x+=1,ie+1===E.length-1&&(E[0].x+=1)),G=!0)}const X=s.am(I.center.lng);return G&&X<Math.abs(X-1)&&E.forEach(ee=>{ee.x-=1}),{polygon:E,unwrapped:G}}(Lt(l,h).map(E=>new s.P(An(E.x),E.y)),h);return{polygon:S.polygon.map(E=>new s.a5(E.x,E.y)),unwrapped:S.unwrapped}}}function Lt(g,l){return s.ao(g,h=>{const y=l.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function An(g){return g<0?1+g%1:g%1}function Dn(g){return 100*g|0}function Xn(g,l,h,y,S){const E=function(G,$){if(G)return S(G);if($){if(g.url&&$.tiles&&g.tiles&&delete g.tiles,$.variants){if(!Array.isArray($.variants))return S(new Error("variants must be an array"));for(const X of $.variants){if(X==null||typeof X!="object"||X.constructor!==Object)return S(new Error("variant must be an object"));if(!Array.isArray(X.capabilities))return S(new Error("capabilities must be an array"));if(X.capabilities.length===1&&X.capabilities[0]==="meshopt"){$=s.l($,X);break}}}const Y=s.ar(s.l({},$,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);Y.tiles=l.canonicalizeTileset(Y,g.url),S(null,Y)}},I=function(G,$,Y){if(!G)return null;if(!$&&!Y)return G;Y=Y||G.worldview_default;const X=Object.values(G.language||{});if(X.length===0)return null;const ee=Object.values(G.worldview||{});if(ee.length===0)return null;const ie=X.every(ye=>ye===$),he=ee.every(ye=>ye===Y);return ie&&he?G:$ in(G.language_options||{})||Y in(G.worldview_options||{})?null:G.language_options&&G.worldview_options?G:null}(g.data,h,y);return I?s.q.frame(()=>E(null,I)):g.url?s.n(l.transformRequest(l.normalizeSourceURL(g.url,null,h,y),s.R.Source),E):s.q.frame(()=>{const{data:G,...$}=g;E(null,$)})}class Yn{constructor(l,h,y){this.bounds=s.as.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(s.am(this.bounds.getWest())*h),S=Math.floor(s.at(this.bounds.getNorth())*h),E=Math.ceil(s.am(this.bounds.getEast())*h),I=Math.ceil(s.at(this.bounds.getSouth())*h);return l.x>=y&&l.x<E&&l.y>=S&&l.y<I}}class Si extends s.E{constructor(l,h,y,S){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ar(h,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new s.au}load(l){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=Xn(this._options,this.map._requestManager,h,y,(S,E)=>{if(this._tileJSONRequest=null,this._loaded=!0,S)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new s.t(S));else if(E){if(s.l(this,E),this.hasWorldviews=!!E.worldview_options,E.worldview_default&&(this.worldviewDefault=E.worldview_default),E.vector_layers){this.vectorLayers=E.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const I of E.vector_layers)this.vectorLayerIds.push(I.id),E.worldview&&E.worldview[I.source]&&this.localizableLayerIds.add(I.id)}E.bounds&&(this.tileBounds=new Yn(E.bounds,this.minzoom,this.maxzoom)),Gt(E.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}l&&l(S)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(l,h){const y=l.tileID.canonical.url(this.tiles,this.scheme),S=this.map._requestManager.normalizeTileURL(y),E=this.map._requestManager.transformRequest(S,s.R.Tile),I=this.map.style?this.map.style.getLut(this.scope):null,G=I?{image:I.image.clone()}:null,$={request:E,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,lut:G,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(y)&&($.worldview=this.map.getWorldview()||this.worldviewDefault,$.localizableLayerIds=this.localizableLayerIds),$.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=h:l.request=l.actor.send("reloadTile",$,Y.bind(this));else if(l.actor=this._tileWorkers[S]=this._tileWorkers[S]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",$,Y.bind(this),void 0,!0);else{const X=s.aw.call({deduped:this._deduped},$,(ee,ie)=>{ee||!ie?Y.call(this,ee):($.data={cacheControl:ie.cacheControl,expires:ie.expires,rawData:ie.rawData.slice(0)},l.actor&&l.actor.send("loadTile",$,Y.bind(this),void 0,!0))},!0);l.request={cancel:X}}function Y(X,ee){return delete l.request,l.aborted?h(null):X&&X.status!==404?h(X):(ee&&ee.resourceTiming&&(l.resourceTiming=ee.resourceTiming),this.map._refreshExpiredTiles&&ee&&l.setExpiryData(ee),l.loadVectorData(ee,this.map.painter),s.ax(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,h){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wi extends s.E{constructor(l,h,y,S){super(),this.id=l,this.dispatcher=y,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},h),s.l(this,s.ar(h,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Xn(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.t(h)):y&&(s.l(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),y.bounds&&(this.tileBounds=new Yn(y.bounds,this.minzoom,this.maxzoom)),Gt(y.tiles),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,h){const y=s.q.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=s.o(this.map._requestManager.transformRequest(S,s.R.Tile),(E,I,G,$)=>(delete l.request,l.aborted?(l.state="unloaded",h(null)):E?(l.state="errored",h(E)):I?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:G,expires:$}),l.setTexture(I,this.map.painter),l.state="loaded",s.ax(this.dispatcher),void h(null)):h(null)))}abortTile(l,h){l.request&&(l.request.cancel(),delete l.request),h&&h()}unloadTile(l,h){l.texture&&l.texture instanceof s.T?(l.destroy(!0),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class di extends Wi{constructor(l,h,y,S){super(l,h,y,S),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},h)}triggerRepaint(l){const h=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);h&&h.enabled&&y&&h._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,h){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),S=this.map._requestManager.transformRequest(y,s.R.Tile);l.requestParams=S,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(E,I,G,$)=>{if(delete l.request,l.aborted)return l.state="unloaded",h(null);if(E)return E.code===20?void 0:(l.state="errored",h(E));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:G,expires:$}),l.state="empty",h(null)})}unloadTile(l,h){const y=l.texture;y&&y instanceof s.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,h,y){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(h,y,(S,E)=>{if(S)return l.state="errored",this.fire(new s.t(S)),void this.triggerRepaint(l);E&&(l.setTexture(E,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:E})=>E===l),y=h&&h.fields,S=y&&y.bands&&y.bands;return S?S[0]:0}getTextureDescriptor(l,h,y){if(!l)return;const S=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!S)return;let E=null;h instanceof s.aB?E=h.paint.get("raster-array-band"):h instanceof s.aC&&(E=h.paint.get("raster-particle-array-band"));const I=E||this.getInitialBand(S);if(I!=null)if(l.textureDescriptor){if(!l.updateNeeded(S,I)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,S,I)}}const or={vector:Si,raster:Wi,"raster-dem":class extends Wi{constructor(g,l,h,y){super(g,l,h,y),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(S,E){S&&(g.state="errored",l(S)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=s.o(this.map._requestManager.transformRequest(h,s.R.Tile),(function(S,E,I,G){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(S)g.state="errored",l(S);else if(E){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:G});const $=ImageBitmap&&E instanceof ImageBitmap&&s.ay(),Y=1-(E.width-s.az(E.width))/2;Y<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const X=$?E:s.q.getImageData(E,Y),ee={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:X,encoding:this.encoding,padding:Y};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",ee,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,h=Math.pow(2,l.z),y=(l.x-1+h)%h,S=l.x===0?g.wrap-1:g.wrap,E=(l.x+1+h)%h,I=l.x+1===h?g.wrap+1:g.wrap,G={};return G[new s.aA(g.overscaledZ,S,l.z,y,l.y).key]={backfilled:!1},G[new s.aA(g.overscaledZ,I,l.z,E,l.y).key]={backfilled:!1},l.y>0&&(G[new s.aA(g.overscaledZ,S,l.z,y,l.y-1).key]={backfilled:!1},G[new s.aA(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},G[new s.aA(g.overscaledZ,I,l.z,E,l.y-1).key]={backfilled:!1}),l.y+1<h&&(G[new s.aA(g.overscaledZ,S,l.z,y,l.y+1).key]={backfilled:!1},G[new s.aA(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},G[new s.aA(g.overscaledZ,I,l.z,E,l.y+1).key]={backfilled:!1}),G}},"raster-array":di,geojson:class extends s.E{constructor(g,l,h,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=l.data,this._options=s.l({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const S=s.ab/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*S,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*S,extent:s.ab,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.ab,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*S,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new s.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new s.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const h of this._data.features)l.set(h.id,h);for(const h of g.features)l.set(h.id,h);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:h},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.x("dataloading",{dataType:"source"})),this._loaded=!1;const l=s.l({append:g},this.workerOptions);l.scope=this.scope;const h=this._data;typeof h=="string"?(l.request=this.map._requestManager.transformRequest(s.q.resolveURL(h),s.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,S)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new s.t(y));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&S&&S.resourceTiming&&S.resourceTiming[this.id]&&(E.resourceTiming=S.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new s.x("data",E)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,S=y?{image:y.image.clone()}:null,E=this._partialReload,I={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:S,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:E};g.request=this.actor.send(h,I,(G,$)=>E&&!$?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):G?l(G):(g.loadVectorData($,this.map.painter,h==="reloadTile"),l(null))),void 0,h==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aD{constructor(g,l,h,y){super(g,l,h,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.R.Source).url);s.aE(this.urls,(l,h)=>{this._loaded=!0,l?this.fire(new s.t(l)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new s.t(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(g,this.video,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aD,model:class extends s.E{constructor(g,l,h,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const h=this._options.models[l],y=s.aG(this.map._requestManager.transformRequest(h.uri,s.R.Model).url).then(S=>{if(!S)return;const E=s.aH(S),I=new s.aI(l,h.position,h.orientation,E);I.computeBoundsAndApplyParent(),this.models.push(I)}).catch(S=>{this.fire(new s.t(new Error(`Could not load model ${l} from ${h.uri}: ${S.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new s.t(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(g,l,h,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Xn(this._options,this.map._requestManager,l,h,(y,S)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.t(y))):S&&(s.l(this,S),S.bounds&&(this.tileBounds=new Yn(S.bounds,this.minzoom,this.maxzoom)),Gt(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(h,s.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const E=Object.values(g.buckets);for(const I of E)I.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,S.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,S.bind(this),void 0,!0);function S(E,I){return g.aborted?l(null):E&&E.status!==404?l(E):(this.map._refreshExpiredTiles&&I&&g.setExpiryData(I),g.loadModelData(I,this.map.painter),g.state="loaded",void l(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aD{constructor(g,l,h,y){super(g,l,h,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(E=>typeof E!="number"))||this.fire(new s.t(new s.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.t(new s.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.t(new s.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.t(new s.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.t(new s.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof s.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(l,this.canvas,l.gl.RGBA8,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends s.E{constructor(g,l,h,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Yn(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ar(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:h,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:h,y,z:S}=g.tileID.canonical,E=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:S},{signal:E.signal})).then((function(I){return delete g.request,g.aborted?(g.state="unloaded",l(null)):I===void 0?(g.state="errored",l(null)):I===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(G){return G instanceof ImageData||G instanceof HTMLCanvasElement||G instanceof ImageBitmap||G instanceof HTMLImageElement}(I)?(this.loadTileData(g,I),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(I=>{I.code!==20&&(g.state="errored",l(I))}),g.request.cancel=()=>E.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof s.T?(g.destroy(!0),g.texture&&g.texture instanceof s.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y,z:S}=g.tileID.canonical;this._implementation.unloadTile({x:h,y,z:S})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=s.av(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}}},Pr=function(g,l,h,y){const S=new or[l.type](g,l,h,y);if(S.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${S.id}`);return s.aJ(["load","abort","unload","serialize","prepare"],S),S};function ji(g,l){const h=s.a6.mat4.identity([]);return s.a6.mat4.scale(h,h,[.5*g.width,.5*-g.height,1]),s.a6.mat4.translate(h,h,[1,-1,0]),s.a6.mat4.multiply(h,h,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(h)}function vr(g,l,h,y,S,E,I,G,$=!1){const Y=g.tilesIn(h,G,$);Y.sort(fi);const X=[];for(const ie of Y)X.push({wrappedTileID:ie.tile.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(l,g._state,ie,y,S,E,I,ji(g.transform,ie.tile.tileID),$)});const ee=function(ie){const he={},ye={};for(const ve of ie){const be=ve.queryResults,Ce=ve.wrappedTileID,Fe=ye[Ce]=ye[Ce]||{};for(const ze in be){const Ue=be[ze],Ze=Fe[ze]=Fe[ze]||{},Ke=he[ze]=he[ze]||[];for(const Xe of Ue)Ze[Xe.featureIndex]||(Ze[Xe.featureIndex]=!0,Ke.push(Xe))}}return he}(X);for(const ie in ee)ee[ie].forEach(he=>{const ye=he.feature,ve=ye.layer;ve&&ve.type!=="background"&&ve.type!=="sky"&&ve.type!=="slot"&&(s.aK(ie)||(ye.source=ve.source,ve["source-layer"]&&(ye.sourceLayer=ve["source-layer"])),ye.state=ye.id!==void 0?g.getFeatureState(ve["source-layer"],ye.id):{})});return ee}function wr(g,l){const h=g.getRenderableIds().map(E=>g.getTileByID(E)),y=[],S={};for(let E=0;E<h.length;E++){const I=h[E],G=I.tileID.canonical.key;S[G]||(S[G]=!0,I.querySourceFeatures(y,l))}return y}function fi(g,l){const h=g.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function fs(g,l){const h={};if(!l)return h;for(const y of g){const S=y.layerIds.map(E=>l.getLayer(E)).filter(Boolean);if(S.length!==0){y.layers=S,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>S.filter(I=>I.id===E)[0]));for(const E of S)h[E.fqid]=y}}return h}const tr=32,Ss=33,is=new Uint16Array(8184);for(let g=0;g<2046;g++){let l=g+2,h=0,y=0,S=0,E=0,I=0,G=0;for(1&l?S=E=I=tr:h=y=G=tr;(l>>=1)>1;){const Y=h+S>>1,X=y+E>>1;1&l?(S=h,E=y,h=I,y=G):(h=S,y=E,S=I,E=G),I=Y,G=X}const $=4*g;is[$+0]=h,is[$+1]=y,is[$+2]=S,is[$+3]=E}const rs=new Uint16Array(2178),Yo=new Uint8Array(1089),Qr=new Uint16Array(1089);function Jo(g){return g===0?-.03125:g===32?.03125:0}const cc={type:2,extent:s.ab,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ab+1,0),new s.P(s.ab+1,s.ab+1),new s.P(0,s.ab+1),new s.P(0,0)]]};class Zr{constructor(l,h,y,S,E){this.tileID=l,this.uid=s.aQ(),this.uses=0,this.tileSize=h,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,S&&S.style&&(this._lastUpdatedBrightness=S.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",S&&S.transform&&(this.projection=S.transform.projection)}registerFadeDuration(l){const h=l+this.timeAdded;h<s.q.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,h,y){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=fs(l.buckets,h.style),this.hasSymbolBuckets=!1;for(const S in this.buckets){const E=this.buckets[S];if(E instanceof s.aS){if(this.hasSymbolBuckets=!0,!y)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const S in this.buckets){const E=this.buckets[S];if(E instanceof s.aS&&E.hasRTLText){this.hasRTLText=!0,s.aT();break}}this.queryPadding=0;for(const S in this.buckets){const E=this.buckets[S],I=h.style.getOwnLayer(S);if(!I)continue;const G=I.queryRadius(E);this.queryPadding=Math.max(this.queryPadding,G)}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas),this._lastUpdatedBrightness=l.brightness}else this.collisionBoxArray=new s.aR}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(l,h,y){l&&(l.resourceTiming&&(this.resourceTiming=l.resourceTiming),this.buckets={...this.buckets,...fs(l.buckets,h.style)},l.featureIndex&&(this.latestFeatureIndex=l.featureIndex))}getBucket(l){return this.buckets[l.fqid]}upload(l){for(const S in this.buckets){const E=this.buckets[S];E.uploadPending()&&E.upload(l)}const h=l.gl,y=this.imageAtlas;if(y&&!y.uploaded){const S=!!Object.keys(y.patternPositions).length;this.imageAtlasTexture=new s.T(l,y.image,h.RGBA8,{useMipmap:S}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(l,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(l,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(l,h,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture,y),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const S=h.style.getBrightness();(this._lastUpdatedBrightness||S)&&(this._lastUpdatedBrightness&&S&&Math.abs(this._lastUpdatedBrightness-S)<.001||(this._lastUpdatedBrightness=S,this.updateBuckets(h)))}queryRenderedFeatures(l,h,y,S,E,I,G,$,Y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:y,pixelPosMatrix:$,transform:G,filter:S,layers:E,availableImages:I,tileTransform:this.tileTransform},l,h):{}}querySourceFeatures(l,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const S=y.loadVTLayers(),E=h?h.sourceLayer:"",I=S._geojsonTileLayer||S[E];if(!I)return;const G=s.aU(h&&h.filter),{z:$,x:Y,y:X}=this.tileID.canonical,ee={z:$,x:Y,y:X};for(let ie=0;ie<I.length;ie++){const he=I.feature(ie);if(G.needGeometry){const be=s.aV(he,!0);if(!G.filter(new s.a3(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!G.filter(new s.a3(this.tileID.overscaledZ),he))continue;const ye=y.getId(he,E),ve=new s.aW(he,$,Y,X,ye);ve.tile=ee,l.push(ve)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const y=s.aX(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let S=!1;if(this.expirationTime>y)S=!1;else if(h)if(this.expirationTime<h)S=!0;else{const E=this.expirationTime-h;E?this.expirationTime=y+Math.max(E,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(l){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&l&&this.updateBuckets(l)}updateBuckets(l){if(!this.latestFeatureIndex)return;const h=this.latestFeatureIndex.loadVTLayers(),y=l.style.listImages(),S=l.style.getBrightness();for(const E in this.buckets){if(!l.style.hasLayer(E))continue;const I=this.buckets[E],G=I.layers[0],$=G.sourceLayer||"_geojsonTileLayer",Y=h[$],X=l.style.getSourceCache(G.source,G.scope);let ee={};X&&(ee=X._state.getState($,void 0)),I.update(ee,Y,y,this.imageAtlas&&this.imageAtlas.patternPositions||{},S),(I instanceof s.aY||I instanceof s.aZ)&&l._terrain&&l._terrain.enabled&&X&&I.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(X.id,this.tileID);const ie=l&&l.style&&l.style.getOwnLayer(E);ie&&(this.queryPadding=Math.max(this.queryPadding,ie.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=s.q.now()+l}setTexture(l,h){const y=h.context,S=y.gl;this.texture=this.texture||h.getTileTexture(l.width),this.texture&&this.texture instanceof s.T?this.texture.update(l):(this.texture=new s.T(y,l,S.RGBA8,{useMipmap:!0}),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE))}setDependencies(l,h){const y={};for(const S of h)y[S]=!0;this.dependencies[l]=y}hasDependency(l,h){for(const y of l){const S=this.dependencies[y];if(S){for(const E of h)if(S[E])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const y=s.a_(cc,this.tileID.canonical,this.tileTransform)[0],S=new s.a$,E=new s.b0;for(let I=0;I<y.length;I++){const{x:G,y:$}=y[I];S.emplaceBack(G,$),E.emplaceBack(I)}E.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(E),this._tileDebugBuffer=l.createVertexBuffer(S,s.b1.members),this._tileDebugSegments=s.b2.simpleSegment(0,0,S.length,E.length)}_makeTileBoundsBuffers(l,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const y=s.a_(cc,this.tileID.canonical,this.tileTransform)[0];let S,E;if(this.isRaster){const I=function(G,$){const Y=s.aL(G,$),X=Math.pow(2,G.z);for(let be=0;be<Ss;be++)for(let Ce=0;Ce<Ss;Ce++){const Fe=s.aM((G.x+(Ce+Jo(Ce))/tr)/X),ze=s.aN((G.y+(be+Jo(be))/tr)/X),Ue=$.project(Fe,ze),Ze=be*Ss+Ce;rs[2*Ze+0]=Math.round((Ue.x*Y.scale-Y.x)*s.ab),rs[2*Ze+1]=Math.round((Ue.y*Y.scale-Y.y)*s.ab)}Yo.fill(0),Qr.fill(0);for(let be=2045;be>=0;be--){const Ce=4*be,Fe=is[Ce+0],ze=is[Ce+1],Ue=is[Ce+2],Ze=is[Ce+3],Ke=Fe+Ue>>1,Xe=ze+Ze>>1,Je=Ke+Xe-ze,ot=Xe+Fe-Ke,mt=ze*Ss+Fe,lt=Ze*Ss+Ue,at=Xe*Ss+Ke,Nt=Math.hypot((rs[2*mt+0]+rs[2*lt+0])/2-rs[2*at+0],(rs[2*mt+1]+rs[2*lt+1])/2-rs[2*at+1])>=16;Yo[at]=Yo[at]||(Nt?1:0),be<1022&&(Yo[at]=Yo[at]||Yo[(ze+ot>>1)*Ss+(Fe+Je>>1)]||Yo[(Ze+ot>>1)*Ss+(Ue+Je>>1)])}const ee=new s.aO,ie=new s.aP;let he=0;function ye(be,Ce){const Fe=Ce*Ss+be;return Qr[Fe]===0&&(ee.emplaceBack(rs[2*Fe+0],rs[2*Fe+1],be*s.ab/tr,Ce*s.ab/tr),Qr[Fe]=++he),Qr[Fe]-1}function ve(be,Ce,Fe,ze,Ue,Ze){const Ke=be+Fe>>1,Xe=Ce+ze>>1;if(Math.abs(be-Ue)+Math.abs(Ce-Ze)>1&&Yo[Xe*Ss+Ke])ve(Ue,Ze,be,Ce,Ke,Xe),ve(Fe,ze,Ue,Ze,Ke,Xe);else{const Je=ye(be,Ce),ot=ye(Fe,ze),mt=ye(Ue,Ze);ie.emplaceBack(Je,ot,mt)}}return ve(0,0,tr,tr,tr,0),ve(tr,tr,0,0,0,tr),{vertices:ee,indices:ie}}(this.tileID.canonical,h);S=I.vertices,E=I.indices}else{S=new s.aO,E=new s.aP;for(const{x:G,y:$}of y)S.emplaceBack(G,$,0,0);const I=s.b3(S.int16,void 0,4);for(let G=0;G<I.length;G+=3)E.emplaceBack(I[G],I[G+1],I[G+2])}this._tileBoundsBuffer=l.createVertexBuffer(S,s.b4.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(E),this._tileBoundsSegments=s.b2.simpleSegment(0,0,S.length,E.length)}_makeGlobeTileDebugBuffers(l,h){const y=h.projection;if(!y||y.name!=="globe"||h.freezeTileCoverage)return;const S=this.tileID.canonical,E=s.b5(S,h),I=s.b6(E),G=s.a9(h.zoom);let $;G>0&&($=s.a6.mat4.invert(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,S,h,I,$,G),this._makeGlobeTileDebugTextBuffer(l,S,h,I,$,G)}_globePoint(l,h,y,S,E,I,G){let $=s.b7(l,h,y);if(I){const Y=1<<y.z,X=s.am(S.center.lng),ee=s.at(S.center.lat),ie=(y.x+.5)/Y-X;let he=0;ie>.5?he=-1:ie<-.5&&(he=1);let ye=(l/s.ab+y.x)/Y+he,ve=(h/s.ab+y.y)/Y;ye=(ye-X)*S._pixelsPerMercatorPixel+X,ve=(ve-ee)*S._pixelsPerMercatorPixel+ee;const be=[ye*S.worldSize,ve*S.worldSize,0];s.a6.vec3.transformMat4(be,be,I),$=s.b8($,be,G)}return s.a6.vec3.transformMat4($,$,E)}_makeGlobeTileDebugBorderBuffer(l,h,y,S,E,I){const G=new s.a$,$=new s.b0,Y=new s.b9,X=(ie,he,ye,ve,be)=>{const Ce=(ye-ie)/(be-1),Fe=(ve-he)/(be-1),ze=G.length;for(let Ue=0;Ue<be;Ue++){const Ze=ie+Ue*Ce,Ke=he+Ue*Fe;G.emplaceBack(Ze,Ke);const Xe=this._globePoint(Ze,Ke,h,y,S,E,I);Y.emplaceBack(Xe[0],Xe[1],Xe[2]),$.emplaceBack(ze+Ue)}},ee=s.ab;X(0,0,ee,0,16),X(ee,0,ee,ee,16),X(ee,ee,0,ee,16),X(0,ee,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer($),this._tileDebugBuffer=l.createVertexBuffer(G,s.b1.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(Y,s.ba.members),this._tileDebugSegments=s.b2.simpleSegment(0,0,G.length,$.length)}_makeGlobeTileDebugTextBuffer(l,h,y,S,E,I){const G=s.ab/4,$=new s.a$,Y=new s.aP,X=new s.b9,ee=25;Y.reserve(32),$.reserve(ee),X.reserve(ee);const ie=(he,ye)=>ee*he+ye;for(let he=0;he<ee;he++){const ye=he*G;for(let ve=0;ve<ee;ve++){const be=ve*G;$.emplaceBack(be,ye);const Ce=this._globePoint(be,ye,h,y,S,E,I);X.emplaceBack(Ce[0],Ce[1],Ce[2])}}for(let he=0;he<4;he++)for(let ye=0;ye<4;ye++){const ve=ie(he,ye),be=ie(he,ye+1),Ce=ie(he+1,ye),Fe=ie(he+1,ye+1);Y.emplaceBack(ve,be,Ce),Y.emplaceBack(Ce,be,Fe)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(Y),this._tileDebugTextBuffer=l.createVertexBuffer($,s.b1.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(X,s.ba.members),this._tileDebugTextSegments=s.b2.simpleSegment(0,0,ee,32)}destroy(l=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!l&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bb.setPbf(s.bc);class Wa extends Zr{constructor(l,h,y,S,E){super(l,h,y,S,E),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(l,h){const y=h.context,S=y.gl;this.texture=this.texture||h.getTileTexture(l.width),this.texture&&this.texture instanceof s.T?this.texture.update(l,{premultiply:!1}):this.texture=new s.T(y,l,S.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(l=16384,h){const y=this._mrt=new s.bb(30),S=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(l-1)}});return this.entireBuffer=null,this.request=s.bd(S,(E,I,G,$)=>{if(E)h(E);else try{const Y=y.getHeaderLength(I);if(Y>l)return void(this.request=this.fetchHeader(Y,h));y.parseHeader(I),this._isHeaderLoaded=!0;let X=0;for(const ee of Object.values(y.layers))X=Math.max(X,ee.dataIndex[ee.dataIndex.length-1].last_byte);I.byteLength>=X&&(this.entireBuffer=I),h(null,this.entireBuffer||I,G,$)}catch(Y){h(Y)}}),this.request}fetchBand(l,h,y){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void y(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void y(new Error("Can't fetch tile band without an actor"));let I;const G=(ee,ie)=>{I.complete(ee,ie),ee?y(ee):(this.updateTextureDescriptor(l,h),y(null,this.textureDescriptor&&this.textureDescriptor.img))},$=(ee,ie)=>{if(ee)return y(ee);const he=E.send("decodeRasterArray",{buffer:ie,task:I},G,void 0,!0);this._workQueue.push(()=>{he&&he.cancel(),I.cancel()})},Y=S.getLayer(l);if(!Y)return void y(new Error(`Unknown sourceLayer "${l}"`));if(Y.hasDataForBand(h))return this.updateTextureDescriptor(l,h),void y(null,this.textureDescriptor?this.textureDescriptor.img:null);const X=Y.getDataRange([h]);if(I=S.createDecodingTask(X),!I||I.tasks.length)if(this.flushQueues(),this.entireBuffer)$(null,this.entireBuffer.slice(X.firstByte,X.lastByte+1));else{const ee=Object.assign({},this.requestParams,{headers:{Range:`bytes=${X.firstByte}-${X.lastByte}`}}),ie=s.bd(ee,$);this._fetchQueue.push(()=>{ie.cancel(),I.cancel()})}else y(null)}updateNeeded(l,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==l)&&this.state!=="errored"}updateTextureDescriptor(l,h){if(!this._mrt)return;const y=this._mrt.getLayer(l);if(!y||!y.hasBand(h)||!y.hasDataForBand(h))return;const{bytes:S,tileSize:E,buffer:I,offset:G,scale:$}=y.getBandView(h),Y=E+2*I,X={data:S,width:Y,height:Y},ee=this.texture;ee&&ee instanceof s.T&&ee.update(X,{premultiply:!1}),this.textureDescriptor={layer:l,band:h,img:X,buffer:I,offset:G,tileSize:E,format:y.pixelFormat,mix:[$,256*$,65536*$,16777216*$]}}}class El{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,y){const S=l.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);const E={value:h,timeout:void 0};if(y!==void 0&&(E.timeout=setTimeout(()=>{this.remove(l,E)},y)),this.data[S].push(E),this.order.push(S),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const y=l.wrapped().key,S=h===void 0?0:this.data[y].indexOf(h),E=this.data[y][S];return this.data[y].splice(S,1),E.timeout&&clearTimeout(E.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(E.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const y in this.data)for(const S of this.data[y])l(S.value)||h.push(S);for(const y of h)this.remove(y.value.tileID,y)}}class dm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,y){const S=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][S]=this.stateChanges[l][S]||{},s.l(this.stateChanges[l][S],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const E in this.state[l])E!==S&&(this.deletedStates[l][E]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][S]===null){this.deletedStates[l][S]={};for(const E in this.state[l][S])y[E]||(this.deletedStates[l][S][E]=null)}else for(const E in y)this.deletedStates[l]&&this.deletedStates[l][S]&&this.deletedStates[l][S][E]===null&&delete this.deletedStates[l][S][E]}removeFeatureState(l,h,y){if(this.deletedStates[l]===null)return;const S=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&h!==void 0)this.deletedStates[l][S]!==null&&(this.deletedStates[l][S]=this.deletedStates[l][S]||{},this.deletedStates[l][S][y]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][S])for(y in this.deletedStates[l][S]={},this.stateChanges[l][S])this.deletedStates[l][S][y]=null;else this.deletedStates[l][S]=null;else this.deletedStates[l]=null}getState(l,h){const y=this.state[l]||{},S=this.stateChanges[l]||{},E=this.deletedStates[l];if(E===null)return{};if(h!==void 0){const G=String(h),$=s.l({},y[G],S[G]);if(E){const Y=E[h];if(Y===null)return{};for(const X in Y)delete $[X]}return $}const I=s.l({},y,S);if(E)for(const G in E)delete I[G];return I}initializeTileState(l,h){l.refreshFeatureState(h)}coalesceChanges(l,h){const y={};for(const S in this.stateChanges){this.state[S]=this.state[S]||{};const E={};for(const I in this.stateChanges[S])this.state[S][I]||(this.state[S][I]={}),s.l(this.state[S][I],this.stateChanges[S][I]),E[I]=this.state[S][I];y[S]=E}for(const S in this.deletedStates){this.state[S]=this.state[S]||{};const E={};if(this.deletedStates[S]===null)for(const I in this.state[S])E[I]={},this.state[S][I]={};else for(const I in this.deletedStates[S]){if(this.deletedStates[S][I]===null)this.state[S][I]={};else if(this.state[S][I])for(const G of Object.keys(this.deletedStates[S][I]))delete this.state[S][I][G];E[I]=this.state[S][I]}y[S]=y[S]||{},s.l(y[S],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const S in l)l[S].refreshFeatureState(h)}}class Qo extends s.E{constructor(l,h,y){super(),this.id=l,this._onlySymbols=y,h.on("data",S=>{S.dataType==="source"&&S.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new El(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new dm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,h){return l.isSymbolTile=this._onlySymbols,l.isExtraShadowCaster=this._shadowCasterTiles[l.tileID.key],this._source.loadTile(l,h)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l)}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l)}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(l),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.be(this._tiles).map(l=>l.tileID).sort(Ml).map(l=>l.key)}getRenderableIds(l,h){const y=[];for(const S in this._tiles)this._isIdRenderable(+S,l,h)&&y.push(this._tiles[S]);return l?y.sort((S,E)=>{const I=S.tileID,G=E.tileID,$=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),Y=new s.P(G.canonical.x,G.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-G.overscaledZ||Y.y-$.y||Y.x-$.x}).map(S=>S.tileID.key):y.map(S=>S.tileID).sort(Ml).map(S=>S.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h,y){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())&&(y||!this._shadowCasterTiles[l])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,h){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,l,h)))}_tileLoaded(l,h,y,S){if(S)if(l.state="errored",S.status!==404)this._source.fire(new s.t(S,{tile:l}));else{if(this._source.fire(new s.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:l})),!(l.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}else l.timeAdded=s.q.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new s.x("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id}))}_backfillDEM(l){const h=this.getRenderableIds();for(let S=0;S<h.length;S++){const E=h[S];if(l.neighboringTiles&&l.neighboringTiles[E]){const I=this.getTileByID(E);y(l,I),y(I,l)}}function y(S,E){if(!S.dem||S.dem.borderReady)return;S.needsHillshadePrepare=!0,S.needsDEMTextureUpload=!0;let I=E.tileID.canonical.x-S.tileID.canonical.x;const G=E.tileID.canonical.y-S.tileID.canonical.y,$=Math.pow(2,S.tileID.canonical.z),Y=E.tileID.key;I===0&&G===0||Math.abs(G)>1||(Math.abs(I)>1&&(Math.abs(I+$)===1?I+=$:Math.abs(I-$)===1&&(I-=$)),E.dem&&S.dem&&(S.dem.backfillBorder(E.dem,I,G),S.neighboringTiles&&S.neighboringTiles[Y]&&(S.neighboringTiles[Y].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,y,S){for(const E in this._tiles){let I=this._tiles[E];if(S[E]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>y)continue;let G=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const Y=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[Y.key],I&&I.hasData()&&(G=Y)}let $=G;for(;$.overscaledZ>h;)if($=$.scaledTo($.overscaledZ-1),l[$.key]){S[G.key]=G;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=l.overscaledZ-1;y>=h;y--){const S=l.scaledTo(y),E=this._getLoadedTile(S);if(E)return E}}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,h){h=h||this._source.tileSize;const y=Math.ceil(l.width/h)+1,S=Math.ceil(l.height/h)+1,E=Math.floor(y*S*5),I=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,E):E,G=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(G)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const y={};for(const S in this._tiles){const E=this._tiles[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),y[E.tileID.key]=E}this._tiles=y;for(const S in this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(const S in this._tiles)this._setTileReloadTimer(+S,this._tiles[S])}}update(l,h,y,S){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(l,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,G=this._source.maxzoom;const $=this.map&&this.map.painter?this.map.painter._terrain:null;if($&&$.sourceCache===this&&$.attenuationRange()){const ee=$.attenuationRange()[0],ie=Math.floor(ee)-Math.log2($.getDemUpscale());G>ie&&(G=ie)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new s.aA(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y));else if(this.tileCoverLift!==0){const ee=l.clone();ee.tileCoverLift=this.tileCoverLift,I=ee.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:G,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&l.projection.name==="globe"&&(I.push(new s.aA(1,0,1,0,0)),I.push(new s.aA(1,0,1,1,0)),I.push(new s.aA(1,0,1,0,1)),I.push(new s.aA(1,0,1,1,1)))}else if(I=l.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:G,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const ee=this._source.hasTile.bind(this._source);I=I.filter(ie=>ee(ie))}}else I=[];if(I.length>0&&this.castsShadows&&S&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Wc(this._source.type)){const ee=l.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),ie=Math.min(ee,this._source.maxzoom);if(E){const he=l.extendTileCover(I,ie);for(const ye of he)I.push(ye)}else{const he=l.extendTileCover(I,ie,S);for(const ye of he)this._shadowCasterTiles[ye.key]=!0,I.push(ye)}}const Y=this._updateRetainedTiles(I);if(Wc(this._source.type)&&I.length!==0){const ee={},ie={},he=Object.keys(Y);for(const ve of he){const be=Y[ve],Ce=this._tiles[ve];if(!Ce||Ce.fadeEndTime&&Ce.fadeEndTime<=s.q.now())continue;const Fe=this.findLoadedParent(be,Math.max(be.overscaledZ-Qo.maxOverzooming,this._source.minzoom));Fe&&(this._addTile(Fe.tileID),ee[Fe.tileID.key]=Fe.tileID),ie[ve]=be}const ye=I[I.length-1].overscaledZ;for(const ve in this._tiles){const be=this._tiles[ve];if(Y[ve]||!be.hasData())continue;let Ce=be.tileID;for(;Ce.overscaledZ>ye;){Ce=Ce.scaledTo(Ce.overscaledZ-1);const Fe=this._tiles[Ce.key];if(Fe&&Fe.hasData()&&ie[Ce.key]){Y[ve]=be.tileID;break}}}for(const ve in ee)Y[ve]||(this._coveredTiles[ve]=!0,Y[ve]=ee[ve])}for(const ee in Y)this._tiles[ee].clearFadeHold();const X=s.bf(this._tiles,Y);for(const ee of X){const ie=this._tiles[ee];ie.hasSymbolBuckets&&!ie.holdingForFade()?ie.setHoldDuration(this.map._fadeDuration):ie.hasSymbolBuckets&&!ie.symbolFadeFinished()||this._removeTile(+ee)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const h={};if(l.length===0)return h;const y={},S=l.reduce((Y,X)=>Math.min(Y,X.overscaledZ),1/0),E=l[0].overscaledZ,I=Math.max(E-Qo.maxOverzooming,this._source.minzoom),G=Math.max(E+Qo.maxUnderzooming,this._source.minzoom),$={};for(const Y of l){const X=this._addTile(Y);h[Y.key]=Y,X.hasData()||S<this._source.maxzoom&&($[Y.key]=Y)}this._retainLoadedChildren($,S,G,h);for(const Y of l){let X=this._tiles[Y.key];if(X.hasData())continue;if(Y.canonical.z>=this._source.maxzoom){const ie=Y.children(this._source.maxzoom)[0],he=this.getTile(ie);if(he&&he.hasData()){h[ie.key]=ie;continue}}else{const ie=Y.children(this._source.maxzoom);if(h[ie[0].key]&&h[ie[1].key]&&h[ie[2].key]&&h[ie[3].key])continue}let ee=X.wasRequested();for(let ie=Y.overscaledZ-1;ie>=I;--ie){const he=Y.scaledTo(ie);if(y[he.key]||(y[he.key]=!0,X=this.getTile(he),!X&&ee&&(X=this._addTile(he)),X&&(h[he.key]=he,ee=X.wasRequested(),X.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let y,S=this._tiles[l].tileID;for(;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){y=this._loadedParentTiles[S.key];break}h.push(S.key);const E=S.scaledTo(S.overscaledZ-1);if(y=this._getLoadedTile(E),y)break;S=E}for(const E of h)this._loadedParentTiles[E]=y}}_addTile(l){let h=this._tiles[l.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[l.key]||this._reloadTile(l.key,"reloading"),h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const y=!!h;if(!y){const S=this.map?this.map.painter:null,E=this._source.tileSize*l.overscaleFactor();h=this._source.type==="raster-array"?new Wa(l,E,this.transform.tileZoom,S,this._isRaster):new Zr(l,E,this.transform.tileZoom,S,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,l.key,h.state))}return h?(h.uses++,this._tiles[l.key]=h,y||this._source.fire(new s.x("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=h.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,h,y){const S=[],E=this.transform;if(!E)return S;const I=E.projection.name==="globe",G=s.am(E.center.lng);for(const $ in this._tiles){const Y=this._tiles[$];if(y&&Y.clearQueryDebugViz(),Y.holdingForFade())continue;let X;if(I){const ee=Y.tileID.canonical;if(ee.z===0){const ie=[Math.abs(s.ap(G,...jc(ee,-1))-G),Math.abs(s.ap(G,...jc(ee,1))-G)];X=[0,2*ie.indexOf(Math.min(...ie))-1]}else{const ie=[Math.abs(s.ap(G,...jc(ee,-1))-G),Math.abs(s.ap(G,...jc(ee,0))-G),Math.abs(s.ap(G,...jc(ee,1))-G)];X=[ie.indexOf(Math.min(...ie))-1]}}else X=[0];for(const ee of X){const ie=l.containsTile(Y,E,h,ee);ie&&S.push(ie)}}return S}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(l){return this._getRenderableCoordinates(l)}_getRenderableCoordinates(l,h){const y=this.getRenderableIds(l,h).map(E=>this._tiles[E].tileID),S=this.transform.projection.name==="globe";for(const E of y)E.projMatrix=this.transform.calculateProjMatrix(E.toUnwrapped()),E.expandedProjMatrix=S?this.transform.calculateProjMatrix(E.toUnwrapped(),!1,!0):E.projMatrix;return y}sortCoordinatesByDistance(l){const h=l.slice(),y=this.transform._camera.position,S=this.transform._camera.forward(),E={};for(const I of h){const G=1/(1<<I.canonical.z);E[I.key]=((I.canonical.x+.5)*G+I.wrap-y[0])*S[0]+((I.canonical.y+.5)*G-y[1])*S[1]-y[2]*S[2]}return h.sort((I,G)=>E[I.key]-E[G.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(Wc(this._source.type))for(const l in this._tiles){const h=this._tiles[l];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(l,h,y){this._state.updateState(l=l||"_geojsonTileLayer",h,y)}removeFeatureState(l,h,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,y)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,y){const S=this._tiles[l];S&&S.setDependencies(h,y)}reloadTilesForDependencies(l,h){for(const y in this._tiles)this._tiles[y].hasDependency(l,h)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(l,h))}_preloadTiles(l,h){if(!this._sourceLoaded){const $=()=>{this._sourceLoaded&&(this._source.off("data",$),this._preloadTiles(l,h))};return void this._source.on("data",$)}const y=new Map,S=Array.isArray(l)?l:[l],E=this.map.painter.terrain,I=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const $ of S){const Y=$.coveringTiles({tileSize:I,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const X of Y)y.set(X.key,X);this.usedForTerrain&&$.updateElevation(!1)}const G=Array.from(y.values());s.bg(G,($,Y)=>{const X=new Zr($,this._source.tileSize*$.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(X,ee=>{this._source.type==="raster-dem"&&X.dem&&this._backfillDEM(X),Y(ee,X)})},h)}}function Ml(g,l){const h=Math.abs(2*g.wrap)-+(g.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return g.overscaledZ-l.overscaledZ||y-h||l.canonical.y-g.canonical.y||l.canonical.x-g.canonical.x}function Wc(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function jc(g,l){const h=1<<g.z;return[g.x/h+l,(g.x+1)/h+l]}Qo.maxOverzooming=10,Qo.maxUnderzooming=3;class Tv{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,h=!1;for(const y in this.style._mergedLayers){const S=this.style._mergedLayers[y];if(S.type==="fill-extrusion")this.layers.push({layer:S,visible:l,visibilityChanged:h});else if(S.type==="model"){const E=this.style.getLayerSource(S);E&&E.type==="batched-model"&&this.layers.push({layer:S,visible:l,visibilityChanged:h})}}}onNewFrame(l){this.layersGotHidden=!1;for(const h of this.layers){const y=h.layer;let S=!1;y.type==="fill-extrusion"?S=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(S=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!S&&h.visible,h.visible=S}}updateZOffset(l,h){this.currentBuildingBuckets=[];for(const S of this.layers){const E=S.layer,I=this.style.getLayerSourceCache(E);let G=1;E.type==="fill-extrusion"&&(G=S.visible?E.paint.get("fill-extrusion-vertical-scale"):0);let $=I?I.getTile(h):null;if(!$&&I&&h.canonical.z>I.getSource().minzoom){let Y=h.scaledTo(Math.min(I.getSource().maxzoom,h.overscaledZ-1));for(;Y.overscaledZ>=I.getSource().minzoom&&($=I.getTile(Y),!$&&Y.overscaledZ!==0);)Y=Y.scaledTo(Y.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:$?$.getBucket(E):null,tileID:$?$.tileID:h,verticalScale:G})}l.hasAnyZOffset=!1;let y=!1;for(let S=0;S<l.symbolInstances.length;S++){const E=l.symbolInstances.get(S),I=E.zOffset,G=this._getHeightAtTileOffset(h,E.tileAnchorX,E.tileAnchorY);E.zOffset=G!==Number.NEGATIVE_INFINITY?G:I,y||I===E.zOffset||(y=!0),l.hasAnyZOffset||E.zOffset===0||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,h,y,S){let E=h,I=y;if(l.canonical.z!==S.canonical.z){const G=S.canonical,$=1/(1<<l.canonical.z-G.z);E=(h+l.canonical.x*s.ab)*$-G.x*s.ab|0,I=(y+l.canonical.y*s.ab)*$-G.y*s.ab|0}return{tileX:E,tileY:I}}_getHeightAtTileOffset(l,h,y){let S,E;for(let I=0;I<this.layers.length;++I){if(this.layers[I].layer.type!=="fill-extrusion")continue;const{bucket:G,tileID:$,verticalScale:Y}=this.currentBuildingBuckets[I];if(!G)continue;const{tileX:X,tileY:ee}=this._mapCoordToOverlappingTile(l,h,y,$),ie=G.getHeightAtTileCoord(X,ee);ie&&ie.height!==void 0&&(ie.hidden?S=ie.height:E=Math.max(ie.height*Y,E||0))}if(E!==void 0)return E;for(let I=0;I<this.layers.length;++I){const G=this.layers[I];if(G.layer.type!=="model"||!G.visible)continue;const{bucket:$,tileID:Y}=this.currentBuildingBuckets[I];if(!$)continue;const{tileX:X,tileY:ee}=this._mapCoordToOverlappingTile(l,h,y,Y),ie=$.getHeightAtTileCoord(X,ee);if(ie&&!ie.hidden)return ie.height===void 0&&S!==void 0?Math.min(ie.maxHeight,S)*ie.verticalScale:ie.height?ie.height*ie.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xd(g,l){const h={};for(const y in g)y!=="ref"&&(h[y]=g[y]);return s.bh.forEach(y=>{y in l&&(h[y]=l[y])}),h}function Df(g){g=g.slice();const l=Object.create(null);for(let h=0;h<g.length;h++)l[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=xd(g[h],l[g[h].ref]));return g}const cr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function uh(g,l,h){h.push({command:cr.addSource,args:[g,l[g]]})}function Mr(g,l,h){l.push({command:cr.removeSource,args:[g]}),h[g]=!0}function Av(g,l,h,y){Mr(g,h,y),uh(g,l,h)}function Hn(g,l,h){let y;for(y in g[h])if(g[h].hasOwnProperty(y)&&y!=="data"&&!s.bi(g[h][y],l[h][y]))return!1;for(y in l[h])if(l[h].hasOwnProperty(y)&&y!=="data"&&!s.bi(g[h][y],l[h][y]))return!1;return!0}function wd(g,l,h,y,S,E){let I;for(I in l=l||{},g=g||{})g.hasOwnProperty(I)&&(s.bi(g[I],l[I])||h.push({command:E,args:[y,I,l[I],S]}));for(I in l)l.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(s.bi(g[I],l[I])||h.push({command:E,args:[y,I,l[I],S]}))}function $c(g){return g.id}function hh(g,l){return g[l.id]=l,g}class Rl{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ap(l,0,1);let h=1,y=this._distances[h];const S=l*this.paddedLength+this.padding;for(;y<S&&h<this._distances.length;)y=this._distances[++h];const E=h-1,I=this._distances[E],G=y-I,$=G>0?(S-I)/G:0;return this.points[E].mult(1-$).add(this.points[h].mult($))}}class fm{constructor(l,h,y){const S=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let I=0;I<this.xCellCount*this.yCellCount;I++)S.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,S,E){this._forEachCell(h,y,S,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(S),this.bboxes.push(E)}insertCircle(l,h,y,S){this._forEachCell(h-S,y-S,h+S,y+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(S)}_insertBoxCell(l,h,y,S,E,I){this.boxCells[E].push(I)}_insertCircleCell(l,h,y,S,E,I){this.circleCells[E].push(I)}_query(l,h,y,S,E,I){if(y<0||l>this.width||S<0||h>this.height)return!E&&[];const G=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=S){if(E)return!0;for(let $=0;$<this.boxKeys.length;$++)G.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const Y=this.circles[3*$],X=this.circles[3*$+1],ee=this.circles[3*$+2];G.push({key:this.circleKeys[$],x1:Y-ee,y1:X-ee,x2:Y+ee,y2:X+ee})}return I?G.filter(I):G}return this._forEachCell(l,h,y,S,this._queryCell,G,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?G.length>0:G}_queryCircle(l,h,y,S,E){const I=l-y,G=l+y,$=h-y,Y=h+y;if(G<0||I>this.width||Y<0||$>this.height)return!S&&[];const X=[];return this._forEachCell(I,$,G,Y,this._queryCellCircle,X,{hitTest:S,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},E),S?X.length>0:X}query(l,h,y,S,E){return this._query(l,h,y,S,!1,E)}hitTest(l,h,y,S,E){return this._query(l,h,y,S,!0,E)}hitTestCircle(l,h,y,S){return this._queryCircle(l,h,y,!0,S)}_queryCell(l,h,y,S,E,I,G,$){const Y=G.seenUids,X=this.boxCells[E];if(X!==null){const ie=this.bboxes;for(const he of X)if(!Y.box[he]){Y.box[he]=!0;const ye=4*he;if(l<=ie[ye+2]&&h<=ie[ye+3]&&y>=ie[ye+0]&&S>=ie[ye+1]&&(!$||$(this.boxKeys[he]))){if(G.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[he],x1:ie[ye],y1:ie[ye+1],x2:ie[ye+2],y2:ie[ye+3]})}}}const ee=this.circleCells[E];if(ee!==null){const ie=this.circles;for(const he of ee)if(!Y.circle[he]){Y.circle[he]=!0;const ye=3*he;if(this._circleAndRectCollide(ie[ye],ie[ye+1],ie[ye+2],l,h,y,S)&&(!$||$(this.circleKeys[he]))){if(G.hitTest)return I.push(!0),!0;{const ve=ie[ye],be=ie[ye+1],Ce=ie[ye+2];I.push({key:this.circleKeys[he],x1:ve-Ce,y1:be-Ce,x2:ve+Ce,y2:be+Ce})}}}}}_queryCellCircle(l,h,y,S,E,I,G,$){const Y=G.circle,X=G.seenUids,ee=this.boxCells[E];if(ee!==null){const he=this.bboxes;for(const ye of ee)if(!X.box[ye]){X.box[ye]=!0;const ve=4*ye;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,he[ve+0],he[ve+1],he[ve+2],he[ve+3])&&(!$||$(this.boxKeys[ye])))return I.push(!0),!0}}const ie=this.circleCells[E];if(ie!==null){const he=this.circles;for(const ye of ie)if(!X.circle[ye]){X.circle[ye]=!0;const ve=3*ye;if(this._circlesCollide(he[ve],he[ve+1],he[ve+2],Y.x,Y.y,Y.radius)&&(!$||$(this.circleKeys[ye])))return I.push(!0),!0}}}_forEachCell(l,h,y,S,E,I,G,$){const Y=this._convertToXCellCoord(l),X=this._convertToYCellCoord(h),ee=this._convertToXCellCoord(y),ie=this._convertToYCellCoord(S);for(let he=Y;he<=ee;he++)for(let ye=X;ye<=ie;ye++)if(E.call(this,l,h,y,S,this.xCellCount*ye+he,I,G,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,S,E,I){const G=S-l,$=E-h,Y=y+I;return Y*Y>G*G+$*$}_circleAndRectCollide(l,h,y,S,E,I,G){const $=(I-S)/2,Y=Math.abs(l-(S+$));if(Y>$+y)return!1;const X=(G-E)/2,ee=Math.abs(h-(E+X));if(ee>X+y)return!1;if(Y<=$||ee<=X)return!0;const ie=Y-$,he=ee-X;return ie*ie+he*he<=y*y}}const bs={unknown:0,flipRequired:1,flipNotRequired:2},Wn=Math.tan(85*Math.PI/180);function ur(g,l,h,y,S,E,I){const G=s.a6.mat4.create();if(h)if(E.name==="globe"){const $=s.bj(S,l);s.a6.mat4.multiply(G,G,$)}else{const $=s.a6.mat2.invert([],I);G[0]=$[0],G[1]=$[1],G[4]=$[2],G[5]=$[3],y||s.a6.mat4.rotateZ(G,G,S.angle)}else s.a6.mat4.multiply(G,S.labelPlaneMatrix,g);return G}function nr(g,l,h,y,S,E,I){const G=ur(g,l,h,y,S,E,I);return E.name==="globe"&&h||(G[2]=G[6]=G[10]=G[14]=0),G}function Ia(g,l,h,y,S,E,I){if(h){if(E.name==="globe"){const G=ur(g,l,h,y,S,E,I);return s.a6.mat4.invert(G,G),s.a6.mat4.multiply(G,g,G),G}{const G=s.a6.mat4.clone(g),$=s.a6.mat4.identity([]);return $[0]=I[0],$[1]=I[1],$[4]=I[2],$[5]=I[3],s.a6.mat4.multiply(G,G,$),y||s.a6.mat4.rotateZ(G,G,-S.angle),G}}return S.glCoordMatrix}function xo(g,l,h,y){const S=[g,l,h,1];h?s.a6.vec4.transformMat4(S,S,y):gm(S,S,y);const E=S[3];return S[0]/=E,S[1]/=E,S[2]/=E,S}function $i(g,l){return Math.min(.5+g/l*.5,1.5)}function pm(g,l){const h=g[0]/g[3],y=g[1]/g[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function Cd(g,l,h,y,S,E,I,G,$,Y){const X=h.transform,ee=y?g.textSizeData:g.iconSizeData,ie=s.bk(ee,h.transform.zoom),he=X.projection.name==="globe",ye=[256/h.width*2+1,256/h.height*2+1],ve=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ve.clear();let be=null;he&&(be=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const Ce=g.lineVertexArray,Fe=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ze=h.transform.width/h.transform.height;let Ue,Ze=!1;for(let Ke=0;Ke<Fe.length;Ke++){const Xe=Fe.get(Ke),{numGlyphs:Je,writingMode:ot}=Xe;if(ot!==s.bl.vertical||Ze||Ue===s.bl.horizontal||(Ze=!0),Ue=ot,(Xe.hidden||ot===s.bl.vertical)&&!Ze){wo(Je,ve);continue}Ze=!1;const mt=new s.P(Xe.tileAnchorX,Xe.tileAnchorY);let{x:lt,y:at,z:Nt}=X.projection.projectTilePoint(mt.x,mt.y,Y.canonical);if($){const[sn,Pn,Qn]=$(mt);lt+=sn,at+=Pn,Nt+=Qn}const qt=[lt,at,Nt,1];if(s.a6.vec4.transformMat4(qt,qt,l),!pm(qt,ye)){wo(Je,ve);continue}const ln=qt[3],_n=$i(h.transform.getCameraToCenterDistance(X.projection),ln),En=s.bm(ee,ie,Xe),Ct=I?En/_n:En*_n,on=xo(lt,at,Nt,S);if(on[3]<=0){wo(Je,ve);continue}let Vt={};const an=I?null:$,un=Es(Xe,Ct,!1,G,l,S,E,g.glyphOffsetArray,Ce,ve,be,on,mt,Vt,ze,an,X.projection,Y,I);Ze=un.useVertical,an&&un.needsFlipping&&(Vt={}),(un.notEnoughRoom||Ze||un.needsFlipping&&Es(Xe,Ct,!0,G,l,S,E,g.glyphOffsetArray,Ce,ve,be,on,mt,Vt,ze,an,X.projection,Y,I).notEnoughRoom)&&wo(Je,ve)}y?(g.text.dynamicLayoutVertexBuffer.updateData(ve),be&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(be)):(g.icon.dynamicLayoutVertexBuffer.updateData(ve),be&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(be))}function ya(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve){const{lineStartIndex:be,glyphStartIndex:Ce,segment:Fe}=G,ze=Ce+G.numGlyphs,Ue=be+G.lineLength,Ze=l.getoffsetX(Ce),Ke=l.getoffsetX(ze-1),Xe=Sd(g*Ze,h,y,S,E,I,Fe,be,Ue,$,Y,X,ee,ie,!0,he,ye,ve);if(!Xe)return null;const Je=Sd(g*Ke,h,y,S,E,I,Fe,be,Ue,$,Y,X,ee,ie,!0,he,ye,ve);return Je?{first:Xe,last:Je}:null}function Gs(g,l,h,y){return g===s.bl.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:g===s.bl.vertical?y>0?{needsFlipping:!0}:null:l!==bs.unknown&&function(S,E){return S===0||Math.abs(E/S)>Wn}(h,y)?l===bs.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Es(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce,Fe){const ze=l/24,Ue=g.lineOffsetX*ze,Ze=g.lineOffsetY*ze,{lineStartIndex:Ke,glyphStartIndex:Xe,numGlyphs:Je,segment:ot,writingMode:mt,flipState:lt}=g,at=Ke+g.lineLength,Nt=qt=>{if(X){const[Ct,on,Vt]=qt.up,an=Y.length;s.bn(X,an+0,Ct,on,Vt),s.bn(X,an+1,Ct,on,Vt),s.bn(X,an+2,Ct,on,Vt),s.bn(X,an+3,Ct,on,Vt)}const[ln,_n,En]=qt.point;s.bo(Y,ln,_n,En,qt.angle)};if(Je>1){const qt=ya(ze,G,Ue,Ze,h,ee,ie,g,$,E,he,ve,!1,be,Ce,Fe);if(!qt)return{notEnoughRoom:!0};if(y&&!h){let[ln,_n,En]=qt.first.point,[Ct,on,Vt]=qt.last.point;[ln,_n]=xo(ln,_n,En,I),[Ct,on]=xo(Ct,on,Vt,I);const an=Gs(mt,lt,(Ct-ln)*ye,on-_n);if(g.flipState=an&&an.needsFlipping?bs.flipRequired:bs.flipNotRequired,an)return an}Nt(qt.first);for(let ln=Xe+1;ln<Xe+Je-1;ln++){const _n=Sd(ze*G.getoffsetX(ln),Ue,Ze,h,ee,ie,ot,Ke,at,$,E,he,ve,!1,!1,be,Ce,Fe);if(!_n)return Y.length-=4*(ln-Xe),{notEnoughRoom:!0};Nt(_n)}Nt(qt.last)}else{if(y&&!h){const ln=xo(ie.x,ie.y,0,S),_n=Ke+ot+1,En=new s.P($.getx(_n),$.gety(_n)),Ct=xo(En.x,En.y,0,S),on=Ct[3]>0?Ct:dh(ie,En,ln,1,S,void 0,be,Ce.canonical),Vt=Gs(mt,lt,(on[0]-ln[0])*ye,on[1]-ln[1]);if(g.flipState=Vt&&Vt.needsFlipping?bs.flipRequired:bs.flipNotRequired,Vt)return Vt}const qt=Sd(ze*G.getoffsetX(Xe),Ue,Ze,h,ee,ie,ot,Ke,at,$,E,he,ve,!1,!1,be,Ce,Fe);if(!qt)return{notEnoughRoom:!0};Nt(qt)}return{}}function mm(g,l,h,y,S){const{x:E,y:I,z:G}=y.projectTilePoint(g.x,g.y,l);if(!S)return xo(E,I,G,h);const[$,Y,X]=S(g);return xo(E+$,I+Y,G+X,h)}function dh(g,l,h,y,S,E,I,G){const $=mm(g.sub(l)._unit()._add(g),G,S,I,E);return s.a6.vec3.sub($,h,$),s.a6.vec3.normalize($,$),s.a6.vec3.scaleAndAdd($,h,$,y)}function Sd(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce){const Fe=y?g-l:g+l;let ze=Fe>0?1:-1,Ue=0;y&&(ze*=-1,Ue=Math.PI),ze<0&&(Ue+=Math.PI);let Ze=G+I+(ze>0?0:1)|0,Ke=S,Xe=S,Je=0,ot=0;const mt=Math.abs(Fe),lt=[],at=[];let Nt=E,qt=Nt;const ln=()=>dh(qt,Nt,Xe,mt-Je+1,X,ie,ve,be.canonical);for(;Je+ot<=mt;){if(Ze+=ze,Ze<G||Ze>=$)return null;if(Xe=Ke,qt=Nt,lt.push(Xe),he&&at.push(qt),Nt=new s.P(Y.getx(Ze),Y.gety(Ze)),Ke=ee[Ze],!Ke){const Pn=mm(Nt,be.canonical,X,ve,ie);Ke=Pn[3]>0?ee[Ze]=Pn:ln()}Je+=ot,ot=s.a6.vec3.distance(Xe,Ke)}ye&&ie&&(ee[Ze]&&(Ke=ln(),ot=s.a6.vec3.distance(Xe,Ke)),ee[Ze]=Ke);const _n=(mt-Je)/ot,En=Nt.sub(qt)._mult(_n)._add(qt),Ct=s.a6.vec3.sub([],Ke,Xe),on=s.a6.vec3.scaleAndAdd([],Xe,Ct,_n);let Vt=[0,0,1],an=Ct[0],un=Ct[1];if(Ce&&(Vt=ve.upVector(be.canonical,En.x,En.y),Vt[0]!==0||Vt[1]!==0||Vt[2]!==1)){const Pn=[Vt[2],0,-Vt[0]],Qn=s.a6.vec3.cross([],Vt,Pn);s.a6.vec3.normalize(Pn,Pn),s.a6.vec3.normalize(Qn,Qn),an=s.a6.vec3.dot(Ct,Pn),un=s.a6.vec3.dot(Ct,Qn)}if(h){const Pn=s.a6.vec3.cross([],Vt,Ct);s.a6.vec3.normalize(Pn,Pn),s.a6.vec3.scaleAndAdd(on,on,Pn,h*ze)}const sn=Ue+Math.atan2(un,an);return lt.push(on),he&&at.push(En),{point:on,angle:sn,path:lt,tilePath:at,up:Vt}}function wo(g,l){const h=l.length,y=h+4*g;l.resize(y),l.float32.fill(-1/0,4*h,4*y)}function gm(g,l,h){const y=l[0],S=l[1];return g[0]=h[0]*y+h[4]*S+h[12],g[1]=h[1]*y+h[5]*S+h[13],g[3]=h[3]*y+h[7]*S+h[15],g}const la=100;class ca{constructor(l,h,y=new fm(l.width+200,l.height+200,25),S=new fm(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=S,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+la,this.screenBottomBoundary=l.height+la,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=h}placeCollisionBox(l,h,y,S,E,I,G,$){let Y=y.projectedAnchorX,X=y.projectedAnchorY,ee=y.projectedAnchorZ;const ie=y.elevation,he=y.tileID,ye=l.getProjection();if(ie&&he){const[Ke,Xe,Je]=ye.upVector(he.canonical,y.tileAnchorX,y.tileAnchorY),ot=ye.upVectorScale(he.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Y+=Ke*ie*ot,X+=Xe*ie*ot,ee+=Je*ie*ot}const ve=this.projectAndGetPerspectiveRatio(G,Y,X,ee,y.tileID,ye.name==="globe"||!!ie||this.transform.pitch>0,ye),be=I*ve.perspectiveRatio,Ce=(y.x1*h+S.x-y.padding)*be+ve.point.x,Fe=(y.y1*h+S.y-y.padding)*be+ve.point.y,ze=(y.x2*h+S.x+y.padding)*be+ve.point.x,Ue=(y.y2*h+S.y+y.padding)*be+ve.point.y,Ze=ve.perspectiveRatio<=.55||ve.occluded;return!this.isInsideGrid(Ce,Fe,ze,Ue)||!E&&this.grid.hitTest(Ce,Fe,ze,Ue,$)||Ze?{box:[],offscreen:!1,occluded:ve.occluded}:{box:[Ce,Fe,ze,Ue],offscreen:this.isOffscreen(Ce,Fe,ze,Ue),occluded:!1}}placeCollisionCircles(l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve){const be=[],Ce=this.transform.elevation,Fe=l.getProjection(),ze=Ce?Ce.getAtTileOffsetFunc(ve,this.transform.center.lat,this.transform.worldSize,Fe):null,Ue=new s.P(y.tileAnchorX,y.tileAnchorY);let{x:Ze,y:Ke,z:Xe}=Fe.projectTilePoint(Ue.x,Ue.y,ve.canonical);if(ze){const[En,Ct,on]=ze(Ue);Ze+=En,Ke+=Ct,Xe+=on}const Je=Fe.name==="globe",ot=this.projectAndGetPerspectiveRatio(G,Ze,Ke,Xe,ve,Je||!!Ce||this.transform.pitch>0,Fe),{perspectiveRatio:mt}=ot,lt=(ee?I/mt:I*mt)/s.br,at=xo(Ze,Ke,Xe,$),Nt=ot.signedDistanceFromCamera>0?ya(lt,E,y.lineOffsetX*lt,y.lineOffsetY*lt,!1,at,Ue,y,S,$,{},Ce&&!ee?ze:null,ee&&!!Ce,Fe,ve,ee):null;let qt=!1,ln=!1,_n=!0;if(Nt&&!ot.occluded){const En=.5*he*mt+ye,Ct=new s.P(-100,-100),on=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Vt=new Rl,{first:an,last:un}=Nt,sn=an.path.length;let Pn=[];for(let jn=sn-1;jn>=1;jn--)Pn.push(an.path[jn]);for(let jn=1;jn<un.path.length;jn++)Pn.push(un.path[jn]);const Qn=2.5*En;Y&&(Pn=Pn.map(([jn,li,On],xi)=>(ze&&!Je&&(On=ze(xi<sn-1?an.tilePath[sn-1-xi]:un.tilePath[xi-sn+2])[2]),xo(jn,li,On,Y))),Pn.some(jn=>jn[3]<=0)&&(Pn=[]));let ri=[];if(Pn.length>0){let jn=1/0,li=-1/0,On=1/0,xi=-1/0;for(const Oi of Pn)jn=Math.min(jn,Oi[0]),On=Math.min(On,Oi[1]),li=Math.max(li,Oi[0]),xi=Math.max(xi,Oi[1]);li>=Ct.x&&jn<=on.x&&xi>=Ct.y&&On<=on.y&&(ri=[Pn.map(Oi=>new s.P(Oi[0],Oi[1]))],(jn<Ct.x||li>on.x||On<Ct.y||xi>on.y)&&(ri=s.bp(ri,Ct.x,Ct.y,on.x,on.y)))}for(const jn of ri){Vt.reset(jn,.25*En);let li=0;li=Vt.length<=.5*En?1:Math.ceil(Vt.paddedLength/Qn)+1;for(let On=0;On<li;On++){const xi=On/Math.max(li-1,1),Oi=Vt.lerp(xi),sr=Oi.x+la,jr=Oi.y+la;be.push(sr,jr,En,0);const _r=sr-En,ts=jr-En,br=sr+En,$r=jr+En;if(_n=_n&&this.isOffscreen(_r,ts,br,$r),ln=ln||this.isInsideGrid(_r,ts,br,$r),!h&&this.grid.hitTestCircle(sr,jr,En,ie)&&(qt=!0,!X))return{circles:[],offscreen:!1,collisionDetected:qt,occluded:!1}}}}return{circles:!X&&qt||!ln?[]:be,offscreen:_n,collisionDetected:qt,occluded:ot.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,S=1/0,E=-1/0,I=-1/0;for(const X of l){const ee=new s.P(X.x+la,X.y+la);y=Math.min(y,ee.x),S=Math.min(S,ee.y),E=Math.max(E,ee.x),I=Math.max(I,ee.y),h.push(ee)}const G=this.grid.query(y,S,E,I).concat(this.ignoredGrid.query(y,S,E,I)),$={},Y={};for(const X of G){const ee=X.key;if($[ee.bucketInstanceId]===void 0&&($[ee.bucketInstanceId]={}),$[ee.bucketInstanceId][ee.featureIndex])continue;const ie=[new s.P(X.x1,X.y1),new s.P(X.x2,X.y1),new s.P(X.x2,X.y2),new s.P(X.x1,X.y2)];s.bq(h,ie)&&($[ee.bucketInstanceId][ee.featureIndex]=!0,Y[ee.bucketInstanceId]===void 0&&(Y[ee.bucketInstanceId]=[]),Y[ee.bucketInstanceId].push(ee.featureIndex))}return Y}insertCollisionBox(l,h,y,S,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:S,collisionGroupID:E},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,S,E){const I=h?this.ignoredGrid:this.grid,G={bucketInstanceId:y,featureIndex:S,collisionGroupID:E};for(let $=0;$<l.length;$+=4)I.insertCircle(G,l[$],l[$+1],l[$+2])}projectAndGetPerspectiveRatio(l,h,y,S,E,I,G){const $=[h,y,S,1];let Y=!1;S||this.transform.pitch>0?(s.a6.vec4.transformMat4($,$,l),this.fogState&&E&&G.name!=="globe"&&(Y=function(ie,he,ye,ve,be,Ce){const Fe=Ce.calculateFogTileMatrix(be),ze=[he,ye,ve];return s.a6.vec3.transformMat4(ze,ze,Fe),In(ie,s.a6.vec3.length(ze),Ce.pitch,Ce._fov)}(this.fogState,h,y,S,E.toUnwrapped(),this.transform)>.9)):gm($,$,l);const X=$[3];return{point:new s.P(($[0]/X+1)/2*this.transform.width+la,(-$[1]/X+1)/2*this.transform.height+la),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(G)/X*.5,1.5),signedDistanceFromCamera:X,occluded:I&&$[2]>X||Y}}isOffscreen(l,h,y,S){return y<la||l>=this.screenRightBoundary||S<la||h>this.screenBottomBoundary}isInsideGrid(l,h,y,S){return y>=0&&l<this.gridRightBoundary&&S>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.a6.mat4.identity([]);return s.a6.mat4.translate(l,l,[-100,-100,0]),l}}function Os(g,l,h){const y=l.createTileMatrix(g,g.worldSize,h.toUnwrapped());return s.a6.mat4.multiply(new Float32Array(16),g.projMatrix,y)}function Ff(g,l,h){if(l.projection.name===h.projection.name)return g.projMatrix;const y=h.clone();return y.setProjection(l.projection),Os(y,l.getProjection(),g)}function Tl(g,l,h){return l.name===h.projection.name?g.projMatrix:Os(h,l,g)}class Ms{constructor(l,h,y,S){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):S&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class ea{constructor(l,h,y,S,E,I=!1){this.text=new Ms(l?l.text:null,h,y,E),this.icon=new Ms(l?l.icon:null,h,S,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ja{constructor(l,h,y,S=!1){this.text=l,this.icon=h,this.skipFade=y,this.clipped=S}}class Qs{constructor(){this.invProjMatrix=s.a6.mat4.create(),this.viewportMatrix=s.a6.mat4.create(),this.circles=[]}}class Lf{constructor(l,h,y,S,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=S,this.tileID=E}}class $a{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function Al(g,l,h,y,S){const{horizontalAlign:E,verticalAlign:I}=s.by(g),G=-(E-.5)*l,$=-(I-.5)*h,Y=s.bx(g,y);return new s.P(G+Y[0]*S,$+Y[1]*S)}function Bo(g,l,h,y,S){const E=new s.P(g,l);return h&&E._rotate(y?S:-S),E}class ua{constructor(l,h,y,S,E,I){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new ca(this.transform,E),this.buildingIndex=I,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new $a(y),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,S,E=1){const I=y.getBucket(h),G=y.latestFeatureIndex;if(!I||!G||h.fqid!==I.layerIds[0])return;const $=I.layers[0].layout,Y=I.layers[0].paint,X=y.collisionBoxArray,ee=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),ie=y.tileSize/s.ab,he=y.tileID.toUnwrapped();this.transform.setProjection(I.projection);const ye=(ve=y.tileID,be=I.getProjection(),Ce=this.transform,be.name===this.projection?Ce.calculateProjMatrix(ve.toUnwrapped()):Os(Ce,be,ve));var ve,be,Ce;const Fe=$.get("text-pitch-alignment")==="map",ze=$.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Ue=h.dynamicFilter(),Ze=h.dynamicFilterNeedsFeature(),Ke=this.transform.calculatePixelsToTileUnitsMatrix(y),Xe=nr(ye,y.tileID.canonical,Fe,ze,this.transform,I.getProjection(),Ke);let Je=null;if(Fe){const ln=Ia(ye,y.tileID.canonical,Fe,ze,this.transform,I.getProjection(),Ke);Je=s.a6.mat4.multiply([],this.transform.labelPlaneMatrix,ln)}let ot=null;Ue&&y.latestFeatureIndex&&(ot={unwrappedTileID:he,dynamicFilter:Ue,dynamicFilterNeedsFeature:Ze}),this.retainedQueryData[I.bucketInstanceId]=new Lf(I.bucketInstanceId,G,I.sourceLayerIndex,I.index,y.tileID);const mt=I.layers[0].layout.get("text-size-scale-range"),lt=s.ap(E,mt[0],mt[1]),at=I.layers[0].layout.get("icon-size-scale-range"),Nt=s.ap(E,at[0],at[1]),qt={bucket:I,layout:$,paint:Y,posMatrix:ye,textLabelPlaneMatrix:Xe,labelToScreenMatrix:Je,clippingData:ot,scale:ee,textPixelRatio:ie,holdingForFade:y.holdingForFade(),collisionBoxArray:X,partiallyEvaluatedTextSize:s.bk(I.textSizeData,this.transform.zoom,lt),partiallyEvaluatedIconSize:s.bk(I.iconSizeData,this.transform.zoom,Nt),collisionGroup:this.collisionGroups.get(I.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(S)for(const ln of I.sortKeyRanges){const{sortKey:_n,symbolInstanceStart:En,symbolInstanceEnd:Ct}=ln;l.push({sortKey:_n,symbolInstanceStart:En,symbolInstanceEnd:Ct,parameters:qt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:qt})}attemptAnchorPlacement(l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce,Fe){const{textOffset0:ze,textOffset1:Ue,crossTileID:Ze}=ie,Ke=[ze,Ue],Xe=Al(l,y,S,Ke,E),Je=this.collisionIndex.placeCollisionBox(ye,E,h,Bo(Xe.x,Xe.y,I,G,this.transform.angle),ee,$,Y,X.predicate);if(be){const ot=ye.getSymbolInstanceIconSize(Fe,this.transform.zoom,ie.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ye,ot,be,Bo(Xe.x,Xe.y,I,G,this.transform.angle),ee,$,Y,X.predicate).box.length===0)return}if(Je.box.length>0){let ot;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]&&this.prevPlacement.placements[Ze]&&this.prevPlacement.placements[Ze].text&&(ot=this.prevPlacement.variableOffsets[Ze].anchor),this.variableOffsets[Ze]={textOffset:Ke,width:y,height:S,anchor:l,textScale:E,prevAnchor:ot},this.markUsedJustification(ye,l,ie,ve),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,ve,ie),this.placedOrientations[Ze]=ve),{shift:Xe,placedGlyphBoxes:Je}}}placeLayerBucketPart(l,h,y,S,E=1){const{bucket:I,layout:G,paint:$,posMatrix:Y,textLabelPlaneMatrix:X,labelToScreenMatrix:ee,clippingData:ie,textPixelRatio:he,holdingForFade:ye,collisionBoxArray:ve,partiallyEvaluatedTextSize:be,partiallyEvaluatedIconSize:Ce,collisionGroup:Fe,latestFeatureIndex:ze}=l.parameters,Ue=G.get("text-optional"),Ze=G.get("icon-optional"),Ke=G.get("text-allow-overlap"),Xe=G.get("icon-allow-overlap"),Je=G.get("text-rotation-alignment")==="map",ot=G.get("text-pitch-alignment")==="map",mt=G.get("symbol-z-elevate"),lt=$.get("symbol-z-offset"),at=G.get("symbol-elevation-reference")==="sea",Nt=G.get("text-size-scale-range"),qt=G.get("icon-size-scale-range"),ln=s.ap(E,Nt[0],Nt[1]),_n=s.ap(E,qt[0],qt[1]);this.transform.setProjection(I.projection);let En=Ke&&(Xe||!I.hasIconData()||Ze),Ct=Xe&&(Ke||!I.hasTextData()||Ue);const on=!lt.isConstant();!I.collisionArrays&&ve&&I.deserializeCollisionBoxes(ve),y&&S&&I.updateCollisionDebugBuffers(this.transform.zoom,ve,ln,_n);const Vt=(an,un,sn)=>{const{crossTileID:Pn,numVerticalGlyphVertices:Qn}=an;let ri=null;if(ie&&ie.dynamicFilterNeedsFeature||on){const mr=this.retainedQueryData[I.bucketInstanceId];ri=ze.loadFeature({featureIndex:an.featureIndex,bucketIndex:mr.bucketIndex,sourceLayerIndex:mr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(ie&&!(0,ie.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ri,this.retainedQueryData[I.bucketInstanceId].tileID.canonical,new s.P(an.tileAnchorX,an.tileAnchorY),this.transform.calculateDistanceTileData(ie.unwrappedTileID)))return this.placements[Pn]=new ja(!1,!1,!1,!0),void h.add(Pn);const jn=lt.evaluate(ri,{});if(h.has(Pn))return;if(ye)return void(this.placements[Pn]=new ja(!1,!1,!1));let li=!1,On=!1,xi=!0,Oi=!1,sr=!1,jr=null,_r={box:null,offscreen:null,occluded:null},ts={box:null,offscreen:null,occluded:null},br=null,$r=null,Ki=null,Vr=0,Br=0,Rr=0;sn.textFeatureIndex?Vr=sn.textFeatureIndex:an.useRuntimeCollisionCircles&&(Vr=an.featureIndex),sn.verticalTextFeatureIndex&&(Br=sn.verticalTextFeatureIndex);const us=mr=>{mr.tileID=this.retainedQueryData[I.bucketInstanceId].tileID;const ar=this.transform.elevation;mr.elevation=at?jn:jn+(ar?ar.getAtTileOffset(mr.tileID,mr.tileAnchorX,mr.tileAnchorY):0),mr.elevation+=an.zOffset},mo=sn.textBox;if(mo){us(mo);const mr=Er=>{let Xr=s.bl.horizontal;if(I.allowVerticalPlacement&&!Er&&this.prevPlacement){const Us=this.prevPlacement.placedOrientations[Pn];Us&&(this.placedOrientations[Pn]=Us,Xr=Us,this.markUsedOrientation(I,Xr,an))}return Xr},ar=(Er,Xr)=>{if(I.allowVerticalPlacement&&Qn>0&&sn.verticalTextBox){for(const Us of I.writingModes)if(Us===s.bl.vertical?(_r=Xr(),ts=_r):_r=Er(),_r&&_r.box&&_r.box.length)break}else _r=Er()};if(G.get("text-variable-anchor")){let Er=G.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pn]){const hs=this.prevPlacement.variableOffsets[Pn];Er.indexOf(hs.anchor)>0&&(Er=Er.filter(Wo=>Wo!==hs.anchor),Er.unshift(hs.anchor))}const Xr=(hs,Wo,Bu)=>{const cl=I.getSymbolInstanceTextSize(be,an,this.transform.zoom,un),ul=(hs.x2-hs.x1)*cl+2*hs.padding,Cc=(hs.y2-hs.y1)*cl+2*hs.padding,ru=an.hasIconTextFit&&!Xe?Wo:null;ru&&us(ru);let hl={box:[],offscreen:!1,occluded:!1};const Lh=Ke?2*Er.length:Er.length;for(let Sc=0;Sc<Lh;++Sc){const Ir=this.attemptAnchorPlacement(Er[Sc%Er.length],hs,ul,Cc,cl,Je,ot,he,Y,Fe,Sc>=Er.length,an,un,I,Bu,ru,be,Ce);if(Ir&&(hl=Ir.placedGlyphBoxes,hl&&hl.box&&hl.box.length)){li=!0,jr=Ir.shift;break}}return hl};ar(()=>Xr(mo,sn.iconBox,s.bl.horizontal),()=>{const hs=sn.verticalTextBox;return hs&&us(hs),I.allowVerticalPlacement&&!(_r&&_r.box&&_r.box.length)&&Qn>0&&hs?Xr(hs,sn.verticalIconBox,s.bl.vertical):{box:null,offscreen:null,occluded:null}}),_r&&(li=_r.box,xi=_r.offscreen,Oi=_r.occluded);const Us=mr(!(!_r||!_r.box));if(!li&&this.prevPlacement){const hs=this.prevPlacement.variableOffsets[Pn];hs&&(this.variableOffsets[Pn]=hs,this.markUsedJustification(I,hs.anchor,an,Us))}}else{const Er=(Xr,Us)=>{const hs=I.getSymbolInstanceTextSize(be,an,this.transform.zoom,un,E),Wo=this.collisionIndex.placeCollisionBox(I,hs,Xr,new s.P(0,0),Ke,he,Y,Fe.predicate);return Wo&&Wo.box&&Wo.box.length&&(this.markUsedOrientation(I,Us,an),this.placedOrientations[Pn]=Us),Wo};ar(()=>Er(mo,s.bl.horizontal),()=>{const Xr=sn.verticalTextBox;return I.allowVerticalPlacement&&Qn>0&&Xr?(us(Xr),Er(Xr,s.bl.vertical)):{box:null,offscreen:null,occluded:null}}),mr(!!(_r&&_r.box&&_r.box.length))}}if(br=_r,li=br&&br.box&&br.box.length>0,xi=br&&br.offscreen,Oi=br&&br.occluded,an.useRuntimeCollisionCircles){const mr=I.text.placedSymbolArray.get(an.centerJustifiedTextSymbolIndex>=0?an.centerJustifiedTextSymbolIndex:an.verticalPlacedTextSymbolIndex),ar=s.bm(I.textSizeData,be,mr),Er=G.get("text-padding");$r=this.collisionIndex.placeCollisionCircles(I,Ke,mr,I.lineVertexArray,I.glyphOffsetArray,ar,Y,X,ee,y,ot,Fe.predicate,an.collisionCircleDiameter*ar/s.br,Er,this.retainedQueryData[I.bucketInstanceId].tileID),li=Ke||$r.circles.length>0&&!$r.collisionDetected,xi=xi&&$r.offscreen,Oi=$r.occluded}if(sn.iconFeatureIndex&&(Rr=sn.iconFeatureIndex),sn.iconBox){const mr=ar=>{us(ar);const Er=an.hasIconTextFit&&jr?Bo(jr.x,jr.y,Je,ot,this.transform.angle):new s.P(0,0),Xr=I.getSymbolInstanceIconSize(Ce,this.transform.zoom,an.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(I,Xr,ar,Er,Xe,he,Y,Fe.predicate)};ts&&ts.box&&ts.box.length&&sn.verticalIconBox?(Ki=mr(sn.verticalIconBox),On=Ki.box.length>0):(Ki=mr(sn.iconBox),On=Ki.box.length>0),xi=xi&&Ki.offscreen,sr=Ki.occluded}const Bl=Ue||an.numHorizontalGlyphVertices===0&&Qn===0,wc=Ze||an.numIconVertices===0;if(Bl||wc?wc?Bl||(On=On&&li):li=On&&li:On=li=On&&li,li&&br&&br.box&&this.collisionIndex.insertCollisionBox(br.box,G.get("text-ignore-placement"),I.bucketInstanceId,ts&&ts.box&&Br?Br:Vr,Fe.ID),On&&Ki&&this.collisionIndex.insertCollisionBox(Ki.box,G.get("icon-ignore-placement"),I.bucketInstanceId,Rr,Fe.ID),$r&&(li&&this.collisionIndex.insertCollisionCircles($r.circles,G.get("text-ignore-placement"),I.bucketInstanceId,Vr,Fe.ID),y)){const mr=I.bucketInstanceId;let ar=this.collisionCircleArrays[mr];ar===void 0&&(ar=this.collisionCircleArrays[mr]=new Qs);for(let Er=0;Er<$r.circles.length;Er+=4)ar.circles.push($r.circles[Er+0]),ar.circles.push($r.circles[Er+1]),ar.circles.push($r.circles[Er+2]),ar.circles.push($r.collisionDetected?1:0)}const To=I.projection.name!=="globe";En=En&&(To||!Oi),Ct=Ct&&(To||!sr),this.placements[Pn]=new ja(li||En,On||Ct,xi||I.justReloaded),h.add(Pn)};if(mt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,this.retainedQueryData[I.bucketInstanceId].tileID),I.updateZOffset()),I.sortFeaturesByY){const an=I.getSortedSymbolIndexes(this.transform.angle);for(let un=an.length-1;un>=0;--un){const sn=an[un];Vt(I.symbolInstances.get(sn),sn,I.collisionArrays[sn])}I.hasAnyZOffset&&s.w(`${I.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(I.hasAnyZOffset){const an=I.getSortedIndexesByZOffset();for(let un=0;un<an.length;++un){const sn=an[un];Vt(I.symbolInstances.get(sn),sn,I.collisionArrays[sn])}}else for(let an=l.symbolInstanceStart;an<l.symbolInstanceEnd;an++)Vt(I.symbolInstances.get(an),an,I.collisionArrays[an]);if(y&&I.bucketInstanceId in this.collisionCircleArrays){const an=this.collisionCircleArrays[I.bucketInstanceId];s.a6.mat4.invert(an.invProjMatrix,Y),an.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(l,h,y,S){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:$,crossTileID:Y}=y,X=s.bw(h),ee=S===s.bl.vertical?$:X==="left"?E:X==="center"?I:X==="right"?G:-1;E>=0&&(l.text.placedSymbolArray.get(E).crossTileID=ee>=0&&E!==ee?0:Y),I>=0&&(l.text.placedSymbolArray.get(I).crossTileID=ee>=0&&I!==ee?0:Y),G>=0&&(l.text.placedSymbolArray.get(G).crossTileID=ee>=0&&G!==ee?0:Y),$>=0&&(l.text.placedSymbolArray.get($).crossTileID=ee>=0&&$!==ee?0:Y)}markUsedOrientation(l,h,y){const S=h===s.bl.horizontal||h===s.bl.horizontalOnly?h:0,E=h===s.bl.vertical?h:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:G,rightJustifiedTextSymbolIndex:$,verticalPlacedTextSymbolIndex:Y}=y,X=l.text.placedSymbolArray;I>=0&&(X.get(I).placedOrientation=S),G>=0&&(X.get(G).placedOrientation=S),$>=0&&(X.get($).placedOrientation=S),Y>=0&&(X.get(Y).placedOrientation=E)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const S=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},I=h?h.variableOffsets:{},G=h?h.placedOrientations:{};for(const $ in this.placements){const Y=this.placements[$],X=E[$];X?(this.opacities[$]=new ea(X,S,Y.text,Y.icon,null,Y.clipped),y=y||Y.text!==X.text.placed||Y.icon!==X.icon.placed):(this.opacities[$]=new ea(null,S,Y.text,Y.icon,Y.skipFade,Y.clipped),y=y||Y.text||Y.icon)}for(const $ in E){const Y=E[$];if(!this.opacities[$]){const X=new ea(Y,S,!1,!1);X.isHidden()||(this.opacities[$]=X,y=y||Y.text.placed||Y.icon.placed)}}for(const $ in I)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=I[$]);for(const $ in G)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=G[$]);y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h,y,S){const E=new Set;for(const I of h){const G=I.getBucket(l);G&&I.latestFeatureIndex&&l.fqid===G.layerIds[0]&&(this.updateBucketOpacities(G,E,I,I.collisionBoxArray,y,S,I.tileID,l.scope),G.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(G,I.tileID),G.updateZOffset()))}}updateBucketOpacities(l,h,y,S,E,I,G,$){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const Y=l.layers[0].layout,X=l.layers[0].paint,ee=!!l.layers[0].dynamicFilter(),ie=new ea(null,0,!1,!1,!0),he=Y.get("text-allow-overlap"),ye=Y.get("icon-allow-overlap"),ve=Y.get("text-variable-anchor"),be=Y.get("text-rotation-alignment")==="map",Ce=Y.get("text-pitch-alignment")==="map",Fe=X.get("symbol-z-offset"),ze=Y.get("symbol-elevation-reference")==="sea",Ue=!Fe.isConstant(),Ze=new ea(null,0,he&&(ye||!l.hasIconData()||Y.get("icon-optional")),ye&&(he||!l.hasTextData()||Y.get("text-optional")),!0);!l.collisionArrays&&S&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(S);const Ke=(Je,ot,mt)=>{for(let lt=0;lt<ot/4;lt++)Je.opacityVertexArray.emplaceBack(mt)};let Xe=0;I&&l.updateReplacement(G,I);for(let Je=0;Je<l.symbolInstances.length;Je++){const ot=l.symbolInstances.get(Je),{numHorizontalGlyphVertices:mt,numVerticalGlyphVertices:lt,crossTileID:at,numIconVertices:Nt,tileAnchorX:qt,tileAnchorY:ln}=ot;let _n=null;const En=this.retainedQueryData[l.bucketInstanceId];Ue&&ot&&En&&(_n=y.latestFeatureIndex.loadFeature({featureIndex:ot.featureIndex,bucketIndex:En.bucketIndex,sourceLayerIndex:En.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ct=Fe.evaluate(_n,{}),on=h.has(at);let Vt=this.opacities[at];on?Vt=ie:Vt||(Vt=Ze,this.opacities[at]=Vt),h.add(at);const an=mt>0||lt>0,un=Nt>0,sn=this.placedOrientations[at],Pn=sn===s.bl.vertical,Qn=sn===s.bl.horizontal||sn===s.bl.horizontalOnly;!an&&!un||Vt.isHidden()||Xe++;let ri=!1;if((an||un)&&I)for(const jn of l.activeReplacements){if(s.bs(jn,E,s.bt.Symbol,$)||jn.min.x>qt||qt>jn.max.x||jn.min.y>ln||ln>jn.max.y)continue;const li=s.bu(qt,ln,G.canonical,jn.footprintTileId.canonical);if(ri=s.bv(li,jn.footprint),ri)break}if(an){const jn=ri?ph:fh(Vt.text);Ke(l.text,mt,Pn?ph:jn),Ke(l.text,lt,Qn?ph:jn);const li=Vt.text.isHidden(),{leftJustifiedTextSymbolIndex:On,centerJustifiedTextSymbolIndex:xi,rightJustifiedTextSymbolIndex:Oi,verticalPlacedTextSymbolIndex:sr}=ot,jr=l.text.placedSymbolArray,_r=li||Pn?1:0;On>=0&&(jr.get(On).hidden=_r),xi>=0&&(jr.get(xi).hidden=_r),Oi>=0&&(jr.get(Oi).hidden=_r),sr>=0&&(jr.get(sr).hidden=li||Qn?1:0);const ts=this.variableOffsets[at];ts&&this.markUsedJustification(l,ts.anchor,ot,sn);const br=this.placedOrientations[at];br&&(this.markUsedJustification(l,"left",ot,br),this.markUsedOrientation(l,br,ot))}if(un){const jn=ri?ph:fh(Vt.icon),{placedIconSymbolIndex:li,verticalPlacedIconSymbolIndex:On}=ot,xi=l.icon.placedSymbolArray,Oi=Vt.icon.isHidden()?1:0;li>=0&&(Ke(l.icon,Nt,Pn?ph:jn),xi.get(li).hidden=Oi),On>=0&&(Ke(l.icon,ot.numVerticalIconVertices,Qn?ph:jn),xi.get(On).hidden=Oi)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const jn=l.collisionArrays[Je];if(jn){let li=new s.P(0,0),On=!0;if(jn.textBox||jn.verticalTextBox){if(ve){const Oi=this.variableOffsets[at];Oi?(li=Al(Oi.anchor,Oi.width,Oi.height,Oi.textOffset,Oi.textScale),be&&li._rotate(Ce?this.transform.angle:-this.transform.angle)):On=!1}ee&&(On=!Vt.clipped),jn.textBox&&Pl(l.textCollisionBox.collisionVertexArray,Vt.text.placed,!On||Pn,Ct,ze,li.x,li.y),jn.verticalTextBox&&Pl(l.textCollisionBox.collisionVertexArray,Vt.text.placed,!On||Qn,Ct,ze,li.x,li.y)}const xi=On&&!!(!Qn&&jn.verticalIconBox);jn.iconBox&&Pl(l.iconCollisionBox.collisionVertexArray,Vt.icon.placed,xi,Ct,ze,ot.hasIconTextFit?li.x:0,ot.hasIconTextFit?li.y:0),jn.verticalIconBox&&Pl(l.iconCollisionBox.collisionVertexArray,Vt.icon.placed,!xi,Ct,ze,ot.hasIconTextFit?li.x:0,ot.hasIconTextFit?li.y:0)}}}if(l.fullyClipped=Xe===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Je.invProjMatrix,l.placementViewportMatrix=Je.viewportMatrix,l.collisionCircleArray=Je.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Pl(g,l,h,y,S,E,I){g.emplaceBack(l?1:0,h?1:0,E||0,I||0,y,S?1:0),g.emplaceBack(l?1:0,h?1:0,E||0,I||0,y,S?1:0),g.emplaceBack(l?1:0,h?1:0,E||0,I||0,y,S?1:0),g.emplaceBack(l?1:0,h?1:0,E||0,I||0,y,S?1:0)}const Il=Math.pow(2,25),Z_=Math.pow(2,24),uc=Math.pow(2,17),eo=Math.pow(2,16),vm=Math.pow(2,9),Of=Math.pow(2,8),kf=Math.pow(2,1);function fh(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Il+l*Z_+h*uc+l*eo+h*vm+l*Of+h*kf+l}const ph=0;class Pv{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,h,y,S,E,I){const G=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(G,S,l[this._currentTileIndex],this._sortAcrossTiles,I),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,G.sort(($,Y)=>$.sortKey-Y.sortKey));this._currentPartIndex<G.length;){const $=G[this._currentPartIndex];if(h.placeLayerBucketPart($,this._seenCrossTileIDs,y,$.symbolInstanceStart===0,I),this._currentPartIndex++,E())return!0}return!1}}class Eu{constructor(l,h,y,S,E,I,G,$,Y){this.placement=new ua(l,E,I,G,$,Y),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y,S,E){const I=s.q.now(),G=()=>{const $=s.q.now()-I;return!this._forceFullPlacement&&$>2};for(;this._currentPlacementIndex>=0;){const $=h[l[this._currentPlacementIndex]],Y=this.placement.collisionIndex.transform.zoom;if($.type==="symbol"&&(!$.minzoom||$.minzoom<=Y)&&(!$.maxzoom||$.maxzoom>Y)){const X=$,ee=X.layout.get("symbol-z-elevate"),ie=X.layout.get("symbol-sort-key").constantOr(1)!==void 0,he=X.layout.get("symbol-z-order"),ye=he==="viewport-y"||he==="auto"&&!(he!=="viewport-y"&&ie),ve=X.layout.get("text-allow-overlap")||X.layout.get("icon-allow-overlap")||X.layout.get("text-ignore-placement")||X.layout.get("icon-ignore-placement"),be=ye&&ve,Ce=this._inProgressLayer=this._inProgressLayer||new Pv(X),Fe=s.av($.source,$.scope);if(Ce.continuePlacement(ee||be?S[Fe]:y[Fe],this.placement,this._showCollisionBoxes,$,G,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Mu=512/s.ab/2;class X_{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this.index=new s.bz(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=l.canonical.x*s.ab,E=l.canonical.y*s.ab;for(let I=0;I<h.length;I++){const{key:G,crossTileID:$,tileAnchorX:Y,tileAnchorY:X}=h.get(I),ee=Math.floor((S+Y)*Mu),ie=Math.floor((E+X)*Mu);this.index.add(ee,ie),this.keys.push(G),this.crossTileIDs.push($)}this.index.finish()}findMatches(l,h,y){const S=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=Mu/Math.pow(2,h.canonical.z-this.tileID.canonical.z),I=h.canonical.x*s.ab,G=h.canonical.y*s.ab;for(let $=0;$<l.length;$++){const Y=l.get($);if(Y.crossTileID)continue;const{key:X,tileAnchorX:ee,tileAnchorY:ie}=Y,he=Math.floor((I+ee)*E),ye=Math.floor((G+ie)*E),ve=this.index.range(he-S,ye-S,he+S,ye+S);for(const be of ve){const Ce=this.crossTileIDs[be];if(this.keys[be]===X&&!y.has(Ce)){y.add(Ce),Y.crossTileID=Ce;break}}}}}class mh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ym{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const y in this.indexes){const S=this.indexes[y],E={};for(const I in S){const G=S[I];G.tileID=G.tileID.unwrapTo(G.tileID.wrap+h),E[G.tileID.key]=G}this.indexes[y]=E}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let E=0;E<h.symbolInstances.length;E++)h.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const S=this.usedCrossTileIDs[l.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>l.overscaledZ)for(const G in I){const $=I[G];$.tileID.isChildOf(l)&&$.findMatches(h.symbolInstances,l,S)}else{const G=I[l.scaledTo(Number(E)).key];G&&G.findMatches(h.symbolInstances,l,S)}}for(let E=0;E<h.symbolInstances.length;E++){const I=h.symbolInstances.get(E);I.crossTileID||(I.crossTileID=y.generate(),S.add(I.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new X_(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const S=this.indexes[y];for(const E in S)l[S[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,S[E]),delete S[E],h=!0)}return h}}class qc{constructor(){this.layerIndexes={},this.crossTileIDs=new mh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y,S){let E=this.layerIndexes[l.fqid];E===void 0&&(E=this.layerIndexes[l.fqid]=new ym);let I=!1;const G={};S.name!=="globe"&&E.handleWrapJump(y);for(const $ of h){const Y=$.getBucket(l);Y&&l.fqid===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket($.tileID,Y,this.crossTileIDs)&&(I=!0),G[Y.bucketInstanceId]=!0)}return E.removeStaleBuckets(G)&&(I=!0),I}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const zo=771;class Vi{constructor(l,h,y,S){this.blendFunction=l,this.blendColor=h,this.mask=y,this.blendEquation=S}}Vi.Replace=[1,0,1,0],Vi.disabled=new Vi(Vi.Replace,s.bA.transparent,[!1,!1,!1,!1]),Vi.unblended=new Vi(Vi.Replace,s.bA.transparent,[!0,!0,!0,!0]),Vi.alphaBlended=new Vi([1,zo,1,zo],s.bA.transparent,[!0,!0,!0,!0]),Vi.alphaBlendedNonPremultiplied=new Vi([770,zo,770,zo],s.bA.transparent,[!0,!0,!0,!0]),Vi.multiply=new Vi([774,0,774,0],s.bA.transparent,[!0,!0,!0,!0]);class ii{constructor(l,h,y){this.func=l,this.mask=h,this.range=y}}ii.ReadOnly=!1,ii.ReadWrite=!0,ii.disabled=new ii(519,ii.ReadOnly,[0,1]);const Da=7680;class _i{constructor(l,h,y,S,E,I){this.test=l,this.ref=h,this.mask=y,this.fail=S,this.depthFail=E,this.pass=I}}_i.disabled=new _i({func:519,mask:0},0,0,Da,Da,Da);const Zc=1029,qa=2305;class yi{constructor(l,h,y){this.enable=l,this.mode=h,this.frontFace=y}}function Xc(g,l){const h=s.bD(g,3);s.a6.mat4.fromQuat(g,l),s.bF(g,3,h)}function Nf(g,l){const h=s.a6.quat.identity([]);return s.a6.quat.rotateZ(h,h,-l),s.a6.quat.rotateX(h,h,-g),h}function Bf(g,l){const h=[g[0],g[1],0],y=[l[0],l[1],0];if(s.a6.vec3.length(h)>=1e-15){const I=s.a6.vec3.normalize([],h);s.a6.vec3.scale(y,I,s.a6.vec3.dot(y,I)),l[0]=y[0],l[1]=y[1]}const S=s.a6.vec3.cross([],l,g);if(s.a6.vec3.len(S)<1e-15)return null;const E=Math.atan2(-S[1],S[0]);return Nf(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}yi.disabled=new yi(!1,Zc,qa),yi.backCCW=new yi(!0,Zc,qa),yi.backCW=new yi(!0,Zc,2304),yi.frontCW=new yi(!0,1028,2304),yi.frontCCW=new yi(!0,1028,qa);class hc{constructor(l,h){this.position=l,this.orientation=h}get position(){return this._position}set position(l){if(l){const h=l instanceof s.a5?l:new s.a5(l[0],l[1],l[2]);this._renderWorldCopies&&(h.x=s.bB(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(l,h){if(this.orientation=null,!this.position)return;const y=this.position,S=this._elevation?this._elevation.getAtPointOrZero(s.a5.fromLngLat(l)):0,E=s.a5.fromLngLat(l,S),I=[E.x-y.x,E.y-y.y,E.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Bf(I,h)}setPitchBearing(l,h){this.orientation=Nf(s.bC(l),s.bC(-h))}}class Co{constructor(l,h){this._transform=s.a6.mat4.identity([]),this.orientation=h,this.position=l}get mercatorPosition(){const l=this.position;return new s.a5(l[0],l[1],l[2])}get position(){const l=s.bD(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var h;l&&s.bF(this._transform,3,[(h=l)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.a6.quat.identity([]),l&&Xc(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,h){this._orientation=Nf(l,h),Xc(this._transform,this._orientation)}forward(){const l=s.bD(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.bD(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.bD(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,h){const y=new Float64Array(16);return s.a6.mat4.invert(y,this.getWorldToCamera(l,h)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,h,y){const S=this.position;s.a6.vec3.scale(S,S,-l);const E=new Float64Array(16);return s.a6.mat4.fromScaling(E,[y,y,y]),s.a6.mat4.translate(E,E,S),E[10]*=h,E}getWorldToCamera(l,h){const y=new Float64Array(16),S=new Float64Array(4),E=this.position;return s.a6.quat.conjugate(S,this._orientation),s.a6.vec3.scale(E,E,-l),s.a6.mat4.fromQuat(y,S),s.a6.mat4.translate(y,y,E),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(l,h,y,S){const E=new Float64Array(16);return s.a6.mat4.perspective(E,l,h,y,S),E}getCameraToClipOrthographic(l,h,y,S,E,I){const G=new Float64Array(16);return s.a6.mat4.ortho(G,l,h,y,S,E,I),G}getDistanceToElevation(l,h=!1){const y=l===0?0:s.bE(l,h?s.aN(this.position[1]):this.position[1]),S=this.forward();return(y-this.position[2])/S[2]}clone(){return new Co([...this.position],[...this.orientation])}}const ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class As{constructor(l=0,h=0,y=0,S=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=S}interpolate(l,h,y){return h.top!=null&&l.top!=null&&(this.top=s.aa(l.top,h.top,y)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.aa(l.bottom,h.bottom,y)),h.left!=null&&l.left!=null&&(this.left=s.aa(l.left,h.left,y)),h.right!=null&&l.right!=null&&(this.right=s.aa(l.right,h.right,y)),this}getCenter(l,h){const y=s.ap((this.left+l-this.right)/2,0,l),S=s.ap((this.top+h-this.bottom)/2,0,h);return new s.P(y,S)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new As(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const dc=(g,l,h)=>(1-h)*g+h*l,ha=g=>g*g*g*g*g;class zf{constructor(l,h,y,S,E,I,G){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=S??60,this.setProjection(I),this.setMaxBounds(G),this.width=0,this.height=0,this._center=new s.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new As,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Co,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new zf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return s.ar(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=s.bM(this.projectionOptions);const y=this.getProjection(),S=!s.bi(h,y);return S&&this._calcMatrices(),this.mercatorFromTransition=!1,S}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bM({name:"mercator"});const h=l!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bB(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const h=-l*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=s.a6.mat2.create(),s.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.ap(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.bC(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let S=0,E=0;for(let I=0;I<h.length;I++){const G=new s.P(h[I][0]*this.width,y+h[I][1]*(this.height-y)),$=l.pointCoordinate(G);if(!$)continue;const Y=1/Math.hypot($[0]-this._camera.position[0],$[1]-this._camera.position[1]);S+=$[3]*Y,E+=Y}return E===0?NaN:S/E}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,S=this._mercatorZfromZoom(l),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(S-y,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[h.x,h.y,h.z]:[l.x,l.y,l.z];const S=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,y));return s.ap(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let h=!1;if(l.orientation&&!s.a6.quat.exactEquals(l.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];s.a6.vec3.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,h=new hc;return h.position=new s.a5(l[0],l[1],l[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(l){if(!s.a6.quat.length(l))return!1;s.a6.quat.normalize(l,l);const h=s.a6.vec3.transformQuat([],[0,0,-1],l),y=s.a6.vec3.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const S=Bf(h,y);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(l){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;l[2]=s.ap(l[2],S/y,S/h),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.bN(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),S=this.pointCoordinate(new s.P(this.width,0)),E=this.pointCoordinate(new s.P(this.width,this.height)),I=this.pointCoordinate(new s.P(0,this.height)),G=Math.floor(Math.min(y.x,S.x,E.x,I.x)),$=Math.floor(Math.max(y.x,S.x,E.x,I.x)),Y=1;for(let X=G-Y;X<=$+Y;X++)X!==0&&h.push(new s.bN(X,l))}return h}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,h,y){let S=[];const E=y!==void 0,I=!E;if(I&&this.zoom<h||E&&y[0]===0&&y[1]===0)return S;const G=new Set,$=(X,ee,ie,he,ye)=>{const ve=s.c2(ee,X,ie,he,ye);G.has(ve)||(S.push(new s.aA(X,ee,ie,he,ye)),G.add(ve))};for(let X=0;X<l.length;X++){const ee=l[X];if(I&&ee.canonical.z!==h)continue;const ie=ee.canonical,he=ee.overscaledZ,ye=ee.wrap,ve=1<<ie.z,be=ie.x+1<ve,Ce=ie.x>0,Fe=ie.y+1<ve,ze=ie.y>0,Ue=ee.wrap-(Ce?0:1),Ze=ee.wrap+(be?0:1),Ke=Ce?ie.x-1:ve-1,Xe=be?ie.x+1:0;if(E)y[0]<0?($(he,Ze,ie.z,Xe,ie.y),y[1]<0&&Fe&&($(he,ye,ie.z,ie.x,ie.y+1),$(he,Ze,ie.z,Xe,ie.y+1)),y[1]>0&&ze&&($(he,ye,ie.z,ie.x,ie.y-1),$(he,Ze,ie.z,Xe,ie.y-1))):y[0]>0?($(he,Ue,ie.z,Ke,ie.y),y[1]<0&&Fe&&($(he,ye,ie.z,ie.x,ie.y+1),$(he,Ue,ie.z,Ke,ie.y+1)),y[1]>0&&ze&&($(he,ye,ie.z,ie.x,ie.y-1),$(he,Ue,ie.z,Ke,ie.y-1))):y[1]<0&&Fe?$(he,ye,ie.z,ie.x,ie.y+1):ze&&$(he,ye,ie.z,ie.x,ie.y-1);else{const Je=ee.visibleQuadrants;1&Je&&($(he,Ue,ie.z,Ke,ie.y),ze&&($(he,ye,ie.z,ie.x,ie.y-1),$(he,Ue,ie.z,Ke,ie.y-1))),2&Je&&($(he,Ze,ie.z,Xe,ie.y),ze&&($(he,ye,ie.z,ie.x,ie.y-1),$(he,Ze,ie.z,Xe,ie.y-1))),4&Je&&($(he,Ue,ie.z,Ke,ie.y),Fe&&($(he,ye,ie.z,ie.x,ie.y+1),$(he,Ue,ie.z,Ke,ie.y+1))),8&Je&&($(he,Ze,ie.z,Xe,ie.y),Fe&&($(he,ye,ie.z,ie.x,ie.y+1),$(he,Ze,ie.z,Xe,ie.y+1)))}}const Y=[];for(const X of S)S.some(ee=>X.isChildOf(ee))||Y.push(X);if(S=Y.filter(X=>!l.some(ee=>!!(X.overscaledZ<h&&ee.isChildOf(X))||X.equals(ee)||X.isChildOf(ee))),I){const X=1<<h,ee=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=[X*ee.x,X*ee.y],he=4,ye=he*he;S=S.filter(ve=>{const be=ve.canonical.x+.5-ie[0],Ce=ve.canonical.y+.5-ie[1];return be*be+Ce*Ce<ye})}return S}coveringTiles(l){let h=this.coveringZoomLevel(l);const y=h,S=this.elevation&&this.elevation.exaggeration(),E=S&&!l.isTerrainDEM,I=this.projection.name==="mercator";if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);const G=this.locationCoordinate(this.center),$=this.center.lat,Y=1<<h,X=[Y*G.x,Y*G.y,0],ee=this.projection.name==="globe",ie=!ee,he=s.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,ie),ye=ee?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ve=Y*s.bE(1,this.center.lat),be=this._camera.position[2]/s.bE(1,this.center.lat),Ce=[Y*ye.x,Y*ye.y,be*(ie?1:ve)],Fe=ee||S,ze=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Ue=this.isLODDisabled(!0)?h:0;let Ze;if(this._elevation&&l.isTerrainDEM)Ze=1e4*this._elevation.exaggeration();else if(this._elevation){const Ct=this._elevation.getMinMaxForVisibleTiles();Ze=Ct?Ct.max:this._centerAltitude}else Ze=this._centerAltitude;const Ke=l.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Xe=this.projection.isReprojectedInTileSpace?s.bP(this):1,Je=Ct=>{const Vt=new s.a5(Ct.x+25e-6,Ct.y,Ct.z),an=new s.a5(Ct.x,Ct.y+25e-6,Ct.z),un=Ct.toLngLat(),sn=Vt.toLngLat(),Pn=an.toLngLat(),Qn=this.locationCoordinate(un),ri=this.locationCoordinate(sn),jn=this.locationCoordinate(Pn),li=Math.hypot(ri.x-Qn.x,ri.y-Qn.y),On=Math.hypot(jn.x-Qn.x,jn.y-Qn.y);return Math.sqrt(li*On)*Xe/25e-6},ot=Ct=>{const on=Ze,Vt=Ke;return{aabb:s.bS(this,Y,0,0,0,Ct,Vt,on,this.projection),zoom:0,x:0,y:0,minZ:Vt,maxZ:on,wrap:Ct,fullyVisible:!1}},mt=[];let lt=[];const at=h,Nt=l.reparseOverscaled?y:h,qt=(be-this._centerAltitude)*ve,ln=Ct=>{if(!this._elevation||!Ct.tileID||!I)return;const on=this._elevation.getMinMaxForTile(Ct.tileID),Vt=Ct.aabb;on?(Vt.min[2]=on.min,Vt.max[2]=on.max,Vt.center[2]=(Vt.min[2]+Vt.max[2])/2):(Ct.shouldSplit=En(Ct),Ct.shouldSplit||(Vt.min[2]=Vt.max[2]=Vt.center[2]=this._centerAltitude))},_n=(Ct,on)=>{if(.707*on<Ct)return 1;const Vt=on/Ct;return Vt/(1.4144271570014144+(Math.pow(1.1,Vt-1.4144271570014144+1)-1)/(1.1-1)-1)},En=Ct=>{if(Ct.zoom<Ue)return!0;if(Ct.zoom===at)return!1;if(Ct.shouldSplit!=null)return Ct.shouldSplit;const on=Ct.aabb.distanceX(Ce),Vt=Ct.aabb.distanceY(Ce);let an=qt,un=1;if(ee){an=Ct.aabb.distanceZ(Ce);const On=Math.pow(2,Ct.zoom),xi=s.aN((Ct.y+1)/On),Oi=s.aN(Ct.y/On),sr=Math.min(Math.max($,xi),Oi),jr=s.c6(sr)/s.c6($);if(un=sr===$?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jr/this._mercatorScaleRatio),this.zoom<=s.c3&&Ct.zoom===at-1&&jr>=.9)return!0}else if(E&&(an=Ct.aabb.distanceZ(Ce)*ve),this.projection.isReprojectedInTileSpace&&y<=5){const On=Math.pow(2,Ct.zoom),xi=Je(new s.a5((Ct.x+.5)/On,(Ct.y+.5)/On));un=xi>.85?1:xi}if(!I){const On=Math.sqrt(on*on+Vt*Vt+an*an);let xi=(1<<at-Ct.zoom)*ze*un;return xi*=_n(Math.max(an,qt),On),On<xi}let sn=Number.MAX_VALUE,Pn=0;const Qn=Ct.aabb.getCorners(),ri=[];for(const On of Qn){s.a6.vec3.sub(ri,On,Ce),ee||(E?ri[2]*=ve:ri[2]=qt);const xi=s.a6.vec3.dot(ri,this._camera.forward());xi<sn&&(sn=xi,Pn=Math.abs(ri[2]))}let jn=(1<<at-Ct.zoom)*ze*un;if(jn*=_n(Math.max(Pn,qt),sn),sn<jn)return!0;const li=Ct.aabb.closestPoint(X);return li[0]===X[0]&&li[1]===X[1]};if(this.renderWorldCopies)for(let Ct=1;Ct<=3;Ct++)mt.push(ot(-Ct)),mt.push(ot(Ct));for(mt.push(ot(0));mt.length>0;){const Ct=mt.pop(),on=Ct.x,Vt=Ct.y;let an=Ct.fullyVisible;const un=()=>this.projection.name==="globe"&&(Ct.y===0||Ct.y===(1<<Ct.zoom)-1);if(!an){let sn=Fe?Ct.aabb.intersects(he):Ct.aabb.intersectsFlat(he);if(sn===0&&un()){const Pn=new s.bQ(Ct.zoom,on,Vt);sn=s.bR(this,Y,Pn,!0).intersects(he)}if(sn===0)continue;an=sn===2}if(Ct.zoom!==at&&En(Ct))for(let sn=0;sn<4;sn++){const Pn=(on<<1)+sn%2,Qn=(Vt<<1)+(sn>>1),ri={aabb:I?Ct.aabb.quadrant(sn):s.bS(this,Y,Ct.zoom+1,Pn,Qn,Ct.wrap,Ct.minZ,Ct.maxZ,this.projection),zoom:Ct.zoom+1,x:Pn,y:Qn,wrap:Ct.wrap,fullyVisible:an,tileID:void 0,shouldSplit:void 0,minZ:Ct.minZ,maxZ:Ct.maxZ};E&&!ee&&(ri.tileID=new s.aA(Ct.zoom+1===at?Nt:Ct.zoom+1,Ct.wrap,Ct.zoom+1,Pn,Qn),ln(ri)),mt.push(ri)}else{const sn=Ct.zoom===at?Nt:Ct.zoom;if(l.minzoom&&l.minzoom>sn)continue;let Pn=0;if(!an){let li=Fe?Ct.aabb.intersectsPrecise(he):Ct.aabb.intersectsPreciseFlat(he);if(li===0&&un()){const On=new s.bQ(Ct.zoom,on,Vt);li=s.bR(this,Y,On,!0).intersectsPrecise(he)}if(li===0)continue;if(l.calculateQuadrantVisibility)if(he.containsPoint(Ct.aabb.center))Pn=15;else for(let On=0;On<4;On++)Ct.aabb.quadrant(On).intersects(he)!==0&&(Pn|=1<<On)}const Qn=X[0]-(.5+on+(Ct.wrap<<Ct.zoom))*(1<<h-Ct.zoom),ri=X[1]-.5-Vt,jn=Ct.tileID?Ct.tileID:new s.aA(sn,Ct.wrap,Ct.zoom,on,Vt);l.calculateQuadrantVisibility&&(jn.visibleQuadrants=Pn),lt.push({tileID:jn,distanceSq:Qn*Qn+ri*ri})}}if(this.fogCullDistSq){const Ct=this.fogCullDistSq,on=this.horizonLineFromTop();lt=lt.filter(Vt=>{const an=[0,0,0,1],un=[s.ab,s.ab,0,1],sn=this.calculateFogTileMatrix(Vt.tileID.toUnwrapped());s.a6.vec4.transformMat4(an,an,sn),s.a6.vec4.transformMat4(un,un,sn);const Pn=s.a6.vec4.min([],an,un),Qn=s.a6.vec4.max([],an,un),ri=s.bT(Pn,Qn);if(ri===0)return!0;let jn=!1;const li=this._elevation;if(li&&ri>Ct&&on!==0){const On=this.calculateProjMatrix(Vt.tileID.toUnwrapped());let xi;l.isTerrainDEM||(xi=li.getMinMaxForTile(Vt.tileID)),xi||(xi={min:Ke,max:Ze});const Oi=s.c4(this.rotation),sr=[Oi[0]*s.ab,Oi[1]*s.ab,xi.max];s.a6.vec3.transformMat4(sr,sr,On),jn=(1-sr[1])*this.height*.5<on}return ri<Ct||jn})}return lt.sort((Ct,on)=>Ct.distanceSq-on.distanceSq).map(Ct=>Ct.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.ap(l.lat,-s.bU,s.bU),y=this.projection.project(l.lng,h);return new s.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,h){let y,S;const E=this.centerPoint;if(this.projection.name==="globe"){const G=this.worldSize;y=(h.x-E.x)/G,S=(h.y-E.y)/G}else{const G=this.pointCoordinate(h),$=this.pointCoordinate(E);y=G.x-$.x,S=G.y-$.y}const I=this.locationCoordinate(l);this.setLocation(new s.a5(I.x-y,I.y-S))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,h){const y=h?s.bE(h,l.lat):void 0,S=this.projection.project(l.lng,l.lat);return new s.a5(S.x,S.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,h){const y=h??this._centerAltitude,S=[l.x,l.y,0,1],E=[l.x,l.y,1,1];s.a6.vec4.transformMat4(S,S,this.pixelMatrixInverse),s.a6.vec4.transformMat4(E,E,this.pixelMatrixInverse);const I=E[3];s.a6.vec4.scale(S,S,1/S[3]),s.a6.vec4.scale(E,E,1/I);const G=S[2],$=E[2];return{p0:S,p1:E,t:G===$?0:(y-G)/($-G)}}screenPointToMercatorRay(l){const h=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return s.a6.vec4.transformMat4(h,h,this.pixelMatrixInverse),s.a6.vec4.transformMat4(y,y,this.pixelMatrixInverse),s.a6.vec4.scale(h,h,1/h[3]),s.a6.vec4.scale(y,y,1/y[3]),h[2]=s.bE(h[2],this._center.lat)*this.worldSize,y[2]=s.bE(y[2],this._center.lat)*this.worldSize,s.a6.vec4.scale(h,h,1/this.worldSize),s.a6.vec4.scale(y,y,1/this.worldSize),new s.aj([h[0],h[1],h[2]],s.a6.vec3.normalize([],s.a6.vec3.sub([],y,h)))}rayIntersectionCoordinate(l){const{p0:h,p1:y,t:S}=l,E=s.bE(h[2],this._center.lat),I=s.bE(y[2],this._center.lat);return new s.a5(s.aa(h[0],y[0],S)/this.worldSize,s.aa(h[1],y[1],S)/this.worldSize,s.aa(E,I,S))}pointCoordinate(l,h=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,h)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let h=this.projection.pointCoordinate3D(this,l.x,l.y);if(h)return new s.a5(h[0],h[1],h[2]);let y=0,S=this.horizonLineFromTop();if(l.y>S)return this.pointCoordinate(l);const E=.02*S,I=l.clone();for(let G=0;G<10&&S-y>E;G++){I.y=s.aa(y,S,.66);const $=this.projection.pointCoordinate3D(this,I.x,I.y);$?(S=I.y,h=$):y=I.y}return h?new s.a5(h[0],h[1],h[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.bV)return!this.isPointAboveHorizon(l);const h=this.pointCoordinate(l);return h.y>=0&&h.y<=1}_coordinatePoint(l,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,S=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return s.a6.vec4.transformMat4(S,S,this.pixelMatrix),S[3]>0?new s.P(S[0]/S[3],S[1]/S[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,E=this.pointLocation3D(new s.P(h,l)),I=this.pointLocation3D(new s.P(S,l)),G=this.pointLocation3D(new s.P(S,y)),$=this.pointLocation3D(new s.P(h,y));let Y=Math.min(E.lng,I.lng,G.lng,$.lng),X=Math.max(E.lng,I.lng,G.lng,$.lng),ee=Math.min(E.lat,I.lat,G.lat,$.lat),ie=Math.max(E.lat,I.lat,G.lat,$.lat);const he=Math.pow(2,-this.zoom)/16*270,ye=this.projection.name==="globe"?1:4,ve=(be,Ce,Fe,ze,Ue)=>{const Ze=(be+Fe)/2,Ke=(Ce+ze)/2,Xe=new s.P(Ze,Ke),{lng:Je,lat:ot}=this.pointLocation3D(Xe),mt=Math.max(0,Y-Je,ee-ot,Je-X,ot-ie);Y=Math.min(Y,Je),X=Math.max(X,Je),ee=Math.min(ee,ot),ie=Math.max(ie,ot),(Ue<ye||mt>he)&&(ve(be,Ce,Ze,Ke,Ue+1),ve(Ze,Ke,Fe,ze,Ue+1))};if(ve(h,l,S,l,1),ve(S,l,S,y,1),ve(S,y,h,y,1),ve(h,y,h,l,1),this.projection.name==="globe"){const[be,Ce]=s.bW(this);be?(ie=90,X=180,Y=-180):Ce&&(ee=-90,X=180,Y=-180)}return new s.as(new s.bL(Y,ee),new s.bL(X,ie))}_getBoundsRectangular(l,h){const{top:y,left:S}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,G=new s.P(S,y),$=new s.P(I,y),Y=new s.P(I,E),X=new s.P(S,E);let ee=this.pointCoordinate(G,l),ie=this.pointCoordinate($,l);const he=this.pointCoordinate(Y,h),ye=this.pointCoordinate(X,h),ve=(be,Ce)=>(Ce.y-be.y)/(Ce.x-be.x);return ee.y>1&&ie.y>=0?ee=new s.a5((1-ye.y)/ve(ye,ee)+ye.x,1):ee.y<0&&ie.y<=1&&(ee=new s.a5(-ye.y/ve(ye,ee)+ye.x,0)),ie.y>1&&ee.y>=0?ie=new s.a5((1-he.y)/ve(he,ie)+he.x,1):ie.y<0&&ee.y<=1&&(ie=new s.a5(-he.y/ve(he,ie)+he.x,0)),new s.as().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(ye)).extend(this.coordinateLocation(he))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=l.visibleDemTiles.reduce((y,S)=>{if(S.dem){const E=S.dem.tree;y.min=Math.min(y.min,E.minimums[0]),y.max=Math.max(y.max,E.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*l.exaggeration(),h.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.bU,this.maxLat=s.bU,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.am(this.minLng)*this.tileSize,this.worldMaxX=s.am(this.maxLng)*this.tileSize,this.worldMinY=s.at(this.maxLat)*this.tileSize,this.worldMaxY=s.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,h){return this.projection.createTileMatrix(this,h,l)}calculateDistanceTileData(l){const h=l.key,y=this._distanceTileDataCache;if(y[h])return y[h];const S=l.canonical,E=1/this.height,I=this.cameraWorldSize,G=I/this.zoomScale(S.z),$=(S.x+Math.pow(2,S.z)*l.wrap)*G,Y=S.y*G,X=this.point;X.x*=I/this.worldSize,X.y*=I/this.worldSize;const ee=this.angle,ie=Math.sin(-ee),he=-Math.cos(-ee);return y[h]={bearing:[ie,he],center:[(X.x-$)*E,(X.y-Y)*E],scale:G/s.ab*E},y[h]}calculateFogTileMatrix(l){const h=l.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.a6.mat4.multiply(S,this.worldToFogMatrix,S),y[h]=new Float32Array(S),y[h]}calculateProjMatrix(l,h=!1,y=!1){const S=l.key;let E;if(E=y?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,E[S])return E[S];const I=this.calculatePosMatrix(l,this.worldSize);let G;return G=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,s.a6.mat4.multiply(I,G,I),E[S]=new Float32Array(I),E[S]}calculatePixelsToTileUnitsMatrix(l){const h=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const S=s.bX(l,this);return y[h]=S,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,h=s.a6.mat4.fromScaling([],[l,l,l]);return s.a6.mat4.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const h=s.bE(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),S=this._camera.forward(),E=s.bE(1,this._center.lat);y[2]/=E,S[2]/=E,s.a6.vec3.normalize(S,S);const I=l.raycast(y,S,l.exaggeration());if(I){const G=s.a6.vec3.scaleAndAdd([],y,S,I),$=new s.a5(G[0],G[1],s.bE(G[2],s.aN(G[1]))),Y=($.z+s.a6.vec3.length([$.x-y[0],$.y-y[1],$.z-y[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Y),this._centerAltitude=$.toAltitude(),this._center=this.coordinateLocation($),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const h=this._elevation,y=s.bE(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(y),E=h.getAtPointOrZero(new s.a5(...S)),I=this.pixelsPerMeter/this.worldSize*E,G=this._minimumHeightOverTerrain(),$=S[2]-I;if($<=G)if($<0||l){const Y=this.locationCoordinate(this._center,this._centerAltitude),X=[S[0],S[1],Y.z-S[2]],ee=s.a6.vec3.length(X);X[2]-=(G-$)/this._pixelsPerMercatorPixel;const ie=s.a6.vec3.length(X);if(ie===0)return;s.a6.vec3.scale(X,X,ee/ie*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],Y.z*this._pixelsPerMercatorPixel-X[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const ie=this.center;return ie.lat=s.ap(ie.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(ie.lng=s.ap(ie.lng,this.minLng,this.maxLng)),this.center=ie,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:S}=this.point;let E=0,I=y,G=S;const $=this.width/2,Y=this.height/2,X=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(S-Y<X&&(G=X+Y),S+Y>ee&&(G=ee-Y),ee-X<this.height&&(E=Math.max(E,this.height/(ee-X)),G=(ee+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ie=this.worldMinX*this.scale,he=this.worldMaxX*this.scale,ye=this.worldSize/2-(ie+he)/2;I=(y+ye+this.worldSize)%this.worldSize-ye,I-$<ie&&(I=ie+$),I+$>he&&(I=he-$),he-ie<this.width&&(E=Math.max(E,this.width/(he-ie)),I=(he+ie)/2)}I===y&&G===S||(this.center=this.unproject(new s.P(I,G))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bE(1,this.center.lat)/s.bE(1,s.c5));const S=s.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,S),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this.projection.zAxisUnit==="meters"?y:1,I=this._camera.getWorldToCamera(this.worldSize,E);let G;const $=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if($[8]=2*-l.x/this.width,$[9]=2*l.y/this.height,this.isOrthographic){let ot=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),mt=ot*this.aspect,lt=-mt,at=-ot;mt-=l.x,lt-=l.x,ot+=l.y,at+=l.y,G=this._camera.getCameraToClipOrthographic(lt,mt,at,ot,this._nearZ,this._farZ),((Nt,qt,ln,_n)=>{for(let En=0;En<16;En++)Nt[En]=dc(qt[En],ln[En],_n)})(G,G,$,ha(this.pitch>=15?1:this.pitch/15))}else G=$;const Y=s.a6.mat4.mul([],$,I);let X=s.a6.mat4.mul([],G,I);if(this.projection.isReprojectedInTileSpace){const ot=this.locationCoordinate(this.center),mt=s.a6.mat4.identity([]);s.a6.mat4.translate(mt,mt,[ot.x*this.worldSize,ot.y*this.worldSize,0]),s.a6.mat4.multiply(mt,mt,s.bZ(this)),s.a6.mat4.translate(mt,mt,[-ot.x*this.worldSize,-ot.y*this.worldSize,0]),s.a6.mat4.multiply(X,X,mt),s.a6.mat4.multiply(Y,Y,mt),this.inverseAdjustmentMatrix=s.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.mat4.scale([],X,[this.worldSize,this.worldSize,this.worldSize/E,1]),this.projMatrix=X,this.invProjMatrix=s.a6.mat4.invert(new Float64Array(16),this.projMatrix),h){const ot=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ot[8]=2*-l.x/this.width,ot[9]=2*l.y/this.height,this.expandedFarZProjMatrix=s.a6.mat4.mul([],ot,I)}else this.expandedFarZProjMatrix=this.projMatrix;const ee=s.a6.mat4.invert([],G);this.frustumCorners=s.b$.fromInvProjectionMatrix(ee,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const ie=new Float32Array(16);s.a6.mat4.identity(ie),s.a6.mat4.scale(ie,ie,[1,-1,1]),s.a6.mat4.rotateX(ie,ie,this._pitch),s.a6.mat4.rotateZ(ie,ie,this.angle);const he=s.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.mat4.clone(he);const ye=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;he[8]=2*-l.x/this.width,he[9]=2*(l.y+ye)/this.height,this.skyboxMatrix=s.a6.mat4.multiply(ie,he,ie);const ve=this.point,be=ve.x,Ce=ve.y,Fe=this.width%2/2,ze=this.height%2/2,Ue=Math.cos(this.angle),Ze=Math.sin(this.angle),Ke=be-Math.round(be)+Ue*Fe+Ze*ze,Xe=Ce-Math.round(Ce)+Ue*ze+Ze*Fe,Je=new Float64Array(X);if(s.a6.mat4.translate(Je,Je,[Ke>.5?Ke-1:Ke,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Je,X=s.a6.mat4.create(),s.a6.mat4.scale(X,X,[this.width/2,-this.height/2,1]),s.a6.mat4.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=s.a6.mat4.create(),s.a6.mat4.scale(X,X,[1,-1,1]),s.a6.mat4.translate(X,X,[-1,-1,0]),s.a6.mat4.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=s.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,Y),this._calcFogMatrices(),this._distanceTileDataCache={},X=s.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!X)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=X,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c0(this);const ot=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.a6.vec3.transformMat4(ot,ot,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=X;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,E=[l,l,h];s.a6.vec3.scale(E,E,S),s.a6.vec3.scale(y,y,-1),s.a6.vec3.multiply(y,y,E);const I=s.a6.mat4.create();s.a6.mat4.translate(I,I,y),s.a6.mat4.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,h,S)}_computeCameraPosition(l){const h=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),S=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-l/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-y[0]*E,S.y/this.worldSize-y[1]*E,l/this.worldSize*this._centerAltitude-y[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],S=l[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(E=Math.min((h-y)/S,1)),this._camera.position=s.a6.vec3.scaleAndAdd([],this._camera.position,l,E),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:S}=this._camera.getPitchBearing(),E=s.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bC(this._maxPitch)),G=Math.max((l[2]-E)/Math.cos(y),I),$=this._zoomFromMercatorZ(G);s.a6.vec3.scaleAndAdd(l,l,h,G),this._pitch=s.ap(y,s.bC(this.minPitch),s.bC(this.maxPitch)),this.angle=s.bB(S,-Math.PI,Math.PI),this._setZoom(s.ap($,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.a5(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let h=0,y=s.bV,S=0,E=1/0;for(;y-h>1e-6&&y>h;){const I=h+.5*(y-h),G=this.tileSize*Math.pow(2,I),$=this.getCameraToCenterDistance(this.projection,I,G),Y=this.scaleZoom($/(l*this.tileSize)),X=Math.abs(I-Y);X<E&&(E=X,S=I),I<Y?h=I:y=I}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,h){const y=Math.min(l.x,h.x),S=Math.max(l.x,h.x),E=Math.min(l.y,h.y),I=Math.max(l.y,h.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const G=[new s.P(y,E),new s.P(S,I),new s.P(y,I),new s.P(S,E)],$=this.renderWorldCopies?-3:0,Y=this.renderWorldCopies?4:1;for(const X of G){const ee=this.pointRayIntersection(X);if(ee.t<0)return!0;const ie=this.rayIntersectionCoordinate(ee);if(ie.x<$||ie.y<0||ie.x>Y||ie.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(l,h){const y=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,l)),S=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([h,y,S],E){const I=[h,y,S,1];s.a6.vec4.transformMat4(I,I,E);const G=I[3]=Math.max(I[3],1e-6);return I[0]/=G,I[1]/=G,I[2]/=G,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}}getCameraToCenterDistance(l,h=this.zoom,y=this.worldSize){const S=s.bY(l,h,this.width,this.height,1024),E=l.pixelSpaceConversion(this.center.lat,y,S);let I=.5/Math.tan(.5*this._fov)*this.height*E;return this.isOrthographic&&(I=dc(1,I,ha(this.pitch>=15?1:this.pitch/15))),I}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.mat4.multiply(l,l,this.globeMatrix),l}getFrustum(l){return s.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const fc=(g,l)=>{if(l>0&&g.terrain&&s.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,y=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),S=h.isLODDisabled(!1)?s.a7(60,45,h.pitch):s.a7(30,15,h.pitch),E=h._farZ-h._nearZ,I=l*h.height,G=((1-($=S))*h.cameraToCenterDistance+$*(h._farZ+I))*y;var $;return{shouldRenderCutoff:S<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(G-h._nearZ)/E,(G-I-h._nearZ)/E]}}},ms={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Uf{constructor(l,h){this.aabb=l,this.lastCascade=h}}class Mn{add(l,h){const y=this.receivers[l.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],h.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],h.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],h.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],h.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],h.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],h.max[2])):this.receivers[l.key]=new Uf(h,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,h,y){const S=s.ca.fromPoints(l.points);let E=0;for(const I in this.receivers){const G=this.receivers[I];if(!G||!S.intersectsAabb(G.aabb))continue;G.aabb.min=S.closestPoint(G.aabb.min),G.aabb.max=S.closestPoint(G.aabb.max);const $=G.aabb.getCorners();for(let Y=0;Y<y.length;Y++){let X=!0;for(const ee of $){const ie=[ee[0]*h,ee[1]*h,ee[2]];if(s.a6.vec3.transformMat4(ie,ie,y[Y].matrix),ie[0]<-1||ie[0]>1||ie[1]<-1||ie[1]>1){X=!1;break}}if(G.lastCascade=Y,E=Math.max(E,Y),X)break}}return E+1}}class bd{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Mn,this._depthMode=new ii(l.context.gl.LEQUAL,ii.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(ms,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(ms,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(ms,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,h){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const S=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||S<=0||(this._shadowLayerCount=y.style.order.reduce((ye,ve)=>{const be=y.style._mergedLayers[ve];return ye+(be.hasShadowPass()&&!be.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const E=y.context,I=ms.shadowMapResolution,G=ms.shadowMapResolution;if(this._cascades.length===0||ms.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ye=0;ye<ms.cascadeCount;++ye){const ve=y._shadowMapDebug,be=E.gl,Ce=E.createFramebuffer(I,G,ve,"texture"),Fe=new s.T(E,{width:I,height:G,data:null},be.DEPTH_COMPONENT16);if(Ce.depthAttachment.set(Fe.texture),ve){const ze=new s.T(E,{width:I,height:G,data:null},be.RGBA8);Ce.colorAttachment.set(ze.texture)}this._cascades.push({framebuffer:Ce,texture:Fe,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bO,scale:0})}}this.shadowDirection=Ed(h);let $=0;if(l.elevation){const ye=l.elevation,ve=[1e4,-1e4];ye.visibleDemTiles.filter(be=>be.dem).forEach(be=>{const Ce=be.dem.tree;ve[0]=Math.min(ve[0],Ce.minimums[0]),ve[1]=Math.max(ve[1],Ce.maximums[0])}),ve[0]!==1e4&&($=(ve[1]-ve[0])*ye.exaggeration())}const Y=1.5*l.cameraToCenterDistance,X=3*Y,ee=new Float64Array(16);for(let ye=0;ye<this._cascades.length;++ye){const ve=this._cascades[ye];let be=l.height/50,Ce=1;ms.cascadeCount===1?Ce=X:ye===0?Ce=Y:(be=Y,Ce=X);const[Fe,ze]=gh(l,this.shadowDirection,be,Ce,ms.shadowMapResolution,$);ve.scale=l.scale,ve.matrix=Fe,ve.boundingSphereRadius=ze,s.a6.mat4.invert(ee,ve.matrix),ve.frustum=s.bO.fromInvProjectionMatrix(ee,1,0,!0),ve.far=Ce}const ie=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ie].far,this._cascades[ie].far],this._uniformValues.u_shadow_intensity=S,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ms.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ms.shadowMapResolution,this._uniformValues.u_shadowmap_0=ps.ShadowMap0,this._uniformValues.u_shadowmap_1=ps.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const he=y.transform.elevation;for(const ye of this._groundShadowTiles){let ve={min:0,max:0};if(he){const be=he.getMinMaxForTile(ye);be&&(ve=be)}this.addShadowReceiver(ye.toUnwrapped(),ve.min,ve.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,h){if(!this.enabled)return;const y=this.painter,S=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),S.viewport.set([0,0,ms.shadowMapResolution,ms.shadowMapResolution]);for(let E=0;E<this._numCascadesToRender;++E){y.currentShadowCascade=E,S.bindFramebuffer.set(this._cascades[E].framebuffer.framebuffer),S.clear({color:s.bA.white,depth:1});for(const I of l.order){const G=l._mergedLayers[I];if(!G.hasShadowPass()||G.isHidden(y.transform.zoom))continue;const $=l.getLayerSourceCache(G),Y=$?h[$.id]:void 0;(G.type==="model"||Y&&Y.length)&&y.renderLayer(y,$,G,Y)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,h=l.style,y=l.context,S=h.directionalLight,E=h.ambientLight;if(!S||!E)return;const I=[],G=fc(l,l.longestCutoffRange);G.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const $=Ru(h,S,E),Y=new ii(y.gl.LEQUAL,ii.ReadOnly,l.depthRangeFor3D);for(const X of this._groundShadowTiles){const ee=X.toUnwrapped(),ie=l.isTileAffectedByFog(X),he=l.getOrCreateProgram("groundShadow",{defines:I,overrideFog:ie});this.setupShadows(ee,he),l.uploadCommonUniforms(y,he,ee,null,G);const ye={u_matrix:l.transform.calculateProjMatrix(ee),u_ground_shadow_factor:$};he.draw(l,y.gl.TRIANGLES,Y,_i.disabled,Vi.multiply,yi.disabled,ye,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Vi.unblended:Vi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const h=this.painter.transform,y=h.calculatePosMatrix(l,h.worldSize);return s.a6.mat4.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return s.a6.mat4.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,h,y,S=0){if(!this.enabled)return;const E=this.painter.transform,I=this.painter.context,G=I.gl,$=this._uniformValues,Y=new Float64Array(16),X=E.calculatePosMatrix(l,E.worldSize);for(let ee=0;ee<this._cascades.length;ee++)s.a6.mat4.multiply(Y,this._cascades[ee].matrix,X),$[ee===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(Y),I.activeTexture.set(G.TEXTURE0+ps.ShadowMap0+ee),this._cascades[ee].texture.bind(G.NEAREST,G.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const ee=s.c9(l.canonical),ie=2/E.tileSize*s.ab/ms.shadowMapResolution,he=ie*this._cascades[0].boundingSphereRadius,ye=ie*this._cascades[this._cascades.length-1].boundingSphereRadius,ve=(y==="vector-tile"?1:3)/Math.pow(2,S-l.canonical.z-(1-E.zoom+Math.floor(E.zoom)));$.u_shadow_normal_offset=[ee,he*ve,ye*ve],$.u_shadow_bias=[6e-5,.0012,.012]}else $.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(I,$)}setupShadowsFromMatrix(l,h,y=!1){if(!this.enabled)return;const S=this.painter.context,E=S.gl,I=this._uniformValues,G=new Float64Array(16);for(let $=0;$<ms.cascadeCount;$++)s.a6.mat4.multiply(G,this._cascades[$].matrix,l),I[$===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(G),S.activeTexture.set(E.TEXTURE0+ps.ShadowMap0+$),this._cascades[$].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const $=ms.normalOffset;I.u_shadow_normal_offset=[1,$,$],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,I)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,h,y,S){if(S[2]>=0)return{};const E=function($,Y,X){const ee=X/(1<<$.canonical.z);return new s.ca([$.canonical.x*ee+$.wrap*X,$.canonical.y*ee+$.wrap*X,0],[($.canonical.x+1)*ee+$.wrap*X,($.canonical.y+1)*ee+$.wrap*X,Y])}(l,h,y).getCorners(),I=h/-S[2];S[0]<0?(s.a6.vec3.add(E[0],E[0],[S[0]*I,0,0]),s.a6.vec3.add(E[3],E[3],[S[0]*I,0,0])):S[0]>0&&(s.a6.vec3.add(E[1],E[1],[S[0]*I,0,0]),s.a6.vec3.add(E[2],E[2],[S[0]*I,0,0])),S[1]<0?(s.a6.vec3.add(E[0],E[0],[0,S[1]*I,0]),s.a6.vec3.add(E[1],E[1],[0,S[1]*I,0])):S[1]>0&&(s.a6.vec3.add(E[2],E[2],[0,S[1]*I,0]),s.a6.vec3.add(E[3],E[3],[0,S[1]*I,0]));const G={};return G.vertices=E,G.planes=[Dl(E[1],E[0],E[4]),Dl(E[2],E[1],E[5]),Dl(E[3],E[2],E[6]),Dl(E[0],E[3],E[7])],G}addShadowReceiver(l,h,y){this._receivers.add(l,s.ca.fromTileIdAndHeight(l,h,y))}getMaxCascadeForTile(l){const h=this._receivers.get(l);return h&&h.lastCascade?h.lastCascade:0}}function Dl(g,l,h){const y=s.a6.vec3.sub([],h,l),S=s.a6.vec3.sub([],g,l),E=s.a6.vec3.cross([],y,S),I=s.a6.vec3.length(E);return I===0?[0,0,1,0]:(s.a6.vec3.scale(E,E,1/I),[E[0],E[1],E[2],-s.a6.vec3.dot(E,l)])}function Ed(g){const l=g.properties.get("direction"),h=s.c8(l.x,l.y,l.z);h[2]=s.ap(h[2],0,75);const y=s.cb([h[0],h[1],h[2]]);return s.a6.vec3.fromValues(y.x,y.y,y.z)}function Ru(g,l,h){const y=l.properties.get("color"),S=l.properties.get("intensity"),E=l.properties.get("direction"),I=[E.x,E.y,E.z],G=h.properties.get("color"),$=h.properties.get("intensity"),Y=Math.max(s.a6.vec3.dot([0,0,1],I),0),X=[0,0,0];s.a6.vec3.scale(X,G.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),$);const ee=[0,0,0];return s.a6.vec3.scale(ee,y.toRenderColor(g.getLut(h.scope)).toArray01Linear().slice(0,3),Y*S),s.cc([X[0]>0?X[0]/(X[0]+ee[0]):0,X[1]>0?X[1]/(X[1]+ee[1]):0,X[2]>0?X[2]/(X[2]+ee[2]):0])}function gh(g,l,h,y,S,E){const I=g.zoom,G=g.scale,$=g.worldSize,Y=1/$,X=g.aspect,ee=Math.sqrt(1+X*X)*Math.tan(.5*g.fovX),ie=ee*ee,he=y-h,ye=y+h;let ve,be;ie>he/ye?(ve=y,be=y*ee):(ve=.5*ye*(1+ie),be=.5*Math.sqrt(he*he+2*(y*y+h*h)*ie+ye*ye*ie*ie));const Ce=g.projection.pixelsPerMeter(g.center.lat,$),Fe=g._camera.getCameraToWorldMercator(),ze=[0,0,-ve*Y];s.a6.vec3.transformMat4(ze,ze,Fe);let Ue=be*Y;const Ze=g._edgeInsets;if(!(Ze.left===0&&Ze.top===0&&Ze.right===0&&Ze.bottom===0||Ze.left===Ze.right&&Ze.top===Ze.bottom)){const an=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?Ce:1),un=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,y);un[8]=2*-g.centerOffset.x/g.width,un[9]=2*g.centerOffset.y/g.height;const sn=new Float64Array(16);s.a6.mat4.mul(sn,un,an);const Pn=new Float64Array(16);s.a6.mat4.invert(Pn,sn);const Qn=s.bO.fromInvProjectionMatrix(Pn,$,I,!0);for(const ri of Qn.points){const jn=((Ke=ri)[0]/=G,Ke[1]/=G,Ke[2]=s.bE(Ke[2],g._center.lat),Ke);Ue=Math.max(Ue,s.a6.vec3.len(s.a6.vec3.subtract([],ze,jn)))}}var Ke;Ue*=S/(S-1);const Xe=Math.acos(l[2]),Je=Math.atan2(-l[0],-l[1]),ot=new Co;ot.position=ze,ot.setPitchBearing(Xe,Je);const mt=ot.getWorldToCamera($,Ce),lt=Ue*$,at=Math.min(g._mercatorZfromZoom(17)*$*-2,-2*lt),Nt=ot.getCameraToClipOrthographic(-lt,lt,-lt,lt,at,(lt+E*Ce)/l[2]),qt=new Float64Array(16);s.a6.mat4.multiply(qt,Nt,mt);const ln=s.a6.vec3.fromValues(Math.floor(1e6*ze[0])/1e6*$,Math.floor(1e6*ze[1])/1e6*$,0),_n=.5*S,En=[0,0,0];s.a6.vec3.transformMat4(En,ln,qt),s.a6.vec3.scale(En,En,_n);const Ct=[Math.floor(En[0]),Math.floor(En[1]),Math.floor(En[2])],on=[0,0,0];s.a6.vec3.sub(on,En,Ct),s.a6.vec3.scale(on,on,-1/_n);const Vt=new Float64Array(16);return s.a6.mat4.identity(Vt),s.a6.mat4.translate(Vt,Vt,on),s.a6.mat4.multiply(qt,Vt,qt),[qt,lt]}class pc extends s.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,h){return s.aG(this.requestManager.transformRequest(h,s.R.Model).url).then(y=>{if(!y)return;const S=s.aH(y),E=new s.aI(l,void 0,void 0,S);return E.computeBoundsAndApplyParent(),E}).catch(y=>{if(y&&y.status===404)return null;this.fire(new s.t(new Error(`Could not load model ${l} from ${h}: ${y.message}`)))})}load(l,h){this.models[h]||(this.models[h]={});const y=Object.keys(l);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+y.length;const S=[];for(const E of y)S.push(this.loadModel(E,l[E]));Promise.allSettled(S).then(E=>{for(let I=0;I<E.length;I++){const{status:G,value:$}=E[I];G==="fulfilled"&&$&&(this.models[h][y[I]]={model:$,numReferences:1})}this.numModelsLoading[h]-=y.length,this.fire(new s.x("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.t(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,h){return!!this.getModel(l,h)}getModel(l,h){return this.models[h]||(this.models[h]={}),this.models[h][l]?this.models[h][l].model:void 0}addModel(l,h,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(h)},y)}addModels(l,h){this.models[h]||(this.models[h]={});const y={};for(const S in l)this.models[h][S]={},y[S]=this.requestManager.normalizeModelURL(l[S]);this.load(y,h)}addModelsFromBucket(l,h){this.models[h]||(this.models[h]={});const y={};for(const S of l)this.hasModel(S,h)?this.models[h][S].numReferences++:y[S]=this.requestManager.normalizeModelURL(S);this.load(y,h)}removeModel(l,h){if(this.models[h]&&this.models[h][l]&&(this.models[h][l].numReferences--,this.models[h][l].numReferences===0)){const y=this.models[h][l].model;delete this.models[h][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,h){this.models[h]||(this.models[h]={});for(const y in this.models[h])this.models[h][y].model&&this.models[h][y].model.upload(l.context)}}const _m=new s.a0({data:new s.a1(s._.colorTheme.data)}),Uo=(g,l)=>wt(g,l&&l.filter(h=>h.identifier!=="source.canvas")),Vf=s.ar(cr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),mc=s.ar(cr,["setCenter","setZoom","setBearing","setPitch"]),Za={version:8,layers:[],sources:{}},Md={duration:300,delay:0};class Vo extends s.E{constructor(l,h={}){super(),this.map=l,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=s.l({},Md),this._buildingIndex=new Tv(this),this.crossTileSymbolIndex=new qc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Dt,this.dispatcher=h.dispatcher?h.dispatcher:new s.ce(s.cf(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new At,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new s.cg(l._requestManager,h.localFontFamily?s.ch.all:h.localIdeographFontFamily?s.ch.ideographs:s.ch.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new pc(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",s.ci());const y=this;this._rtlTextPluginCallback=Vo.registerForPluginStateChange(S=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(E,I)=>{if(s.cj(E),I&&I.every(G=>G))for(const G in y._sourceCaches){const $=y._sourceCaches[G],Y=$.getSource().type;Y!=="vector"&&Y!=="geojson"||$.reload()}})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const E=this.getOwnSource(S.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const G=this._layers[I];G.source===E.id&&this._validateLayer(G)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(s.f(l))return l;const h=s.ck(l);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${s.cl(JSON.stringify(l))}`}_diffStyle(l,h,y){this.globalId=this._getGlobalId(l);const S=(E,I)=>{try{I(null,this.setState(E,y))}catch(G){I(G,!1)}};if(typeof l=="string"){const E=this.map._requestManager.normalizeStyleURL(l),I=this.map._requestManager.transformRequest(E,s.R.Style);s.n(I,(G,$)=>{G?this.fire(new s.t(G)):$&&S($,h)})}else typeof l=="object"&&S(l,h)}loadURL(l,h={}){this.fire(new s.x("dataloading",{dataType:"style"}));const y=typeof h.validate=="boolean"?h.validate:!s.f(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,h.accessToken),this.resolvedImports.add(l);const S=this.importsCache.get(l);if(S)return this._load(S,y);const E=this.map._requestManager.transformRequest(l,s.R.Style);this._request=s.n(E,(I,G)=>{if(this._request=null,I)this.fire(new s.t(I));else if(G)return this.importsCache.set(l,G),this._load(G,y)})}loadJSON(l,h={}){this.fire(new s.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=s.q.frame(()=>{this._request=null,this._load(l,h.validate!==!1)})}loadEmpty(){this.fire(new s.x("dataloading",{dataType:"style"})),this._load(Za,!1)}_loadImports(l,h,y){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const S=[];for(const E of l){const I=this._createFragmentStyle(E),G=new Promise(X=>{I.once("style.import.load",X),I.once("error",X)}).then(()=>this.mergeAll());if(S.push(G),this.resolvedImports.has(E.url)){I.loadEmpty();continue}const $=E.data||this.importsCache.get(E.url);$?(I.loadJSON($,{validate:h}),this._isInternalStyle($)&&(I.globalId=null)):E.url?I.loadURL(E.url,{validate:h}):I.loadEmpty();const Y={style:I,id:E.id,config:E.config};if(y){const X=this.fragments.findIndex(({id:ee})=>ee===y);this.fragments=this.fragments.slice(0,X).concat(Y).concat(this.fragments.slice(X))}else this.fragments.push(Y)}return Promise.allSettled(S)}getImportGlobalIds(l=this,h=new Set){for(const y of l.fragments)y.style.globalId&&h.add(y.style.globalId),this.getImportGlobalIds(y.style,h);return[...h.values()]}_createFragmentStyle(l){const h=this.scope?s.av(l.id,this.scope):l.id;let y;const S=this._initialConfig&&this._initialConfig[h];(l.config||S)&&(y=s.l({},l.config,S));const E=new Vo(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return E.setEventedParent(this.map,{style:E}),E}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,h){const y=l.schema;if(this._isInternalStyle(l)){const I=s.l({},Za,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(I,h)}if(this.updateConfig(this._config,y),h&&Uo(this,vn(l)))return;this._loaded=!0,this.stylesheet=s.cm(l);const S=()=>{for(const Y in l.sources)this.addSource(Y,l.sources[Y],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const I=Df(this.stylesheet.layers);if(this._order=I.map(Y=>Y.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const Y=this.stylesheet.lights[0];this.light=new St(Y.properties,Y.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new St(this.stylesheet.light)),this._layers={};for(const Y of I){const X=s.cq(Y,this.scope,this._styleColorTheme.lut,this.options);X.configDependencies.size!==0&&this._configDependentLayers.add(X.fqid),X.setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X;const ee=this.getOwnLayerSourceCache(X),ie=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ee&&X.canCastShadows()&&ie&&(ee.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const G=this.stylesheet.terrain;G&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(G,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.x("data",{dataType:"style"}));const $=this.isRootStyle();l.imports?this._loadImports(l.imports,h).then(()=>{this._reloadImports(),this.fire(new s.x($?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.x($?"style.load":"style.import.load")))},E=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=E,E){const I=this._evaluateColorThemeData(E);this._loadColorTheme(I).then(()=>{S()}).catch(G=>{s.w(`Couldn't load color theme from the stylesheet: ${G}`),S()})}else this._styleColorTheme.lut=null,S()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,h,y,S,E,I,G,$;const Y={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(X=>{if(X.stylesheet){if(X.light!=null&&(l=X.light),X.stylesheet.lights)for(const ee of X.stylesheet.lights)ee.type==="ambient"&&X.ambientLight!=null&&(h=X.ambientLight),ee.type==="directional"&&X.directionalLight!=null&&(y=X.directionalLight);S=this._prioritizeTerrain(S,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(E=X.fog),X.stylesheet.camera!=null&&($=X.stylesheet.camera),X.stylesheet.projection!=null&&(I=X.stylesheet.projection),X.stylesheet.transition!=null&&(G=X.stylesheet.transition),Y[X.scope]=X._styleColorTheme}}),this.light=l,this.ambientLight=h,this.directionalLight=y,this.fog=E,this._styleColorThemeForScope=Y,S===null?delete this.terrain:this.terrain=S,this.camera=$||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=s.l({},Md,G),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const h=y=>{for(const S of y.fragments)h(S.style);l(y)};h(this)}_prioritizeTerrain(l,h,y){const S=l&&l.drapeRenderMode===0;return y===null?h&&h.drapeRenderMode===0?h:S?l:null:h!=null&&(!l||S||h&&h.drapeRenderMode===1)?h:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{l=this._prioritizeTerrain(l,h.terrain,h.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(l=h.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},h={},y={};this.forEachFragmentStyle(S=>{for(const E in S._sourceCaches){const I=s.av(E,S.scope);l[I]=S._sourceCaches[E]}for(const E in S._otherSourceCaches){const I=s.av(E,S.scope);h[I]=S._otherSourceCaches[E]}for(const E in S._symbolSourceCaches){const I=s.av(E,S.scope);y[I]=S._symbolSourceCaches[E]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},h=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(E=>{for(const G of E._order){const $=E._layers[G];if($.type==="slot"){const Y=s.cn(G);if(l[Y])continue;l[Y]=[]}$.slot&&l[$.slot]?l[$.slot].push($):h.push($)}const{featuresets:I}=E.stylesheet||{};if(I)for(const G in I){const{selectors:$}=I[G];for(const Y of $){const X=E._layers[Y.layer],ee=this._mergedLayerSelectors.get(X.fqid)||[];let ie;if(Y.properties)for(const he in Y.properties){const ye=s.M(Y.properties[he]);ye.result==="success"&&(ie=ie||{},ie[he]=ye.value)}ee.push({featuresetId:G,featureNamespace:Y.featureNamespace,properties:ie}),this._mergedLayerSelectors.set(X.fqid,ee)}}}),this._mergedOrder=[];const S=(E=[])=>{for(const I of E)if(I.type==="slot"){const G=s.cn(I.id);l[G]&&S(l[G]),this._mergedSlots.push(G)}else{const G=s.av(I.id,I.scope);this._mergedOrder.push(G),y[G]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};S(h),this._mergedOrder.sort((E,I)=>{const G=y[E],$=y[I];return G.hasInitialOcclusionOpacityProperties?$.is3D()?1:0:G.is3D()&&$.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=s.l({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(h,y,S){const E=s.l({},y);for(const G of Object.keys(s._.colorTheme))E[G]===void 0&&(E[G]=s._.colorTheme[G].default);const I=new s.$(_m,h,new Map(S));return I.setTransitionOrValue(E,S),I.untransitioned().possiblyEvaluate(new s.a3(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,S)=>{const E="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let I=l;I.startsWith(E)||(I=E+I);const G="mapbox-reserved-lut",$=new Image;$.src=I,$.onerror=()=>{this._styleColorTheme.lutLoading=!1,S(new Error("Failed to load image data"))},$.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void y();this._styleColorTheme.lutLoading=!1;const{width:Y,height:X,data:ee}=s.q.getImageData($);if(X>32)return void S(new Error("The height of the image must be less than or equal to 32 pixels."));if(Y!==X*X)return void S(new Error("The width of the image must be equal to the height squared."));this.getImage(G)&&this.removeImage(G),this.addImage(G,{data:new s.r({width:Y,height:X},ee),pixelRatio:1,sdf:!1,version:0});const ie=this.imageManager.getImage(G,this.scope);ie?(this._styleColorTheme.lut={image:ie.data,data:l},y()):S(new Error("Missing LUT image."))}})}getLut(l){const h=this._styleColorThemeForScope[l];return h?h.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(h,y,S){let E,I,G;const $=s.q.devicePixelRatio>1?"@2x":"";let Y=s.n(y.transformRequest(y.normalizeSpriteURL(h,$,".json"),s.R.SpriteJSON),(ie,he)=>{Y=null,G||(G=ie,E=he,ee())}),X=s.o(y.transformRequest(y.normalizeSpriteURL(h,$,".png"),s.R.SpriteImage),(ie,he)=>{X=null,G||(G=ie,I=he,ee())});function ee(){if(G)S(G);else if(E&&I){const ie=s.q.getImageData(I),he={};for(const ye in E){const{width:ve,height:be,x:Ce,y:Fe,sdf:ze,pixelRatio:Ue,stretchX:Ze,stretchY:Ke,content:Xe}=E[ye],Je=new s.r({width:ve,height:be});s.r.copy(ie,Je,{x:Ce,y:Fe},{x:0,y:0},{width:ve,height:be},null),he[ye]={data:Je,pixelRatio:Ue,sdf:ze,stretchX:Ze,stretchY:Ke,content:Xe}}S(null,he)}}return{cancel(){Y&&(Y.cancel(),Y=null),X&&(X.cancel(),X=null)}}}(l,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new s.t(h));else if(y)for(const S in y)this.imageManager.addImage(S,this.scope,y[S]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.x("data",{dataType:"style"}))})}_validateLayer(l){const h=this.getOwnSource(l.source);if(!h)return;const y=l.sourceLayer;y&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.t(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,h)=>{const y=this.fragments[h];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const h=[];for(const y of l){const S=this._layers[y];S&&S.type!=="custom"&&h.push(S.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(l){return l?this.order:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const h=this.getOwnLayer(l);if(h)return h;this.fire(new s.t(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const h=this.getOwnSource(l);if(h)return h;this.fire(new s.t(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,h){const y=this.map.painter;if(y)for(let S=l.minzoom||0;S<(l.maxzoom||25.5);S++){const E=l.getProgramIds();if(E)for(const I of E){const G=l.getDefaultProgramParams(I,h.zoom,this._styleColorTheme.lut);G&&(y.style=this,this.fog&&(y._fogVisible=!0,G.overrideFog=!0,y.getOrCreateProgram(I,G)),y._fogVisible=!1,G.overrideFog=!1,y.getOrCreateProgram(I,G),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(G.overrideRtt=!0,y.getOrCreateProgram(I,G)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const h=this.calculateLightsBrightness();l.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const y=this._changes.isDirty();let S=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const G in I){const{updatedIds:$,removedIds:Y}=I[G];($||Y)&&(this._updateWorkerLayers(G,$,Y),S=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const E={};for(const I in this._mergedSourceCaches){const G=this._mergedSourceCaches[I];E[I]=G.used,G.used=!1,G.tileCoverLift=0}for(const I of this._mergedOrder){const G=this._mergedLayers[I];if(G.recalculate(l,this._availableImages),!G.isHidden(l.zoom)){const $=this.getLayerSourceCache(G);$&&($.used=!0,$.tileCoverLift=Math.max($.tileCoverLift,G.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(G,l)}):this.precompilePrograms(G,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&S&&this.mergeLayers();for(const I in E){const G=this._mergedSourceCaches[I];E[I]!==G.used&&G.getSource().fire(new s.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:G.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new s.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,h,y){const S=this.getFragmentStyle(l);S&&this.dispatcher.broadcast("updateLayers",{layers:h?S._serializeLayers(h):[],scope:l,removedIds:y||[],options:S.options})}setState(l,h){if(this._checkLoaded(),Uo(this,vn(l)))return!1;(l=s.cm(l)).layers=Df(l.layers);const y=function(I,G){if(!I)return[{command:cr.setStyle,args:[G]}];let $=[];try{if(!s.bi(I.version,G.version))return[{command:cr.setStyle,args:[G]}];if(s.bi(I.center,G.center)||$.push({command:cr.setCenter,args:[G.center]}),s.bi(I.zoom,G.zoom)||$.push({command:cr.setZoom,args:[G.zoom]}),s.bi(I.bearing,G.bearing)||$.push({command:cr.setBearing,args:[G.bearing]}),s.bi(I.pitch,G.pitch)||$.push({command:cr.setPitch,args:[G.pitch]}),s.bi(I.sprite,G.sprite)||$.push({command:cr.setSprite,args:[G.sprite]}),s.bi(I.glyphs,G.glyphs)||$.push({command:cr.setGlyphs,args:[G.glyphs]}),s.bi(I.imports,G.imports)||function(he=[],ye=[],ve){ye=ye||[];const be=(he=he||[]).map($c),Ce=ye.map($c),Fe=he.reduce(hh,{}),ze=ye.reduce(hh,{}),Ue=be.slice();let Ze,Ke,Xe,Je;for(Ze=0,Ke=0;Ze<be.length;Ze++)Xe=be[Ze],ze.hasOwnProperty(Xe)?Ke++:(ve.push({command:cr.removeImport,args:[Xe]}),Ue.splice(Ue.indexOf(Xe,Ke),1));for(Ze=0,Ke=0;Ze<Ce.length;Ze++)Xe=Ce[Ce.length-1-Ze],Ue[Ue.length-1-Ze]!==Xe&&(Fe.hasOwnProperty(Xe)?(ve.push({command:cr.removeImport,args:[Xe]}),Ue.splice(Ue.lastIndexOf(Xe,Ue.length-Ke),1)):Ke++,Je=Ue[Ue.length-Ze],ve.push({command:cr.addImport,args:[ze[Xe],Je]}),Ue.splice(Ue.length-Ze,0,Xe));for(const ot of ye){const mt=Fe[ot.id];mt&&!s.bi(mt,ot)&&ve.push({command:cr.updateImport,args:[ot.id,ot]})}}(I.imports,G.imports,$),s.bi(I.transition,G.transition)||$.push({command:cr.setTransition,args:[G.transition]}),s.bi(I.light,G.light)||$.push({command:cr.setLight,args:[G.light]}),s.bi(I.fog,G.fog)||$.push({command:cr.setFog,args:[G.fog]}),s.bi(I.projection,G.projection)||$.push({command:cr.setProjection,args:[G.projection]}),s.bi(I.lights,G.lights)||$.push({command:cr.setLights,args:[G.lights]}),s.bi(I.camera,G.camera)||$.push({command:cr.setCamera,args:[G.camera]}),!s.bi(I["color-theme"],G["color-theme"]))return[{command:cr.setStyle,args:[G]}];const Y={},X=[];(function(he,ye,ve,be){let Ce;for(Ce in ye=ye||{},he=he||{})he.hasOwnProperty(Ce)&&(ye.hasOwnProperty(Ce)||Mr(Ce,ve,be));for(Ce in ye){if(!ye.hasOwnProperty(Ce))continue;const Fe=ye[Ce];he.hasOwnProperty(Ce)?s.bi(he[Ce],Fe)||(he[Ce].type==="geojson"&&Fe.type==="geojson"&&Hn(he,ye,Ce)?ve.push({command:cr.setGeoJSONSourceData,args:[Ce,Fe.data]}):Av(Ce,ye,ve,be)):uh(Ce,ye,ve)}})(I.sources,G.sources,X,Y);const ee=[];I.layers&&I.layers.forEach(he=>{he.source&&Y[he.source]?$.push({command:cr.removeLayer,args:[he.id]}):ee.push(he)});let ie=I.terrain;ie&&Y[ie.source]&&($.push({command:cr.setTerrain,args:[void 0]}),ie=void 0),$=$.concat(X),s.bi(ie,G.terrain)||$.push({command:cr.setTerrain,args:[G.terrain]}),function(he,ye,ve){ye=ye||[];const be=(he=he||[]).map($c),Ce=ye.map($c),Fe=he.reduce(hh,{}),ze=ye.reduce(hh,{}),Ue=be.slice(),Ze=Object.create(null);let Ke,Xe,Je,ot,mt,lt,at;for(Ke=0,Xe=0;Ke<be.length;Ke++)Je=be[Ke],ze.hasOwnProperty(Je)?Xe++:(ve.push({command:cr.removeLayer,args:[Je]}),Ue.splice(Ue.indexOf(Je,Xe),1));for(Ke=0,Xe=0;Ke<Ce.length;Ke++)Je=Ce[Ce.length-1-Ke],Ue[Ue.length-1-Ke]!==Je&&(Fe.hasOwnProperty(Je)?(ve.push({command:cr.removeLayer,args:[Je]}),Ue.splice(Ue.lastIndexOf(Je,Ue.length-Xe),1)):Xe++,lt=Ue[Ue.length-Ke],ve.push({command:cr.addLayer,args:[ze[Je],lt]}),Ue.splice(Ue.length-Ke,0,Je),Ze[Je]=!0);for(Ke=0;Ke<Ce.length;Ke++)if(Je=Ce[Ke],ot=Fe[Je],mt=ze[Je],!Ze[Je]&&!s.bi(ot,mt))if(s.bi(ot.source,mt.source)&&s.bi(ot["source-layer"],mt["source-layer"])&&s.bi(ot.type,mt.type)){for(at in wd(ot.layout,mt.layout,ve,Je,null,cr.setLayoutProperty),wd(ot.paint,mt.paint,ve,Je,null,cr.setPaintProperty),s.bi(ot.slot,mt.slot)||ve.push({command:cr.setSlot,args:[Je,mt.slot]}),s.bi(ot.filter,mt.filter)||ve.push({command:cr.setFilter,args:[Je,mt.filter]}),s.bi(ot.minzoom,mt.minzoom)&&s.bi(ot.maxzoom,mt.maxzoom)||ve.push({command:cr.setLayerZoomRange,args:[Je,mt.minzoom,mt.maxzoom]}),ot)ot.hasOwnProperty(at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&at!=="slot"&&(at.indexOf("paint.")===0?wd(ot[at],mt[at],ve,Je,at.slice(6),cr.setPaintProperty):s.bi(ot[at],mt[at])||ve.push({command:cr.setLayerProperty,args:[Je,at,mt[at]]}));for(at in mt)mt.hasOwnProperty(at)&&!ot.hasOwnProperty(at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&at!=="slot"&&(at.indexOf("paint.")===0?wd(ot[at],mt[at],ve,Je,at.slice(6),cr.setPaintProperty):s.bi(ot[at],mt[at])||ve.push({command:cr.setLayerProperty,args:[Je,at,mt[at]]}))}else ve.push({command:cr.removeLayer,args:[Je]}),lt=Ue[Ue.lastIndexOf(Je)+1],ve.push({command:cr.addLayer,args:[mt,lt]})}(ee,G.layers,$)}catch(Y){console.warn("Unable to compute style diff:",Y),$=[{command:cr.setStyle,args:[G]}]}return $}(this.serialize(),l).filter(I=>!(I.command in mc));if(y.length===0)return!1;const S=y.filter(I=>!(I.command in Vf));if(S.length>0)throw new Error(`Unimplemented: ${S.map(I=>I.command).join(", ")}.`);const E=[];return y.forEach(I=>{E.push(this[I.command].apply(this,I.args))}),h&&Promise.all(E).then(h),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,h){return this.getImage(l)?this.fire(new s.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,h),this._afterImageUpdated(l),this)}updateImage(l,h){this.imageManager.updateImage(l,this.scope,h)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new s.t(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,h,y={}){return this._checkLoaded(),this._validate(pt,`models.${l}`,h,null,y)||(this.modelManager.addModel(l,h,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new s.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,h,y={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(Ln,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const S=Pr(l,h,this.dispatcher,this);S.scope=this.scope,S.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(S.id),source:S.serialize(),sourceId:S.id}));const E=I=>{const G=(I?"symbol:":"other:")+S.id,$=s.av(G,this.scope),Y=this._sourceCaches[G]=new Qo($,S,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[S.id]=Y,Y.onAdd(this.map)};E(!1),h.type!=="vector"&&h.type!=="geojson"||E(!0),S.onAdd&&S.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const h=this.getOwnSource(l);if(!h)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===l)return this.fire(new s.t(new Error(`Source "${l}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new s.t(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const S of y){const E=s.cn(S.id);delete this._sourceCaches[E],this._changes.discardSourceCacheUpdate(S.id),S.fire(new s.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,h){this._checkLoaded(),this.getOwnSource(l).setData(h),this._changes.setDirty()}getOwnSource(l){const h=this.getOwnSourceCache(l);return h&&h.getSource()}getOwnSources(){const l=[];for(const h in this._otherSourceCaches){const y=this.getOwnSourceCache(h);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const h in l){const y=l[h]._tiles;for(const S in y){const E=y[S];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const S of l){if(this._validate(hi,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(S),E.updateTransitions(h)}else this.ambientLight=new Be(S,Pt||(Pt=new s.a0({color:new s.a1(s._.properties_light_ambient.color),intensity:new s.a1(s._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(S),E.updateTransitions(h)}else this.directionalLight=new Be(S,$t||($t=new s.a0({direction:new s.ad(s._.properties_light_directional.direction),color:new s.a1(s._.properties_light_directional.color),intensity:new s.a1(s._.properties_light_directional.intensity),"cast-shadows":new s.a1(s._.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.a1(s._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new s.a3(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,h=this.ambientLight;if(!l||!h)return;const y=ie=>.2126*(ie[0]<=.03928?ie[0]/12.92:Math.pow((ie[0]+.055)/1.055,2.4))+.7152*(ie[1]<=.03928?ie[1]/12.92:Math.pow((ie[1]+.055)/1.055,2.4))+.0722*(ie[2]<=.03928?ie[2]/12.92:Math.pow((ie[2]+.055)/1.055,2.4)),S=l.properties.get("color").toRenderColor(null).toArray01(),E=l.properties.get("intensity"),I=l.properties.get("direction"),G=1-s.c8(I.x,I.y,I.z)[2]/90,$=y(S)*E*G,Y=h.properties.get("color").toRenderColor(null).toArray01(),X=h.properties.get("intensity"),ee=y(Y)*X;return Number((($+ee)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(s.aK(l)){const h=s.co(l),y=this.fragments.find(({id:E})=>E===h);if(!y)throw new Error(`Style import '${l}' not found`);const S=s.cn(l);return y.style.getFragmentStyle(S)}{const h=this.fragments.find(({id:y})=>y===l);if(!h)throw new Error(`Style import '${l}' not found`);return h.style}}getFeaturesetDescriptors(l){const h=this.getFragmentStyle(l);if(!h||!h.stylesheet.featuresets)return[];const y=[];for(const S in h.stylesheet.featuresets)y.push({featuresetId:S,importId:h.scope?h.scope:void 0});return y}getFeaturesetLayers(l,h){const y=this.getFragmentStyle(h),S=y.stylesheet.featuresets;if(!S||!S[l])return this.fire(new s.t(new Error(`The featureset '${l}' does not exist in the map's style and cannot be queried.`))),[];const E=[];for(const I of S[l].selectors){const G=y.getOwnLayer(I.layer);G&&E.push(G)}return E}getConfigProperty(l,h){const y=this.getFragmentStyle(l);if(!y)return null;const S=s.av(h,y.scope),E=y.options.get(S),I=E?E.value||E.default:null;return I?I.serialize():null}setConfigProperty(l,h,y){const S=this.getFragmentStyle(l);if(!S)return;const E=S.stylesheet.schema;if(!E||!E[h])return;const I=s.M(y);if(I.result!=="success")return void Uo(this,I.value);const G=I.value.expression,$=s.av(h,S.scope),Y=S.options.get($);if(!Y)return;let X;const{minValue:ee,maxValue:ie,stepValue:he,type:ye,values:ve}=E[h],be=s.M(E[h].default);be.result==="success"&&(X=be.value.expression),X?(this.options.set($,{...Y,value:G,default:X,minValue:ee,maxValue:ie,stepValue:he,type:ye,values:ve}),this.updateConfigDependencies(h)):this.fire(new s.t(new Error(`No schema defined for the config option "${h}" in the "${l}" fragment.`)))}getConfig(l){const h=this.getFragmentStyle(l);if(!h)return null;const y=h.stylesheet.schema;if(!y)return null;const S={};for(const E in y){const I=s.av(E,h.scope),G=h.options.get(I),$=G?G.value||G.default:null;S[E]=$?$.serialize():null}return S}setConfig(l,h){const y=this.getFragmentStyle(l);y&&(y.updateConfig(h,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const h=this.getFragmentStyle(l);return h?h.stylesheet.schema:null}setSchema(l,h){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=h,y.updateConfig(y._config,h),this.updateConfigDependencies())}updateConfig(l,h){if(this._config=l,l||h)if(h)for(const y in h){let S,E;const I=s.M(h[y].default);if(I.result==="success"&&(S=I.value.expression),l&&l[y]!==void 0){const ie=s.M(l[y]);ie.result==="success"&&(E=ie.value.expression)}const{minValue:G,maxValue:$,stepValue:Y,type:X,values:ee}=h[y];if(S){const ie=s.av(y,this.scope);this.options.set(ie,{default:S,value:E,minValue:G,maxValue:$,stepValue:Y,type:X,values:ee})}else this.fire(new s.t(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new s.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const h of this._configDependentLayers){const y=this.getLayer(h);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(h=>{if(h._styleColorTheme.colorTheme){const y=h._evaluateColorThemeData(h._styleColorTheme.colorTheme);(!h._styleColorTheme.lut&&y!==""||h._styleColorTheme.lut&&y!==h._styleColorTheme.lut.data)&&h.setColorTheme(h._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,h,y={}){this._checkLoaded();const S=l.id;if(this._layers[S])return void this.fire(new s.t(new Error(`Layer with id "${S}" already exists on this map`)));let E;if(l.type==="custom"){if(Uo(this,s.cp(l)))return;E=s.cq(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(S,l.source),l=s.cm(l),l=s.l(l,{source:S})),this._validate(Ft,`layers.${S}`,l,{arrayIndex:-1},y))return;E=s.cq(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(E),E.setEventedParent(this,{layer:{id:S}})}E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid);let I=this._order.length;if(h){const X=this._order.indexOf(h);if(X===-1)return void this.fire(new s.t(new Error(`Layer with id "${h}" does not exist on this map.`)));E.slot===this._layers[h].slot?I=X:s.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,S),this._layerOrderChanged=!0,this._layers[S]=E;const G=this.getOwnLayerSourceCache(E),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&E.canCastShadows()&&$&&(G.castsShadows=!0);const Y=this._changes.getRemovedLayer(E);if(Y&&E.source&&G&&E.type!=="custom"){this._changes.discardLayerRemoval(E);const X=s.av(E.source,E.scope);Y.type!==E.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),G.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),E.scope=this.scope,this.mergeLayers()}moveLayer(l,h){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===h)return;const S=this._order.indexOf(l);this._order.splice(S,1);let E=this._order.length;if(h){const I=this._order.indexOf(h);if(I===-1)return void this.fire(new s.t(new Error(`Layer with id "${h}" does not exist on this map.`)));y.slot===this._layers[h].slot?E=I:s.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const h=this._checkLayer(l);if(!h)return;h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const S=this.getOwnLayerSourceCache(h);if(S&&S.castsShadows){let E=!1;for(const I in this._layers)if(this._layers[I].source===h.source&&this._layers[I].canCastShadows()){E=!0;break}S.castsShadows=E}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const h in this._layers)if(this._layers[h].type===l)return!0;return!1}setLayerZoomRange(l,h,y){this._checkLoaded();const S=this._checkLayer(l);S&&(S.minzoom===h&&S.maxzoom===y||(h!=null&&(S.minzoom=h),y!=null&&(S.maxzoom=y),this._updateLayer(S)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,h){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==h&&(y.slot=h,this._updateLayer(y))}setFilter(l,h,y={}){this._checkLoaded();const S=this._checkLayer(l);if(S&&!s.bi(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(we,`layers.${S.id}.filter`,h,{layerType:S.type},y)||(S.filter=s.cm(h),this._updateLayer(S)))}getFilter(l){const h=this._checkLayer(l);if(h)return s.cm(h.filter)}setLayoutProperty(l,h,y,S={}){this._checkLoaded();const E=this._checkLayer(l);if(E&&!s.bi(E.getLayoutProperty(h),y)){if(y!=null&&(!S||S.validate!==!1)&&Uo(E,je.call(vn,{key:`layers.${l}.layout.${h}`,layerType:E.type,objectKey:h,value:y,styleSpec:s._,style:{glyphs:!0,sprite:!0}})))return;E.setLayoutProperty(h,y),E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),this._updateLayer(E)}}getLayoutProperty(l,h){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(h)}setPaintProperty(l,h,y,S={}){this._checkLoaded();const E=this._checkLayer(l);if(!E||s.bi(E.getPaintProperty(h),y)||y!=null&&(!S||S.validate!==!1)&&Uo(E,Ie.call(vn,{key:`layers.${l}.paint.${h}`,layerType:E.type,objectKey:h,value:y,styleSpec:s._})))return;const I=E.setPaintProperty(h,y);E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),I&&this._updateLayer(E),this._changes.updatePaintProperties(E)}getPaintProperty(l,h){const y=this._checkLayer(l);if(y)return y.getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.featureset;if(y){if("featuresetId"in y){const Y=this.getFragmentStyle(y.importId),X=Y.getFeaturesetLayers(y.featuresetId);for(const{source:ee,sourceLayer:ie}of X)Y.setFeatureState({id:l.id,source:ee,sourceLayer:ie},h)}else if("layerId"in y){const Y=this.getLayer(y.layerId);this.setFeatureState({id:l.id,source:Y.source,sourceLayer:Y.sourceLayer},h)}return}const S=l.source,E=l.sourceLayer,I=this._checkSource(S);if(!I)return;const G=I.type;if(G==="geojson"&&E)return void this.fire(new s.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(G==="vector"&&!E)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided.")));const $=this.getOwnSourceCaches(S);for(const Y of $)Y.setFeatureState(E,l.id,h)}removeFeatureState(l,h){this._checkLoaded();const y=l.featureset;if(y){if("featuresetId"in y){const Y=this.getFragmentStyle(y.importId),X=Y.getFeaturesetLayers(y.featuresetId);for(const{source:ee,sourceLayer:ie}of X)Y.removeFeatureState({id:l.id,source:ee,sourceLayer:ie},h)}else if("layerId"in y){const Y=this.getLayer(y.layerId);this.removeFeatureState({id:l.id,source:Y.source,sourceLayer:Y.sourceLayer},h)}return}const S=l.source,E=this._checkSource(S);if(!E)return;const I=E.type,G=I==="vector"?l.sourceLayer:void 0;if(I==="vector"&&!G)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.t(new Error("A feature id is required to remove its specific state property.")));const $=this.getOwnSourceCaches(S);for(const Y of $)Y.removeFeatureState(G,l.id,h)}getFeatureState(l){this._checkLoaded();const h=l.featureset;if(h){let I;if("featuresetId"in h){const G=this.getFragmentStyle(h.importId),$=G.getFeaturesetLayers(h.featuresetId);for(const{source:Y,sourceLayer:X}of $){const ee=G.getFeatureState({id:l.id,source:Y,sourceLayer:X});if(ee&&!I)I=ee;else if(!s.bi(I,ee))return void this.fire(new s.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in l){const G=this.getLayer(h.layerId);I=this.getFeatureState({id:l.id,source:G.source,sourceLayer:G.sourceLayer})}return I}const y=l.source,S=l.sourceLayer,E=this._checkSource(y);if(E){if(E.type!=="vector"||S)return l.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(y)[0].getFeatureState(S,l.id);this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=s.l({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),h=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return s.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateFilteredLayers(l){for(const h of Object.values(this._mergedLayers))l(h)&&this._updateLayer(h)}_updateLayer(l){this._changes.updateLayer(l);const h=this.getLayerSourceCache(l),y=s.av(l.source,l.scope),S=this._changes.getUpdatedSourceCaches();l.source&&!S[y]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),h.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const h=G=>this._mergedLayers[G].is3D(),y=this.order,S={},E=[];for(let G=y.length-1;G>=0;G--){const $=y[G];if(h($)){S[$]=G;for(const Y of l){const X=Y[$];if(X)for(const ee of X)E.push(ee)}}}E.sort((G,$)=>$.intersectionZ-G.intersectionZ);const I=[];for(let G=y.length-1;G>=0;G--){const $=y[G];if(h($))for(let Y=E.length-1;Y>=0;Y--){const X=E[Y].feature;if(X.layer&&S[X.layer.id]<G)break;I.push(X),E.pop()}else for(const Y of l){const X=Y[$];if(X)for(const ee of X)I.push(ee.feature)}}return I}queryRenderedFeatures(l,h,y){h&&!Array.isArray(h)&&h.filter&&this._validate(we,"queryRenderedFeatures.filter",h.filter,null,h);let S,E=!1;const I=new Set;if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.t(new Error("parameters.layers must be an Array."))),[];S=[];for(const X of h.layers){const ee=this._mergedLayers[X];if(!ee)return this.fire(new s.t(new Error(`The layer '${X}' does not exist in the map's style and cannot be queried for features.`))),[];ee.is3D()&&(E=!0),I.add(ee.source),S.push(X)}}else E=this.has3DLayers();const G=this._queryRenderedFeatures(l,y,{layerIds:S,filter:h.filter,has3DLayers:E,includedSources:I}),$=this._flattenAndSortRenderedFeatures(G),Y=[];for(const X of $)s.co(X.layer.id)===this.scope&&Y.push(X);return Y}queryRenderedFeaturesForInteractions(l,h,y){let S=[];for(const{featureset:$,filter:Y,radius:X}of h){let ee=!1;const ie=[],he=new Set;if("featuresetId"in $){const ve=this.getFeaturesetLayers($.featuresetId,$.importId);if(ve.length===0)continue;for(const be of ve)be.is3D()&&(ee=!0),he.add(be.source),ie.push(be.fqid)}else if("layerId"in $){const ve=this._mergedLayers[$.layerId];if(!ve)return this.fire(new s.t(new Error(`The layer '${$.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];ve.is3D()&&(ee=!0),he.add(ve.source),ie.push($.layerId)}let ye=l;if(X)if(l instanceof s.P||typeof l[0]=="number"){const ve=s.P.convert(l);ye=[[ve.x-X,ve.y-X],[ve.x+X,ve.y+X]]}else{const ve=s.P.convert(l[0]),be=s.P.convert(l[1]);ye=[[ve.x-X,ve.y-X],[be.x+X,be.y+X]]}S=S.concat(this._queryRenderedFeatures(ye,y,{layerIds:ie,filter:Y,has3DLayers:ee,includedSources:he}))}const E=this._flattenAndSortRenderedFeatures(S),I=($,Y,X)=>{const ee=$.clone();if(delete ee.layer,ee.featureset=Y,X&&X.featureNamespace&&(ee.namespace=X.featureNamespace),X&&X.properties){const ie={},he=this.map.transform.zoom;for(const ye of Object.keys(X.properties)){const ve=X.properties[ye].evaluate({zoom:he},$._vectorTileFeature,$.state,$.tile,this._availableImages);ve!=null&&(ie[ye]=ve)}ee.properties=ie}return ee},G=[];for(const $ of E){const Y=$.layer.id,X=s.cn(Y),ee=s.co(Y);for(const{featureset:ie}of h){if("layerId"in ie&&ie.layerId!==Y)continue;if("layerId"in ie&&ie.layerId===Y){const ye=I($,ie);G.push(ye);continue}if("featuresetId"in ie&&(ie.importId!==ee||!this.getFeaturesetLayers(ie.featuresetId,ie.importId).map(ye=>ye.id).includes(X)))continue;const he=this._mergedLayerSelectors.get(Y)||[];for(const ye of he){const ve=I($,ie,ye);G.push(ve)}}}return G}_queryRenderedFeatures(l,h,y){const{layerIds:S,filter:E,has3DLayers:I,includedSources:G}=y,$=[],Y=ht.createFromScreenPoints(l,h);for(const X in this._mergedSourceCaches){if(!this._mergedSourceCaches[X].getSource())continue;const ee=this._mergedSourceCaches[X].getSource().id;S&&!G.has(ee)||$.push(vr(this._mergedSourceCaches[X],this._mergedLayers,Y,E,S||[],this._availableImages,h,I,!!this.map._showQueryGeometry))}return this.placement&&$.push(function(X,ee,ie,he,ye,ve,be,Ce){const Fe={},ze=be.queryRenderedSymbols(ie),Ue=[];for(const Ze of Object.keys(ze).map(Number))Ue.push(Ce[Ze]);Ue.sort(fi);for(const Ze of Ue){const Ke=Ze.featureIndex.lookupSymbolFeatures(ze[Ze.bucketInstanceId],Ze.bucketIndex,Ze.sourceLayerIndex,he,ye,ve,X);for(const Xe in Ke){const Je=Fe[Xe]=Fe[Xe]||[],ot=Ke[Xe];ot.sort((mt,lt)=>{const at=Ze.featureSortOrder;if(at){const Nt=at.indexOf(mt.featureIndex);return at.indexOf(lt.featureIndex)-Nt}return lt.featureIndex-mt.featureIndex});for(const mt of ot)Je.push(mt)}}for(const Ze in Fe)Fe[Ze].forEach(Ke=>{const Xe=Ke.feature,Je=X[Ze],ot=ee(Je);if(!ot)return;const mt=ot.getFeatureState(Xe.layer["source-layer"],Xe.id);Xe.state=mt,s.aK(Je.id)||(Xe.source=Xe.layer.source,Xe.layer["source-layer"]&&(Xe.sourceLayer=Xe.layer["source-layer"]))});return Fe}(this._mergedLayers,this.getLayerSourceCache.bind(this),Y.screenGeometry,E,S||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),$}querySourceFeatures(l,h){const y=h&&h.filter;y&&this._validate(we,"querySourceFeatures.filter",y,null,h);let S=[];const E=this.getOwnSourceCaches(l);for(const I of E)S=S.concat(wr(I,h));return S}addSourceType(l,h,y){return Vo.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(Vo.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,h,y={}){this._checkLoaded();const S=this.light.getLight();let E=!1;for(const G in l)if(!s.bi(l[G],S[G])){E=!0;break}if(!E)return;const I=this._getTransitionParameters();this.light.setLight(l,h,y),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,h=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const S=l.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const G="terrain-dem-src";this.addSource(G,y.source),y=s.cm(y),y=s.l(y,{source:G})}const E=s.l({},y),I={};if(this.terrain&&S){E.source=this.terrain.get().source;const G=this.terrain?this.getFragmentStyle(this.terrain.scope):null;G&&(I.style=G.serialize())}if(this._validate(Xi,"terrain",E,I))return}if(!this.terrain||this.terrain.scope!==this.scope&&!S||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h),this.fire(new s.x("data",{dataType:"style"}))}else{const E=this.terrain,I=E.get();for(const G of Object.keys(s._.terrain))!y.hasOwnProperty(G)&&s._.terrain[G].default&&(y[G]=s._.terrain[G].default);for(const G in l)if(!s.bi(l[G],I[G])){E.set(l,this.options),this.stylesheet.terrain=l;const $=this._getTransitionParameters({duration:0});E.updateTransitions($),this.fire(new s.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const h=this.fog=new Mi(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!s.bi(h.get(),l)){h.set(l,this.options),this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const h=()=>{for(const S in this._layers)this._layers[S].lut=this._styleColorTheme.lut;for(const S in this._sourceCaches)this._sourceCaches[S].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void h();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new s.x("colorthemeset")),h()}).catch(S=>{s.w(`Couldn't set color theme: ${S}`)})}_getTransitionParameters(l){return{now:s.q.now(),transition:s.l(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],h=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):h.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...h)}_createTerrain(l,h){const y=this.terrain=new Bt(l,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const S=this._getTransitionParameters({duration:0});y.updateTransitions(S)}_force3DLayerUpdate(){for(const l in this._layers){const h=this._layers[l];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const h=this._layers[l];h.type==="symbol"&&this._updateLayer(h)}}_validate(l,h,y,S,E={}){if(E&&E.validate===!1)return!1;const I=s.l({},this.serialize());return Uo(this,l.call(vn,s.l({key:h,style:I,value:y,styleSpec:s._},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const h=this.getSourceCaches(l);for(const y of h)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const h=this.getSourceCaches(l);for(const y of h)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let h;this.directionalLight&&(h=Ed(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,h)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const h=this._sourceCaches[l];h.resume(),h.reload()}}_updatePlacement(l,h,y,S,E,I,G=!1){let $=!1,Y=!1;const X={},ee={};for(const ie of this._mergedOrder){const he=this._mergedLayers[ie];if(he.type!=="symbol")continue;const ye=s.av(he.source,he.scope);let ve=X[ye];if(!ve){const Ce=this.getLayerSourceCache(he);if(!Ce)continue;const Fe=Ce.getRenderableIds(!0).map(ze=>Ce.getTileByID(ze));ee[ye]=Fe.slice(),ve=X[ye]=Fe.sort((ze,Ue)=>Ue.tileID.overscaledZ-ze.tileID.overscaledZ||(ze.tileID.isLessThan(Ue.tileID)?-1:1))}const be=this.crossTileSymbolIndex.addLayer(he,ve,h.center.lng,h.projection);$=$||be}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),G=G||this._layerOrderChanged||S===0,this._layerOrderChanged&&this.fire(new s.x("neworder")),(G||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),h.zoom))&&(this.pauseablePlacement=new Eu(h,this._mergedOrder,G,y,S,E,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,X,ee,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),Y=!0),$&&this.pauseablePlacement.placement.setStale()),Y||$){this._buildingIndex.onNewFrame(h.zoom);for(let ie=0;ie<this._mergedOrder.length;ie++){const he=this._mergedLayers[this._mergedOrder[ie]];if(he.type!=="symbol")continue;const ye=this.isLayerClipped(he);this.placement.updateLayerOpacities(he,X[s.av(he.source,he.scope)],ie,ye?I:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,h){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:E})=>E===l.id)!==-1)return void this.fire(new s.t(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!h)return y.push(l),this._loadImports([l],!0);const S=y.findIndex(({id:E})=>E===h);return S===-1&&this.fire(new s.t(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,S).concat(l).concat(y.slice(S)),this._loadImports([l],!0,h)}updateImport(l,h){this._checkLoaded();const y=this.stylesheet.imports||[],S=this.getImportIndex(l);return S===-1?this:typeof h=="string"?(this.setImportUrl(l,h),this):(h.url&&h.url!==y[S].url&&this.setImportUrl(l,h.url),s.bi(h.config,y[S].config)||this.setImportConfig(l,h.config),s.bi(h.data,y[S].data)||this.setImportData(l,h.data),this)}moveImport(l,h){this._checkLoaded();let y=this.stylesheet.imports||[];const S=this.getImportIndex(l);if(S===-1)return this;const E=this.getImportIndex(h);if(E===-1)return this;const I=y[S],G=this.fragments[S];return y=y.filter(({id:$})=>$!==l),this.fragments=this.fragments.filter(({id:$})=>$!==l),this.stylesheet.imports=y.slice(0,E).concat(I).concat(y.slice(E)),this.fragments=this.fragments.slice(0,E).concat(G).concat(this.fragments.slice(E)),this.mergeLayers(),this}setImportUrl(l,h){this._checkLoaded();const y=this.stylesheet.imports||[],S=this.getImportIndex(l);if(S===-1)return this;y[S].url=h;const E=this.fragments[S];return E.style=this._createFragmentStyle(y[S]),E.style.on("style.import.load",()=>this.mergeAll()),E.style.loadURL(h),this}setImportData(l,h){this._checkLoaded();const y=this.getImportIndex(l),S=this.stylesheet.imports||[];return y===-1?this:h?(this.fragments[y].style.setState(h),this._reloadImports(),this):(delete S[y].data,this.setImportUrl(l,S[y].url))}setImportConfig(l,h){this._checkLoaded();const y=this.getImportIndex(l),S=this.stylesheet.imports||[];if(y===-1)return this;h?S[y].config=h:delete S[y].config;const E=this.fragments[y],I=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=h,E.style.updateConfig(h,I),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const h=this.stylesheet.imports||[],y=this.getImportIndex(l);y!==-1&&(h.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const h=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return h===-1&&this.fire(new s.t(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),h}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const h in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[h];y&&l.push(y.getSource())}return l}getSource(l,h){const y=this.getSourceCache(l,h);return y&&y.getSource()}getLayerSource(l){const h=this.getLayerSourceCache(l);return h&&h.getSource()}getSourceCache(l,h){const y=s.av(l,h);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const h=s.av(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[l]&&h.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&h.push(this._mergedSymbolSourceCaches[l]),h}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const h in l){const y=l[h];y==="reload"?this.reloadSource(h):y==="clear"&&this.clearSource(h)}}updateLayers(l){const h=this._changes.getUpdatedPaintProperties();for(const y of h){const S=this.getLayer(y);S&&S.updateTransitions(l)}}getImages(l,h,y){this.imageManager.getImages(h.icons,h.scope,y),this._updateTilesForChangedImages();const S=E=>{E&&E.setDependencies(h.tileID.key,h.type,h.icons)};S(this._otherSourceCaches[h.source]),S(this._symbolSourceCaches[h.source])}getGlyphs(l,h,y){this.glyphManager.getGlyphs(h.stacks,h.scope,y)}getResource(l,h,y){return s.ct(h,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const h=[];return this._otherSourceCaches[l]&&h.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&h.push(this._symbolSourceCaches[l]),h}_isSourceCacheLoaded(l){const h=this.getOwnSourceCaches(l);return h.length===0?(this.fire(new s.t(new Error(`There is no source with ID '${l}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,h){if(!this._clipLayerPresent&&l.type!=="fill-extrusion")return!1;const y=l.type==="fill-extrusion"&&l.sourceLayer==="building";if(l.is3D()){if(y||h&&h.type==="batched-model"||l.type==="model")return!0}else if(l.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vo.getSourceType=function(g){return or[g]},Vo.setSourceType=function(g,l){or[g]=l},Vo.registerForPluginStateChange=s.cd;var Fl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Tu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Hf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,zs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,wm=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,$f=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,da=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Kc=[];rl(Fl,Kc),rl(Tu,Kc),rl(Gf,Kc);const Fs={"_prelude_fog.vertex.glsl":zs,"_prelude_terrain.vertex.glsl":xm,"_prelude_shadow.vertex.glsl":$f,"_prelude_fog.fragment.glsl":Wf,"_prelude_shadow.fragment.glsl":da,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":wm,"_prelude_raster_particle.glsl":jf},to={};ir("",xm),ir(Wf,zs),ir(da,$f),ir(wm,""),ir(jf,"");const Zs=ir(Gf,Tu),vh=Fl;var il={background:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ir("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ir(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ir(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ir("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ir("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ir("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ir(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ir(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ir(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ir(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ir("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ir("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ir(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ir(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ir("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ir(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hf),skyboxGradient:ir(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hf),skyboxCapture:ir(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ir(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ir(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ir(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ir(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ir("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ir("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:ir("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function rl(g,l){const h=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of h)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=y.split(" ");for(const E of S)l.includes(E)||l.push(E)}}function ir(g,l){const h=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let S=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);S&&(S=S.map(Y=>{const X=Y.split(" ");return X[X.length-1]}),S=[...new Set(S)]);const E={},I=[],G=[];if(g=g.replace(h,(Y,X)=>(G.push(X),"")),(l=l.replace(h,(Y,X)=>(I.push(X),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let $=[...Kc];rl(g,$),rl(l,$);for(const Y of[...I,...G])Fs[Y]||console.error(`Undefined include: ${Y}`),to[Y]||(to[Y]=[],rl(Fs[Y],to[Y])),$=[...$,...to[Y]];return{fragmentSource:g=g.replace(y,(Y,X,ee,ie,he)=>(E[he]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${he}
in ${ee} ${ie} ${he};
#else
uniform ${ee} ${ie} u_${he};
#endif
`:X==="initialize"?`
#ifdef HAS_UNIFORM_u_${he}
    ${ee} ${ie} ${he} = u_${he};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    in ${ee} ${ie} ${he};
#endif
`:X==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(y,(Y,X,ee,ie,he)=>{const ye=ie==="float"?"vec2":ie,ve=he.match(/color/)?"color":ye;return X==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${he}
in ${ee} ${ie} a_${he};
#endif
`:E[he]?X==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
in ${ee} ${ye} a_${he};
out ${ee} ${ie} ${he};
#else
uniform ${ee} ${ie} u_${he};
#endif
`:X==="initialize"?ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = a_${he};
#else
    ${ee} ${ie} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = unpack_mix_${ve}(a_${he}, u_${he}_t);
#else
    ${ee} ${ie} ${he} = u_${he};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    in ${ee} ${ie} a_${he};
    out ${ee} ${ie} ${he};
#endif
`:X==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    ${he} = a_${he};
#endif
`:void 0:X==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
in ${ee} ${ye} a_${he};
#else
uniform ${ee} ${ie} u_${he};
#endif
`:X==="define-instanced"?ve==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${he}0;
in vec4 a_${he}1;
in vec4 a_${he}2;
in vec4 a_${he}3;
#else
uniform ${ee} ${ie} u_${he};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${ee} ${ye} a_${he};
#else
uniform ${ee} ${ie} u_${he};
#endif
`:X==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    ${ee} ${ie} ${he} = a_${he};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${ee} ${ie} ${he} = a_${he};
#else
    ${ee} ${ie} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${ee} ${ie} ${he} = unpack_mix_${ve}(a_${he}, u_${he}_t);
#else
    ${ee} ${ie} ${he} = u_${he};
#endif
`}),staticAttributes:S,usedDefines:$,vertexIncludes:I,fragmentIncludes:G}}class no{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,h,y,S,E,I,G,$){this.context=l;let Y=this.boundPaintVertexBuffers.length!==S.length;for(let ee=0;!Y&&ee<S.length;ee++)this.boundPaintVertexBuffers[ee]!==S[ee]&&(Y=!0);let X=this.boundDynamicVertexBuffers.length!==G.length;for(let ee=0;!X&&ee<G.length;ee++)this.boundDynamicVertexBuffers[ee]!==G[ee]&&(X=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||Y||X||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(h,y,S,E,I,G,$);else{l.bindVertexArrayOES.set(this.vao);for(const ee of G)ee&&(ee.bind(),$&&ee.instanceCount&&ee.setVertexAttribDivisor(l.gl,h,$));E&&E.dynamicDraw&&E.bind()}}freshBind(l,h,y,S,E,I,G){const $=l.numAttributes,Y=this.context,X=Y.gl;this.vao&&this.destroy(),this.vao=Y.gl.createVertexArray(),Y.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=S,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I,h.enableAttributes(X,l),h.bind(),h.setVertexAttribPointers(X,l,E);for(const ee of y)ee.enableAttributes(X,l),ee.bind(),ee.setVertexAttribPointers(X,l,E);for(const ee of I)ee&&(ee.enableAttributes(X,l),ee.bind(),ee.setVertexAttribPointers(X,l,E),G&&ee.instanceCount&&ee.setVertexAttribDivisor(X,l,G));S&&S.bind(),Y.currentNumAttributes=$}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function yh(g,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new s.a5(0,y/h).toLngLat().lat,new s.a5(0,(y+1)/h).toLngLat().lat]}function Rd(g,l,h,y,S,E,I){const G=g.context,$=G.gl,Y=h.hillshadeFBO;if(!Y)return;g.prepareDrawTile();const X=g.isTileAffectedByFog(l),ee=g.getOrCreateProgram("hillshade",{overrideFog:X});G.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Y.colorAttachment.get());const ie=((be,Ce,Fe,ze)=>{const Ue=Fe.paint.get("hillshade-shadow-color"),Ze=Fe.paint.get("hillshade-highlight-color"),Ke=Fe.paint.get("hillshade-accent-color"),Xe=Fe.paint.get("hillshade-emissive-strength");let Je=s.bC(Fe.paint.get("hillshade-illumination-direction"));if(Fe.paint.get("hillshade-illumination-anchor")==="viewport")Je-=be.transform.angle;else if(be.style&&be.style.enable3dLights()&&be.style.directionalLight){const mt=be.style.directionalLight.properties.get("direction"),lt=s.c8(mt.x,mt.y,mt.z);Je=s.bC(lt[1])}const ot=!be.options.moving;return{u_matrix:ze||be.transform.calculateProjMatrix(Ce.tileID.toUnwrapped(),ot),u_image:0,u_latrange:yh(0,Ce.tileID),u_light:[Fe.paint.get("hillshade-exaggeration"),Je],u_shadow:Ue.toRenderColor(Fe.lut),u_highlight:Ze.toRenderColor(Fe.lut),u_emissive_strength:Xe,u_accent:Ke.toRenderColor(Fe.lut)}})(g,h,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(G,ee,l.toUnwrapped());const{tileBoundsBuffer:he,tileBoundsIndexBuffer:ye,tileBoundsSegments:ve}=g.getTileBoundsBuffers(h);ee.draw(g,$.TRIANGLES,S,E,I,yi.disabled,ie,y.id,he,ye,ve)}function _h(g,l,h){if(!l.needsDEMTextureUpload)return;const y=g.context,S=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(h.stride);const E=h.getPixels();l.demTexture?l.demTexture.update(E,{premultiply:!1}):l.demTexture=new s.T(y,E,S.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Fa(g,l,h){const y=g.context,S=y.gl;if(!l.dem)return;const E=l.dem;if(y.activeTexture.set(S.TEXTURE1),_h(g,l,E),!l.demTexture)return;l.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const I=E.dim;y.activeTexture.set(S.TEXTURE0);let G=l.hillshadeFBO;if(!G){const ie=new s.T(y,{width:I,height:I,data:null},S.RGBA8);ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),G=l.hillshadeFBO=y.createFramebuffer(I,I,!0,"renderbuffer"),G.colorAttachment.set(ie.texture)}y.bindFramebuffer.set(G.framebuffer),y.viewport.set([0,0,I,I]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Y,tileBoundsSegments:X}=g.getMercatorTileBoundsBuffers(),ee=[];g.linearFloatFilteringSupported()&&ee.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:ee}).draw(g,S.TRIANGLES,ii.disabled,_i.disabled,Vi.unblended,yi.disabled,((ie,he)=>{const ye=he.stride,ve=s.a6.mat4.create();return s.a6.mat4.ortho(ve,0,s.ab,-s.ab,0,0,1),s.a6.mat4.translate(ve,ve,[0,-s.ab,0]),{u_matrix:ve,u_image:1,u_dimension:[ye,ye],u_zoom:ie.overscaledZ}})(l.tileID,E),h.id,$,Y,X),l.needsHillshadePrepare=!1}class fr{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yc extends fr{getDefault(){return s.bA.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class qf extends fr{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Td extends fr{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Zf extends fr{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ad extends fr{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Iv extends fr{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Dv extends fr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Fv extends fr{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class xh extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class Cm extends fr{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Xf extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class K_ extends fr{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Sm extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Pd extends fr{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Kf extends fr{getDefault(){return s.bA.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class wh extends fr{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class bm extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class Lv extends fr{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ov extends fr{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Y_=class extends fr{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Ch extends fr{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Id extends fr{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class kv extends fr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Xa extends fr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Em extends fr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Mm extends fr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Rm extends fr{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Tm extends fr{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class Am extends fr{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Yf extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Pm extends fr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Au extends fr{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class Im extends Au{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Nv extends Au{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class J_ extends Au{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Pu extends Nv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Bv=(g,l,h)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:h}),Q_=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:S,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:G,u_frustum_br:$,u_frustum_bl:Y,u_globe_pos:X,u_globe_radius:ee,u_viewport:ie,u_grid_matrix:ve?Float32Array.from(ve):new Float32Array(9),u_skirt_height:he,u_far_z_cutoff:ye});function zv(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Sh=new class{constructor(){this.operations={}}newMorphing(g,l,h,y,S){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==h.tileID.key&&(E.queued=h)}else this.operations[g]={startTime:y,phase:0,duration:S,from:l,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const h=this.operations[l];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Uv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vv(g,l,h){if(l===0)return 0;const y=l<1&&h===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function Dm(g,l){const h=1<<g.z;return!l&&(g.x===0||g.x===h-1)||g.y===0||g.y===h-1}const La=g=>({u_matrix:g});function Jf(g,l,h,y,S){if(S>0){const E=s.q.now(),I=(E-g.timeAdded)/S,G=l?(E-l.timeAdded)/S:-1,$=h.getSource(),Y=y.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),X=!l||Math.abs(l.tileID.overscaledZ-Y)>Math.abs(g.tileID.overscaledZ-Y),ee=X&&g.refreshedUponExpiration?1:s.ap(X?I:1-G,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class gc extends Qo{constructor(l){const h={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new s.ce(s.cf(),null),S=Pr("mock-dem",h,y,l.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,h){l.state="loaded",h(null)}}class Dd extends Qo{constructor(l){const h=Pr("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new s.ce(s.cf(),null),l.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,h,y){if(l.freezeTileCoverage)return;this.transform=l;const S=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const G=new Zr(I,this._source.tileSize*I.overscaleFactor(),l.tileZoom);G.state="loaded",this._tiles[I.key]=G}return E},{});for(const E in this._tiles)E in S||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(l){const h=this.proxyCachedFBO[l];if(h!==void 0){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fd extends s.aA{constructor(l,h,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class Ld extends s.cE{constructor(l,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,S,E]=function($){const Y=new s.a$,X=new s.aP,ee=131;Y.reserve(17161),X.reserve(33800);const ie=s.ab/128,he=s.ab+ie/2,ye=he+ie;for(let be=-ie;be<ye;be+=ie)for(let Ce=-ie;Ce<ye;Ce+=ie){const Fe=Ce<0||Ce>he||be<0||be>he?24575:0,ze=s.ap(Math.round(Ce),0,s.ab),Ue=s.ap(Math.round(be),0,s.ab);Y.emplaceBack(ze+Fe,Ue)}const ve=(be,Ce)=>{const Fe=Ce*ee+be;X.emplaceBack(Fe+1,Fe,Fe+ee),X.emplaceBack(Fe+ee,Fe+ee+1,Fe+1)};for(let be=1;be<129;be++)for(let Ce=1;Ce<129;Ce++)ve(Ce,be);return[0,129].forEach(be=>{for(let Ce=0;Ce<130;Ce++)ve(Ce,be),ve(be,Ce)}),[Y,X,32768]}(),I=l.context;this.gridBuffer=I.createVertexBuffer(y,s.b1.members),this.gridIndexBuffer=I.createIndexBuffer(S),this.gridSegments=s.b2.simpleSegment(0,0,y.length,S.length),this.gridNoSkirtSegments=s.b2.simpleSegment(0,0,y.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dd(h.map),this.orthoMatrix=s.a6.mat4.create(),s.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ab,0,s.ab,0,1);const G=I.gl;this._overlapStencilMode=new _i({func:G.GEQUAL,mask:255},0,255,G.KEEP,G.KEEP,G.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gc(h.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,h,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const S=l.terrain.properties,E=l.terrain.drapeRenderMode===0,I=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const G=l.terrain&&l.terrain.scope,$=S.get("source"),Y=E?this._mockSourceCache:l.getSourceCache($,G);if(!Y)return void s.w(`Couldn't find terrain source "${$}".`);if(this.sourceCache=Y,this._attenuationRange=l.terrain.getAttenuationRange(),this._exaggeration=I?this.calculateExaggeration(h):S.get("exaggeration"),!h.projection.requiresDraping&&I&&this._exaggeration===0)return void this._disable();this.enabled=!0;const X=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ee=this.getScaledDemTileSize();this.sourceCache.update(h,ee,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,X(),this._initializing=!0),X(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(l){if(this._attenuationRange&&l.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(l.zoom);const h=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const S=h!=null?y-h:Number.MAX_VALUE;if(Math.abs(S)<2)return this._exaggeration;const E=l.zoom,I=this._style.terrain;if(!this._previousUpdateTimestamp)return I.getExaggeration(E);let G=E-this._previousZoom;const $=this._previousUpdateTimestamp;let Y=E;this._evaluationZoom!=null&&(Y=this._evaluationZoom,Math.abs(E-Y)>.5&&(G=.5*(E-Y+G)),G*S<0&&(Y+=G)),this._evaluationZoom=Y;const X=I.getExaggeration(Y),ee=X===I.getExaggeration(Math.max(0,Y-.1));if(ee&&Math.abs(X-this._exaggeration)<.01)return X;let ie=Math.min(.1,.00375*(this._updateTimestamp-$));return(ee||X<.1||Math.abs(G)<1e-4)&&(ie=Math.min(.2,4*ie)),s.aa(this._exaggeration,X,ie)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(s.a5.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=h.getIds().map($=>{const Y=h.getTileByID($).tileID;return Y.projMatrix=y.calculateProjMatrix(Y.toUnwrapped()),Y});(function($,Y){const X=Y.transform.pointCoordinate(Y.transform.getCameraPoint()),ee=new s.P(X.x,X.y);$.sort((ie,he)=>{if(he.overscaledZ-ie.overscaledZ)return he.overscaledZ-ie.overscaledZ;const ye=new s.P(ie.canonical.x+(1<<ie.canonical.z)*ie.wrap,ie.canonical.y),ve=new s.P(he.canonical.x+(1<<he.canonical.z)*he.wrap,he.canonical.y),be=ee.mult(1<<ie.canonical.z);return be.x-=.5,be.y-=.5,be.distSqr(ye)-be.distSqr(ve)})})(S,this.painter);const E=this.proxyToSource||{};this.proxyToSource={},S.forEach($=>{this.proxyToSource[$.key]={}}),this.terrainTileForTile={};const I=this._style._mergedSourceCaches;for(const $ in I){const Y=I[$];if(!Y.used||(Y!==this.sourceCache&&this.resetTileLookupCache(Y.id),this._setupProxiedCoordsForOrtho(Y,l[$],E),Y.usedForTerrain))continue;const X=l[$];Y.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[h.id]=S.map($=>new Fd($,$.key,this.orthoMatrix)),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1;const G={};this._visibleDemTiles=[];for(const $ of this.proxyCoords){const Y=this.terrainTileForTile[$.key];if(!Y)continue;const X=Y.tileID.key;X in G||(this._visibleDemTiles.push(Y),G[X]=X)}}_assignTerrainTiles(l){this._initializing||l.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,h=l.gl;for(const y in this.terrainTileForTile){const S=this.terrainTileForTile[y],E=S.dem;!E||S.demTexture&&!S.needsDEMTextureUpload||(l.activeTexture.set(h.TEXTURE1),_h(this.painter,S,E))}}_prepareDemTileUniforms(l,h,y,S){if(!h||h.demTexture==null)return!1;const E=l.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-E.z),G=S||"";return y[`u_dem_tl${G}`]=[E.x*I%1,E.y*I%1],y[`u_dem_scale${G}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const h=this._visibleDemTiles.reduce((y,S)=>{if(!S.dem)return y;const E=S.dem.tree.minimums[0];return E>0&&l++,y+E},0);return l?h/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,h=l.gl;l.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),S=new s.cF({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(S,{premultiply:!1}):E=this._emptyDEMTexture=new s.T(l,S,h.R32F,{premultiply:!1}),E}setupElevationDraw(l,h,y){const S=this.painter.context,E=S.gl,I={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};I.u_exaggeration=this.exaggeration();let G=null,$=null,Y=1;if(y&&y.morphing&&this._useVertexMorphing){const he=y.morphing.srcDemTile,ye=y.morphing.dstDemTile;Y=y.morphing.phase,he&&ye&&(this._prepareDemTileUniforms(l,he,I,"_prev")&&($=he),this._prepareDemTileUniforms(l,ye,I)&&(G=ye))}const X=he=>he&&he.demTexture&&this.painter.linearFloatFilteringSupported()?E.LINEAR:E.NEAREST;let ee=null;var ie;if(this.enabled?$&&G?(ee=G.demTexture,S.activeTexture.set(E.TEXTURE4),$.demTexture.bind(X($),E.CLAMP_TO_EDGE),I.u_dem_lerp=Y):(G=this.terrainTileForTile[l.tileID.key],ee=this._prepareDemTileUniforms(l,G,I)?G.demTexture:this.emptyDEMTexture):ee=this.emptyDEMTexture,S.activeTexture.set(E.TEXTURE2),ee&&(I.u_dem_size=(ie=ee).size[0]===1?1:ie.size[0]-2,ee.bind(X(G),E.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,h,I),y&&y.useMeterToDem&&G){const he=(1<<G.tileID.canonical.z)*s.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=he}if(y&&y.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(S,I),this.painter.transform.projection.name==="globe"){const he=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(S,he)}}globeUniformValues(l,h,y){const S=l.projection;return{u_tile_tl_up:S.upVector(h,0,0),u_tile_tr_up:S.upVector(h,s.ab,0),u_tile_br_up:S.upVector(h,s.ab,s.ab),u_tile_bl_up:S.upVector(h,0,s.ab),u_tile_up_scale:y?s.cG(1):S.upVectorScale(h,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const h=this.painter,y=this.painter.context;l.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(S,E,I,G,$){if(S.transform.projection.name==="globe")(function(Y,X,ee,ie,he){const ye=Y.context,ve=ye.gl;let be,Ce;const Fe=Y.transform,ze=s.cx(Y,ye,Fe),Ue=(Nt,qt)=>{if(Ce===qt)return;const ln=[Uv[qt],"PROJECTION_GLOBE_VIEW"];ze&&ln.push("CUSTOM_ANTIALIASING");const _n=Y.isTileAffectedByFog(Nt);be=Y.getOrCreateProgram("globeRaster",{defines:ln,overrideFog:_n}),Ce=qt},Ze=Y.colorModeForRenderPass(),Ke=new ii(ve.LEQUAL,ii.ReadWrite,Y.depthRangeFor3D);Sh.update(he);const Xe=s.cy(Fe),Je=[s.am(Fe.center.lng),s.at(Fe.center.lat)],ot=Y.globeSharedBuffers,mt=[Fe.width*s.q.devicePixelRatio,Fe.height*s.q.devicePixelRatio],lt=Float32Array.from(Fe.globeMatrix),at={useDenormalizedUpVectorScale:!0};{const Nt=Y.transform,qt=Vv(Nt.zoom,X.exaggeration(),X.sourceCache._source.tileSize);Ce=-1;const ln=ve.TRIANGLES;for(const _n of ie){const En=ee.getTile(_n),Ct=_i.disabled,on=X.prevTerrainTileForTile[_n.key],Vt=X.terrainTileForTile[_n.key];zv(on,Vt)&&Sh.newMorphing(_n.key,on,Vt,he,250),ye.activeTexture.set(ve.TEXTURE0),En.texture&&En.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);const an=Sh.getMorphValuesForProxy(_n.key),un=an?1:0;an&&s.C(at,{morphing:{srcDemTile:an.from,dstDemTile:an.to,phase:s.cw(an.phase)}});const sn=s.cz(_n.canonical),Pn=s.cA(sn.getCenter().lat),Qn=s.cB(_n.canonical,sn,Pn,Nt.worldSize/Nt._pixelsPerMercatorPixel),ri=s.b6(s.cC(_n.canonical)),jn=Q_(Nt.expandedFarZProjMatrix,lt,Xe,ri,s.a9(Nt.zoom),Je,Nt.frustumCorners.TL,Nt.frustumCorners.TR,Nt.frustumCorners.BR,Nt.frustumCorners.BL,Nt.globeCenterInViewSpace,Nt.globeRadius,mt,qt,Nt._farZ,Qn);if(Ue(_n,un),be&&(X.setupElevationDraw(En,be,at),Y.uploadCommonUniforms(ye,be,_n.toUnwrapped()),ot)){const[li,On,xi]=ot.getGridBuffers(Pn,qt!==0);be.draw(Y,ln,Ke,Ct,Ze,yi.backCCW,jn,"globe_raster",li,On,xi)}}}if(ot&&(Y.renderDefaultNorthPole||Y.renderDefaultSouthPole)){const Nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ze&&Nt.push("CUSTOM_ANTIALIASING"),be=Y.getOrCreateProgram("globeRaster",{defines:Nt});for(const qt of ie){const{x:ln,y:_n,z:En}=qt.canonical,Ct=_n===0,on=_n===(1<<En)-1,[Vt,an,un,sn]=ot.getPoleBuffers(En,!1);if(sn&&(Ct||on)){const Pn=ee.getTile(qt);ye.activeTexture.set(ve.TEXTURE0),Pn.texture&&Pn.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);let Qn=s.cD(En,ln,Fe);const ri=s.b6(s.cC(qt.canonical)),jn=(li,On)=>li.draw(Y,ve.TRIANGLES,Ke,_i.disabled,Ze,yi.disabled,Q_(Fe.expandedFarZProjMatrix,Qn,Qn,ri,0,Je,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,mt,0,Fe._farZ),"globe_pole_raster",On,un,sn);X.setupElevationDraw(Pn,be,at),Y.uploadCommonUniforms(ye,be,qt.toUnwrapped()),Ct&&Y.renderDefaultNorthPole&&jn(be,Vt),on&&Y.renderDefaultSouthPole&&(Qn=s.a6.mat4.scale(s.a6.mat4.create(),Qn,[1,-1,1]),jn(be,an))}}}})(S,E,I,G,$);else{const Y=S.context,X=Y.gl;let ee,ie;const he=S.shadowRenderer,ye=fc(S,S.longestCutoffRange),ve=Ze=>{if(ie===Ze)return;const Ke=[];Ke.push(Uv[Ze]),ye.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),he&&(Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&Ke.push("NORMAL_OFFSET")),ee=S.getOrCreateProgram("terrainRaster",{defines:Ke}),ie=Ze},be=S.colorModeForRenderPass(),Ce=new ii(X.LEQUAL,ii.ReadWrite,S.depthRangeFor3D);Sh.update($);const Fe=S.transform,ze=Vv(Fe.zoom,E.exaggeration(),E.sourceCache._source.tileSize);let Ue=[0,0,0];if(he){const Ze=S.style.directionalLight,Ke=S.style.ambientLight;Ze&&Ke&&(Ue=Ru(S.style,Ze,Ke))}{ie=-1;const Ze=X.TRIANGLES,[Ke,Xe]=[E.gridIndexBuffer,E.gridSegments];for(const Je of G){const ot=I.getTile(Je),mt=_i.disabled,lt=E.prevTerrainTileForTile[Je.key],at=E.terrainTileForTile[Je.key];zv(lt,at)&&Sh.newMorphing(Je.key,lt,at,$,250),Y.activeTexture.set(X.TEXTURE0),ot.texture&&ot.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Nt=Sh.getMorphValuesForProxy(Je.key),qt=Nt?1:0;let ln;Nt&&(ln={morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:s.cw(Nt.phase)}});const _n=Bv(Je.projMatrix,Dm(Je.canonical,Fe.renderWorldCopies)?ze/10:ze,Ue);if(ve(qt),!ee)continue;E.setupElevationDraw(ot,ee,ln);const En=Je.toUnwrapped();he&&he.setupShadows(En,ee),S.uploadCommonUniforms(Y,ee,En,null,ye),ee.draw(S,Ze,Ce,mt,be,yi.backCCW,_n,"terrain_raster",E.gridBuffer,Ke,Xe)}}}}(h,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,S=this.proxySourceCache,E=this.proxiedCoords[S.id],I=this._drapedRenderBatches.shift(),G=h.style.order,$=[];let Y=0;for(const X of E){const ee=S.getTileByID(X.proxyTileKey),ie=S.proxyCachedFBO[X.key]?S.proxyCachedFBO[X.key][l]:void 0,he=ie!==void 0?S.renderCache[ie]:this.pool[Y++],ye=ie!==void 0;if(ee.texture=he.tex,ye&&!he.dirty){$.push(ee.tileID);continue}let ve;y.bindFramebuffer.set(he.fb.framebuffer),this.renderedToTile=!1,he.dirty&&(y.clear({color:s.bA.transparent,stencil:0}),he.dirty=!1);for(let be=I.start;be<=I.end;++be){const Ce=h.style._mergedLayers[G[be]];if(Ce.isHidden(h.transform.zoom))continue;const Fe=h.style.getLayerSourceCache(Ce),ze=Fe?this.proxyToSource[X.key][Fe.id]:[X];if(!ze)continue;const Ue=ze;y.viewport.set([0,0,he.fb.width,he.fb.height]),ve!==(Fe?Fe.id:null)&&(this._setupStencil(he,ze,Ce,Fe),ve=Fe?Fe.id:null),h.renderLayer(h,Fe,Ce,Ue)}if(this._drapedRenderBatches.length===0)for(const be of this._pendingGroundEffectLayers){const Ce=h.style._mergedLayers[G[be]];if(Ce.isHidden(h.transform.zoom))continue;const Fe=h.style.getLayerSourceCache(Ce),ze=Fe?this.proxyToSource[X.key][Fe.id]:[X];if(!ze)continue;const Ue=ze;y.viewport.set([0,0,he.fb.width,he.fb.height]),ve!==(Fe?Fe.id:null)&&(this._setupStencil(he,ze,Ce,Fe),ve=Fe?Fe.id:null),h.renderLayer(h,Fe,Ce,Ue)}this.renderedToTile?(he.dirty=!0,$.push(ee.tileID)):ye||--Y,Y===5&&(Y=0,this.renderToBackBuffer($))}return this.renderToBackBuffer($),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}isLayerOrderingCorrect(l){const h=l.order.length;let y=-1,S=h;for(let E=0;E<h;++E)this._style.isLayerDraped(l._mergedLayers[l.order[E]])?y=Math.max(y,E):S=Math.min(S,E);return S>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{l=Math.min(l,h.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,h,y){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,G=1<<I.overscaledZ,{x:$,y:Y}=I.canonical,X=$/G,ee=($+1)/G,ie=Y/G,he=(Y+1)/G;return{minx:X,miny:ie,maxx:ee,maxy:he,t:E.dem.tree.raycastRoot(X,ie,ee,he,l,h,y),tile:E}});S.sort((E,I)=>(E.t!==null?E.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const E of S){if(E.t==null)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,l,h,y);if(I!=null)return I}return null}_createFBO(){const l=this.painter.context,h=l.gl,y=this.drapeBufferSize;l.activeTexture.set(h.TEXTURE0);const S=new s.T(l,{width:y[0],height:y[1],data:null},h.RGBA8);S.bind(h.LINEAR,h.CLAMP_TO_EDGE);const E=l.createFramebuffer(y[0],y[1],!0,null);return E.colorAttachment.set(S.texture),E.depthAttachment=new Pu(l,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:E,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const h=this._style._mergedLayers[l],y=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof Si){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const S=this._style._mergedLayers[this._style.order[y]],E=this._style.getLayerSourceCache(S);if(E&&!h[E.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof s.a4){h[E.id]=!0;for(const I of this.proxyCoords){const G=this.proxyToSource[I.key][E.id];if(G)for(const $ of G)this._clearRenderCacheForTile(E.id,$)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Wi){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const S=this._style._mergedLayers[this._style.order[y]],E=this._style.getLayerSourceCache(S);if(!E||h[E.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const I=S.paint.get("raster-fade-duration");for(const G of this.proxyCoords){const $=this.proxyToSource[G.key][E.id];if($)for(const Y of $){const X=Jf(E.getTile(Y),E.findLoadedParent(Y,0),E,this.painter.transform,I);(X.opacity!==1||X.mix!==0)&&this._clearRenderCacheForTile(E.id,Y)}}}}_setupDrapedRenderBatches(){const l=this._style.order,h=l.length;if(h===0)return;const y=[];this._pendingGroundEffectLayers=[];let S,E=0,I=this._style._mergedLayers[l[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<h;)I=this._style._mergedLayers[l[E]];for(;E<h;++E){const G=this._style._mergedLayers[l[E]];G.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(G)?S===void 0&&(S=E):(G.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(E),S!==void 0&&(y.push({start:S,end:E-1}),S=void 0)))}if(S!==void 0&&y.push({start:S,end:E-1}),y.length!==0){const G=y[y.length-1];this._pendingGroundEffectLayers.every($=>$>G.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let G=0;G<I.length;++G){const $=Object.values(I[G]);h.renderCachePool.push(...$)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,S=this._tilesDirty;for(let I=y.length-1;I>=0;I--){const G=y[I];if(h.getTileByID(G.key),h.proxyCachedFBO[G.key]!==void 0){const $=l[G.key],Y=this.proxyToSource[G.key];let X=0;for(const ee in Y){const ie=Y[ee],he=$[ee];if(!he||he.length!==ie.length||ie.some((ye,ve)=>ye!==he[ve]||S[ee]&&S[ee].hasOwnProperty(ye.key))){X=-1;break}++X}for(const ee in h.proxyCachedFBO[G.key])h.renderCache[h.proxyCachedFBO[G.key][ee]].dirty=X<0||X!==Object.values($).length}}const E=[...this._drapedRenderBatches];E.sort((I,G)=>G.end-G.start-(I.end-I.start));for(const I of E)for(const G of y){if(h.proxyCachedFBO[G.key])continue;let $=h.renderCachePool.pop();$===void 0&&h.renderCache.length<50&&($=h.renderCache.length,h.renderCache.push(this._createFBO())),$!==void 0&&(h.proxyCachedFBO[G.key]={},h.proxyCachedFBO[G.key][I.start]=$,h.renderCache[$].dirty=!0)}this._tilesDirty={}}_setupStencil(l,h,y,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let G;if(y.isTileClipped())G=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);G=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+G>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=G,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):_i.disabled}_renderTileClippingMasks(l,h){const y=this.painter,S=this.painter.context,E=S.gl;y._tileClippingMaskIDs={},S.setColorMode(Vi.disabled),S.setDepthMode(ii.disabled);const I=y.getOrCreateProgram("clippingMask");for(const G of l){const $=y._tileClippingMaskIDs[G.key]=--h;I.draw(y,E.TRIANGLES,ii.disabled,new _i({func:E.ALWAYS,mask:0},$,255,E.KEEP,E.KEEP,E.REPLACE),Vi.disabled,yi.disabled,La(G.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const h=this.painter.transform;if(l.x<0||l.x>h.width||l.y<0||l.y>h.height)return null;const y=[l.x,l.y,1,1];s.a6.vec4.transformMat4(y,y,h.pixelMatrixInverse),s.a6.vec4.scale(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const S=h._camera.position,E=s.bE(1,h.center.lat),I=[S[0],S[1],S[2]/E,0],G=s.a6.vec3.subtract([],y.slice(0,3),I);s.a6.vec3.normalize(G,G);const $=this.raycast(I,G,this._exaggeration);return $!==null&&$?(s.a6.vec3.scaleAndAdd(I,I,G,$),I[3]=I[2],I[2]*=E,I):null}_setupProxiedCoordsForOrtho(l,h,y){if(l.getSource()instanceof s.aD)return this._setupProxiedCoordsForImageSource(l,h,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const S=this.proxiedCoords[l.id]=[],E=this.proxyCoords;for(let $=0;$<E.length;$++){const Y=E[$],X=this._findTileCoveringTileID(Y,l);if(X){const ee=this._createProxiedId(Y,X,y[Y.key]&&y[Y.key][l.id]);S.push(ee),this.proxyToSource[Y.key][l.id]=[ee]}}let I=!1;const G=new Set;for(let $=0;$<h.length;$++){const Y=l.getTile(h[$]);if(!Y||!Y.hasData())continue;const X=this._findTileCoveringTileID(Y.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==Y.tileID.canonical.z){const ee=this.proxyToSource[X.tileID.key][l.id],ie=this._createProxiedId(X.tileID,Y,y[X.tileID.key]&&y[X.tileID.key][l.id]);ee?ee.splice(ee.length-1,0,ie):this.proxyToSource[X.tileID.key][l.id]=[ie];const he=this.proxyToSource[X.tileID.key][l.id];G.has(he)||G.add(he),S.push(ie),I=!0}}if(this._sourceTilesOverlap[l.id]=I,I&&this._debugParams.sortTilesHiZFirst)for(const $ of G)$.sort((Y,X)=>X.overscaledZ-Y.overscaledZ)}_setupProxiedCoordsForImageSource(l,h,y){if(!l.getSource().loaded())return;const S=this.proxiedCoords[l.id]=[],E=this.proxyCoords,I=l.getSource(),G=I.tileID;if(!G)return;const $=new s.P(G.x,G.y)._div(1<<G.z),Y=I.coordinates.map(s.a5.fromLngLat).reduce((ee,ie)=>(ee.min.x=Math.min(ee.min.x,ie.x-$.x),ee.min.y=Math.min(ee.min.y,ie.y-$.y),ee.max.x=Math.max(ee.max.x,ie.x-$.x),ee.max.y=Math.max(ee.max.y,ie.y-$.y),ee),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(ee,ie)=>{const he=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),ye=ee.canonical.y/(1<<ee.canonical.z),ve=s.ab/(1<<ee.canonical.z),be=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),Ce=ie.canonical.y/(1<<ie.canonical.z);return he+ve<be+Y.min.x||he>be+Y.max.x||ye+ve<Ce+Y.min.y||ye>Ce+Y.max.y};for(let ee=0;ee<E.length;ee++){const ie=E[ee];for(let he=0;he<h.length;he++){const ye=l.getTile(h[he]);if(!ye||!ye.hasData()||X(ie,ye.tileID))continue;const ve=this._createProxiedId(ie,ye,y[ie.key]&&y[ie.key][l.id]),be=this.proxyToSource[ie.key][l.id];be?be.push(ve):this.proxyToSource[ie.key][l.id]=[ve],S.push(ve)}}}_createProxiedId(l,h,y){let S=this.orthoMatrix;if(y){const E=y.find(I=>I.key===h.tileID.key);if(E)return E}if(h.tileID.key!==l.key){const E=l.canonical.z-h.tileID.canonical.z;let I,G,$;S=s.a6.mat4.create();const Y=h.tileID.wrap-l.wrap<<l.overscaledZ;E>0?(I=s.ab>>E,G=I*((h.tileID.canonical.x<<E)-l.canonical.x+Y),$=I*((h.tileID.canonical.y<<E)-l.canonical.y)):(I=s.ab<<-E,G=s.ab*(h.tileID.canonical.x-(l.canonical.x+Y<<-E)),$=s.ab*(h.tileID.canonical.y-(l.canonical.y<<-E))),s.a6.mat4.ortho(S,0,I,0,I,0,1),s.a6.mat4.translate(S,S,[G,$,0])}return new Fd(h.tileID,l.key,S)}_findTileCoveringTileID(l,h){let y=h.getTile(l);if(y&&y.hasData())return y;const S=this._findCoveringTileCache[h.id],E=S[l.key];if(y=E?h.getTileByID(E):null,y&&y.hasData()||E===null)return y;let I=y?y.tileID:l,G=I.overscaledZ;const $=h.getSource().minzoom,Y=[];if(!E){const ee=h.getSource().maxzoom;if(l.canonical.z>=ee){const ie=l.canonical.z-ee;h.getSource().reparseOverscaled?(G=Math.max(l.canonical.z+2,h.transform.tileZoom),I=new s.aA(G,l.wrap,ee,l.canonical.x>>ie,l.canonical.y>>ie)):ie!==0&&(G=ee,I=new s.aA(G,l.wrap,ee,l.canonical.x>>ie,l.canonical.y>>ie))}I.key!==l.key&&(Y.push(I.key),y=h.getTile(I))}const X=ee=>{Y.forEach(ie=>{S[ie]=ee}),Y.length=0};for(G-=1;G>=$&&(!y||!y.hasData());G--){y&&X(y.tileID.key);const ee=I.calculateScaledKey(G);if(y=h.getTileByID(ee),y&&y.hasData())break;const ie=S[ee];if(ie===null)break;ie===void 0?Y.push(ee):y=h.getTileByID(ie)}return X(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,h){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[h.key]=!0}}function Fm(g,l,h){const y=function(G,$,Y){const X=s.a6.vec3.dot($,G),ee=s.a6.vec3.dot(Y,[.2126,.7152,.0722]),ie=(ye,ve,be)=>(1-be)*ye+be*ve,he=ie(1-.3*Math.min(ee,1),1,Math.min(X+1,1));return ie(.92,1,Math.asin(s.ap($[2],-1,1))/Math.PI+.5)*he}(g,[0,0,1],l),S=[0,0,0];s.a6.vec3.scale(S,h.slice(0,3),y);const E=[0,0,0];s.a6.vec3.scale(E,l.slice(0,3),g[2]);const I=[0,0,0];return s.a6.vec3.add(I,S,E),s.cc(I)}const Ll=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ta=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Jc{static cacheKey(l,h,y,S){let E=`${h}${S?S.cacheKey:""}`;for(const I of y)l.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(l,h,y,S,E,I){const G=l.gl;this.program=G.createProgram(),this.configuration=S,this.name=h,this.fixedDefines=[...I];const $=S?S.getBinderAttributes():[],Y=(y.staticAttributes||[]).concat($);let X=S?S.defines():[];X=X.concat(I.map(be=>`#define ${be}`));const ee=`#version 300 es
`;let ie=ee+X.concat("precision mediump float;",vh,Zs.fragmentSource).join(`
`);for(const be of y.fragmentIncludes)ie+=`
${Fs[be]}`;ie+=`
${y.fragmentSource}`;let he=ee+X.concat("precision highp float;",vh,Zs.vertexSource).join(`
`);for(const be of y.vertexIncludes)he+=`
${Fs[be]}`;he+=`
${y.vertexSource}`;const ye=G.createShader(G.FRAGMENT_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);G.shaderSource(ye,ie),G.compileShader(ye),G.attachShader(this.program,ye);const ve=G.createShader(G.VERTEX_SHADER);if(G.isContextLost())this.failedToCreate=!0;else{G.shaderSource(ve,he),G.compileShader(ve),G.attachShader(this.program,ve),this.attributes={},this.numAttributes=Y.length;for(let be=0;be<this.numAttributes;be++)if(Y[be]){const Ce=Y[be].startsWith("a_")?Y[be]:`a_${Y[be]}`;G.bindAttribLocation(this.program,be,Ce),this.attributes[Ce]=be}G.linkProgram(this.program),G.deleteShader(ve),G.deleteShader(ye),this.fixedUniforms=E(l),this.binderUniforms=S?S.getUniforms(l):[],(I.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(be=>({u_dem:new s.bK(be),u_dem_prev:new s.bK(be),u_dem_tl:new s.bH(be),u_dem_scale:new s.bJ(be),u_dem_tl_prev:new s.bH(be),u_dem_scale_prev:new s.bJ(be),u_dem_size:new s.bJ(be),u_dem_lerp:new s.bJ(be),u_exaggeration:new s.bJ(be),u_depth:new s.bK(be),u_depth_size_inv:new s.bH(be),u_depth_range_unpack:new s.bH(be),u_occluder_half_size:new s.bJ(be),u_occlusion_depth_offset:new s.bJ(be),u_meter_to_dem:new s.bJ(be),u_label_plane_matrix_inv:new s.bG(be)}))(l)),I.includes("GLOBE")&&(this.globeUniforms=(be=>({u_tile_tl_up:new s.bI(be),u_tile_tr_up:new s.bI(be),u_tile_br_up:new s.bI(be),u_tile_bl_up:new s.bI(be),u_tile_up_scale:new s.bJ(be)}))(l)),I.includes("FOG")&&(this.fogUniforms=(be=>({u_fog_matrix:new s.bG(be),u_fog_range:new s.bH(be),u_fog_color:new s.c7(be),u_fog_horizon_blend:new s.bJ(be),u_fog_vertical_limit:new s.bH(be),u_fog_temporal_offset:new s.bJ(be),u_frustum_tl:new s.bI(be),u_frustum_tr:new s.bI(be),u_frustum_br:new s.bI(be),u_frustum_bl:new s.bI(be),u_globe_pos:new s.bI(be),u_globe_radius:new s.bJ(be),u_globe_transition:new s.bJ(be),u_is_globe:new s.bK(be),u_viewport:new s.bH(be)}))(l)),I.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(be=>({u_cutoff_params:new s.c7(be)}))(l)),I.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(be=>({u_lighting_ambient_color:new s.bI(be),u_lighting_directional_dir:new s.bI(be),u_lighting_directional_color:new s.bI(be),u_ground_radiance:new s.bI(be)}))(l)),I.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(be=>({u_light_matrix_0:new s.bG(be),u_light_matrix_1:new s.bG(be),u_fade_range:new s.bH(be),u_shadow_normal_offset:new s.bI(be),u_shadow_intensity:new s.bJ(be),u_shadow_texel_size:new s.bJ(be),u_shadow_map_resolution:new s.bJ(be),u_shadow_direction:new s.bI(be),u_shadow_bias:new s.bI(be),u_shadowmap_0:new s.bK(be),u_shadowmap_1:new s.bK(be)}))(l))}}setTerrainUniformValues(l,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const S in h)y[S]&&y[S].set(this.program,S,h[S])}}setGlobeUniformValues(l,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const S in h)y[S]&&y[S].set(this.program,S,h[S])}}setFogUniformValues(l,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const S in h)y[S].set(this.program,S,h[S])}}setCutoffUniformValues(l,h){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const S in h)y[S].set(this.program,S,h[S])}}setLightsUniformValues(l,h){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const S in h)y[S].set(this.program,S,h[S])}}setShadowUniformValues(l,h){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const S in h)y[S].set(this.program,S,h[S])}_drawDebugWireframe(l,h,y,S,E,I,G,$,Y,X){const ee=l.options.wireframe;if(ee.terrain===!1&&ee.layers2D===!1&&ee.layers3D===!1)return;const ie=l.context;if(!(!(!ee.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ee.layers2D||l._terrain&&l._terrain.renderingToTexture||!Ll.includes(this.name))||!(!ee.layers3D||!ta.includes(this.name))))return;const he=ie.gl,ye=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,E,ie);if(!ye)return;const ve=[...this.fixedDefines];ve.push("DEBUG_WIREFRAME");const be=l.getOrCreateProgram(this.name,{config:this.configuration,defines:ve});ie.program.set(be.program);const Ce=(Ue,Ze,Ke)=>{if(Ze[Ue]&&Ke[Ue])for(const Xe in Ze[Ue])Ke[Ue][Xe]&&Ke[Ue][Xe].set(Ke.program,Xe,Ze[Ue][Xe].current)};Y&&Y.setUniforms(be.program,ie,be.binderUniforms,G,{zoom:$}),Ce("fixedUniforms",this,be),Ce("terrainUniforms",this,be),Ce("globeUniforms",this,be),Ce("fogUniforms",this,be),Ce("lightsUniforms",this,be),Ce("shadowUniforms",this,be),ye.bind(),ie.setColorMode(new Vi([he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ZERO,he.ONE],s.bA.transparent,[!0,!0,!0,!1])),ie.setDepthMode(new ii(h.func===he.LESS?he.LEQUAL:h.func,ii.ReadOnly,h.range)),ie.setStencilMode(_i.disabled);const Fe=3*I.primitiveLength*2,ze=3*I.primitiveOffset*2*2;X&&X>1?he.drawElementsInstanced(he.LINES,Fe,he.UNSIGNED_SHORT,ze,X):he.drawElements(he.LINES,Fe,he.UNSIGNED_SHORT,ze),E.bind(),ie.program.set(this.program),ie.setDepthMode(h),ie.setStencilMode(y),ie.setColorMode(S)}checkUniforms(l,h,y){if(this.fixedDefines.includes(h)){for(const S of Object.keys(y))if(!y[S].initialized)throw new Error(`Program '${this.name}', from draw '${l}': uniform ${S} not set but required by ${h} being defined`)}}draw(l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be){const Ce=l.context,Fe=Ce.gl;if(this.failedToCreate)return;Ce.program.set(this.program),Ce.setDepthMode(y),Ce.setStencilMode(S),Ce.setColorMode(E),Ce.setCullFace(I);for(const Ze of Object.keys(this.fixedUniforms))this.fixedUniforms[Ze].set(this.program,Ze,G[Ze]);ye&&ye.setUniforms(this.program,Ce,this.binderUniforms,ie,{zoom:he});const ze={[Fe.POINTS]:1,[Fe.LINES]:2,[Fe.TRIANGLES]:3,[Fe.LINE_STRIP]:1}[h];this.checkUniforms($,"RENDER_SHADOWS",this.shadowUniforms);const Ue=be&&be>0?1:void 0;for(const Ze of ee.get()){const Ke=Ze.vaos||(Ze.vaos={});(Ke[$]||(Ke[$]=new no)).bind(Ce,this,Y,ye?ye.getPaintVertexBuffers():[],X,Ze.vertexOffset,ve||[],Ue),be&&be>1?Fe.drawElementsInstanced(h,Ze.primitiveLength*ze,Fe.UNSIGNED_SHORT,Ze.primitiveOffset*ze*2,be):X?Fe.drawElements(h,Ze.primitiveLength*ze,Fe.UNSIGNED_SHORT,Ze.primitiveOffset*ze*2):Fe.drawArrays(h,Ze.vertexOffset,Ze.vertexLength),h===Fe.TRIANGLES&&X&&this._drawDebugWireframe(l,y,S,E,X,Ze,ie,he,ye,be)}}}function Lm(g,l){const h=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/h,S=y*(l.tileID.canonical.x+l.tileID.wrap*h),E=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ak(l,1,g.transform.tileZoom),u_pixel_coord_upper:[S>>16,E>>16],u_pixel_coord_lower:[65535&S,65535&E]}}const So={terrain:0,flat:1},fa=s.a6.mat4.create(),Om=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce)=>{const Fe=l.style.light,ze=Fe.properties.get("position"),Ue=[ze.x,ze.y,ze.z],Ze=s.a6.mat3.create();Fe.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(Ze,-l.transform.angle),s.a6.vec3.transformMat3(Ue,Ue,Ze));const Ke=Fe.properties.get("color"),Xe=l.transform,Je={u_matrix:g,u_lightpos:Ue,u_lightintensity:Fe.properties.get("intensity"),u_lightcolor:[Ke.r,Ke.g,Ke.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fa,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:So[Y],u_base_type:So[X],u_ao:S,u_edge_radius:E,u_width_scale:I,u_flood_light_color:ye,u_vertical_scale:ve,u_flood_light_intensity:be,u_ground_shadow_factor:Ce};return Xe.projection.name==="globe"&&(Je.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],Je.u_zoom_transition=ee,Je.u_inv_rot_matrix=he,Je.u_merc_center=ie,Je.u_up_dir=Xe.projection.upVector(new s.bQ(0,0,0),ie[0]*s.ab,ie[1]*s.ab),Je.u_height_lift=$),Je},km=(g,l,h,y,S,E)=>({u_matrix:g,u_edge_radius:l,u_width_scale:h,u_vertical_scale:y,u_height_type:So[S],u_base_type:So[E]}),Nm=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be)=>{const Ce=Om(g,l,h,y,S,E,I,G,Y,X,ee,ie,he,ye,ve,be,1,[0,0,0]),Fe={u_height_factor:-Math.pow(2,G.overscaledZ)/$.tileSize/8};return s.l(Ce,Lm(l,$),Fe)},Gv=(g,l)=>({u_matrix:g,u_emissive_strength:l}),Bm=(g,l,h,y)=>s.l(Gv(g,l),Lm(h,y)),bh=(g,l,h)=>({u_matrix:g,u_world:h,u_emissive_strength:l}),e0=(g,l,h,y,S)=>s.l(Bm(g,l,h,y),{u_world:S}),Hv=(g,l,h,y)=>{const S=s.ab/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/S,l.pixelsToGLUnits[1]/S]}},zm=(g,l,h=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),t0=s.a6.mat4.create(),Od=(g,l,h,y,S,E,I)=>{const G=g.transform,$=G.projection.name==="globe",Y=$?s.cI(G.zoom,l.canonical)*G._pixelsPerMercatorPixel:s.ak(h,1,E),X={u_matrix:l.projMatrix,u_extrude_scale:Y,u_intensity:I,u_inv_rot_matrix:t0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if($){X.u_inv_rot_matrix=y,X.u_merc_center=S,X.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],X.u_zoom_transition=s.a9(G.zoom);const ee=S[0]*s.ab,ie=S[1]*s.ab;X.u_up_dir=G.projection.upVector(new s.bQ(0,0,0),ee,ie)}return X};function Eh(g,[l,h,y,S],[E,I]){if(E===I)return[0,0,0,0];const G=255*(g-1)/(g*(I-E));return[l*G,h*G,y*G,S*G]}function Mh(g,l,[h,y]){return h===y?0:.5/g+(l-h)*(g-1)/(g*(y-h))}const kd=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce,Fe,ze,Ue)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:S,u_tl_parent:E,u_scale_parent:Y,u_fade_t:X.mix,u_opacity:X.opacity*ee.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ee.paint.get("raster-brightness-min"),u_brightness_high:ee.paint.get("raster-brightness-max"),u_saturation_factor:s.cJ(ee.paint.get("raster-saturation")),u_contrast_factor:s.cK(ee.paint.get("raster-contrast")),u_spin_weights:Nd(ee.paint.get("raster-hue-rotate")),u_perspective_transform:ie,u_raster_elevation:he,u_zoom_transition:I,u_merc_center:G,u_cutoff_params:$,u_colorization_mix:Eh(s.cL,ve,Ce),u_colorization_offset:Mh(s.cL,be,Ce),u_color_ramp:ye,u_texture_offset:[ze/(Fe+2*ze),Fe/(Fe+2*ze)],u_texture_res:[Fe+2*ze,Fe+2*ze],u_emissive_strength:Ue});function Nd(g){g*=Math.PI/180;const l=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const Iu=.05,Rh=(g,l,h,y,S,E,I,G,$,Y,X,ee)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:S,u_tl_parent:E,u_scale_parent:Y,u_fade_t:X.mix,u_opacity:X.opacity,u_image0:0,u_image1:1,u_raster_elevation:ee,u_zoom_transition:I,u_merc_center:G,u_cutoff_params:$}),Qf=(g,l,h,y,S,E,I,G,$,Y)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:h,u_velocity:y,u_color_ramp:E,u_velocity_res:S,u_max_speed:I,u_uv_offset:G,u_data_scale:[255*$[0],255*$[1]],u_data_offset:Y,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),ep=(g,l,h,y,S,E,I,G,$,Y)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:h,u_velocity_res:y,u_max_speed:S,u_speed_factor:E,u_reset_rate:I,u_rand_seed:Math.random(),u_uv_offset:G,u_data_scale:[255*$[0],255*$[1]],u_data_offset:Y,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),Um=s.a6.mat4.create(),vc=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce,Fe,ze,Ue,Ze)=>{const Ke=S.transform,Xe={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Ke.getCameraToCenterDistance(Fe),u_rotate_symbol:+h,u_aspect_ratio:Ke.width/Ke.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:G,u_is_text:+Y,u_elevation_from_sea:$?1:0,u_pitch_with_map:+y,u_texsize:X,u_texsize_icon:ee,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Um,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Um,u_up_vector:[0,-1,0],u_color_adj_mat:ze,u_icon_transition:Ue||0,u_gamma_scale:y?S.transform.getCameraToCenterDistance(Fe)*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+ie,u_scale_factor:Ze||1};return Fe.name==="globe"&&(Xe.u_tile_id=[he.canonical.x,he.canonical.y,1<<he.canonical.z],Xe.u_zoom_transition=ye,Xe.u_inv_rot_matrix=be,Xe.u_merc_center=ve,Xe.u_camera_forward=Ke._camera.forward(),Xe.u_ecef_origin=s.cM(Ke.globeMatrix,he.toUnwrapped()),Xe.u_tile_matrix=Float32Array.from(Ke.globeMatrix),Xe.u_up_vector=Ce),Xe},Th=(g,l,h,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:h,u_color:y}),tp=(g,l,h,y,S,E,I,G,$)=>s.l(function(Y,X,ee,ie,he,ye){const{width:ve,height:be}=ie.imageManager.getPixelSize(X),Ce=Math.pow(2,ye.tileID.overscaledZ),Fe=ye.tileSize*Math.pow(2,ie.transform.tileZoom)/Ce,ze=Fe*(ye.tileID.canonical.x+ye.tileID.wrap*Ce),Ue=Fe*ye.tileID.canonical.y;return{u_image:0,u_pattern_tl:ee.tl,u_pattern_br:ee.br,u_texsize:[ve,be],u_pattern_size:ee.displaySize,u_pattern_units_to_pixels:he?[ie.transform.width,-1*ie.transform.height]:[1/s.ak(ye,1,ie.transform.tileZoom),1/s.ak(ye,1,ie.transform.tileZoom)],u_pixel_coord_upper:[ze>>16,Ue>>16],u_pixel_coord_lower:[65535&ze,65535&Ue]}}(0,E,I,y,G,$),{u_matrix:g,u_emissive_strength:l,u_opacity:h}),Un=new Float32Array(s.a6.mat4.identity([])),yc=(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he=[0,0,0],ye)=>{const ve=S.style.light,be=ve.properties.get("position"),Ce=[-be.x,-be.y,be.z],Fe=s.a6.mat3.create();ve.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(Fe,-S.transform.angle),s.a6.vec3.transformMat3(Ce,Ce,Fe));const ze=X.alphaMode==="MASK",Ue=ve.properties.get("color").toRenderColor(null),Ze=ie.paint.get("model-ambient-occlusion-intensity"),Ke=ie.paint.get("model-color").constantOr(s.bA.white).toRenderColor(null),Xe=ie.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:h,u_node_matrix:y||Un,u_lightpos:Ce,u_lightintensity:ve.properties.get("intensity"),u_lightcolor:[Ue.r,Ue.g,Ue.b],u_camera_pos:he,u_opacity:E,u_baseTextureIsAlpha:0,u_alphaMask:+ze,u_alphaCutoff:X.alphaCutoff,u_baseColorFactor:[I.r,I.g,I.b,I.a],u_emissiveFactor:[G[0],G[1],G[2],1],u_metallicFactor:$,u_roughnessFactor:Y,u_baseColorTexture:ps.BaseColor,u_metallicRoughnessTexture:ps.MetallicRoughness,u_normalTexture:ps.Normal,u_occlusionTexture:ps.Occlusion,u_emissionTexture:ps.Emission,u_lutTexture:ps.LUT,u_color_mix:[Ke.r,Ke.g,Ke.b,Xe],u_aoIntensity:Ze,u_emissive_strength:ee,u_occlusionTextureTransform:ye||[0,0,0,0]}},Wv=(g,l=Un,h=Un)=>({u_matrix:g,u_instance:l,u_node_matrix:h}),ci={fillExtrusion:g=>({u_matrix:new s.bG(g),u_lightpos:new s.bI(g),u_lightintensity:new s.bJ(g),u_lightcolor:new s.bI(g),u_vertical_gradient:new s.bJ(g),u_opacity:new s.bJ(g),u_edge_radius:new s.bJ(g),u_width_scale:new s.bJ(g),u_ao:new s.bH(g),u_height_type:new s.bK(g),u_base_type:new s.bK(g),u_tile_id:new s.bI(g),u_zoom_transition:new s.bJ(g),u_inv_rot_matrix:new s.bG(g),u_merc_center:new s.bH(g),u_up_dir:new s.bI(g),u_height_lift:new s.bJ(g),u_flood_light_color:new s.bI(g),u_vertical_scale:new s.bJ(g),u_flood_light_intensity:new s.bJ(g),u_ground_shadow_factor:new s.bI(g)}),fillExtrusionDepth:g=>({u_matrix:new s.bG(g),u_edge_radius:new s.bJ(g),u_width_scale:new s.bJ(g),u_vertical_scale:new s.bJ(g),u_height_type:new s.bK(g),u_base_type:new s.bK(g)}),fillExtrusionPattern:g=>({u_matrix:new s.bG(g),u_lightpos:new s.bI(g),u_lightintensity:new s.bJ(g),u_lightcolor:new s.bI(g),u_vertical_gradient:new s.bJ(g),u_height_factor:new s.bJ(g),u_edge_radius:new s.bJ(g),u_width_scale:new s.bJ(g),u_ao:new s.bH(g),u_height_type:new s.bK(g),u_base_type:new s.bK(g),u_tile_id:new s.bI(g),u_zoom_transition:new s.bJ(g),u_inv_rot_matrix:new s.bG(g),u_merc_center:new s.bH(g),u_up_dir:new s.bI(g),u_height_lift:new s.bJ(g),u_image:new s.bK(g),u_texsize:new s.bH(g),u_pixel_coord_upper:new s.bH(g),u_pixel_coord_lower:new s.bH(g),u_tile_units_to_pixels:new s.bJ(g),u_opacity:new s.bJ(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new s.bG(g),u_opacity:new s.bJ(g),u_ao_pass:new s.bJ(g),u_meter_to_tile:new s.bJ(g),u_ao:new s.bH(g),u_flood_light_intensity:new s.bJ(g),u_flood_light_color:new s.bI(g),u_attenuation:new s.bJ(g),u_edge_radius:new s.bJ(g),u_fb:new s.bK(g),u_fb_size:new s.bJ(g),u_dynamic_offset:new s.bJ(g)}),fill:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g)}),fillPattern:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g),u_image:new s.bK(g),u_texsize:new s.bH(g),u_pixel_coord_upper:new s.bH(g),u_pixel_coord_lower:new s.bH(g),u_tile_units_to_pixels:new s.bJ(g)}),fillOutline:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g),u_world:new s.bH(g)}),fillOutlinePattern:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g),u_world:new s.bH(g),u_image:new s.bK(g),u_texsize:new s.bH(g),u_pixel_coord_upper:new s.bH(g),u_pixel_coord_lower:new s.bH(g),u_tile_units_to_pixels:new s.bJ(g)}),circle:s.cN,collisionBox:g=>({u_matrix:new s.bG(g),u_camera_to_center_distance:new s.bJ(g),u_extrude_scale:new s.bH(g)}),collisionCircle:g=>({u_matrix:new s.bG(g),u_inv_matrix:new s.bG(g),u_camera_to_center_distance:new s.bJ(g),u_viewport_size:new s.bH(g)}),debug:g=>({u_color:new s.cu(g),u_matrix:new s.bG(g),u_overlay:new s.bK(g),u_overlay_scale:new s.bJ(g)}),clippingMask:g=>({u_matrix:new s.bG(g)}),heatmap:g=>({u_extrude_scale:new s.bJ(g),u_intensity:new s.bJ(g),u_matrix:new s.bG(g),u_inv_rot_matrix:new s.bG(g),u_merc_center:new s.bH(g),u_tile_id:new s.bI(g),u_zoom_transition:new s.bJ(g),u_up_dir:new s.bI(g)}),heatmapTexture:g=>({u_image:new s.bK(g),u_color_ramp:new s.bK(g),u_opacity:new s.bJ(g)}),hillshade:g=>({u_matrix:new s.bG(g),u_image:new s.bK(g),u_latrange:new s.bH(g),u_light:new s.bH(g),u_shadow:new s.cu(g),u_highlight:new s.cu(g),u_emissive_strength:new s.bJ(g),u_accent:new s.cu(g)}),hillshadePrepare:g=>({u_matrix:new s.bG(g),u_image:new s.bK(g),u_dimension:new s.bH(g),u_zoom:new s.bJ(g)}),line:s.cO,linePattern:s.cP,raster:g=>({u_matrix:new s.bG(g),u_normalize_matrix:new s.bG(g),u_globe_matrix:new s.bG(g),u_merc_matrix:new s.bG(g),u_grid_matrix:new s.cv(g),u_tl_parent:new s.bH(g),u_scale_parent:new s.bJ(g),u_fade_t:new s.bJ(g),u_opacity:new s.bJ(g),u_image0:new s.bK(g),u_image1:new s.bK(g),u_brightness_low:new s.bJ(g),u_brightness_high:new s.bJ(g),u_saturation_factor:new s.bJ(g),u_contrast_factor:new s.bJ(g),u_spin_weights:new s.bI(g),u_perspective_transform:new s.bH(g),u_raster_elevation:new s.bJ(g),u_zoom_transition:new s.bJ(g),u_merc_center:new s.bH(g),u_cutoff_params:new s.c7(g),u_colorization_mix:new s.c7(g),u_colorization_offset:new s.bJ(g),u_color_ramp:new s.bK(g),u_texture_offset:new s.bH(g),u_texture_res:new s.bH(g),u_emissive_strength:new s.bJ(g)}),rasterParticle:g=>({u_matrix:new s.bG(g),u_normalize_matrix:new s.bG(g),u_globe_matrix:new s.bG(g),u_merc_matrix:new s.bG(g),u_grid_matrix:new s.cv(g),u_tl_parent:new s.bH(g),u_scale_parent:new s.bJ(g),u_fade_t:new s.bJ(g),u_opacity:new s.bJ(g),u_image0:new s.bK(g),u_image1:new s.bK(g),u_raster_elevation:new s.bJ(g),u_zoom_transition:new s.bJ(g),u_merc_center:new s.bH(g),u_cutoff_params:new s.c7(g)}),rasterParticleTexture:g=>({u_texture:new s.bK(g),u_opacity:new s.bJ(g)}),rasterParticleDraw:g=>({u_particle_texture:new s.bK(g),u_particle_texture_side_len:new s.bJ(g),u_tile_offset:new s.bH(g),u_velocity:new s.bK(g),u_color_ramp:new s.bK(g),u_velocity_res:new s.bH(g),u_max_speed:new s.bJ(g),u_uv_offset:new s.bH(g),u_data_scale:new s.bH(g),u_data_offset:new s.bJ(g),u_particle_pos_scale:new s.bJ(g),u_particle_pos_offset:new s.bH(g)}),rasterParticleUpdate:g=>({u_particle_texture:new s.bK(g),u_particle_texture_side_len:new s.bJ(g),u_velocity:new s.bK(g),u_velocity_res:new s.bH(g),u_max_speed:new s.bJ(g),u_speed_factor:new s.bJ(g),u_reset_rate:new s.bJ(g),u_rand_seed:new s.bJ(g),u_uv_offset:new s.bH(g),u_data_scale:new s.bH(g),u_data_offset:new s.bJ(g),u_particle_pos_scale:new s.bJ(g),u_particle_pos_offset:new s.bH(g)}),symbol:g=>({u_is_size_zoom_constant:new s.bK(g),u_is_size_feature_constant:new s.bK(g),u_size_t:new s.bJ(g),u_size:new s.bJ(g),u_camera_to_center_distance:new s.bJ(g),u_rotate_symbol:new s.bK(g),u_aspect_ratio:new s.bJ(g),u_fade_change:new s.bJ(g),u_matrix:new s.bG(g),u_label_plane_matrix:new s.bG(g),u_coord_matrix:new s.bG(g),u_is_text:new s.bK(g),u_elevation_from_sea:new s.bK(g),u_pitch_with_map:new s.bK(g),u_texsize:new s.bH(g),u_texsize_icon:new s.bH(g),u_texture:new s.bK(g),u_texture_icon:new s.bK(g),u_gamma_scale:new s.bJ(g),u_device_pixel_ratio:new s.bJ(g),u_tile_id:new s.bI(g),u_zoom_transition:new s.bJ(g),u_inv_rot_matrix:new s.bG(g),u_merc_center:new s.bH(g),u_camera_forward:new s.bI(g),u_tile_matrix:new s.bG(g),u_up_vector:new s.bI(g),u_ecef_origin:new s.bI(g),u_is_halo:new s.bK(g),u_icon_transition:new s.bJ(g),u_color_adj_mat:new s.bG(g),u_scale_factor:new s.bJ(g)}),background:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g),u_opacity:new s.bJ(g),u_color:new s.cu(g)}),backgroundPattern:g=>({u_matrix:new s.bG(g),u_emissive_strength:new s.bJ(g),u_opacity:new s.bJ(g),u_image:new s.bK(g),u_pattern_tl:new s.bH(g),u_pattern_br:new s.bH(g),u_texsize:new s.bH(g),u_pattern_size:new s.bH(g),u_pixel_coord_upper:new s.bH(g),u_pixel_coord_lower:new s.bH(g),u_pattern_units_to_pixels:new s.bH(g)}),terrainRaster:g=>({u_matrix:new s.bG(g),u_image0:new s.bK(g),u_skirt_height:new s.bJ(g),u_ground_shadow_factor:new s.bI(g)}),skybox:g=>({u_matrix:new s.bG(g),u_sun_direction:new s.bI(g),u_cubemap:new s.bK(g),u_opacity:new s.bJ(g),u_temporal_offset:new s.bJ(g)}),skyboxGradient:g=>({u_matrix:new s.bG(g),u_color_ramp:new s.bK(g),u_center_direction:new s.bI(g),u_radius:new s.bJ(g),u_opacity:new s.bJ(g),u_temporal_offset:new s.bJ(g)}),skyboxCapture:g=>({u_matrix_3f:new s.cv(g),u_sun_direction:new s.bI(g),u_sun_intensity:new s.bJ(g),u_color_tint_r:new s.c7(g),u_color_tint_m:new s.c7(g),u_luminance:new s.bJ(g)}),globeRaster:g=>({u_proj_matrix:new s.bG(g),u_globe_matrix:new s.bG(g),u_normalize_matrix:new s.bG(g),u_merc_matrix:new s.bG(g),u_zoom_transition:new s.bJ(g),u_merc_center:new s.bH(g),u_image0:new s.bK(g),u_grid_matrix:new s.cv(g),u_skirt_height:new s.bJ(g),u_far_z_cutoff:new s.bJ(g),u_frustum_tl:new s.bI(g),u_frustum_tr:new s.bI(g),u_frustum_br:new s.bI(g),u_frustum_bl:new s.bI(g),u_globe_pos:new s.bI(g),u_globe_radius:new s.bJ(g),u_viewport:new s.bH(g)}),globeAtmosphere:g=>({u_frustum_tl:new s.bI(g),u_frustum_tr:new s.bI(g),u_frustum_br:new s.bI(g),u_frustum_bl:new s.bI(g),u_horizon:new s.bJ(g),u_transition:new s.bJ(g),u_fadeout_range:new s.bJ(g),u_color:new s.c7(g),u_high_color:new s.c7(g),u_space_color:new s.c7(g),u_temporal_offset:new s.bJ(g),u_horizon_angle:new s.bJ(g)}),model:g=>({u_matrix:new s.bG(g),u_lighting_matrix:new s.bG(g),u_normal_matrix:new s.bG(g),u_node_matrix:new s.bG(g),u_lightpos:new s.bI(g),u_lightintensity:new s.bJ(g),u_lightcolor:new s.bI(g),u_camera_pos:new s.bI(g),u_opacity:new s.bJ(g),u_baseColorFactor:new s.c7(g),u_emissiveFactor:new s.c7(g),u_metallicFactor:new s.bJ(g),u_roughnessFactor:new s.bJ(g),u_baseTextureIsAlpha:new s.bK(g),u_alphaMask:new s.bK(g),u_alphaCutoff:new s.bJ(g),u_baseColorTexture:new s.bK(g),u_metallicRoughnessTexture:new s.bK(g),u_normalTexture:new s.bK(g),u_occlusionTexture:new s.bK(g),u_emissionTexture:new s.bK(g),u_lutTexture:new s.bK(g),u_color_mix:new s.c7(g),u_aoIntensity:new s.bJ(g),u_emissive_strength:new s.bJ(g),u_occlusionTextureTransform:new s.c7(g)}),modelDepth:g=>({u_matrix:new s.bG(g),u_instance:new s.bG(g),u_node_matrix:new s.bG(g)}),groundShadow:g=>({u_matrix:new s.bG(g),u_ground_shadow_factor:new s.bI(g)}),stars:g=>({u_matrix:new s.bG(g),u_up:new s.bI(g),u_right:new s.bI(g),u_intensity_multiplier:new s.bJ(g)}),snowParticle:g=>({u_modelview:new s.bG(g),u_projection:new s.bG(g),u_time:new s.bJ(g),u_cam_pos:new s.bI(g),u_velocityConeAperture:new s.bJ(g),u_velocity:new s.bJ(g),u_horizontalOscillationRadius:new s.bJ(g),u_horizontalOscillationRate:new s.bJ(g),u_boxSize:new s.bJ(g),u_billboardSize:new s.bJ(g),u_simpleShapeParameters:new s.bH(g),u_screenSize:new s.bH(g),u_thinningCenterPos:new s.bH(g),u_thinningShape:new s.bI(g),u_thinningAffectedRatio:new s.bJ(g),u_thinningParticleOffset:new s.bJ(g),u_particleColor:new s.c7(g),u_direction:new s.bI(g)}),rainParticle:g=>({u_modelview:new s.bG(g),u_projection:new s.bG(g),u_time:new s.bJ(g),u_cam_pos:new s.bI(g),u_texScreen:new s.bK(g),u_velocityConeAperture:new s.bJ(g),u_velocity:new s.bJ(g),u_boxSize:new s.bJ(g),u_rainDropletSize:new s.bH(g),u_distortionStrength:new s.bJ(g),u_rainDirection:new s.bI(g),u_color:new s.c7(g),u_screenSize:new s.bH(g),u_thinningCenterPos:new s.bH(g),u_thinningShape:new s.bI(g),u_thinningAffectedRatio:new s.bJ(g),u_thinningParticleOffset:new s.bJ(g),u_shapeDirectionalPower:new s.bJ(g),u_mode:new s.bJ(g)}),occlusion:g=>({u_matrix:new s.bG(g),u_anchorPos:new s.bI(g),u_screenSizePx:new s.bH(g),u_occluderSizePx:new s.bH(g),u_color:new s.c7(g)})};class na{constructor(l,h,y,S){this.id=na.uniqueIdxCounter,na.uniqueIdxCounter++,this.context=l;const E=l.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||S||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=na.uniqueIdxCounter,na.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}na.uniqueIdxCounter=0;const Jn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vm{constructor(l,h,y,S,E,I){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=S,this.instanceCount=I,this.context=l;const G=l.gl;this.buffer=G.createBuffer(),l.bindVertexBuffer.set(this.buffer),G.bufferData(G.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?G.DYNAMIC_DRAW:G.STATIC_DRAW),this.dynamicDraw||E||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const S=h.attributes[this.attributes[y].name];S!==void 0&&l.enableVertexAttribArray(S)}}setVertexAttribPointers(l,h,y){for(let S=0;S<this.attributes.length;S++){const E=this.attributes[S],I=h.attributes[E.name];I!==void 0&&l.vertexAttribPointer(I,E.components,l[Jn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,h,y){for(let S=0;S<this.attributes.length;S++){const E=h.attributes[this.attributes[S].name];E!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(E,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class n0{constructor(l,h,y,S,E){this.context=l,this.width=h,this.height=y;const I=this.framebuffer=l.gl.createFramebuffer();S&&(this.colorAttachment=new Im(l,I)),E&&(this.depthAttachmentType=E,this.depthAttachment=E==="renderbuffer"?new Nv(l,I):new J_(l,I))}destroy(){const l=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&l.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&l.deleteTexture(h)}l.deleteFramebuffer(this.framebuffer)}}class Ah{constructor(l,h){this.gl=l,this.clearColor=new Yc(this),this.clearDepth=new qf(this),this.clearStencil=new Td(this),this.colorMask=new Zf(this),this.depthMask=new Ad(this),this.stencilMask=new Iv(this),this.stencilFunc=new Dv(this),this.stencilOp=new Fv(this),this.stencilTest=new xh(this),this.depthRange=new Cm(this),this.depthTest=new Xf(this),this.depthFunc=new K_(this),this.blend=new Sm(this),this.blendFunc=new Pd(this),this.blendColor=new Kf(this),this.blendEquation=new wh(this),this.cullFace=new bm(this),this.cullFaceSide=new Lv(this),this.frontFace=new Ov(this),this.program=new Y_(this),this.activeTexture=new Ch(this),this.viewport=new Id(this),this.bindFramebuffer=new kv(this),this.bindRenderbuffer=new Xa(this),this.bindTexture=new Em(this),this.bindVertexBuffer=new Mm(this),this.bindElementBuffer=new Rm(this),this.bindVertexArrayOES=new Tm(this),this.pixelStoreUnpack=new Am(this),this.pixelStoreUnpackPremultiplyAlpha=new Yf(this),this.pixelStoreUnpackFlipY=new Pm(this),this.options=h?{...h}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h,y){return new na(this,l,h,y)}createVertexBuffer(l,h,y,S,E){return new Vm(this,l,h,y,S,E)}createRenderbuffer(l,h,y){const S=this.gl,E=S.createRenderbuffer();return this.bindRenderbuffer.set(E),S.renderbufferStorage(S.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),E}createFramebuffer(l,h,y,S){return new n0(this,l,h,y,S)}clear({color:l,depth:h,stencil:y,colorMask:S}){const E=this.gl;let I=0;l&&(I|=E.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(S||[!0,!0,!0,!0])),h!==void 0&&(I|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(I|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),E.clear(I)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.bi(l.blendFunction,Vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let _c;function np(g,l,h,y,S,E,I){const G=g.context,$=G.gl,Y=g.transform,X=g.getOrCreateProgram("collisionBox"),ee=[];let ie=0,he=0;for(let Ue=0;Ue<y.length;Ue++){const Ze=y[Ue],Ke=l.getTile(Ze),Xe=Ke.getBucket(h);if(!Xe)continue;const Je=Ff(Ze,Xe,Y);let ot=Je;S[0]===0&&S[1]===0||(ot=g.translatePosMatrix(Je,Ke,S,E));const mt=I?Xe.textCollisionBox:Xe.iconCollisionBox,lt=Xe.collisionCircleArray;if(lt.length>0){const at=s.a6.mat4.create(),Nt=ot;s.a6.mat4.mul(at,Xe.placementInvProjMatrix,Y.glCoordMatrix),s.a6.mat4.mul(at,at,Xe.placementViewportMatrix),ee.push({circleArray:lt,circleOffset:he,transform:Nt,invTransform:at,projection:Xe.getProjection()}),ie+=lt.length/4,he=ie}mt&&(g.terrain&&g.terrain.setupElevationDraw(Ke,X),X.draw(g,$.LINES,ii.disabled,_i.disabled,g.colorModeForRenderPass(),yi.disabled,Hv(ot,Y,Ke,Xe.getProjection()),h.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,Y.zoom,null,[mt.collisionVertexBuffer,mt.collisionVertexBufferExt]))}if(!I||!ee.length)return;const ye=g.getOrCreateProgram("collisionCircle"),ve=new s.cQ;ve.resize(4*ie),ve._trim();let be=0;for(const Ue of ee)for(let Ze=0;Ze<Ue.circleArray.length/4;Ze++){const Ke=4*Ze,Xe=Ue.circleArray[Ke+0],Je=Ue.circleArray[Ke+1],ot=Ue.circleArray[Ke+2],mt=Ue.circleArray[Ke+3];ve.emplace(be++,Xe,Je,ot,mt,0),ve.emplace(be++,Xe,Je,ot,mt,1),ve.emplace(be++,Xe,Je,ot,mt,2),ve.emplace(be++,Xe,Je,ot,mt,3)}(!_c||_c.length<2*ie)&&(_c=function(Ue){const Ze=2*Ue,Ke=new s.aP;Ke.resize(Ze),Ke._trim();for(let Xe=0;Xe<Ze;Xe++){const Je=6*Xe;Ke.uint16[Je+0]=4*Xe+0,Ke.uint16[Je+1]=4*Xe+1,Ke.uint16[Je+2]=4*Xe+2,Ke.uint16[Je+3]=4*Xe+2,Ke.uint16[Je+4]=4*Xe+3,Ke.uint16[Je+5]=4*Xe+0}return Ke}(ie));const Ce=G.createIndexBuffer(_c,!0),Fe=G.createVertexBuffer(ve,s.cR.members,!0);for(const Ue of ee){const Ze={u_matrix:Ue.transform,u_inv_matrix:Ue.invTransform,u_camera_to_center_distance:(ze=Y).getCameraToCenterDistance(Ue.projection),u_viewport_size:[ze.width,ze.height]};ye.draw(g,$.TRIANGLES,ii.disabled,_i.disabled,g.colorModeForRenderPass(),yi.disabled,Ze,h.id,Fe,Ce,s.b2.simpleSegment(0,2*Ue.circleOffset,Ue.circleArray.length,Ue.circleArray.length/2),null,Y.zoom)}var ze;Fe.destroy(),Ce.destroy()}const Bd=s.a6.mat4.create();function jv(g){const l=g._camera.getWorldToCamera(g.worldSize,1),h=s.a6.mat4.multiply([],l,g.globeMatrix);s.a6.mat4.invert(h,h);const y=[0,0,0],S=[0,1,0,0];return s.a6.vec4.transformMat4(S,S,h),y[0]=S[0],y[1]=S[1],y[2]=S[2],s.a6.vec3.normalize(y,y),y}function i0({width:g,height:l,anchor:h,textOffset:y,textScale:S},E){const{horizontalAlign:I,verticalAlign:G}=s.by(h),$=-(I-.5)*g,Y=-(G-.5)*l,X=s.bx(h,y);return new s.P(($/S+X[0])*E,(Y/S+X[1])*E)}function Gm(g,l,h,y,S,E,I,G,$,Y,X){const ee=g.text.placedSymbolArray,ie=g.text.dynamicLayoutVertexArray,he=g.icon.dynamicLayoutVertexArray,ye={},ve=g.getProjection(),be=Tl(G,ve,E),Ce=E.elevation,Fe=ve.upVectorScale(G.canonical,E.center.lat,E.worldSize).metersToTile;ie.clear();for(let ze=0;ze<ee.length;ze++){const Ue=ee.get(ze),{tileAnchorX:Ze,tileAnchorY:Ke,numGlyphs:Xe}=Ue,Je=Ue.hidden||!Ue.crossTileID||g.allowVerticalPlacement&&!Ue.placedOrientation?null:y[Ue.crossTileID];if(Je){let ot=0,mt=0,lt=0;if(Ce){const Vt=Ce?Ce.getAtTileOffset(G,Ze,Ke):0,[an,un,sn]=ve.upVector(G.canonical,Ze,Ke);ot=Vt*an*Fe,mt=Vt*un*Fe,lt=Vt*sn*Fe}let[at,Nt,qt,ln]=xo(Ue.projectedAnchorX+ot,Ue.projectedAnchorY+mt,Ue.projectedAnchorZ+lt,h?be:I);const _n=$i(E.getCameraToCenterDistance(ve),ln);let En=S.evaluateSizeForFeature(g.textSizeData,Y,Ue)*_n/s.br;h&&(En*=g.tilePixelRatio/$);const Ct=i0(Je,En);h?({x:at,y:Nt,z:qt}=ve.projectTilePoint(Ze+Ct.x,Ke+Ct.y,G.canonical),[at,Nt,qt]=xo(at+ot,Nt+mt,qt+lt,I)):(l&&Ct._rotate(-E.angle),at+=Ct.x,Nt+=Ct.y,qt=0);const on=g.allowVerticalPlacement&&Ue.placedOrientation===s.bl.vertical?Math.PI/2:0;for(let Vt=0;Vt<Xe;Vt++)s.bo(ie,at,Nt,qt,on);X&&Ue.associatedIconIndex>=0&&(ye[Ue.associatedIconIndex]={x:at,y:Nt,z:qt,angle:on})}else wo(Xe,ie)}if(X){he.clear();const ze=g.icon.placedSymbolArray;for(let Ue=0;Ue<ze.length;Ue++){const Ze=ze.get(Ue),{numGlyphs:Ke}=Ze,Xe=ye[Ue];if(Ze.hidden||!Xe)wo(Ke,he);else{const{x:Je,y:ot,z:mt,angle:lt}=Xe;for(let at=0;at<Ke;at++)s.bo(he,Je,ot,mt,lt)}}g.icon.dynamicLayoutVertexBuffer.updateData(he)}g.text.dynamicLayoutVertexBuffer.updateData(ie)}function zd(g,l,h,y,S,E,I={}){const G=h.paint.get("icon-translate"),$=h.paint.get("text-translate"),Y=h.paint.get("icon-translate-anchor"),X=h.paint.get("text-translate-anchor"),ee=h.layout.get("icon-rotation-alignment"),ie=h.layout.get("text-rotation-alignment"),he=h.layout.get("icon-pitch-alignment"),ye=h.layout.get("text-pitch-alignment"),ve=h.layout.get("icon-keep-upright"),be=h.layout.get("text-keep-upright"),Ce=h.paint.get("icon-color-saturation"),Fe=h.paint.get("icon-color-contrast"),ze=h.paint.get("icon-color-brightness-min"),Ue=h.paint.get("icon-color-brightness-max"),Ze=h.layout.get("symbol-elevation-reference")==="sea",Ke=g.context,Xe=Ke.gl,Je=g.transform,ot=ee==="map",mt=ie==="map",lt=he==="map",at=ye==="map",Nt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let qt=!1;const ln=g.depthModeForSublayer(0,ii.ReadOnly),_n=[s.am(Je.center.lng),s.at(Je.center.lat)],En=h.layout.get("text-variable-anchor"),Ct=Je.projection.name==="globe",on=[],Vt=[0,-1,0];for(const an of y){const un=l.getTile(an),sn=un.getBucket(h);if(!sn||sn.projection.name==="mercator"&&Ct||sn.fullyClipped)continue;const Pn=sn.projection.name==="globe",Qn=Pn?s.a9(Je.zoom):0,ri=Tl(an,sn.getProjection(),Je),jn=Je.calculatePixelsToTileUnitsMatrix(un),li=En&&sn.hasTextData(),On=sn.hasIconTextFit()&&li&&sn.hasIconData(),xi=sn.getProjection().createInversionMatrix(Je,an.canonical),Oi=Br=>{Je.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||g.terrain)&&(Br.push("DEPTH_D24"),Br.push("DEPTH_OCCLUSION"))},sr=()=>{const Br=ot&&h.layout.get("symbol-placement")!=="point",Rr=[];Oi(Rr);const us=Br||On,mo=h.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&lt&&Rr.push("PITCH_WITH_MAP_TERRAIN"),Pn&&(Rr.push("PROJECTION_GLOBE_VIEW"),us&&Rr.push("PROJECTED_POS_ON_VIEWPORT")),mo>0&&Rr.push("ICON_TRANSITION"),sn.icon.zOffsetVertexBuffer&&Rr.push("Z_OFFSET"),Ce===0&&Fe===0&&ze===0&&Ue===1||Rr.push("COLOR_ADJUSTMENT"),sn.sdfIcons&&Rr.push("RENDER_SDF");const Bl=sn.icon.programConfigurations.get(h.id),wc=g.getOrCreateProgram("symbol",{config:Bl,defines:Rr}),To=un.imageAtlasTexture?un.imageAtlasTexture.size:[0,0],mr=sn.iconSizeData,ar=s.bk(mr,Je.zoom),Er=lt||Je.pitch!==0,Xr=ur(ri,un.tileID.canonical,lt,ot,Je,sn.getProjection(),jn),Us=Ia(ri,un.tileID.canonical,lt,ot,Je,sn.getProjection(),jn),hs=g.translatePosMatrix(Us,un,G,Y,!0),Wo=g.translatePosMatrix(ri,un,G,Y),Bu=us?Bd:Xr,cl=ot&&!lt&&!Br;let ul=Vt;!Ct&&!Je.mercatorFromTransition||ot||(ul=jv(Je));const Cc=Pn?ul:Vt,ru=h.getColorAdjustmentMatrix(Ce,Fe,ze,Ue),hl=vc(mr.kind,ar,cl,lt,g,Wo,Bu,hs,Ze,!1,To,[0,0],!0,an,Qn,_n,xi,Cc,sn.getProjection(),ru,mo),Lh=un.imageAtlasTexture?un.imageAtlasTexture:null,Sc=h.layout.get("icon-size").constantOr(0)!==1||sn.iconsNeedLinear,Ir=sn.sdfIcons||g.options.rotating||g.options.zooming||Sc||Er?Xe.LINEAR:Xe.NEAREST,Qm=sn.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Gw=g.terrain&&lt&&Br?s.a6.mat4.invert(s.a6.mat4.create(),Xr):Bd;if(Br&&sn.icon){const eg=Je.elevation,Hw=eg?eg.getAtTileOffsetFunc(an,Je.center.lat,Je.worldSize,sn.getProjection()):null,ty=nr(ri,un.tileID.canonical,lt,ot,Je,sn.getProjection(),jn);Cd(sn,ri,g,!1,ty,Us,lt,ve,Hw,an)}return{program:wc,buffers:sn.icon,uniformValues:hl,atlasTexture:Lh,atlasTextureIcon:null,atlasInterpolation:Ir,atlasInterpolationIcon:null,isSDF:sn.sdfIcons,hasHalo:Qm,tile:un,labelPlaneMatrixInv:Gw}},jr=()=>{const Br=mt&&h.layout.get("symbol-placement")!=="point",Rr=[],us=Br||En||On;g.terrainRenderModeElevated()&&at&&Rr.push("PITCH_WITH_MAP_TERRAIN"),Pn&&(Rr.push("PROJECTION_GLOBE_VIEW"),us&&Rr.push("PROJECTED_POS_ON_VIEWPORT")),sn.text.zOffsetVertexBuffer&&Rr.push("Z_OFFSET"),sn.iconsInText&&Rr.push("RENDER_TEXT_AND_SYMBOL"),Rr.push("RENDER_SDF"),Oi(Rr);const mo=sn.text.programConfigurations.get(h.id),Bl=g.getOrCreateProgram("symbol",{config:mo,defines:Rr});let wc,To=[0,0],mr=null;const ar=sn.textSizeData;sn.iconsInText&&(To=un.imageAtlasTexture?un.imageAtlasTexture.size:[0,0],mr=un.imageAtlasTexture?un.imageAtlasTexture:null,wc=at||Je.pitch!==0||g.options.rotating||g.options.zooming||ar.kind==="composite"||ar.kind==="camera"?Xe.LINEAR:Xe.NEAREST);const Er=un.glyphAtlasTexture?un.glyphAtlasTexture.size:[0,0],Xr=h.layout.get("text-size-scale-range"),Us=s.ap(g.scaleFactor,Xr[0],Xr[1]),hs=s.bk(ar,Je.zoom,Us),Wo=ur(ri,un.tileID.canonical,at,mt,Je,sn.getProjection(),jn),Bu=Ia(ri,un.tileID.canonical,at,mt,Je,sn.getProjection(),jn),cl=g.translatePosMatrix(Bu,un,$,X,!0),ul=g.translatePosMatrix(ri,un,$,X),Cc=us?Bd:Wo,ru=mt&&!at&&!Br;let hl=Vt;!Ct&&!Je.mercatorFromTransition||mt||(hl=jv(Je));const Lh=vc(ar.kind,hs,ru,at,g,ul,Cc,cl,Ze,!0,Er,To,!0,an,Qn,_n,xi,Pn?hl:Vt,sn.getProjection(),null,null,Us),Sc=un.glyphAtlasTexture?un.glyphAtlasTexture:null,Ir=Xe.LINEAR,Qm=h.paint.get("text-halo-width").constantOr(1)!==0,Gw=g.terrain&&at&&Br?s.a6.mat4.invert(s.a6.mat4.create(),Wo):Bd;if(Br&&sn.text){const eg=Je.elevation,Hw=eg?eg.getAtTileOffsetFunc(an,Je.center.lat,Je.worldSize,sn.getProjection()):null,ty=nr(ri,un.tileID.canonical,at,mt,Je,sn.getProjection(),jn);Cd(sn,ri,g,!0,ty,Bu,at,be,Hw,an)}return{program:Bl,buffers:sn.text,uniformValues:Lh,atlasTexture:Sc,atlasTextureIcon:mr,atlasInterpolation:Ir,atlasInterpolationIcon:wc,isSDF:!0,hasHalo:Qm,tile:un,labelPlaneMatrixInv:Gw}},_r=sn.icon.segments.get().length,ts=sn.text.segments.get().length,br=_r&&!I.onlyText?sr():null,$r=ts&&!I.onlyIcons?jr():null,Ki=h.paint.get("icon-opacity").constantOr(1),Vr=h.paint.get("text-opacity").constantOr(1);if(Nt&&sn.canOverlap){qt=!0;const Br=Ki&&!I.onlyText?sn.icon.segments.get():[],Rr=Vr&&!I.onlyIcons?sn.text.segments.get():[];for(const us of Br)on.push({segments:new s.b2([us]),sortKey:us.sortKey,state:br});for(const us of Rr)on.push({segments:new s.b2([us]),sortKey:us.sortKey,state:$r})}else I.onlyText||on.push({segments:Ki?sn.icon.segments:new s.b2([]),sortKey:0,state:br}),I.onlyIcons||on.push({segments:Vr?sn.text.segments:new s.b2([]),sortKey:0,state:$r})}qt&&on.sort((an,un)=>an.sortKey-un.sortKey);for(const an of on){const un=an.state;if(un)if(g.terrain?g.terrain.setupElevationDraw(un.tile,un.program,{useDepthForOcclusion:Je.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:un.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Je.depthOcclusionForSymbolsAndCircles,un.program),Ke.activeTexture.set(Xe.TEXTURE0),un.atlasTexture&&un.atlasTexture.bind(un.atlasInterpolation,Xe.CLAMP_TO_EDGE,!0),un.atlasTextureIcon&&(Ke.activeTexture.set(Xe.TEXTURE1),un.atlasTextureIcon&&un.atlasTextureIcon.bind(un.atlasInterpolationIcon,Xe.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,un.program),un.hasHalo){const sn=un.uniformValues;sn.u_is_halo=1,Ud(un.buffers,an.segments,h,g,un.program,ln,S,E,sn,2),sn.u_is_halo=0}else{if(un.isSDF){const sn=un.uniformValues;un.hasHalo&&(sn.u_is_halo=1,Ud(un.buffers,an.segments,h,g,un.program,ln,S,E,sn,1)),sn.u_is_halo=0}Ud(un.buffers,an.segments,h,g,un.program,ln,S,E,un.uniformValues,1)}}}function Ud(g,l,h,y,S,E,I,G,$,Y){const X=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];S.draw(y,y.context.gl.TRIANGLES,E,I,G,yi.disabled,$,h.id,g.layoutVertexBuffer,g.indexBuffer,l,h.paint,y.transform.zoom,g.programConfigurations.get(h.id),X,Y)}function Vd(g,l,h,y,S,E,I){const G=g.context.gl,$=h.paint.get("fill-pattern"),Y=h.is3D(),X=Y?g.stencilModeFor3D():_i.disabled,ee=$&&$.constantOr(1);let ie,he,ye,ve,be;I?(he=ee&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ie=G.LINES):(he=ee?"fillPattern":"fill",ie=G.TRIANGLES);for(const Ce of y){const Fe=l.getTile(Ce);if(ee&&!Fe.patternsLoaded())continue;const ze=Fe.getBucket(h);if(!ze)continue;g.prepareDrawTile();const Ue=ze.programConfigurations.get(h.id),Ze=g.isTileAffectedByFog(Ce),Ke=g.getOrCreateProgram(he,{config:Ue,overrideFog:Ze});ee&&(g.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ue.updatePaintBuffers());const Xe=$.constantOr(null);if(Xe&&Fe.imageAtlas){const mt=Fe.imageAtlas.patternPositions[Xe.toString()];mt&&Ue.setConstantPatternPositions(mt)}const Je=g.translatePosMatrix(Ce.projMatrix,Fe,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ot=h.paint.get("fill-emissive-strength");if(I){ve=ze.indexBuffer2,be=ze.segments2;const mt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];ye=he==="fillOutlinePattern"&&ee?e0(Je,ot,g,Fe,mt):bh(Je,ot,mt)}else ve=ze.indexBuffer,be=ze.segments,ye=ee?Bm(Je,ot,g,Fe):Gv(Je,ot);g.uploadCommonUniforms(g.context,Ke,Ce.toUnwrapped()),Ke.draw(g,ie,S,Y?X:g.stencilModeForClipping(Ce),E,yi.disabled,ye,h.id,ze.layoutVertexBuffer,ve,be,h.paint,g.transform.zoom,Ue,void 0)}}function bo(g,l,h,y,S,E,I,G){h.resetLayerRenderingStats(g);const $=g.context,Y=$.gl,X=g.transform,ee=h.paint.get("fill-extrusion-pattern"),ie=ee.constantOr(1),he=h.paint.get("fill-extrusion-opacity"),ye=g.style.enable3dLights(),ve=h.paint.get(ye&&!ie?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),be=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ve],Ce=h.layout.get("fill-extrusion-edge-radius"),Fe=Ce>0&&!h.paint.get("fill-extrusion-rounded-roof"),ze=Fe?0:Ce,Ue=X.projection.name==="globe"?s.c_():0,Ze=X.projection.name==="globe",Ke=Ze?s.a9(X.zoom):0,Xe=[s.am(X.center.lng),s.at(X.center.lat)],Je=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ot=h.paint.get("fill-extrusion-flood-light-intensity"),mt=h.paint.get("fill-extrusion-vertical-scale"),lt=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,at=h.paint.get("fill-extrusion-height-alignment"),Nt=h.paint.get("fill-extrusion-base-alignment"),qt=fc(g,h.paint.get("fill-extrusion-cutoff-fade-range")),ln=[];let _n;Ze&&ln.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&ln.push("FAUX_AO"),Fe&&ln.push("ZERO_ROOF_RADIUS"),G&&ln.push("HAS_CENTROID"),ot>0&&ln.push("FLOOD_LIGHT"),qt.shouldRenderCutoff&&ln.push("RENDER_CUTOFF"),lt&&ln.push("RENDER_WALL_MODE");const En=g.renderPass==="shadow",Ct=g.shadowRenderer,on=En&&!!Ct;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Vt=[0,0,0];if(Ct){const sn=g.style.directionalLight,Pn=g.style.ambientLight;sn&&Pn&&(Vt=Ru(g.style,sn,Pn)),En||(ln.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ct.useNormalOffset&&ln.push("NORMAL_OFFSET")),_n=ln.concat(["SHADOWS_SINGLE_CASCADE"])}const an=on?"fillExtrusionDepth":ie?"fillExtrusionPattern":"fillExtrusion",un=h.getLayerRenderingStats();for(const sn of y){const Pn=l.getTile(sn),Qn=Pn.getBucket(h);if(!Qn||Qn.projection.name!==X.projection.name)continue;let ri=!1;Ct&&(ri=Ct.getMaxCascadeForTile(sn.toUnwrapped())===0);const jn=g.isTileAffectedByFog(sn),li=Qn.programConfigurations.get(h.id),On=g.getOrCreateProgram(an,{config:li,defines:ri?_n:ln,overrideFog:jn});if(g.terrain&&g.terrain.setupElevationDraw(Pn,On,{useMeterToDem:!0}),!Qn.centroidVertexBuffer){const br=On.attributes.a_centroid_pos;br!==void 0&&Y.vertexAttrib2f(br,0,0)}!En&&Ct&&Ct.setupShadows(Pn.tileID.toUnwrapped(),On,"vector-tile",Pn.tileID.overscaledZ),ie&&(g.context.activeTexture.set(Y.TEXTURE0),Pn.imageAtlasTexture&&Pn.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),li.updatePaintBuffers());const xi=ee.constantOr(null);if(xi&&Pn.imageAtlas){const br=Pn.imageAtlas.patternPositions[xi.toString()];br&&li.setConstantPatternPositions(br)}const Oi=h.paint.get("fill-extrusion-vertical-gradient"),sr=1/Qn.tileToMeter;let jr;if(En&&Ct){if(Zv(Pn.tileID,Qn,g))continue;const br=Ct.calculateShadowPassMatrixFromTile(Pn.tileID.toUnwrapped());jr=km(br,ze,sr,mt,at,Nt)}else{const br=g.translatePosMatrix(sn.expandedProjMatrix,Pn,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$r=X.projection.createInversionMatrix(X,sn.canonical);jr=ie?Nm(br,g,Oi,he,be,ze,sr,sn,Pn,Ue,at,Nt,Ke,Xe,$r,Je,mt):Om(br,g,Oi,he,be,ze,sr,sn,Ue,at,Nt,Ke,Xe,$r,Je,mt,ot,Vt)}g.uploadCommonUniforms($,On,sn.toUnwrapped(),null,qt);let _r=Qn.segments;if(X.projection.name==="mercator"&&!En&&(_r=Qn.getVisibleSegments(Pn.tileID,g.terrain,g.transform.getFrustum(0)),!_r.get().length))continue;if(un)if(En)for(const br of _r.get())un.numRenderedVerticesInShadowPass+=br.primitiveLength;else for(const br of _r.get())un.numRenderedVerticesInTransparentPass+=br.primitiveLength;const ts=[];(g.terrain||G)&&ts.push(Qn.centroidVertexBuffer),Ze&&ts.push(Qn.layoutVertexExtBuffer),lt&&ts.push(Qn.wallVertexBuffer),On.draw(g,$.gl.TRIANGLES,S,E,I,yi.backCCW,jr,h.id,Qn.layoutVertexBuffer,Qn.indexBuffer,_r,h.paint,g.transform.zoom,li,ts)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Oa(g,l,h,y,S,E,I,G,$,Y,X,ee,ie,he,ye,ve,be,Ce,Fe){const ze=g.context,Ue=ze.gl,Ze=g.transform,Ke=g.transform.zoom,Xe=[],Je=fc(g,h.paint.get("fill-extrusion-cutoff-fade-range"));Y==="clear"?(Xe.push("CLEAR_SUBPASS"),Fe&&(Xe.push("CLEAR_FROM_TEXTURE"),ze.activeTexture.set(Ue.TEXTURE0),Fe.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE))):Y==="sdf"&&Xe.push("SDF_SUBPASS"),be&&Xe.push("HAS_CENTROID"),Je.shouldRenderCutoff&&Xe.push("RENDER_CUTOFF");const ot=h.layout.get("fill-extrusion-edge-radius"),mt=(lt,at,Nt,qt,ln)=>{const _n=at.programConfigurations.get(h.id),En=g.isTileAffectedByFog(lt),Ct=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:_n,defines:Xe,overrideFog:En}),on=((an,un,sn,Pn,Qn,ri,jn,li,On,xi,Oi)=>({u_matrix:un,u_opacity:sn,u_ao_pass:Pn?1:0,u_meter_to_tile:Qn,u_ao:ri,u_flood_light_intensity:jn,u_flood_light_color:li,u_attenuation:On,u_edge_radius:xi,u_fb:0,u_fb_size:Oi,u_dynamic_offset:1}))(0,qt,X,$,ln,[ee,ie*ln],he,ye,ve,Ke>=17?0:ot*ln,Fe?Fe.size[0]:0),Vt=[];be&&Vt.push(at.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(ze,Ct,lt.toUnwrapped(),null,Je),Ct.draw(g,ze.gl.TRIANGLES,S,E,I,G,on,h.id,at.vertexBuffer,at.indexBuffer,Nt,h.paint,Ke,_n,Vt)};for(const lt of y){const at=l.getTile(lt),Nt=at.getBucket(h);if(!Nt||Nt.projection.name!==Ze.projection.name||!Nt.groundEffect||Nt.groundEffect&&!Nt.groundEffect.hasData())continue;const qt=Nt.groundEffect,ln=1/Nt.tileToMeter;{const _n=g.translatePosMatrix(lt.projMatrix,at,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),En=qt.getDefaultSegment();mt(lt,qt,En,_n,ln)}if(Ce)for(let _n=0;_n<4;_n++){const En=s.c$[_n](lt),Ct=l.getTile(En);if(!Ct)continue;const on=Ct.getBucket(h);if(!on||on.projection.name!==Ze.projection.name||!on.groundEffect||on.groundEffect&&!on.groundEffect.hasData())continue;const Vt=on.groundEffect;let an,un;_n===0?(an=[-s.ab,0,0],un=1):_n===1?(an=[s.ab,0,0],un=0):_n===2?(an=[0,-s.ab,0],un=3):(an=[0,s.ab,0],un=2);const sn=Vt.regionSegments[un];if(!sn)continue;const Pn=new Float32Array(16);s.a6.mat4.translate(Pn,lt.projMatrix,an),mt(lt,Vt,sn,g.translatePosMatrix(Pn,at,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ln)}}}function Hm(g,l,h,y,S,E,I){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const G=E?E.findDEMTileFor(h):null;if(!(G&&G.dem||I))return;const $=Ce=>new s.P(Math.ceil((Ce+s.d2)*s.d3),0),Y=Ce=>{const Fe=l.getSource().minzoom,ze=Ze=>{const Ke=l.getTileByID(Ze);if(Ke&&Ke.hasData())return Ke.getBucket(S)},Ue=[0,-1,1];for(const Ze of Ue){if(Ce.overscaledZ+Ze<Fe)continue;const Ke=ze(Ce.calculateScaledKey(Ce.overscaledZ+Ze));if(Ke)return Ke}},X=[0,0,0],ee=(Ce,Fe)=>(X[0]=Math.min(Ce.min.y,Fe.min.y),X[1]=Math.max(Ce.max.y,Fe.max.y),X[2]=s.ab-Fe.min.x>Ce.max.x?Fe.min.x-s.ab:Ce.max.x,X),ie=(Ce,Fe)=>(X[0]=Math.min(Ce.min.x,Fe.min.x),X[1]=Math.max(Ce.max.x,Fe.max.x),X[2]=s.ab-Fe.min.y>Ce.max.y?Fe.min.y-s.ab:Ce.max.y,X),he=[(Ce,Fe)=>ee(Ce,Fe),(Ce,Fe)=>ee(Fe,Ce),(Ce,Fe)=>ie(Ce,Fe),(Ce,Fe)=>ie(Fe,Ce)],ye=(Ce,Fe,ze,Ue,Ze,Ke,Xe)=>{if(!E)return 0;const Je=[[Ke?ze:Ce,Ke?Ce:ze,0],[Ke?ze:Fe,Ke?Fe:ze,0]],ot=Xe<0?s.ab+Xe:Xe,mt=[Ke?ot:(Ce+Fe)/2,Ke?(Ce+Fe)/2:ot,0];return ze===0&&Xe<0||ze!==0&&Xe>0?E.getForTilePoints(Ze,[mt],!0,Ue):Je.push(mt),E.getForTilePoints(h,Je,!0,G),Math.max(Je[0][2],Je[1][2],mt[2])/E.exaggeration()};for(let Ce=0;Ce<4;Ce++){const Fe=y.borderFeatureIndices[Ce];if(Fe.length===0)continue;const ze=s.c$[Ce](h),Ue=Y(ze);if(!(Ue&&Ue instanceof s.d0)||y.borderDoneWithNeighborZ[Ce]===Ue.canonical.z)continue;Ue.centroidVertexArray.length===0&&Ue.createCentroidsBuffer();const Ze=E?E.findDEMTileFor(ze):null;if(!(Ze&&Ze.dem||I))continue;const Ke=(Ce<2?1:5)-Ce,Xe=Ue.borderDoneWithNeighborZ[Ke]!==y.canonical.z,Je=Ue.borderFeatureIndices[Ke];let ot=0;if(y.canonical.z!==Ue.canonical.z){for(const mt of Fe)y.showCentroid(y.featuresOnBorder[mt]);if(Xe)for(const mt of Je)Ue.showCentroid(Ue.featuresOnBorder[mt]);y.borderDoneWithNeighborZ[Ce]=Ue.canonical.z,Ue.borderDoneWithNeighborZ[Ke]=y.canonical.z}for(const mt of Fe){const lt=y.featuresOnBorder[mt],at=y.centroidData[lt.centroidDataIndex],Nt=lt.borders[Ce];let qt;for(;ot<Je.length;){qt=Ue.featuresOnBorder[Je[ot]];const ln=qt.borders[Ke];if(ln[1]>Nt[0]+3||ln[0]>Nt[0]-3)break;Ue.showCentroid(qt),ot++}if(qt&&ot<Je.length){const ln=ot;let _n=0;for(;!(qt.borders[Ke][0]>Nt[1]-3)&&(_n++,++ot!==Je.length);)qt=Ue.featuresOnBorder[Je[ot]];qt=Ue.featuresOnBorder[Je[ln]];let En=!1;if(_n>=1){const Vt=qt.borders[Ke];Math.abs(Nt[0]-Vt[0])<3&&Math.abs(Nt[1]-Vt[1])<3&&(_n=1,En=!0,ot=ln+1)}else if(_n===0){y.showCentroid(lt);continue}const Ct=Ue.centroidData[qt.centroidDataIndex];I&&En&&(((ve=at).flags|(be=Ct).flags)&s.d1?(ve.flags|=s.d1,be.flags|=s.d1):(ve.flags&=~s.d1,be.flags&=~s.d1));const on=lt.intersectsCount()>1||qt.intersectsCount()>1;if(_n>1)ot=ln,at.centroidXY=Ct.centroidXY=new s.P(0,0);else if(Ze&&Ze.dem&&!on){const Vt=he[Ce](at,Ct),an=Ce%2?s.ab-1:0,un=ye(Vt[0],Math.min(s.ab-1,Vt[1]),an,Ze,ze,Ce<2,Vt[2]);at.centroidXY=Ct.centroidXY=$(un)}else on?at.centroidXY=Ct.centroidXY=new s.P(0,0):(at.centroidXY=y.encodeBorderCentroid(lt),Ct.centroidXY=Ue.encodeBorderCentroid(qt));y.writeCentroidToBuffer(at),Ue.writeCentroidToBuffer(Ct)}else y.showCentroid(lt)}y.borderDoneWithNeighborZ[Ce]=Ue.canonical.z,Ue.borderDoneWithNeighborZ[Ke]=y.canonical.z}var ve,be;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const Gd=[1,0,0],$v=[0,1,0],qv=[0,0,1];function Zv(g,l,h){const y=h.transform,S=h.shadowRenderer;if(!S)return!0;const E=g.toUnwrapped(),I=y.tileSize*S._cascades[h.currentShadowCascade].scale;let G=l.maxHeight;if(y.elevation){const ve=y.elevation.getMinMaxForTile(g);ve&&(G+=ve.max)}const $=[...S.shadowDirection];$[2]=-$[2];const Y=S.computeSimplifiedTileShadowVolume(E,G,I,$);if(!Y)return!1;const X=[Gd,$v,qv,$,[$[0],0,$[2]],[0,$[1],$[2]]],ee=y.projection.name==="globe",ie=y.scaleZoom(I),he=s.bO.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,ie,!ee),ye=S.getCurrentCascadeFrustum();return he.intersectsPrecise(Y.vertices,Y.planes,X)===0||ye.intersectsPrecise(Y.vertices,Y.planes,X)===0}function ka(g){return[g[0]*s.d4,g[1]*s.d4,g[2]*s.d4,0]}function gs(g,l,h,y,S,E,I,G,$){const Y=y.getSource(),X=h.globeSharedBuffers;if(!X)return;let ee,ie,he;if(l&&(ee=y.getTile(l)),Y instanceof s.aD?(ie=Y.texture,he=s.cD(0,0,h.transform)):ee&&l&&(ie=ee.texture,he=s.cD(l.canonical.z,l.canonical.x,h.transform)),!ie||!he)return;g||(he=s.a6.mat4.scale(s.a6.mat4.create(),he,[1,-1,1]));const ye=h.context,ve=ye.gl,be=S.paint.get("raster-resampling")==="nearest"?ve.NEAREST:ve.LINEAR,Ce=h.colorModeForDrapableLayerRenderPass(E),Fe=I.defines;Fe.push("GLOBE_POLES");const ze=new ii(ve.LEQUAL,ii.ReadWrite,h.depthRangeFor3D),Ue=Float32Array.from(h.transform.expandedFarZProjMatrix),Ze=Float32Array.from(s.b6(s.cC(new s.bQ(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),ye.activeTexture.set(ve.TEXTURE0),ie.bind(be,ve.CLAMP_TO_EDGE),ye.activeTexture.set(ve.TEXTURE1),ie.bind(be,ve.CLAMP_TO_EDGE),ie.useMipmap&&ye.extTextureFilterAnisotropic&&h.transform.pitch>20&&ve.texParameterf(ve.TEXTURE_2D,ye.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ye.extTextureFilterAnisotropicMax);const[Ke,Xe,Je,ot]=l?X.getPoleBuffers(l.canonical.z,!1):X.getPoleBuffers(0,!0),mt=S.paint.get("raster-elevation");let lt;g?(lt=Ke,h.renderDefaultNorthPole=mt!==0):(lt=Xe,h.renderDefaultSouthPole=mt!==0);const at=ka(I.mix),Nt=((ln,_n,En,Ct,on,Vt,an,un,sn,Pn,Qn,ri,jn)=>kd(ln,_n,En,new Float32Array(16),new Float32Array(9),[0,0],Ct,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Vt,[0,0],un,2,Pn,Qn,ri,1,0,jn))(Ue,Ze,he,s.a9(h.transform.zoom),0,S,0,mt,0,at,I.offset,I.range,E),qt=h.getOrCreateProgram("raster",{defines:Fe});h.uploadCommonUniforms(ye,qt,null),qt.draw(h,ve.TRIANGLES,ze,$,Ce,G,Nt,S.id,lt,Je,ot)}function ip(g){const l=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-l,S=.2*g.height,E=l+S;return[l,h,(E-S-l)/y,(E-l)/y]}function Hd(g,l,h,y){if(g)return l instanceof di&&g instanceof Wa?l.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:ka(y.mix),offset:y.offset,buffer:0,tileSize:1}}var rp=s.d5([{name:"a_index",type:"Int16",components:1}]);class sp{constructor(l,h,y,S){const E={width:y[0],height:y[1],data:null},I=l.gl;this.targetColorTexture=new s.T(l,E,I.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(l,E,I.RGBA8,{useMipmap:!1}),this.context=l,this.updateParticleTexture(h,S),this.lastInvalidatedAt=0}updateParticleTexture(l,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,S=h.width*h.height;this.particleTexture0=new s.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1});const E=new s.d6;E.reserve(S);for(let I=0;I<S;I++)E.emplaceBack(I);this.particleIndexBuffer=this.context.createVertexBuffer(E,rp.members,!0),this.particleSegment=s.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function op(g,l,h){if(!g)return null;const y=l.getTextureDescriptor(g,h,!0);if(!y)return null;let{texture:S,mix:E,offset:I,tileSize:G,buffer:$,format:Y}=y;if(!S||!Y)return null;let X=!1;return Y==="uint32"&&(X=!0,E[3]=0,E=Eh(s.d7,E,[0,h.paint.get("raster-particle-max-speed")]),I=Mh(s.d7,I,[0,h.paint.get("raster-particle-max-speed")])),{texture:S,textureOffset:[$/(G+2*$),G/(G+2*$)],tileSize:G,scalarData:X,scale:E,offset:I,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[Y]]}}function Wm(g){const l=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-l,S=.2*g.height,E=l+S;return[l,h,(E-S-l)/y,(E-l)/y]}const xc=new s.bA(1,0,0,1),Du=new s.bA(0,1,0,1),yn=new s.bA(0,0,1,1),ni=new s.bA(1,0,1,1),Ph=new s.bA(0,1,1,1);function Ur(g,l,h,y,S,E,I){const G=g.context,$=g.transform,Y=G.gl,X=$.projection.name==="globe",ee=X?["PROJECTION_GLOBE_VIEW"]:[];let ie=s.a6.mat4.clone(h.projMatrix);if(X&&s.a9($.zoom)>0){const at=s.b5(h.canonical,$),Nt=s.d8(at);ie=s.a6.mat4.multiply(new Float32Array(16),$.globeMatrix,Nt),s.a6.mat4.multiply(ie,$.projMatrix,ie)}const he=s.a6.mat4.create();he[12]+=2*S/(s.q.devicePixelRatio*$.width),he[13]+=2*E/(s.q.devicePixelRatio*$.height),s.a6.mat4.multiply(ie,he,ie);const ye=g.getOrCreateProgram("debug",{defines:ee}),ve=l.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(ve,ye);const be=ii.disabled,Ce=_i.disabled,Fe=g.colorModeForRenderPass(),ze="$debug";G.activeTexture.set(Y.TEXTURE0),g.emptyTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),X?ve._makeGlobeTileDebugBuffers(g.context,$):ve._makeDebugTileBoundsBuffers(g.context,$.projection);const Ue=ve._tileDebugBuffer||g.debugBuffer,Ze=ve._tileDebugIndexBuffer||g.debugIndexBuffer,Ke=ve._tileDebugSegments||g.debugSegments;if(ye.draw(g,Y.LINE_STRIP,be,Ce,Fe,yi.disabled,zm(ie,y),ze,Ue,Ze,Ke,null,null,null,[ve._globeTileDebugBorderBuffer]),I){const at=ve.latestRawTileData,Nt=Math.floor((at&&at.byteLength||0)/1024);let qt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(qt+=` => ${h.overscaledZ}`),qt+=` ${ve.state}`,qt+=` ${Nt}kb`,function(ln,_n){ln.initDebugOverlayCanvas();const En=ln.debugOverlayCanvas,Ct=ln.context.gl,on=ln.debugOverlayCanvas.getContext("2d");on.clearRect(0,0,En.width,En.height),on.shadowColor="white",on.shadowBlur=2,on.lineWidth=1.5,on.strokeStyle="white",on.textBaseline="top",on.font="bold 36px Open Sans, sans-serif",on.fillText(_n,5,5),on.strokeText(_n,5,5),ln.debugOverlayTexture.update(En),ln.debugOverlayTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE)}(g,qt)}const Xe=l.getTile(h).tileSize,Je=512/Math.min(Xe,512)*(h.overscaledZ/$.zoom)*.5,ot=ve._tileDebugTextBuffer||g.debugBuffer,mt=ve._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,lt=ve._tileDebugTextSegments||g.debugSegments;ye.draw(g,Y.TRIANGLES,be,Ce,Vi.alphaBlended,yi.disabled,zm(ie,s.bA.transparent,Je),ze,ot,mt,lt,null,null,null,[ve._globeTileDebugTextBuffer])}function Tt(g,l,h,y){Qc(g,0,l+h/2,g.transform.width,h,y)}function Wd(g,l,h,y){Qc(g,l-h/2,0,h,g.transform.height,y)}function Qc(g,l,h,y,S,E){const I=g.context,G=I.gl;G.enable(G.SCISSOR_TEST),G.scissor(l*s.q.devicePixelRatio,h*s.q.devicePixelRatio,y*s.q.devicePixelRatio,S*s.q.devicePixelRatio),I.clear({color:E}),G.disable(G.SCISSOR_TEST)}const Hs=s.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xr}=Hs;function Rs(g,l,h,y){g.emplaceBack(l,h,y)}class Xs{constructor(l){this.vertexArray=new s.d9,this.indices=new s.aP,Rs(this.vertexArray,-1,-1,1),Rs(this.vertexArray,1,-1,1),Rs(this.vertexArray,-1,1,1),Rs(this.vertexArray,1,1,1),Rs(this.vertexArray,-1,-1,-1),Rs(this.vertexArray,1,-1,-1),Rs(this.vertexArray,-1,1,-1),Rs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,xr),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.b2.simpleSegment(0,0,36,12)}}function Ps(g,l,h,y,S,E){const I=g.context.gl,G=l.paint.get("sky-atmosphere-color"),$=l.paint.get("sky-atmosphere-halo-color"),Y=l.paint.get("sky-atmosphere-sun-intensity"),X=((ee,ie,he,ye,ve)=>({u_matrix_3f:ee,u_sun_direction:ie,u_sun_intensity:he,u_color_tint_r:[ye.r,ye.g,ye.b,ye.a],u_color_tint_m:[ve.r,ve.g,ve.b,ve.a],u_luminance:5e-5}))(s.a6.mat3.fromMat4(s.a6.mat3.create(),y),S,Y,G,$);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,l.skyboxTexture,0),h.draw(g,I.TRIANGLES,ii.disabled,_i.disabled,Vi.unblended,yi.frontCW,X,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Ka=s.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class jd{constructor(l){const h=new s.da;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new s.aP;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(h,Ka.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=s.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fo=s.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Fu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Lu{constructor(l){this.colorModeAlphaBlendedWriteRGB=new Vi([1,zo,1,zo],s.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Vi([1,0,1,0],s.bA.transparent,[!1,!1,!1,!0]),this.params=new Fu,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const h=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new jd(h);const y=this.params.sizeRange,S=this.params.intensityRange,E=function(X){const ee=s.dd(30),ie=[];for(let he=0;he<X;++he){const ye=2*Math.PI*ee(),ve=Math.acos(1-2*ee())-.5*Math.PI;ie.push(s.a6.vec3.fromValues(Math.cos(ve)*Math.cos(ye),Math.cos(ve)*Math.sin(ye),Math.sin(ve)))}return ie}(this.params.starsCount),I=s.dd(300),G=new s.db,$=new s.aP;let Y=0;for(let X=0;X<E.length;++X){const ee=s.a6.vec3.scale([],E[X],200),ie=Math.max(0,1+.01*y*(1*I()-.5)),he=Math.max(0,1+.01*S*(1*I()-.5));G.emplaceBack(ee[0],ee[1],ee[2],-1,-1,ie,he),G.emplaceBack(ee[0],ee[1],ee[2],1,-1,ie,he),G.emplaceBack(ee[0],ee[1],ee[2],1,1,ie,he),G.emplaceBack(ee[0],ee[1],ee[2],-1,1,ie,he),$.emplaceBack(Y+0,Y+1,Y+2),$.emplaceBack(Y+0,Y+2,Y+3),Y+=4}this.starsVx=h.createVertexBuffer(G,fo.members),this.starsIdx=h.createIndexBuffer($),this.starsSegments=s.b2.simpleSegment(0,0,G.length,$.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,h){const y=l.context,S=y.gl,E=l.transform,I=new ii(S.LEQUAL,ii.ReadOnly,[0,1]),G=s.a9(E.zoom),$=l.style.getLut(h.scope),Y=h.properties.get("color").toRenderColor($).toArray01(),X=h.properties.get("high-color").toRenderColor($).toArray01(),ee=h.properties.get("space-color").toRenderColor($).toArray01PremultipliedAlpha(),ie=5e-4,he=s.dc(h.properties.get("horizon-blend"),0,1,ie,.25),ye=s.cx(l,y,E)&&he===ie?E.worldSize/(2*Math.PI*1.025)-1:E.globeRadius,ve=l.frameCounter/1e3%1,be=s.a6.vec3.length(E.globeCenterInViewSpace),Ce=Math.sqrt(Math.pow(be,2)-Math.pow(ye,2)),Fe=Math.acos(Ce/be),ze=Ue=>{const Ze=E.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ue&&Ze.push("ALPHA_PASS");const Ke=l.getOrCreateProgram("globeAtmosphere",{defines:Ze}),Xe=((ot,mt,lt,at,Nt,qt,ln,_n,En,Ct,on,Vt)=>({u_frustum_tl:ot,u_frustum_tr:mt,u_frustum_br:lt,u_frustum_bl:at,u_horizon:Nt,u_transition:qt,u_fadeout_range:ln,u_color:_n,u_high_color:En,u_space_color:Ct,u_temporal_offset:on,u_horizon_angle:Vt}))(E.frustumCorners.TL,E.frustumCorners.TR,E.frustumCorners.BR,E.frustumCorners.BL,E.frustumCorners.horizon,G,he,Y,X,ee,ve,Fe);l.uploadCommonUniforms(y,Ke);const Je=this.atmosphereBuffer;Je&&Ke.draw(l,S.TRIANGLES,I,_i.disabled,Ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,yi.backCW,Xe,Ue?"atmosphere_glow_alpha":"atmosphere_glow",Je.vertexBuffer,Je.indexBuffer,Je.segments)};ze(!1),ze(!0)}drawStars(l,h){const y=s.ap(h.properties.get("star-intensity"),0,1);if(y===0)return;const S=l.context,E=S.gl,I=l.transform,G=l.getOrCreateProgram("stars"),$=s.a6.quat.identity([]);s.a6.quat.rotateX($,$,-I._pitch),s.a6.quat.rotateZ($,$,-I.angle),s.a6.quat.rotateX($,$,s.bC(I._center.lat)),s.a6.quat.rotateY($,$,-s.bC(I._center.lng));const Y=s.a6.mat4.fromQuat(new Float32Array(16),$),X=s.a6.mat4.multiply([],I.starsProjMatrix,Y),ee=s.a6.mat3.fromMat4([],Y),ie=s.a6.mat3.invert([],ee),he=[0,1,0];s.a6.vec3.transformMat3(he,he,ie),s.a6.vec3.scale(he,he,this.params.sizeMultiplier);const ye=[1,0,0];s.a6.vec3.transformMat3(ye,ye,ie),s.a6.vec3.scale(ye,ye,this.params.sizeMultiplier);const ve=(be=he,Ce=ye,Fe=y,{u_matrix:Float32Array.from(X),u_up:be,u_right:Ce,u_intensity_multiplier:Fe});var be,Ce,Fe;l.uploadCommonUniforms(S,G),this.starsVx&&this.starsIdx&&G.draw(l,E.TRIANGLES,ii.disabled,_i.disabled,this.colorModeAlphaBlendedWriteRGB,yi.disabled,ve,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function $d(g,l){const h=[...g],y=l.cameraWorldSizeForFog/l.worldSize,S=s.a6.mat4.identity([]);return s.a6.mat4.scale(S,S,[y,y,1]),s.a6.mat4.multiply(h,S,h),s.a6.mat4.multiply(h,l.worldToFogMatrix,h),h}function qd(g,l,h,y,S){const E=h.material,I=y.context,{baseColorTexture:G,metallicRoughnessTexture:$}=E.pbrMetallicRoughness,{normalTexture:Y,occlusionTexture:X,emissionTexture:ee}=E;function ie(ye,ve,be){if(ye&&(g.push(ve),I.activeTexture.set(I.gl.TEXTURE0+be),ye.gfxTexture)){const{minFilter:Ce,magFilter:Fe,wrapS:ze,wrapT:Ue}=ye.sampler;ye.gfxTexture.bindExtraParam(Ce,Fe,ze,Ue)}}ie(G,"HAS_TEXTURE_u_baseColorTexture",ps.BaseColor),ie($,"HAS_TEXTURE_u_metallicRoughnessTexture",ps.MetallicRoughness),ie(Y,"HAS_TEXTURE_u_normalTexture",ps.Normal),ie(X,"HAS_TEXTURE_u_occlusionTexture",ps.Occlusion),ie(ee,"HAS_TEXTURE_u_emissionTexture",ps.Emission),S&&(S.texture||(S.texture=new s.df(y.context,S.image,[S.image.height,S.image.height,S.image.height],I.gl.RGBA8)),I.activeTexture.set(I.gl.TEXTURE0+ps.LUT),S.texture&&S.texture.bind(I.gl.LINEAR,I.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(h.pbrBuffer)),E.alphaMode!=="OPAQUE"&&E.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),E.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES");const he=y.shadowRenderer;he&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&g.push("NORMAL_OFFSET"))}function Ol(g,l,h,y,S,E){const I=h.paint.get("model-opacity"),G=l.context,$=new ii(l.context.gl.LEQUAL,ii.ReadWrite,l.depthRangeFor3D),Y=l.transform,X=g.mesh,ee=X.material,ie=ee.pbrMetallicRoughness,he=l.style.fog;let ye;ye=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:s.a6.mat4.multiply([],y.zScaleMatrix,g.nodeModelMatrix),s.a6.mat4.multiply(ye,y.negCameraPosMatrix,ye);const ve=s.a6.mat4.invert([],ye);s.a6.mat4.transpose(ve,ve);const be=h.paint.get("model-emissive-strength").constantOr(0),Ce=yc(new Float32Array(g.worldViewProjection),new Float32Array(ye),new Float32Array(ve),null,l,I,ie.baseColorFactor.toRenderColor(null),ee.emissiveFactor,ie.metallicFactor,ie.roughnessFactor,ee,be,h),Fe={defines:[]},ze=[],Ue=l.shadowRenderer;Ue&&(Ue.useNormalOffset=!1),qd(Fe.defines,ze,X,l,h.lut);let Ze=null;if(he){const Je=$d(g.nodeModelMatrix,l.transform);if(Ze=new Float32Array(Je),Y.projection.name!=="globe"){const ot=X.aabb.min,mt=X.aabb.max,[lt,at]=he.getOpacityForBounds(Je,ot[0],ot[1],mt[0],mt[1]);Fe.overrideFog=lt>=fn||at>=fn}}const Ke=fc(l,h.paint.get("model-cutoff-fade-range"));Ke.shouldRenderCutoff&&Fe.defines.push("RENDER_CUTOFF");const Xe=l.getOrCreateProgram("model",Fe);l.uploadCommonUniforms(G,Xe,null,Ze,Ke),l.renderPass!=="shadow"&&Ue&&Ue.setupShadowsFromMatrix(g.nodeModelMatrix,Xe),Xe.draw(l,G.gl.TRIANGLES,$,S,E,X.material.doubleSided?yi.disabled:yi.backCCW,Ce,h.id,X.vertexBuffer,X.indexBuffer,X.segments,h.paint,l.transform.zoom,void 0,ze)}function Go(g,l,h,y,S,E,I){let G;G=g.projection.name==="globe"?s.dg(h,g):[...h],s.a6.mat4.multiply(G,G,l.matrix);const $=s.a6.mat4.multiply([],y,G);if(l.meshes)for(const Y of l.meshes){if(Y.material.alphaMode!=="BLEND"){I.push({mesh:Y,depth:0,modelIndex:S,worldViewProjection:$,nodeModelMatrix:G});continue}const X=s.a6.vec3.transformMat4([],Y.centroid,$);X[2]>0&&E.push({mesh:Y,depth:X[2],modelIndex:S,worldViewProjection:$,nodeModelMatrix:G})}if(l.children)for(const Y of l.children)Go(g,Y,h,y,S,E,I)}function Zd(g,l,h,y){const S=h.shadowRenderer;if(!S)return;const E=S.getShadowPassDepthMode(),I=S.getShadowPassColorMode(),G=S.calculateShadowPassMatrixFromMatrix(l),$=Wv(G);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,E,_i.disabled,I,yi.backCCW,$,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,h.transform.zoom,void 0,void 0)}function jm(g,l,h){const y=l.updateZoomBasedPaintProperties(),S=function(E,I,G){let $,Y,X,ee=E.terrain?E.terrain.exaggeration():0;if(E.terrain&&ee>0){const ie=E.terrain,he=ie.findDEMTileFor(G);he&&he.dem?$=s.di.create(ie,G,he):ee=0}if(ee===0&&(I.terrainElevationMin=0,I.terrainElevationMax=0),ee===I.validForExaggeration&&(ee===0||$&&$._demTile&&$._demTile.tileID===I.validForDEMTile.id&&$._dem._timestamp===I.validForDEMTile.timestamp))return!1;for(const ie in I.instancesPerModel){const he=I.instancesPerModel[ie];for(let ye=0;ye<he.instancedDataArray.length;++ye){const ve=($?ee*$.getElevationAt(0|he.instancedDataArray.float32[16*ye],0|he.instancedDataArray.float32[16*ye+1],!0,!0):0)+he.instancesEvaluatedElevation[ye];he.instancedDataArray.float32[16*ye+6]=ve,Y=Y?Math.min(I.terrainElevationMin,ve):ve,X=X?Math.max(I.terrainElevationMax,ve):ve}}return I.terrainElevationMin=Y||0,I.terrainElevationMax=X||0,I.validForExaggeration=ee,I.validForDEMTile=$&&$._demTile?{id:$._demTile.tileID,timestamp:$._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,h);(y||S)&&(l.uploaded=!1,l.upload(g.context))}const _a={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.ca([0,0,0],[s.ab,s.ab,0])};function Ho(g,l){const h=1<<g.canonical.z,y=l.getFreeCameraOptions().position,S=l.elevation,E=g.canonical.x/h,I=(g.canonical.x+1)/h,G=g.canonical.y/h,$=(g.canonical.y+1)/h;let Y=l._centerAltitude;if(S){const he=S.getMinMaxForTile(g);he&&he.max>Y&&(Y=he.max)}const X=s.ap(y.x,E,I)-y.x,ee=s.ap(y.y,G,$)-y.y,ie=s.bE(Y,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(X*X+ee*ee+ie*ie))}function $m(g,l,h,y,S,E,I){const G=g.context,$=g.renderPass==="shadow",Y=g.shadowRenderer,X=$&&Y?Y.getShadowPassDepthMode():new ii(G.gl.LEQUAL,ii.ReadWrite,g.depthRangeFor3D),ee=g.isTileAffectedByFog(E);if(h.meshes)for(const ie of h.meshes){const he=["MODEL_POSITION_ON_GPU"],ye=[];let ve,be,Ce;y.instancedDataArray.length>20&&he.push("INSTANCED_ARRAYS");const Fe=fc(g,l.paint.get("model-cutoff-fade-range"));if(Fe.shouldRenderCutoff&&he.push("RENDER_CUTOFF"),$&&Y)ve=g.getOrCreateProgram("modelDepth",{defines:he}),be=Wv(I.shadowTileMatrix,I.shadowTileMatrix,Float32Array.from(h.matrix)),Ce=Y.getShadowPassColorMode();else{qd(he,ye,ie,g,l.lut),ve=g.getOrCreateProgram("model",{defines:he,overrideFog:ee});const Ue=ie.material,Ze=Ue.pbrMetallicRoughness,Ke=l.paint.get("model-opacity"),Xe=l.paint.get("model-emissive-strength").constantOr(0);be=yc(E.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,g,Ke,Ze.baseColorFactor.toRenderColor(null),Ue.emissiveFactor,Ze.metallicFactor,Ze.roughnessFactor,Ue,Xe,l,S),Y&&(I.shadowUniformsInitialized?ve.setShadowUniformValues(G,Y.getShadowUniformValues()):(Y.setupShadows(E.toUnwrapped(),ve,"model-tile",E.overscaledZ),I.shadowUniformsInitialized=!0)),Ce=Fe.shouldRenderCutoff||Ke<1||Ue.alphaMode!=="OPAQUE"?Vi.alphaBlended:Vi.unblended}g.uploadCommonUniforms(G,ve,E.toUnwrapped(),null,Fe);const ze=ie.material.doubleSided?yi.disabled:yi.backCCW;if(y.instancedDataArray.length>20)ye.push(y.instancedDataBuffer),ve.draw(g,G.gl.TRIANGLES,X,_i.disabled,Ce,ze,be,l.id,ie.vertexBuffer,ie.indexBuffer,ie.segments,l.paint,g.transform.zoom,void 0,ye,y.instancedDataArray.length);else{const Ue=$?"u_instance":"u_normal_matrix";for(let Ze=0;Ze<y.instancedDataArray.length;++Ze)be[Ue]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Ze,16),ve.draw(g,G.gl.TRIANGLES,X,_i.disabled,Ce,ze,be,l.id,ie.vertexBuffer,ie.indexBuffer,ie.segments,l.paint,g.transform.zoom,void 0,ye)}}if(h.children)for(const ie of h.children)$m(g,l,ie,y,S,E,I)}const sl=[1,-1,1];function Nr(g,l,h,y){if(!h.modelManager)return!0;const S=h.modelManager;if(!h.shadowRenderer)return!0;const E=h.shadowRenderer,I=l.aabb;let G=!0,$=g.maxHeight;if($===0){let X=0;for(const ee in g.instancesPerModel){const ie=S.getModel(ee,y);ie?X=Math.max(X,Math.max(Math.max(ie.aabb.max[0],ie.aabb.max[1]),ie.aabb.max[2])):G=!1}$=g.maxScale*X*1.41+g.maxVerticalOffset,G&&(g.maxHeight=$)}I.max[2]=$,I.min[2]+=g.terrainElevationMin,I.max[2]+=g.terrainElevationMax,s.a6.vec3.transformMat4(I.min,I.min,l.tileMatrix),s.a6.vec3.transformMat4(I.max,I.max,l.tileMatrix);const Y=I.intersects(E.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=Y===2),Y===0}function Qi(g,l){const h=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],S=g.uniformValues.u_cutoff_params[2],E=g.uniformValues.u_cutoff_params[3];return y===h||E===S?1:s.ap(((l-h)/(y-h)-S)/(E-S),0,1)}function ap(g,l,h,y){if(l.pitch<20)return 1;const S=l.getWorldToCameraMatrix();s.a6.mat4.multiply(S,S,g);const E=s.a6.vec4.fromValues(h.min[0],h.min[1],h.min[2],1);let I=s.a6.vec4.transformMat4(s.a6.vec4.create(),E,S),G=I,$=I;E[1]=h.max[1],I=s.a6.vec4.transformMat4(s.a6.vec4.create(),E,S),G=I[1]<G[1]?I:G,$=I[1]>$[1]?I:$,E[0]=h.max[0],I=s.a6.vec4.transformMat4(s.a6.vec4.create(),E,S),G=I[1]<G[1]?I:G,$=I[1]>$[1]?I:$,E[1]=h.min[1],I=s.a6.vec4.transformMat4(s.a6.vec4.create(),E,S),G=I[1]<G[1]?I:G,$=I[1]>$[1]?I:$;const Y=s.ap(y[0],0,1),X=100*l.pixelsPerMeter*s.ap(y[1],0,1),ee=s.ap(y[2],0,1),ie=s.a6.vec4.lerp(s.a6.vec4.create(),G,$,Y),he=Math.tan(.5*l.fovX),ye=-ie[2]*he;if(X===0)return ie[1]<-Math.abs(ye)?ee:1;const ve=(-Math.abs(ye)-ie[1])/X,be=(Fe,ze,Ue)=>(1-Ue)*Fe+Ue*ze,Ce=s.ap(be(1,ee,ve),ee,1);return be(1,Ce,s.ap((l.pitch-20)/20,0,1))}class ol{}class Xd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,h,y){{const ee=this._storage.get(h.id);if(ee)return ee.lastUsedFrameIdx=l,ee.buf}const S=y.gl,E=S.getBufferParameter(S.ELEMENT_ARRAY_BUFFER,S.BUFFER_SIZE),I=new ArrayBuffer(E),G=new Int16Array(I);S.getBufferSubData(S.ELEMENT_ARRAY_BUFFER,0,new Int16Array(I));const $=new s.dk;for(let ee=0;ee<E/2;ee+=3){const ie=G[ee],he=G[ee+1],ye=G[ee+2];$.emplaceBack(ie,he),$.emplaceBack(he,ye),$.emplaceBack(ye,ie)}const Y=y.bindVertexArrayOES.current,X=new ol;return X.buf=new na(y,$),X.lastUsedFrameIdx=l,this._storage.set(h.id,X),y.bindVertexArrayOES.set(Y),X.buf}update(l){for(const[h,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(h))}destroy(){for(const[l,h]of this._storage)h.buf.destroy(),this._storage.delete(l)}}class eu{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Kd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const Eo={symbol:function(g,l,h,y,S){if(g.renderPass!=="translucent")return;const E=_i.disabled,I=g.colorModeForRenderPass(),G=h.layout.get("text-variable-anchor"),$=h.layout.get("text-size-scale-range"),Y=s.ap(g.scaleFactor,$[0],$[1]);G&&function(ie,he,ye,ve,be,Ce,Fe,ze){const Ue=he.transform,Ze=be==="map",Ke=Ce==="map";for(const Xe of ie){const Je=ve.getTile(Xe),ot=Je.getBucket(ye);if(!ot||!ot.text||!ot.text.segments.get().length)continue;const mt=s.bk(ot.textSizeData,Ue.zoom,ze),lt=Tl(Xe,ot.getProjection(),Ue),at=Ue.calculatePixelsToTileUnitsMatrix(Je),Nt=ur(lt,Je.tileID.canonical,Ke,Ze,Ue,ot.getProjection(),at),qt=ot.hasIconTextFit()&&ot.hasIconData();if(mt){const ln=Math.pow(2,Ue.zoom-Je.tileID.overscaledZ);Gm(ot,Ze,Ke,Fe,s.cS,Ue,Nt,Xe,ln,mt,qt)}}}(y,g,h,l,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),S,Y);const X=h.paint.get("icon-opacity").constantOr(1)!==0,ee=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(X||ee)?zd(g,l,h,y,E,I):(X&&zd(g,l,h,y,E,I,{onlyIcons:!0}),ee&&zd(g,l,h,y,E,I,{onlyText:!0})),l.map.showCollisionBoxes&&(np(g,l,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),np(g,l,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,h,y){if(g.renderPass!=="translucent")return;const S=h.paint.get("circle-opacity"),E=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),G=h.layout.get("circle-sort-key").constantOr(1)!==void 0,$=h.paint.get("circle-emissive-strength");if(S.constantOr(1)===0&&(E.constantOr(1)===0||I.constantOr(1)===0))return;const Y=g.context,X=Y.gl,ee=g.transform,ie=g.depthModeForSublayer(0,ii.ReadOnly),he=_i.disabled,ye=g.colorModeForDrapableLayerRenderPass($),ve=ee.projection.name==="globe",be=[s.am(ee.center.lng),s.at(ee.center.lat)],Ce=[];for(let ze=0;ze<y.length;ze++){const Ue=y[ze],Ze=l.getTile(Ue),Ke=Ze.getBucket(h);if(!Ke||Ke.projection.name!==ee.projection.name)continue;const Xe=Ke.programConfigurations.get(h.id),Je=s.cT(h),ot=g.isTileAffectedByFog(Ue);ve&&Je.push("PROJECTION_GLOBE_VIEW"),Je.push("DEPTH_D24"),g.terrain&&ee.depthOcclusionForSymbolsAndCircles&&Je.push("DEPTH_OCCLUSION");const mt=g.getOrCreateProgram("circle",{config:Xe,defines:Je,overrideFog:ot}),lt=Ke.layoutVertexBuffer,at=Ke.globeExtVertexBuffer,Nt=Ke.indexBuffer,qt=ee.projection.createInversionMatrix(ee,Ue.canonical),ln={programConfiguration:Xe,program:mt,layoutVertexBuffer:lt,globeExtVertexBuffer:at,indexBuffer:Nt,uniformValues:s.cU(g,Ue,Ze,qt,be,h),tile:Ze};if(G){const _n=Ke.segments.get();for(const En of _n)Ce.push({segments:new s.b2([En]),sortKey:En.sortKey,state:ln})}else Ce.push({segments:Ke.segments,sortKey:0,state:ln})}G&&Ce.sort((ze,Ue)=>ze.sortKey-Ue.sortKey);const Fe={useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles};for(const ze of Ce){const{programConfiguration:Ue,program:Ze,layoutVertexBuffer:Ke,globeExtVertexBuffer:Xe,indexBuffer:Je,uniformValues:ot,tile:mt}=ze.state,lt=ze.segments;g.terrain&&g.terrain.setupElevationDraw(mt,Ze,Fe),g.uploadCommonUniforms(Y,Ze,mt.tileID.toUnwrapped()),Ze.draw(g,X.TRIANGLES,ie,he,ye,yi.disabled,ot,h.id,Ke,Je,lt,h.paint,ee.zoom,Ue,[Xe])}},heatmap:function(g,l,h,y){if(h.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const S=g.context,E=S.gl,I=_i.disabled,G=new Vi([E.ONE,E.ONE,E.ONE,E.ONE],s.bA.transparent,[!0,!0,!0,!0]);(function(he,ye,ve,be){const Ce=he.gl,Fe=ye.width*be,ze=ye.height*be;he.activeTexture.set(Ce.TEXTURE1),he.viewport.set([0,0,Fe,ze]);let Ue=ve.heatmapFbo;if(!Ue||Ue&&(Ue.width!==Fe||Ue.height!==ze)){Ue&&Ue.destroy();const Ze=Ce.createTexture();Ce.bindTexture(Ce.TEXTURE_2D,Ze),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR),Ue=ve.heatmapFbo=he.createFramebuffer(Fe,ze,!0,null),function(Ke,Xe,Je,ot,mt,lt){const at=Ke.gl;at.texImage2D(at.TEXTURE_2D,0,Ke.extRenderToTextureHalfFloat?at.RGBA16F:at.RGBA,mt,lt,0,at.RGBA,Ke.extRenderToTextureHalfFloat?at.HALF_FLOAT:at.UNSIGNED_BYTE,null),ot.colorAttachment.set(Je)}(he,0,Ze,Ue,Fe,ze)}else Ce.bindTexture(Ce.TEXTURE_2D,Ue.colorAttachment.get()),he.bindFramebuffer.set(Ue.framebuffer)})(S,g,h,g.transform.projection.name==="globe"?.5:.25),S.clear({color:s.bA.transparent});const $=g.transform,Y=$.projection.name==="globe",X=Y?["PROJECTION_GLOBE_VIEW"]:[],ee=Y?yi.frontCCW:yi.disabled,ie=[s.am($.center.lng),s.at($.center.lat)];for(let he=0;he<y.length;he++){const ye=y[he];if(l.hasRenderableParent(ye))continue;const ve=l.getTile(ye),be=ve.getBucket(h);if(!be||be.projection.name!==$.projection.name)continue;const Ce=g.isTileAffectedByFog(ye),Fe=be.programConfigurations.get(h.id),ze=g.getOrCreateProgram("heatmap",{config:Fe,defines:X,overrideFog:Ce}),{zoom:Ue}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ve,ze),g.uploadCommonUniforms(S,ze,ye.toUnwrapped());const Ze=$.projection.createInversionMatrix($,ye.canonical);ze.draw(g,E.TRIANGLES,ii.disabled,I,G,ee,Od(g,ye,ve,Ze,ie,Ue,h.paint.get("heatmap-intensity")),h.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,h.paint,g.transform.zoom,Fe,Y?[be.globeExtVertexBuffer]:null)}S.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(S,E){const I=S.context,G=I.gl,$=E.heatmapFbo;if(!$)return;I.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,$.colorAttachment.get()),I.activeTexture.set(G.TEXTURE1);let Y=E.colorRampTexture;Y||(Y=E.colorRampTexture=new s.T(I,E.colorRamp,G.RGBA8)),Y.bind(G.LINEAR,G.CLAMP_TO_EDGE),S.getOrCreateProgram("heatmapTexture").draw(S,G.TRIANGLES,ii.disabled,_i.disabled,S.colorModeForRenderPass(),yi.disabled,((X,ee,ie,he)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,E),E.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,E.paint,S.transform.zoom)}(g,h))},line:function(g,l,h,y){if(g.renderPass!=="translucent")return;const S=h.paint.get("line-opacity"),E=h.paint.get("line-width");if(S.constantOr(1)===0||E.constantOr(1)===0)return;const I=h.paint.get("line-emissive-strength"),G=h.paint.get("line-occlusion-opacity"),$=h.layout.get("line-elevation-reference")==="sea",Y=g.context,X=Y.gl,ee=!h.isDraped();if(ee&&g.transform.projection.name==="globe")return;const ie=h.layout.get("line-cross-slope"),he=ie!==void 0,ye=ie<1,ve=ee?new ii(g.depthOcclusion?X.GREATER:X.LEQUAL,ii.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,ii.ReadOnly),be=g.colorModeForDrapableLayerRenderPass(I),Ce=g.terrain&&g.terrain.renderingToTexture,Fe=Ce?1:s.q.devicePixelRatio,ze=h.paint.get("line-dasharray"),Ue=ze.constantOr(1),Ze=h.layout.get("line-cap"),Ke=ze.constantOr(null),Xe=Ze.constantOr(null),Je=h.paint.get("line-pattern"),ot=Je.constantOr(1),mt=Je.constantOr(null),lt=h.paint.get("line-opacity").constantOr(1);let at=!ot&&lt!==1||g.depthOcclusion&&G>0&&G<1;const Nt=h.paint.get("line-gradient"),qt=ot?"linePattern":"line",ln=s.cV(h);let _n;if(Ce&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(at=!1),G!==0&&g.depthOcclusion){const Ct=h.paint._values["line-opacity"];Ct&&Ct.value&&Ct.value.kind==="constant"?_n=Ct.value:s.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(ee&&(g.forceTerrainMode=!0),!ee&&G!==0&&g.terrain&&!Ce)return void s.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`);const En=at&&ee?g.stencilModeFor3D():_i.disabled;ee&&(ln.push("ELEVATED"),he&&ln.push(ye?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),$&&ln.push("ELEVATION_REFERENCE_SEA"));for(const Ct of y){const on=l.getTile(Ct);if(ot&&!on.patternsLoaded())continue;const Vt=on.getBucket(h);if(!Vt)continue;g.prepareDrawTile();const an=Vt.programConfigurations.get(h.id),un=g.isTileAffectedByFog(Ct),sn=g.getOrCreateProgram(qt,{config:an,defines:ln,overrideFog:un,overrideRtt:!ee&&void 0});if(mt&&on.imageAtlas){const On=on.imageAtlas.patternPositions[mt.toString()];On&&an.setConstantPatternPositions(On)}if(!ot&&Ke&&Xe&&on.lineAtlas){const On=on.lineAtlas.getDash(Ke,Xe);On&&an.setConstantPatternPositions(On)}let[Pn,Qn]=h.paint.get("line-trim-offset");(Xe==="round"||Xe==="square")&&Pn!==Qn&&(Pn===0&&(Pn-=1),Qn===1&&(Qn+=1));const ri=Ce?Ct.projMatrix:null,jn=ot?s.cW(g,on,h,ri,Fe,[Pn,Qn]):s.cX(g,on,h,ri,Vt.lineClipsArray.length,Fe,[Pn,Qn]);if(Nt){const On=Vt.gradients[h.id];let xi=On.texture;if(h.gradientVersion!==On.version){let Oi=256;if(h.stepInterpolant){const sr=l.getSource().maxzoom,jr=Ct.canonical.z===sr?Math.ceil(1<<g.transform.maxZoom-Ct.canonical.z):1;Oi=s.ap(s.cY(Vt.maxLineLength/s.ab*1024*jr),256,Y.maxTextureSize)}On.gradient=s.cZ({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Oi,image:On.gradient||void 0,clips:Vt.lineClipsArray}),On.texture?On.texture.update(On.gradient):On.texture=new s.T(Y,On.gradient,X.RGBA8),On.version=h.gradientVersion,xi=On.texture}Y.activeTexture.set(X.TEXTURE1),xi.bind(h.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}Ue&&(Y.activeTexture.set(X.TEXTURE0),on.lineAtlasTexture&&on.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),an.updatePaintBuffers()),ot&&(Y.activeTexture.set(X.TEXTURE0),on.imageAtlasTexture&&on.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),an.updatePaintBuffers()),ee&&!$&&g.terrain.setupElevationDraw(on,sn),g.uploadCommonUniforms(Y,sn,Ct.toUnwrapped());const li=On=>{_n!=null&&(_n.value=lt*G),sn.draw(g,X.TRIANGLES,ve,On,be,yi.disabled,jn,h.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,h.paint,g.transform.zoom,an,[Vt.layoutVertexBuffer2,Vt.patternVertexBuffer,Vt.zOffsetVertexBuffer]),_n!=null&&(_n.value=lt)};if(at&&!ee){const On=g.stencilModeForClipping(Ct).ref;On===0&&Ce&&Y.clear({stencil:0});const xi={func:X.EQUAL,mask:255};jn.u_alpha_discard_threshold=.8,li(new _i(xi,On,255,X.KEEP,X.KEEP,X.INVERT)),jn.u_alpha_discard_threshold=0,li(new _i(xi,On,255,X.KEEP,X.KEEP,X.KEEP))}else at&&ee&&(jn.u_alpha_discard_threshold=.001),li(ee?En:g.stencilModeForClipping(Ct))}ee&&(g.forceTerrainMode=!1),at&&(g.resetStencilClippingMasks(),Ce&&Y.clear({stencil:0})),G===0||g.depthOcclusion||Ce||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,l,h,y){const S=h.paint.get("fill-color"),E=h.paint.get("fill-opacity"),I=h.is3D(),G=new ii(g.context.gl.LEQUAL,ii.ReadWrite,g.depthRangeFor3D);if(E.constantOr(1)===0)return;const $=h.paint.get("fill-emissive-strength"),Y=g.colorModeForDrapableLayerRenderPass($),X=h.paint.get("fill-pattern"),ee=g.opaquePassEnabledForLayer()&&!X.constantOr(1)&&S.constantOr(s.bA.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===ee){const ie=I?G:g.depthModeForSublayer(1,g.renderPass==="opaque"?ii.ReadWrite:ii.ReadOnly);Vd(g,l,h,y,ie,Y,!1)}if(!I&&g.renderPass==="translucent"&&h.paint.get("fill-antialias")){const ie=I?G:g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,ii.ReadOnly);Vd(g,l,h,y,ie,Y,!0)}},"fill-extrusion":function(g,l,h,y){const S=h.paint.get("fill-extrusion-opacity"),E=g.context,I=E.gl,G=g.terrain,$=G&&G.renderingToTexture;if(S===0)return;const Y=g.conflationActive&&g.style.isLayerClipped(h,l.getSource()),X=g.style.order.indexOf(h.fqid);if(Y&&function(ee,ie,he,ye,ve){for(const be of ye){const Ce=ie.getTile(be).getBucket(he);Ce&&(Ce.updateReplacement(be,ee.replacementSource,ve),Ce.uploadCentroid(ee.context))}}(g,l,h,y,X),G||Y)for(const ee of y){const ie=l.getTile(ee).getBucket(h);ie&&Hm(g.context,l,ee,ie,h,G,Y)}if(g.renderPass==="shadow"&&g.shadowRenderer){const ee=g.shadowRenderer;if(G&&S<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a4)return;const ie=ee.getShadowPassDepthMode(),he=ee.getShadowPassColorMode();bo(g,l,h,y,ie,_i.disabled,he,Y)}else if(g.renderPass==="translucent"){const ee=!h.paint.get("fill-extrusion-pattern").constantOr(1),ie=h.paint.get("fill-extrusion-color").constantOr(s.bA.white);if(!$&&ie.a!==0){const he=new ii(g.context.gl.LEQUAL,ii.ReadWrite,g.depthRangeFor3D);S===1&&ee?bo(g,l,h,y,he,_i.disabled,Vi.unblended,Y):(bo(g,l,h,y,he,_i.disabled,Vi.disabled,Y),bo(g,l,h,y,he,g.stencilModeFor3D(),g.colorModeForRenderPass(),Y),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&ee&&(!G&&g.transform.projection.name!=="globe"||$)){const he=h.paint.get("fill-extrusion-opacity"),ye=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ve=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),be=h.paint.get("fill-extrusion-flood-light-intensity"),Ce=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),Fe=ye>0&&ve>0,ze=be>0,Ue=(Ke,Xe,Je)=>(1-Je)*Ke+Je*Xe,Ze=Ke=>{const Xe=g.depthModeForSublayer(1,ii.ReadOnly,I.LEQUAL,!0),Je=h.paint.get(Ke?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ot=Ue(.1,3,Je),mt=g._showOverdrawInspector;if(!mt){const lt=new _i({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),at=new Vi([I.ONE,I.ONE,I.ONE,I.ONE],s.bA.transparent,[!1,!1,!1,!0],I.MIN);Oa(g,l,h,y,Xe,lt,at,yi.disabled,Ke,"sdf",he,ye,ve,be,Ce,ot,Y,!1)}{const lt=mt?_i.disabled:new _i({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),at=mt?g.colorModeForRenderPass():new Vi([I.ONE_MINUS_DST_ALPHA,I.DST_ALPHA,I.ONE,I.ONE],s.bA.transparent,[!0,!0,!0,!0]);Oa(g,l,h,y,Xe,lt,at,yi.disabled,Ke,"color",he,ye,ve,be,Ce,ot,Y,!1)}};if($){const Ke=(Xe,Je,ot)=>{const mt=g.depthModeForSublayer(1,ii.ReadOnly,I.LEQUAL,!1),lt=h.paint.get(Xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),at=Ue(.1,3,lt);{const Nt=new Vi([I.ONE,I.ONE,I.ONE,I.ONE],s.bA.transparent,[!1,!1,!1,!0]);Oa(g,l,h,y,mt,_i.disabled,Nt,yi.disabled,Xe,"clear",he,ye,ve,be,Ce,at,Y,Je)}{const Nt=new _i({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),qt=new Vi([I.ONE,I.ONE,I.ONE,I.ONE],s.bA.transparent,[!1,!1,!1,!0],I.MIN);Oa(g,l,h,y,mt,Nt,qt,yi.disabled,Xe,"sdf",he,ye,ve,be,Ce,at,Y,Je)}{const Nt=Xe?I.ZERO:I.ONE_MINUS_DST_ALPHA,qt=new _i({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),ln=new Vi([Nt,I.DST_ALPHA,I.ONE_MINUS_DST_ALPHA,I.ZERO],s.bA.transparent,[!0,!0,!0,!0]);Oa(g,l,h,y,mt,qt,ln,yi.disabled,Xe,"color",he,ye,ve,be,Ce,at,Y,Je)}{const Nt=new Vi([I.ONE,I.ONE,I.ONE,Xe?I.ZERO:I.ONE],s.bA.transparent,[!1,!1,!1,!0],Xe?I.FUNC_ADD:I.MAX);Oa(g,l,h,y,mt,_i.disabled,Nt,yi.disabled,Xe,"clear",he,ye,ve,be,Ce,at,Y,Je,ot)}};if(Fe||ze){let Xe;if(g.prepareDrawTile(),G){const Je=G.drapeBufferSize[0],ot=G.drapeBufferSize[1];Xe=G.framebufferCopyTexture,Xe&&(!Xe||Xe.size[0]===Je&&Xe.size[1]===ot)||(Xe&&Xe.destroy(),Xe=G.framebufferCopyTexture=new s.T(E,new s.r({width:Je,height:ot}),I.RGBA8)),Xe.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,Je,ot)}Fe&&Ke(!0,!1,Xe),ze&&Ke(!1,!0,Xe)}}else Fe&&Ze(!0),ze&&Ze(!1),(Fe||ze)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,h,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const S=g.context,E=g.terrain&&g.terrain.renderingToTexture,[I,G]=g.renderPass!=="translucent"||E?[{},y]:g.stencilConfigForOverlap(y);for(const $ of G){const Y=l.getTile($);if(Y.needsHillshadePrepare&&g.renderPass==="offscreen")Fa(g,Y,h);else if(g.renderPass==="translucent"){const X=g.depthModeForSublayer(0,ii.ReadOnly),ee=h.paint.get("hillshade-emissive-strength"),ie=g.colorModeForDrapableLayerRenderPass(ee),he=E&&g.terrain?g.terrain.stencilModeForRTTOverlap($):I[$.overscaledZ];Rd(g,$,Y,h,X,he,ie)}}S.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,h,y,S,E){if(g.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const I=g.transform.projection.name==="globe",G=h.paint.get("raster-elevation")!==0,$=G&&I;if(g.renderElevatedRasterBackface&&!$)return;const Y=g.context,X=Y.gl,ee=l.getSource(),ie=function(Ke,Xe,Je,ot){const mt=Xe.paint.get("raster-color"),lt=Ke.type==="raster-array",at=[],Nt=Xe.paint.get("raster-resampling"),qt=Xe.paint.get("raster-color-mix");let ln=Xe.paint.get("raster-color-range");const _n=[qt[0],qt[1],qt[2],0],En=qt[3];let Ct=Nt==="nearest"?ot.NEAREST:ot.LINEAR;if(lt&&(at.push("RASTER_ARRAY"),mt||at.push("RASTER_COLOR"),Nt==="linear"&&at.push("RASTER_ARRAY_LINEAR"),Ct=ot.NEAREST,!ln&&Ke.rasterLayers)){const on=Ke.rasterLayers.find(({id:Vt})=>Vt===Xe.sourceLayer);on&&on.fields&&on.fields.range&&(ln=on.fields.range)}if(ln=ln||[0,1],mt){at.push("RASTER_COLOR"),Je.activeTexture.set(ot.TEXTURE2),Xe.updateColorRamp(ln);let on=Xe.colorRampTexture;on||(on=Xe.colorRampTexture=new s.T(Je,Xe.colorRamp,ot.RGBA8)),on.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}return{mix:_n,range:ln,offset:En,defines:at,resampling:Ct}}(ee,h,Y,X);if(ee instanceof s.aD&&!y.length&&!I)return;const he=h.paint.get("raster-emissive-strength"),ye=g.colorModeForDrapableLayerRenderPass(he),ve=g.terrain&&g.terrain.renderingToTexture,be=!g.options.moving,Ce=h.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;if(ee instanceof s.aD&&!y.length&&(ee.onNorthPole||ee.onSouthPole)){const Ke=G?g.stencilModeFor3D():_i.disabled;return void gs(!!ee.onNorthPole,null,g,l,h,he,ie,yi.disabled,Ke)}if(!y.length)return;const[Fe,ze]=ee instanceof s.aD||ve?[{},y]:g.stencilConfigForOverlap(y),Ue=ze[ze.length-1].overscaledZ;$&&ie.defines.push("PROJECTION_GLOBE_VIEW"),G&&ie.defines.push("RENDER_CUTOFF");const Ze=(Ke,Xe,Je)=>{for(const ot of Ke){const mt=ot.toUnwrapped(),lt=l.getTile(ot);if(ve&&(!lt||!lt.hasData()))continue;Y.activeTexture.set(X.TEXTURE0);const at=Hd(lt,ee,h,ie);if(!at||!at.texture)continue;const{texture:Nt,mix:qt,offset:ln,tileSize:_n,buffer:En}=at;let Ct,on;ve?(Ct=ii.disabled,on=ot.projMatrix):G?(Ct=new ii(X.LEQUAL,ii.ReadWrite,g.depthRangeFor3D),on=I?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(mt,be)):(Ct=g.depthModeForSublayer(ot.overscaledZ-Ue,h.paint.get("raster-opacity")===1?ii.ReadWrite:ii.ReadOnly,X.LESS),on=g.transform.calculateProjMatrix(mt,be));const Vt=g.terrain&&ve?g.terrain.stencilModeForRTTOverlap(ot):Fe[ot.overscaledZ],an=E?0:h.paint.get("raster-fade-duration");lt.registerFadeDuration(an);const un=l.findLoadedParent(ot,0),sn=Jf(lt,un,l,g.transform,an);let Pn,Qn;g.terrain&&g.terrain.prepareDrawTile(),Y.activeTexture.set(X.TEXTURE0),Nt.bind(Ce,X.CLAMP_TO_EDGE),Y.activeTexture.set(X.TEXTURE1),un?(un.texture&&un.texture.bind(Ce,X.CLAMP_TO_EDGE),Pn=Math.pow(2,un.tileID.overscaledZ-lt.tileID.overscaledZ),Qn=[lt.tileID.canonical.x*Pn%1,lt.tileID.canonical.y*Pn%1]):Nt.bind(Ce,X.CLAMP_TO_EDGE),Nt.useMipmap&&Y.extTextureFilterAnisotropic&&g.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const ri=g.transform;let jn;const li=G?ip(ri):[0,0,0,0];let On,xi,Oi,sr,jr,_r=0;if($&&ee instanceof s.aD&&ee.coordinates.length>3)On=Float32Array.from(s.b6(s.cC(new s.bQ(0,0,0)))),xi=Float32Array.from(ri.globeMatrix),Oi=Float32Array.from(s.cy(ri)),sr=[s.am(ri.center.lng),s.at(ri.center.lat)],jn=ee.elevatedGlobePerspectiveTransform,jr=ee.elevatedGlobeGridMatrix||new Float32Array(9);else if($){const Ki=s.cz(ot.canonical);_r=s.cA(Ki.getCenter().lat),On=Float32Array.from(s.b6(s.cC(ot.canonical))),xi=Float32Array.from(ri.globeMatrix),Oi=Float32Array.from(s.cy(ri)),sr=[s.am(ri.center.lng),s.at(ri.center.lat)],jn=[0,0],jr=Float32Array.from(s.cB(ot.canonical,Ki,_r,ri.worldSize/ri._pixelsPerMercatorPixel))}else jn=ee instanceof s.aD?ee.perspectiveTransform:[0,0],On=new Float32Array(16),xi=new Float32Array(9),Oi=new Float32Array(16),sr=[0,0],jr=new Float32Array(9);const ts=kd(on,On,xi,Oi,jr,Qn||[0,0],s.a9(g.transform.zoom),sr,li,Pn||1,sn,h,jn,G?h.paint.get("raster-elevation"):0,2,qt,ln,ie.range,_n,En,he),br=g.isTileAffectedByFog(ot),$r=g.getOrCreateProgram("raster",{defines:ie.defines,overrideFog:br});if(g.uploadCommonUniforms(Y,$r,mt),ee instanceof s.aD){const Ki=ee.elevatedGlobeVertexBuffer,Vr=ee.elevatedGlobeIndexBuffer;if(ve||!I)ee.boundsBuffer&&ee.boundsSegments&&$r.draw(g,X.TRIANGLES,Ct,_i.disabled,ye,yi.disabled,ts,h.id,ee.boundsBuffer,g.quadTriangleIndexBuffer,ee.boundsSegments);else if(Ki&&Vr){const Br=ri.zoom<=s.c3?ee.elevatedGlobeSegments:ee.getSegmentsForLongitude(ri.center.lng);Br&&$r.draw(g,X.TRIANGLES,Ct,_i.disabled,ye,Xe,ts,h.id,Ki,Vr,Br)}}else if($){Ct=new ii(X.LEQUAL,ii.ReadOnly,g.depthRangeFor3D);const Ki=g.globeSharedBuffers;if(Ki){const[Vr,Br,Rr]=Ki.getGridBuffers(_r,!1);$r.draw(g,X.TRIANGLES,Ct,Je||Vt,g.colorModeForRenderPass(),Xe,ts,h.id,Vr,Br,Rr)}}else{const{tileBoundsBuffer:Ki,tileBoundsIndexBuffer:Vr,tileBoundsSegments:Br}=g.getTileBoundsBuffers(lt);$r.draw(g,X.TRIANGLES,Ct,Vt,ye,yi.disabled,ts,h.id,Ki,Vr,Br)}}if(!(ee instanceof s.aD)&&$)for(const ot of Ke){const mt=ot.canonical.y===(1<<ot.canonical.z)-1;ot.canonical.y===0&&gs(!0,ot,g,l,h,he,ie,Xe,Je||_i.disabled),mt&&gs(!1,ot,g,l,h,he,ie,Xe===yi.frontCW?yi.backCW:yi.frontCW,Je||_i.disabled)}};$?Ze(ze,g.renderElevatedRasterBackface?yi.backCW:yi.frontCW,g.stencilModeFor3D()):Ze(ze,yi.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,h,y,S,E){g.renderPass==="offscreen"&&function(I,G,$,Y){if(!Y.length)return;const X=I.context,ee=X.gl,ie=G.getSource();if(!(ie instanceof di))return;const he=Math.ceil(Math.sqrt($.paint.get("raster-particle-count")));let ye=$.particlePositionRGBAImage;if(!ye||ye.width!==he){const ze=function(Ue){const Ze=Ue*Ue,Ke=new Uint8Array(4*Ze),Xe=function(ot){return ot|=0,ot=Math.imul(2747636419^ot,2654435769),ot=Math.imul(ot^ot>>>16,2654435769),((ot=Math.imul(ot^ot>>>16,2654435769))>>>0)/4294967296},Je=1/1.1;for(let ot=0;ot<Ze;ot++){const mt=Je*(Xe(2*ot+0)+Iu),lt=Je*(Xe(2*ot+1)+Iu),at=255*mt%1,Nt=255*lt%1,qt=at,ln=lt-Nt/255,_n=Nt;Ke[4*ot+0]=255*(mt-at/255),Ke[4*ot+1]=255*qt,Ke[4*ot+2]=255*ln,Ke[4*ot+3]=255*_n}return Ke}(he);ye=$.particlePositionRGBAImage=new s.r({width:he,height:he},ze)}let ve=$.particleFramebuffer;ve?ve.width!==he&&(ve.destroy(),ve=$.particleFramebuffer=X.createFramebuffer(he,he,!0,null)):ve=$.particleFramebuffer=X.createFramebuffer(he,he,!0,null);const be=[];for(const ze of Y){const Ue=G.getTile(ze);if(!(Ue instanceof Wa))continue;const Ze=op(Ue,ie,$);if(!Ze)continue;const Ke=[Ue.tileSize,Ue.tileSize];let Xe=$.tileFramebuffer;Xe||(Xe=$.tileFramebuffer=X.createFramebuffer(Ke[0],Ke[1],!0,null));let Je=Ue.rasterParticleState;Je||(Je=Ue.rasterParticleState=new sp(X,ze,Ke,ye));const ot=Je.update($.lastInvalidatedAt);Je.particleTextureDimension!==he&&Je.updateParticleTexture(ze,ye);const mt=Je.targetColorTexture;Je.targetColorTexture=Je.backgroundColorTexture,Je.backgroundColorTexture=mt;const lt=Je.particleTexture0;Je.particleTexture0=Je.particleTexture1,Je.particleTexture1=lt,be.push([ze,Ze,Je,ot])}if(be.length===0)return;const Ce=s.q.now(),Fe=$.previousDrawTimestamp?.001*(Ce-$.previousDrawTimestamp):.0167;if($.previousDrawTimestamp=Ce,$.hasColorMap()){X.activeTexture.set(ee.TEXTURE0+2);let ze=$.colorRampTexture;ze||(ze=$.colorRampTexture=new s.T(X,$.colorRamp,ee.RGBA8)),ze.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}X.bindFramebuffer.set($.tileFramebuffer.framebuffer),function(ze,Ue,Ze){const Ke=ze.context,Xe=Ke.gl,Je=Ue.tileFramebuffer;Ke.activeTexture.set(Xe.TEXTURE0);const ot={u_texture:0,u_opacity:1.05*(lt=Ue.paint.get("raster-particle-fade-opacity-factor"))/(lt+.05)},mt=ze.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var lt;for(const at of Ze){const[,,Nt,qt]=at;Je.colorAttachment.set(Nt.targetColorTexture.texture),Ke.viewport.set([0,0,Je.width,Je.height]),Ke.clear({color:s.bA.transparent}),qt&&(Nt.backgroundColorTexture.bind(Xe.NEAREST,Xe.CLAMP_TO_EDGE),mt.draw(ze,Xe.TRIANGLES,ii.disabled,_i.disabled,Vi.alphaBlended,yi.disabled,ot,Ue.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments))}}(I,$,be),function(ze,Ue,Ze,Ke){const Xe=ze.context,Je=Xe.gl,ot=Ze.tileFramebuffer,mt=ze.transform.projection.name==="globe",lt=Ze.paint.get("raster-particle-max-speed");for(const at of Ke){const[Nt,qt,ln]=at;Xe.activeTexture.set(Je.TEXTURE0+0),qt.texture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE),ot.colorAttachment.set(ln.targetColorTexture.texture);const _n=ze.getOrCreateProgram("rasterParticleDraw",{defines:qt.defines,overrideFog:!1});Xe.activeTexture.set(Je.TEXTURE0+1);const En=qt.scalarData?[]:[0,1,2,3].map(Vt=>s.c$[Vt](Nt));En.push(Nt);const Ct=Nt.canonical.x,on=Nt.canonical.y;for(const Vt of En){const an=Ue.getTile(mt?Vt.wrapped():Vt);if(!an)continue;const un=an.rasterParticleState;if(!un)continue;const sn=Vt.canonical.x+(1<<Vt.canonical.z)*(Vt.wrap-Nt.wrap),Pn=Vt.canonical.y;un.particleTexture0.bind(Je.NEAREST,Je.CLAMP_TO_EDGE);const Qn=Qf(1,un.particleTexture0.size[0],[sn-Ct,Pn-on],0,qt.texture.size,2,lt,qt.textureOffset,qt.scale,qt.offset);_n.draw(ze,Je.POINTS,ii.disabled,_i.disabled,Vi.alphaBlended,yi.disabled,Qn,Ze.id,un.particleIndexBuffer,void 0,un.particleSegment)}}}(I,G,$,be),X.bindFramebuffer.set($.particleFramebuffer.framebuffer),function(ze,Ue,Ze,Ke){const Xe=ze.context,Je=Xe.gl,ot=Ue.paint.get("raster-particle-max-speed"),mt=Ke*Ue.paint.get("raster-particle-speed-factor")*.15,lt=function(Nt){return Math.pow(Nt,6)}(.01+1*Ue.paint.get("raster-particle-reset-rate-factor")),at=Ue.particleFramebuffer;Xe.viewport.set([0,0,at.width,at.height]);for(const Nt of Ze){const[,qt,ln]=Nt;Xe.activeTexture.set(Je.TEXTURE0+0),qt.texture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE),Xe.activeTexture.set(Je.TEXTURE0+1);const _n=ln.particleTexture0;_n.bind(Je.NEAREST,Je.CLAMP_TO_EDGE);const En=ep(1,_n.size[0],0,qt.texture.size,ot,mt,lt,qt.textureOffset,qt.scale,qt.offset);at.colorAttachment.set(ln.particleTexture1.texture),Xe.clear({color:s.bA.transparent}),ze.getOrCreateProgram("rasterParticleUpdate",{defines:qt.defines}).draw(ze,Je.TRIANGLES,ii.disabled,_i.disabled,Vi.unblended,yi.disabled,En,Ue.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments)}}(I,$,be,Fe)}(g,l,h,y),g.renderPass==="translucent"&&(function(I,G,$,Y,X){const ee=I.context,ie=ee.gl,he=G.getSource().tileSize,ye=5*(1-s.a7(s.bV,s.bV+1,I.transform.zoom))*he+$.paint.get("raster-particle-elevation"),ve=!I.options.moving,be=I.transform.projection.name==="globe";if(!Y.length)return;const[Ce,Fe]=I.stencilConfigForOverlap(Y),ze=[];be&&ze.push("PROJECTION_GLOBE_VIEW");const Ue=I.stencilModeFor3D();for(const Ze of Fe){const Ke=Ze.toUnwrapped(),Xe=G.getTile(Ze);if(!Xe.rasterParticleState)continue;const Je=Xe.rasterParticleState,ot=100;Xe.registerFadeDuration(ot);const mt=G.findLoadedParent(Ze,0),lt=Jf(Xe,mt,G,I.transform,ot);let at,Nt;I.terrain&&I.terrain.prepareDrawTile(),ee.activeTexture.set(ie.TEXTURE0),Je.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ee.activeTexture.set(ie.TEXTURE1),mt&&mt.rasterParticleState?(mt.rasterParticleState.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),at=Math.pow(2,mt.tileID.overscaledZ-Xe.tileID.overscaledZ),Nt=[Xe.tileID.canonical.x*at%1,Xe.tileID.canonical.y*at%1]):Je.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const qt=be?Float32Array.from(I.transform.expandedFarZProjMatrix):I.transform.calculateProjMatrix(Ke,ve),ln=I.transform,_n=Wm(ln),En=s.cz(Ze.canonical),Ct=s.cA(En.getCenter().lat);let on,Vt,an,un,sn;be?(on=Float32Array.from(s.b6(s.cC(Ze.canonical))),Vt=Float32Array.from(ln.globeMatrix),an=Float32Array.from(s.cy(ln)),un=[s.am(ln.center.lng),s.at(ln.center.lat)],sn=Float32Array.from(s.cB(Ze.canonical,En,Ct,ln.worldSize/ln._pixelsPerMercatorPixel))):(on=new Float32Array(16),Vt=new Float32Array(9),an=new Float32Array(16),un=[0,0],sn=new Float32Array(9));const Pn=Rh(qt,on,Vt,an,sn,Nt||[0,0],s.a9(I.transform.zoom),un,_n,at||1,lt,ye),Qn=I.isTileAffectedByFog(Ze),ri=I.getOrCreateProgram("rasterParticle",{defines:ze,overrideFog:Qn});if(I.uploadCommonUniforms(ee,ri,Ke),be){const jn=new ii(ie.LEQUAL,ii.ReadOnly,I.depthRangeFor3D),li=0,On=I.globeSharedBuffers;if(On){const[xi,Oi,sr]=On.getGridBuffers(Ct,li!==0);ri.draw(I,ie.TRIANGLES,jn,Ue,Vi.alphaBlended,I.renderElevatedRasterBackface?yi.frontCCW:yi.backCCW,Pn,$.id,xi,Oi,sr)}}else{const jn=I.depthModeForSublayer(0,ii.ReadOnly),li=Ce[Ze.overscaledZ],{tileBoundsBuffer:On,tileBoundsIndexBuffer:xi,tileBoundsSegments:Oi}=I.getTileBoundsBuffers(Xe);ri.draw(I,ie.TRIANGLES,jn,li,Vi.alphaBlended,yi.disabled,Pn,$.id,On,xi,Oi)}}I.resetStencilClippingMasks()}(g,l,h,y),g.style.map.triggerRepaint())},background:function(g,l,h,y){const S=h.paint.get("background-color"),E=h.paint.get("background-opacity"),I=h.paint.get("background-emissive-strength"),G=h.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const $=g.context,Y=$.gl,X=g.transform,ee=X.tileSize,ie=h.paint.get("background-pattern");let he;if(ie!==void 0&&(ie===null||(he=g.imageManager.getPattern(ie.toString(),h.scope,g.style.getLut(h.scope)),!he)))return;const ye=!ie&&S.a===1&&E===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==ye)return;const ve=_i.disabled,be=g.depthModeForSublayer(0,ye==="opaque"?ii.ReadWrite:ii.ReadOnly),Ce=g.colorModeForDrapableLayerRenderPass(I),Fe=ie?"backgroundPattern":"background";let ze,Ue=y;if(Ue||(ze=g.getBackgroundTiles(),Ue=Object.values(ze).map(Ze=>Ze.tileID)),ie&&($.activeTexture.set(Y.TEXTURE0),g.imageManager.bind(g.context,h.scope)),G){const Ze=g.getOrCreateProgram(Fe,{overrideFog:!1,overrideRtt:!0}),Ke=new Float32Array(s.a6.mat4.identity([])),Xe=new s.aA(0,0,0,0,0),Je=ie?tp(Ke,I,E,g,0,h.scope,he,G,{tileID:Xe,tileSize:ee}):Th(Ke,I,E,S.toRenderColor(h.lut));Ze.draw(g,Y.TRIANGLES,be,ve,Ce,yi.disabled,Je,h.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Ze of Ue){const Ke=g.isTileAffectedByFog(Ze),Xe=g.getOrCreateProgram(Fe,{overrideFog:Ke}),Je=Ze.toUnwrapped(),ot=y?Ze.projMatrix:g.transform.calculateProjMatrix(Je);g.prepareDrawTile();const mt=l?l.getTile(Ze):ze?ze[Ze.key]:new Zr(Ze,ee,X.zoom,g),lt=ie?tp(ot,I,E,g,0,h.scope,he,G,{tileID:Ze,tileSize:ee}):Th(ot,I,E,S.toRenderColor(h.lut));g.uploadCommonUniforms($,Xe,Je);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:Nt,tileBoundsSegments:qt}=g.getTileBoundsBuffers(mt);Xe.draw(g,Y.TRIANGLES,be,ve,Ce,yi.disabled,lt,h.id,at,Nt,qt)}},sky:function(g,l,h){const y=g._atmosphere?s.a9(g.transform.zoom):1,S=h.paint.get("sky-opacity")*y;if(S===0)return;const E=g.context,I=h.paint.get("sky-type"),G=new ii(E.gl.LEQUAL,ii.ReadOnly,[0,1]),$=g.frameCounter/1e3%1;I==="atmosphere"?g.renderPass==="offscreen"?h.needsSkyboxCapture(g)&&(function(Y,X,ee,ie){const he=Y.context,ye=he.gl;let ve=X.skyboxFbo;if(!ve){ve=X.skyboxFbo=he.createFramebuffer(32,32,!0,null),X.skyboxGeometry=new Xs(he),X.skyboxTexture=he.gl.createTexture(),ye.bindTexture(ye.TEXTURE_CUBE_MAP,X.skyboxTexture),ye.texParameteri(ye.TEXTURE_CUBE_MAP,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_CUBE_MAP,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_CUBE_MAP,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_CUBE_MAP,ye.TEXTURE_MAG_FILTER,ye.LINEAR);for(let ze=0;ze<6;++ze)ye.texImage2D(ye.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,ye.RGBA,32,32,0,ye.RGBA,ye.UNSIGNED_BYTE,null)}he.bindFramebuffer.set(ve.framebuffer),he.viewport.set([0,0,32,32]);const be=X.getCenter(Y,!0),Ce=Y.getOrCreateProgram("skyboxCapture"),Fe=new Float64Array(16);s.a6.mat4.identity(Fe),s.a6.mat4.rotateY(Fe,Fe,.5*-Math.PI),Ps(Y,X,Ce,Fe,be,0),s.a6.mat4.identity(Fe),s.a6.mat4.rotateY(Fe,Fe,.5*Math.PI),Ps(Y,X,Ce,Fe,be,1),s.a6.mat4.identity(Fe),s.a6.mat4.rotateX(Fe,Fe,.5*-Math.PI),Ps(Y,X,Ce,Fe,be,2),s.a6.mat4.identity(Fe),s.a6.mat4.rotateX(Fe,Fe,.5*Math.PI),Ps(Y,X,Ce,Fe,be,3),s.a6.mat4.identity(Fe),Ps(Y,X,Ce,Fe,be,4),s.a6.mat4.identity(Fe),s.a6.mat4.rotateY(Fe,Fe,Math.PI),Ps(Y,X,Ce,Fe,be,5),he.viewport.set([0,0,Y.width,Y.height])}(g,h),h.markSkyboxValid(g)):g.renderPass==="sky"&&function(Y,X,ee,ie,he){const ye=Y.context,ve=ye.gl,be=Y.transform,Ce=Y.getOrCreateProgram("skybox");ye.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_CUBE_MAP,X.skyboxTexture);const Fe=((ze,Ue,Ze,Ke,Xe)=>({u_matrix:ze,u_sun_direction:Ue,u_cubemap:0,u_opacity:Ke,u_temporal_offset:Xe}))(be.skyboxMatrix,X.getCenter(Y,!1),0,ie,he);Y.uploadCommonUniforms(ye,Ce),Ce.draw(Y,ve.TRIANGLES,ee,_i.disabled,Y.colorModeForRenderPass(),yi.backCW,Fe,"skybox",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(g,h,G,S,$):I==="gradient"&&g.renderPass==="sky"&&function(Y,X,ee,ie,he){const ye=Y.context,ve=ye.gl,be=Y.transform,Ce=Y.getOrCreateProgram("skyboxGradient");X.skyboxGeometry||(X.skyboxGeometry=new Xs(ye)),ye.activeTexture.set(ve.TEXTURE0);let Fe=X.colorRampTexture;Fe||(Fe=X.colorRampTexture=new s.T(ye,X.colorRamp,ve.RGBA8)),Fe.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);const ze=((Ue,Ze,Ke,Xe,Je)=>({u_matrix:Ue,u_color_ramp:0,u_center_direction:Ze,u_radius:s.bC(Ke),u_opacity:Xe,u_temporal_offset:Je}))(be.skyboxMatrix,X.getCenter(Y,!1),X.paint.get("sky-gradient-radius"),ie,he);Y.uploadCommonUniforms(ye,Ce),Ce.draw(Y,ve.TRIANGLES,ee,_i.disabled,Y.colorModeForRenderPass(),yi.backCW,ze,"skyboxGradient",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(g,h,G,S,$)},debug:function(g,l,h,y,S,E){for(let I=0;I<h.length;I++)if(S){const Y=new s.bA(y.r*.8,y.g*.8,y.b*.8,1);Ur(g,l,h[I],y,-1,-1,E),Ur(g,l,h[I],y,-1,1,E),Ur(g,l,h[I],y,1,1,E),Ur(g,l,h[I],y,1,-1,E),Ur(g,l,h[I],Y,0,0,E)}else Ur(g,l,h[I],y,0,0,E)},custom:function(g,l,h,y){const S=g.context,E=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&h.isDraped(l)){if(g.renderPass==="offscreen"){const I=E.prerender;if(I){if(g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const G=g.transform.pointMerc;I.call(E,S.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.a9(g.transform.zoom),[G.x,G.y],g.transform.pixelsPerMeterRatio)}else I.call(E,S.gl,g.transform.customLayerMatrix());S.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const G=E.renderToTile;if(G){const $=y[0].canonical,Y=new s.a5($.x+y[0].wrap*(1<<$.z),$.y,$.z);S.setDepthMode(ii.disabled),S.setStencilMode(_i.disabled),S.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),G.call(E,S.gl,Y),S.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),S.setStencilMode(_i.disabled);const I=E.renderingMode==="3d"?new ii(g.context.gl.LEQUAL,ii.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,ii.ReadOnly);if(S.setDepthMode(I),g.transform.projection.name==="globe"){const G=g.transform.pointMerc;E.render(S.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.a9(g.transform.zoom),[G.x,G.y],g.transform.pixelsPerMeterRatio)}else E.render(S.gl,g.transform.customLayerMatrix());S.setDirty(),g.setBaseState(),S.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,h,y){if(g.renderPass==="opaque")return;const S=h.paint.get("model-opacity");if(S===0)return;const E=h.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!E||g.terrain&&S<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof s.a4))return;const I=g.shadowRenderer,G=h.paint.get("model-receive-shadows");I&&(I.useNormalOffset=!0,G||(I.enabled=!1));const $=()=>{I&&(I.useNormalOffset=!0,G||(I.enabled=!0))},Y=l.getSource();if(g.renderPass==="light-beam"&&Y.type!=="batched-model")return;if(Y.type==="vector"||Y.type==="geojson")return function(Ce,Fe,ze,Ue,Ze){const Ke=Ce.transform;if(Ke.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${Ke.projection.name} projection is not yet implemented`);const Xe=Ke.getFreeCameraOptions().position;if(!Ce.modelManager)return;const Je=Ce.modelManager;ze.modelManager=Je;const ot=Ce.shadowRenderer;if(!ze._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const mt=ze._unevaluatedLayout._values["model-id"],lt={...ze.layout.get("model-id").parameters},at=Ce.style.order.indexOf(ze.fqid);for(const Nt of Ue){const qt=Fe.getTile(Nt).getBucket(ze);if(!qt||qt.projection.name!==Ke.projection.name)continue;const ln=qt.getModelUris();ln&&!qt.modelsRequested&&(Je.addModelsFromBucket(ln,Ze),qt.modelsRequested=!0);const _n=Ho(Nt,Ke);lt.zoom=_n;const En=mt.possiblyEvaluate(lt);if(jm(Ce,qt,Nt),_a.shadowUniformsInitialized=!1,_a.useSingleShadowCascade=!!ot&&ot.getMaxCascadeForTile(Nt.toUnwrapped())===0,Ce.renderPass==="shadow"&&ot){if(Ce.currentShadowCascade===1&&qt.isInsideFirstShadowMapFrustum)continue;const Vt=Ke.calculatePosMatrix(Nt.toUnwrapped(),Ke.worldSize);if(_a.tileMatrix.set(Vt),_a.shadowTileMatrix=Float32Array.from(ot.calculateShadowPassMatrixFromMatrix(Vt)),_a.aabb.min.fill(0),_a.aabb.max[0]=_a.aabb.max[1]=s.ab,_a.aabb.max[2]=0,Nr(qt,_a,Ce,ze.scope))continue}const Ct=1<<Nt.canonical.z,on=[((Xe.x-Nt.wrap)*Ct-Nt.canonical.x)*s.ab,(Xe.y*Ct-Nt.canonical.y)*s.ab,Xe.z*Ct*s.ab];Ce.conflationActive&&Object.keys(qt.instancesPerModel).length>0&&Ce.style.isLayerClipped(ze,Fe.getSource())&&qt.updateReplacement(Nt,Ce.replacementSource,at,Ze)&&(qt.uploaded=!1,qt.upload(Ce.context));for(let Vt in qt.instancesPerModel){const an=qt.instancesPerModel[Vt];an.features.length>0&&(Vt=En.evaluate(an.features[0].feature,{}));const un=Je.getModel(Vt,Ze);if(un&&un.uploaded)for(const sn of un.nodes)$m(Ce,ze,sn,an,on,Nt,_a)}}}(g,l,h,y,Y.type==="vector"?h.scope:""),void $();if(!Y.loaded())return;if(Y.type==="batched-model")return function(Ce,Fe,ze,Ue){ze.resetLayerRenderingStats(Ce);const Ze=Ce.context,Ke=Ce.transform,Xe=Ce.style.fog,Je=Ce.shadowRenderer;if(Ke.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Ke.projection.name} projection is not yet implemented`);const ot=Ce.transform.getFreeCameraOptions().position,mt=s.a6.vec3.scale([],[ot.x,ot.y,ot.z],Ce.transform.worldSize),lt=s.a6.vec3.negate([],mt),at=s.a6.mat4.identity([]),Nt=s.de(Ke.center.lat,Ke.zoom),qt=s.a6.mat4.fromScaling([],[1,1,1/Nt]);s.a6.mat4.translate(at,at,lt);const ln=ze.paint.get("model-opacity"),_n=new ii(Ze.gl.LEQUAL,ii.ReadWrite,Ce.depthRangeFor3D),En=new ii(Ze.gl.LEQUAL,ii.ReadOnly,Ce.depthRangeFor3D),Ct=new s.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),on=Ce.renderPass==="shadow",Vt=on&&Je?Je.getCurrentCascadeFrustum():Ke.getFrustum(Ke.scaleZoom(Ke.worldSize)),an=ze.paint.get("model-front-cutoff"),un=an[2]<1,sn=fc(Ce,ze.paint.get("model-cutoff-fade-range")),Pn=ze.getLayerRenderingStats();(function(Qn,ri,jn,li){const On=Qn.terrain?Qn.terrain.exaggeration():0,xi=Qn.transform.zoom;for(const Oi of li){const sr=ri.getTile(Oi).getBucket(jn);sr&&(Qn.conflationActive&&sr.updateReplacement(Oi,Qn.replacementSource),sr.evaluateScale(Qn,jn),Qn.terrain&&On>0&&sr.elevationUpdate(Qn.terrain,On,Oi,jn.source),sr.needsReEvaluation(Qn,xi,jn)&&sr.evaluate(jn))}})(Ce,Fe,ze,Ue),function(){let Qn,ri,jn;un?(Qn=Ue.length-1,ri=-1,jn=-1):(Qn=0,ri=Ue.length,jn=1);const li=new Float64Array(16),On=s.a6.vec3.create(),xi=new s.P(0,0);for(let Oi=Qn;Oi!==ri;Oi+=jn){const sr=Ue[Oi],jr=Fe.getTile(sr).getBucket(ze);if(!jr||!jr.uploaded)continue;let _r=!1;Je&&(_r=Je.getMaxCascadeForTile(sr.toUnwrapped())===0);const ts=Ke.calculatePosMatrix(sr.toUnwrapped(),Ke.worldSize),br=jr.modelTraits;!on&&un&&(s.a6.mat4.invert(li,ts),s.a6.vec3.transformMat4(On,mt,li),xi.x=On[0],xi.y=On[1]);const $r=[];for(const Ki of jr.getNodesInfo()){if(Ki.hiddenByReplacement||!Ki.node.meshes)continue;const Vr=Ki.node;let Br=0;Ce.terrain&&Vr.elevation&&(Br=Vr.elevation*Ce.terrain.exaggeration());const Rr=(()=>{const Us=Ki.aabb;return Ct.min=[...Us.min],Ct.max=[...Us.max],Ct.min[2]+=Br,Ct.max[2]+=Br,s.a6.vec3.transformMat4(Ct.min,Ct.min,ts),s.a6.vec3.transformMat4(Ct.max,Ct.max,ts),Ct})(),us=Ki.evaluatedScale;if(us[0]<=1&&us[1]<=1&&us[2]<=1&&Rr.intersects(Vt)===0)continue;if(!on&&un){const Us=.16666666666666666;Ki.cameraCollisionOpacity=mt[0]>Rr.min[0]&&mt[0]<Rr.max[0]&&mt[1]>Rr.min[1]&&mt[1]<Rr.max[1]&&mt[2]*Nt<Rr.max[2]&&Vr.footprint&&s.bv(xi,Vr.footprint)?Math.max(Ki.cameraCollisionOpacity-Us,0):Math.min(1,Ki.cameraCollisionOpacity+Us)}const mo=[...ts],Bl=Vr.anchor?Vr.anchor[0]:0,wc=Vr.anchor?Vr.anchor[1]:0;s.a6.mat4.translate(mo,mo,[Bl*(us[0]-1),wc*(us[1]-1),Br]),s.a6.vec3.exactEquals(us,s.dh)||s.a6.mat4.scale(mo,mo,us);const To=s.a6.mat4.multiply([],mo,Vr.matrix),mr=s.a6.mat4.multiply([],Ke.expandedFarZProjMatrix,To),ar=s.a6.mat4.multiply([],Ke.expandedFarZProjMatrix,mo),Er=s.a6.vec4.transformMat4([],[Bl,wc,Br,1],mr)[2];Vr.hidden=!1;let Xr=ln;on||(un&&(Xr*=Ki.cameraCollisionOpacity,Xr*=ap(mo,Ke,Ki.aabb,an)),Xr*=Qi(sn,Er)),Xr!==0?$r.push({nodeInfo:Ki,depth:Er,opacity:Xr,wvpForNode:mr,wvpForTile:ar,nodeModelMatrix:To,tileModelMatrix:mo}):Vr.hidden=!0}on||$r.sort((Ki,Vr)=>!un||Ki.opacity===1&&Vr.opacity===1?Ki.depth<Vr.depth?-1:1:Ki.opacity===1?-1:Vr.opacity===1?1:Ki.depth>Vr.depth?-1:1);for(const Ki of $r){const Vr=Ki.nodeInfo,Br=Vr.node;let Rr=s.a6.mat4.multiply([],qt,Ki.tileModelMatrix);s.a6.mat4.multiply(Rr,at,Rr);const us=s.a6.mat4.invert([],Rr);s.a6.mat4.transpose(us,us),s.a6.mat4.scale(us,us,sl),Rr=s.a6.mat4.multiply(Rr,Rr,Br.matrix);const mo=Ce.renderPass==="light-beam",Bl=br&s.dj.HasMapboxMeshFeatures,wc=Bl?0:Vr.evaluatedRMEA[0][2];for(let To=0;To<Br.meshes.length;++To){const mr=Br.meshes[To],ar=To===Br.lightMeshIndex;let Er=Ki.wvpForNode;if(ar){if(!mo&&!Ce.terrain&&Ce.shadowRenderer){Ce.currentLayer<Ce.firstLightBeamLayer&&(Ce.firstLightBeamLayer=Ce.currentLayer);continue}Er=Ki.wvpForTile}else if(mo)continue;const Xr={defines:[]},Us=[];if(!on&&Je&&(Je.useNormalOffset=!!mr.normalBuffer),qd(Xr.defines,Us,mr,Ce,ze.lut),Bl||Xr.defines.push("DIFFUSE_SHADED"),_r&&Xr.defines.push("SHADOWS_SINGLE_CASCADE"),Pn&&(on?Pn.numRenderedVerticesInShadowPass+=mr.vertexArray.length:Pn.numRenderedVerticesInTransparentPass+=mr.vertexArray.length),on){Zd(mr,Ki.nodeModelMatrix,Ce,ze);continue}let hs=null;if(Xe){const ru=$d(Ki.nodeModelMatrix,Ce.transform);if(hs=new Float32Array(ru),Ke.projection.name!=="globe"){const hl=mr.aabb.min,Lh=mr.aabb.max,[Sc,Ir]=Xe.getOpacityForBounds(ru,hl[0],hl[1],Lh[0],Lh[1]);Xr.overrideFog=Sc>=fn||Ir>=fn}}const Wo=mr.material;let Bu;Wo.occlusionTexture&&Wo.occlusionTexture.offsetScale&&(Bu=Wo.occlusionTexture.offsetScale,Xr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const cl=Ce.getOrCreateProgram("model",Xr);!on&&Je&&Je.setupShadowsFromMatrix(Ki.tileModelMatrix,cl,Je.useNormalOffset),Ce.uploadCommonUniforms(Ze,cl,null,hs);const ul=Wo.pbrMetallicRoughness;ul.metallicFactor=.9,ul.roughnessFactor=.5;const Cc=yc(new Float32Array(Er),new Float32Array(Rr),new Float32Array(us),new Float32Array(Br.matrix),Ce,Ki.opacity,ul.baseColorFactor.toRenderColor(null),Wo.emissiveFactor,ul.metallicFactor,ul.roughnessFactor,Wo,wc,ze,[0,0,0],Bu);!ar&&(Vr.hasTranslucentParts||Ki.opacity<1)&&cl.draw(Ce,Ze.gl.TRIANGLES,_n,_i.disabled,Vi.disabled,yi.backCCW,Cc,ze.id,mr.vertexBuffer,mr.indexBuffer,mr.segments,ze.paint,Ce.transform.zoom,void 0,Us),cl.draw(Ce,Ze.gl.TRIANGLES,ar?En:_n,_i.disabled,ar||Ki.opacity<1||Vr.hasTranslucentParts?Vi.alphaBlended:Vi.unblended,yi.backCCW,Cc,ze.id,mr.vertexBuffer,mr.indexBuffer,mr.segments,ze.paint,Ce.transform.zoom,void 0,Us)}}}}()}(g,l,h,y),void $();if(Y.type!=="model")return;const X=Y.getModels(),ee=[],ie=g.transform.getFreeCameraOptions().position,he=s.a6.vec3.scale([],[ie.x,ie.y,ie.z],g.transform.worldSize);s.a6.vec3.negate(he,he);const ye=[],ve=[];let be=0;for(const Ce of X){const Fe=h.paint.get("model-rotation").constantOr(null),ze=h.paint.get("model-scale").constantOr(null),Ue=h.paint.get("model-translation").constantOr(null);Ce.computeModelMatrix(g,Fe,ze,Ue,!0,!0,!1);const Ze=s.a6.mat4.identity([]),Ke=s.de(Ce.position.lat,g.transform.zoom),Xe=s.a6.mat4.fromScaling([],[1,1,1/Ke]);s.a6.mat4.translate(Ze,Ze,he),ee.push({zScaleMatrix:Xe,negCameraPosMatrix:Ze});for(const Je of Ce.nodes)Go(g.transform,Je,Ce.matrix,g.transform.expandedFarZProjMatrix,be,ye,ve);be++}if(ye.sort((Ce,Fe)=>Fe.depth-Ce.depth),g.renderPass!=="shadow"){if(S===1)for(const Ce of ve)Ol(Ce,g,h,ee[Ce.modelIndex],_i.disabled,g.colorModeForRenderPass());else{for(const Ce of ve)Ol(Ce,g,h,ee[Ce.modelIndex],_i.disabled,Vi.disabled);for(const Ce of ve)Ol(Ce,g,h,ee[Ce.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const Ce of ye)Ol(Ce,g,h,ee[Ce.modelIndex],_i.disabled,g.colorModeForRenderPass());$()}else{for(const Ce of ve)Zd(Ce.mesh,Ce.nodeModelMatrix,g,h);for(const Ce of ye)Zd(Ce.mesh,Ce.nodeModelMatrix,g,h);$()}}},pa={model:function(g,l,h){const y=l.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const S=y.getModels();for(const E of S)E.upload(h.context)},raster:function(g,l,h){const y=l.getSource();if(!(y instanceof di&&y.loaded()))return;const S=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!S)return;const E=g.paint.get("raster-array-band")||y.getInitialBand(S);if(E==null)return;const I=l.getIds().map(G=>l.getTileByID(G));for(const G of I)G.updateNeeded(S,E)&&y.prepareTile(G,S,E)},"raster-particle":function(g,l,h){const y=l.getSource();if(!(y instanceof di&&y.loaded()))return;const S=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!S)return;const E=g.paint.get("raster-particle-array-band")||y.getInitialBand(S);if(E==null)return;const I=l.getIds().map(G=>l.getTileByID(G));for(const G of I)G.updateNeeded(S,E)&&y.prepareTile(G,S,E)}};class Mo{constructor(l,h,y,S,E){this.context=new Ah(l,h),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=E,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const $ of I)this._debugParams.enabledLayers[$]=!0;E.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),E.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),E.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),E.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const $ of I)E.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],$);this.occlusionParams=new eu(E),this.setup(),this.numSublayers=Qo.maxUnderzooming+Qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new bd(this),this._wireframeDebugCache=new Xd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const G=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,G,l.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=S}updateTerrain(l,h){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ld(this,l));const S=this._terrain;this.transform.elevation=y?S:null,S.update(l,this.transform,h),this.transform.elevation&&!S.enabled&&(this.transform.elevation=null)}_updateFog(l){const h=l.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,S]=h.getFovAdjustedRange(this.transform._fov);if(y>S)return void(this.transform.fogCullDistSq=null);const E=y+.78*(S-y);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new Ld(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,h){if(this.width=l*s.q.devicePixelRatio,this.height=h*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,h=new s.a$;h.emplaceBack(0,0),h.emplaceBack(s.ab,0),h.emplaceBack(0,s.ab),h.emplaceBack(s.ab,s.ab),this.tileExtentBuffer=l.createVertexBuffer(h,s.b1.members),this.tileExtentSegments=s.b2.simpleSegment(0,0,4,2);const y=new s.a$;y.emplaceBack(0,0),y.emplaceBack(s.ab,0),y.emplaceBack(0,s.ab),y.emplaceBack(s.ab,s.ab),this.debugBuffer=l.createVertexBuffer(y,s.b1.members),this.debugSegments=s.b2.simpleSegment(0,0,4,5);const S=new s.a$;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(S,s.b1.members),this.viewportSegments=s.b2.simpleSegment(0,0,4,2);const E=new s.aO;E.emplaceBack(0,0,0,0),E.emplaceBack(s.ab,0,s.ab,0),E.emplaceBack(0,s.ab,0,s.ab),E.emplaceBack(s.ab,s.ab,s.ab,s.ab),this.mercatorBoundsBuffer=l.createVertexBuffer(E,s.b4.members),this.mercatorBoundsSegments=s.b2.simpleSegment(0,0,4,2);const I=new s.aP;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(I);const G=new s.b0;for(const Y of[0,1,3,2,0])G.emplaceBack(Y);this.debugIndexBuffer=l.createIndexBuffer(G),this.emptyTexture=new s.T(l,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA8),this.identityMat=s.a6.mat4.create();const $=this.context.gl;this.stencilClearMode=new _i({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,ii.disabled,this.stencilClearMode,Vi.disabled,yi.disabled,La(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,h,y){if(!h||this.currentStencilSource===h.id||!l.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let G=!1;for(const $ of y)if(this._tileClippingMaskIDs[$.key]===void 0){G=!0;break}if(!G)return}this.currentStencilSource=h.id;const S=this.context,E=S.gl;this.nextStencilID+y.length>256&&this.clearStencil(),S.setColorMode(Vi.disabled),S.setDepthMode(ii.disabled);const I=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const G of y){const $=h.getTile(G),Y=this._tileClippingMaskIDs[G.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:ee,tileBoundsSegments:ie}=this.getTileBoundsBuffers($);I.draw(this,E.TRIANGLES,ii.disabled,new _i({func:E.ALWAYS,mask:0},Y,255,E.KEEP,E.KEEP,E.REPLACE),Vi.disabled,yi.disabled,La(G.projMatrix),"$clipping",X,ee,ie)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new _i({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const h=this.context.gl;return new _i({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((I,G)=>G.overscaledZ-I.overscaledZ),S=y[y.length-1].overscaledZ,E=y[0].overscaledZ-S+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let G=0;G<E;G++)I[G+S]=new _i({func:h.GEQUAL,mask:255},G+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=E,[I,y]}return[{[S]:_i.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Vi([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new s.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vi.unblended:Vi.alphaBlended}colorModeForDrapableLayerRenderPass(l){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Vi([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new s.bA(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,h,y,S=!1){if(this.depthOcclusion)return new ii(this.context.gl.GREATER,ii.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!S)return ii.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ii(y||this.context.gl.LEQUAL,h,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,h=Math.ceil(this.width),y=Math.ceil(this.height),S=this.context.bindFramebuffer.get(),E=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&y!==0&&(this.depthFBO=new n0(this.context,h,y,!1,"texture"),this.depthTexture=new s.T(this.context,{width:h,height:y,data:null},l.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(S),l.bindTexture(l.TEXTURE_2D,E),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,h,y,0,0,h,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,h)=>l+h/this._fpsHistory.length,0))}render(l,h){const y=s.q.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=h;const S=this.style._mergedLayers,E=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(lt=>{const at=S[lt];return!(at.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[at.type]});let I=!1,G=!1;for(const lt of E){const at=S[lt];at.type==="circle"&&(I=!0),at.type==="symbol"&&(at.hasInitialOcclusionOpacityProperties?G=!0:I=!0)}const $=E.map(lt=>S[lt]),Y=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let X=0,ee=!1;for(const lt in Y){const at=Y[lt];at.used&&(at.prepare(this.context),at.getSource().usedInConflation&&++X)}let ie=!1;for(const lt of $)lt.isHidden(this.transform.zoom)||(lt.type==="clip"&&(ie=!0),this.prepareLayer(lt));const he={},ye={},ve={},be={},Ce={};for(const lt in Y){const at=Y[lt];he[lt]=at.getVisibleCoordinates(),ye[lt]=he[lt].slice().reverse(),ve[lt]=at.getVisibleCoordinates(!0).reverse(),be[lt]=at.getShadowCasterCoordinates(),Ce[lt]=at.sortCoordinatesByDistance(he[lt])}const Fe=lt=>{const at=this.style.getLayerSourceCache(lt);return at&&at.used?at.getSource():null};if(X||ie||this._clippingActiveLastFrame){const lt=[],at=[];let Nt=0;for(const qt of $)this.isSourceForClippingOrConflation(qt,Fe(qt))&&(lt.push(qt),at.push(Nt)),Nt++;if(lt&&(ie||lt.length>1)||this._clippingActiveLastFrame){ie=!1;const qt=[];for(let ln=0;ln<lt.length;ln++){const _n=lt[ln],En=at[ln],Ct=this.style.getLayerSourceCache(_n);if(!Ct||!Ct.used||!Ct.getSource().usedInConflation&&_n.type!=="clip")continue;let on=s.dn,Vt=s.bt.None;const an=[];let un=!0;if(_n.type==="clip"){on=En;for(const sn of _n.layout.get("clip-layer-types"))Vt|=sn==="model"?s.bt.Model:sn==="symbol"?s.bt.Symbol:s.bt.FillExtrusion;for(const sn of _n.layout.get("clip-layer-scope"))an.push(sn);_n.isHidden(this.transform.zoom)?un=!1:ie=!0}un&&qt.push({layer:_n.fqid,cache:Ct,order:on,clipMask:Vt,clipScope:an})}this.replacementSource.setSources(qt),ee=!0}}this._clippingActiveLastFrame=ie,ee||this.replacementSource.clear(),this.conflationActive=ee,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let lt=0;lt<$.length;lt++){const at=$[lt],Nt=at.cutoffRange();if(this.longestCutoffRange=Math.max(Nt,this.longestCutoffRange),Nt>0){const qt=Fe(at);qt&&(this.minCutoffZoom=Math.max(qt.minzoom,this.minCutoffZoom)),at.minzoom&&(this.minCutoffZoom=Math.max(at.minzoom,this.minCutoffZoom))}at.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=lt),this._lastOcclusionLayer=lt)}const ze=this.style&&this.style.fog;ze?(this._fogVisible=ze.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ze.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ve),this.opaquePassCutoff=0);const Ue=this._shadowRenderer;if(Ue){Ue.updateShadowParameters(this.transform,this.style.directionalLight);for(const lt in Y)for(const at of he[lt]){let Nt={min:0,max:0};this.terrain&&(Nt=this.terrain.getMinMaxForTile(at)||Nt),Ue.addShadowReceiver(at.toUnwrapped(),Nt.min,Nt.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Lu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Kt.has(this.context.gl))return;this.renderPass="offscreen";for(const lt of $){const at=l.getLayerSourceCache(lt);if(!lt.hasOffscreenPass()||lt.isHidden(this.transform.zoom))continue;const Nt=at?ye[at.id]:void 0;(lt.type==="custom"||lt.type==="raster"||lt.type==="raster-particle"||lt.isSky()||Nt&&Nt.length)&&this.renderLayer(this,at,lt,Nt)}this.depthRangeFor3D=[0,1-($.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,be)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ze=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ke=(()=>{if(h.showOverdrawInspector)return s.bA.black;const lt=this.style.fog;if(lt&&this.transform.projection.supportsFog){const at=this.style.getLut(lt.scope);if(!Ze){const Nt=lt.properties.get("color").toRenderColor(at).toArray01();return new s.bA(...Nt)}if(Ze){const Nt=lt.properties.get("space-color").toRenderColor(at).toArray01();return new s.bA(...Nt)}}return s.bA.transparent})();if(this.context.clear({color:Ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const lt=$[this.currentLayer],at=l.getLayerSourceCache(lt);if(lt.isSky())continue;const Nt=at?(lt.is3D()?Ce:ye)[at.id]:void 0;this._renderTileClippingMasks(lt,at,Nt),this.renderLayer(this,at,lt,Nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const lt=$[this.currentLayer],at=l.getLayerSourceCache(lt);lt.isSky()&&this.renderLayer(this,at,lt,at?ye[at.id]:void 0)}function Xe(lt,at){let Nt;return at&&(Nt=(lt.type==="symbol"?ve:lt.is3D()?Ce:ye)[at.id]),Nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const lt=$[this.currentLayer];if(lt.type==="raster"||lt.type==="raster-particle"){const at=l.getLayerSourceCache(lt);this.renderLayer(this,at,lt,Xe(lt,at))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Je=0;Ue&&(Je=Ue.getShadowCastingLayerCount());let ot=!1,mt=-1;for(let lt=0;lt<E.length;++lt){const at=$[lt];at.isHidden(this.transform.zoom)||at.is3D()&&(mt=lt)}for(G&&mt===-1&&(I=!0);this.currentLayer<E.length;){const lt=$[this.currentLayer],at=l.getLayerSourceCache(lt);if(lt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(lt)){if(lt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(I&&!ot&&this.terrain&&!this.transform.isOrthographic&&(ot=!0,this.blitDepth()),G&&mt!==-1&&this.currentLayer===mt+1&&!this.transform.isOrthographic&&this.blitDepth(),lt.is3D()||this.terrain||this._renderTileClippingMasks(lt,at,at?he[at.id]:void 0),this.renderLayer(this,at,lt,Xe(lt,at)),!this.terrain&&Ue&&Je>0&&lt.hasShadowPass()&&--Je==0&&(Ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Nt;this.currentLayer++){const qt=$[this.currentLayer];if(!qt.hasLightBeamPass())continue;const ln=l.getLayerSourceCache(qt);this.renderLayer(this,ln,qt,ln?ye[ln.id]:void 0)}this.currentLayer=Nt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Nt=this.currentLayer;this.depthOcclusion=!0;for(const qt of this.layersWithOcclusionOpacity){this.currentLayer=qt;const ln=$[this.currentLayer],_n=l.getLayerSourceCache(ln),En=_n?ye[_n.id]:void 0;ln.is3D()||this.terrain||this._renderTileClippingMasks(ln,_n,_n?he[_n.id]:void 0),this.renderLayer(this,_n,ln,En)}this.depthOcclusion=!1,this.currentLayer=Nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let lt=null;$.forEach(at=>{const Nt=l.getLayerSourceCache(at);Nt&&!at.isHidden(this.transform.zoom)&&Nt.getVisibleCoordinates().length&&(!lt||lt.getSource().maxzoom<Nt.getSource().maxzoom)&&(lt=Nt)}),lt&&this.options.showTileBoundaries&&Eo.debug(this,lt,lt.getVisibleCoordinates(),s.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Eo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(lt){const at=lt.transform.padding;Tt(lt,lt.transform.height-(at.top||0),3,xc),Tt(lt,at.bottom||0,3,Du),Wd(lt,at.left||0,3,yn),Wd(lt,lt.transform.width-(at.right||0),3,ni);const Nt=lt.transform.centerPoint;(function(qt,ln,_n,En){Qc(qt,ln-1,_n-10,2,20,En),Qc(qt,ln-10,_n-1,20,2,En)})(lt,Nt.x,lt.transform.height-Nt.y,Ph)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ee||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:h}=this.transform.projection,y=!h||!h.includes(l.type);if(pa[l.type]&&(y||this.terrain&&l.type==="custom")){const S=this.style.getLayerSourceCache(l);pa[l.type](l,S,this)}this.gpuTimingEnd()}renderLayer(l,h,y,S){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||S&&S.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||y.type!=="custom")||y.type==="clip"||Eo[y.type](l,h,y,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,y=this.context.gl;let S=this.gpuTimers[l.id];S||(S=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),S.calls++,y.beginQuery(h.TIME_ELAPSED_EXT,S.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,h=this.context.gl,y=h.createQuery();this.deferredRenderGpuTimeQueries.push(y),h.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const h={};for(const y in l){const S=l[y],E=this.context.extTimerQuery,I=E.getQueryParameter(S.query,this.context.gl.QUERY_RESULT)/1e6;E.deleteQueryEXT(S.query),h[y]=I}return h}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let y=0;for(const S of l)y+=h.getQueryParameter(S,h.QUERY_RESULT)/1e6,h.deleteQuery(S);return y}translatePosMatrix(l,h,y,S,E){if(!y[0]&&!y[1])return l;const I=E?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(I){const Y=Math.sin(I),X=Math.cos(I);y=[y[0]*X-y[1]*Y,y[0]*Y+y[1]*X]}const G=[E?y[0]:s.ak(h,y[0],this.transform.zoom),E?y[1]:s.ak(h,y[1],this.transform.zoom),0],$=new Float32Array(16);return s.a6.mat4.translate($,l,G),$}saveTileTexture(l){const h=l.size[0],y=this._tileTextures[h];y?y.push(l):this._tileTextures[h]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,h,y){const S=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,E=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):S||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||E.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||S||h!==void 0&&!h||E.push("FOG","FOG_DITHERING"),S&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(l,h){this.cache=this.cache||{};const y=h&&h.defines||[],S=h&&h.config,E=this.currentGlobalDefines(l,h&&h.overrideFog,h&&h.overrideRtt).concat(y),I=Jc.cacheKey(il[l],l,E,S);return this.cache[I]||(this.cache[I]=new Jc(this.context,l,il[l],S,ci[l],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,h){if(this.style.enable3dLights()){const y=this.style.directionalLight,S=this.style.ambientLight;if(y&&S){const E=((I,G,$)=>{const Y=I.properties.get("direction"),X=I.properties.get("color").toRenderColor($.getLut(I.scope)).toArray01(),ee=I.properties.get("intensity"),ie=G.properties.get("color").toRenderColor($.getLut(G.scope)).toArray01(),he=G.properties.get("intensity"),ye=[Y.x,Y.y,Y.z],ve=s.cH(ie,he),be=s.cH(X,ee);return{u_lighting_ambient_color:ve,u_lighting_directional_dir:ye,u_lighting_directional_color:be,u_ground_radiance:Fm(ye,be,ve)}})(y,S,this.style);h.setLightsUniformValues(l,E)}}}uploadCommonUniforms(l,h,y,S,E){if(this.uploadCommonLightUniforms(l,h),this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const G=I.getOpacity(this.transform.pitch),$=((Y,X,ee,ie,he,ye,ve,be,Ce,Fe,ze,Ue)=>{const Ze=Y.transform,Ke=X.properties.get("color").toRenderColor(Y.style.getLut(X.scope)).toArray01();Ke[3]=ie;const Xe=Y.frameCounter/1e3%1,[Je,ot]=X.properties.get("vertical-range");return{u_fog_matrix:ee?Ze.calculateFogTileMatrix(ee):Ue||Y.identityMat,u_fog_range:X.getFovAdjustedRange(Ze._fov),u_fog_color:Ke,u_fog_horizon_blend:X.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Je,ot),ot],u_fog_temporal_offset:Xe,u_frustum_tl:he,u_frustum_tr:ye,u_frustum_br:ve,u_frustum_bl:be,u_globe_pos:Ce,u_globe_radius:Fe,u_viewport:ze,u_globe_transition:s.a9(Ze.zoom),u_is_globe:+(Ze.projection.name==="globe")}})(this,I,y,G,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],S);h.setFogUniformValues(l,$)}E&&h.setCutoffUniformValues(l,E.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,h=l.createTexture();return l.bindTexture(l.TEXTURE_2D,h),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const S of y)h[S.key]=l[S.key]||new Zr(S,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,h){return!(!l.is3D()||l.type!=="clip"&&(l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerPresent||l.sourceLayer!=="building")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[l.key];return h||(this._cachedTileFogOpacities[l.key]=h=this.style.fog.getOpacityForTile(l)),h[0]>=fn||h[1]>=fn}setupDepthForOcclusion(l,h,y){const S=this.context,E=S.gl,I=!!y;var G;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),S.activeTexture.set(E.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((G=this.depthRangeFor3D)[1]-G[0]),-1-2*G[0]/(G[1]-G[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.activeTexture.set(E.TEXTURE0),I||h.setTerrainUniformValues(S,y)}}function al(g,l){let h=!1,y=null;const S=()=>{y=null,h&&(g(),y=setTimeout(S,l),h=!1)};return()=>(h=!0,y||S(),y)}class ia{constructor(l){this._hashName=l&&encodeURIComponent(l),s.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=al(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const h=Yd(l);if(this._hashName){const y=this._hashName;let S=!1;const E=location.hash.slice(1).split("&").map(I=>{const G=I.split("=")[0];return G===y?(S=!0,`${G}=${h}`):I}).filter(I=>I);return S||E.push(`${y}=${h}`),`#${E.join("&")}`}return`#${h}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let h;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(h[3]||0):l.getBearing();return l.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Yd(g,l){const h=g.getCenter(),y=Math.round(100*g.getZoom())/100,S=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,S),I=Math.round(h.lng*E)/E,G=Math.round(h.lat*E)/E,$=g.getBearing(),Y=g.getPitch();let X=l?`/${I}/${G}/${y}`:`${y}/${G}/${I}`;return($||Y)&&(X+="/"+Math.round(10*$)/10),Y&&(X+=`/${Math.round(Y)}`),X}const Ou={linearity:.3,easing:s.dp(0,0,.3,1)},lp=s.l({deceleration:2500,maxSpeed:1400},Ou),Xv=s.l({deceleration:20,maxSpeed:1400},Ou),xa=s.l({deceleration:1e3,maxSpeed:360},Ou),qm=s.l({deceleration:1e3,maxSpeed:90},Ou);class cp{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=s.q.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(h.pan.mag()){const E=ll(h.pan.mag(),y,s.l({},lp,l||{}));S.offset=h.pan.mult(E.amount/h.pan.mag()),S.center=this._map.transform.center,ku(S,E)}if(h.zoom){const E=ll(h.zoom,y,Xv);S.zoom=this._map.transform.zoom+E.amount,ku(S,E)}if(h.bearing){const E=ll(h.bearing,y,xa);S.bearing=this._map.transform.bearing+s.ap(E.amount,-179,179),ku(S,E)}if(h.pitch){const E=ll(h.pitch,y,qm);S.pitch=this._map.transform.pitch+E.amount,ku(S,E)}if(S.zoom||S.bearing){const E=h.pinchAround===void 0?h.around:h.pinchAround;S.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function ku(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function ll(g,l,h){const{maxSpeed:y,linearity:S,deceleration:E}=h,I=s.ap(g*S/(l/1e3),-y,y),G=Math.abs(I)/(E*S);return{easing:h.easing,duration:1e3*G,amount:I*(G/2)}}class ss extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,S={}){const E=pe(h.getCanvasContainer(),y),I=h.unproject(E);super(l,s.l({point:E,lngLat:I,originalEvent:y},S)),this._defaultPrevented=!1,this.target=h}}class Ih extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const S=l==="touchend"?y.changedTouches:y.touches,E=fe(h.getCanvasContainer(),S),I=E.map($=>h.unproject($)),G=E.reduce(($,Y,X,ee)=>$.add(Y.div(ee.length)),new s.P(0,0));super(l,{points:E,point:G,lngLats:I,lngLat:h.unproject(G),originalEvent:y}),this._defaultPrevented=!1}}class up extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class tu{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new up(this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new ss(l.type,this._map,l))}mouseup(l){this._map.fire(new ss(l.type,this._map,l))}preclick(l){const h=s.l({},l);h.type="preclick",this._map.fire(new ss(h.type,this._map,h))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ss(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ss(l.type,this._map,l))}mouseover(l){this._map.fire(new ss(l.type,this._map,l))}mouseout(l){this._map.fire(new ss(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Ih(l.type,this._map,l))}touchmove(l){this._map.fire(new Ih(l.type,this._map,l))}touchend(l){this._map.fire(new Ih(l.type,this._map,l))}touchcancel(l){this._map.fire(new Ih(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ss(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ss("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ss(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kv{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(q(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h,S=this._startPos,E=this._lastPos;if(!S||!E||E.equals(y)||!this._box&&y.dist(S)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const I=Math.min(S.x,y.x),G=Math.max(S.x,y.x),$=Math.min(S.y,y.y),Y=Math.max(S.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${$}px)`,this._box.style.width=G-I+"px",this._box.style.height=Y-$+"px")})}mouseupWindow(l,h){if(!this._active)return;const y=this._startPos,S=h;if(y&&l.button===0){if(this.reset(),ae(),y.x!==S.x||y.y!==S.y)return this._map.fire(new s.x("boxzoomend",{originalEvent:l})),{cameraAnimation:E=>E.fitScreenCoordinates(y,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.x(l,{originalEvent:h}))}}function hp(g,l){const h={};for(let y=0;y<g.length;y++)h[g[y].identifier]=l[y];return h}class Yv{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(S){const E=new s.P(0,0);for(const I of S)E._add(I);return E.div(S.length)}(h),this.touches=hp(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const S=hp(y,h);for(const E in this.touches){const I=S[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class kl{constructor(l){this.singleTap=new Yv(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const S=this.singleTap.touchend(l,h,y);if(S){const E=l.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(S)<30;if(E&&I||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Jv{constructor(){this._zoomIn=new kl({numTouches:1,numTaps:2}),this._zoomOut=new kl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const S=this._zoomIn.touchend(l,h,y),E=this._zoomOut.touchend(l,h,y);return S?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(S)},{originalEvent:l})}):E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nl={0:1,2:2};class Jd{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,h){return!1}_move(l,h){return{}}mousedown(l,h){if(this._lastPoint)return;const y=ue(l);this._correctButton(l,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(l,h){const y=this._lastPoint;if(y){if(l.preventDefault(),this._eventButton!=null&&function(S,E){const I=Nl[E];return S.buttons===void 0||(S.buttons&I)!==I}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}}mouseupWindow(l){this._lastPoint&&ue(l)===this._eventButton&&(this._moved&&ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ra extends Jd{mousedown(l,h){super.mousedown(l,h),this._lastPoint&&(this._active=!0)}_correctButton(l,h){return h===0&&!l.ctrlKey}_move(l,h){return{around:h,panDelta:h.sub(l)}}}class Zm extends Jd{_correctButton(l,h){return h===0&&l.ctrlKey||h===2}_move(l,h){const y=.8*(h.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class dp extends Jd{_correctButton(l,h){return h===0&&l.ctrlKey||h===2}_move(l,h){const y=-.5*(h.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class r0{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),s.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!s.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,h,y)}}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const S=hp(y,h),E=new s.P(0,0),I=new s.P(0,0);let G=0;for(const Y in S){const X=S[Y],ee=this._touches[Y];ee&&(E._add(X),I._add(X.sub(ee)),G++,S[Y]=X)}if(this._touches=S,G<this._minTouches||!I.mag())return;const $=I.div(G);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(G),panDelta:$}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Xm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,h,y){return{}}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){const S=this._firstTwoTouches;if(!S)return;l.preventDefault();const[E,I]=S,G=Qd(y,h,E),$=Qd(y,h,I);if(!G||!$)return;const Y=this._aroundCenter?null:G.add($).div(2);return this._move([G,$],Y,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[S,E]=this._firstTwoTouches,I=Qd(y,h,S),G=Qd(y,h,E);I&&G||(this._active&&ae(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qd(g,l,h){for(let y=0;y<g.length;y++)if(g[y].identifier===h)return l[y]}function Km(g,l){return Math.log(g/l)/Math.LN2}class s0 extends Xm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Km(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Km(this._distance,y),pinchAround:h}}}function Na(g,l){return 180*g.angleWith(l)/Math.PI}class Ym extends Xm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Na(this._vector,y),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const S=Na(l,y);return Math.abs(S)<h}}function Jm(g){return Math.abs(g.y)>Math.abs(g.x)}class nu extends Xm{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Jm(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){const S=this._lastPoints;if(!S)return;const E=l[0].sub(S[0]),I=l[1].sub(S[1]);return this._map._cooperativeGestures&&!s.dq()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(l,h,y){if(this._valid!==void 0)return this._valid;const S=l.mag()>=2,E=h.mag()>=2;if(!S&&!E)return;if(!S||!E)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const I=l.y>0==h.y>0;return Jm(l)&&Jm(h)&&I}}const fp={panStep:100,bearingStep:15,pitchStep:10};class Nu{constructor(){const l=fp;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,S=0,E=0,I=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),E=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),E=1);break;case 38:l.shiftKey?S=1:(l.preventDefault(),I=-1);break;case 40:l.shiftKey?S=-1:(l.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(y=0,S=0),{cameraAnimation:G=>{const $=G.getZoom();G.easeTo({duration:300,easeId:"keyboardHandler",easing:pp,zoom:h?Math.round($)+h*(l.shiftKey?2:1):$,bearing:G.getBearing()+y*this._bearingStep,pitch:G.getPitch()+S*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:G.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pp(g){return g*(2-g)}const mp=4.000244140625,Qv=1/450;class Vw{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qv,s.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=s.q.now(),S=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%mp==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(S*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=pe(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const Y=this._type==="wheel"&&Math.abs(this._delta)>mp?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*Y)));this._delta<0&&X!==0&&(X=1/X);const ee=h(),ie=Math.pow(2,ee),he=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):ie;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(he*X))),this._type==="wheel"&&(this._startZoom=ee,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:h(),S=this._startZoom,E=this._easing;let I,G=!1;if(this._type==="wheel"&&S&&E){const Y=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),X=E(Y);I=s.aa(S,y,X),Y<1?this._frameId||(this._frameId=!0):G=!0}else I=y,G=!0;this._active=!0,G&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let $=I-h();return $*this._lastDelta<0&&($=0),{noInertia:!0,needsRenderFrame:!G,zoomDelta:$,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.dr;if(this._prevEase){const y=this._prevEase,S=(s.q.now()-y.start)/y.duration,E=y.easing(S+.01)-y.easing(S),I=.27/Math.sqrt(E*E+1e-4)*.01,G=Math.sqrt(.0729-I*I);h=s.dp(I,G,.25,1)}return this._prevEase={start:s.q.now(),duration:l,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Is{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ey{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class o0{constructor(){this._tap=new kl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,h,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,h,y))}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const S=h[0],E=S.y-this._swipePoint.y;return this._swipePoint=S,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(l,h,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class a0{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fh{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class l0{constructor(l,h,y,S){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ef=g=>g.zoom||g.drag||g.pitch||g.rotate;class T extends s.x{}class A{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,h){const y=s.a6.vec3.sub([],h,l);this.radius=s.a6.vec3.length(y[2]<0?s.a6.vec3.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){s.a6.vec3.div(l,l,this.constants),s.a6.vec3.normalize(l,l),s.a6.vec3.mul(l,l,this.constants);const h=s.a6.vec3.scale([],l,this.radius);if(h[2]>0){const y=s.a6.vec3.scale([],[0,0,1],s.a6.vec3.dot(h,[0,0,1])),S=s.a6.vec3.scale([],s.a6.vec3.normalize([],[h[0],h[1],0]),this.radius),E=s.a6.vec3.add([],h,s.a6.vec3.scale([],s.a6.vec3.sub([],s.a6.vec3.add([],S,y),h),2));h[0]=E[0],h[1]=E[1]}return h}}function Z(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ne{constructor(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cp(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new A,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),s.aJ(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[S,E,I]of this._listeners){const G=S===document?this.handleWindowEvent:this.handleEvent;S.addEventListener(E,G,I)}}destroy(){for(const[l,h,y]of this._listeners){const S=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(h,S,y)}}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new tu(h,l));const S=h.boxZoom=new Kv(h,l);this._add("boxZoom",S);const E=new Jv,I=new ey;h.doubleClickZoom=new Is(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const G=new o0;this._add("tapDragZoom",G);const $=h.touchPitch=new nu(h);this._add("touchPitch",$);const Y=new Zm(l),X=new dp(l);h.dragRotate=new Fh(l,Y,X),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const ee=new ra(l),ie=new r0(h,l);h.dragPan=new a0(y,ee,ie),this._add("mousePan",ee),this._add("touchPan",ie,["touchZoom","touchRotate"]);const he=new Ym,ye=new s0;h.touchZoomRotate=new l0(y,ye,he,G),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Dh(h));const ve=h.scrollZoom=new Vw(h,this);this._add("scrollZoom",ve,["mousePan"]);const be=h.keyboard=new Nu;this._add("keyboard",be);for(const Ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Ce]&&h[Ce].enable(l[Ce])}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ef(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,h,y){for(const S in l)if(S!==y&&(!h||h.indexOf(S)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}handleEvent(l,h){this._updatingCamera=!0;const y=l.type==="renderFrame",S=y?void 0:l,E={needsRenderFrame:!1},I={},G={},$=l.touches?this._getMapTouches(l.touches):void 0,Y=$?fe(this._el,$):y?void 0:pe(this._el,l);for(const{handlerName:ie,handler:he,allowed:ye}of this._handlers){if(!he.isEnabled())continue;let ve;this._blockedByActive(G,ye,ie)?he.reset():he[h||l.type]&&(ve=he[h||l.type](l,Y,$),this.mergeHandlerResult(E,I,ve,ie,S),ve&&ve.needsRenderFrame&&this._triggerRenderFrame()),(ve||he.isActive())&&(G[ie]=he)}const X={};for(const ie in this._previousActiveHandlers)G[ie]||(X[ie]=S);this._previousActiveHandlers=G,(Object.keys(X).length||Z(E))&&(this._changes.push([E,I,X]),this._triggerRenderFrame()),(Object.keys(G).length||Z(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=E;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(l,h,y,S,E){if(!y)return;s.l(l,y);const I={handlerName:S,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(h.zoom=I),y.panDelta!==void 0&&(h.drag=I),y.pitchDelta!==void 0&&(h.pitch=I),y.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const l={},h={},y={};for(const[S,E,I]of this._changes)S.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(S.panDelta)),S.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(l.around=S.around),S.aroundCoord!==void 0&&(l.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(l.pinchAround=S.pinchAround),S.noInertia&&(l.noInertia=S.noInertia),s.l(h,E),s.l(y,I);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const S=this._map,E=S.transform,I=Fe=>[Fe.x,Fe.y,Fe.z];if((Fe=>{const ze=this._eventsInProgress.drag;return ze&&!this._handlersById[ze.handlerName].isActive()})()&&!Z(l)){const Fe=E.zoom;E.cameraElevationReference="sea",this._originalZoom!=null&&E._orthographicProjectionAtLowPitch&&E.projection.name!=="globe"&&E.pitch===0?(E.cameraElevationReference="ground",E.zoom=this._originalZoom):(E.recenterOnTerrain(),E.cameraElevationReference="ground"),Fe!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&S._stop(!0),!Z(l))return void this._fireEvents(h,y,!0);let{panDelta:G,zoomDelta:$,bearingDelta:Y,pitchDelta:X,around:ee,aroundCoord:ie,pinchAround:he}=l;E._isCameraConstrained&&($>0&&($=0),E._isCameraConstrained=!1),he!==void 0&&(ee=he),($||(Fe=>h[Fe]&&!this._eventsInProgress[Fe])("drag"))&&ee&&(this._dragOrigin=I(E.pointCoordinate3D(ee)),this._originalZoom=E.zoom,this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",S._stop(!0),ee=ee||S.transform.centerPoint,Y&&(E.bearing+=Y),X&&(E.pitch+=X),E._updateCameraState();const ye=[0,0,0];if(G)if(E.projection.name==="mercator"){const Fe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(ee).dir),ze=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(ee.sub(G)).dir);ye[0]=ze[0]-Fe[0],ye[1]=ze[1]-Fe[1]}else{const Fe=E.pointCoordinate(ee);if(E.projection.name==="globe"){G=G.rotate(-E.angle);const ze=E._pixelsPerMercatorPixel/E.worldSize;ye[0]=-G.x*s.ds(s.aN(Fe.y))*ze,ye[1]=-G.y*s.ds(E.center.lat)*ze}else{const ze=E.pointCoordinate(ee.sub(G));Fe&&ze&&(ye[0]=ze.x-Fe.x,ye[1]=ze.y-Fe.y)}}const ve=E.zoom,be=[0,0,0];if($){const Fe=I(ie||E.pointCoordinate3D(ee)),ze={dir:s.a6.vec3.normalize([],s.a6.vec3.sub([],Fe,E._camera.position))};if(ze.dir[2]<0){const Ue=E.zoomDeltaToMovement(Fe,$);s.a6.vec3.scale(be,ze.dir,Ue)}}const Ce=s.a6.vec3.add(ye,ye,be);E._translateCameraConstrained(Ce),$&&Math.abs(E.zoom-ve)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const S=ef(this._eventsInProgress),E=ef(l),I={};for(const X in l){const{originalEvent:ee}=l[X];this._eventsInProgress[X]||(I[`${X}start`]=ee),this._eventsInProgress[X]=l[X]}!S&&E&&this._fireEvent("movestart",E.originalEvent);for(const X in I)this._fireEvent(X,I[X]);E&&this._fireEvent("move",E.originalEvent);for(const X in l){const{originalEvent:ee}=l[X];this._fireEvent(X,ee)}const G={};let $;for(const X in this._eventsInProgress){const{handlerName:ee,originalEvent:ie}=this._eventsInProgress[X];this._handlersById[ee].isActive()||(delete this._eventsInProgress[X],$=h[ee]||ie,G[`${X}end`]=$)}for(const X in G)this._fireEvent(X,G[X]);const Y=ef(this._eventsInProgress);if(y&&(S||E)&&!Y){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=ie=>ie!==0&&-this._bearingSnap<ie&&ie<this._bearingSnap;X?(ee(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:$})):(this._map.fire(new s.x("moveend",{originalEvent:$})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.x(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new T("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const me="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ae extends s.E{constructor(l,h){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,s.aJ(["_renderFrameCallback"],this)}getCenter(){return new s.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.l({offset:l},h),y)}panTo(l,h,y){return this.easeTo(s.l({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(s.l({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(s.l({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,s.l({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=s.as.convert(l);const y=h&&h.bearing||0,S=h&&h.pitch||0,E=l.getNorthWest(),I=l.getSouthEast();return this._cameraForBounds(this.transform,E,I,y,S,h)}_extendPadding(l){const h={top:0,right:0,bottom:0,left:0};return l==null?s.l({},h,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:s.l({},h,l)}_extendCameraOptions(l){return(l=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,h){const y=h.max[0]-h.min[0],S=h.max[1]-h.min[1];return y/S>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):S/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,h,y,S,E,I){const G=l.clone(),$=this._extendCameraOptions(I);G.bearing=S,G.pitch=E;const Y=s.bL.convert(h),X=s.bL.convert(y),ee=.5*(Y.lat+X.lat),ie=.5*(Y.lng+X.lng),he=s.dt(ee,ie),ye=s.a6.vec3.normalize([],he),ve=s.a6.vec3.normalize([],s.a6.vec3.cross([],ye,[0,1,0])),be=s.a6.vec3.cross([],ve,ye),Ce=[ve[0],ve[1],ve[2],0,be[0],be[1],be[2],0,ye[0],ye[1],ye[2],0,0,0,0,1],Fe=[he,s.dt(Y.lat,Y.lng),s.dt(X.lat,Y.lng),s.dt(X.lat,X.lng),s.dt(Y.lat,X.lng),s.dt(ee,Y.lng),s.dt(ee,X.lng),s.dt(Y.lat,ie),s.dt(X.lat,ie)];let ze=s.ca.fromPoints(Fe.map(Vt=>[s.a6.vec3.dot(ve,Vt),s.a6.vec3.dot(be,Vt),s.a6.vec3.dot(ye,Vt)]));const Ue=s.a6.vec3.transformMat4([],ze.center,Ce);s.a6.vec3.squaredLength(Ue)===0&&s.a6.vec3.set(Ue,0,0,1),s.a6.vec3.normalize(Ue,Ue),s.a6.vec3.scale(Ue,Ue,s.aq),G.center=s.du(Ue);const Ze=G.getWorldToCameraMatrix(),Ke=s.a6.mat4.invert(new Float64Array(16),Ze);ze=s.ca.applyTransform(ze,s.a6.mat4.multiply([],Ze,Ce));const Xe=this._extendAABB(ze,G,$,S);if(!Xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ze=Xe,s.a6.vec3.transformMat4(Ue,Ue,Ze);const Je=.5*(ze.max[2]-ze.min[2]),ot=this._minimumAABBFrustumDistance(G,ze),mt=s.a6.vec3.scale([],[0,0,1],Je),lt=s.a6.vec3.add(mt,Ue,mt),at=ot+(G.pitch===0?0:s.a6.vec3.distance(Ue,lt)),Nt=G.globeCenterInViewSpace,qt=s.a6.vec3.sub([],Ue,[Nt[0],Nt[1],Nt[2]]);s.a6.vec3.normalize(qt,qt),s.a6.vec3.scale(qt,qt,at);const ln=s.a6.vec3.add([],Ue,qt);s.a6.vec3.transformMat4(ln,ln,Ke);const _n=s.dw/s.aq,En=s.a6.vec3.length(ln),Ct=s.bE(Math.max(En*_n-s.dw,Number.EPSILON),0),on=Math.min(G.zoomFromMercatorZAdjusted(Ct),$.maxZoom);return on>.5*(s.c3+s.bV)?(G.setProjection({name:"mercator"}),G.zoom=on,this._cameraForBounds(G,h,y,S,E,I)):{center:G.center,zoom:on,bearing:S,pitch:E}}_extendAABB(l,h,y,S){const E=.5*((y.padding.left||0)+(y.padding.right||0)),I=.5*((y.padding.top||0)+(y.padding.bottom||0)),G=I,$=E,Y=E,X=I,ee=h.width-($+Y),ie=h.height-(G+X),he=s.a6.vec3.sub([],l.max,l.min),ye=Math.min(ee/he[0],ie/he[1]),ve=Math.min(h.scaleZoom(h.scale*ye),y.maxZoom);if(isNaN(ve))return null;const be=h.scale/h.zoomScale(ve),Ce=new s.ca([l.min[0]-$*be,l.min[1]-X*be,l.min[2]],[l.max[0]+Y*be,l.max[1]+G*be,l.max[2]]),Fe=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new s.P(y.offset.x,y.offset.y):s.P.convert(y.offset)).rotate(-s.bC(S));return Ce.center[0]-=Fe.x*be,Ce.center[1]+=Fe.y*be,Ce}queryTerrainElevation(l,h){const y=this.transform.elevation;return y?(h=s.l({},{exaggerated:!0},h),y.getAtPoint(s.a5.fromLngLat(l),null,h.exaggerated)):null}_cameraForBounds(l,h,y,S,E,I){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,h,y,S,E,I);const G=l.clone(),$=this._extendCameraOptions(I);G.bearing=S,G.pitch=E;const Y=s.bL.convert(h),X=s.bL.convert(y),ee=new s.bL(Y.lng,X.lat),ie=new s.bL(X.lng,Y.lat),he=G.project(Y),ye=G.project(X),ve=this.queryTerrainElevation(Y),be=this.queryTerrainElevation(X),Ce=this.queryTerrainElevation(ee),Fe=this.queryTerrainElevation(ie),ze=[[he.x,he.y,Math.min(ve||0,be||0,Ce||0,Fe||0)],[ye.x,ye.y,Math.max(ve||0,be||0,Ce||0,Fe||0)]];let Ue=s.ca.fromPoints(ze);const Ze=G.getWorldToCameraMatrix(),Ke=s.a6.mat4.invert(new Float64Array(16),Ze);Ue=s.ca.applyTransform(Ue,Ze);const Xe=this._extendAABB(Ue,G,$,S);if(!Xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ue=Xe;const Je=.5*s.a6.vec3.sub([],Ue.max,Ue.min)[2],ot=this._minimumAABBFrustumDistance(G,Ue),mt=[0,0,1,0];s.a6.vec4.transformMat4(mt,mt,Ze),s.a6.vec4.normalize(mt,mt);const lt=s.a6.vec3.scale([],mt,ot+Je),at=s.a6.vec3.add([],Ue.center,lt);s.a6.vec3.transformMat4(Ue.center,Ue.center,Ke),s.a6.vec3.transformMat4(at,at,Ke);const Nt=G.unproject(new s.P(Ue.center[0],Ue.center[1])),qt=s.dv(G.projection,Nt),ln=Math.pow(2,qt),_n=Math.min(G._zoomFromMercatorZ(at[2]*G.pixelsPerMeter*ln/G.worldSize),$.maxZoom);return G.mercatorFromTransition&&_n<.5*(s.c3+s.bV)?(G.setProjection({name:"globe"}),G.zoom=_n,this._cameraForBounds(G,h,y,S,E,I)):{center:Nt,zoom:_n,bearing:S,pitch:E}}fitBounds(l,h,y){const S=this.cameraForBounds(l,h);return this._fitInternal(S,h,y)}fitScreenCoordinates(l,h,y,S,E){const I=s.P.convert(l),G=s.P.convert(h),$=new s.P(Math.min(I.x,G.x),Math.min(I.y,G.y)),Y=new s.P(Math.max(I.x,G.x),Math.max(I.y,G.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,G))return this;const X=this.transform.pointLocation3D($),ee=this.transform.pointLocation3D(Y),ie=this.transform.pointLocation3D(new s.P($.x,Y.y)),he=this.transform.pointLocation3D(new s.P(Y.x,$.y)),ye=[Math.min(X.lng,ee.lng,ie.lng,he.lng),Math.min(X.lat,ee.lat,ie.lat,he.lat)],ve=[Math.max(X.lng,ee.lng,ie.lng,he.lng),Math.max(X.lat,ee.lat,ie.lat,he.lat)],be=S&&S.pitch?S.pitch:this.getPitch(),Ce=this._cameraForBounds(this.transform,ye,ve,y,be,S);return this._fitInternal(Ce,S,E)}_fitInternal(l,h,y){return l?(h=s.l(l,h)).linear?this.easeTo(h,y):this.flyTo(h,y):this}jumpTo(l,h){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let S=!1,E=!1,I=!1;"zoom"in l&&y.zoom!==+l.zoom&&(S=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=s.bL.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(E=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(I=!0,y.pitch=+l.pitch);const G=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;if(l.padding!=null&&!y.isPaddingEqual(G))if(l.retainPadding===!1){const $=y.clone();$.padding=G,y.setLocationAtPoint(y.center,$.centerPoint)}else y.padding=G;return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new s.x("movestart",h)).fire(new s.x("move",h)),S&&this.fire(new s.x("zoomstart",h)).fire(new s.x("zoom",h)).fire(new s.x("zoomend",h)),E&&this.fire(new s.x("rotatestart",h)).fire(new s.x("rotate",h)).fire(new s.x("rotateend",h)),I&&this.fire(new s.x("pitchstart",h)).fire(new s.x("pitch",h)).fire(new s.x("pitchend",h)),this.fire(new s.x("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(me),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return s.w(me),this;this.stop();const S=y.zoom,E=y.pitch,I=y.bearing;y.setFreeCameraOptions(l);const G=S!==y.zoom,$=E!==y.pitch,Y=I!==y.bearing;return this.fire(new s.x("movestart",h)).fire(new s.x("move",h)),G&&this.fire(new s.x("zoomstart",h)).fire(new s.x("zoom",h)).fire(new s.x("zoomend",h)),Y&&this.fire(new s.x("rotatestart",h)).fire(new s.x("rotate",h)).fire(new s.x("rotateend",h)),$&&this.fire(new s.x("pitchstart",h)).fire(new s.x("pitch",h)).fire(new s.x("pitchend",h)),this.fire(new s.x("moveend",h)),this}easeTo(l,h){this._stop(!1,l.easeId),((l=s.l({offset:[0,0],duration:500,easing:s.dr},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,S=this.getZoom(),E=this.getBearing(),I=this.getPitch(),G=this.getPadding(),$="zoom"in l?+l.zoom:S,Y="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:I,ee=this._extendPadding(l.padding),ie=s.P.convert(l.offset);let he,ye,ve;if(y.projection.name==="globe"){const mt=s.a5.fromLngLat(y.center),lt=ie.rotate(-y.angle);mt.x+=lt.x/y.worldSize,mt.y+=lt.y/y.worldSize;const at=mt.toLngLat(),Nt=s.bL.convert(l.center||at);this._normalizeCenter(Nt),he=y.centerPoint.add(lt),ye=new s.P(mt.x,mt.y).mult(y.worldSize),ve=new s.P(s.am(Nt.lng),s.at(Nt.lat)).mult(y.worldSize).sub(ye)}else{he=y.centerPoint.add(ie);const mt=y.pointLocation(he),lt=s.bL.convert(l.center||mt);this._normalizeCenter(lt),ye=y.project(mt),ve=y.project(lt).sub(ye)}const be=y.zoomScale($-S);let Ce,Fe;l.around&&(Ce=s.bL.convert(l.around),Fe=y.locationPoint(Ce));const ze=this._zooming||$!==S,Ue=this._rotating||E!==Y,Ze=this._pitching||X!==I,Ke=!y.isPaddingEqual(ee),Xe=l.retainPadding===!1?y.clone():y,Je=mt=>lt=>{if(ze&&(mt.zoom=s.aa(S,$,lt)),Ue&&(mt.bearing=s.aa(E,Y,lt)),Ze&&(mt.pitch=s.aa(I,X,lt)),Ke&&(Xe.interpolatePadding(G,ee,lt),he=Xe.centerPoint.add(ie)),Ce)mt.setLocationAtPoint(Ce,Fe);else{const at=mt.zoomScale(mt.zoom-S),Nt=$>S?Math.min(2,be):Math.max(.5,be),qt=Math.pow(Nt,1-lt),ln=mt.unproject(ye.add(ve.mult(lt*qt)).mult(at));mt.setLocationAtPoint(mt.renderWorldCopies?ln.wrap():ln,he)}return l.preloadOnly||this._fireMoveEvents(h),mt};if(l.preloadOnly){const mt=this._emulate(Je,l.duration,y);return this._preloadTiles(mt),this}const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ze,this._rotating=Ue,this._pitching=Ze,this._padding=Ke,this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,ot),this._ease(Je(y),mt=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(h,mt)},l),this}_prepareEase(l,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||y.moving||this.fire(new s.x("movestart",l)),this._zooming&&!y.zooming&&this.fire(new s.x("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new s.x("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new s.x("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.x("move",l)),this._zooming&&this.fire(new s.x("zoom",l)),this._rotating&&this.fire(new s.x("rotate",l)),this._pitching&&this.fire(new s.x("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,S=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.x("zoomend",l)),S&&this.fire(new s.x("rotateend",l)),E&&this.fire(new s.x("pitchend",l)),this.fire(new s.x("moveend",l))}flyTo(l,h){if(this._prefersReducedMotion(l)){const Vt=s.ar(l,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Vt,h)}this.stop(),l=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dr},l);const y=this.transform,S=this.getZoom(),E=this.getBearing(),I=this.getPitch(),G=this.getPadding(),$="zoom"in l?s.ap(+l.zoom,y.minZoom,y.maxZoom):S,Y="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:I,ee=this._extendPadding(l.padding),ie=y.zoomScale($-S),he=s.P.convert(l.offset);let ye=y.centerPoint.add(he);const ve=y.pointLocation(ye),be=s.bL.convert(l.center||ve);this._normalizeCenter(be);const Ce=y.project(ve),Fe=y.project(be).sub(Ce);let ze=l.curve;const Ue=Math.max(y.width,y.height),Ze=Ue/ie,Ke=Fe.mag();if("minZoom"in l){const Vt=s.ap(Math.min(l.minZoom,S,$),y.minZoom,y.maxZoom),an=Ue/y.zoomScale(Vt-S);ze=Math.sqrt(an/Ke*2)}const Xe=ze*ze;function Je(Vt){const an=(Ze*Ze-Ue*Ue+(Vt?-1:1)*Xe*Xe*Ke*Ke)/(2*(Vt?Ze:Ue)*Xe*Ke);return Math.log(Math.sqrt(an*an+1)-an)}function ot(Vt){return(Math.exp(Vt)-Math.exp(-Vt))/2}function mt(Vt){return(Math.exp(Vt)+Math.exp(-Vt))/2}const lt=Je(0);let at=function(Vt){return mt(lt)/mt(lt+ze*Vt)},Nt=function(Vt){return Ue*((mt(lt)*(ot(an=lt+ze*Vt)/mt(an))-ot(lt))/Xe)/Ke;var an},qt=(Je(1)-lt)/ze;if(Math.abs(Ke)<1e-6||!isFinite(qt)){if(Math.abs(Ue-Ze)<1e-6)return this.easeTo(l,h);const Vt=Ze<Ue?-1:1;qt=Math.abs(Math.log(Ze/Ue))/ze,Nt=function(){return 0},at=function(an){return Math.exp(Vt*ze*an)}}l.duration="duration"in l?+l.duration:1e3*qt/("screenSpeed"in l?+l.screenSpeed/ze:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const ln=E!==Y,_n=X!==I,En=!y.isPaddingEqual(ee),Ct=l.retainPadding===!1?y.clone():y,on=Vt=>an=>{const un=an*qt,sn=1/at(un);Vt.zoom=an===1?$:S+Vt.scaleZoom(sn),ln&&(Vt.bearing=s.aa(E,Y,an)),_n&&(Vt.pitch=s.aa(I,X,an)),En&&(Ct.interpolatePadding(G,ee,an),ye=Ct.centerPoint.add(he));const Pn=an===1?be:Vt.unproject(Ce.add(Fe.mult(Nt(un))).mult(sn));return Vt.setLocationAtPoint(Vt.renderWorldCopies?Pn.wrap():Pn,ye),Vt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(h),Vt};if(l.preloadOnly){const Vt=this._emulate(on,l.duration,y);return this._preloadTiles(Vt),this}return this._zooming=!0,this._rotating=ln,this._pitching=_n,this._padding=En,this._prepareEase(h,!1),this._ease(on(y),()=>this._afterEase(h),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){y.animate===!1||y.duration===0?(l(1),h()):(this._easeStart=s.q.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,h){l=s.bB(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,h,y){const S=Math.ceil(15*h/1e3),E=[],I=l(y.clone());for(let G=0;G<=S;G++){const $=I(G/S);E.push($.clone())}return E}_preloadTiles(l,h){}}class _t{constructor(l={}){this.options=l,s.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const h=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const S=z("span","mapboxgl-ctrl-icon",this._compactButton);return S.setAttribute("aria-hidden","true"),S.setAttribute("title",y),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(l){const y=h.reduce((S,E,I)=>(E.value&&(S+=`${E.key}=${E.value}${I<h.length-1?"&":""}`),S),"?");l.href=`${s.e.FEEDBACK_URL}/${y}#${Yd(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const h=this._map.style._mergedSourceCaches;for(const S in h){const E=h[S];if(E.used){const I=E.getSource();I.attribution&&l.indexOf(I.attribution)<0&&l.push(I.attribution)}}l.sort((S,E)=>S.length-E.length),l=l.filter((S,E)=>{for(let I=E+1;I<l.length;I++)if(l[I].indexOf(S)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Jt{constructor(){s.aJ(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=z("div","mapboxgl-ctrl");const h=z("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const h in l){const y=l[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Sn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const S of y)if(S.id===l)return void(S.cancelled=!0)}run(l=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Kn{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const h=s.cw((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,h,y){this._start=this.getValue(h),this._end=l,this._startTime=h,this._endTime=h+y}}const Ai={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},pr=["mouseenter","mouseover","mouseleave","mouseout"];class Gi extends s.x{constructor(l,h,y,S){const{point:E,lngLat:I,originalEvent:G,target:$}=l;super(l.type,{point:E,lngLat:I,originalEvent:G,target:$}),this.preventDefault=()=>{l.preventDefault()},this.id=h,this.interaction=y,this.feature=S}}class vs{constructor(l){this.map=l,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(l,h){if(this.typeById.has(l))throw new Error(`Interaction id "${l}" already exists.`);const{type:y,filter:S}=h;if(S){const I=s.M(S,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(I.result==="error")throw new Error(I.value.map(G=>`${G.key}: ${G.message}`).join(", "));this.filters.set(l,I.value)}const E=this.interactionsByType.get(y)||new Map;E.size===0&&(pr.includes(y)?this.map.on(y,h.featureset,this.handleType):this.map.on(y,this.handleType),this.interactionsByType.set(y,E)),E.set(l,h),this.typeById.set(l,y)}remove(l){const h=this.typeById.get(l);if(!h)return;this.typeById.delete(l),this.filters.delete(l);const y=this.interactionsByType.get(h);y&&(y.delete(l),y.size===0&&this.map.off(h,this.handleType))}handleType(l){const h=this.interactionsByType.get(l.type),y=Array.from(h).reverse(),S=[];for(const[,G]of y)G.featureset&&S.push({featureset:G.featureset,filter:G.filter,radius:G.radius});let E=this.map.style.queryRenderedFeaturesForInteractions(l.point,S,this.map.transform);!E.length&&pr.includes(l.type)&&(E=[null]);let I=!1;for(const G of E){for(const[$,Y]of y){const{handler:X,featureset:ee}=Y;if(ee&&(G==null||s.bi(G.featureset,ee))&&X(new Gi(l,$,Y,G))!==!1){I=!0;break}}if(I)break}if(!I)for(const[G,$]of y){const{handler:Y,featureset:X}=$;if(!X&&Y(new Gi(l,G,$,null))!==!1)break}}}function Fi(g,l){if(Array.isArray(g)&&Array.isArray(l)){const h=new Set(g),y=new Set(l);return h.size===y.size&&g.every(S=>y.has(S))}return s.bi(g,l)}const io={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},po={showCompass:!0,showZoom:!0,visualizePitch:!1};class cn{constructor(l,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Zm({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new dp({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),q()}move(l,h){const y=this.map,S=this.mouseRotate.mousemoveWindow(l,h),E=S&&S.bearingDelta;if(E&&y.setBearing(y.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(l,h),G=I&&I.pitchDelta;G&&y.setPitch(y.getPitch()+G)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.l({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),pe(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,pe(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=fe(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qt(g,l,h){if(g=new s.bL(g.lng,g.lat),l){const y=new s.bL(g.lng-360,g.lat),S=new s.bL(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(l),G=l.x<0||l.y<0||l.x>h.width||l.y>h.height;h.locationPoint(y).distSqr(l)<I&&(G||Math.abs(y.lng-h.center.lng)<E)?g=y:h.locationPoint(S).distSqr(l)<I&&(G||Math.abs(S.lng-h.center.lng)<E)&&(g=S)}for(;Math.abs(g.lng-h.center.lng)>180;){const y=h.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const gn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ai extends s.E{constructor(l,h){if(super(),(l instanceof HTMLElement||h)&&(l=s.l({element:l},h)),s.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=z("div");const E=41,I=27,G=L("svg",{display:"block",height:E*this._scale+"px",width:I*this._scale+"px",viewBox:`0 0 ${I} ${E}`},this._element),$=L("radialGradient",{id:"shadowGradient"},L("defs",{},G));L("stop",{offset:"10%","stop-opacity":.4},$),L("stop",{offset:"100%","stop-opacity":.05},$),L("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},G),L("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},G),L("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},G),L("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},G),this._offset=s.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const y=this._element.classList;for(const E in gn)y.remove(`mapboxgl-marker-anchor-${E}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const S=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...S),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.bL.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const h=l.code,y=l.charCode||l.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(l){const h=l.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,h=this._pos;if(!l||!h)return!1;const y=l.unproject(h),S=l.getFreeCameraOptions();if(!S.position)return!1;const E=S.position.toLngLat();return E.distanceTo(y)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const h=this._pos;if(!h||h.x<0||h.x>l.transform.width||h.y<0||h.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(h);let S;l._showingGlobe()&&s.dz(l.transform,this._lngLat)?S=0:(S=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${gn[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const l=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!l||y!=="map")return"";if(!h._showingGlobe()){const $=h.getPitch();return $?`rotateX(${$}deg)`:""}const S=s.c1(s.dA(h.transform,this._lngLat)),E=l.sub(s.dB(h.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(I===0)return"";const G=S/I;return`rotateX(${-E.y*G}deg) rotateY(${E.x*G}deg)`}_calculateZTransform(){const l=this._pos,h=this._map;if(!h||!l)return"";let y=0;const S=this.getRotationAlignment();if(S==="map")if(h._showingGlobe()){const E=h.project(new s.bL(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new s.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);y=s.c1(Math.atan2(I.y,I.x))-90}else y=-h.getBearing();else if(S==="horizon"){const E=s.a7(4,6,h.getZoom()),I=s.dB(h.transform);I.y+=E*h.transform.height;const G=l.sub(I),$=s.c1(Math.atan2(G.y,G.x));y=($>90?$-270:$+90)*(1-E)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Qt(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const h=this._map;if(!h)return;const y=this._pointerdownPos,S=this._positionDelta;if(y&&S){if(!this._isDragging){const E=this._clickTolerance||h._clickTolerance;if(l.point.dist(y)<E)return;this._isDragging=!0}this._pos=l.point.sub(S),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.x("dragstart"))),this.fire(new s.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.x("dragend")),this._state="inactive"}_addDragHandler(l){const h=this._map,y=this._pos;h&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const h=this._map;return h&&(l?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sr={maxWidth:100,unit:"metric"},yr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},es={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ro=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function rr(g=new s.P(0,0),l="bottom"){if(typeof g=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new s.P(0,g);case"top-left":return new s.P(h,h);case"top-right":return new s.P(-h,h);case"bottom":return new s.P(0,-g);case"bottom-left":return new s.P(h,-h);case"bottom-right":return new s.P(-h,-h);case"left":return new s.P(g,0);case"right":return new s.P(-g,0)}return new s.P(0,0)}return g instanceof s.P||Array.isArray(g)?s.P.convert(g):s.P.convert(g[l]||[0,0])}return{version:f,supported:N.supported,setRTLTextPlugin:s.dC,getRTLTextPluginStatus:s.dD,Map:class extends Ae{constructor(g){w.mark(v.create);const l=g;if((g=s.l({},io,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&s.dx(window)&&(g.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zf(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Sn,this._domRenderTaskQueue=new Sn,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aQ(),this._locale=s.l({},Ai,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kn(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new tt(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),s.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Kd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ne(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||s.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new ia(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,s.l({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new _t({customAttribution:g.customAttribution})),this._logoControl=new Jt,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.x(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.x(`${h.dataType}dataloading`,h))}),this._interactions=new vs(this)}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.x("movestart",g)).fire(new s.x("move",g)),this.fire(new s.x("resize",g)),l&&this.fire(new s.x("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(s.as.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(l=>l.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let h;l==="globe"&&g.zoom>=s.bV?(g.setMercatorFromTransition(),h=!0):l==="mercator"&&g.zoom<s.bV&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=s.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(s.bL.convert(g))}unproject(g){return this.transform.pointLocation3D(s.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,h){const y=S=>{let E=[];if(Array.isArray(l)){const I=l.filter(G=>this.getLayer(G));E=I.length?this.queryRenderedFeatures(S,{layers:I}):[]}else E=this.queryRenderedFeatures(S,{featureset:l});return E};if(g==="mouseenter"||g==="mouseover"){let S=!1;return{listener:h,targets:l,delegates:{mousemove:I=>{const G=y(I.point);G.length?S||(S=!0,h.call(this,new ss(g,this,I.originalEvent,{features:G}))):S=!1},mouseout:()=>{S=!1}}}}if(g==="mouseleave"||g==="mouseout"){let S=!1;return{listener:h,targets:l,delegates:{mousemove:G=>{y(G.point).length?S=!0:S&&(S=!1,h.call(this,new ss(g,this,G.originalEvent)))},mouseout:G=>{S&&(S=!1,h.call(this,new ss(g,this,G.originalEvent)))}}}}{const S=E=>{const I=y(E.point);I.length&&(E.features=I,h.call(this,E),delete E.features)};return{listener:h,targets:l,delegates:{[g]:S}}}}on(g,l,h){if(typeof l=="function"||h===void 0)return super.on(g,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const y=this._createDelegatedListener(g,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const S in y.delegates)this.on(S,y.delegates[S]);return this}once(g,l,h){if(typeof l=="function"||h===void 0)return super.once(g,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const y=this._createDelegatedListener(g,l,h);for(const S in y.delegates)this.once(S,y.delegates[S]);return this}off(g,l,h){if(typeof l=="function"||h===void 0)return super.off(g,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const y=this._delegatedListeners?this._delegatedListeners[g]:void 0;return y&&(S=>{for(let E=0;E<S.length;E++){const I=S[E];if(I.listener===h&&Fi(I.targets,l)){for(const G in I.delegates)this.off(G,I.delegates[G]);return S.splice(E,1),this}}})(y),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof s.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(l=l||{}))return this._isFeaturesetDescriptorValid(l.featureset)?this.style.queryRenderedFeaturesForInteractions(g,[l],this.transform):[];if(l.layers&&Array.isArray(l.layers)){for(const h of l.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,l)}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(g))}addInteraction(g,l){return this._interactions.add(g,l),this}removeInteraction(g){return this._interactions.remove(g),this}setStyle(g,l){return l=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(h,y)=>{h?(s.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=s.l({},l);l&&l.config&&(h.initialConfig=l.config,delete h.config),this.style=new Vo(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new s.t(new Error("IDs can't be empty."))),!1):!s.aK(g)||(this.fire(new s.t(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isFeaturesetDescriptorValid(g){return"featuresetId"in g?this._isValidId(g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const l of g)if(!this._isValidId(l))return!1;return!0}return this._isFeaturesetDescriptorValid(g)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:h=1,sdf:y=!1,stretchX:S,stretchY:E,content:I}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:G,height:$,data:Y}=s.q.getImageData(l);this.style.addImage(g,{data:new s.r({width:G,height:$},Y),pixelRatio:h,stretchX:S,stretchY:E,content:I,sdf:y,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:G,height:$}=l,Y=l;this.style.addImage(g,{data:new s.r({width:G,height:$},new Uint8Array(Y.data)),pixelRatio:h,stretchX:S,stretchY:E,content:I,sdf:y,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const h=this.style.getImage(g);if(!h)return void this.fire(new s.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?s.q.getImageData(l):l,{width:S,height:E,data:I}=y;if(S===void 0||E===void 0)return void this.fire(new s.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==h.data.width||E!==h.data.height)return void this.fire(new s.t(new Error(`The width and height of the updated image (${S}, ${E})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const G=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);h.data.replace(I,G),this.style.updateImage(g,h)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new s.t(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){s.o(this._requestManager.transformRequest(g,s.R.Image),(h,y)=>{l(h,y instanceof HTMLImageElement?s.q.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new s.t(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,h),this._update(!0)):this}setFilter(g,l,h={}){return this._isValidId(g)?(this.style.setFilter(g,l,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,h,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,h,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,h,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,h,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,h){return this.style.setConfigProperty(g,l,h),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bL.convert(g),this.transform):0}setFeatureState(g,l){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,l),this._update())}removeFeatureState(g,l){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,l),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let h,y,S,E=this._container;for(;E&&(!y||!S);){const I=window.getComputedStyle(E).transform;I&&I!=="none"&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(y=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(S=h[3])),E=E.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=S?Math.abs(l/S):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=z("div","mapboxgl-canvas-container",g);this._canvas=z("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=z("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(S=>{y[S]=z("div",`mapboxgl-ctrl-${S}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const h=s.q.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=s.l({},N.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(bt(l,!0),this.painter=new Mo(l,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(l)):this.fire(new s.t(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.x("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new s.x("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new s.x("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,y=s.q.now(),S=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=S.createQuery(),S.beginQuery(h.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Y=this.transform.zoom,X=this.transform.pitch,ee=s.q.now(),ie=new s.a3(Y,{now:ee,fadeDuration:E,pitch:X,transition:this.style.transition});this.style.update(ie)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(y);const G=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),G&&(this._placementDirty=G.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,w.mark(v.load),this.fire(new s.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const Y=s.q.now()-y;S.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const X=S.getQueryParameter(l,S.QUERY_RESULT)/1e6;S.deleteQuery(l),this.fire(new s.x("gpu-timing-frame",{cpuTime:Y,gpuTime:X}))},50)}if(this.listens("gpu-timing-layer")){const Y=this.painter.collectGpuTimers();setTimeout(()=>{const X=this.painter.queryGpuTimers(Y);this.fire(new s.x("gpu-timing-layer",{layerTimes:X}))},50)}if(this.listens("gpu-timing-deferred-render")){const Y=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const X=this.painter.queryGpuTimeDeferredRender(Y);this.fire(new s.x("gpu-timing-deferred-render",{gpuTime:X}))},50)}const $=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if($||this._repaint)this.triggerRepaint();else{const Y=this.idle();if(Y&&(I=this._updateAverageElevation(y,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),Y&&(this.fire(new s.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const X=this._calculateSpeedIndex();this.fire(new s.x("speedindexcompleted",{speedIndex:X})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||$||(this._fullyLoaded=!0,w.mark(v.fullLoad),this._performanceMetricsCollection&&kt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const h=S=>(this.transform.averageElevation=S,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const S=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=g;const I=Math.abs(S-E);if(I>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(E),h(E);this._averageElevation.easeTo(E,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(E),h(E)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){Re(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===rt||g.status===401)){const l=this.painter.context.gl;bt(l,!1),this._logoControl instanceof Jt&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Qe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&He(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function S(E){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,E,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(S(g),l.canvasCopies.map(S),l.timeStamps)}_canvasPixelComparison(g,l,h){let y=h[1]-h[0];const S=g.length/4;for(let E=0;E<l.length;E++){const I=l[E];let G=0;for(let $=0;$<I.length;$+=4)I[$]===g[$]&&I[$+1]===g[$+1]&&I[$+2]===g[$+2]&&I[$+3]===g[$+3]&&(G+=1);y+=(h[E+2]-h[E+1])*(1-G/S)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Kt.delete(this.painter.context.gl),rn.remove(),Xt.remove(),this._removed=!0,this.fire(new s.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=s.q.frame(l=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return s.bg(l,(h,y)=>h._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){s.dy(g,l)}get version(){return f}},NavigationControl:class{constructor(g={}){this.options=s.l({},po,g),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:l}):h.resetNorth({},{originalEvent:l}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),h=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cn(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const h=z("button",g,this._container);return h.type="button",h.addEventListener("click",l),h}_setButtonTitle(g,l){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends s.E{constructor(g={}){super();const l=navigator.geolocation;this.options=s.l({geolocation:l},Bi,g),s.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=al(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>l(h.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),h=g.coords;return!!l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.x("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("geolocate",g)),this._finish()}}_updateCamera(g){const l=new s.bL(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,y=this._map.getBearing(),S=s.l({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(h),S,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new s.bL(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=s.bE(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ai({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ai({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.x("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_t,ScaleControl:class{constructor(g={}){this.options=s.l({},Sr,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,h=l._containerHeight/2,y=l._containerWidth/2-g/2,S=l.unproject([y,h]),E=l.unproject([y+g,h]),I=S.distanceTo(E);if(this.options.unit==="imperial"){const G=3.2808*I;G>5280?this._setScale(g,G/5280,"mile"):this._setScale(g,G,"foot")}else this.options.unit==="nautical"?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,l,h){this._map._requestDomTask(()=>{const y=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let G=E/I;return G=G>=10?10:G>=5?5:G>=3?3:G>=2?2:G>=1?1:function($){const Y=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*Y)/Y}(G),I*G}(l),S=y/l;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${yr[h]}`,this._container.style.width=g*S+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.w("Full screen control 'container' must be a DOM element.")),s.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(g){super(),this.options=s.l(Object.create(es),g),s.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new s.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new s.x("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=s.bL.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=g;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const h=this._closeButton=z("button","mapboxgl-popup-close-button",l);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,h=this._container,y=this._pos;if(!l||!h||!y)return"bottom";const S=h.offsetWidth,E=h.offsetHeight,I=y.x<S/2,G=y.x>l.transform.width-S/2;if(y.y+g<E)return I?"top-left":G?"top-right":"top";if(y.y>l.transform.height-E){if(I)return"bottom-left";if(G)return"bottom-right"}return I?"left":G?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,h=this._content;if(!l||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=z("div","mapboxgl-popup",l.getContainer()),this._tip=z("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qt(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const S=this._pos=this._trackPointer&&g instanceof s.P?g:l.project(this._lngLat),E=rr(this.options.offset),I=this._anchor=this._getAnchor(E.y),G=rr(this.options.offset,I),$=S.add(G).round();l._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${gn[I]} translate(${$.x}px,${$.y}px)`)})}if(!this._marker&&l._showingGlobe()){const S=s.dz(l.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Ro);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:ai,Style:Vo,LngLat:s.bL,LngLatBounds:s.as,Point:s.P,MercatorCoordinate:s.a5,FreeCameraOptions:hc,Evented:s.E,config:s.e,prewarm:s.dE,clearPrewarmedResources:s.dF,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(g){s.e.ACCESS_TOKEN=g},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(g){s.e.API_URL=g},get workerCount(){return s.dG.workerCount},set workerCount(g){s.dG.workerCount=g},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){s.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){s.dH(g)},get workerUrl(){return s.dI.workerUrl},set workerUrl(g){s.dI.workerUrl=g},get workerClass(){return s.dI.workerClass},set workerClass(g){s.dI.workerClass=g},get workerParams(){return s.dI.workerParams},set workerParams(g){s.dI.workerParams=g},get dracoUrl(){return s.dJ()},set dracoUrl(g){s.dK(g)},get meshoptUrl(){return s.dL()},set meshoptUrl(g){s.dM(g)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var c=r;return c})})(XJ);var gz=XJ.exports;const jFe=pv(gz),$Fe=mj({__proto__:null,default:jFe},[gz]);function qFe(){return CEe()}const ZFe=vT(()=>Promise.resolve().then(()=>$Fe),void 0);Q.forwardRef(function(e,n){return EK(e,n,ZFe)});const YJ=qEe,YW=new Cl,XFe=new nc,JW=new gt,QW=new gt,KFe=new Hi;function YFe({longitude:t,latitude:e,altitude:n,fromLngLat:i}){const r=i([t,e],n),o=r.meterInMercatorCoordinateUnits();return JW.set(r.x,r.y,r.z||0),QW.set(o,-o,o),YW.setFromEuler(XFe.set(-Math.PI*.5,0,0)),KFe.compose(JW,YW,QW).toArray()}function JJ({latitude:t,longitude:e,altitude:n,fromLngLat:i}){return Q.useMemo(()=>YFe({latitude:t,longitude:e,altitude:n,fromLngLat:i}),[t,e,n,i])}const JFe=new Hi,VM=new Hi,X2=new Hi,ej=new gt;function QJ(t,e,n){VM.fromArray(n).multiply(JFe.fromArray(e)),X2.copy(VM).invert(),QFe(t,X2),t.updateMatrix(),t.updateMatrixWorld(!0),t.projectionMatrix.copy(t.matrix).premultiply(VM),t.projectionMatrixInverse.copy(t.projectionMatrix).invert(),t.far=eLe(t.matrix.elements[10],t.matrix.elements[14],t.near),t.userData.projByView=VM.toArray(),t.userData.projByViewInv=X2.toArray()}const QFe=(t,e)=>{t.position.setScalar(0).applyMatrix4(e),t.up.set(0,-1,0).applyMatrix4(e).negate().add(t.position).normalize(),ej.set(0,0,1).applyMatrix4(e),t.lookAt(ej)};function eLe(t,e,n){const i=e*(t-1),r=t*n+n;return i/r}const P_=t=>{const e=Q.useRef(t);return e.current=t,Q.useCallback((...n)=>e.current(...n),[])};function tLe({map:t,origin:e,useThree:n,frameloop:i,r3m:r}){return P_((c,s)=>{r.viewProjMx.splice(0,16,...s);const f=n.getState(),v=f.camera,{gl:w,advance:C}=f;QJ(v,e,s),w.resetState(),C(Date.now()*.001,!0),(!i||i==="always")&&t.triggerRepaint()})}const K2=new Hi,eQ=t=>{const e=WJ(t);return{...e,connect:n=>{e.connect&&e.connect(n.parentElement)},compute:(n,i)=>{i.pointer.x=n.offsetX/i.size.width*2-1,i.pointer.y=1-n.offsetY/i.size.height*2,i.camera.userData.projByViewInv&&K2.fromArray(i.camera.userData.projByViewInv),i.raycaster.camera=i.camera,i.raycaster.ray.origin.setScalar(0).applyMatrix4(K2),i.raycaster.ray.direction.set(i.pointer.x,i.pointer.y,1).applyMatrix4(K2).sub(i.raycaster.ray.origin).normalize()}}};function nLe({longitude:t,latitude:e,altitude:n}){const i=Ic(r=>r.gl.domElement);Q.useMemo(()=>{const r=om.get(i).store;vz(r,{longitude:t,latitude:e,altitude:n})},[t,e,n])}function iLe(t,{longitude:e,latitude:n,altitude:i}){Q.useMemo(()=>{vz(t,{longitude:e,latitude:n,altitude:i})},[e,n,i])}function vz(t,e){t.setState({coords:e})}function rLe(){return Ic(e=>e.r3m)}function sLe(t){const e=Ic(n=>n.gl.domElement);Q.useState(()=>{const n=om.get(e).store;tQ({...t,store:n})})}function tQ({store:t,...e}){const n=new Hi().identity().toArray(),i={...e,viewProjMx:n};return t.setState({r3m:i}),i}function oLe(t,e,{frameloop:n,longitude:i,latitude:r,altitude:o,...c}){const[{root:s,useThree:f,canvas:v,r3m:w}]=Q.useState(()=>{const F=e.getCanvas(),N=F.getContext("webgl2")||F.getContext("webgl"),z=GJ(F);z.configure({dpr:window.devicePixelRatio,events:eQ,...c,frameloop:"never",gl:{context:N,autoClear:!1,antialias:!0,...c==null?void 0:c.gl},onCreated:H=>{H.gl.forceContextLoss=()=>{}},camera:{matrixAutoUpdate:!1,near:0},size:{width:F.clientWidth,height:F.clientHeight,top:F.offsetTop,left:F.offsetLeft,updateStyle:!1,...c==null?void 0:c.size}});const L=om.get(F).store,P=tQ({map:e,fromLngLat:t,store:L});return vz(L,{longitude:i,latitude:r,altitude:o}),n==="demand"&&L.setState({frameloop:n,invalidate:()=>{e.triggerRepaint()}}),{root:z,useThree:L,map:e,canvas:F,r3m:P}}),C=P_(()=>{const{setDpr:F,setSize:N}=f.getState();F(window.devicePixelRatio),N(v.clientWidth,v.clientHeight,!1,v.offsetTop,v.offsetLeft)}),M=P_(()=>{s.unmount()});return iLe(f,{longitude:i,latitude:r,altitude:o}),Q.useEffect(()=>{if(n!=="demand")return;const F=f.setState,{invalidate:N}=f.getState();return F({frameloop:n,invalidate:()=>{e.triggerRepaint()}}),()=>{F({frameloop:"never",invalidate:N})}},[n]),Q.useEffect(()=>(e.on("resize",C),()=>{e.off("resize",C)}),[]),Q.useEffect(()=>{s.render(re.jsx(re.Fragment,{children:c.children}))},[c.children]),{onRemove:M,useThree:f,r3m:w}}function aLe(t,e,n){const{latitude:i,longitude:r,altitude:o,frameloop:c}=t,s=JJ({latitude:i,longitude:r,altitude:o,fromLngLat:e}),{onRemove:f,useThree:v,r3m:w}=oLe(e,n,t),C=tLe({origin:s,frameloop:c,useThree:v,map:n,r3m:w});return{id:t.id,beforeId:t.beforeId,onRemove:f,render:C,type:"custom",renderingMode:"3d"}}const nQ=Q.memo(({longitude:t,latitude:e,altitude:n,...i})=>(sLe(i),nLe({longitude:t,latitude:e,altitude:n}),re.jsx(re.Fragment,{})));nQ.displayName="InitR3M";const iQ=Q.memo(({latitude:t,longitude:e,altitude:n=0,setOnRender:i,manualRender:r,onReady:o,map:c})=>{const s=c.getCanvas(),f=rLe(),v=Q.useRef(null),w=Ic(ae=>ae.camera),C=Ic(ae=>ae.gl),M=Ic(ae=>ae.gl.domElement),F=Ic(ae=>ae.scene),N=Ic(ae=>ae.advance),z=Ic(ae=>ae.setSize),L=Ic(ae=>ae.set),P=JJ({latitude:t,longitude:e,altitude:n,fromLngLat:f.fromLngLat}),H=Q.useRef(!1),j=Q.useMemo(()=>c.triggerRepaint,[c]),q=Q.useRef(0),le=P_(()=>{q.current++});_P(()=>{QJ(w,P,f.viewProjMx),r&&C.render(F,w),c.triggerRepaint=j,q.current>0&&(q.current=0,c.triggerRepaint())},-1/0);const ce=P_(ae=>{c.triggerRepaint=le,(M.width!==s.width||M.height!==s.height)&&z(s.clientWidth,s.clientHeight,!0,s.offsetTop,s.offsetLeft),f.viewProjMx=ae,!H.current&&o&&(H.current=!0,o()),N(Date.now()*.001,!0)});return Q.useEffect(()=>{i&&i(()=>ce)},[i,ce]),Q.useLayoutEffect(()=>{r&&L({camera:v.current})},[]),re.jsx(re.Fragment,{children:r&&re.jsx("perspectiveCamera",{ref:v,matrixAutoUpdate:!1,matrixWorldAutoUpdate:!1})})});iQ.displayName="SyncCameraFC";const rQ=Q.memo(({children:t,latitude:e,longitude:n,altitude:i,setOnRender:r,map:o,fromLngLat:c,...s})=>{const v=o.getCanvas().parentElement,[w,C]=Q.useState(!1),M=P_(()=>{C(!0)});return re.jsxs(WFe,{camera:{matrixAutoUpdate:!1,matrixWorldAutoUpdate:!1},events:eQ,eventSource:v,...s,gl:{autoClear:!1,...s.gl},children:[re.jsx(nQ,{map:o,fromLngLat:c,latitude:e,longitude:n,altitude:i}),re.jsx(iQ,{latitude:e,longitude:n,altitude:i,setOnRender:r,onReady:M,map:o}),w&&t]})});rQ.displayName="CanvasPortal";const sQ=Q.memo(t=>{const e=t.map.getCanvas(),[n]=Q.useState(()=>{const i=document.createElement("div");return i.style.position="absolute",i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.pointerEvents="none",i});return Q.useEffect(()=>{const i=e.parentElement;return i.appendChild(n),()=>{i.removeChild(n)}},[]),re.jsx(re.Fragment,{children:rh.createPortal(re.jsx(rQ,{...t}),n)})});sQ.displayName="InitCanvasFC";dz(MJ);const oQ=gz.MercatorCoordinate.fromLngLat,aQ=Q.memo(({overlay:t,...e})=>{const n=qFe().current.getMap();return re.jsxs(re.Fragment,{children:[t&&re.jsx(lLe,{map:n,...e}),!t&&re.jsx(yz,{map:n,...e})]})});aQ.displayName="Canvas";const yz=Q.memo(({map:t,...e})=>{const n=aLe(e,oQ,t);return re.jsx(YJ,{...n})});yz.displayName="CanvasInLayer";const lLe=Q.memo(({map:t,id:e,beforeId:n,...i})=>{const[r,o]=Q.useState(),c=P_((s,f)=>{r&&r(f)});return re.jsxs(re.Fragment,{children:[re.jsx(YJ,{id:e,beforeId:n,type:"custom",render:c}),re.jsx(sQ,{...i,setOnRender:o,map:t,fromLngLat:oQ})]})});yz.displayName="CanvasInLayer";const tj=new Cl,cLe=new nc,nj=new gt,ij=new gt,uLe=new Hi;function hLe({longitude:t,latitude:e,altitude:n,fromLngLat:i}){const r=i([t,e],n),o=r.meterInMercatorCoordinateUnits();return nj.set(r.x,r.y,r.z||0),ij.set(o,-o,o),tj.setFromEuler(cLe.set(-Math.PI*.5,0,0)),uLe.compose(nj,tj,ij).toArray()}function dLe({latitude:t,longitude:e,altitude:n,fromLngLat:i}){return Q.useMemo(()=>hLe({latitude:t,longitude:e,altitude:n,fromLngLat:i}),[t,e,n,i])}const fLe=new Hi,GM=new Hi,Y2=new Hi,rj=new gt;function pLe(t,e,n){GM.fromArray(n).multiply(fLe.fromArray(e)),Y2.copy(GM).invert(),mLe(t,Y2),t.updateMatrix(),t.updateMatrixWorld(!0),t.projectionMatrix.copy(t.matrix).premultiply(GM),t.projectionMatrixInverse.copy(t.projectionMatrix).invert(),t.far=gLe(t.matrix.elements[10],t.matrix.elements[14],t.near),t.userData.projByView=GM.toArray(),t.userData.projByViewInv=Y2.toArray()}const mLe=(t,e)=>{t.position.setScalar(0).applyMatrix4(e),t.up.set(0,-1,0).applyMatrix4(e).negate().add(t.position).normalize(),rj.set(0,0,1).applyMatrix4(e),t.lookAt(rj)};function gLe(t,e,n){const i=e*(t-1),r=t*n+n;return i/r}function vLe(){return Ic(e=>e.r3m)}const _z=Q.memo(({latitude:t,longitude:e,altitude:n=0,children:i})=>{const[r]=Q.useState(()=>new _S),o=vLe(),c=dLe({latitude:t,longitude:e,altitude:n,fromLngLat:o.fromLngLat});return re.jsx(re.Fragment,{children:MFe(re.jsxs(re.Fragment,{children:[re.jsx(yLe,{r3m:o,origin:c}),i]}),r,{events:{priority:2}})})});_z.displayName="Coordinates";function yLe({r3m:t,origin:e}){const{gl:n,scene:i,set:r}=Ic(),o=Q.useRef(null);return _P(()=>{o.current&&(pLe(o.current,e,t.viewProjMx),n.render(i,o.current))}),Q.useLayoutEffect(()=>{o.current&&r({invalidate:()=>{t.map&&t.map.triggerRepaint()},camera:o.current})},[r,t]),re.jsx("perspectiveCamera",{ref:o})}var _Le=Object.defineProperty,xLe=(t,e,n)=>e in t?_Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ds=(t,e,n)=>(xLe(t,typeof e!="symbol"?e+"":e,n),n);function J2(t,e,n,i,r){let o;if(t=t.subarray||t.slice?t:t.buffer,n=n.subarray||n.slice?n:n.buffer,t=e?t.subarray?t.subarray(e,r&&e+r):t.slice(e,r&&e+r):t,n.set)n.set(t,i);else for(o=0;o<t.length;o++)n[o+i]=t[o];return n}function wLe(t){return t instanceof Float32Array?t:t instanceof Cr?t.getAttribute("position").array:t.map(e=>{const n=Array.isArray(e);return e instanceof gt?[e.x,e.y,e.z]:e instanceof Cn?[e.x,e.y,0]:n&&e.length===3?[e[0],e[1],e[2]]:n&&e.length===2?[e[0],e[1],0]:e}).flat()}class CLe extends Cr{constructor(){super(),Ds(this,"type","MeshLine"),Ds(this,"isMeshLine",!0),Ds(this,"positions",[]),Ds(this,"previous",[]),Ds(this,"next",[]),Ds(this,"side",[]),Ds(this,"width",[]),Ds(this,"indices_array",[]),Ds(this,"uvs",[]),Ds(this,"counters",[]),Ds(this,"widthCallback",null),Ds(this,"_attributes"),Ds(this,"_points",[]),Ds(this,"points"),Ds(this,"matrixWorld",new Hi),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,n){if(e=wLe(e),this._points=e,this.widthCallback=n??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof gt)for(let i=0;i<e.length;i++){const r=e[i],o=i/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(o),this.counters.push(o)}else for(let i=0;i<e.length;i+=3){const r=i/(e.length-1);this.positions.push(e[i],e[i+1],e[i+2]),this.positions.push(e[i],e[i+1],e[i+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,n){const i=e*6,r=n*6;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]}copyV3(e){const n=e*6;return[this.positions[n],this.positions[n+1],this.positions[n+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let n,i;this.compareV3(0,e-1)?i=this.copyV3(e-2):i=this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),this.widthCallback?n=this.widthCallback(r/(e-1)):n=1,this.width.push(n),this.width.push(n),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){i=this.copyV3(r),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);const o=r*2;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}r>0&&(i=this.copyV3(r),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]))}this.compareV3(e-1,0)?i=this.copyV3(1):i=this.copyV3(e-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new ns(new Float32Array(this.positions),3),previous:new ns(new Float32Array(this.previous),3),next:new ns(new Float32Array(this.next),3),side:new ns(new Float32Array(this.side),1),width:new ns(new Float32Array(this.width),1),uv:new ns(new Float32Array(this.uvs),2),index:new ns(new Uint16Array(this.indices_array),1),counters:new ns(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:n,z:i}){const r=this._attributes.position.array,o=this._attributes.previous.array,c=this._attributes.next.array,s=r.length;J2(r,0,o,0,s),J2(r,6,r,0,s-6),r[s-6]=e,r[s-5]=n,r[s-4]=i,r[s-3]=e,r[s-2]=n,r[s-1]=i,J2(r,6,c,0,s-6),c[s-6]=e,c[s-5]=n,c[s-4]=i,c[s-3]=e,c[s-2]=n,c[s-1]=i,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const SLe=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,bLe=parseInt(rb.replace(/\D+/g,"")),ELe=bLe>=154?"colorspace_fragment":"encodings_fragment",MLe=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${ELe}>
  }
`;class RLe extends ih{constructor(e){super({uniforms:{...wi.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new bi(16777215)},gradient:{value:[new bi(16711680),new bi(65280)]},opacity:{value:1},resolution:{value:new Cn(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Cn(1,1)}},vertexShader:SLe,fragmentShader:MLe}),Ds(this,"lineWidth"),Ds(this,"map"),Ds(this,"useMap"),Ds(this,"alphaMap"),Ds(this,"useAlphaMap"),Ds(this,"color"),Ds(this,"gradient"),Ds(this,"resolution"),Ds(this,"sizeAttenuation"),Ds(this,"dashArray"),Ds(this,"dashOffset"),Ds(this,"dashRatio"),Ds(this,"useDash"),Ds(this,"useGradient"),Ds(this,"visibility"),Ds(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(n){this.uniforms.lineWidth.value=n}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(n){this.uniforms.map.value=n}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(n){this.uniforms.useMap.value=n}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(n){this.uniforms.alphaMap.value=n}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(n){this.uniforms.useAlphaMap.value=n}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(n){this.uniforms.color.value=n}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(n){this.uniforms.gradient.value=n}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(n){this.uniforms.resolution.value.copy(n)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(n){this.uniforms.sizeAttenuation.value=n}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(n){this.uniforms.dashArray.value=n,this.useDash=n!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(n){this.uniforms.dashOffset.value=n}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(n){this.uniforms.dashRatio.value=n}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(n){this.uniforms.useDash.value=n}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(n){this.uniforms.useGradient.value=n}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(n){this.uniforms.visibility.value=n}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(n){this.uniforms.alphaTest.value=n}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(n){this.uniforms.repeat.value.copy(n)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const TLe=$l;class sA extends lc{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,n,i,r){const o=this,c=new Rf(o.manager);c.setPath(o.path),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(s){try{n(o.parse(s))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},i,r)}parse(e){const n=this;function i(Qe,Ge){if(Qe.nodeType!==1)return;const He=q(Qe);let De=!1,kt=null;switch(Qe.nodeName){case"svg":Ge=N(Qe,Ge);break;case"style":o(Qe);break;case"g":Ge=N(Qe,Ge);break;case"path":Ge=N(Qe,Ge),Qe.hasAttribute("d")&&(kt=r(Qe));break;case"rect":Ge=N(Qe,Ge),kt=f(Qe);break;case"polygon":Ge=N(Qe,Ge),kt=v(Qe);break;case"polyline":Ge=N(Qe,Ge),kt=w(Qe);break;case"circle":Ge=N(Qe,Ge),kt=C(Qe);break;case"ellipse":Ge=N(Qe,Ge),kt=M(Qe);break;case"line":Ge=N(Qe,Ge),kt=F(Qe);break;case"defs":De=!0;break;case"use":Ge=N(Qe,Ge);const Kt=(Qe.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),bt=Qe.viewportElement.getElementById(Kt);bt?i(bt,Ge):console.warn("SVGLoader: 'use node' references non-existent node id: "+Kt);break}kt&&(Ge.fill!==void 0&&Ge.fill!=="none"&&kt.color.setStyle(Ge.fill,TLe),ce(kt,Mt),We.push(kt),kt.userData={node:Qe,style:Ge});const rn=Qe.childNodes;for(let Re=0;Re<rn.length;Re++){const Kt=rn[Re];De&&Kt.nodeName!=="style"&&Kt.nodeName!=="defs"||i(Kt,Ge)}He&&(tt.pop(),tt.length>0?Mt.copy(tt[tt.length-1]):Mt.identity())}function r(Qe){const Ge=new Eg,He=new Cn,De=new Cn,kt=new Cn;let rn=!0,Re=!1;const Kt=Qe.getAttribute("d");if(Kt===""||Kt==="none")return null;const bt=Kt.match(/[a-df-z][^a-df-z]*/ig);for(let Dt=0,_e=bt.length;Dt<_e;Dt++){const At=bt[Dt],Ot=At.charAt(0),tn=At.slice(1).trim();rn===!0&&(Re=!0,rn=!1);let xe;switch(Ot){case"M":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2)He.x=xe[Se+0],He.y=xe[Se+1],De.x=He.x,De.y=He.y,Se===0?Ge.moveTo(He.x,He.y):Ge.lineTo(He.x,He.y),Se===0&&kt.copy(He);break;case"H":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se++)He.x=xe[Se],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"V":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se++)He.y=xe[Se],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"L":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2)He.x=xe[Se+0],He.y=xe[Se+1],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"C":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=6)Ge.bezierCurveTo(xe[Se+0],xe[Se+1],xe[Se+2],xe[Se+3],xe[Se+4],xe[Se+5]),De.x=xe[Se+2],De.y=xe[Se+3],He.x=xe[Se+4],He.y=xe[Se+5],Se===0&&Re===!0&&kt.copy(He);break;case"S":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=4)Ge.bezierCurveTo(z(He.x,De.x),z(He.y,De.y),xe[Se+0],xe[Se+1],xe[Se+2],xe[Se+3]),De.x=xe[Se+0],De.y=xe[Se+1],He.x=xe[Se+2],He.y=xe[Se+3],Se===0&&Re===!0&&kt.copy(He);break;case"Q":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=4)Ge.quadraticCurveTo(xe[Se+0],xe[Se+1],xe[Se+2],xe[Se+3]),De.x=xe[Se+0],De.y=xe[Se+1],He.x=xe[Se+2],He.y=xe[Se+3],Se===0&&Re===!0&&kt.copy(He);break;case"T":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2){const Le=z(He.x,De.x),Pe=z(He.y,De.y);Ge.quadraticCurveTo(Le,Pe,xe[Se+0],xe[Se+1]),De.x=Le,De.y=Pe,He.x=xe[Se+0],He.y=xe[Se+1],Se===0&&Re===!0&&kt.copy(He)}break;case"A":xe=L(tn,[3,4],7);for(let Se=0,it=xe.length;Se<it;Se+=7){if(xe[Se+5]==He.x&&xe[Se+6]==He.y)continue;const Le=He.clone();He.x=xe[Se+5],He.y=xe[Se+6],De.x=He.x,De.y=He.y,c(Ge,xe[Se],xe[Se+1],xe[Se+2],xe[Se+3],xe[Se+4],Le,He),Se===0&&Re===!0&&kt.copy(He)}break;case"m":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2)He.x+=xe[Se+0],He.y+=xe[Se+1],De.x=He.x,De.y=He.y,Se===0?Ge.moveTo(He.x,He.y):Ge.lineTo(He.x,He.y),Se===0&&kt.copy(He);break;case"h":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se++)He.x+=xe[Se],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"v":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se++)He.y+=xe[Se],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"l":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2)He.x+=xe[Se+0],He.y+=xe[Se+1],De.x=He.x,De.y=He.y,Ge.lineTo(He.x,He.y),Se===0&&Re===!0&&kt.copy(He);break;case"c":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=6)Ge.bezierCurveTo(He.x+xe[Se+0],He.y+xe[Se+1],He.x+xe[Se+2],He.y+xe[Se+3],He.x+xe[Se+4],He.y+xe[Se+5]),De.x=He.x+xe[Se+2],De.y=He.y+xe[Se+3],He.x+=xe[Se+4],He.y+=xe[Se+5],Se===0&&Re===!0&&kt.copy(He);break;case"s":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=4)Ge.bezierCurveTo(z(He.x,De.x),z(He.y,De.y),He.x+xe[Se+0],He.y+xe[Se+1],He.x+xe[Se+2],He.y+xe[Se+3]),De.x=He.x+xe[Se+0],De.y=He.y+xe[Se+1],He.x+=xe[Se+2],He.y+=xe[Se+3],Se===0&&Re===!0&&kt.copy(He);break;case"q":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=4)Ge.quadraticCurveTo(He.x+xe[Se+0],He.y+xe[Se+1],He.x+xe[Se+2],He.y+xe[Se+3]),De.x=He.x+xe[Se+0],De.y=He.y+xe[Se+1],He.x+=xe[Se+2],He.y+=xe[Se+3],Se===0&&Re===!0&&kt.copy(He);break;case"t":xe=L(tn);for(let Se=0,it=xe.length;Se<it;Se+=2){const Le=z(He.x,De.x),Pe=z(He.y,De.y);Ge.quadraticCurveTo(Le,Pe,He.x+xe[Se+0],He.y+xe[Se+1]),De.x=Le,De.y=Pe,He.x=He.x+xe[Se+0],He.y=He.y+xe[Se+1],Se===0&&Re===!0&&kt.copy(He)}break;case"a":xe=L(tn,[3,4],7);for(let Se=0,it=xe.length;Se<it;Se+=7){if(xe[Se+5]==0&&xe[Se+6]==0)continue;const Le=He.clone();He.x+=xe[Se+5],He.y+=xe[Se+6],De.x=He.x,De.y=He.y,c(Ge,xe[Se],xe[Se+1],xe[Se+2],xe[Se+3],xe[Se+4],Le,He),Se===0&&Re===!0&&kt.copy(He)}break;case"Z":case"z":Ge.currentPath.autoClose=!0,Ge.currentPath.curves.length>0&&(He.copy(kt),Ge.currentPath.currentPoint.copy(He),rn=!0);break;default:console.warn(At)}Re=!1}return Ge}function o(Qe){if(!(!Qe.sheet||!Qe.sheet.cssRules||!Qe.sheet.cssRules.length))for(let Ge=0;Ge<Qe.sheet.cssRules.length;Ge++){const He=Qe.sheet.cssRules[Ge];if(He.type!==1)continue;const De=He.selectorText.split(/,/gm).filter(Boolean).map(kt=>kt.trim());for(let kt=0;kt<De.length;kt++){const rn=Object.fromEntries(Object.entries(He.style).filter(([,Re])=>Re!==""));rt[De[kt]]=Object.assign(rt[De[kt]]||{},rn)}}}function c(Qe,Ge,He,De,kt,rn,Re,Kt){if(Ge==0||He==0){Qe.lineTo(Kt.x,Kt.y);return}De=De*Math.PI/180,Ge=Math.abs(Ge),He=Math.abs(He);const bt=(Re.x-Kt.x)/2,Dt=(Re.y-Kt.y)/2,_e=Math.cos(De)*bt+Math.sin(De)*Dt,At=-Math.sin(De)*bt+Math.cos(De)*Dt;let Ot=Ge*Ge,tn=He*He;const xe=_e*_e,Se=At*At,it=xe/Ot+Se/tn;if(it>1){const Li=Math.sqrt(it);Ge=Li*Ge,He=Li*He,Ot=Ge*Ge,tn=He*He}const Le=Ot*Se+tn*xe,Pe=(Ot*tn-Le)/Le;let vt=Math.sqrt(Math.max(0,Pe));kt===rn&&(vt=-vt);const yt=vt*Ge*At/He,nn=-vt*He*_e/Ge,jt=Math.cos(De)*yt-Math.sin(De)*nn+(Re.x+Kt.x)/2,Fn=Math.sin(De)*yt+Math.cos(De)*nn+(Re.y+Kt.y)/2,Bn=s(1,0,(_e-yt)/Ge,(At-nn)/He),Zn=s((_e-yt)/Ge,(At-nn)/He,(-_e-yt)/Ge,(-At-nn)/He)%(Math.PI*2);Qe.currentPath.absellipse(jt,Fn,Ge,He,Bn,Bn+Zn,rn===0,De)}function s(Qe,Ge,He,De){const kt=Qe*He+Ge*De,rn=Math.sqrt(Qe*Qe+Ge*Ge)*Math.sqrt(He*He+De*De);let Re=Math.acos(Math.max(-1,Math.min(1,kt/rn)));return Qe*De-Ge*He<0&&(Re=-Re),Re}function f(Qe){const Ge=j(Qe.getAttribute("x")||0),He=j(Qe.getAttribute("y")||0),De=j(Qe.getAttribute("rx")||Qe.getAttribute("ry")||0),kt=j(Qe.getAttribute("ry")||Qe.getAttribute("rx")||0),rn=j(Qe.getAttribute("width")),Re=j(Qe.getAttribute("height")),Kt=1-.551915024494,bt=new Eg;return bt.moveTo(Ge+De,He),bt.lineTo(Ge+rn-De,He),(De!==0||kt!==0)&&bt.bezierCurveTo(Ge+rn-De*Kt,He,Ge+rn,He+kt*Kt,Ge+rn,He+kt),bt.lineTo(Ge+rn,He+Re-kt),(De!==0||kt!==0)&&bt.bezierCurveTo(Ge+rn,He+Re-kt*Kt,Ge+rn-De*Kt,He+Re,Ge+rn-De,He+Re),bt.lineTo(Ge+De,He+Re),(De!==0||kt!==0)&&bt.bezierCurveTo(Ge+De*Kt,He+Re,Ge,He+Re-kt*Kt,Ge,He+Re-kt),bt.lineTo(Ge,He+kt),(De!==0||kt!==0)&&bt.bezierCurveTo(Ge,He+kt*Kt,Ge+De*Kt,He,Ge+De,He),bt}function v(Qe){function Ge(rn,Re,Kt){const bt=j(Re),Dt=j(Kt);kt===0?De.moveTo(bt,Dt):De.lineTo(bt,Dt),kt++}const He=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,De=new Eg;let kt=0;return Qe.getAttribute("points").replace(He,Ge),De.currentPath.autoClose=!0,De}function w(Qe){function Ge(rn,Re,Kt){const bt=j(Re),Dt=j(Kt);kt===0?De.moveTo(bt,Dt):De.lineTo(bt,Dt),kt++}const He=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,De=new Eg;let kt=0;return Qe.getAttribute("points").replace(He,Ge),De.currentPath.autoClose=!1,De}function C(Qe){const Ge=j(Qe.getAttribute("cx")||0),He=j(Qe.getAttribute("cy")||0),De=j(Qe.getAttribute("r")||0),kt=new tv;kt.absarc(Ge,He,De,0,Math.PI*2);const rn=new Eg;return rn.subPaths.push(kt),rn}function M(Qe){const Ge=j(Qe.getAttribute("cx")||0),He=j(Qe.getAttribute("cy")||0),De=j(Qe.getAttribute("rx")||0),kt=j(Qe.getAttribute("ry")||0),rn=new tv;rn.absellipse(Ge,He,De,kt,0,Math.PI*2);const Re=new Eg;return Re.subPaths.push(rn),Re}function F(Qe){const Ge=j(Qe.getAttribute("x1")||0),He=j(Qe.getAttribute("y1")||0),De=j(Qe.getAttribute("x2")||0),kt=j(Qe.getAttribute("y2")||0),rn=new Eg;return rn.moveTo(Ge,He),rn.lineTo(De,kt),rn.currentPath.autoClose=!1,rn}function N(Qe,Ge){Ge=Object.assign({},Ge);let He={};if(Qe.hasAttribute("class")){const Re=Qe.getAttribute("class").split(/\s/).filter(Boolean).map(Kt=>Kt.trim());for(let Kt=0;Kt<Re.length;Kt++)He=Object.assign(He,rt["."+Re[Kt]])}Qe.hasAttribute("id")&&(He=Object.assign(He,rt["#"+Qe.getAttribute("id")]));function De(Re,Kt,bt){bt===void 0&&(bt=function(_e){return _e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),_e}),Qe.hasAttribute(Re)&&(Ge[Kt]=bt(Qe.getAttribute(Re))),He[Re]&&(Ge[Kt]=bt(He[Re])),Qe.style&&Qe.style[Re]!==""&&(Ge[Kt]=bt(Qe.style[Re]))}function kt(Re){return Math.max(0,Math.min(1,j(Re)))}function rn(Re){return Math.max(0,j(Re))}return De("fill","fill"),De("fill-opacity","fillOpacity",kt),De("fill-rule","fillRule"),De("opacity","opacity",kt),De("stroke","stroke"),De("stroke-opacity","strokeOpacity",kt),De("stroke-width","strokeWidth",rn),De("stroke-linejoin","strokeLineJoin"),De("stroke-linecap","strokeLineCap"),De("stroke-miterlimit","strokeMiterLimit",rn),De("visibility","visibility"),Ge}function z(Qe,Ge){return Qe-(Ge-Qe)}function L(Qe,Ge,He){if(typeof Qe!="string")throw new TypeError("Invalid input: "+typeof Qe);const De={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},kt=0,rn=1,Re=2,Kt=3;let bt=kt,Dt=!0,_e="",At="";const Ot=[];function tn(Le,Pe,vt){const yt=new SyntaxError('Unexpected character "'+Le+'" at index '+Pe+".");throw yt.partial=vt,yt}function xe(){_e!==""&&(At===""?Ot.push(Number(_e)):Ot.push(Number(_e)*Math.pow(10,Number(At)))),_e="",At=""}let Se;const it=Qe.length;for(let Le=0;Le<it;Le++){if(Se=Qe[Le],Array.isArray(Ge)&&Ge.includes(Ot.length%He)&&De.FLAGS.test(Se)){bt=rn,_e=Se,xe();continue}if(bt===kt){if(De.WHITESPACE.test(Se))continue;if(De.DIGIT.test(Se)||De.SIGN.test(Se)){bt=rn,_e=Se;continue}if(De.POINT.test(Se)){bt=Re,_e=Se;continue}De.COMMA.test(Se)&&(Dt&&tn(Se,Le,Ot),Dt=!0)}if(bt===rn){if(De.DIGIT.test(Se)){_e+=Se;continue}if(De.POINT.test(Se)){_e+=Se,bt=Re;continue}if(De.EXP.test(Se)){bt=Kt;continue}De.SIGN.test(Se)&&_e.length===1&&De.SIGN.test(_e[0])&&tn(Se,Le,Ot)}if(bt===Re){if(De.DIGIT.test(Se)){_e+=Se;continue}if(De.EXP.test(Se)){bt=Kt;continue}De.POINT.test(Se)&&_e[_e.length-1]==="."&&tn(Se,Le,Ot)}if(bt===Kt){if(De.DIGIT.test(Se)){At+=Se;continue}if(De.SIGN.test(Se)){if(At===""){At+=Se;continue}At.length===1&&De.SIGN.test(At)&&tn(Se,Le,Ot)}}De.WHITESPACE.test(Se)?(xe(),bt=kt,Dt=!1):De.COMMA.test(Se)?(xe(),bt=kt,Dt=!0):De.SIGN.test(Se)?(xe(),bt=rn,_e=Se):De.POINT.test(Se)?(xe(),bt=Re,_e=Se):tn(Se,Le,Ot)}return xe(),Ot}const P=["mm","cm","in","pt","pc","px"],H={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function j(Qe){let Ge="px";if(typeof Qe=="string"||Qe instanceof String)for(let De=0,kt=P.length;De<kt;De++){const rn=P[De];if(Qe.endsWith(rn)){Ge=rn,Qe=Qe.substring(0,Qe.length-rn.length);break}}let He;return Ge==="px"&&n.defaultUnit!=="px"?He=H.in[n.defaultUnit]/n.defaultDPI:(He=H[Ge][n.defaultUnit],He<0&&(He=H[Ge].in*n.defaultDPI)),He*parseFloat(Qe)}function q(Qe){if(!(Qe.hasAttribute("transform")||Qe.nodeName==="use"&&(Qe.hasAttribute("x")||Qe.hasAttribute("y"))))return null;const Ge=le(Qe);return tt.length>0&&Ge.premultiply(tt[tt.length-1]),Mt.copy(Ge),tt.push(Ge),Ge}function le(Qe){const Ge=new dr,He=Ye;if(Qe.nodeName==="use"&&(Qe.hasAttribute("x")||Qe.hasAttribute("y"))){const De=j(Qe.getAttribute("x")),kt=j(Qe.getAttribute("y"));Ge.translate(De,kt)}if(Qe.hasAttribute("transform")){const De=Qe.getAttribute("transform").split(")");for(let kt=De.length-1;kt>=0;kt--){const rn=De[kt].trim();if(rn==="")continue;const Re=rn.indexOf("("),Kt=rn.length;if(Re>0&&Re<Kt){const bt=rn.slice(0,Re),Dt=L(rn.slice(Re+1));switch(He.identity(),bt){case"translate":if(Dt.length>=1){const _e=Dt[0];let At=0;Dt.length>=2&&(At=Dt[1]),He.translate(_e,At)}break;case"rotate":if(Dt.length>=1){let _e=0,At=0,Ot=0;_e=Dt[0]*Math.PI/180,Dt.length>=3&&(At=Dt[1],Ot=Dt[2]),qe.makeTranslation(-At,-Ot),ft.makeRotation(_e),Me.multiplyMatrices(ft,qe),qe.makeTranslation(At,Ot),He.multiplyMatrices(qe,Me)}break;case"scale":if(Dt.length>=1){const _e=Dt[0];let At=_e;Dt.length>=2&&(At=Dt[1]),He.scale(_e,At)}break;case"skewX":Dt.length===1&&He.set(1,Math.tan(Dt[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":Dt.length===1&&He.set(1,0,0,Math.tan(Dt[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":Dt.length===6&&He.set(Dt[0],Dt[2],Dt[4],Dt[1],Dt[3],Dt[5],0,0,1);break}}Ge.premultiply(He)}}return Ge}function ce(Qe,Ge){function He(Re){ut.set(Re.x,Re.y,1).applyMatrix3(Ge),Re.set(ut.x,ut.y)}function De(Re){const Kt=Re.xRadius,bt=Re.yRadius,Dt=Math.cos(Re.aRotation),_e=Math.sin(Re.aRotation),At=new gt(Kt*Dt,Kt*_e,0),Ot=new gt(-bt*_e,bt*Dt,0),tn=At.applyMatrix3(Ge),xe=Ot.applyMatrix3(Ge),Se=Ye.set(tn.x,xe.x,0,tn.y,xe.y,0,0,0,1),it=qe.copy(Se).invert(),vt=ft.copy(it).transpose().multiply(it).elements,yt=Ee(vt[0],vt[1],vt[4]),nn=Math.sqrt(yt.rt1),jt=Math.sqrt(yt.rt2);if(Re.xRadius=1/nn,Re.yRadius=1/jt,Re.aRotation=Math.atan2(yt.sn,yt.cs),!((Re.aEndAngle-Re.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Bn=qe.set(nn,0,0,0,jt,0,0,0,1),Zn=ft.set(yt.cs,yt.sn,0,-yt.sn,yt.cs,0,0,0,1),Li=Bn.multiply(Zn).multiply(Se),zn=oi=>{const{x:gi,y:Ti}=new gt(Math.cos(oi),Math.sin(oi),0).applyMatrix3(Li);return Math.atan2(Ti,gi)};Re.aStartAngle=zn(Re.aStartAngle),Re.aEndAngle=zn(Re.aEndAngle),ae(Ge)&&(Re.aClockwise=!Re.aClockwise)}}function kt(Re){const Kt=fe(Ge),bt=ue(Ge);Re.xRadius*=Kt,Re.yRadius*=bt;const Dt=Kt>Number.EPSILON?Math.atan2(Ge.elements[1],Ge.elements[0]):Math.atan2(-Ge.elements[3],Ge.elements[4]);Re.aRotation+=Dt,ae(Ge)&&(Re.aStartAngle*=-1,Re.aEndAngle*=-1,Re.aClockwise=!Re.aClockwise)}const rn=Qe.subPaths;for(let Re=0,Kt=rn.length;Re<Kt;Re++){const Dt=rn[Re].curves;for(let _e=0;_e<Dt.length;_e++){const At=Dt[_e];At.isLineCurve?(He(At.v1),He(At.v2)):At.isCubicBezierCurve?(He(At.v0),He(At.v1),He(At.v2),He(At.v3)):At.isQuadraticBezierCurve?(He(At.v0),He(At.v1),He(At.v2)):At.isEllipseCurve&&($e.set(At.aX,At.aY),He($e),At.aX=$e.x,At.aY=$e.y,pe(Ge)?De(At):kt(At))}}}function ae(Qe){const Ge=Qe.elements;return Ge[0]*Ge[4]-Ge[1]*Ge[3]<0}function pe(Qe){const Ge=Qe.elements,He=Ge[0]*Ge[3]+Ge[1]*Ge[4];if(He===0)return!1;const De=fe(Qe),kt=ue(Qe);return Math.abs(He/(De*kt))>Number.EPSILON}function fe(Qe){const Ge=Qe.elements;return Math.sqrt(Ge[0]*Ge[0]+Ge[1]*Ge[1])}function ue(Qe){const Ge=Qe.elements;return Math.sqrt(Ge[3]*Ge[3]+Ge[4]*Ge[4])}function Ee(Qe,Ge,He){let De,kt,rn,Re,Kt;const bt=Qe+He,Dt=Qe-He,_e=Math.sqrt(Dt*Dt+4*Ge*Ge);return bt>0?(De=.5*(bt+_e),Kt=1/De,kt=Qe*Kt*He-Ge*Kt*Ge):bt<0?kt=.5*(bt-_e):(De=.5*_e,kt=-.5*_e),Dt>0?rn=Dt+_e:rn=Dt-_e,Math.abs(rn)>2*Math.abs(Ge)?(Kt=-2*Ge/rn,Re=1/Math.sqrt(1+Kt*Kt),rn=Kt*Re):Math.abs(Ge)===0?(rn=1,Re=0):(Kt=-.5*rn/Ge,rn=1/Math.sqrt(1+Kt*Kt),Re=Kt*rn),Dt>0&&(Kt=rn,rn=-Re,Re=Kt),{rt1:De,rt2:kt,cs:rn,sn:Re}}const We=[],rt={},tt=[],Ye=new dr,qe=new dr,ft=new dr,Me=new dr,$e=new Cn,ut=new gt,Mt=new dr,Gt=new DOMParser().parseFromString(e,"image/svg+xml");return i(Gt.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:We,xml:Gt.documentElement}}static createShapes(e){const i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:i.ORIGIN,t:0};function o(z,L,P,H){const j=z.x,q=L.x,le=P.x,ce=H.x,ae=z.y,pe=L.y,fe=P.y,ue=H.y,Ee=(ce-le)*(ae-fe)-(ue-fe)*(j-le),We=(q-j)*(ae-fe)-(pe-ae)*(j-le),rt=(ue-fe)*(q-j)-(ce-le)*(pe-ae),tt=Ee/rt,Ye=We/rt;if(rt===0&&Ee!==0||tt<=0||tt>=1||Ye<0||Ye>1)return null;if(Ee===0&&rt===0){for(let qe=0;qe<2;qe++)if(c(qe===0?P:H,z,L),r.loc==i.ORIGIN){const ft=qe===0?P:H;return{x:ft.x,y:ft.y,t:r.t}}else if(r.loc==i.BETWEEN){const ft=+(j+r.t*(q-j)).toPrecision(10),Me=+(ae+r.t*(pe-ae)).toPrecision(10);return{x:ft,y:Me,t:r.t}}return null}else{for(let Me=0;Me<2;Me++)if(c(Me===0?P:H,z,L),r.loc==i.ORIGIN){const $e=Me===0?P:H;return{x:$e.x,y:$e.y,t:r.t}}const qe=+(j+tt*(q-j)).toPrecision(10),ft=+(ae+tt*(pe-ae)).toPrecision(10);return{x:qe,y:ft,t:tt}}}function c(z,L,P){const H=P.x-L.x,j=P.y-L.y,q=z.x-L.x,le=z.y-L.y,ce=H*le-q*j;if(z.x===L.x&&z.y===L.y){r.loc=i.ORIGIN,r.t=0;return}if(z.x===P.x&&z.y===P.y){r.loc=i.DESTINATION,r.t=1;return}if(ce<-Number.EPSILON){r.loc=i.LEFT;return}if(ce>Number.EPSILON){r.loc=i.RIGHT;return}if(H*q<0||j*le<0){r.loc=i.BEHIND;return}if(Math.sqrt(H*H+j*j)<Math.sqrt(q*q+le*le)){r.loc=i.BEYOND;return}let ae;H!==0?ae=q/H:ae=le/j,r.loc=i.BETWEEN,r.t=ae}function s(z,L){const P=[],H=[];for(let j=1;j<z.length;j++){const q=z[j-1],le=z[j];for(let ce=1;ce<L.length;ce++){const ae=L[ce-1],pe=L[ce],fe=o(q,le,ae,pe);fe!==null&&P.find(ue=>ue.t<=fe.t+Number.EPSILON&&ue.t>=fe.t-Number.EPSILON)===void 0&&(P.push(fe),H.push(new Cn(fe.x,fe.y)))}}return H}function f(z,L,P){const H=new Cn;L.getCenter(H);const j=[];return P.forEach(q=>{q.boundingBox.containsPoint(H)&&s(z,q.points).forEach(ce=>{j.push({identifier:q.identifier,isCW:q.isCW,point:ce})})}),j.sort((q,le)=>q.point.x-le.point.x),j}function v(z,L,P,H,j){(j==null||j==="")&&(j="nonzero");const q=new Cn;z.boundingBox.getCenter(q);const le=[new Cn(P,q.y),new Cn(H,q.y)],ce=f(le,z.boundingBox,L);ce.sort((We,rt)=>We.point.x-rt.point.x);const ae=[],pe=[];ce.forEach(We=>{We.identifier===z.identifier?ae.push(We):pe.push(We)});const fe=ae[0].point.x,ue=[];let Ee=0;for(;Ee<pe.length&&pe[Ee].point.x<fe;)ue.length>0&&ue[ue.length-1]===pe[Ee].identifier?ue.pop():ue.push(pe[Ee].identifier),Ee++;if(ue.push(z.identifier),j==="evenodd"){const We=ue.length%2===0,rt=ue[ue.length-2];return{identifier:z.identifier,isHole:We,for:rt}}else if(j==="nonzero"){let We=!0,rt=null,tt=null;for(let Ye=0;Ye<ue.length;Ye++){const qe=ue[Ye];We?(tt=L[qe].isCW,We=!1,rt=qe):tt!==L[qe].isCW&&(tt=L[qe].isCW,We=!0)}return{identifier:z.identifier,isHole:We,for:rt}}else console.warn('fill-rule: "'+j+'" is currently not implemented.')}let w=999999999,C=-999999999,M=e.subPaths.map(z=>{const L=z.getPoints();let P=-999999999,H=999999999,j=-999999999,q=999999999;for(let le=0;le<L.length;le++){const ce=L[le];ce.y>P&&(P=ce.y),ce.y<H&&(H=ce.y),ce.x>j&&(j=ce.x),ce.x<q&&(q=ce.x)}return C<=j&&(C=j+1),w>=q&&(w=q-1),{curves:z.curves,points:L,isCW:od.isClockWise(L),identifier:-1,boundingBox:new bJ(new Cn(q,H),new Cn(j,P))}});M=M.filter(z=>z.points.length>1);for(let z=0;z<M.length;z++)M[z].identifier=z;const F=M.map(z=>v(z,M,w,C,e.userData?e.userData.style.fillRule:void 0)),N=[];return M.forEach(z=>{if(!F[z.identifier].isHole){const P=new nv;P.curves=z.curves,F.filter(j=>j.isHole&&j.for===z.identifier).forEach(j=>{const q=M[j.identifier],le=new tv;le.curves=q.curves,P.holes.push(le)}),N.push(P)}}),N}static getStrokeStyle(e,n,i,r,o){return e=e!==void 0?e:1,n=n!==void 0?n:"#000",i=i!==void 0?i:"miter",r=r!==void 0?r:"butt",o=o!==void 0?o:4,{strokeColor:n,strokeWidth:e,strokeLineJoin:i,strokeLineCap:r,strokeMiterLimit:o}}static pointsToStroke(e,n,i,r){const o=[],c=[],s=[];if(sA.pointsToStrokeWithBuffers(e,n,i,r,o,c,s)===0)return null;const f=new Cr;return f.setAttribute("position",new Ni(o,3)),f.setAttribute("normal",new Ni(c,3)),f.setAttribute("uv",new Ni(s,2)),f}static pointsToStrokeWithBuffers(e,n,i,r,o,c,s,f){const v=new Cn,w=new Cn,C=new Cn,M=new Cn,F=new Cn,N=new Cn,z=new Cn,L=new Cn,P=new Cn,H=new Cn,j=new Cn,q=new Cn,le=new Cn,ce=new Cn,ae=new Cn,pe=new Cn,fe=new Cn;i=i!==void 0?i:12,r=r!==void 0?r:.001,f=f!==void 0?f:0,e=Dt(e);const ue=e.length;if(ue<2)return 0;const Ee=e[0].equals(e[ue-1]);let We,rt=e[0],tt;const Ye=n.strokeWidth/2,qe=1/(ue-1);let ft=0,Me,$e,ut,Mt,Gt=!1,Xt=0,Qe=f*3,Ge=f*2;He(e[0],e[1],v).multiplyScalar(Ye),L.copy(e[0]).sub(v),P.copy(e[0]).add(v),H.copy(L),j.copy(P);for(let _e=1;_e<ue;_e++){We=e[_e],_e===ue-1?Ee?tt=e[1]:tt=void 0:tt=e[_e+1];const At=v;if(He(rt,We,At),C.copy(At).multiplyScalar(Ye),q.copy(We).sub(C),le.copy(We).add(C),Me=ft+qe,$e=!1,tt!==void 0){He(We,tt,w),C.copy(w).multiplyScalar(Ye),ce.copy(We).sub(C),ae.copy(We).add(C),ut=!0,C.subVectors(tt,rt),At.dot(C)<0&&(ut=!1),_e===1&&(Gt=ut),C.subVectors(tt,We),C.normalize();const Ot=Math.abs(At.dot(C));if(Ot>Number.EPSILON){const tn=Ye/Ot;C.multiplyScalar(-tn),M.subVectors(We,rt),F.copy(M).setLength(tn).add(C),pe.copy(F).negate();const xe=F.length(),Se=M.length();M.divideScalar(Se),N.subVectors(tt,We);const it=N.length();switch(N.divideScalar(it),M.dot(pe)<Se&&N.dot(pe)<it&&($e=!0),fe.copy(F).add(We),pe.add(We),Mt=!1,$e?ut?(ae.copy(pe),le.copy(pe)):(ce.copy(pe),q.copy(pe)):rn(),n.strokeLineJoin){case"bevel":Re(ut,$e,Me);break;case"round":Kt(ut,$e),ut?kt(We,q,ce,Me,0):kt(We,ae,le,Me,1);break;case"miter":case"miter-clip":default:const Le=Ye*n.strokeMiterLimit/xe;if(Le<1)if(n.strokeLineJoin!=="miter-clip"){Re(ut,$e,Me);break}else Kt(ut,$e),ut?(N.subVectors(fe,q).multiplyScalar(Le).add(q),z.subVectors(fe,ce).multiplyScalar(Le).add(ce),De(q,Me,0),De(N,Me,0),De(We,Me,.5),De(We,Me,.5),De(N,Me,0),De(z,Me,0),De(We,Me,.5),De(z,Me,0),De(ce,Me,0)):(N.subVectors(fe,le).multiplyScalar(Le).add(le),z.subVectors(fe,ae).multiplyScalar(Le).add(ae),De(le,Me,1),De(N,Me,1),De(We,Me,.5),De(We,Me,.5),De(N,Me,1),De(z,Me,1),De(We,Me,.5),De(z,Me,1),De(ae,Me,1));else $e?(ut?(De(P,ft,1),De(L,ft,0),De(fe,Me,0),De(P,ft,1),De(fe,Me,0),De(pe,Me,1)):(De(P,ft,1),De(L,ft,0),De(fe,Me,1),De(L,ft,0),De(pe,Me,0),De(fe,Me,1)),ut?ce.copy(fe):ae.copy(fe)):ut?(De(q,Me,0),De(fe,Me,0),De(We,Me,.5),De(We,Me,.5),De(fe,Me,0),De(ce,Me,0)):(De(le,Me,1),De(fe,Me,1),De(We,Me,.5),De(We,Me,.5),De(fe,Me,1),De(ae,Me,1)),Mt=!0;break}}else rn()}else rn();!Ee&&_e===ue-1&&bt(e[0],H,j,ut,!0,ft),ft=Me,rt=We,L.copy(ce),P.copy(ae)}if(!Ee)bt(We,q,le,ut,!1,Me);else if($e&&o){let _e=fe,At=pe;Gt!==ut&&(_e=pe,At=fe),ut?(Mt||Gt)&&(At.toArray(o,0*3),At.toArray(o,3*3),Mt&&_e.toArray(o,1*3)):(Mt||!Gt)&&(At.toArray(o,1*3),At.toArray(o,3*3),Mt&&_e.toArray(o,0*3))}return Xt;function He(_e,At,Ot){return Ot.subVectors(At,_e),Ot.set(-Ot.y,Ot.x).normalize()}function De(_e,At,Ot){o&&(o[Qe]=_e.x,o[Qe+1]=_e.y,o[Qe+2]=0,c&&(c[Qe]=0,c[Qe+1]=0,c[Qe+2]=1),Qe+=3,s&&(s[Ge]=At,s[Ge+1]=Ot,Ge+=2)),Xt+=3}function kt(_e,At,Ot,tn,xe){v.copy(At).sub(_e).normalize(),w.copy(Ot).sub(_e).normalize();let Se=Math.PI;const it=v.dot(w);Math.abs(it)<1&&(Se=Math.abs(Math.acos(it))),Se/=i,C.copy(At);for(let Le=0,Pe=i-1;Le<Pe;Le++)M.copy(C).rotateAround(_e,Se),De(C,tn,xe),De(M,tn,xe),De(_e,tn,.5),C.copy(M);De(M,tn,xe),De(Ot,tn,xe),De(_e,tn,.5)}function rn(){De(P,ft,1),De(L,ft,0),De(q,Me,0),De(P,ft,1),De(q,Me,0),De(le,Me,1)}function Re(_e,At,Ot){At?_e?(De(P,ft,1),De(L,ft,0),De(q,Me,0),De(P,ft,1),De(q,Me,0),De(pe,Me,1),De(q,Ot,0),De(ce,Ot,0),De(pe,Ot,.5)):(De(P,ft,1),De(L,ft,0),De(le,Me,1),De(L,ft,0),De(pe,Me,0),De(le,Me,1),De(le,Ot,1),De(pe,Ot,0),De(ae,Ot,1)):_e?(De(q,Ot,0),De(ce,Ot,0),De(We,Ot,.5)):(De(le,Ot,1),De(ae,Ot,0),De(We,Ot,.5))}function Kt(_e,At){At&&(_e?(De(P,ft,1),De(L,ft,0),De(q,Me,0),De(P,ft,1),De(q,Me,0),De(pe,Me,1),De(q,ft,0),De(We,Me,.5),De(pe,Me,1),De(We,Me,.5),De(ce,ft,0),De(pe,Me,1)):(De(P,ft,1),De(L,ft,0),De(le,Me,1),De(L,ft,0),De(pe,Me,0),De(le,Me,1),De(le,ft,1),De(pe,Me,0),De(We,Me,.5),De(We,Me,.5),De(pe,Me,0),De(ae,ft,1)))}function bt(_e,At,Ot,tn,xe,Se){switch(n.strokeLineCap){case"round":xe?kt(_e,Ot,At,Se,.5):kt(_e,At,Ot,Se,.5);break;case"square":if(xe)v.subVectors(At,_e),w.set(v.y,-v.x),C.addVectors(v,w).add(_e),M.subVectors(w,v).add(_e),tn?(C.toArray(o,1*3),M.toArray(o,0*3),M.toArray(o,3*3)):(C.toArray(o,1*3),s[3*2+1]===1?M.toArray(o,3*3):C.toArray(o,3*3),M.toArray(o,0*3));else{v.subVectors(Ot,_e),w.set(v.y,-v.x),C.addVectors(v,w).add(_e),M.subVectors(w,v).add(_e);const it=o.length;tn?(C.toArray(o,it-1*3),M.toArray(o,it-2*3),M.toArray(o,it-4*3)):(M.toArray(o,it-2*3),C.toArray(o,it-1*3),M.toArray(o,it-4*3))}break}}function Dt(_e){let At=!1;for(let tn=1,xe=_e.length-1;tn<xe;tn++)if(_e[tn].distanceTo(_e[tn+1])<r){At=!0;break}if(!At)return _e;const Ot=[];Ot.push(_e[0]);for(let tn=1,xe=_e.length-1;tn<xe;tn++)_e[tn].distanceTo(_e[tn+1])>=r&&Ot.push(_e[tn]);return Ot.push(_e[_e.length-1]),Ot}}}const ALe="https://mywayrtkapi.cyrusbowman.com";async function PLe(){return console.log("fetchBases"),Wr.get(ALe+"/bases",{headers:{Authorization:`Bearer ${uo.token}`}}).then(function(t){return t.data})}function ILe(t){return pd({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(t)}var lQ={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(nN,function(){return function(n,i,r){n=n||{};var o=i.prototype,c={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function s(v,w,C,M){return o.fromToBase(v,w,C,M)}r.en.relativeTime=c,o.fromToBase=function(v,w,C,M,F){for(var N,z,L,P=C.$locale().relativeTime||c,H=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],j=H.length,q=0;q<j;q+=1){var le=H[q];le.d&&(N=M?r(v).diff(C,le.d,!0):C.diff(v,le.d,!0));var ce=(n.rounding||Math.round)(Math.abs(N));if(L=N>0,ce<=le.r||!le.r){ce<=1&&q>0&&(le=H[q-1]);var ae=P[le.l];F&&(ce=F(""+ce)),z=typeof ae=="string"?ae.replace("%d",ce):ae(ce,w,le.l,L);break}}if(w)return z;var pe=L?P.future:P.past;return typeof pe=="function"?pe(z):pe.replace("%s",z)},o.to=function(v,w){return s(v,w,this,!0)},o.from=function(v,w){return s(v,w,this)};var f=function(v){return v.$u?r.utc():r()};o.toNow=function(v){return this.to(f(this),v)},o.fromNow=function(v){return this.from(f(this),v)}}})})(lQ);var DLe=lQ.exports;const FLe=pv(DLe);gT.extend(FLe);const LLe=()=>re.jsx("style",{children:`
      .asset-popup .maplibregl-popup-content {
        pointer-events: none;
      }
    `});function OLe(t){return gT.unix(t).fromNow(!0)}function kLe({asset:t={}}){const e=lm(),n=xv(uQ),{login:i="",firstName:r="",lastName:o="",longitude:c=0,latitude:s=0,id:f=null,customerId:v=null,lastLogin:w=0,online:C=!1,lastMountpointConnected:M=""}=t;return re.jsxs(MK,{longitude:c,latitude:s,className:"asset-popup !max-w-[300px]",disableScroll:!1,closeButton:!1,closeOnClick:!1,offset:22,children:[re.jsx(LLe,{}),re.jsx(ILe,{className:"absolute top-2 right-2 text-lg cursor-pointer pointer-events-auto",onClick:()=>n(F=>({...F,[f]:!1}))}),re.jsxs("div",{className:"px-2",children:[re.jsx("div",{className:"text-md font-bold pointer-events-auto",children:i}),re.jsx("div",{className:"text-md",children:`${r} ${o}`}),re.jsx("div",{className:Ar("text-md",!C&&"hidden"),children:`Connected to ${M} for ${OLe(w)}.`}),re.jsx(No,{variant:"outline",className:"text-xs h-6 mt-2 pointer-events-auto",onClick:()=>e(`/customers/${v}/subscriptions/${f}`),children:"View Details"})]})]})}dz({MeshLineGeometry:CLe,MeshLineMaterial:RLe});const cQ=Pa(null),uQ=Pa({}),NLe=({opacity:t=.35,color:e=[0,128/255,0],deprecated:n=!1})=>re.jsx("shaderMaterial",{transparent:!0,attach:"material",uniforms:{uOpacity:{value:t},uColor:{value:new bi(...e)},uDeprecated:{value:n}},args:[{vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform bool uDeprecated;
        uniform float uOpacity;
        uniform vec3 uColor;
        varying vec2 vUv;
        void main() {
          if (uDeprecated) {
            float checker = mod(floor(vUv.x * 9.3) + floor(vUv.y * 9.3), 2.0);
            float alpha = checker < 1.0 ? uOpacity : 0.0;
            gl_FragColor = vec4(uColor, alpha);
          } else {
            gl_FragColor = vec4(uColor, uOpacity);
          }
        }
      `}]}),BLe=({baseId:t,radius:e,latitude:n,longitude:i,name:r,deprecated:o,status:c,onClick:s})=>{const[f,v]=Ha(cQ);Q.useRef({x:0,y:0,time:0});const{camera:w}=Ic(),C=1600,M=Q.useMemo(()=>{const P=new fb(C*e,64),j=new YB(P).attributes.position.array;return new Float32Array(j)},[e]),[F,N]=Q.useState(!1);_P(()=>{w.position.y<2e4?F!==!0&&N(!0):F!==!1&&N(!1)});const z=t===(f==null?void 0:f.id);let L=[0,.5,0];return c==="Offline"?L=[1,0,0]:c=="Partially Offline"&&(L=[1,1,0]),re.jsx(_z,{latitude:n,longitude:i,children:re.jsxs("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],onPointerEnter:()=>v({id:t,latitude:n,longitude:i,name:r}),onPointerOut:()=>v(null),onPointerMove:()=>{f==null&&v({id:t,latitude:n,longitude:i,name:r})},onClick:()=>{console.log("clicked the base",t),s&&s()},children:[re.jsx("circleGeometry",{args:[C*e,64]}),re.jsx(NLe,{opacity:F?0:z?.6:.35,color:L,deprecated:o}),(z||F)&&re.jsxs("mesh",{children:[re.jsx("meshLineGeometry",{attach:"geometry",points:M}),re.jsx("meshLineMaterial",{attach:"material",color:"white",lineWidth:4,transparent:!0})]})]})})};function zLe(){const[t,e]=Ha(cQ);return t!=null&&re.jsxs(re.Fragment,{children:[re.jsx(MK,{disableScroll:!1,className:"custom-popup",anchor:"center",latitude:t.latitude,longitude:t.longitude,closeButton:!1,closeOnClick:!1,children:t.name}),re.jsx("style",{children:`
        /* Scoped to a specific popup using a custom class */
        .custom-popup .maplibregl-popup-content {
          background: none; /* Semi-transparent white */
          color: white; /* Text color */
          text-shadow: 0 0 5px black, 0 0 2px white;
          font-size: 1.5em;
          font-weight: bold;
          pointer-events: none;
          cursor: pointer;
          padding: 0px;
          background-color: none;
        }
        .custom-popup .maplibregl-popup-tip {
          display: none; /* Optional: remove the tip */
        }
      `})]})}function ULe({svgUrl:t,position:e,latitude:n,longitude:i,minSize:r=1,index:o,online:c=!0,onClick:s}){const[f,v]=Q.useState([]),[w,C]=Q.useState([0,0]),M=Q.useRef(o),{camera:F}=Ic();Q.useRef({x:0,y:0,time:0});const N={primary:"#367c2b",secondary:"#ffde00",tertiary:"gray",quaternary:"#000"},z=L=>{const P=new bi(L),H=.3*P.r+.59*P.g+.11*P.b;return new bi(H,H,H)};return Q.useEffect(()=>{new sA().load(t,P=>{const H=[];let j=1/0,q=1/0,le=-1/0,ce=-1/0;P.paths.forEach((fe,ue)=>{const Ee=sA.createShapes(fe);Ee.forEach(We=>{const rt=new mb(We);rt.computeBoundingBox();const tt=rt.boundingBox;j=Math.min(j,tt.min.x),q=Math.min(q,tt.min.y),le=Math.max(le,tt.max.x),ce=Math.max(ce,tt.max.y)}),H.push(...Ee.map((We,rt)=>{var ft,Me,$e,ut,Mt,Gt;const tt=($e=(Me=(ft=fe.userData)==null?void 0:ft.node)==null?void 0:Me.className)==null?void 0:$e.baseVal;let Ye=N[tt]?N[tt]:fe.color,qe=1;if((ut=fe.userData)!=null&&ut.node){const Xt=(Gt=(Mt=fe.userData)==null?void 0:Mt.node)==null?void 0:Gt.getAttribute("style");if(Xt){const Qe=Xt.match(/opacity:\s*([\d.]+)/);qe=Qe?Qe[1]:1}}return c||(Ye=z(Ye),qe*=.5),{shape:We,color:Ye,opacity:qe,zOffset:10+(ue+rt*.01)*5}}))});const ae=(j+le)/2,pe=(q+ce)/2;C([-ae,-pe]),v(H)},void 0,P=>{console.error("Error loading SVG:",P)})},[t]),_P(()=>{if(M.current){let L=F.position.y/800;L>2e3&&(L=2e3),M.current.scale.set(L,L,L/100)}}),re.jsx(_z,{latitude:n,longitude:i,children:re.jsx("group",{ref:M,position:e,scale:[1600*1,1600*1,1],rotation:[-Math.PI/2,0,Math.PI],onClick:L=>{L.stopPropagation(),console.log("clicked asset group"),s&&s()},children:f.map((L,P)=>re.jsxs("mesh",{position:[w[0],w[1],L.zOffset],children:[re.jsx("shapeGeometry",{args:[L.shape]}),re.jsx("meshBasicMaterial",{color:L.color||"white",side:2,transparent:L.opacity!=1,opacity:L.opacity})]},P))})})}function VLe(){const t=mw(),[e,n]=Ha(uQ),{data:i,error:r,isLoading:o}=bf({queryKey:["bases"],queryFn:PLe}),{data:c,error:s,isLoading:f}=bf({queryKey:["assets"],queryFn:VCe});return re.jsx("div",{className:Ar("flex w-screen h-screen",!t.pathname.startsWith("/map")&&"hidden"),children:re.jsxs(XEe,{antialias:!0,attributionControl:!1,initialViewState:{longitude:-84.9732217429008,latitude:41.44778710806756,zoom:8},mapStyle:"https://api.maptiler.com/maps/8722460c-b58a-439f-870d-4d77ea5f0948/style.json?key=nHneQVmmtScN7DftVJfN",children:[(c||[]).map((v,w)=>e[v.id]?re.jsx(kLe,{asset:v},"popup"+w):null),re.jsx(zLe,{}),re.jsxs(aQ,{latitude:41.44778710806756,longitude:-84.9732217429008,flat:!0,children:[re.jsx("hemisphereLight",{args:["#ffffff","#60666C"],position:[1,4.5,3]}),i==null?void 0:i.map(({id:v,latitude:w,longitude:C,name:M,radius:F,deprecated:N,status:z})=>re.jsx(BLe,{baseId:v,radius:F,latitude:w,longitude:C,name:M,deprecated:N,status:z},v)),(c||[]).map(({id:v,latitude:w,longitude:C,svgUrl:M,online:F,...N},z)=>re.jsx(ULe,{index:z,position:[0,0,0],latitude:w,longitude:C,svgUrl:M||"tractor.svg",online:F,onClick:()=>n({...e,[v]:!0})},"sub"+z))]})]})})}var GLe=function(){return null};const HLe=new Noe;function WLe(){return re.jsxs("div",{className:"flex min-h-screen w-full",children:[re.jsx("div",{className:"flex",children:re.jsx(noe,{})}),re.jsx(VLe,{}),re.jsx(mse,{})]})}function jLe(){return re.jsxs(Goe,{client:HLe,children:[re.jsx(GLe,{}),re.jsxs("div",{className:"flex min-h-screen w-full",children:[re.jsx(wse,{children:re.jsxs(vse,{children:[re.jsx(Rp,{path:"/login",element:re.jsx(YD,{})}),re.jsx(Rp,{path:"/verify",element:re.jsx(YD,{})}),re.jsx(Rp,{index:!0,element:re.jsx(YD,{})}),re.jsxs(Rp,{path:"/",element:re.jsx(WLe,{}),children:[re.jsx(Rp,{path:"map",element:re.jsx(re.Fragment,{})}),re.jsx(Rp,{path:"customers",element:re.jsx(wEe,{})}),re.jsx(Rp,{path:"customers/:id",element:re.jsx(YCe,{})}),re.jsx(Rp,{path:"customers/:customerId/subscriptions/:id",element:re.jsx(f1e,{})})]})]})}),re.jsx(aEe,{}),re.jsx(uEe,{})]})]})}Q2.createRoot(document.getElementById("root")).render(re.jsx(kn.StrictMode,{children:re.jsx(jLe,{})}));export{nN as c,pv as g};
